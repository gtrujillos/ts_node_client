var a27_0x3e95=['setCurrentDriverImage','syncEvents','length','driverValidationEvents','file','folder','existsSync','toString','result','eventResults','default','encrypt','locationParts','current_driver.jpg','latitude','speed','eventData:\x20','base64Sync','parse','stringify','No\x20file:\x20','route_schedules/get_by_vehicle/','get','success','data','image_data','saveImageFile','replace','match','png','jpg','ensureDirSync','authorized_driver.txt','writeFile','user_id','VIDEO_SERVICE_FILES_FOLDER','status.json','Video\x20service\x20restarted','writeFileSync','copy','SyncVehicleService','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','jpeg-extract','base64-img','is-corrupted-jpeg','child_process','fork','url','http://localhost:60/index1.jpg','env','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind'];(function(_0x663c2d,_0x3a0fe2){var _0x14cf4d=function(_0x5a37c5){while(--_0x5a37c5){_0x663c2d['push'](_0x663c2d['shift']());}};_0x14cf4d(++_0x3a0fe2);}(a27_0x3e95,0x182));var a27_0x556e=function(_0x3548ba,_0x55b4e3){_0x3548ba=_0x3548ba-0x0;var _0x148a8c=a27_0x3e95[_0x3548ba];return _0x148a8c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4eca44){return _0x4eca44&&_0x4eca44[a27_0x556e('0x0')]?_0x4eca44:{'default':_0x4eca44};};Object[a27_0x556e('0x1')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a27_0x556e('0x2'));const crypt_utils_1=__importDefault(require(a27_0x556e('0x3')));const extract=require(a27_0x556e('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a27_0x556e('0x5'));const isCorrupted=require(a27_0x556e('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x556e('0x7'))[a27_0x556e('0x8')];class SyncVehicleService{constructor(_0x30df8a){this[a27_0x556e('0x9')]=a27_0x556e('0xa');this['folder']=process[a27_0x556e('0xb')][a27_0x556e('0xc')];this[a27_0x556e('0xd')]=process[a27_0x556e('0xb')][a27_0x556e('0xe')];this[a27_0x556e('0xf')]=process['env'][a27_0x556e('0x10')];this['eventResults']=[{'file':a27_0x556e('0x11'),'result':0x0},{'file':a27_0x556e('0x12'),'result':0x0},{'file':a27_0x556e('0x13'),'result':0x0}];this[a27_0x556e('0x14')]=new HttpClientService_1[(a27_0x556e('0x15'))]();this[a27_0x556e('0x16')]=_0x30df8a;}[a27_0x556e('0x17')](){console[a27_0x556e('0x18')](a27_0x556e('0x19'));this[a27_0x556e('0x1a')]();setInterval(function(){this[a27_0x556e('0x1a')]();}[a27_0x556e('0x1b')](this),0x2710);setInterval(function(){this[a27_0x556e('0x1c')]();}[a27_0x556e('0x1b')](this),0x7d0);setInterval(function(){this[a27_0x556e('0x1d')]();}[a27_0x556e('0x1b')](this),0x3e8);}[a27_0x556e('0x1d')](){for(let _0xaf6b7e=0x0;_0xaf6b7e<this['eventResults'][a27_0x556e('0x1e')];_0xaf6b7e++){this[a27_0x556e('0x1f')](_0xaf6b7e);}}['driverValidationEvents'](_0x3c5aed){const _0x5bd82d=this['eventResults'][_0x3c5aed][a27_0x556e('0x20')];const _0x5cde4a=''+this[a27_0x556e('0x21')]+_0x5bd82d;if(fsExtra[a27_0x556e('0x22')](_0x5cde4a)){const _0x547c58=fsExtra['readFileSync'](_0x5cde4a)[a27_0x556e('0x23')]();if(this['eventResults'][_0x3c5aed][a27_0x556e('0x24')]!=_0x547c58){this[a27_0x556e('0x25')][_0x3c5aed][a27_0x556e('0x24')]=_0x547c58;console[a27_0x556e('0x18')](a27_0x556e('0x1d'),this[a27_0x556e('0x25')][_0x3c5aed][a27_0x556e('0x24')],_0x547c58);const _0x1cd9fd=this[a27_0x556e('0xd')]+'events/report_event/';const _0x29ac7b=crypt_utils_1[a27_0x556e('0x26')][a27_0x556e('0x27')](_0x547c58);console[a27_0x556e('0x18')]('eventTypeId',_0x29ac7b);const _0x353f47=this['gpsService']?this[a27_0x556e('0x16')][a27_0x556e('0x28')]:{};const _0x5f5d07=this['folder']+a27_0x556e('0x29');let _0x2b770e=null;const _0x57de1d={'event_type_id':_0x29ac7b,'vehicle_id':this[a27_0x556e('0xf')],'latitude':_0x353f47['latitude']?_0x353f47[a27_0x556e('0x2a')]:0x0,'longitude':_0x353f47['longitude']?_0x353f47['longitude']:0x0,'speed':_0x353f47[a27_0x556e('0x2b')]?_0x353f47[a27_0x556e('0x2b')]:0x0,'reported_at':new Date(),'image_data':_0x2b770e};console[a27_0x556e('0x18')](a27_0x556e('0x2c'),_0x57de1d);if(fsExtra[a27_0x556e('0x22')](_0x5f5d07)){_0x2b770e=base64Img[a27_0x556e('0x2d')](_0x5f5d07);_0x2b770e=JSON[a27_0x556e('0x2e')](JSON[a27_0x556e('0x2f')](_0x2b770e));_0x57de1d['image_data']=_0x2b770e;}this['httpClientService']['post'](_0x1cd9fd,_0x57de1d,![])['then'](function(_0x182044){if(_0x182044['success']){}}['bind'](this))['catch'](function(_0x1a91fa){console[a27_0x556e('0x18')](_0x1a91fa);});}}else{console[a27_0x556e('0x18')](a27_0x556e('0x30'),_0x5bd82d);}}[a27_0x556e('0x1a')](){const _0x52bc70=this['apiURL']+a27_0x556e('0x31')+this[a27_0x556e('0xf')];this[a27_0x556e('0x14')][a27_0x556e('0x32')](_0x52bc70,![])['then'](function(_0x43733c){if(_0x43733c[a27_0x556e('0x33')]){if(_0x43733c[a27_0x556e('0x34')]&&_0x43733c[a27_0x556e('0x34')][a27_0x556e('0x1e')]>0x0&&_0x43733c['data'][0x0][a27_0x556e('0x35')]){this[a27_0x556e('0x36')](_0x43733c[a27_0x556e('0x34')][0x0]);}}}['bind'](this))['catch'](function(_0x24e92c){console[a27_0x556e('0x18')](_0x24e92c);});}[a27_0x556e('0x36')](_0x2e1755){let _0x915887='';const _0x50aa8c=_0x2e1755[a27_0x556e('0x35')][a27_0x556e('0x37')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x2e1755[a27_0x556e('0x35')][a27_0x556e('0x38')](/^data:image\/png;base64,/,'')){_0x915887=a27_0x556e('0x39');}else if(_0x2e1755[a27_0x556e('0x35')][a27_0x556e('0x38')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x915887=a27_0x556e('0x3a');}fsExtra[a27_0x556e('0x3b')](this[a27_0x556e('0x21')]);const _0x24f070=this[a27_0x556e('0x21')]+'authorized_driver.'+_0x915887;const _0x2272c5=this[a27_0x556e('0x21')]+a27_0x556e('0x3c');fsExtra[a27_0x556e('0x3d')](_0x24f070,_0x50aa8c,'base64',function(_0x252c74){});fsExtra['writeFile'](_0x2272c5,_0x2e1755[a27_0x556e('0x3e')],function(_0x32ceb6){});}['setCurrentDriverImage'](){const _0x165844=new Date();const _0x3da8c0=_0x165844['getTime']()-currentDriverImageDate['getTime']();if(_0x3da8c0>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x556e('0x3d')](process[a27_0x556e('0xb')][a27_0x556e('0x3f')]+a27_0x556e('0x40'),'{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x13c3e6){console[a27_0x556e('0x18')](a27_0x556e('0x41'));if(_0x13c3e6){return console[a27_0x556e('0x18')](_0x13c3e6);}});}else{extract(this['url'],(_0x1bfef1,_0x2a80c6)=>{try{if(!_0x1bfef1){const _0x1bc802=process[a27_0x556e('0xb')]['FILES_FOLDER'];fsExtra[a27_0x556e('0x3b')](_0x1bc802);const _0x4d667b=_0x1bc802+'current_driver_temp.jpg';const _0x582658=_0x1bc802+'current_driver.jpg';fsExtra[a27_0x556e('0x42')](_0x4d667b,_0x2a80c6);if(!isCorrupted(_0x4d667b)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a27_0x556e('0x43')](_0x4d667b,_0x582658);}else{corruptedCounter++;console[a27_0x556e('0x18')](a27_0x556e('0x1c'),corruptedCounter);}}else{console['error']('extract',_0x1bfef1);}}catch(_0x5d3c65){}finally{}});}}}exports[a27_0x556e('0x44')]=SyncVehicleService;