var a26_0x3c66=['SyncVehicleService','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','base64-img','is-corrupted-jpeg','fork','url','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','init\x20SyncVehicleService\x20test22','image1.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','eventResults','length','driverValidationEvents','file','existsSync','readFileSync','result','log','events/report_event/','default','encrypt','eventTypeId','gpsService','locationParts','latitude','replace','longitude','speed','base64Sync','stringify','image_data','post','then','success','catch','err','httpClientService','get','data','saveImageFile','match','png','jpg','authorized_driver.','authorized_driver.txt','base64','writeFile','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','current_driver_temp.jpg','current_driver.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','error'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a26_0x3c66,0x187));var a26_0x3474=function(_0x3d55e5,_0x2a0718){_0x3d55e5=_0x3d55e5-0x0;var _0x250ce8=a26_0x3c66[_0x3d55e5];return _0x250ce8;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3b297f){return _0x3b297f&&_0x3b297f[a26_0x3474('0x0')]?_0x3b297f:{'default':_0x3b297f};};Object[a26_0x3474('0x1')](exports,a26_0x3474('0x0'),{'value':!![]});const HttpClientService_1=require(a26_0x3474('0x2'));const crypt_utils_1=__importDefault(require(a26_0x3474('0x3')));const extract=require(a26_0x3474('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a26_0x3474('0x5'));const isCorrupted=require(a26_0x3474('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require('jimp');const fork=require('child_process')[a26_0x3474('0x7')];class SyncVehicleService{constructor(_0x23e38c){this[a26_0x3474('0x8')]=a26_0x3474('0x9');this[a26_0x3474('0xa')]=process[a26_0x3474('0xb')][a26_0x3474('0xc')];this[a26_0x3474('0xd')]=process['env'][a26_0x3474('0xe')];this[a26_0x3474('0xf')]=process[a26_0x3474('0xb')][a26_0x3474('0x10')];this['eventResults']=[{'file':a26_0x3474('0x11'),'result':0x0},{'file':a26_0x3474('0x12'),'result':0x0},{'file':a26_0x3474('0x13'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x3474('0x14'))]();this['gpsService']=_0x23e38c;}['init2'](){console['log'](a26_0x3474('0x15'));const _0x30086e=this[a26_0x3474('0xa')]+a26_0x3474('0x16');const _0x6828b6=this[a26_0x3474('0xa')]+'image2.jpg';}[a26_0x3474('0x17')](){console['log'](a26_0x3474('0x18'));this['loadAuthorizedDriver']();setInterval(function(){this[a26_0x3474('0x19')]();}[a26_0x3474('0x1a')](this),0x2710);setInterval(function(){this[a26_0x3474('0x1b')]();}[a26_0x3474('0x1a')](this),0x7d0);setInterval(function(){this[a26_0x3474('0x1c')]();}[a26_0x3474('0x1a')](this),0x3e8);}[a26_0x3474('0x1c')](){for(let _0x21cecc=0x0;_0x21cecc<this[a26_0x3474('0x1d')][a26_0x3474('0x1e')];_0x21cecc++){this[a26_0x3474('0x1f')](_0x21cecc);}}[a26_0x3474('0x1f')](_0x163c8c){const _0x535065=this[a26_0x3474('0x1d')][_0x163c8c][a26_0x3474('0x20')];const _0xf47255=''+this[a26_0x3474('0xa')]+_0x535065;if(fsExtra[a26_0x3474('0x21')](_0xf47255)){const _0x1e4aff=fsExtra[a26_0x3474('0x22')](_0xf47255)['toString']();if(this[a26_0x3474('0x1d')][_0x163c8c][a26_0x3474('0x23')]!=_0x1e4aff){this[a26_0x3474('0x1d')][_0x163c8c][a26_0x3474('0x23')]=_0x1e4aff;console[a26_0x3474('0x24')](a26_0x3474('0x1c'),this[a26_0x3474('0x1d')][_0x163c8c][a26_0x3474('0x23')],_0x1e4aff);const _0x5a37f7=this[a26_0x3474('0xd')]+a26_0x3474('0x25');const _0x24bc73=crypt_utils_1[a26_0x3474('0x26')][a26_0x3474('0x27')](_0x1e4aff);console[a26_0x3474('0x24')](a26_0x3474('0x28'),_0x24bc73);const _0x2bb2fe=this[a26_0x3474('0x29')]?this[a26_0x3474('0x29')][a26_0x3474('0x2a')]:{};const _0x1be69b=this['folder']+'current_driver.jpg';let _0x136ea3=null;const _0xd91c1f={'event_type_id':_0x24bc73,'vehicle_id':this[a26_0x3474('0xf')],'latitude':_0x2bb2fe[a26_0x3474('0x2b')]?_0x2bb2fe[a26_0x3474('0x2b')][a26_0x3474('0x2c')](',','.'):0x0,'longitude':_0x2bb2fe[a26_0x3474('0x2d')]?_0x2bb2fe['longitude'][a26_0x3474('0x2c')](',','.'):0x0,'speed':_0x2bb2fe[a26_0x3474('0x2e')]?_0x2bb2fe[a26_0x3474('0x2e')]:0x0,'reported_at':new Date(),'image_data':_0x136ea3};if(fsExtra['existsSync'](_0x1be69b)){_0x136ea3=base64Img[a26_0x3474('0x2f')](_0x1be69b);_0x136ea3=JSON['parse'](JSON[a26_0x3474('0x30')](_0x136ea3));_0xd91c1f[a26_0x3474('0x31')]=_0x136ea3;}this['httpClientService'][a26_0x3474('0x32')](_0x5a37f7,_0xd91c1f,![])[a26_0x3474('0x33')](function(_0x4f684c){if(_0x4f684c[a26_0x3474('0x34')]){}}[a26_0x3474('0x1a')](this))[a26_0x3474('0x35')](function(_0xb9198b){console[a26_0x3474('0x24')](a26_0x3474('0x36'));});}}else{}}['loadAuthorizedDriver'](){const _0x146028=this[a26_0x3474('0xd')]+'route_schedules/get_by_vehicle/'+this[a26_0x3474('0xf')];this[a26_0x3474('0x37')][a26_0x3474('0x38')](_0x146028,![])['then'](function(_0x3261fb){if(_0x3261fb[a26_0x3474('0x34')]){if(_0x3261fb[a26_0x3474('0x39')]&&_0x3261fb[a26_0x3474('0x39')][a26_0x3474('0x1e')]>0x0&&_0x3261fb[a26_0x3474('0x39')][0x0][a26_0x3474('0x31')]){this['saveImageFile'](_0x3261fb[a26_0x3474('0x39')][0x0]);}}}['bind'](this))['catch'](function(_0x31471a){console[a26_0x3474('0x24')](_0x31471a);});}[a26_0x3474('0x3a')](_0xa433e3){let _0x375abc='';const _0x430420=_0xa433e3[a26_0x3474('0x31')][a26_0x3474('0x2c')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0xa433e3[a26_0x3474('0x31')][a26_0x3474('0x3b')](/^data:image\/png;base64,/,'')){_0x375abc=a26_0x3474('0x3c');}else if(_0xa433e3[a26_0x3474('0x31')][a26_0x3474('0x3b')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x375abc=a26_0x3474('0x3d');}fsExtra['ensureDirSync'](this[a26_0x3474('0xa')]);const _0x359aaa=this[a26_0x3474('0xa')]+a26_0x3474('0x3e')+_0x375abc;const _0x92b0e3=this['folder']+a26_0x3474('0x3f');fsExtra['writeFile'](_0x359aaa,_0x430420,a26_0x3474('0x40'),function(_0xb7716a){});fsExtra[a26_0x3474('0x41')](_0x92b0e3,_0xa433e3[a26_0x3474('0x42')],function(_0x5726fc){});}['setCurrentDriverImage'](){const _0x17cf70=new Date();const _0x5e95b1=_0x17cf70[a26_0x3474('0x43')]()-currentDriverImageDate[a26_0x3474('0x43')]();if(_0x5e95b1>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x3474('0xb')][a26_0x3474('0x44')]+a26_0x3474('0x45'),a26_0x3474('0x46')+currentDriverImageDate+'\x22}',function(_0x14b625){console[a26_0x3474('0x24')]('Video\x20service\x20restarted');if(_0x14b625){return console[a26_0x3474('0x24')](_0x14b625);}});}else{extract(this[a26_0x3474('0x8')],(_0x105b8c,_0x4eca7a)=>{try{if(!_0x105b8c){const _0x3fbad7=process[a26_0x3474('0xb')][a26_0x3474('0xc')];fsExtra['ensureDirSync'](_0x3fbad7);const _0xc09711=_0x3fbad7+a26_0x3474('0x47');const _0x18a918=_0x3fbad7+a26_0x3474('0x48');fsExtra[a26_0x3474('0x49')](_0xc09711,_0x4eca7a);if(!isCorrupted(_0xc09711)){corruptedCounter=0x0;currentDriverImageDate=new Date();console['log']('setCurrentDriverImage',!![],new Date());fsExtra[a26_0x3474('0x4a')](_0xc09711,_0x18a918);}else{corruptedCounter++;console[a26_0x3474('0x24')](a26_0x3474('0x4b'),corruptedCounter);const _0x342474=new Date();const _0x4c7e83=_0x342474['getTime']();}}else{console[a26_0x3474('0x4c')]('extract',_0x105b8c);}}catch(_0x2ae22e){}finally{}});}}}exports[a26_0x3474('0x4d')]=SyncVehicleService;