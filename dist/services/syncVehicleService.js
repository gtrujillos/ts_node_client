var a27_0x5014=['loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','result_driver.txt','readFileSync','currentDriverResult','events/report_event/','Send\x20event','driverResult','default','encrypt','current_driver.jpg','base64Sync','parse','stringify','latitude','longitude','speed','post','then','success','catch','route_schedules/get_by_vehicle/','get','data','length','image_data','saveImageFile','replace','png','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','user_id','writeFileSync','kill','SyncVehicleService','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','fs-extra','base64-img','child_process','fork','url','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','httpClientService','HttpClientService','gpsService','init','log','init\x20SyncVehicleService'];(function(_0xf7589f,_0x22392c){var _0x4a5492=function(_0x126faf){while(--_0x126faf){_0xf7589f['push'](_0xf7589f['shift']());}};_0x4a5492(++_0x22392c);}(a27_0x5014,0xac));var a27_0x4d23=function(_0x7c5738,_0x1d57e2){_0x7c5738=_0x7c5738-0x0;var _0x73b2cf=a27_0x5014[_0x7c5738];return _0x73b2cf;};'use strict';var __importDefault=this&&this[a27_0x4d23('0x0')]||function(_0xe78927){return _0xe78927&&_0xe78927[a27_0x4d23('0x1')]?_0xe78927:{'default':_0xe78927};};Object[a27_0x4d23('0x2')](exports,a27_0x4d23('0x1'),{'value':!![]});const HttpClientService_1=require(a27_0x4d23('0x3'));const crypt_utils_1=__importDefault(require('../infrastructure/crypt-utils'));const extract=require('jpeg-extract');const fsExtra=require(a27_0x4d23('0x4'));const base64Img=require(a27_0x4d23('0x5'));const fork=require(a27_0x4d23('0x6'))[a27_0x4d23('0x7')];let child;class SyncVehicleService{constructor(_0xa3083){this[a27_0x4d23('0x8')]=a27_0x4d23('0x9');this['currentDriverResult']=null;this[a27_0x4d23('0xa')]=process[a27_0x4d23('0xb')][a27_0x4d23('0xc')];this[a27_0x4d23('0xd')]=process[a27_0x4d23('0xb')][a27_0x4d23('0xe')];this[a27_0x4d23('0xf')]=process[a27_0x4d23('0xb')][a27_0x4d23('0x10')];this[a27_0x4d23('0x11')]=new HttpClientService_1[(a27_0x4d23('0x12'))]();this[a27_0x4d23('0x13')]=_0xa3083;}[a27_0x4d23('0x14')](){console[a27_0x4d23('0x15')](a27_0x4d23('0x16'));this[a27_0x4d23('0x17')]();setInterval(function(){this[a27_0x4d23('0x17')]();}[a27_0x4d23('0x18')](this),0x2710);setInterval(function(){this[a27_0x4d23('0x19')]();}[a27_0x4d23('0x18')](this),0x3e8);setInterval(function(){this['syncEvents']();}['bind'](this),0x3e8);}[a27_0x4d23('0x1a')](){const _0x3ce133=this[a27_0x4d23('0xa')]+a27_0x4d23('0x1b');if(fsExtra['existsSync'](_0x3ce133)){const _0x56e2e0=fsExtra[a27_0x4d23('0x1c')](_0x3ce133)['toString']();if(this[a27_0x4d23('0x1d')]!=_0x56e2e0){this[a27_0x4d23('0x1d')]=_0x56e2e0;const _0x34f1e7=this[a27_0x4d23('0xd')]+a27_0x4d23('0x1e');console[a27_0x4d23('0x15')](a27_0x4d23('0x1f'),_0x34f1e7);console[a27_0x4d23('0x15')](a27_0x4d23('0x20'),_0x56e2e0);const _0x117113=crypt_utils_1[a27_0x4d23('0x21')][a27_0x4d23('0x22')](_0x56e2e0);console[a27_0x4d23('0x15')]('eventTypeId',_0x117113);const _0x46d412=this[a27_0x4d23('0x13')]?this[a27_0x4d23('0x13')]['locationParts']:{};const _0x405709=this[a27_0x4d23('0xa')]+a27_0x4d23('0x23');let _0x5f02bd=null;if(fsExtra['existsSync'](_0x405709)){_0x5f02bd=base64Img[a27_0x4d23('0x24')](_0x405709);_0x5f02bd=JSON[a27_0x4d23('0x25')](JSON[a27_0x4d23('0x26')](_0x5f02bd));_0x5f02bd=_0x5f02bd;}const _0x26cdce={'event_type_id':_0x117113,'vehicle_id':this[a27_0x4d23('0xf')],'latitude':_0x46d412[a27_0x4d23('0x27')]?_0x46d412[a27_0x4d23('0x27')]:0x0,'longitude':_0x46d412[a27_0x4d23('0x28')]?_0x46d412['longitude']:0x0,'speed':_0x46d412[a27_0x4d23('0x29')]?_0x46d412[a27_0x4d23('0x29')]:0x0,'reported_at':new Date(),'image_data':_0x5f02bd};this[a27_0x4d23('0x11')][a27_0x4d23('0x2a')](_0x34f1e7,_0x26cdce,![])[a27_0x4d23('0x2b')](function(_0x5d20d9){if(_0x5d20d9[a27_0x4d23('0x2c')]){}}['bind'](this))[a27_0x4d23('0x2d')](function(_0x739140){console[a27_0x4d23('0x15')](_0x739140);});}}}[a27_0x4d23('0x17')](){console[a27_0x4d23('0x15')]('loadAuthorizedDriver');const _0x3955ad=this['apiURL']+a27_0x4d23('0x2e')+this[a27_0x4d23('0xf')];console['log']('loadAuthorizedDriver',_0x3955ad);this[a27_0x4d23('0x11')][a27_0x4d23('0x2f')](_0x3955ad,![])[a27_0x4d23('0x2b')](function(_0xadb5ae){if(_0xadb5ae[a27_0x4d23('0x2c')]){if(_0xadb5ae[a27_0x4d23('0x30')]&&_0xadb5ae[a27_0x4d23('0x30')][a27_0x4d23('0x31')]>0x0&&_0xadb5ae[a27_0x4d23('0x30')][0x0][a27_0x4d23('0x32')]){this['saveImageFile'](_0xadb5ae['data'][0x0]);}}}[a27_0x4d23('0x18')](this))[a27_0x4d23('0x2d')](function(_0x5b52c1){console[a27_0x4d23('0x15')](_0x5b52c1);});}[a27_0x4d23('0x33')](_0x205208){let _0x4aa530='';const _0x1e2aa0=_0x205208['image_data'][a27_0x4d23('0x34')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x205208[a27_0x4d23('0x32')]['match'](/^data:image\/png;base64,/,'')){_0x4aa530=a27_0x4d23('0x35');}else if(_0x205208[a27_0x4d23('0x32')][a27_0x4d23('0x36')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x4aa530=a27_0x4d23('0x37');}fsExtra[a27_0x4d23('0x38')](this[a27_0x4d23('0xa')]);const _0x113b1e=this['folder']+a27_0x4d23('0x39')+_0x4aa530;const _0x18ec66=this['folder']+a27_0x4d23('0x3a');fsExtra[a27_0x4d23('0x3b')](_0x113b1e,_0x1e2aa0,a27_0x4d23('0x3c'),function(_0x3abf58){});fsExtra[a27_0x4d23('0x3b')](_0x18ec66,_0x205208[a27_0x4d23('0x3d')],function(_0x1b4d4c){});}['setCurrentDriverImage'](){console[a27_0x4d23('0x15')](a27_0x4d23('0x19'));extract(this[a27_0x4d23('0x8')])[a27_0x4d23('0x2b')](_0x4bcb71=>{const _0x32f61d=process[a27_0x4d23('0xb')][a27_0x4d23('0xc')];fsExtra['ensureDirSync'](_0x32f61d);const _0x1cf971=_0x32f61d+a27_0x4d23('0x23');fsExtra[a27_0x4d23('0x3e')](_0x1cf971,_0x4bcb71);})[a27_0x4d23('0x2d')](_0xc5c6a6=>{console['error'](_0xc5c6a6);if(child!=null){child[a27_0x4d23('0x3f')]();child=null;}});}}exports[a27_0x4d23('0x40')]=SyncVehicleService;