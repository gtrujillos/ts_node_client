var a26_0x5d13=['setCurrentDriverImage','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','.jpg','error','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','base64-img','is-corrupted-jpeg','jimp','http://localhost:60/index1.jpg','folder','FILES_FOLDER','env','API_SERVICE_URL','vehicleId','VEHICLE_ID','eventResults','result_driver.txt','result_driver_behaviour.txt','HttpClientService','gpsService','log','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','syncEvents','length','driverValidationEvents','file','readFileSync','toString','result','apiURL','events/report_event/','default','encrypt','eventTypeId','locationParts','current_driver.jpg','latitude','replace','longitude','speed','existsSync','base64Sync','parse','image_data','post','then','success','catch','err','route_schedules/get_by_vehicle/','data','saveImageFile','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','base64','user_id','getTime','writeFile','url','current_driver_temp.jpg','writeFileSync'];(function(_0x35d742,_0x2516e8){var _0x6f8abc=function(_0x5586ab){while(--_0x5586ab){_0x35d742['push'](_0x35d742['shift']());}};_0x6f8abc(++_0x2516e8);}(a26_0x5d13,0x181));var a26_0x54f6=function(_0x4230ba,_0x476139){_0x4230ba=_0x4230ba-0x0;var _0x166f78=a26_0x5d13[_0x4230ba];return _0x166f78;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x347495){return _0x347495&&_0x347495[a26_0x54f6('0x0')]?_0x347495:{'default':_0x347495};};Object[a26_0x54f6('0x1')](exports,a26_0x54f6('0x0'),{'value':!![]});const HttpClientService_1=require(a26_0x54f6('0x2'));const crypt_utils_1=__importDefault(require(a26_0x54f6('0x3')));const extract=require(a26_0x54f6('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a26_0x54f6('0x5'));const isCorrupted=require(a26_0x54f6('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x54f6('0x7'));const fork=require('child_process')['fork'];class SyncVehicleService{constructor(_0x534764){this['url']=a26_0x54f6('0x8');this[a26_0x54f6('0x9')]=process['env'][a26_0x54f6('0xa')];this['apiURL']=process[a26_0x54f6('0xb')][a26_0x54f6('0xc')];this[a26_0x54f6('0xd')]=process[a26_0x54f6('0xb')][a26_0x54f6('0xe')];this[a26_0x54f6('0xf')]=[{'file':a26_0x54f6('0x10'),'result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':a26_0x54f6('0x11'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x54f6('0x12'))]();this[a26_0x54f6('0x13')]=_0x534764;}['init2'](){console[a26_0x54f6('0x14')](a26_0x54f6('0x15'));const _0x1ae251=this[a26_0x54f6('0x9')]+a26_0x54f6('0x16');const _0x31a141=this[a26_0x54f6('0x9')]+a26_0x54f6('0x17');}[a26_0x54f6('0x18')](){console[a26_0x54f6('0x14')](a26_0x54f6('0x19'));this[a26_0x54f6('0x1a')]();setInterval(function(){this[a26_0x54f6('0x1a')]();}['bind'](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a26_0x54f6('0x1b')](this),0x7d0);setInterval(function(){this[a26_0x54f6('0x1c')]();}[a26_0x54f6('0x1b')](this),0x3e8);}[a26_0x54f6('0x1c')](){for(let _0x4f07c9=0x0;_0x4f07c9<this['eventResults'][a26_0x54f6('0x1d')];_0x4f07c9++){this[a26_0x54f6('0x1e')](_0x4f07c9);}}[a26_0x54f6('0x1e')](_0x468dd0){const _0x4111f2=this[a26_0x54f6('0xf')][_0x468dd0][a26_0x54f6('0x1f')];const _0x50d839=''+this['folder']+_0x4111f2;if(fsExtra['existsSync'](_0x50d839)){const _0x8b5e8d=fsExtra[a26_0x54f6('0x20')](_0x50d839)[a26_0x54f6('0x21')]();if(this[a26_0x54f6('0xf')][_0x468dd0][a26_0x54f6('0x22')]!=_0x8b5e8d){this['eventResults'][_0x468dd0][a26_0x54f6('0x22')]=_0x8b5e8d;console[a26_0x54f6('0x14')]('syncEvents',this[a26_0x54f6('0xf')][_0x468dd0][a26_0x54f6('0x22')],_0x8b5e8d);const _0x225f03=this[a26_0x54f6('0x23')]+a26_0x54f6('0x24');const _0x1f51f6=crypt_utils_1[a26_0x54f6('0x25')][a26_0x54f6('0x26')](_0x8b5e8d);console['log'](a26_0x54f6('0x27'),_0x1f51f6);const _0x4aa38b=this[a26_0x54f6('0x13')]?this[a26_0x54f6('0x13')][a26_0x54f6('0x28')]:{};const _0x20167b=this['folder']+a26_0x54f6('0x29');let _0xf0988=null;const _0x5ee486={'event_type_id':_0x1f51f6,'vehicle_id':this['vehicleId'],'latitude':_0x4aa38b[a26_0x54f6('0x2a')]?_0x4aa38b[a26_0x54f6('0x2a')][a26_0x54f6('0x2b')](',','.'):0x0,'longitude':_0x4aa38b['longitude']?_0x4aa38b[a26_0x54f6('0x2c')]['replace'](',','.'):0x0,'speed':_0x4aa38b[a26_0x54f6('0x2d')]?_0x4aa38b[a26_0x54f6('0x2d')]:0x0,'reported_at':new Date(),'image_data':_0xf0988};if(fsExtra[a26_0x54f6('0x2e')](_0x20167b)){_0xf0988=base64Img[a26_0x54f6('0x2f')](_0x20167b);_0xf0988=JSON[a26_0x54f6('0x30')](JSON['stringify'](_0xf0988));_0x5ee486[a26_0x54f6('0x31')]=_0xf0988;}this['httpClientService'][a26_0x54f6('0x32')](_0x225f03,_0x5ee486,![])[a26_0x54f6('0x33')](function(_0x2de02e){if(_0x2de02e[a26_0x54f6('0x34')]){}}[a26_0x54f6('0x1b')](this))[a26_0x54f6('0x35')](function(_0x54b5a6){console[a26_0x54f6('0x14')](a26_0x54f6('0x36'));});}}else{}}[a26_0x54f6('0x1a')](){const _0xfcdfe3=this[a26_0x54f6('0x23')]+a26_0x54f6('0x37')+this[a26_0x54f6('0xd')];this['httpClientService']['get'](_0xfcdfe3,![])['then'](function(_0x42d275){if(_0x42d275[a26_0x54f6('0x34')]){if(_0x42d275[a26_0x54f6('0x38')]&&_0x42d275[a26_0x54f6('0x38')][a26_0x54f6('0x1d')]>0x0&&_0x42d275[a26_0x54f6('0x38')][0x0][a26_0x54f6('0x31')]){this[a26_0x54f6('0x39')](_0x42d275['data'][0x0]);}}}[a26_0x54f6('0x1b')](this))[a26_0x54f6('0x35')](function(_0x2a4687){console[a26_0x54f6('0x14')](_0x2a4687);});}[a26_0x54f6('0x39')](_0x27e9b7){let _0x6ca11e='';const _0x278aa5=_0x27e9b7[a26_0x54f6('0x31')][a26_0x54f6('0x2b')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x27e9b7[a26_0x54f6('0x31')][a26_0x54f6('0x3a')](/^data:image\/png;base64,/,'')){_0x6ca11e=a26_0x54f6('0x3b');}else if(_0x27e9b7[a26_0x54f6('0x31')][a26_0x54f6('0x3a')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x6ca11e=a26_0x54f6('0x3c');}fsExtra[a26_0x54f6('0x3d')](this[a26_0x54f6('0x9')]);const _0x5b7530=this[a26_0x54f6('0x9')]+a26_0x54f6('0x3e')+_0x6ca11e;const _0x18b81b=this[a26_0x54f6('0x9')]+a26_0x54f6('0x3f');fsExtra['writeFile'](_0x5b7530,_0x278aa5,a26_0x54f6('0x40'),function(_0x49ed9f){});fsExtra['writeFile'](_0x18b81b,_0x27e9b7[a26_0x54f6('0x41')],function(_0x330c1e){});}['setCurrentDriverImage'](){const _0x542493=new Date();const _0x10fbda=_0x542493[a26_0x54f6('0x42')]()-currentDriverImageDate['getTime']();if(_0x10fbda>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x54f6('0x43')](process[a26_0x54f6('0xb')]['VIDEO_SERVICE_FILES_FOLDER']+'status.json','{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x4872b0){console['log']('Video\x20service\x20restarted');if(_0x4872b0){return console['log'](_0x4872b0);}});}else{extract(this[a26_0x54f6('0x44')],(_0x17e9c7,_0x2b68e2)=>{try{if(!_0x17e9c7){const _0x5dbdc8=process[a26_0x54f6('0xb')]['FILES_FOLDER'];fsExtra[a26_0x54f6('0x3d')](_0x5dbdc8);const _0x2b5237=_0x5dbdc8+a26_0x54f6('0x45');const _0xb2ee7b=_0x5dbdc8+a26_0x54f6('0x29');fsExtra[a26_0x54f6('0x46')](_0x2b5237,_0x2b68e2);if(!isCorrupted(_0x2b5237)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x54f6('0x14')](a26_0x54f6('0x47'),!![],new Date());fsExtra[a26_0x54f6('0x48')](_0x2b5237,_0xb2ee7b);}else{corruptedCounter++;console['log'](a26_0x54f6('0x49'),corruptedCounter);const _0x124c8b=new Date();const _0x219817=_0x124c8b[a26_0x54f6('0x42')]();fsExtra['copy'](_0x2b5237,_0x5dbdc8+_0x219817[a26_0x54f6('0x21')]()+a26_0x54f6('0x4a'));}}else{console[a26_0x54f6('0x4b')]('extract',_0x17e9c7);}}catch(_0x1cf7ba){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;