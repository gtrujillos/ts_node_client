var a26_0x583e=['../modules/jpeg-extract','fs-extra','is-corrupted-jpeg','jimp','child_process','url','http://localhost:60/index1.jpg','folder','env','apiURL','API_SERVICE_URL','vehicleId','eventResults','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','init2','init\x20SyncVehicleService\x20test22','image2.jpg','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','readFileSync','result','default','encrypt','eventTypeId','locationParts','current_driver.jpg','latitude','longitude','replace','speed','existsSync','base64Sync','parse','post','then','success','catch','route_schedules/get_by_vehicle/','get','data','image_data','saveImageFile','match','png','jpg','authorized_driver.','authorized_driver.txt','writeFile','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','FILES_FOLDER','current_driver_temp.jpg','writeFileSync','copy','.jpg','__importDefault','__esModule','defineProperty','../infrastructure/crypt-utils'];(function(_0x3fe94f,_0x18a9da){var _0x2891e1=function(_0x24b2f2){while(--_0x24b2f2){_0x3fe94f['push'](_0x3fe94f['shift']());}};_0x2891e1(++_0x18a9da);}(a26_0x583e,0x169));var a26_0x46c2=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a26_0x583e[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a26_0x46c2('0x0')]||function(_0x3733c6){return _0x3733c6&&_0x3733c6[a26_0x46c2('0x1')]?_0x3733c6:{'default':_0x3733c6};};Object[a26_0x46c2('0x2')](exports,a26_0x46c2('0x1'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x46c2('0x3')));const extract=require(a26_0x46c2('0x4'));const fsExtra=require(a26_0x46c2('0x5'));const base64Img=require('base64-img');const isCorrupted=require(a26_0x46c2('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x46c2('0x7'));const fork=require(a26_0x46c2('0x8'))['fork'];class SyncVehicleService{constructor(_0x167090){this[a26_0x46c2('0x9')]=a26_0x46c2('0xa');this[a26_0x46c2('0xb')]=process[a26_0x46c2('0xc')]['FILES_FOLDER'];this[a26_0x46c2('0xd')]=process[a26_0x46c2('0xc')][a26_0x46c2('0xe')];this[a26_0x46c2('0xf')]=process[a26_0x46c2('0xc')]['VEHICLE_ID'];this[a26_0x46c2('0x10')]=[{'file':'result_driver.txt','result':0x0},{'file':a26_0x46c2('0x11'),'result':0x0},{'file':a26_0x46c2('0x12'),'result':0x0}];this[a26_0x46c2('0x13')]=new HttpClientService_1[(a26_0x46c2('0x14'))]();this[a26_0x46c2('0x15')]=_0x167090;}[a26_0x46c2('0x16')](){console['log'](a26_0x46c2('0x17'));const _0x38698e=this[a26_0x46c2('0xb')]+'image1.jpg';const _0x3db118=this['folder']+a26_0x46c2('0x18');}[a26_0x46c2('0x19')](){console[a26_0x46c2('0x1a')](a26_0x46c2('0x1b'));this[a26_0x46c2('0x1c')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x46c2('0x1d')](this),0x2710);setInterval(function(){this[a26_0x46c2('0x1e')]();}['bind'](this),0x7d0);setInterval(function(){this[a26_0x46c2('0x1f')]();}['bind'](this),0x3e8);}['syncEvents'](){for(let _0x3a7265=0x0;_0x3a7265<this[a26_0x46c2('0x10')][a26_0x46c2('0x20')];_0x3a7265++){this['driverValidationEvents'](_0x3a7265);}}[a26_0x46c2('0x21')](_0x1f621d){const _0x50d2ca=this[a26_0x46c2('0x10')][_0x1f621d]['file'];const _0x429aa6=''+this['folder']+_0x50d2ca;if(fsExtra['existsSync'](_0x429aa6)){const _0x46e6ad=fsExtra[a26_0x46c2('0x22')](_0x429aa6)['toString']();if(this[a26_0x46c2('0x10')][_0x1f621d][a26_0x46c2('0x23')]!=_0x46e6ad){this[a26_0x46c2('0x10')][_0x1f621d][a26_0x46c2('0x23')]=_0x46e6ad;console[a26_0x46c2('0x1a')](a26_0x46c2('0x1f'),this['eventResults'][_0x1f621d][a26_0x46c2('0x23')],_0x46e6ad);const _0x11e32d=this['apiURL']+'events/report_event/';const _0x334cc0=crypt_utils_1[a26_0x46c2('0x24')][a26_0x46c2('0x25')](_0x46e6ad);console[a26_0x46c2('0x1a')](a26_0x46c2('0x26'),_0x334cc0);const _0x26ef26=this[a26_0x46c2('0x15')]?this[a26_0x46c2('0x15')][a26_0x46c2('0x27')]:{};const _0x1f9f72=this[a26_0x46c2('0xb')]+a26_0x46c2('0x28');let _0x1206b2=null;const _0x51970f={'event_type_id':_0x334cc0,'vehicle_id':this[a26_0x46c2('0xf')],'latitude':_0x26ef26[a26_0x46c2('0x29')]?_0x26ef26['latitude']['replace'](',','.'):0x0,'longitude':_0x26ef26[a26_0x46c2('0x2a')]?_0x26ef26['longitude'][a26_0x46c2('0x2b')](',','.'):0x0,'speed':_0x26ef26[a26_0x46c2('0x2c')]?_0x26ef26[a26_0x46c2('0x2c')]:0x0,'reported_at':new Date(),'image_data':_0x1206b2};if(fsExtra[a26_0x46c2('0x2d')](_0x1f9f72)){_0x1206b2=base64Img[a26_0x46c2('0x2e')](_0x1f9f72);_0x1206b2=JSON[a26_0x46c2('0x2f')](JSON['stringify'](_0x1206b2));_0x51970f['image_data']=_0x1206b2;}this[a26_0x46c2('0x13')][a26_0x46c2('0x30')](_0x11e32d,_0x51970f,![])[a26_0x46c2('0x31')](function(_0xab7d5){if(_0xab7d5[a26_0x46c2('0x32')]){}}[a26_0x46c2('0x1d')](this))[a26_0x46c2('0x33')](function(_0x2994d7){console[a26_0x46c2('0x1a')]('err');});}}else{}}[a26_0x46c2('0x1c')](){const _0x46b05b=this['apiURL']+a26_0x46c2('0x34')+this['vehicleId'];this[a26_0x46c2('0x13')][a26_0x46c2('0x35')](_0x46b05b,![])[a26_0x46c2('0x31')](function(_0x499214){if(_0x499214[a26_0x46c2('0x32')]){if(_0x499214[a26_0x46c2('0x36')]&&_0x499214[a26_0x46c2('0x36')][a26_0x46c2('0x20')]>0x0&&_0x499214[a26_0x46c2('0x36')][0x0][a26_0x46c2('0x37')]){this[a26_0x46c2('0x38')](_0x499214[a26_0x46c2('0x36')][0x0]);}}}[a26_0x46c2('0x1d')](this))[a26_0x46c2('0x33')](function(_0x3e049c){console[a26_0x46c2('0x1a')](_0x3e049c);});}[a26_0x46c2('0x38')](_0x7f81ff){let _0x261bfb='';const _0x568f9d=_0x7f81ff['image_data']['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x7f81ff[a26_0x46c2('0x37')][a26_0x46c2('0x39')](/^data:image\/png;base64,/,'')){_0x261bfb=a26_0x46c2('0x3a');}else if(_0x7f81ff[a26_0x46c2('0x37')][a26_0x46c2('0x39')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x261bfb=a26_0x46c2('0x3b');}fsExtra['ensureDirSync'](this[a26_0x46c2('0xb')]);const _0x4c7fb5=this[a26_0x46c2('0xb')]+a26_0x46c2('0x3c')+_0x261bfb;const _0x4da997=this[a26_0x46c2('0xb')]+a26_0x46c2('0x3d');fsExtra[a26_0x46c2('0x3e')](_0x4c7fb5,_0x568f9d,'base64',function(_0x287270){});fsExtra[a26_0x46c2('0x3e')](_0x4da997,_0x7f81ff[a26_0x46c2('0x3f')],function(_0x346007){});}[a26_0x46c2('0x1e')](){const _0x543929=new Date();const _0x894d5e=_0x543929[a26_0x46c2('0x40')]()-currentDriverImageDate[a26_0x46c2('0x40')]();if(_0x894d5e>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x46c2('0xc')][a26_0x46c2('0x41')]+a26_0x46c2('0x42'),a26_0x46c2('0x43')+currentDriverImageDate+'\x22}',function(_0x2b19dd){console['log']('Video\x20service\x20restarted');if(_0x2b19dd){return console[a26_0x46c2('0x1a')](_0x2b19dd);}});}else{extract(this['url'],(_0x90905c,_0x595fb6)=>{try{if(!_0x90905c){const _0x247530=process[a26_0x46c2('0xc')][a26_0x46c2('0x44')];fsExtra['ensureDirSync'](_0x247530);const _0x177df5=_0x247530+a26_0x46c2('0x45');const _0x1adfc9=_0x247530+'current_driver.jpg';fsExtra[a26_0x46c2('0x46')](_0x177df5,_0x595fb6);if(!isCorrupted(_0x177df5)){corruptedCounter=0x0;currentDriverImageDate=new Date();console['log'](a26_0x46c2('0x1e'),!![],new Date());fsExtra[a26_0x46c2('0x47')](_0x177df5,_0x1adfc9);}else{corruptedCounter++;console['log']('setCurrentDriverImage\x20corruptedCounter\x20********************:\x20',corruptedCounter);const _0x43b376=new Date();const _0x2686bf=_0x43b376[a26_0x46c2('0x40')]();fsExtra['copy'](_0x177df5,_0x247530+_0x2686bf['toString']()+a26_0x46c2('0x48'));}}else{console['error']('extract',_0x90905c);}}catch(_0x359b13){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;