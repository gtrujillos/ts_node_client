var a27_0x2322=['result_driver.txt','existsSync','readFileSync','toString','events/report_event/','Send\x20event','driverResult','default','eventTypeId','locationParts','current_driver.jpg','stringify','latitude','longitude','speed','post','then','success','route_schedules/get_by_vehicle/','httpClientService','get','data','length','image_data','saveImageFile','catch','replace','match','png','jpg','ensureDirSync','authorized_driver.txt','writeFile','user_id','writeFileSync','kill','SyncVehicleService','__importDefault','defineProperty','__esModule','../infrastructure/crypt-utils','jpeg-extract','fs-extra','base64-img','fork','url','http://localhost:60/index1.jpg','currentDriverResult','folder','env','FILES_FOLDER','apiURL','vehicleId','HttpClientService','gpsService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents'];(function(_0x2bd9d8,_0x3be435){var _0xb90153=function(_0x22105f){while(--_0x22105f){_0x2bd9d8['push'](_0x2bd9d8['shift']());}};_0xb90153(++_0x3be435);}(a27_0x2322,0x11d));var a27_0x568b=function(_0x2699a9,_0x501e82){_0x2699a9=_0x2699a9-0x0;var _0x5b6c40=a27_0x2322[_0x2699a9];return _0x5b6c40;};'use strict';var __importDefault=this&&this[a27_0x568b('0x0')]||function(_0x209195){return _0x209195&&_0x209195['__esModule']?_0x209195:{'default':_0x209195};};Object[a27_0x568b('0x1')](exports,a27_0x568b('0x2'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a27_0x568b('0x3')));const extract=require(a27_0x568b('0x4'));const fsExtra=require(a27_0x568b('0x5'));const base64Img=require(a27_0x568b('0x6'));const fork=require('child_process')[a27_0x568b('0x7')];let child;class SyncVehicleService{constructor(_0x33fec4){this[a27_0x568b('0x8')]=a27_0x568b('0x9');this[a27_0x568b('0xa')]=null;this[a27_0x568b('0xb')]=process[a27_0x568b('0xc')][a27_0x568b('0xd')];this[a27_0x568b('0xe')]=process[a27_0x568b('0xc')]['API_SERVICE_URL'];this[a27_0x568b('0xf')]=process[a27_0x568b('0xc')]['VEHICLE_ID'];this['httpClientService']=new HttpClientService_1[(a27_0x568b('0x10'))]();this[a27_0x568b('0x11')]=_0x33fec4;}[a27_0x568b('0x12')](){console[a27_0x568b('0x13')](a27_0x568b('0x14'));this[a27_0x568b('0x15')]();setInterval(function(){this['loadAuthorizedDriver']();}[a27_0x568b('0x16')](this),0x2710);setInterval(function(){this[a27_0x568b('0x17')]();}['bind'](this),0x3e8);setInterval(function(){this[a27_0x568b('0x18')]();}[a27_0x568b('0x16')](this),0x3e8);}[a27_0x568b('0x18')](){const _0x9fd468=this[a27_0x568b('0xb')]+a27_0x568b('0x19');if(fsExtra[a27_0x568b('0x1a')](_0x9fd468)){const _0x51ce76=fsExtra[a27_0x568b('0x1b')](_0x9fd468)[a27_0x568b('0x1c')]();if(this[a27_0x568b('0xa')]!=_0x51ce76){this[a27_0x568b('0xa')]=_0x51ce76;const _0x2dde73=this['apiURL']+a27_0x568b('0x1d');console['log'](a27_0x568b('0x1e'),_0x2dde73);console[a27_0x568b('0x13')](a27_0x568b('0x1f'),_0x51ce76);const _0x2e0898=crypt_utils_1[a27_0x568b('0x20')]['encrypt'](_0x51ce76);console['log'](a27_0x568b('0x21'),_0x2e0898);const _0x4c7286=this[a27_0x568b('0x11')]?this[a27_0x568b('0x11')][a27_0x568b('0x22')]:{};const _0x425db1=this['folder']+a27_0x568b('0x23');let _0x159353=null;if(fsExtra['existsSync'](_0x425db1)){_0x159353=base64Img['base64Sync'](_0x425db1);_0x159353=JSON['parse'](JSON[a27_0x568b('0x24')](_0x159353));_0x159353=_0x159353;}const _0x1bd939={'event_type_id':_0x2e0898,'vehicle_id':this[a27_0x568b('0xf')],'latitude':_0x4c7286[a27_0x568b('0x25')]?_0x4c7286[a27_0x568b('0x25')]:0x0,'longitude':_0x4c7286[a27_0x568b('0x26')]?_0x4c7286[a27_0x568b('0x26')]:0x0,'speed':_0x4c7286[a27_0x568b('0x27')]?_0x4c7286['speed']:0x0,'reported_at':new Date(),'image_data':_0x159353};this['httpClientService'][a27_0x568b('0x28')](_0x2dde73,_0x1bd939,![])[a27_0x568b('0x29')](function(_0x23fc1a){if(_0x23fc1a[a27_0x568b('0x2a')]){}}[a27_0x568b('0x16')](this))['catch'](function(_0x19e95e){console[a27_0x568b('0x13')](_0x19e95e);});}}}['loadAuthorizedDriver'](){console[a27_0x568b('0x13')]('loadAuthorizedDriver');const _0x3d15f7=this['apiURL']+a27_0x568b('0x2b')+this[a27_0x568b('0xf')];console[a27_0x568b('0x13')](a27_0x568b('0x15'),_0x3d15f7);this[a27_0x568b('0x2c')][a27_0x568b('0x2d')](_0x3d15f7,![])['then'](function(_0x274da5){if(_0x274da5[a27_0x568b('0x2a')]){if(_0x274da5[a27_0x568b('0x2e')]&&_0x274da5[a27_0x568b('0x2e')][a27_0x568b('0x2f')]>0x0&&_0x274da5[a27_0x568b('0x2e')][0x0][a27_0x568b('0x30')]){this[a27_0x568b('0x31')](_0x274da5[a27_0x568b('0x2e')][0x0]);}}}['bind'](this))[a27_0x568b('0x32')](function(_0x376201){console[a27_0x568b('0x13')](_0x376201);});}['saveImageFile'](_0x1cb5f3){let _0x2b6dd2='';const _0x4f5059=_0x1cb5f3[a27_0x568b('0x30')][a27_0x568b('0x33')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x1cb5f3[a27_0x568b('0x30')][a27_0x568b('0x34')](/^data:image\/png;base64,/,'')){_0x2b6dd2=a27_0x568b('0x35');}else if(_0x1cb5f3[a27_0x568b('0x30')][a27_0x568b('0x34')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x2b6dd2=a27_0x568b('0x36');}fsExtra[a27_0x568b('0x37')](this['folder']);const _0x13ac85=this[a27_0x568b('0xb')]+'authorized_driver.'+_0x2b6dd2;const _0x3e1246=this['folder']+a27_0x568b('0x38');fsExtra['writeFile'](_0x13ac85,_0x4f5059,'base64',function(_0x22e67e){});fsExtra[a27_0x568b('0x39')](_0x3e1246,_0x1cb5f3[a27_0x568b('0x3a')],function(_0x4e38cc){});}[a27_0x568b('0x17')](){console[a27_0x568b('0x13')]('setCurrentDriverImage');extract(this[a27_0x568b('0x8')])[a27_0x568b('0x29')](_0x4efc4c=>{const _0x5b64e4=process[a27_0x568b('0xc')][a27_0x568b('0xd')];fsExtra[a27_0x568b('0x37')](_0x5b64e4);const _0x4877ac=_0x5b64e4+a27_0x568b('0x23');fsExtra[a27_0x568b('0x3b')](_0x4877ac,_0x4efc4c);})[a27_0x568b('0x32')](_0x4b6808=>{console['error'](_0x4b6808);if(child!=null){child[a27_0x568b('0x3c')]();child=null;}});}}exports[a27_0x568b('0x3d')]=SyncVehicleService;