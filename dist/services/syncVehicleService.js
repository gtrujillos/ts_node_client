var a26_0x4e66=['writeFile','base64','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','toString','error','SyncVehicleService','__importDefault','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','base64-img','is-corrupted-jpeg','child_process','fork','url','folder','env','FILES_FOLDER','vehicleId','VEHICLE_ID','eventResults','result_driver.txt','result_driver_behaviour.txt','httpClientService','init2','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','log','init\x20SyncVehicleService','bind','setCurrentDriverImage','syncEvents','length','file','result','default','encrypt','eventTypeId','gpsService','locationParts','current_driver.jpg','latitude','replace','longitude','speed','base64Sync','parse','stringify','then','success','err','loadAuthorizedDriver','apiURL','route_schedules/get_by_vehicle/','get','data','catch','image_data','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt'];(function(_0x24b6d5,_0x20a366){var _0x4a02e0=function(_0x368650){while(--_0x368650){_0x24b6d5['push'](_0x24b6d5['shift']());}};_0x4a02e0(++_0x20a366);}(a26_0x4e66,0x132));var a26_0x3a6a=function(_0x9e1dd6,_0x2da0f4){_0x9e1dd6=_0x9e1dd6-0x0;var _0x269c8b=a26_0x4e66[_0x9e1dd6];return _0x269c8b;};'use strict';var __importDefault=this&&this[a26_0x3a6a('0x0')]||function(_0x5e48ea){return _0x5e48ea&&_0x5e48ea['__esModule']?_0x5e48ea:{'default':_0x5e48ea};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a26_0x3a6a('0x1'));const crypt_utils_1=__importDefault(require(a26_0x3a6a('0x2')));const extract=require(a26_0x3a6a('0x3'));const fsExtra=require('fs-extra');const base64Img=require(a26_0x3a6a('0x4'));const isCorrupted=require(a26_0x3a6a('0x5'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require('jimp');const fork=require(a26_0x3a6a('0x6'))[a26_0x3a6a('0x7')];class SyncVehicleService{constructor(_0x33e469){this[a26_0x3a6a('0x8')]='http://localhost:60/index1.jpg';this[a26_0x3a6a('0x9')]=process[a26_0x3a6a('0xa')][a26_0x3a6a('0xb')];this['apiURL']=process[a26_0x3a6a('0xa')]['API_SERVICE_URL'];this[a26_0x3a6a('0xc')]=process[a26_0x3a6a('0xa')][a26_0x3a6a('0xd')];this[a26_0x3a6a('0xe')]=[{'file':a26_0x3a6a('0xf'),'result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':a26_0x3a6a('0x10'),'result':0x0}];this[a26_0x3a6a('0x11')]=new HttpClientService_1['HttpClientService']();this['gpsService']=_0x33e469;}[a26_0x3a6a('0x12')](){console['log'](a26_0x3a6a('0x13'));const _0x3a5a13=this[a26_0x3a6a('0x9')]+a26_0x3a6a('0x14');const _0x9dea4=this[a26_0x3a6a('0x9')]+a26_0x3a6a('0x15');}[a26_0x3a6a('0x16')](){console[a26_0x3a6a('0x17')](a26_0x3a6a('0x18'));this['loadAuthorizedDriver']();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x3a6a('0x19')](this),0x2710);setInterval(function(){this[a26_0x3a6a('0x1a')]();}[a26_0x3a6a('0x19')](this),0x7d0);setInterval(function(){this[a26_0x3a6a('0x1b')]();}[a26_0x3a6a('0x19')](this),0x3e8);}[a26_0x3a6a('0x1b')](){for(let _0x374d99=0x0;_0x374d99<this['eventResults'][a26_0x3a6a('0x1c')];_0x374d99++){this['driverValidationEvents'](_0x374d99);}}['driverValidationEvents'](_0x182fc9){const _0x23d4db=this[a26_0x3a6a('0xe')][_0x182fc9][a26_0x3a6a('0x1d')];const _0x12efdb=''+this['folder']+_0x23d4db;if(fsExtra['existsSync'](_0x12efdb)){const _0x58b20c=fsExtra['readFileSync'](_0x12efdb)['toString']();if(this[a26_0x3a6a('0xe')][_0x182fc9]['result']!=_0x58b20c){this[a26_0x3a6a('0xe')][_0x182fc9][a26_0x3a6a('0x1e')]=_0x58b20c;console[a26_0x3a6a('0x17')]('syncEvents',this[a26_0x3a6a('0xe')][_0x182fc9][a26_0x3a6a('0x1e')],_0x58b20c);const _0x1a6fbc=this['apiURL']+'events/report_event/';const _0x496c15=crypt_utils_1[a26_0x3a6a('0x1f')][a26_0x3a6a('0x20')](_0x58b20c);console[a26_0x3a6a('0x17')](a26_0x3a6a('0x21'),_0x496c15);const _0xbbfe58=this[a26_0x3a6a('0x22')]?this[a26_0x3a6a('0x22')][a26_0x3a6a('0x23')]:{};const _0x3f9cf6=this['folder']+a26_0x3a6a('0x24');let _0x5c9bfe=null;const _0x155b64={'event_type_id':_0x496c15,'vehicle_id':this[a26_0x3a6a('0xc')],'latitude':_0xbbfe58[a26_0x3a6a('0x25')]?_0xbbfe58[a26_0x3a6a('0x25')][a26_0x3a6a('0x26')](',','.'):0x0,'longitude':_0xbbfe58[a26_0x3a6a('0x27')]?_0xbbfe58[a26_0x3a6a('0x27')][a26_0x3a6a('0x26')](',','.'):0x0,'speed':_0xbbfe58[a26_0x3a6a('0x28')]?_0xbbfe58[a26_0x3a6a('0x28')]:0x0,'reported_at':new Date(),'image_data':_0x5c9bfe};if(fsExtra['existsSync'](_0x3f9cf6)){_0x5c9bfe=base64Img[a26_0x3a6a('0x29')](_0x3f9cf6);_0x5c9bfe=JSON[a26_0x3a6a('0x2a')](JSON[a26_0x3a6a('0x2b')](_0x5c9bfe));_0x155b64['image_data']=_0x5c9bfe;}this[a26_0x3a6a('0x11')]['post'](_0x1a6fbc,_0x155b64,![])[a26_0x3a6a('0x2c')](function(_0x4ed088){if(_0x4ed088[a26_0x3a6a('0x2d')]){}}[a26_0x3a6a('0x19')](this))['catch'](function(_0x492596){console[a26_0x3a6a('0x17')](a26_0x3a6a('0x2e'));});}}else{}}[a26_0x3a6a('0x2f')](){const _0x7872a7=this[a26_0x3a6a('0x30')]+a26_0x3a6a('0x31')+this['vehicleId'];this[a26_0x3a6a('0x11')][a26_0x3a6a('0x32')](_0x7872a7,![])[a26_0x3a6a('0x2c')](function(_0x5bc4ca){if(_0x5bc4ca['success']){if(_0x5bc4ca['data']&&_0x5bc4ca[a26_0x3a6a('0x33')]['length']>0x0&&_0x5bc4ca['data'][0x0]['image_data']){this['saveImageFile'](_0x5bc4ca[a26_0x3a6a('0x33')][0x0]);}}}['bind'](this))[a26_0x3a6a('0x34')](function(_0x171a89){console[a26_0x3a6a('0x17')](_0x171a89);});}['saveImageFile'](_0x29f770){let _0x354b41='';const _0x4a8374=_0x29f770['image_data'][a26_0x3a6a('0x26')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x29f770[a26_0x3a6a('0x35')][a26_0x3a6a('0x36')](/^data:image\/png;base64,/,'')){_0x354b41='png';}else if(_0x29f770[a26_0x3a6a('0x35')][a26_0x3a6a('0x36')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x354b41=a26_0x3a6a('0x37');}fsExtra[a26_0x3a6a('0x38')](this['folder']);const _0x5545c1=this[a26_0x3a6a('0x9')]+a26_0x3a6a('0x39')+_0x354b41;const _0x2f16b8=this[a26_0x3a6a('0x9')]+a26_0x3a6a('0x3a');fsExtra[a26_0x3a6a('0x3b')](_0x5545c1,_0x4a8374,a26_0x3a6a('0x3c'),function(_0x508ba9){});fsExtra[a26_0x3a6a('0x3b')](_0x2f16b8,_0x29f770[a26_0x3a6a('0x3d')],function(_0x11b03d){});}['setCurrentDriverImage'](){const _0x506701=new Date();const _0x3d0a90=_0x506701[a26_0x3a6a('0x3e')]()-currentDriverImageDate['getTime']();if(_0x3d0a90>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x3a6a('0x3b')](process['env'][a26_0x3a6a('0x3f')]+'status.json',a26_0x3a6a('0x40')+currentDriverImageDate+'\x22}',function(_0x50dd0c){console[a26_0x3a6a('0x17')](a26_0x3a6a('0x41'));if(_0x50dd0c){return console[a26_0x3a6a('0x17')](_0x50dd0c);}});}else{extract(this[a26_0x3a6a('0x8')],(_0x235947,_0x3f9603)=>{try{if(!_0x235947){const _0x1a9c03=process['env'][a26_0x3a6a('0xb')];fsExtra[a26_0x3a6a('0x38')](_0x1a9c03);const _0x4ac6cb=_0x1a9c03+a26_0x3a6a('0x42');const _0x1a5903=_0x1a9c03+a26_0x3a6a('0x24');fsExtra[a26_0x3a6a('0x43')](_0x4ac6cb,_0x3f9603);if(!isCorrupted(_0x4ac6cb)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x3a6a('0x17')](a26_0x3a6a('0x1a'),!![],new Date());fsExtra[a26_0x3a6a('0x44')](_0x4ac6cb,_0x1a5903);}else{corruptedCounter++;console[a26_0x3a6a('0x17')](a26_0x3a6a('0x45'),corruptedCounter);const _0x5a9bb1=new Date();const _0x81c15d=_0x5a9bb1[a26_0x3a6a('0x3e')]();fsExtra[a26_0x3a6a('0x44')](_0x4ac6cb,_0x1a9c03+_0x81c15d[a26_0x3a6a('0x46')]()+'.jpg');}}else{console[a26_0x3a6a('0x47')]('extract',_0x235947);}}catch(_0x59290b){}finally{}});}}}exports[a26_0x3a6a('0x48')]=SyncVehicleService;