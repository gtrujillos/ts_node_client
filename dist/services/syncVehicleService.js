var a26_0x3093=['__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','is-corrupted-jpeg','jimp','child_process','fork','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','eventResults','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','gpsService','init2','log','image1.jpg','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','file','toString','result','events/report_event/','default','encrypt','eventTypeId','locationParts','current_driver.jpg','latitude','replace','longitude','speed','base64Sync','parse','stringify','post','then','catch','route_schedules/get_by_vehicle/','get','success','data','image_data','saveImageFile','match','png','authorized_driver.txt','getTime','ensureDirSync','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','.jpg'];(function(_0x52e88b,_0x40d3f2){var _0x3e5a6b=function(_0x36a298){while(--_0x36a298){_0x52e88b['push'](_0x52e88b['shift']());}};_0x3e5a6b(++_0x40d3f2);}(a26_0x3093,0x118));var a26_0x29b6=function(_0x911c97,_0x57f850){_0x911c97=_0x911c97-0x0;var _0x2a2647=a26_0x3093[_0x911c97];return _0x2a2647;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1c727b){return _0x1c727b&&_0x1c727b[a26_0x29b6('0x0')]?_0x1c727b:{'default':_0x1c727b};};Object['defineProperty'](exports,a26_0x29b6('0x0'),{'value':!![]});const HttpClientService_1=require(a26_0x29b6('0x1'));const crypt_utils_1=__importDefault(require(a26_0x29b6('0x2')));const extract=require(a26_0x29b6('0x3'));const fsExtra=require(a26_0x29b6('0x4'));const base64Img=require(a26_0x29b6('0x5'));const isCorrupted=require(a26_0x29b6('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x29b6('0x7'));const fork=require(a26_0x29b6('0x8'))[a26_0x29b6('0x9')];class SyncVehicleService{constructor(_0x39641d){this['urlVideo']=a26_0x29b6('0xa');this[a26_0x29b6('0xb')]=process[a26_0x29b6('0xc')][a26_0x29b6('0xd')];this[a26_0x29b6('0xe')]=process[a26_0x29b6('0xc')][a26_0x29b6('0xf')];this[a26_0x29b6('0x10')]=process[a26_0x29b6('0xc')][a26_0x29b6('0x11')];this[a26_0x29b6('0x12')]=[{'file':'result_driver.txt','result':0x0},{'file':a26_0x29b6('0x13'),'result':0x0},{'file':a26_0x29b6('0x14'),'result':0x0}];this[a26_0x29b6('0x15')]=new HttpClientService_1['HttpClientService']();this[a26_0x29b6('0x16')]=_0x39641d;}[a26_0x29b6('0x17')](){console[a26_0x29b6('0x18')]('init\x20SyncVehicleService\x20test22');const _0x22fd40=this['folder']+a26_0x29b6('0x19');const _0x192526=this[a26_0x29b6('0xb')]+a26_0x29b6('0x1a');}[a26_0x29b6('0x1b')](){console[a26_0x29b6('0x18')](a26_0x29b6('0x1c'));this[a26_0x29b6('0x1d')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x29b6('0x1e')](this),0x2710);setInterval(function(){this[a26_0x29b6('0x1f')]();}[a26_0x29b6('0x1e')](this),0x7d0);setInterval(function(){this[a26_0x29b6('0x20')]();}[a26_0x29b6('0x1e')](this),0x3e8);}[a26_0x29b6('0x20')](){for(let _0x1d34ea=0x0;_0x1d34ea<this[a26_0x29b6('0x12')][a26_0x29b6('0x21')];_0x1d34ea++){this[a26_0x29b6('0x22')](_0x1d34ea);}}[a26_0x29b6('0x22')](_0x4ee309){const _0x35b4d1=this[a26_0x29b6('0x12')][_0x4ee309][a26_0x29b6('0x23')];const _0x296471=''+this['folder']+_0x35b4d1;if(fsExtra['existsSync'](_0x296471)){const _0x2510f9=fsExtra['readFileSync'](_0x296471)[a26_0x29b6('0x24')]();if(this[a26_0x29b6('0x12')][_0x4ee309]['result']!=_0x2510f9){this[a26_0x29b6('0x12')][_0x4ee309][a26_0x29b6('0x25')]=_0x2510f9;console[a26_0x29b6('0x18')](a26_0x29b6('0x20'),this[a26_0x29b6('0x12')][_0x4ee309]['result'],_0x2510f9);const _0x18a7d5=this['apiURL']+a26_0x29b6('0x26');const _0x5d0cdb=crypt_utils_1[a26_0x29b6('0x27')][a26_0x29b6('0x28')](_0x2510f9);console[a26_0x29b6('0x18')](a26_0x29b6('0x29'),_0x5d0cdb);const _0x44cfb1=this['gpsService']?this[a26_0x29b6('0x16')][a26_0x29b6('0x2a')]:{};const _0x301167=this[a26_0x29b6('0xb')]+a26_0x29b6('0x2b');let _0x2ba853=null;const _0x569ef9={'event_type_id':_0x5d0cdb,'vehicle_id':this[a26_0x29b6('0x10')],'latitude':_0x44cfb1[a26_0x29b6('0x2c')]?_0x44cfb1[a26_0x29b6('0x2c')][a26_0x29b6('0x2d')](',','.'):0x0,'longitude':_0x44cfb1[a26_0x29b6('0x2e')]?_0x44cfb1[a26_0x29b6('0x2e')]['replace'](',','.'):0x0,'speed':_0x44cfb1[a26_0x29b6('0x2f')]?_0x44cfb1['speed']:0x0,'reported_at':new Date(),'image_data':_0x2ba853};if(fsExtra['existsSync'](_0x301167)){_0x2ba853=base64Img[a26_0x29b6('0x30')](_0x301167);_0x2ba853=JSON[a26_0x29b6('0x31')](JSON[a26_0x29b6('0x32')](_0x2ba853));_0x569ef9['image_data']=_0x2ba853;}this['httpClientService'][a26_0x29b6('0x33')](_0x18a7d5,_0x569ef9,![])[a26_0x29b6('0x34')](function(_0x45e63f){if(_0x45e63f['success']){}}[a26_0x29b6('0x1e')](this))[a26_0x29b6('0x35')](function(_0xc40ef1){console['log']('err');});}}else{}}[a26_0x29b6('0x1d')](){const _0x55f98c=this[a26_0x29b6('0xe')]+a26_0x29b6('0x36')+this[a26_0x29b6('0x10')];this[a26_0x29b6('0x15')][a26_0x29b6('0x37')](_0x55f98c,![])['then'](function(_0x54e47e){if(_0x54e47e[a26_0x29b6('0x38')]){if(_0x54e47e['data']&&_0x54e47e[a26_0x29b6('0x39')][a26_0x29b6('0x21')]>0x0&&_0x54e47e[a26_0x29b6('0x39')][0x0][a26_0x29b6('0x3a')]){this['saveImageFile'](_0x54e47e[a26_0x29b6('0x39')][0x0]);}}}[a26_0x29b6('0x1e')](this))['catch'](function(_0x37f556){console['log'](_0x37f556);});}[a26_0x29b6('0x3b')](_0x211de6){let _0x335c1f='';const _0x5316d4=_0x211de6[a26_0x29b6('0x3a')]['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x211de6[a26_0x29b6('0x3a')][a26_0x29b6('0x3c')](/^data:image\/png;base64,/,'')){_0x335c1f=a26_0x29b6('0x3d');}else if(_0x211de6[a26_0x29b6('0x3a')][a26_0x29b6('0x3c')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x335c1f='jpg';}fsExtra['ensureDirSync'](this['folder']);const _0x5e4963=this[a26_0x29b6('0xb')]+'authorized_driver.'+_0x335c1f;const _0x4e8853=this['folder']+a26_0x29b6('0x3e');fsExtra['writeFile'](_0x5e4963,_0x5316d4,'base64',function(_0x4c6337){});fsExtra['writeFile'](_0x4e8853,_0x211de6['user_id'],function(_0x44b528){});}[a26_0x29b6('0x1f')](){const _0x2c79ba=new Date();const _0x9ac732=_0x2c79ba['getTime']()-currentDriverImageDate[a26_0x29b6('0x3f')]();extract(this['urlVideo'],(_0x19e4ba,_0x2ee68c)=>{try{if(!_0x19e4ba){const _0x33b021=process['env'][a26_0x29b6('0xd')];fsExtra[a26_0x29b6('0x40')](_0x33b021);const _0x4b2303=_0x33b021+a26_0x29b6('0x41');const _0x15805c=_0x33b021+a26_0x29b6('0x2b');fsExtra[a26_0x29b6('0x42')](_0x4b2303,_0x2ee68c);if(!isCorrupted(_0x4b2303)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a26_0x29b6('0x43')](_0x4b2303,_0x15805c);}else{corruptedCounter++;console[a26_0x29b6('0x18')](a26_0x29b6('0x44'),corruptedCounter);const _0x20eeeb=new Date();const _0xf69cbb=_0x20eeeb['getTime']();fsExtra[a26_0x29b6('0x43')](_0x4b2303,_0x33b021+_0xf69cbb[a26_0x29b6('0x24')]()+a26_0x29b6('0x45'));}}else{}}catch(_0x1abd01){}finally{}});}}exports['SyncVehicleService']=SyncVehicleService;