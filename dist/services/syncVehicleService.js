var a26_0x264b=['__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','is-corrupted-jpeg','jimp','child_process','fork','url','http://localhost:60/index1.jpg','folder','FILES_FOLDER','apiURL','env','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','gpsService','init2','image2.jpg','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','eventResults','length','driverValidationEvents','file','readFileSync','toString','result','log','events/report_event/','default','encrypt','locationParts','current_driver.jpg','vehicleId','latitude','replace','longitude','speed','existsSync','base64Sync','parse','stringify','image_data','httpClientService','then','success','catch','err','route_schedules/get_by_vehicle/','get','data','saveImageFile','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','getTime','VIDEO_SERVICE_FILES_FOLDER','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','.jpg','error','extract','SyncVehicleService'];(function(_0x57d068,_0xbc2e25){var _0x3ed085=function(_0x2a9593){while(--_0x2a9593){_0x57d068['push'](_0x57d068['shift']());}};_0x3ed085(++_0xbc2e25);}(a26_0x264b,0xa2));var a26_0x2517=function(_0x4fe773,_0x5dc564){_0x4fe773=_0x4fe773-0x0;var _0x1f3868=a26_0x264b[_0x4fe773];return _0x1f3868;};'use strict';var __importDefault=this&&this[a26_0x2517('0x0')]||function(_0x52100a){return _0x52100a&&_0x52100a[a26_0x2517('0x1')]?_0x52100a:{'default':_0x52100a};};Object[a26_0x2517('0x2')](exports,a26_0x2517('0x1'),{'value':!![]});const HttpClientService_1=require(a26_0x2517('0x3'));const crypt_utils_1=__importDefault(require(a26_0x2517('0x4')));const extract=require(a26_0x2517('0x5'));const fsExtra=require(a26_0x2517('0x6'));const base64Img=require(a26_0x2517('0x7'));const isCorrupted=require(a26_0x2517('0x8'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x2517('0x9'));const fork=require(a26_0x2517('0xa'))[a26_0x2517('0xb')];class SyncVehicleService{constructor(_0x7ceaaf){this[a26_0x2517('0xc')]=a26_0x2517('0xd');this[a26_0x2517('0xe')]=process['env'][a26_0x2517('0xf')];this[a26_0x2517('0x10')]=process[a26_0x2517('0x11')]['API_SERVICE_URL'];this['vehicleId']=process[a26_0x2517('0x11')]['VEHICLE_ID'];this['eventResults']=[{'file':a26_0x2517('0x12'),'result':0x0},{'file':a26_0x2517('0x13'),'result':0x0},{'file':a26_0x2517('0x14'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x2517('0x15'))]();this[a26_0x2517('0x16')]=_0x7ceaaf;}[a26_0x2517('0x17')](){console['log']('init\x20SyncVehicleService\x20test22');const _0x52d0d0=this[a26_0x2517('0xe')]+'image1.jpg';const _0x3e5833=this[a26_0x2517('0xe')]+a26_0x2517('0x18');}['init'](){console['log'](a26_0x2517('0x19'));this[a26_0x2517('0x1a')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x2517('0x1b')](this),0x2710);setInterval(function(){this[a26_0x2517('0x1c')]();}[a26_0x2517('0x1b')](this),0x7d0);setInterval(function(){this[a26_0x2517('0x1d')]();}[a26_0x2517('0x1b')](this),0x3e8);}['syncEvents'](){for(let _0x3f9f2d=0x0;_0x3f9f2d<this[a26_0x2517('0x1e')][a26_0x2517('0x1f')];_0x3f9f2d++){this[a26_0x2517('0x20')](_0x3f9f2d);}}[a26_0x2517('0x20')](_0x41e990){const _0x18f1bc=this[a26_0x2517('0x1e')][_0x41e990][a26_0x2517('0x21')];const _0x1b4205=''+this[a26_0x2517('0xe')]+_0x18f1bc;if(fsExtra['existsSync'](_0x1b4205)){const _0x176b48=fsExtra[a26_0x2517('0x22')](_0x1b4205)[a26_0x2517('0x23')]();if(this[a26_0x2517('0x1e')][_0x41e990][a26_0x2517('0x24')]!=_0x176b48){this['eventResults'][_0x41e990]['result']=_0x176b48;console[a26_0x2517('0x25')]('syncEvents',this['eventResults'][_0x41e990]['result'],_0x176b48);const _0x160153=this[a26_0x2517('0x10')]+a26_0x2517('0x26');const _0x39de0c=crypt_utils_1[a26_0x2517('0x27')][a26_0x2517('0x28')](_0x176b48);console[a26_0x2517('0x25')]('eventTypeId',_0x39de0c);const _0x844007=this['gpsService']?this[a26_0x2517('0x16')][a26_0x2517('0x29')]:{};const _0x2da738=this[a26_0x2517('0xe')]+a26_0x2517('0x2a');let _0x24516d=null;const _0x3f619a={'event_type_id':_0x39de0c,'vehicle_id':this[a26_0x2517('0x2b')],'latitude':_0x844007[a26_0x2517('0x2c')]?_0x844007['latitude'][a26_0x2517('0x2d')](',','.'):0x0,'longitude':_0x844007[a26_0x2517('0x2e')]?_0x844007[a26_0x2517('0x2e')][a26_0x2517('0x2d')](',','.'):0x0,'speed':_0x844007[a26_0x2517('0x2f')]?_0x844007[a26_0x2517('0x2f')]:0x0,'reported_at':new Date(),'image_data':_0x24516d};if(fsExtra[a26_0x2517('0x30')](_0x2da738)){_0x24516d=base64Img[a26_0x2517('0x31')](_0x2da738);_0x24516d=JSON[a26_0x2517('0x32')](JSON[a26_0x2517('0x33')](_0x24516d));_0x3f619a[a26_0x2517('0x34')]=_0x24516d;}this[a26_0x2517('0x35')]['post'](_0x160153,_0x3f619a,![])[a26_0x2517('0x36')](function(_0x3d20d0){if(_0x3d20d0[a26_0x2517('0x37')]){}}[a26_0x2517('0x1b')](this))[a26_0x2517('0x38')](function(_0x54dec6){console[a26_0x2517('0x25')](a26_0x2517('0x39'));});}}else{}}[a26_0x2517('0x1a')](){const _0x1a3267=this[a26_0x2517('0x10')]+a26_0x2517('0x3a')+this[a26_0x2517('0x2b')];this[a26_0x2517('0x35')][a26_0x2517('0x3b')](_0x1a3267,![])[a26_0x2517('0x36')](function(_0x4c5ca8){if(_0x4c5ca8['success']){if(_0x4c5ca8[a26_0x2517('0x3c')]&&_0x4c5ca8[a26_0x2517('0x3c')][a26_0x2517('0x1f')]>0x0&&_0x4c5ca8[a26_0x2517('0x3c')][0x0]['image_data']){this[a26_0x2517('0x3d')](_0x4c5ca8[a26_0x2517('0x3c')][0x0]);}}}[a26_0x2517('0x1b')](this))[a26_0x2517('0x38')](function(_0xd1bdbd){console[a26_0x2517('0x25')](_0xd1bdbd);});}['saveImageFile'](_0x54785f){let _0x564dc3='';const _0x450c65=_0x54785f['image_data'][a26_0x2517('0x2d')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x54785f['image_data'][a26_0x2517('0x3e')](/^data:image\/png;base64,/,'')){_0x564dc3=a26_0x2517('0x3f');}else if(_0x54785f['image_data'][a26_0x2517('0x3e')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x564dc3=a26_0x2517('0x40');}fsExtra[a26_0x2517('0x41')](this[a26_0x2517('0xe')]);const _0x500055=this[a26_0x2517('0xe')]+a26_0x2517('0x42')+_0x564dc3;const _0x24efcd=this[a26_0x2517('0xe')]+a26_0x2517('0x43');fsExtra[a26_0x2517('0x44')](_0x500055,_0x450c65,a26_0x2517('0x45'),function(_0x28b05f){});fsExtra[a26_0x2517('0x44')](_0x24efcd,_0x54785f['user_id'],function(_0x52fe58){});}[a26_0x2517('0x1c')](){const _0x4817db=new Date();const _0x4b2a79=_0x4817db[a26_0x2517('0x46')]()-currentDriverImageDate[a26_0x2517('0x46')]();if(_0x4b2a79>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x2517('0x44')](process[a26_0x2517('0x11')][a26_0x2517('0x47')]+'status.json',a26_0x2517('0x48')+currentDriverImageDate+'\x22}',function(_0x288c4b){console[a26_0x2517('0x25')](a26_0x2517('0x49'));if(_0x288c4b){return console['log'](_0x288c4b);}});}else{extract(this[a26_0x2517('0xc')],(_0x5b2d75,_0x2d6d26)=>{try{if(!_0x5b2d75){const _0x826e02=process[a26_0x2517('0x11')][a26_0x2517('0xf')];fsExtra['ensureDirSync'](_0x826e02);const _0x23e86b=_0x826e02+a26_0x2517('0x4a');const _0x4c441d=_0x826e02+a26_0x2517('0x2a');fsExtra['writeFileSync'](_0x23e86b,_0x2d6d26);if(!isCorrupted(_0x23e86b)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x2517('0x25')](a26_0x2517('0x1c'),!![],new Date());fsExtra[a26_0x2517('0x4b')](_0x23e86b,_0x4c441d);}else{corruptedCounter++;console[a26_0x2517('0x25')](a26_0x2517('0x4c'),corruptedCounter);const _0x395703=new Date();const _0x223868=_0x395703[a26_0x2517('0x46')]();fsExtra['copy'](_0x23e86b,_0x826e02+_0x223868[a26_0x2517('0x23')]()+a26_0x2517('0x4d'));}}else{console[a26_0x2517('0x4e')](a26_0x2517('0x4f'),_0x5b2d75);}}catch(_0x5053c3){}finally{}});}}}exports[a26_0x2517('0x50')]=SyncVehicleService;