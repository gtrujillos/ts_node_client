var a27_0x4b20=['saveImageFile','png','match','jpg','ensureDirSync','authorized_driver.txt','writeFile','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','Video\x20service\x20restarted','current_driver_temp.jpg','writeFileSync','extract','SyncVehicleService','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','jpeg-extract','fs-extra','is-corrupted-jpeg','child_process','fork','url','http://localhost:60/index1.jpg','env','FILES_FOLDER','API_SERVICE_URL','vehicleId','VEHICLE_ID','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','setCurrentDriverImage','syncEvents','length','driverValidationEvents','folder','existsSync','readFileSync','eventResults','result','apiURL','events/report_event/','default','eventTypeId','gpsService','locationParts','current_driver.jpg','replace','longitude','speed','base64Sync','parse','stringify','httpClientService','post','success','bind','catch','err','route_schedules/get_by_vehicle/','then','data','image_data'];(function(_0x2f265a,_0xc6e1f0){var _0x2fffa2=function(_0x5bc7e0){while(--_0x5bc7e0){_0x2f265a['push'](_0x2f265a['shift']());}};_0x2fffa2(++_0xc6e1f0);}(a27_0x4b20,0x130));var a27_0x3906=function(_0x497635,_0x28c8cd){_0x497635=_0x497635-0x0;var _0x36d016=a27_0x4b20[_0x497635];return _0x36d016;};'use strict';var __importDefault=this&&this[a27_0x3906('0x0')]||function(_0x4d29c4){return _0x4d29c4&&_0x4d29c4[a27_0x3906('0x1')]?_0x4d29c4:{'default':_0x4d29c4};};Object[a27_0x3906('0x2')](exports,a27_0x3906('0x1'),{'value':!![]});const HttpClientService_1=require(a27_0x3906('0x3'));const crypt_utils_1=__importDefault(require(a27_0x3906('0x4')));const extract=require(a27_0x3906('0x5'));const fsExtra=require(a27_0x3906('0x6'));const base64Img=require('base64-img');const isCorrupted=require(a27_0x3906('0x7'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x3906('0x8'))[a27_0x3906('0x9')];class SyncVehicleService{constructor(_0x608cd3){this[a27_0x3906('0xa')]=a27_0x3906('0xb');this['folder']=process[a27_0x3906('0xc')][a27_0x3906('0xd')];this['apiURL']=process[a27_0x3906('0xc')][a27_0x3906('0xe')];this[a27_0x3906('0xf')]=process[a27_0x3906('0xc')][a27_0x3906('0x10')];this['eventResults']=[{'file':'result_driver.txt','result':0x0},{'file':a27_0x3906('0x11'),'result':0x0},{'file':a27_0x3906('0x12'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a27_0x3906('0x13'))]();this['gpsService']=_0x608cd3;}[a27_0x3906('0x14')](){console[a27_0x3906('0x15')](a27_0x3906('0x16'));this[a27_0x3906('0x17')]();setInterval(function(){this[a27_0x3906('0x17')]();}['bind'](this),0x2710);setInterval(function(){this[a27_0x3906('0x18')]();}['bind'](this),0x7d0);setInterval(function(){this[a27_0x3906('0x19')]();}['bind'](this),0x3e8);}[a27_0x3906('0x19')](){for(let _0x1454d9=0x0;_0x1454d9<this['eventResults'][a27_0x3906('0x1a')];_0x1454d9++){this[a27_0x3906('0x1b')](_0x1454d9);}}['driverValidationEvents'](_0x10b6fa){const _0x26aa9a=this['eventResults'][_0x10b6fa]['file'];const _0x28d9e9=''+this[a27_0x3906('0x1c')]+_0x26aa9a;if(fsExtra[a27_0x3906('0x1d')](_0x28d9e9)){const _0x453725=fsExtra[a27_0x3906('0x1e')](_0x28d9e9)['toString']();if(this[a27_0x3906('0x1f')][_0x10b6fa][a27_0x3906('0x20')]!=_0x453725){this[a27_0x3906('0x1f')][_0x10b6fa][a27_0x3906('0x20')]=_0x453725;console['log'](a27_0x3906('0x19'),this[a27_0x3906('0x1f')][_0x10b6fa][a27_0x3906('0x20')],_0x453725);const _0x243cf=this[a27_0x3906('0x21')]+a27_0x3906('0x22');const _0x5ae24e=crypt_utils_1[a27_0x3906('0x23')]['encrypt'](_0x453725);console[a27_0x3906('0x15')](a27_0x3906('0x24'),_0x5ae24e);const _0x1799c4=this[a27_0x3906('0x25')]?this[a27_0x3906('0x25')][a27_0x3906('0x26')]:{};const _0x10f39b=this[a27_0x3906('0x1c')]+a27_0x3906('0x27');let _0xf5b60c=null;const _0x40176d={'event_type_id':_0x5ae24e,'vehicle_id':this[a27_0x3906('0xf')],'latitude':_0x1799c4['latitude']?_0x1799c4['latitude'][a27_0x3906('0x28')](',','.'):0x0,'longitude':_0x1799c4['longitude']?_0x1799c4[a27_0x3906('0x29')]['replace'](',','.'):0x0,'speed':_0x1799c4[a27_0x3906('0x2a')]?_0x1799c4[a27_0x3906('0x2a')]:0x0,'reported_at':new Date(),'image_data':_0xf5b60c};if(fsExtra[a27_0x3906('0x1d')](_0x10f39b)){_0xf5b60c=base64Img[a27_0x3906('0x2b')](_0x10f39b);_0xf5b60c=JSON[a27_0x3906('0x2c')](JSON[a27_0x3906('0x2d')](_0xf5b60c));_0x40176d['image_data']=_0xf5b60c;}this[a27_0x3906('0x2e')][a27_0x3906('0x2f')](_0x243cf,_0x40176d,![])['then'](function(_0x2cbde9){if(_0x2cbde9[a27_0x3906('0x30')]){}}[a27_0x3906('0x31')](this))[a27_0x3906('0x32')](function(_0x44839){console[a27_0x3906('0x15')](a27_0x3906('0x33'));});}}else{}}['loadAuthorizedDriver'](){const _0x294bfe=this['apiURL']+a27_0x3906('0x34')+this['vehicleId'];this[a27_0x3906('0x2e')]['get'](_0x294bfe,![])[a27_0x3906('0x35')](function(_0x489ba6){if(_0x489ba6[a27_0x3906('0x30')]){if(_0x489ba6[a27_0x3906('0x36')]&&_0x489ba6[a27_0x3906('0x36')]['length']>0x0&&_0x489ba6[a27_0x3906('0x36')][0x0][a27_0x3906('0x37')]){this['saveImageFile'](_0x489ba6['data'][0x0]);}}}[a27_0x3906('0x31')](this))[a27_0x3906('0x32')](function(_0x7b849f){console[a27_0x3906('0x15')](_0x7b849f);});}[a27_0x3906('0x38')](_0x1807ba){let _0x5320a0='';const _0x4b5bb4=_0x1807ba[a27_0x3906('0x37')][a27_0x3906('0x28')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x1807ba[a27_0x3906('0x37')]['match'](/^data:image\/png;base64,/,'')){_0x5320a0=a27_0x3906('0x39');}else if(_0x1807ba[a27_0x3906('0x37')][a27_0x3906('0x3a')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x5320a0=a27_0x3906('0x3b');}fsExtra[a27_0x3906('0x3c')](this[a27_0x3906('0x1c')]);const _0x36e700=this[a27_0x3906('0x1c')]+'authorized_driver.'+_0x5320a0;const _0x47a693=this[a27_0x3906('0x1c')]+a27_0x3906('0x3d');fsExtra['writeFile'](_0x36e700,_0x4b5bb4,'base64',function(_0x49bf58){});fsExtra[a27_0x3906('0x3e')](_0x47a693,_0x1807ba[a27_0x3906('0x3f')],function(_0x5648a7){});}[a27_0x3906('0x18')](){const _0x2c1bc1=new Date();const _0x123697=_0x2c1bc1['getTime']()-currentDriverImageDate[a27_0x3906('0x40')]();if(_0x123697>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x3906('0x3e')](process['env'][a27_0x3906('0x41')]+a27_0x3906('0x42'),'{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x28da2e){console[a27_0x3906('0x15')](a27_0x3906('0x43'));if(_0x28da2e){return console[a27_0x3906('0x15')](_0x28da2e);}});}else{extract(this[a27_0x3906('0xa')],(_0x1c3700,_0xbef36e)=>{try{if(!_0x1c3700){const _0x2d0d80=process[a27_0x3906('0xc')][a27_0x3906('0xd')];fsExtra[a27_0x3906('0x3c')](_0x2d0d80);const _0x556768=_0x2d0d80+a27_0x3906('0x44');const _0x59f6c3=_0x2d0d80+a27_0x3906('0x27');fsExtra[a27_0x3906('0x45')](_0x556768,_0xbef36e);if(!isCorrupted(_0x556768)){corruptedCounter=0x0;currentDriverImageDate=new Date();console['log'](a27_0x3906('0x18'),!![],new Date());fsExtra['copy'](_0x556768,_0x59f6c3);}else{corruptedCounter++;console[a27_0x3906('0x15')](a27_0x3906('0x18'),corruptedCounter);this['setCurrentDriverImage']();}}else{console['error'](a27_0x3906('0x46'),_0x1c3700);}}catch(_0x25ae0d){}finally{}});}}}exports[a27_0x3906('0x47')]=SyncVehicleService;