var a26_0x55ac=['env','FILES_FOLDER','apiURL','vehicleId','VEHICLE_ID','eventResults','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','log','init\x20SyncVehicleService\x20test22','init','loadAuthorizedDriver','setCurrentDriverImage','bind','driverValidationEvents','file','readFileSync','result','events/report_event/','default','encrypt','eventTypeId','current_driver.jpg','latitude','replace','longitude','speed','stringify','image_data','then','success','catch','err','route_schedules/get_by_vehicle/','get','data','length','saveImageFile','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','getTime','VIDEO_SERVICE_FILES_FOLDER','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','toString','.jpg','error','extract','SyncVehicleService','__importDefault','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','is-corrupted-jpeg','child_process','url','folder'];(function(_0x106765,_0x1277b7){var _0x19f13e=function(_0x426e33){while(--_0x426e33){_0x106765['push'](_0x106765['shift']());}};_0x19f13e(++_0x1277b7);}(a26_0x55ac,0x1da));var a26_0x2010=function(_0x4d8454,_0x7e05b3){_0x4d8454=_0x4d8454-0x0;var _0x170abf=a26_0x55ac[_0x4d8454];return _0x170abf;};'use strict';var __importDefault=this&&this[a26_0x2010('0x0')]||function(_0x3d9e36){return _0x3d9e36&&_0x3d9e36['__esModule']?_0x3d9e36:{'default':_0x3d9e36};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x2010('0x1')));const extract=require(a26_0x2010('0x2'));const fsExtra=require(a26_0x2010('0x3'));const base64Img=require(a26_0x2010('0x4'));const isCorrupted=require(a26_0x2010('0x5'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require('jimp');const fork=require(a26_0x2010('0x6'))['fork'];class SyncVehicleService{constructor(_0x42447f){this[a26_0x2010('0x7')]='http://localhost:60/index1.jpg';this[a26_0x2010('0x8')]=process[a26_0x2010('0x9')][a26_0x2010('0xa')];this[a26_0x2010('0xb')]=process[a26_0x2010('0x9')]['API_SERVICE_URL'];this[a26_0x2010('0xc')]=process[a26_0x2010('0x9')][a26_0x2010('0xd')];this[a26_0x2010('0xe')]=[{'file':a26_0x2010('0xf'),'result':0x0},{'file':a26_0x2010('0x10'),'result':0x0},{'file':a26_0x2010('0x11'),'result':0x0}];this[a26_0x2010('0x12')]=new HttpClientService_1[(a26_0x2010('0x13'))]();this[a26_0x2010('0x14')]=_0x42447f;}['init2'](){console[a26_0x2010('0x15')](a26_0x2010('0x16'));const _0x33fffb=this[a26_0x2010('0x8')]+'image1.jpg';const _0xa45e26=this[a26_0x2010('0x8')]+'image2.jpg';}[a26_0x2010('0x17')](){console[a26_0x2010('0x15')]('init\x20SyncVehicleService');this[a26_0x2010('0x18')]();setInterval(function(){this[a26_0x2010('0x18')]();}['bind'](this),0x2710);setInterval(function(){this[a26_0x2010('0x19')]();}[a26_0x2010('0x1a')](this),0x7d0);setInterval(function(){this['syncEvents']();}[a26_0x2010('0x1a')](this),0x3e8);}['syncEvents'](){for(let _0x2b469a=0x0;_0x2b469a<this[a26_0x2010('0xe')]['length'];_0x2b469a++){this[a26_0x2010('0x1b')](_0x2b469a);}}['driverValidationEvents'](_0xe4b1c9){const _0x2563a5=this['eventResults'][_0xe4b1c9][a26_0x2010('0x1c')];const _0x48a9b8=''+this[a26_0x2010('0x8')]+_0x2563a5;if(fsExtra['existsSync'](_0x48a9b8)){const _0x4f8f9c=fsExtra[a26_0x2010('0x1d')](_0x48a9b8)['toString']();if(this[a26_0x2010('0xe')][_0xe4b1c9][a26_0x2010('0x1e')]!=_0x4f8f9c){this[a26_0x2010('0xe')][_0xe4b1c9][a26_0x2010('0x1e')]=_0x4f8f9c;console[a26_0x2010('0x15')]('syncEvents',this['eventResults'][_0xe4b1c9][a26_0x2010('0x1e')],_0x4f8f9c);const _0x1b2b3c=this[a26_0x2010('0xb')]+a26_0x2010('0x1f');const _0x5eec97=crypt_utils_1[a26_0x2010('0x20')][a26_0x2010('0x21')](_0x4f8f9c);console[a26_0x2010('0x15')](a26_0x2010('0x22'),_0x5eec97);const _0xade2d3=this['gpsService']?this[a26_0x2010('0x14')]['locationParts']:{};const _0xa88942=this[a26_0x2010('0x8')]+a26_0x2010('0x23');let _0x8d4e3=null;const _0x12b3c3={'event_type_id':_0x5eec97,'vehicle_id':this[a26_0x2010('0xc')],'latitude':_0xade2d3[a26_0x2010('0x24')]?_0xade2d3['latitude'][a26_0x2010('0x25')](',','.'):0x0,'longitude':_0xade2d3['longitude']?_0xade2d3[a26_0x2010('0x26')][a26_0x2010('0x25')](',','.'):0x0,'speed':_0xade2d3[a26_0x2010('0x27')]?_0xade2d3['speed']:0x0,'reported_at':new Date(),'image_data':_0x8d4e3};if(fsExtra['existsSync'](_0xa88942)){_0x8d4e3=base64Img['base64Sync'](_0xa88942);_0x8d4e3=JSON['parse'](JSON[a26_0x2010('0x28')](_0x8d4e3));_0x12b3c3[a26_0x2010('0x29')]=_0x8d4e3;}this['httpClientService']['post'](_0x1b2b3c,_0x12b3c3,![])[a26_0x2010('0x2a')](function(_0x558233){if(_0x558233[a26_0x2010('0x2b')]){}}[a26_0x2010('0x1a')](this))[a26_0x2010('0x2c')](function(_0x3b02b4){console[a26_0x2010('0x15')](a26_0x2010('0x2d'));});}}else{}}[a26_0x2010('0x18')](){const _0x5b953c=this[a26_0x2010('0xb')]+a26_0x2010('0x2e')+this['vehicleId'];this[a26_0x2010('0x12')][a26_0x2010('0x2f')](_0x5b953c,![])[a26_0x2010('0x2a')](function(_0x30828b){if(_0x30828b[a26_0x2010('0x2b')]){if(_0x30828b[a26_0x2010('0x30')]&&_0x30828b[a26_0x2010('0x30')][a26_0x2010('0x31')]>0x0&&_0x30828b[a26_0x2010('0x30')][0x0][a26_0x2010('0x29')]){this['saveImageFile'](_0x30828b[a26_0x2010('0x30')][0x0]);}}}[a26_0x2010('0x1a')](this))[a26_0x2010('0x2c')](function(_0x4fba4a){console['log'](_0x4fba4a);});}[a26_0x2010('0x32')](_0xcd3cfd){let _0x384520='';const _0x199edc=_0xcd3cfd[a26_0x2010('0x29')]['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0xcd3cfd[a26_0x2010('0x29')][a26_0x2010('0x33')](/^data:image\/png;base64,/,'')){_0x384520='png';}else if(_0xcd3cfd[a26_0x2010('0x29')][a26_0x2010('0x33')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x384520=a26_0x2010('0x34');}fsExtra[a26_0x2010('0x35')](this[a26_0x2010('0x8')]);const _0x565571=this[a26_0x2010('0x8')]+a26_0x2010('0x36')+_0x384520;const _0x2ed63e=this[a26_0x2010('0x8')]+a26_0x2010('0x37');fsExtra[a26_0x2010('0x38')](_0x565571,_0x199edc,a26_0x2010('0x39'),function(_0x162f86){});fsExtra[a26_0x2010('0x38')](_0x2ed63e,_0xcd3cfd['user_id'],function(_0x3b4fc0){});}[a26_0x2010('0x19')](){const _0x23e8c7=new Date();const _0x31cffc=_0x23e8c7['getTime']()-currentDriverImageDate[a26_0x2010('0x3a')]();if(_0x31cffc>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x2010('0x9')][a26_0x2010('0x3b')]+'status.json','{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x47e63c){console[a26_0x2010('0x15')]('Video\x20service\x20restarted');if(_0x47e63c){return console[a26_0x2010('0x15')](_0x47e63c);}});}else{extract(this[a26_0x2010('0x7')],(_0x1e67ec,_0x370b36)=>{try{if(!_0x1e67ec){const _0x58a9c7=process[a26_0x2010('0x9')][a26_0x2010('0xa')];fsExtra['ensureDirSync'](_0x58a9c7);const _0xdc5e1c=_0x58a9c7+a26_0x2010('0x3c');const _0x24c586=_0x58a9c7+a26_0x2010('0x23');fsExtra[a26_0x2010('0x3d')](_0xdc5e1c,_0x370b36);if(!isCorrupted(_0xdc5e1c)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x2010('0x15')](a26_0x2010('0x19'),!![],new Date());fsExtra[a26_0x2010('0x3e')](_0xdc5e1c,_0x24c586);}else{corruptedCounter++;console[a26_0x2010('0x15')](a26_0x2010('0x3f'),corruptedCounter);const _0x859a36=new Date();const _0x130b3b=_0x859a36[a26_0x2010('0x3a')]();fsExtra[a26_0x2010('0x3e')](_0xdc5e1c,_0x130b3b[a26_0x2010('0x40')]()+a26_0x2010('0x41'));}}else{console[a26_0x2010('0x42')](a26_0x2010('0x43'),_0x1e67ec);}}catch(_0x22d1fc){}finally{}});}}}exports[a26_0x2010('0x44')]=SyncVehicleService;