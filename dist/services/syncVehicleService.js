var a26_0x29c0=['length','saveImageFile','catch','png','match','jpg','ensureDirSync','authorized_driver.','writeFile','base64','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver.jpg','writeFileSync','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','SyncVehicleService','__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','jimp','child_process','fork','urlVideo','http://localhost:60/index1.jpg','folder','env','apiURL','vehicleId','VEHICLE_ID','eventResults','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','gpsService','log','init','init\x20SyncVehicleService','bind','setCurrentDriverImage','syncEvents','file','toString','result','events/report_event/','default','encrypt','latitude','replace','longitude','speed','base64Sync','parse','image_data','httpClientService','post','then','success','loadAuthorizedDriver','get','data'];(function(_0x26cf07,_0x27df80){var _0x3d7d6d=function(_0xe3830e){while(--_0xe3830e){_0x26cf07['push'](_0x26cf07['shift']());}};_0x3d7d6d(++_0x27df80);}(a26_0x29c0,0x162));var a26_0x5ce7=function(_0x2d68bb,_0x210db9){_0x2d68bb=_0x2d68bb-0x0;var _0x54f463=a26_0x29c0[_0x2d68bb];return _0x54f463;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x54e5ed){return _0x54e5ed&&_0x54e5ed[a26_0x5ce7('0x0')]?_0x54e5ed:{'default':_0x54e5ed};};Object['defineProperty'](exports,a26_0x5ce7('0x0'),{'value':!![]});const HttpClientService_1=require(a26_0x5ce7('0x1'));const crypt_utils_1=__importDefault(require(a26_0x5ce7('0x2')));const extract=require(a26_0x5ce7('0x3'));const fsExtra=require(a26_0x5ce7('0x4'));const base64Img=require(a26_0x5ce7('0x5'));const isCorrupted=require('is-corrupted-jpeg');let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x5ce7('0x6'));const fork=require(a26_0x5ce7('0x7'))[a26_0x5ce7('0x8')];class SyncVehicleService{constructor(_0x4f877c){this[a26_0x5ce7('0x9')]=a26_0x5ce7('0xa');this[a26_0x5ce7('0xb')]=process[a26_0x5ce7('0xc')]['FILES_FOLDER'];this[a26_0x5ce7('0xd')]=process[a26_0x5ce7('0xc')]['API_SERVICE_URL'];this[a26_0x5ce7('0xe')]=process[a26_0x5ce7('0xc')][a26_0x5ce7('0xf')];this[a26_0x5ce7('0x10')]=[{'file':a26_0x5ce7('0x11'),'result':0x0},{'file':a26_0x5ce7('0x12'),'result':0x0},{'file':a26_0x5ce7('0x13'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x5ce7('0x14'))]();this[a26_0x5ce7('0x15')]=_0x4f877c;}['init2'](){console[a26_0x5ce7('0x16')]('init\x20SyncVehicleService\x20test22');const _0x1f8110=this[a26_0x5ce7('0xb')]+'image1.jpg';const _0x54c009=this[a26_0x5ce7('0xb')]+'image2.jpg';}[a26_0x5ce7('0x17')](){console[a26_0x5ce7('0x16')](a26_0x5ce7('0x18'));this['loadAuthorizedDriver']();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x5ce7('0x19')](this),0x2710);setInterval(function(){this[a26_0x5ce7('0x1a')]();}[a26_0x5ce7('0x19')](this),0x7d0);setInterval(function(){this['syncEvents']();}['bind'](this),0x3e8);}[a26_0x5ce7('0x1b')](){for(let _0x5b66a6=0x0;_0x5b66a6<this[a26_0x5ce7('0x10')]['length'];_0x5b66a6++){this['driverValidationEvents'](_0x5b66a6);}}['driverValidationEvents'](_0x575c06){const _0x3a73de=this['eventResults'][_0x575c06][a26_0x5ce7('0x1c')];const _0x2d8d55=''+this[a26_0x5ce7('0xb')]+_0x3a73de;if(fsExtra['existsSync'](_0x2d8d55)){const _0x3b2efb=fsExtra['readFileSync'](_0x2d8d55)[a26_0x5ce7('0x1d')]();if(this[a26_0x5ce7('0x10')][_0x575c06][a26_0x5ce7('0x1e')]!=_0x3b2efb){this[a26_0x5ce7('0x10')][_0x575c06][a26_0x5ce7('0x1e')]=_0x3b2efb;console[a26_0x5ce7('0x16')](a26_0x5ce7('0x1b'),this['eventResults'][_0x575c06]['result'],_0x3b2efb);const _0x398bfe=this[a26_0x5ce7('0xd')]+a26_0x5ce7('0x1f');const _0x4b4802=crypt_utils_1[a26_0x5ce7('0x20')][a26_0x5ce7('0x21')](_0x3b2efb);console[a26_0x5ce7('0x16')]('eventTypeId',_0x4b4802);const _0x13f32a=this[a26_0x5ce7('0x15')]?this[a26_0x5ce7('0x15')]['locationParts']:{};const _0x2444a4=this['folder']+'current_driver.jpg';let _0x67a135=null;const _0x51d944={'event_type_id':_0x4b4802,'vehicle_id':this[a26_0x5ce7('0xe')],'latitude':_0x13f32a['latitude']?_0x13f32a[a26_0x5ce7('0x22')][a26_0x5ce7('0x23')](',','.'):0x0,'longitude':_0x13f32a[a26_0x5ce7('0x24')]?_0x13f32a[a26_0x5ce7('0x24')][a26_0x5ce7('0x23')](',','.'):0x0,'speed':_0x13f32a['speed']?_0x13f32a[a26_0x5ce7('0x25')]:0x0,'reported_at':new Date(),'image_data':_0x67a135};if(fsExtra['existsSync'](_0x2444a4)){_0x67a135=base64Img[a26_0x5ce7('0x26')](_0x2444a4);_0x67a135=JSON[a26_0x5ce7('0x27')](JSON['stringify'](_0x67a135));_0x51d944[a26_0x5ce7('0x28')]=_0x67a135;}this[a26_0x5ce7('0x29')][a26_0x5ce7('0x2a')](_0x398bfe,_0x51d944,![])[a26_0x5ce7('0x2b')](function(_0x117d65){if(_0x117d65[a26_0x5ce7('0x2c')]){}}['bind'](this))['catch'](function(_0x4aa489){console[a26_0x5ce7('0x16')]('err');});}}else{}}[a26_0x5ce7('0x2d')](){const _0x291534=this[a26_0x5ce7('0xd')]+'route_schedules/get_by_vehicle/'+this[a26_0x5ce7('0xe')];this[a26_0x5ce7('0x29')][a26_0x5ce7('0x2e')](_0x291534,![])[a26_0x5ce7('0x2b')](function(_0x3436fd){if(_0x3436fd[a26_0x5ce7('0x2c')]){if(_0x3436fd[a26_0x5ce7('0x2f')]&&_0x3436fd[a26_0x5ce7('0x2f')][a26_0x5ce7('0x30')]>0x0&&_0x3436fd[a26_0x5ce7('0x2f')][0x0]['image_data']){this[a26_0x5ce7('0x31')](_0x3436fd[a26_0x5ce7('0x2f')][0x0]);}}}[a26_0x5ce7('0x19')](this))[a26_0x5ce7('0x32')](function(_0x5e9c32){console['log'](_0x5e9c32);});}[a26_0x5ce7('0x31')](_0x5a9fc9){let _0x3582c0='';const _0x54b916=_0x5a9fc9[a26_0x5ce7('0x28')]['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x5a9fc9[a26_0x5ce7('0x28')]['match'](/^data:image\/png;base64,/,'')){_0x3582c0=a26_0x5ce7('0x33');}else if(_0x5a9fc9['image_data'][a26_0x5ce7('0x34')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x3582c0=a26_0x5ce7('0x35');}fsExtra[a26_0x5ce7('0x36')](this['folder']);const _0x19fd81=this['folder']+a26_0x5ce7('0x37')+_0x3582c0;const _0x479e5e=this['folder']+'authorized_driver.txt';fsExtra[a26_0x5ce7('0x38')](_0x19fd81,_0x54b916,a26_0x5ce7('0x39'),function(_0x3378dc){});fsExtra[a26_0x5ce7('0x38')](_0x479e5e,_0x5a9fc9[a26_0x5ce7('0x3a')],function(_0x5038cc){});}[a26_0x5ce7('0x1a')](){const _0x3b0f2d=new Date();const _0x3ac4a6=_0x3b0f2d[a26_0x5ce7('0x3b')]()-currentDriverImageDate[a26_0x5ce7('0x3b')]();if(_0x3ac4a6>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x5ce7('0x38')](process[a26_0x5ce7('0xc')][a26_0x5ce7('0x3c')]+'status.json',a26_0x5ce7('0x3d')+currentDriverImageDate+'\x22}',function(_0x1635b8){console[a26_0x5ce7('0x16')](a26_0x5ce7('0x3e'));if(_0x1635b8){return console[a26_0x5ce7('0x16')](_0x1635b8);}});}else{extract(this[a26_0x5ce7('0x9')],(_0x2ba9c0,_0x17df58)=>{try{if(!_0x2ba9c0){const _0x4b8373=process[a26_0x5ce7('0xc')]['FILES_FOLDER'];fsExtra[a26_0x5ce7('0x36')](_0x4b8373);const _0x58e42b=_0x4b8373+'current_driver_temp.jpg';const _0x558a18=_0x4b8373+a26_0x5ce7('0x3f');fsExtra[a26_0x5ce7('0x40')](_0x58e42b,_0x17df58);if(!isCorrupted(_0x58e42b)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra['copy'](_0x58e42b,_0x558a18);}else{corruptedCounter++;console[a26_0x5ce7('0x16')](a26_0x5ce7('0x41'),corruptedCounter);const _0x5e9b1d=new Date();const _0xd24b1f=_0x5e9b1d[a26_0x5ce7('0x3b')]();fsExtra['copy'](_0x58e42b,_0x4b8373+_0xd24b1f[a26_0x5ce7('0x1d')]()+'.jpg');}}else{}}catch(_0x2ab77b){}finally{}});}}}exports[a26_0x5ce7('0x42')]=SyncVehicleService;