var a26_0x296e=['log','init\x20SyncVehicleService\x20test22','image1.jpg','init','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','driverValidationEvents','file','existsSync','readFileSync','toString','result','eventResults','events/report_event/','default','encrypt','eventTypeId','current_driver.jpg','latitude','replace','longitude','speed','base64Sync','parse','stringify','post','then','success','catch','route_schedules/get_by_vehicle/','get','data','image_data','saveImageFile','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','getTime','.jpg','extract','SyncVehicleService','__importDefault','defineProperty','__esModule','../infrastructure/crypt-utils','../modules/jpeg-extract','base64-img','is-corrupted-jpeg','jimp','child_process','fork','url','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','result_driver.txt','result_driver_bus.txt','httpClientService','HttpClientService','gpsService','init2'];(function(_0x40b7ba,_0x444428){var _0x969ddc=function(_0x280858){while(--_0x280858){_0x40b7ba['push'](_0x40b7ba['shift']());}};_0x969ddc(++_0x444428);}(a26_0x296e,0x85));var a26_0x14eb=function(_0x3ad307,_0x18ed64){_0x3ad307=_0x3ad307-0x0;var _0x4b74d9=a26_0x296e[_0x3ad307];return _0x4b74d9;};'use strict';var __importDefault=this&&this[a26_0x14eb('0x0')]||function(_0x5824b6){return _0x5824b6&&_0x5824b6['__esModule']?_0x5824b6:{'default':_0x5824b6};};Object[a26_0x14eb('0x1')](exports,a26_0x14eb('0x2'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x14eb('0x3')));const extract=require(a26_0x14eb('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a26_0x14eb('0x5'));const isCorrupted=require(a26_0x14eb('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x14eb('0x7'));const fork=require(a26_0x14eb('0x8'))[a26_0x14eb('0x9')];class SyncVehicleService{constructor(_0x74fe78){this[a26_0x14eb('0xa')]=a26_0x14eb('0xb');this[a26_0x14eb('0xc')]=process[a26_0x14eb('0xd')][a26_0x14eb('0xe')];this[a26_0x14eb('0xf')]=process['env'][a26_0x14eb('0x10')];this[a26_0x14eb('0x11')]=process[a26_0x14eb('0xd')][a26_0x14eb('0x12')];this['eventResults']=[{'file':a26_0x14eb('0x13'),'result':0x0},{'file':a26_0x14eb('0x14'),'result':0x0},{'file':'result_driver_behaviour.txt','result':0x0}];this[a26_0x14eb('0x15')]=new HttpClientService_1[(a26_0x14eb('0x16'))]();this[a26_0x14eb('0x17')]=_0x74fe78;}[a26_0x14eb('0x18')](){console[a26_0x14eb('0x19')](a26_0x14eb('0x1a'));const _0x3f1174=this[a26_0x14eb('0xc')]+a26_0x14eb('0x1b');const _0x540b6d=this[a26_0x14eb('0xc')]+'image2.jpg';}[a26_0x14eb('0x1c')](){console[a26_0x14eb('0x19')]('init\x20SyncVehicleService');this[a26_0x14eb('0x1d')]();setInterval(function(){this[a26_0x14eb('0x1d')]();}[a26_0x14eb('0x1e')](this),0x2710);setInterval(function(){this[a26_0x14eb('0x1f')]();}[a26_0x14eb('0x1e')](this),0x7d0);setInterval(function(){this[a26_0x14eb('0x20')]();}['bind'](this),0x3e8);}[a26_0x14eb('0x20')](){for(let _0x1d1aa4=0x0;_0x1d1aa4<this['eventResults']['length'];_0x1d1aa4++){this[a26_0x14eb('0x21')](_0x1d1aa4);}}[a26_0x14eb('0x21')](_0x1527a9){const _0x3da015=this['eventResults'][_0x1527a9][a26_0x14eb('0x22')];const _0x1897bd=''+this[a26_0x14eb('0xc')]+_0x3da015;if(fsExtra[a26_0x14eb('0x23')](_0x1897bd)){const _0x1586ee=fsExtra[a26_0x14eb('0x24')](_0x1897bd)[a26_0x14eb('0x25')]();if(this['eventResults'][_0x1527a9][a26_0x14eb('0x26')]!=_0x1586ee){this[a26_0x14eb('0x27')][_0x1527a9][a26_0x14eb('0x26')]=_0x1586ee;console[a26_0x14eb('0x19')](a26_0x14eb('0x20'),this[a26_0x14eb('0x27')][_0x1527a9][a26_0x14eb('0x26')],_0x1586ee);const _0x2be9d4=this['apiURL']+a26_0x14eb('0x28');const _0x5bd1d4=crypt_utils_1[a26_0x14eb('0x29')][a26_0x14eb('0x2a')](_0x1586ee);console[a26_0x14eb('0x19')](a26_0x14eb('0x2b'),_0x5bd1d4);const _0x38c061=this['gpsService']?this[a26_0x14eb('0x17')]['locationParts']:{};const _0x340986=this[a26_0x14eb('0xc')]+a26_0x14eb('0x2c');let _0x5289a3=null;const _0x2d536b={'event_type_id':_0x5bd1d4,'vehicle_id':this[a26_0x14eb('0x11')],'latitude':_0x38c061[a26_0x14eb('0x2d')]?_0x38c061[a26_0x14eb('0x2d')][a26_0x14eb('0x2e')](',','.'):0x0,'longitude':_0x38c061[a26_0x14eb('0x2f')]?_0x38c061[a26_0x14eb('0x2f')][a26_0x14eb('0x2e')](',','.'):0x0,'speed':_0x38c061['speed']?_0x38c061[a26_0x14eb('0x30')]:0x0,'reported_at':new Date(),'image_data':_0x5289a3};if(fsExtra[a26_0x14eb('0x23')](_0x340986)){_0x5289a3=base64Img[a26_0x14eb('0x31')](_0x340986);_0x5289a3=JSON[a26_0x14eb('0x32')](JSON[a26_0x14eb('0x33')](_0x5289a3));_0x2d536b['image_data']=_0x5289a3;}this[a26_0x14eb('0x15')][a26_0x14eb('0x34')](_0x2be9d4,_0x2d536b,![])[a26_0x14eb('0x35')](function(_0x4435d9){if(_0x4435d9[a26_0x14eb('0x36')]){}}[a26_0x14eb('0x1e')](this))[a26_0x14eb('0x37')](function(_0x3f57b5){console[a26_0x14eb('0x19')]('err');});}}else{}}[a26_0x14eb('0x1d')](){const _0x3a730c=this[a26_0x14eb('0xf')]+a26_0x14eb('0x38')+this[a26_0x14eb('0x11')];this[a26_0x14eb('0x15')][a26_0x14eb('0x39')](_0x3a730c,![])[a26_0x14eb('0x35')](function(_0x4e18e2){if(_0x4e18e2['success']){if(_0x4e18e2[a26_0x14eb('0x3a')]&&_0x4e18e2[a26_0x14eb('0x3a')]['length']>0x0&&_0x4e18e2['data'][0x0][a26_0x14eb('0x3b')]){this['saveImageFile'](_0x4e18e2[a26_0x14eb('0x3a')][0x0]);}}}[a26_0x14eb('0x1e')](this))['catch'](function(_0xd7695){console[a26_0x14eb('0x19')](_0xd7695);});}[a26_0x14eb('0x3c')](_0x49f24c){let _0x274cea='';const _0x208f9e=_0x49f24c[a26_0x14eb('0x3b')][a26_0x14eb('0x2e')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x49f24c[a26_0x14eb('0x3b')]['match'](/^data:image\/png;base64,/,'')){_0x274cea='png';}else if(_0x49f24c[a26_0x14eb('0x3b')][a26_0x14eb('0x3d')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x274cea=a26_0x14eb('0x3e');}fsExtra[a26_0x14eb('0x3f')](this[a26_0x14eb('0xc')]);const _0x4fea14=this['folder']+a26_0x14eb('0x40')+_0x274cea;const _0x3624ea=this[a26_0x14eb('0xc')]+a26_0x14eb('0x41');fsExtra[a26_0x14eb('0x42')](_0x4fea14,_0x208f9e,a26_0x14eb('0x43'),function(_0x561efe){});fsExtra[a26_0x14eb('0x42')](_0x3624ea,_0x49f24c['user_id'],function(_0x4ee2de){});}[a26_0x14eb('0x1f')](){const _0x5beca4=new Date();const _0x1b34b6=_0x5beca4['getTime']()-currentDriverImageDate['getTime']();if(_0x1b34b6>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x14eb('0x42')](process[a26_0x14eb('0xd')][a26_0x14eb('0x44')]+a26_0x14eb('0x45'),a26_0x14eb('0x46')+currentDriverImageDate+'\x22}',function(_0x31bc14){console[a26_0x14eb('0x19')](a26_0x14eb('0x47'));if(_0x31bc14){return console[a26_0x14eb('0x19')](_0x31bc14);}});}else{extract(this['url'],(_0x1d89ec,_0x1e1285)=>{try{if(!_0x1d89ec){const _0x4152db=process['env'][a26_0x14eb('0xe')];fsExtra[a26_0x14eb('0x3f')](_0x4152db);const _0x1159bb=_0x4152db+'current_driver_temp.jpg';const _0x170cef=_0x4152db+a26_0x14eb('0x2c');fsExtra[a26_0x14eb('0x48')](_0x1159bb,_0x1e1285);if(!isCorrupted(_0x1159bb)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x14eb('0x19')]('setCurrentDriverImage',!![],new Date());fsExtra[a26_0x14eb('0x49')](_0x1159bb,_0x170cef);}else{corruptedCounter++;console[a26_0x14eb('0x19')](a26_0x14eb('0x4a'),corruptedCounter);const _0x3be713=new Date();const _0x187276=_0x3be713[a26_0x14eb('0x4b')]();fsExtra['copy'](_0x1159bb,_0x4152db+_0x187276['toString']()+a26_0x14eb('0x4c'));}}else{console['error'](a26_0x14eb('0x4d'),_0x1d89ec);}}catch(_0x381347){}finally{}});}}}exports[a26_0x14eb('0x4e')]=SyncVehicleService;