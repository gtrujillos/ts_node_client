var a26_0x5cd9=['../infrastructure/crypt-utils','../modules/jpeg-extract','base64-img','is-corrupted-jpeg','child_process','url','folder','env','FILES_FOLDER','VEHICLE_ID','eventResults','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','gpsService','init2','log','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','file','readFileSync','toString','result','apiURL','default','encrypt','eventTypeId','locationParts','vehicleId','latitude','replace','longitude','speed','existsSync','base64Sync','parse','stringify','image_data','post','then','success','route_schedules/get_by_vehicle/','get','data','saveImageFile','catch','match','png','jpg','ensureDirSync','authorized_driver.txt','writeFile','base64','user_id','getTime','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','.jpg','error','extract','__importDefault','defineProperty','__esModule'];(function(_0x303865,_0x3f9817){var _0x57e4f4=function(_0x3d86df){while(--_0x3d86df){_0x303865['push'](_0x303865['shift']());}};_0x57e4f4(++_0x3f9817);}(a26_0x5cd9,0x179));var a26_0x367f=function(_0x1c2a51,_0x542b5e){_0x1c2a51=_0x1c2a51-0x0;var _0x45612d=a26_0x5cd9[_0x1c2a51];return _0x45612d;};'use strict';var __importDefault=this&&this[a26_0x367f('0x0')]||function(_0x141786){return _0x141786&&_0x141786['__esModule']?_0x141786:{'default':_0x141786};};Object[a26_0x367f('0x1')](exports,a26_0x367f('0x2'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x367f('0x3')));const extract=require(a26_0x367f('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a26_0x367f('0x5'));const isCorrupted=require(a26_0x367f('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require('jimp');const fork=require(a26_0x367f('0x7'))['fork'];class SyncVehicleService{constructor(_0x41ff7c){this[a26_0x367f('0x8')]='http://localhost:60/index1.jpg';this[a26_0x367f('0x9')]=process[a26_0x367f('0xa')][a26_0x367f('0xb')];this['apiURL']=process[a26_0x367f('0xa')]['API_SERVICE_URL'];this['vehicleId']=process[a26_0x367f('0xa')][a26_0x367f('0xc')];this[a26_0x367f('0xd')]=[{'file':'result_driver.txt','result':0x0},{'file':a26_0x367f('0xe'),'result':0x0},{'file':a26_0x367f('0xf'),'result':0x0}];this[a26_0x367f('0x10')]=new HttpClientService_1['HttpClientService']();this[a26_0x367f('0x11')]=_0x41ff7c;}[a26_0x367f('0x12')](){console[a26_0x367f('0x13')](a26_0x367f('0x14'));const _0x9590f9=this[a26_0x367f('0x9')]+a26_0x367f('0x15');const _0x1c9d43=this['folder']+a26_0x367f('0x16');}[a26_0x367f('0x17')](){console[a26_0x367f('0x13')](a26_0x367f('0x18'));this[a26_0x367f('0x19')]();setInterval(function(){this[a26_0x367f('0x19')]();}[a26_0x367f('0x1a')](this),0x2710);setInterval(function(){this[a26_0x367f('0x1b')]();}['bind'](this),0x7d0);setInterval(function(){this['syncEvents']();}[a26_0x367f('0x1a')](this),0x3e8);}[a26_0x367f('0x1c')](){for(let _0x17251f=0x0;_0x17251f<this[a26_0x367f('0xd')][a26_0x367f('0x1d')];_0x17251f++){this[a26_0x367f('0x1e')](_0x17251f);}}[a26_0x367f('0x1e')](_0x400bcd){const _0x1bdea6=this['eventResults'][_0x400bcd][a26_0x367f('0x1f')];const _0x4df2d1=''+this[a26_0x367f('0x9')]+_0x1bdea6;if(fsExtra['existsSync'](_0x4df2d1)){const _0x30662f=fsExtra[a26_0x367f('0x20')](_0x4df2d1)[a26_0x367f('0x21')]();if(this[a26_0x367f('0xd')][_0x400bcd][a26_0x367f('0x22')]!=_0x30662f){this[a26_0x367f('0xd')][_0x400bcd][a26_0x367f('0x22')]=_0x30662f;console['log']('syncEvents',this[a26_0x367f('0xd')][_0x400bcd][a26_0x367f('0x22')],_0x30662f);const _0x5de048=this[a26_0x367f('0x23')]+'events/report_event/';const _0x253887=crypt_utils_1[a26_0x367f('0x24')][a26_0x367f('0x25')](_0x30662f);console['log'](a26_0x367f('0x26'),_0x253887);const _0x27f9c6=this[a26_0x367f('0x11')]?this[a26_0x367f('0x11')][a26_0x367f('0x27')]:{};const _0x56d0aa=this[a26_0x367f('0x9')]+'current_driver.jpg';let _0x18c8b9=null;const _0x2d67fa={'event_type_id':_0x253887,'vehicle_id':this[a26_0x367f('0x28')],'latitude':_0x27f9c6[a26_0x367f('0x29')]?_0x27f9c6[a26_0x367f('0x29')][a26_0x367f('0x2a')](',','.'):0x0,'longitude':_0x27f9c6[a26_0x367f('0x2b')]?_0x27f9c6[a26_0x367f('0x2b')][a26_0x367f('0x2a')](',','.'):0x0,'speed':_0x27f9c6[a26_0x367f('0x2c')]?_0x27f9c6[a26_0x367f('0x2c')]:0x0,'reported_at':new Date(),'image_data':_0x18c8b9};if(fsExtra[a26_0x367f('0x2d')](_0x56d0aa)){_0x18c8b9=base64Img[a26_0x367f('0x2e')](_0x56d0aa);_0x18c8b9=JSON[a26_0x367f('0x2f')](JSON[a26_0x367f('0x30')](_0x18c8b9));_0x2d67fa[a26_0x367f('0x31')]=_0x18c8b9;}this['httpClientService'][a26_0x367f('0x32')](_0x5de048,_0x2d67fa,![])[a26_0x367f('0x33')](function(_0x26bd66){if(_0x26bd66[a26_0x367f('0x34')]){}}['bind'](this))['catch'](function(_0x158968){console[a26_0x367f('0x13')]('err');});}}else{}}[a26_0x367f('0x19')](){const _0x28dd19=this[a26_0x367f('0x23')]+a26_0x367f('0x35')+this[a26_0x367f('0x28')];this['httpClientService'][a26_0x367f('0x36')](_0x28dd19,![])['then'](function(_0x4eb769){if(_0x4eb769[a26_0x367f('0x34')]){if(_0x4eb769[a26_0x367f('0x37')]&&_0x4eb769[a26_0x367f('0x37')][a26_0x367f('0x1d')]>0x0&&_0x4eb769[a26_0x367f('0x37')][0x0][a26_0x367f('0x31')]){this[a26_0x367f('0x38')](_0x4eb769[a26_0x367f('0x37')][0x0]);}}}[a26_0x367f('0x1a')](this))[a26_0x367f('0x39')](function(_0x16079d){console[a26_0x367f('0x13')](_0x16079d);});}[a26_0x367f('0x38')](_0x262d29){let _0x499488='';const _0x3e0f61=_0x262d29[a26_0x367f('0x31')][a26_0x367f('0x2a')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x262d29[a26_0x367f('0x31')][a26_0x367f('0x3a')](/^data:image\/png;base64,/,'')){_0x499488=a26_0x367f('0x3b');}else if(_0x262d29[a26_0x367f('0x31')]['match'](/^data:image\/(jpg|jpeg);base64,/,'')){_0x499488=a26_0x367f('0x3c');}fsExtra[a26_0x367f('0x3d')](this[a26_0x367f('0x9')]);const _0x5ebb7f=this['folder']+'authorized_driver.'+_0x499488;const _0x563e21=this[a26_0x367f('0x9')]+a26_0x367f('0x3e');fsExtra[a26_0x367f('0x3f')](_0x5ebb7f,_0x3e0f61,a26_0x367f('0x40'),function(_0x1a7837){});fsExtra[a26_0x367f('0x3f')](_0x563e21,_0x262d29[a26_0x367f('0x41')],function(_0x465fa4){});}[a26_0x367f('0x1b')](){const _0x4c1624=new Date();const _0x15dc00=_0x4c1624[a26_0x367f('0x42')]()-currentDriverImageDate[a26_0x367f('0x42')]();if(_0x15dc00>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x367f('0x3f')](process[a26_0x367f('0xa')]['VIDEO_SERVICE_FILES_FOLDER']+'status.json',a26_0x367f('0x43')+currentDriverImageDate+'\x22}',function(_0x2943b){console['log'](a26_0x367f('0x44'));if(_0x2943b){return console['log'](_0x2943b);}});}else{extract(this[a26_0x367f('0x8')],(_0x1deb59,_0x54b9f8)=>{try{if(!_0x1deb59){const _0x4ac1d4=process[a26_0x367f('0xa')]['FILES_FOLDER'];fsExtra['ensureDirSync'](_0x4ac1d4);const _0x2698d9=_0x4ac1d4+a26_0x367f('0x45');const _0x1c9b2=_0x4ac1d4+'current_driver.jpg';fsExtra[a26_0x367f('0x46')](_0x2698d9,_0x54b9f8);if(!isCorrupted(_0x2698d9)){corruptedCounter=0x0;currentDriverImageDate=new Date();console['log']('setCurrentDriverImage',!![],new Date());fsExtra[a26_0x367f('0x47')](_0x2698d9,_0x1c9b2);}else{corruptedCounter++;console['log'](a26_0x367f('0x48'),corruptedCounter);const _0x31a36d=new Date();const _0x5af01d=_0x31a36d[a26_0x367f('0x42')]();fsExtra[a26_0x367f('0x47')](_0x2698d9,_0x4ac1d4+_0x5af01d[a26_0x367f('0x21')]()+a26_0x367f('0x49'));}}else{console[a26_0x367f('0x4a')](a26_0x367f('0x4b'),_0x1deb59);}}catch(_0x27b64e){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;