var a26_0x1465=['image_data','post','then','success','catch','route_schedules/get_by_vehicle/','get','data','saveImageFile','match','png','jpg','ensureDirSync','authorized_driver.txt','writeFile','base64','setCurrentDriverImage','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','url','current_driver_temp.jpg','writeFileSync','copy','.jpg','error','SyncVehicleService','__importDefault','defineProperty','__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','fs-extra','base64-img','is-corrupted-jpeg','jimp','child_process','http://localhost:60/index1.jpg','folder','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','env','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','log','init\x20SyncVehicleService\x20test22','image2.jpg','loadAuthorizedDriver','bind','syncEvents','eventResults','length','driverValidationEvents','file','existsSync','toString','result','events/report_event/','default','encrypt','current_driver.jpg','latitude','replace','speed','base64Sync','parse','stringify'];(function(_0x44c879,_0x106d9f){var _0xc93408=function(_0x3a730b){while(--_0x3a730b){_0x44c879['push'](_0x44c879['shift']());}};_0xc93408(++_0x106d9f);}(a26_0x1465,0x1d8));var a26_0x2b63=function(_0x225303,_0x42fe08){_0x225303=_0x225303-0x0;var _0x3763b4=a26_0x1465[_0x225303];return _0x3763b4;};'use strict';var __importDefault=this&&this[a26_0x2b63('0x0')]||function(_0x193907){return _0x193907&&_0x193907['__esModule']?_0x193907:{'default':_0x193907};};Object[a26_0x2b63('0x1')](exports,a26_0x2b63('0x2'),{'value':!![]});const HttpClientService_1=require(a26_0x2b63('0x3'));const crypt_utils_1=__importDefault(require(a26_0x2b63('0x4')));const extract=require('../modules/jpeg-extract');const fsExtra=require(a26_0x2b63('0x5'));const base64Img=require(a26_0x2b63('0x6'));const isCorrupted=require(a26_0x2b63('0x7'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x2b63('0x8'));const fork=require(a26_0x2b63('0x9'))['fork'];class SyncVehicleService{constructor(_0x4683d6){this['url']=a26_0x2b63('0xa');this[a26_0x2b63('0xb')]=process['env'][a26_0x2b63('0xc')];this[a26_0x2b63('0xd')]=process['env'][a26_0x2b63('0xe')];this[a26_0x2b63('0xf')]=process[a26_0x2b63('0x10')]['VEHICLE_ID'];this['eventResults']=[{'file':a26_0x2b63('0x11'),'result':0x0},{'file':a26_0x2b63('0x12'),'result':0x0},{'file':a26_0x2b63('0x13'),'result':0x0}];this[a26_0x2b63('0x14')]=new HttpClientService_1[(a26_0x2b63('0x15'))]();this[a26_0x2b63('0x16')]=_0x4683d6;}['init2'](){console[a26_0x2b63('0x17')](a26_0x2b63('0x18'));const _0x5dc142=this['folder']+'image1.jpg';const _0x36bef3=this[a26_0x2b63('0xb')]+a26_0x2b63('0x19');}['init'](){console[a26_0x2b63('0x17')]('init\x20SyncVehicleService');this[a26_0x2b63('0x1a')]();setInterval(function(){this[a26_0x2b63('0x1a')]();}['bind'](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a26_0x2b63('0x1b')](this),0x7d0);setInterval(function(){this[a26_0x2b63('0x1c')]();}['bind'](this),0x3e8);}[a26_0x2b63('0x1c')](){for(let _0x4507d0=0x0;_0x4507d0<this[a26_0x2b63('0x1d')][a26_0x2b63('0x1e')];_0x4507d0++){this['driverValidationEvents'](_0x4507d0);}}[a26_0x2b63('0x1f')](_0x3f9cea){const _0x33fd29=this[a26_0x2b63('0x1d')][_0x3f9cea][a26_0x2b63('0x20')];const _0x2b96da=''+this['folder']+_0x33fd29;if(fsExtra[a26_0x2b63('0x21')](_0x2b96da)){const _0x20ef06=fsExtra['readFileSync'](_0x2b96da)[a26_0x2b63('0x22')]();if(this[a26_0x2b63('0x1d')][_0x3f9cea]['result']!=_0x20ef06){this['eventResults'][_0x3f9cea][a26_0x2b63('0x23')]=_0x20ef06;console[a26_0x2b63('0x17')](a26_0x2b63('0x1c'),this[a26_0x2b63('0x1d')][_0x3f9cea][a26_0x2b63('0x23')],_0x20ef06);const _0x4b32a4=this[a26_0x2b63('0xd')]+a26_0x2b63('0x24');const _0x6e9f9b=crypt_utils_1[a26_0x2b63('0x25')][a26_0x2b63('0x26')](_0x20ef06);console[a26_0x2b63('0x17')]('eventTypeId',_0x6e9f9b);const _0x3d5e1a=this['gpsService']?this[a26_0x2b63('0x16')]['locationParts']:{};const _0x489ae9=this['folder']+a26_0x2b63('0x27');let _0x575623=null;const _0x3a3237={'event_type_id':_0x6e9f9b,'vehicle_id':this['vehicleId'],'latitude':_0x3d5e1a[a26_0x2b63('0x28')]?_0x3d5e1a[a26_0x2b63('0x28')][a26_0x2b63('0x29')](',','.'):0x0,'longitude':_0x3d5e1a['longitude']?_0x3d5e1a['longitude'][a26_0x2b63('0x29')](',','.'):0x0,'speed':_0x3d5e1a[a26_0x2b63('0x2a')]?_0x3d5e1a[a26_0x2b63('0x2a')]:0x0,'reported_at':new Date(),'image_data':_0x575623};if(fsExtra[a26_0x2b63('0x21')](_0x489ae9)){_0x575623=base64Img[a26_0x2b63('0x2b')](_0x489ae9);_0x575623=JSON[a26_0x2b63('0x2c')](JSON[a26_0x2b63('0x2d')](_0x575623));_0x3a3237[a26_0x2b63('0x2e')]=_0x575623;}this['httpClientService'][a26_0x2b63('0x2f')](_0x4b32a4,_0x3a3237,![])[a26_0x2b63('0x30')](function(_0x530161){if(_0x530161[a26_0x2b63('0x31')]){}}[a26_0x2b63('0x1b')](this))[a26_0x2b63('0x32')](function(_0x3a4ad8){console['log']('err');});}}else{}}[a26_0x2b63('0x1a')](){const _0x22c314=this['apiURL']+a26_0x2b63('0x33')+this[a26_0x2b63('0xf')];this[a26_0x2b63('0x14')][a26_0x2b63('0x34')](_0x22c314,![])[a26_0x2b63('0x30')](function(_0x4ce5d4){if(_0x4ce5d4[a26_0x2b63('0x31')]){if(_0x4ce5d4[a26_0x2b63('0x35')]&&_0x4ce5d4[a26_0x2b63('0x35')][a26_0x2b63('0x1e')]>0x0&&_0x4ce5d4[a26_0x2b63('0x35')][0x0]['image_data']){this[a26_0x2b63('0x36')](_0x4ce5d4[a26_0x2b63('0x35')][0x0]);}}}['bind'](this))[a26_0x2b63('0x32')](function(_0x341f97){console[a26_0x2b63('0x17')](_0x341f97);});}[a26_0x2b63('0x36')](_0x3df2c9){let _0x5d1b9a='';const _0x2bbbc4=_0x3df2c9[a26_0x2b63('0x2e')][a26_0x2b63('0x29')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x3df2c9[a26_0x2b63('0x2e')][a26_0x2b63('0x37')](/^data:image\/png;base64,/,'')){_0x5d1b9a=a26_0x2b63('0x38');}else if(_0x3df2c9[a26_0x2b63('0x2e')][a26_0x2b63('0x37')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x5d1b9a=a26_0x2b63('0x39');}fsExtra[a26_0x2b63('0x3a')](this[a26_0x2b63('0xb')]);const _0x15c487=this[a26_0x2b63('0xb')]+'authorized_driver.'+_0x5d1b9a;const _0x2aa010=this[a26_0x2b63('0xb')]+a26_0x2b63('0x3b');fsExtra[a26_0x2b63('0x3c')](_0x15c487,_0x2bbbc4,a26_0x2b63('0x3d'),function(_0x333c4f){});fsExtra[a26_0x2b63('0x3c')](_0x2aa010,_0x3df2c9['user_id'],function(_0x32f973){});}[a26_0x2b63('0x3e')](){const _0x26abb1=new Date();const _0x1a0be1=_0x26abb1[a26_0x2b63('0x3f')]()-currentDriverImageDate['getTime']();if(_0x1a0be1>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x2b63('0x10')][a26_0x2b63('0x40')]+a26_0x2b63('0x41'),a26_0x2b63('0x42')+currentDriverImageDate+'\x22}',function(_0x8ee1a7){console[a26_0x2b63('0x17')]('Video\x20service\x20restarted');if(_0x8ee1a7){return console[a26_0x2b63('0x17')](_0x8ee1a7);}});}else{extract(this[a26_0x2b63('0x43')],(_0x6d1cfd,_0x26242e)=>{try{if(!_0x6d1cfd){const _0x40cee2=process['env']['FILES_FOLDER'];fsExtra[a26_0x2b63('0x3a')](_0x40cee2);const _0x377686=_0x40cee2+a26_0x2b63('0x44');const _0x2a2ed9=_0x40cee2+a26_0x2b63('0x27');fsExtra[a26_0x2b63('0x45')](_0x377686,_0x26242e);if(!isCorrupted(_0x377686)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x2b63('0x17')](a26_0x2b63('0x3e'),!![],new Date());fsExtra[a26_0x2b63('0x46')](_0x377686,_0x2a2ed9);}else{corruptedCounter++;console[a26_0x2b63('0x17')]('setCurrentDriverImage\x20corruptedCounter\x20********************:\x20',corruptedCounter);const _0xb187d5=new Date();const _0x4d3bae=_0xb187d5[a26_0x2b63('0x3f')]();fsExtra['copy'](_0x377686,_0x40cee2+_0x4d3bae[a26_0x2b63('0x22')]()+a26_0x2b63('0x47'));}}else{console[a26_0x2b63('0x48')]('extract',_0x6d1cfd);}}catch(_0x219f26){}finally{}});}}}exports[a26_0x2b63('0x49')]=SyncVehicleService;