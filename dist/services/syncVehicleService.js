var a27_0x9634=['default','encrypt','locationParts','current_driver.jpg','base64Sync','parse','stringify','latitude','longitude','post','success','catch','route_schedules/get_by_vehicle/','get','data','length','image_data','saveImageFile','replace','match','png','jpg','ensureDirSync','authorized_driver.','writeFile','base64','error','kill','__importDefault','__esModule','../infrastructure/crypt-utils','jpeg-extract','fs-extra','child_process','url','http://localhost:60/index1.jpg','currentDriverResult','env','FILES_FOLDER','apiURL','vehicleId','httpClientService','gpsService','init','log','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','folder','result_driver.txt','existsSync','readFileSync','toString','events/report_event/','driverResult'];(function(_0x1a7e53,_0x14cd4b){var _0x27632a=function(_0x2238a4){while(--_0x2238a4){_0x1a7e53['push'](_0x1a7e53['shift']());}};_0x27632a(++_0x14cd4b);}(a27_0x9634,0x8c));var a27_0x16b2=function(_0x560982,_0x31eb27){_0x560982=_0x560982-0x0;var _0x2e5805=a27_0x9634[_0x560982];return _0x2e5805;};'use strict';var __importDefault=this&&this[a27_0x16b2('0x0')]||function(_0x1aa840){return _0x1aa840&&_0x1aa840[a27_0x16b2('0x1')]?_0x1aa840:{'default':_0x1aa840};};Object['defineProperty'](exports,a27_0x16b2('0x1'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a27_0x16b2('0x2')));const extract=require(a27_0x16b2('0x3'));const fsExtra=require(a27_0x16b2('0x4'));const base64Img=require('base64-img');const fork=require(a27_0x16b2('0x5'))['fork'];let child;class SyncVehicleService{constructor(_0x553393){this[a27_0x16b2('0x6')]=a27_0x16b2('0x7');this[a27_0x16b2('0x8')]=null;this['folder']=process[a27_0x16b2('0x9')][a27_0x16b2('0xa')];this[a27_0x16b2('0xb')]=process[a27_0x16b2('0x9')]['API_SERVICE_URL'];this[a27_0x16b2('0xc')]=process[a27_0x16b2('0x9')]['VEHICLE_ID'];this[a27_0x16b2('0xd')]=new HttpClientService_1['HttpClientService']();this[a27_0x16b2('0xe')]=_0x553393;}[a27_0x16b2('0xf')](){console[a27_0x16b2('0x10')]('init\x20SyncVehicleService');this[a27_0x16b2('0x11')]();setInterval(function(){this[a27_0x16b2('0x11')]();}[a27_0x16b2('0x12')](this),0x2710);setInterval(function(){this[a27_0x16b2('0x13')]();}['bind'](this),0x3e8);setInterval(function(){this[a27_0x16b2('0x14')]();}['bind'](this),0x3e8);}[a27_0x16b2('0x14')](){const _0x3dfd3f=this[a27_0x16b2('0x15')]+a27_0x16b2('0x16');if(fsExtra[a27_0x16b2('0x17')](_0x3dfd3f)){const _0x273c6a=fsExtra[a27_0x16b2('0x18')](_0x3dfd3f)[a27_0x16b2('0x19')]();if(this[a27_0x16b2('0x8')]!=_0x273c6a){this[a27_0x16b2('0x8')]=_0x273c6a;const _0x1c8fdd=this[a27_0x16b2('0xb')]+a27_0x16b2('0x1a');console[a27_0x16b2('0x10')]('Send\x20event',_0x1c8fdd);console['log'](a27_0x16b2('0x1b'),_0x273c6a);const _0x103581=crypt_utils_1[a27_0x16b2('0x1c')][a27_0x16b2('0x1d')](_0x273c6a);console[a27_0x16b2('0x10')]('eventTypeId',_0x103581);const _0x2b234c=this[a27_0x16b2('0xe')]?this['gpsService'][a27_0x16b2('0x1e')]:{};const _0xd43759=this[a27_0x16b2('0x15')]+a27_0x16b2('0x1f');let _0x30467c=null;if(fsExtra[a27_0x16b2('0x17')](_0xd43759)){_0x30467c=base64Img[a27_0x16b2('0x20')](_0xd43759);_0x30467c=JSON[a27_0x16b2('0x21')](JSON[a27_0x16b2('0x22')](_0x30467c));_0x30467c=_0x30467c;}const _0x329a31={'event_type_id':_0x103581,'vehicle_id':this['vehicleId'],'latitude':_0x2b234c['latitude']?_0x2b234c[a27_0x16b2('0x23')]:0x0,'longitude':_0x2b234c[a27_0x16b2('0x24')]?_0x2b234c[a27_0x16b2('0x24')]:0x0,'speed':_0x2b234c['speed']?_0x2b234c['speed']:0x0,'reported_at':new Date(),'image_data':_0x30467c};this[a27_0x16b2('0xd')][a27_0x16b2('0x25')](_0x1c8fdd,_0x329a31,![])['then'](function(_0x4fa7d0){if(_0x4fa7d0[a27_0x16b2('0x26')]){}}[a27_0x16b2('0x12')](this))[a27_0x16b2('0x27')](function(_0x5ff67f){console['log'](_0x5ff67f);});}}}['loadAuthorizedDriver'](){console[a27_0x16b2('0x10')]('loadAuthorizedDriver');const _0x3511c4=this[a27_0x16b2('0xb')]+a27_0x16b2('0x28')+this[a27_0x16b2('0xc')];console[a27_0x16b2('0x10')](a27_0x16b2('0x11'),_0x3511c4);this[a27_0x16b2('0xd')][a27_0x16b2('0x29')](_0x3511c4,![])['then'](function(_0x46a2dd){if(_0x46a2dd['success']){if(_0x46a2dd['data']&&_0x46a2dd[a27_0x16b2('0x2a')][a27_0x16b2('0x2b')]>0x0&&_0x46a2dd[a27_0x16b2('0x2a')][0x0][a27_0x16b2('0x2c')]){this[a27_0x16b2('0x2d')](_0x46a2dd[a27_0x16b2('0x2a')][0x0]);}}}[a27_0x16b2('0x12')](this))[a27_0x16b2('0x27')](function(_0x36219b){console[a27_0x16b2('0x10')](_0x36219b);});}[a27_0x16b2('0x2d')](_0x3e6a2b){let _0x1cb4a4='';const _0x4dcec5=_0x3e6a2b[a27_0x16b2('0x2c')][a27_0x16b2('0x2e')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x3e6a2b[a27_0x16b2('0x2c')][a27_0x16b2('0x2f')](/^data:image\/png;base64,/,'')){_0x1cb4a4=a27_0x16b2('0x30');}else if(_0x3e6a2b['image_data'][a27_0x16b2('0x2f')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x1cb4a4=a27_0x16b2('0x31');}fsExtra[a27_0x16b2('0x32')](this['folder']);const _0xd68a4=this['folder']+a27_0x16b2('0x33')+_0x1cb4a4;const _0x3f8552=this[a27_0x16b2('0x15')]+'authorized_driver.txt';fsExtra[a27_0x16b2('0x34')](_0xd68a4,_0x4dcec5,a27_0x16b2('0x35'),function(_0x2bcc80){});fsExtra[a27_0x16b2('0x34')](_0x3f8552,_0x3e6a2b['user_id'],function(_0x29ce78){});}[a27_0x16b2('0x13')](){console[a27_0x16b2('0x10')](a27_0x16b2('0x13'));extract(this['url'])['then'](_0x189f1b=>{const _0x3ef4bf=process[a27_0x16b2('0x9')][a27_0x16b2('0xa')];fsExtra[a27_0x16b2('0x32')](_0x3ef4bf);const _0x5a4f35=_0x3ef4bf+'current_driver.jpg';fsExtra['writeFileSync'](_0x5a4f35,_0x189f1b);})[a27_0x16b2('0x27')](_0x2f0891=>{console[a27_0x16b2('0x36')](_0x2f0891);if(child!=null){child[a27_0x16b2('0x37')]();child=null;}});}}exports['SyncVehicleService']=SyncVehicleService;