var a26_0x434d=['file','existsSync','readFileSync','result','events/report_event/','eventTypeId','locationParts','current_driver.jpg','vehicleId','latitude','replace','longitude','speed','base64Sync','parse','image_data','post','then','success','catch','log','err','route_schedules/get_by_vehicle/','get','data','saveImageFile','png','match','authorized_driver.','writeFile','base64','user_id','getTime','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','SyncVehicleService','__importDefault','../infrastructure/HttpClientService','../infrastructure/crypt-utils','base64-img','jimp','urlVideo','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','VEHICLE_ID','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','init2','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','eventResults','length','driverValidationEvents'];(function(_0x5279a5,_0x5b6dbc){var _0x53e1d8=function(_0x2b612a){while(--_0x2b612a){_0x5279a5['push'](_0x5279a5['shift']());}};_0x53e1d8(++_0x5b6dbc);}(a26_0x434d,0xef));var a26_0x58b8=function(_0x5bb798,_0x8dd171){_0x5bb798=_0x5bb798-0x0;var _0x49baa0=a26_0x434d[_0x5bb798];return _0x49baa0;};'use strict';var __importDefault=this&&this[a26_0x58b8('0x0')]||function(_0x311431){return _0x311431&&_0x311431['__esModule']?_0x311431:{'default':_0x311431};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a26_0x58b8('0x1'));const crypt_utils_1=__importDefault(require(a26_0x58b8('0x2')));const extract=require('../modules/jpeg-extract');const fsExtra=require('fs-extra');const base64Img=require(a26_0x58b8('0x3'));const isCorrupted=require('is-corrupted-jpeg');let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x58b8('0x4'));const fork=require('child_process')['fork'];class SyncVehicleService{constructor(_0x40f0ca){this[a26_0x58b8('0x5')]=a26_0x58b8('0x6');this[a26_0x58b8('0x7')]=process[a26_0x58b8('0x8')][a26_0x58b8('0x9')];this[a26_0x58b8('0xa')]=process['env'][a26_0x58b8('0xb')];this['vehicleId']=process[a26_0x58b8('0x8')][a26_0x58b8('0xc')];this['eventResults']=[{'file':'result_driver.txt','result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':a26_0x58b8('0xd'),'result':0x0}];this[a26_0x58b8('0xe')]=new HttpClientService_1[(a26_0x58b8('0xf'))]();this[a26_0x58b8('0x10')]=_0x40f0ca;}[a26_0x58b8('0x11')](){console['log'](a26_0x58b8('0x12'));const _0x2ea5db=this['folder']+a26_0x58b8('0x13');const _0x6fb307=this[a26_0x58b8('0x7')]+a26_0x58b8('0x14');}[a26_0x58b8('0x15')](){console['log']('init\x20SyncVehicleService');this[a26_0x58b8('0x16')]();setInterval(function(){this[a26_0x58b8('0x16')]();}[a26_0x58b8('0x17')](this),0x2710);setInterval(function(){this[a26_0x58b8('0x18')]();}[a26_0x58b8('0x17')](this),0x7d0);setInterval(function(){this[a26_0x58b8('0x19')]();}[a26_0x58b8('0x17')](this),0x3e8);}['syncEvents'](){for(let _0x3432e0=0x0;_0x3432e0<this[a26_0x58b8('0x1a')][a26_0x58b8('0x1b')];_0x3432e0++){this[a26_0x58b8('0x1c')](_0x3432e0);}}[a26_0x58b8('0x1c')](_0x4b8b02){const _0x56f44d=this[a26_0x58b8('0x1a')][_0x4b8b02][a26_0x58b8('0x1d')];const _0x5e4342=''+this[a26_0x58b8('0x7')]+_0x56f44d;if(fsExtra[a26_0x58b8('0x1e')](_0x5e4342)){const _0x2d9c1b=fsExtra[a26_0x58b8('0x1f')](_0x5e4342)['toString']();if(this[a26_0x58b8('0x1a')][_0x4b8b02]['result']!=_0x2d9c1b){this['eventResults'][_0x4b8b02][a26_0x58b8('0x20')]=_0x2d9c1b;console['log'](a26_0x58b8('0x19'),this[a26_0x58b8('0x1a')][_0x4b8b02][a26_0x58b8('0x20')],_0x2d9c1b);const _0x303c3c=this[a26_0x58b8('0xa')]+a26_0x58b8('0x21');const _0x5e513e=crypt_utils_1['default']['encrypt'](_0x2d9c1b);console['log'](a26_0x58b8('0x22'),_0x5e513e);const _0x3c423e=this['gpsService']?this[a26_0x58b8('0x10')][a26_0x58b8('0x23')]:{};const _0x3a40db=this['folder']+a26_0x58b8('0x24');let _0x41627d=null;const _0x2842a8={'event_type_id':_0x5e513e,'vehicle_id':this[a26_0x58b8('0x25')],'latitude':_0x3c423e['latitude']?_0x3c423e[a26_0x58b8('0x26')][a26_0x58b8('0x27')](',','.'):0x0,'longitude':_0x3c423e[a26_0x58b8('0x28')]?_0x3c423e[a26_0x58b8('0x28')][a26_0x58b8('0x27')](',','.'):0x0,'speed':_0x3c423e[a26_0x58b8('0x29')]?_0x3c423e[a26_0x58b8('0x29')]:0x0,'reported_at':new Date(),'image_data':_0x41627d};if(fsExtra[a26_0x58b8('0x1e')](_0x3a40db)){_0x41627d=base64Img[a26_0x58b8('0x2a')](_0x3a40db);_0x41627d=JSON[a26_0x58b8('0x2b')](JSON['stringify'](_0x41627d));_0x2842a8[a26_0x58b8('0x2c')]=_0x41627d;}this['httpClientService'][a26_0x58b8('0x2d')](_0x303c3c,_0x2842a8,![])[a26_0x58b8('0x2e')](function(_0x2742e6){if(_0x2742e6[a26_0x58b8('0x2f')]){}}['bind'](this))[a26_0x58b8('0x30')](function(_0x218bd4){console[a26_0x58b8('0x31')](a26_0x58b8('0x32'));});}}else{}}['loadAuthorizedDriver'](){const _0x4cd4f9=this[a26_0x58b8('0xa')]+a26_0x58b8('0x33')+this[a26_0x58b8('0x25')];this[a26_0x58b8('0xe')][a26_0x58b8('0x34')](_0x4cd4f9,![])[a26_0x58b8('0x2e')](function(_0x3a21ae){if(_0x3a21ae[a26_0x58b8('0x2f')]){if(_0x3a21ae[a26_0x58b8('0x35')]&&_0x3a21ae[a26_0x58b8('0x35')]['length']>0x0&&_0x3a21ae[a26_0x58b8('0x35')][0x0][a26_0x58b8('0x2c')]){this[a26_0x58b8('0x36')](_0x3a21ae[a26_0x58b8('0x35')][0x0]);}}}[a26_0x58b8('0x17')](this))['catch'](function(_0x5cb9f6){console[a26_0x58b8('0x31')](_0x5cb9f6);});}[a26_0x58b8('0x36')](_0x3d242f){let _0x3a0587='';const _0x8b58dc=_0x3d242f['image_data'][a26_0x58b8('0x27')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x3d242f[a26_0x58b8('0x2c')]['match'](/^data:image\/png;base64,/,'')){_0x3a0587=a26_0x58b8('0x37');}else if(_0x3d242f['image_data'][a26_0x58b8('0x38')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x3a0587='jpg';}fsExtra['ensureDirSync'](this[a26_0x58b8('0x7')]);const _0x2b29ce=this['folder']+a26_0x58b8('0x39')+_0x3a0587;const _0x1c4f52=this['folder']+'authorized_driver.txt';fsExtra[a26_0x58b8('0x3a')](_0x2b29ce,_0x8b58dc,a26_0x58b8('0x3b'),function(_0x5b02f2){});fsExtra[a26_0x58b8('0x3a')](_0x1c4f52,_0x3d242f[a26_0x58b8('0x3c')],function(_0x388e76){});}[a26_0x58b8('0x18')](){const _0x387c8f=new Date();const _0x50582a=_0x387c8f[a26_0x58b8('0x3d')]()-currentDriverImageDate[a26_0x58b8('0x3d')]();extract(this[a26_0x58b8('0x5')],(_0x58d810,_0x3944ac)=>{try{if(!_0x58d810){const _0x26e2e1=process['env'][a26_0x58b8('0x9')];fsExtra['ensureDirSync'](_0x26e2e1);const _0x3ed320=_0x26e2e1+a26_0x58b8('0x3e');const _0x51cab5=_0x26e2e1+'current_driver.jpg';fsExtra[a26_0x58b8('0x3f')](_0x3ed320,_0x3944ac);if(!isCorrupted(_0x3ed320)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a26_0x58b8('0x40')](_0x3ed320,_0x51cab5);}else{corruptedCounter++;console[a26_0x58b8('0x31')](a26_0x58b8('0x41'),corruptedCounter);const _0xe5e4a0=new Date();const _0x123266=_0xe5e4a0[a26_0x58b8('0x3d')]();fsExtra[a26_0x58b8('0x40')](_0x3ed320,_0x26e2e1+_0x123266['toString']()+'.jpg');}}else{}}catch(_0x49407b){}finally{}});}}exports[a26_0x58b8('0x42')]=SyncVehicleService;