var a27_0xdf0b=['post','then','success','catch','route_schedules/get_by_vehicle/','get','data','image_data','saveImageFile','replace','match','png','ensureDirSync','authorized_driver.','writeFile','base64','user_id','setCurrentDriverImage','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','extract','SyncVehicleService','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','jpeg-extract','base64-img','is-corrupted-jpeg','fork','url','http://localhost:60/index1.jpg','FILES_FOLDER','apiURL','API_SERVICE_URL','vehicleId','env','eventResults','result_driver.txt','result_driver_behaviour.txt','HttpClientService','gpsService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','syncEvents','length','driverValidationEvents','file','folder','existsSync','readFileSync','result','default','encrypt','eventTypeId','locationParts','current_driver.jpg','base64Sync','parse','stringify','latitude','longitude','speed','httpClientService'];(function(_0x51fc1e,_0x87f5f4){var _0x5c7da2=function(_0x387bad){while(--_0x387bad){_0x51fc1e['push'](_0x51fc1e['shift']());}};_0x5c7da2(++_0x87f5f4);}(a27_0xdf0b,0x136));var a27_0xe9b0=function(_0x1fa6e7,_0x156d88){_0x1fa6e7=_0x1fa6e7-0x0;var _0x41d214=a27_0xdf0b[_0x1fa6e7];return _0x41d214;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x14d50b){return _0x14d50b&&_0x14d50b[a27_0xe9b0('0x0')]?_0x14d50b:{'default':_0x14d50b};};Object[a27_0xe9b0('0x1')](exports,a27_0xe9b0('0x0'),{'value':!![]});const HttpClientService_1=require(a27_0xe9b0('0x2'));const crypt_utils_1=__importDefault(require(a27_0xe9b0('0x3')));const extract=require(a27_0xe9b0('0x4'));const fsExtra=require('fs-extra');const base64Img=require(a27_0xe9b0('0x5'));const isCorrupted=require(a27_0xe9b0('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require('child_process')[a27_0xe9b0('0x7')];class SyncVehicleService{constructor(_0x54676f){this[a27_0xe9b0('0x8')]=a27_0xe9b0('0x9');this['folder']=process['env'][a27_0xe9b0('0xa')];this[a27_0xe9b0('0xb')]=process['env'][a27_0xe9b0('0xc')];this[a27_0xe9b0('0xd')]=process[a27_0xe9b0('0xe')]['VEHICLE_ID'];this[a27_0xe9b0('0xf')]=[{'file':a27_0xe9b0('0x10'),'result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':a27_0xe9b0('0x11'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a27_0xe9b0('0x12'))]();this[a27_0xe9b0('0x13')]=_0x54676f;}[a27_0xe9b0('0x14')](){console[a27_0xe9b0('0x15')](a27_0xe9b0('0x16'));this['loadAuthorizedDriver']();setInterval(function(){this[a27_0xe9b0('0x17')]();}[a27_0xe9b0('0x18')](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a27_0xe9b0('0x18')](this),0x7d0);setInterval(function(){this[a27_0xe9b0('0x19')]();}['bind'](this),0x3e8);}[a27_0xe9b0('0x19')](){for(let _0x163a01=0x0;_0x163a01<this[a27_0xe9b0('0xf')][a27_0xe9b0('0x1a')];_0x163a01++){this['driverValidationEvents'](_0x163a01);}}[a27_0xe9b0('0x1b')](_0x4edf1c){const _0x1a0ccf=this[a27_0xe9b0('0xf')][_0x4edf1c][a27_0xe9b0('0x1c')];const _0x505523=''+this[a27_0xe9b0('0x1d')]+_0x1a0ccf;if(fsExtra[a27_0xe9b0('0x1e')](_0x505523)){const _0x3e8c02=fsExtra[a27_0xe9b0('0x1f')](_0x505523)['toString']();if(this[a27_0xe9b0('0xf')][_0x4edf1c]['result']!=_0x3e8c02){this[a27_0xe9b0('0xf')][_0x4edf1c]['result']=_0x3e8c02;console[a27_0xe9b0('0x15')](a27_0xe9b0('0x19'),this[a27_0xe9b0('0xf')][_0x4edf1c][a27_0xe9b0('0x20')],_0x3e8c02);const _0x2f54e0=this[a27_0xe9b0('0xb')]+'events/report_event/';const _0x1f58d1=crypt_utils_1[a27_0xe9b0('0x21')][a27_0xe9b0('0x22')](_0x3e8c02);console[a27_0xe9b0('0x15')](a27_0xe9b0('0x23'),_0x1f58d1);const _0x49bcb3=this[a27_0xe9b0('0x13')]?this[a27_0xe9b0('0x13')][a27_0xe9b0('0x24')]:{};const _0x31f8b7=this[a27_0xe9b0('0x1d')]+a27_0xe9b0('0x25');let _0x46df94=null;if(fsExtra[a27_0xe9b0('0x1e')](_0x31f8b7)){_0x46df94=base64Img[a27_0xe9b0('0x26')](_0x31f8b7);_0x46df94=JSON[a27_0xe9b0('0x27')](JSON[a27_0xe9b0('0x28')](_0x46df94));_0x46df94=_0x46df94;}const _0xc70532={'event_type_id':_0x1f58d1,'vehicle_id':this[a27_0xe9b0('0xd')],'latitude':_0x49bcb3[a27_0xe9b0('0x29')]?_0x49bcb3[a27_0xe9b0('0x29')]:0x0,'longitude':_0x49bcb3[a27_0xe9b0('0x2a')]?_0x49bcb3[a27_0xe9b0('0x2a')]:0x0,'speed':_0x49bcb3[a27_0xe9b0('0x2b')]?_0x49bcb3['speed']:0x0,'reported_at':new Date(),'image_data':_0x46df94};console[a27_0xe9b0('0x15')]('eventData:\x20',_0xc70532);this[a27_0xe9b0('0x2c')][a27_0xe9b0('0x2d')](_0x2f54e0,_0xc70532,![])[a27_0xe9b0('0x2e')](function(_0x43bc93){if(_0x43bc93[a27_0xe9b0('0x2f')]){}}[a27_0xe9b0('0x18')](this))[a27_0xe9b0('0x30')](function(_0x4aba8d){console[a27_0xe9b0('0x15')](_0x4aba8d);});}}}['loadAuthorizedDriver'](){const _0x3ffcb6=this[a27_0xe9b0('0xb')]+a27_0xe9b0('0x31')+this[a27_0xe9b0('0xd')];this[a27_0xe9b0('0x2c')][a27_0xe9b0('0x32')](_0x3ffcb6,![])['then'](function(_0x4d04a0){if(_0x4d04a0['success']){if(_0x4d04a0['data']&&_0x4d04a0[a27_0xe9b0('0x33')][a27_0xe9b0('0x1a')]>0x0&&_0x4d04a0['data'][0x0][a27_0xe9b0('0x34')]){this[a27_0xe9b0('0x35')](_0x4d04a0[a27_0xe9b0('0x33')][0x0]);}}}[a27_0xe9b0('0x18')](this))[a27_0xe9b0('0x30')](function(_0x1d0be7){console[a27_0xe9b0('0x15')](_0x1d0be7);});}['saveImageFile'](_0x196246){let _0x392705='';const _0x3c4ff0=_0x196246[a27_0xe9b0('0x34')][a27_0xe9b0('0x36')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x196246[a27_0xe9b0('0x34')][a27_0xe9b0('0x37')](/^data:image\/png;base64,/,'')){_0x392705=a27_0xe9b0('0x38');}else if(_0x196246[a27_0xe9b0('0x34')][a27_0xe9b0('0x37')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x392705='jpg';}fsExtra[a27_0xe9b0('0x39')](this[a27_0xe9b0('0x1d')]);const _0x5ec4af=this[a27_0xe9b0('0x1d')]+a27_0xe9b0('0x3a')+_0x392705;const _0x23b921=this[a27_0xe9b0('0x1d')]+'authorized_driver.txt';fsExtra[a27_0xe9b0('0x3b')](_0x5ec4af,_0x3c4ff0,a27_0xe9b0('0x3c'),function(_0x219da2){});fsExtra['writeFile'](_0x23b921,_0x196246[a27_0xe9b0('0x3d')],function(_0x1b077b){});}[a27_0xe9b0('0x3e')](){const _0x270875=new Date();const _0x48f740=_0x270875[a27_0xe9b0('0x3f')]()-currentDriverImageDate[a27_0xe9b0('0x3f')]();if(_0x48f740>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0xe9b0('0x3b')](process[a27_0xe9b0('0xe')][a27_0xe9b0('0x40')]+a27_0xe9b0('0x41'),a27_0xe9b0('0x42')+currentDriverImageDate+'\x22}',function(_0x20ee1e){console[a27_0xe9b0('0x15')](a27_0xe9b0('0x43'));if(_0x20ee1e){return console[a27_0xe9b0('0x15')](_0x20ee1e);}});}else{extract(this['url'],(_0x5ed4db,_0x52c6e5)=>{try{if(!_0x5ed4db){const _0x3b3b77=process[a27_0xe9b0('0xe')][a27_0xe9b0('0xa')];fsExtra['ensureDirSync'](_0x3b3b77);const _0x4db390=_0x3b3b77+a27_0xe9b0('0x44');const _0x361853=_0x3b3b77+a27_0xe9b0('0x25');fsExtra['writeFileSync'](_0x4db390,_0x52c6e5);if(!isCorrupted(_0x4db390)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra['copy'](_0x4db390,_0x361853);}else{corruptedCounter++;console[a27_0xe9b0('0x15')](a27_0xe9b0('0x3e'),corruptedCounter);}}else{console['error'](a27_0xe9b0('0x45'),_0x5ed4db);}}catch(_0x310ac0){}finally{}});}}}exports[a27_0xe9b0('0x46')]=SyncVehicleService;