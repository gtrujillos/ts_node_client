var a29_0x3c85=['vehicleId','eventResults','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','init2','image2.jpg','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','setCurrentDriverImage','bind','length','driverValidationEvents','existsSync','readFileSync','syncEvents','result','encrypt','eventTypeId','gpsService','locationParts','current_driver.jpg','latitude','replace','longitude','speed','base64Sync','parse','stringify','image_data','route_schedules/get_by_vehicle/','then','success','data','saveImageFile','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','base64','writeFile','user_id','getTime','current_driver_temp.jpg','writeFileSync','copy','toString','.jpg','SyncVehicleService','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','is-corrupted-jpeg','jimp','fork','env','DEV_MODE','true','urlVideo','http://localhost:60/cam1.jpg','folder','FILES_FOLDER','apiURL','API_SERVICE_URL'];(function(_0x44f990,_0x63513f){var _0x3261cd=function(_0x5953a5){while(--_0x5953a5){_0x44f990['push'](_0x44f990['shift']());}};_0x3261cd(++_0x63513f);}(a29_0x3c85,0x7e));var a29_0x1547=function(_0x139c75,_0x105507){_0x139c75=_0x139c75-0x0;var _0x3f1469=a29_0x3c85[_0x139c75];return _0x3f1469;};'use strict';var __importDefault=this&&this[a29_0x1547('0x0')]||function(_0x4a536e){return _0x4a536e&&_0x4a536e[a29_0x1547('0x1')]?_0x4a536e:{'default':_0x4a536e};};Object[a29_0x1547('0x2')](exports,a29_0x1547('0x1'),{'value':!![]});const HttpClientService_1=require(a29_0x1547('0x3'));const crypt_utils_1=__importDefault(require(a29_0x1547('0x4')));const extract=require(a29_0x1547('0x5'));const fsExtra=require(a29_0x1547('0x6'));const base64Img=require(a29_0x1547('0x7'));const isCorrupted=require(a29_0x1547('0x8'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a29_0x1547('0x9'));const fork=require('child_process')[a29_0x1547('0xa')];class SyncVehicleService{constructor(_0x52289f){this['devMode']=process[a29_0x1547('0xb')][a29_0x1547('0xc')]==a29_0x1547('0xd');this[a29_0x1547('0xe')]=a29_0x1547('0xf');this[a29_0x1547('0x10')]=process[a29_0x1547('0xb')][a29_0x1547('0x11')];this[a29_0x1547('0x12')]=process[a29_0x1547('0xb')][a29_0x1547('0x13')];this[a29_0x1547('0x14')]=process[a29_0x1547('0xb')]['VEHICLE_ID'];this[a29_0x1547('0x15')]=[{'file':'result_driver.txt','result':0x0},{'file':a29_0x1547('0x16'),'result':0x0},{'file':a29_0x1547('0x17'),'result':0x0}];this[a29_0x1547('0x18')]=new HttpClientService_1[(a29_0x1547('0x19'))]();this['gpsService']=_0x52289f;}[a29_0x1547('0x1a')](){console['log']('init\x20SyncVehicleService\x20test22');const _0x1c7389=this['folder']+'image1.jpg';const _0x466471=this['folder']+a29_0x1547('0x1b');}[a29_0x1547('0x1c')](){console[a29_0x1547('0x1d')](a29_0x1547('0x1e'));this[a29_0x1547('0x1f')]();setInterval(function(){this['loadAuthorizedDriver']();}['bind'](this),0x2710);setInterval(function(){this[a29_0x1547('0x20')]();}[a29_0x1547('0x21')](this),0x7d0);}['syncEvents_old'](){for(let _0x19624e=0x0;_0x19624e<this[a29_0x1547('0x15')][a29_0x1547('0x22')];_0x19624e++){this[a29_0x1547('0x23')](_0x19624e);}}[a29_0x1547('0x23')](_0x472eb9){const _0x2d32cc=this['eventResults'][_0x472eb9]['file'];const _0x16dc82=''+this[a29_0x1547('0x10')]+_0x2d32cc;if(fsExtra[a29_0x1547('0x24')](_0x16dc82)){const _0x14abf7=fsExtra[a29_0x1547('0x25')](_0x16dc82)['toString']();if(this[a29_0x1547('0x15')][_0x472eb9]['result']!=_0x14abf7){this['eventResults'][_0x472eb9]['result']=_0x14abf7;console[a29_0x1547('0x1d')](a29_0x1547('0x26'),this[a29_0x1547('0x15')][_0x472eb9][a29_0x1547('0x27')],_0x14abf7);const _0x1e3cce=crypt_utils_1['default'][a29_0x1547('0x28')](_0x14abf7);console['log'](a29_0x1547('0x29'),_0x1e3cce);const _0x11cc67=this[a29_0x1547('0x2a')]?this[a29_0x1547('0x2a')][a29_0x1547('0x2b')]:{};const _0x2f154e=this['folder']+a29_0x1547('0x2c');let _0x3e3a2d=null;const _0x2d3e1b={'event_type_id':_0x1e3cce,'vehicle_id':this[a29_0x1547('0x14')],'latitude':_0x11cc67[a29_0x1547('0x2d')]?_0x11cc67[a29_0x1547('0x2d')][a29_0x1547('0x2e')](',','.'):0x0,'longitude':_0x11cc67[a29_0x1547('0x2f')]?_0x11cc67[a29_0x1547('0x2f')][a29_0x1547('0x2e')](',','.'):0x0,'speed':_0x11cc67[a29_0x1547('0x30')]?_0x11cc67[a29_0x1547('0x30')]:0x0,'reported_at':new Date(),'image_data':_0x3e3a2d};if(fsExtra[a29_0x1547('0x24')](_0x2f154e)){_0x3e3a2d=base64Img[a29_0x1547('0x31')](_0x2f154e);_0x3e3a2d=JSON[a29_0x1547('0x32')](JSON[a29_0x1547('0x33')](_0x3e3a2d));_0x2d3e1b[a29_0x1547('0x34')]=_0x3e3a2d;}}}else{}}[a29_0x1547('0x1f')](){const _0x159e61=this[a29_0x1547('0x12')]+a29_0x1547('0x35')+this[a29_0x1547('0x14')];this[a29_0x1547('0x18')]['get'](_0x159e61,![])[a29_0x1547('0x36')](function(_0x24dc99){if(_0x24dc99[a29_0x1547('0x37')]){if(_0x24dc99[a29_0x1547('0x38')]&&_0x24dc99[a29_0x1547('0x38')][a29_0x1547('0x22')]>0x0&&_0x24dc99[a29_0x1547('0x38')][0x0][a29_0x1547('0x34')]){this[a29_0x1547('0x39')](_0x24dc99[a29_0x1547('0x38')][0x0]);}}}[a29_0x1547('0x21')](this))['catch'](function(_0x4c1587){console[a29_0x1547('0x1d')](_0x4c1587);});}[a29_0x1547('0x39')](_0x2cb2dc){let _0x3b73ad='';const _0x37cf25=_0x2cb2dc['image_data']['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x2cb2dc[a29_0x1547('0x34')][a29_0x1547('0x3a')](/^data:image\/png;base64,/,'')){_0x3b73ad='png';}else if(_0x2cb2dc[a29_0x1547('0x34')][a29_0x1547('0x3a')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x3b73ad=a29_0x1547('0x3b');}fsExtra[a29_0x1547('0x3c')](this[a29_0x1547('0x10')]);const _0x5ab806=this[a29_0x1547('0x10')]+a29_0x1547('0x3d')+_0x3b73ad;const _0x2ade9a=this[a29_0x1547('0x10')]+a29_0x1547('0x3e');fsExtra['writeFile'](_0x5ab806,_0x37cf25,a29_0x1547('0x3f'),function(_0x7dc2da){});fsExtra[a29_0x1547('0x40')](_0x2ade9a,_0x2cb2dc[a29_0x1547('0x41')],function(_0x5b945e){});}[a29_0x1547('0x20')](){const _0x1e9a4e=new Date();const _0x302dda=_0x1e9a4e[a29_0x1547('0x42')]()-currentDriverImageDate[a29_0x1547('0x42')]();extract(this[a29_0x1547('0xe')],(_0x1aeb02,_0x2af9d1)=>{try{if(!_0x1aeb02){const _0x272a6e=process[a29_0x1547('0xb')][a29_0x1547('0x11')];fsExtra['ensureDirSync'](_0x272a6e);const _0x37f4c0=_0x272a6e+a29_0x1547('0x43');const _0x12d595=_0x272a6e+'current_driver.jpg';fsExtra[a29_0x1547('0x44')](_0x37f4c0,_0x2af9d1);if(!isCorrupted(_0x37f4c0)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a29_0x1547('0x45')](_0x37f4c0,_0x12d595);}else{corruptedCounter++;console[a29_0x1547('0x1d')]('setCurrentDriverImage\x20corruptedCounter\x20********************:\x20',corruptedCounter);const _0x444814=new Date();const _0x45cb4d=_0x444814[a29_0x1547('0x42')]();fsExtra['copy'](_0x37f4c0,_0x272a6e+_0x45cb4d[a29_0x1547('0x46')]()+a29_0x1547('0x47'));}}else{}}catch(_0x2ac162){}finally{}});}}exports[a29_0x1547('0x48')]=SyncVehicleService;