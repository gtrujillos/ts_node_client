var a27_0x4032=['post','success','catch','get','then','data','length','saveImageFile','image_data','replace','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','user_id','setCurrentDriverImage','getTime','VIDEO_SERVICE_FILES_FOLDER','{\x22status\x22:\x20\x22','The\x20file\x20was\x20saved!','extracted','current_driver_temp.jpg','current_driver.jpg','writeFileSync','copy','extract','SyncVehicleService','__importDefault','defineProperty','__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','fs-extra','base64-img','is-corrupted-jpeg','fork','url','currentDriverResult','folder','FILES_FOLDER','apiURL','env','API_SERVICE_URL','httpClientService','HttpClientService','gpsService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','syncEvents','result_driver.txt','existsSync','toString','events/report_event/','Send\x20event','encrypt','eventTypeId','locationParts','base64Sync','parse','stringify','vehicleId','latitude','longitude','speed'];(function(_0x5102dd,_0x134b4f){var _0x44bc35=function(_0x3ee19a){while(--_0x3ee19a){_0x5102dd['push'](_0x5102dd['shift']());}};_0x44bc35(++_0x134b4f);}(a27_0x4032,0xf4));var a27_0x51eb=function(_0x6e8700,_0x1ffe35){_0x6e8700=_0x6e8700-0x0;var _0x54ae69=a27_0x4032[_0x6e8700];return _0x54ae69;};'use strict';var __importDefault=this&&this[a27_0x51eb('0x0')]||function(_0x21d818){return _0x21d818&&_0x21d818['__esModule']?_0x21d818:{'default':_0x21d818};};Object[a27_0x51eb('0x1')](exports,a27_0x51eb('0x2'),{'value':!![]});const HttpClientService_1=require(a27_0x51eb('0x3'));const crypt_utils_1=__importDefault(require(a27_0x51eb('0x4')));const extract=require('jpeg-extract');const fsExtra=require(a27_0x51eb('0x5'));const base64Img=require(a27_0x51eb('0x6'));const isCorrupted=require(a27_0x51eb('0x7'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require('child_process')[a27_0x51eb('0x8')];class SyncVehicleService{constructor(_0x8e73fc){this[a27_0x51eb('0x9')]='http://localhost:60/index1.jpg';this[a27_0x51eb('0xa')]=null;this[a27_0x51eb('0xb')]=process['env'][a27_0x51eb('0xc')];this[a27_0x51eb('0xd')]=process[a27_0x51eb('0xe')][a27_0x51eb('0xf')];this['vehicleId']=process[a27_0x51eb('0xe')]['VEHICLE_ID'];this[a27_0x51eb('0x10')]=new HttpClientService_1[(a27_0x51eb('0x11'))]();this[a27_0x51eb('0x12')]=_0x8e73fc;}[a27_0x51eb('0x13')](){console[a27_0x51eb('0x14')](a27_0x51eb('0x15'));this['loadAuthorizedDriver']();setInterval(function(){this[a27_0x51eb('0x16')]();}[a27_0x51eb('0x17')](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a27_0x51eb('0x17')](this),0x7d0);setInterval(function(){this[a27_0x51eb('0x18')]();}[a27_0x51eb('0x17')](this),0x3e8);}[a27_0x51eb('0x18')](){const _0x85232e=this[a27_0x51eb('0xb')]+a27_0x51eb('0x19');if(fsExtra[a27_0x51eb('0x1a')](_0x85232e)){const _0x1f399c=fsExtra['readFileSync'](_0x85232e)[a27_0x51eb('0x1b')]();if(this[a27_0x51eb('0xa')]!=_0x1f399c){this[a27_0x51eb('0xa')]=_0x1f399c;const _0x532bc6=this[a27_0x51eb('0xd')]+a27_0x51eb('0x1c');console['log'](a27_0x51eb('0x1d'),_0x532bc6);console[a27_0x51eb('0x14')]('driverResult',_0x1f399c);const _0x5ace47=crypt_utils_1['default'][a27_0x51eb('0x1e')](_0x1f399c);console['log'](a27_0x51eb('0x1f'),_0x5ace47);const _0x305324=this['gpsService']?this[a27_0x51eb('0x12')][a27_0x51eb('0x20')]:{};const _0x4b815b=this['folder']+'current_driver.jpg';let _0x387702=null;if(fsExtra['existsSync'](_0x4b815b)){_0x387702=base64Img[a27_0x51eb('0x21')](_0x4b815b);_0x387702=JSON[a27_0x51eb('0x22')](JSON[a27_0x51eb('0x23')](_0x387702));_0x387702=_0x387702;}const _0x50862b={'event_type_id':_0x5ace47,'vehicle_id':this[a27_0x51eb('0x24')],'latitude':_0x305324['latitude']?_0x305324[a27_0x51eb('0x25')]:0x0,'longitude':_0x305324[a27_0x51eb('0x26')]?_0x305324['longitude']:0x0,'speed':_0x305324[a27_0x51eb('0x27')]?_0x305324[a27_0x51eb('0x27')]:0x0,'reported_at':new Date(),'image_data':_0x387702};this['httpClientService'][a27_0x51eb('0x28')](_0x532bc6,_0x50862b,![])['then'](function(_0x3b9667){if(_0x3b9667[a27_0x51eb('0x29')]){}}[a27_0x51eb('0x17')](this))[a27_0x51eb('0x2a')](function(_0x4d116f){console[a27_0x51eb('0x14')](_0x4d116f);});}}}[a27_0x51eb('0x16')](){console[a27_0x51eb('0x14')]('loadAuthorizedDriver');const _0x192130=this[a27_0x51eb('0xd')]+'route_schedules/get_by_vehicle/'+this[a27_0x51eb('0x24')];console[a27_0x51eb('0x14')](a27_0x51eb('0x16'),_0x192130);this[a27_0x51eb('0x10')][a27_0x51eb('0x2b')](_0x192130,![])[a27_0x51eb('0x2c')](function(_0x569e12){if(_0x569e12[a27_0x51eb('0x29')]){if(_0x569e12[a27_0x51eb('0x2d')]&&_0x569e12[a27_0x51eb('0x2d')][a27_0x51eb('0x2e')]>0x0&&_0x569e12[a27_0x51eb('0x2d')][0x0]['image_data']){this[a27_0x51eb('0x2f')](_0x569e12['data'][0x0]);}}}['bind'](this))[a27_0x51eb('0x2a')](function(_0x300bdd){console[a27_0x51eb('0x14')](_0x300bdd);});}[a27_0x51eb('0x2f')](_0x5db1a6){let _0x4ed32f='';const _0x3c2075=_0x5db1a6[a27_0x51eb('0x30')][a27_0x51eb('0x31')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x5db1a6['image_data'][a27_0x51eb('0x32')](/^data:image\/png;base64,/,'')){_0x4ed32f=a27_0x51eb('0x33');}else if(_0x5db1a6[a27_0x51eb('0x30')][a27_0x51eb('0x32')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x4ed32f=a27_0x51eb('0x34');}fsExtra[a27_0x51eb('0x35')](this['folder']);const _0x369c92=this[a27_0x51eb('0xb')]+a27_0x51eb('0x36')+_0x4ed32f;const _0x5dfc92=this[a27_0x51eb('0xb')]+a27_0x51eb('0x37');fsExtra[a27_0x51eb('0x38')](_0x369c92,_0x3c2075,a27_0x51eb('0x39'),function(_0x59402e){});fsExtra['writeFile'](_0x5dfc92,_0x5db1a6[a27_0x51eb('0x3a')],function(_0x42a991){});}['setCurrentDriverImage'](){console['log'](a27_0x51eb('0x3b'),currentDriverImageDate);const _0x5d9919=new Date();const _0x4f01cb=_0x5d9919[a27_0x51eb('0x3c')]()-currentDriverImageDate[a27_0x51eb('0x3c')]();console['log'](_0x4f01cb);if(_0x4f01cb>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x51eb('0x38')](process['env'][a27_0x51eb('0x3d')]+'status.json',a27_0x51eb('0x3e')+currentDriverImageDate+'\x22}',function(_0x340f37){if(_0x340f37){return console[a27_0x51eb('0x14')](_0x340f37);}console[a27_0x51eb('0x14')](a27_0x51eb('0x3f'));});}else{extract(this[a27_0x51eb('0x9')],(_0x330cb2,_0x345b)=>{try{if(!_0x330cb2){console[a27_0x51eb('0x14')](a27_0x51eb('0x40'));const _0x2d5322=process['env'][a27_0x51eb('0xc')];fsExtra['ensureDirSync'](_0x2d5322);const _0x13be19=_0x2d5322+a27_0x51eb('0x41');const _0x422dbd=_0x2d5322+a27_0x51eb('0x42');fsExtra[a27_0x51eb('0x43')](_0x13be19,_0x345b);if(!isCorrupted(_0x13be19)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a27_0x51eb('0x14')](a27_0x51eb('0x3b'),!![]);fsExtra[a27_0x51eb('0x44')](_0x13be19,_0x422dbd);}else{corruptedCounter++;console[a27_0x51eb('0x14')]('setCurrentDriverImage',corruptedCounter);}}else{console['error'](a27_0x51eb('0x45'),_0x330cb2);}}catch(_0x2a0301){}finally{}});}}}exports[a27_0x51eb('0x46')]=SyncVehicleService;