var a29_0x31c2=['longitude','speed','existsSync','base64Sync','parse','stringify','image_data','route_schedules/get_by_vehicle/','get','then','data','catch','saveImageFile','match','png','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','user_id','getTime','FILES_FOLDER','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','SyncVehicleService','__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','jimp','fork','devMode','env','true','urlVideo','http://passcontrol.co:60/cam1.jpg','http://localhost:60/cam1.jpg','folder','apiURL','vehicleId','eventResults','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','init2','log','init\x20SyncVehicleService\x20test22','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','driverValidationEvents','file','toString','result','syncEvents','default','encrypt','eventTypeId','locationParts','current_driver.jpg','latitude','replace'];(function(_0x3e21ba,_0x13a6c9){var _0x26a31c=function(_0x70530d){while(--_0x70530d){_0x3e21ba['push'](_0x3e21ba['shift']());}};_0x26a31c(++_0x13a6c9);}(a29_0x31c2,0xf3));var a29_0x6dfc=function(_0x171a2c,_0x531473){_0x171a2c=_0x171a2c-0x0;var _0x5ab18f=a29_0x31c2[_0x171a2c];return _0x5ab18f;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x577a65){return _0x577a65&&_0x577a65[a29_0x6dfc('0x0')]?_0x577a65:{'default':_0x577a65};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a29_0x6dfc('0x1'));const crypt_utils_1=__importDefault(require(a29_0x6dfc('0x2')));const extract=require(a29_0x6dfc('0x3'));const fsExtra=require(a29_0x6dfc('0x4'));const base64Img=require(a29_0x6dfc('0x5'));const isCorrupted=require('is-corrupted-jpeg');let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a29_0x6dfc('0x6'));const fork=require('child_process')[a29_0x6dfc('0x7')];class SyncVehicleService{constructor(_0x10bdbf){this[a29_0x6dfc('0x8')]=process[a29_0x6dfc('0x9')]['DEV_MODE']==a29_0x6dfc('0xa');this[a29_0x6dfc('0xb')]=this[a29_0x6dfc('0x8')]?a29_0x6dfc('0xc'):a29_0x6dfc('0xd');this[a29_0x6dfc('0xe')]=process[a29_0x6dfc('0x9')]['FILES_FOLDER'];this[a29_0x6dfc('0xf')]=process['env']['API_SERVICE_URL'];this[a29_0x6dfc('0x10')]=process[a29_0x6dfc('0x9')]['VEHICLE_ID'];this[a29_0x6dfc('0x11')]=[{'file':a29_0x6dfc('0x12'),'result':0x0},{'file':a29_0x6dfc('0x13'),'result':0x0},{'file':a29_0x6dfc('0x14'),'result':0x0}];this[a29_0x6dfc('0x15')]=new HttpClientService_1[(a29_0x6dfc('0x16'))]();this[a29_0x6dfc('0x17')]=_0x10bdbf;}[a29_0x6dfc('0x18')](){console[a29_0x6dfc('0x19')](a29_0x6dfc('0x1a'));const _0x22e9ac=this['folder']+'image1.jpg';const _0x1113ec=this[a29_0x6dfc('0xe')]+a29_0x6dfc('0x1b');}[a29_0x6dfc('0x1c')](){console[a29_0x6dfc('0x19')](a29_0x6dfc('0x1d'));this['loadAuthorizedDriver']();setInterval(function(){this[a29_0x6dfc('0x1e')]();}[a29_0x6dfc('0x1f')](this),0x2710);setInterval(function(){this[a29_0x6dfc('0x20')]();}[a29_0x6dfc('0x1f')](this),0x7d0);}['syncEvents_old'](){for(let _0x1c3647=0x0;_0x1c3647<this[a29_0x6dfc('0x11')]['length'];_0x1c3647++){this[a29_0x6dfc('0x21')](_0x1c3647);}}['driverValidationEvents'](_0x387b51){const _0x5ccf6d=this[a29_0x6dfc('0x11')][_0x387b51][a29_0x6dfc('0x22')];const _0x55d101=''+this['folder']+_0x5ccf6d;if(fsExtra['existsSync'](_0x55d101)){const _0x47b4b8=fsExtra['readFileSync'](_0x55d101)[a29_0x6dfc('0x23')]();if(this[a29_0x6dfc('0x11')][_0x387b51]['result']!=_0x47b4b8){this[a29_0x6dfc('0x11')][_0x387b51][a29_0x6dfc('0x24')]=_0x47b4b8;console[a29_0x6dfc('0x19')](a29_0x6dfc('0x25'),this[a29_0x6dfc('0x11')][_0x387b51][a29_0x6dfc('0x24')],_0x47b4b8);const _0x861301=crypt_utils_1[a29_0x6dfc('0x26')][a29_0x6dfc('0x27')](_0x47b4b8);console[a29_0x6dfc('0x19')](a29_0x6dfc('0x28'),_0x861301);const _0x1cda34=this['gpsService']?this[a29_0x6dfc('0x17')][a29_0x6dfc('0x29')]:{};const _0x397522=this['folder']+a29_0x6dfc('0x2a');let _0x19500d=null;const _0x30be60={'event_type_id':_0x861301,'vehicle_id':this[a29_0x6dfc('0x10')],'latitude':_0x1cda34[a29_0x6dfc('0x2b')]?_0x1cda34[a29_0x6dfc('0x2b')][a29_0x6dfc('0x2c')](',','.'):0x0,'longitude':_0x1cda34[a29_0x6dfc('0x2d')]?_0x1cda34['longitude'][a29_0x6dfc('0x2c')](',','.'):0x0,'speed':_0x1cda34['speed']?_0x1cda34[a29_0x6dfc('0x2e')]:0x0,'reported_at':new Date(),'image_data':_0x19500d};if(fsExtra[a29_0x6dfc('0x2f')](_0x397522)){_0x19500d=base64Img[a29_0x6dfc('0x30')](_0x397522);_0x19500d=JSON[a29_0x6dfc('0x31')](JSON[a29_0x6dfc('0x32')](_0x19500d));_0x30be60[a29_0x6dfc('0x33')]=_0x19500d;}}}else{}}[a29_0x6dfc('0x1e')](){const _0x29bd0f=this[a29_0x6dfc('0xf')]+a29_0x6dfc('0x34')+this[a29_0x6dfc('0x10')];this[a29_0x6dfc('0x15')][a29_0x6dfc('0x35')](_0x29bd0f,![])[a29_0x6dfc('0x36')](function(_0x19808d){if(_0x19808d['success']){if(_0x19808d[a29_0x6dfc('0x37')]&&_0x19808d['data']['length']>0x0&&_0x19808d[a29_0x6dfc('0x37')][0x0][a29_0x6dfc('0x33')]){this['saveImageFile'](_0x19808d['data'][0x0]);}}}[a29_0x6dfc('0x1f')](this))[a29_0x6dfc('0x38')](function(_0x43fca4){console[a29_0x6dfc('0x19')](_0x43fca4);});}[a29_0x6dfc('0x39')](_0x9104d1){let _0x19a146='';const _0x163a1b=_0x9104d1['image_data'][a29_0x6dfc('0x2c')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x9104d1[a29_0x6dfc('0x33')][a29_0x6dfc('0x3a')](/^data:image\/png;base64,/,'')){_0x19a146=a29_0x6dfc('0x3b');}else if(_0x9104d1[a29_0x6dfc('0x33')][a29_0x6dfc('0x3a')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x19a146='jpg';}fsExtra[a29_0x6dfc('0x3c')](this[a29_0x6dfc('0xe')]);const _0x34480c=this[a29_0x6dfc('0xe')]+a29_0x6dfc('0x3d')+_0x19a146;const _0x37b279=this[a29_0x6dfc('0xe')]+a29_0x6dfc('0x3e');fsExtra['writeFile'](_0x34480c,_0x163a1b,'base64',function(_0x2fdba0){});fsExtra[a29_0x6dfc('0x3f')](_0x37b279,_0x9104d1[a29_0x6dfc('0x40')],function(_0x5b9e4e){});}[a29_0x6dfc('0x20')](){const _0x3437a4=new Date();const _0x2e3d88=_0x3437a4['getTime']()-currentDriverImageDate[a29_0x6dfc('0x41')]();extract(this['urlVideo'],(_0x29b6bb,_0x151443)=>{try{if(!_0x29b6bb){const _0x199420=process[a29_0x6dfc('0x9')][a29_0x6dfc('0x42')];fsExtra['ensureDirSync'](_0x199420);const _0xf77289=_0x199420+a29_0x6dfc('0x43');const _0x352353=_0x199420+a29_0x6dfc('0x2a');fsExtra[a29_0x6dfc('0x44')](_0xf77289,_0x151443);if(!isCorrupted(_0xf77289)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a29_0x6dfc('0x45')](_0xf77289,_0x352353);}else{corruptedCounter++;console[a29_0x6dfc('0x19')](a29_0x6dfc('0x46'),corruptedCounter);const _0x4c5922=new Date();const _0x1ae413=_0x4c5922['getTime']();fsExtra[a29_0x6dfc('0x45')](_0xf77289,_0x199420+_0x1ae413[a29_0x6dfc('0x23')]()+'.jpg');}}else{}}catch(_0x110d55){}finally{}});}}exports[a29_0x6dfc('0x47')]=SyncVehicleService;