var a26_0x3d48=['init2','log','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','syncEvents','length','driverValidationEvents','file','readFileSync','toString','result','events/report_event/','default','encrypt','eventTypeId','locationParts','current_driver.jpg','vehicleId','latitude','replace','longitude','speed','base64Sync','parse','image_data','post','then','success','catch','err','route_schedules/get_by_vehicle/','get','data','saveImageFile','match','png','jpg','authorized_driver.','authorized_driver.txt','base64','setCurrentDriverImage','getTime','writeFile','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','ensureDirSync','writeFileSync','copy','error','SyncVehicleService','__esModule','../infrastructure/HttpClientService','../infrastructure/crypt-utils','fs-extra','base64-img','is-corrupted-jpeg','jimp','child_process','fork','url','http://localhost:60/index1.jpg','folder','FILES_FOLDER','apiURL','env','eventResults','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','gpsService'];(function(_0x332324,_0x2fce53){var _0x159198=function(_0x3c784e){while(--_0x3c784e){_0x332324['push'](_0x332324['shift']());}};_0x159198(++_0x2fce53);}(a26_0x3d48,0x86));var a26_0x1124=function(_0xdd916f,_0x546212){_0xdd916f=_0xdd916f-0x0;var _0x335261=a26_0x3d48[_0xdd916f];return _0x335261;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0xb3bae6){return _0xb3bae6&&_0xb3bae6[a26_0x1124('0x0')]?_0xb3bae6:{'default':_0xb3bae6};};Object['defineProperty'](exports,a26_0x1124('0x0'),{'value':!![]});const HttpClientService_1=require(a26_0x1124('0x1'));const crypt_utils_1=__importDefault(require(a26_0x1124('0x2')));const extract=require('../modules/jpeg-extract');const fsExtra=require(a26_0x1124('0x3'));const base64Img=require(a26_0x1124('0x4'));const isCorrupted=require(a26_0x1124('0x5'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x1124('0x6'));const fork=require(a26_0x1124('0x7'))[a26_0x1124('0x8')];class SyncVehicleService{constructor(_0x49c15d){this[a26_0x1124('0x9')]=a26_0x1124('0xa');this[a26_0x1124('0xb')]=process['env'][a26_0x1124('0xc')];this[a26_0x1124('0xd')]=process[a26_0x1124('0xe')]['API_SERVICE_URL'];this['vehicleId']=process[a26_0x1124('0xe')]['VEHICLE_ID'];this[a26_0x1124('0xf')]=[{'file':'result_driver.txt','result':0x0},{'file':a26_0x1124('0x10'),'result':0x0},{'file':a26_0x1124('0x11'),'result':0x0}];this[a26_0x1124('0x12')]=new HttpClientService_1['HttpClientService']();this[a26_0x1124('0x13')]=_0x49c15d;}[a26_0x1124('0x14')](){console[a26_0x1124('0x15')](a26_0x1124('0x16'));const _0x2b2e80=this[a26_0x1124('0xb')]+a26_0x1124('0x17');const _0x141af8=this[a26_0x1124('0xb')]+a26_0x1124('0x18');}[a26_0x1124('0x19')](){console[a26_0x1124('0x15')](a26_0x1124('0x1a'));this[a26_0x1124('0x1b')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x1124('0x1c')](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a26_0x1124('0x1c')](this),0x7d0);setInterval(function(){this[a26_0x1124('0x1d')]();}[a26_0x1124('0x1c')](this),0x3e8);}[a26_0x1124('0x1d')](){for(let _0xd74f97=0x0;_0xd74f97<this[a26_0x1124('0xf')][a26_0x1124('0x1e')];_0xd74f97++){this[a26_0x1124('0x1f')](_0xd74f97);}}['driverValidationEvents'](_0x1db764){const _0xe977b7=this[a26_0x1124('0xf')][_0x1db764][a26_0x1124('0x20')];const _0x19a4f9=''+this[a26_0x1124('0xb')]+_0xe977b7;if(fsExtra['existsSync'](_0x19a4f9)){const _0x580dd3=fsExtra[a26_0x1124('0x21')](_0x19a4f9)[a26_0x1124('0x22')]();if(this[a26_0x1124('0xf')][_0x1db764]['result']!=_0x580dd3){this[a26_0x1124('0xf')][_0x1db764][a26_0x1124('0x23')]=_0x580dd3;console[a26_0x1124('0x15')]('syncEvents',this[a26_0x1124('0xf')][_0x1db764][a26_0x1124('0x23')],_0x580dd3);const _0x13947f=this[a26_0x1124('0xd')]+a26_0x1124('0x24');const _0x14e044=crypt_utils_1[a26_0x1124('0x25')][a26_0x1124('0x26')](_0x580dd3);console[a26_0x1124('0x15')](a26_0x1124('0x27'),_0x14e044);const _0x4110c5=this['gpsService']?this[a26_0x1124('0x13')][a26_0x1124('0x28')]:{};const _0x584329=this[a26_0x1124('0xb')]+a26_0x1124('0x29');let _0x1ee0d3=null;const _0x5ddbf8={'event_type_id':_0x14e044,'vehicle_id':this[a26_0x1124('0x2a')],'latitude':_0x4110c5[a26_0x1124('0x2b')]?_0x4110c5['latitude'][a26_0x1124('0x2c')](',','.'):0x0,'longitude':_0x4110c5[a26_0x1124('0x2d')]?_0x4110c5[a26_0x1124('0x2d')][a26_0x1124('0x2c')](',','.'):0x0,'speed':_0x4110c5['speed']?_0x4110c5[a26_0x1124('0x2e')]:0x0,'reported_at':new Date(),'image_data':_0x1ee0d3};if(fsExtra['existsSync'](_0x584329)){_0x1ee0d3=base64Img[a26_0x1124('0x2f')](_0x584329);_0x1ee0d3=JSON[a26_0x1124('0x30')](JSON['stringify'](_0x1ee0d3));_0x5ddbf8[a26_0x1124('0x31')]=_0x1ee0d3;}this['httpClientService'][a26_0x1124('0x32')](_0x13947f,_0x5ddbf8,![])[a26_0x1124('0x33')](function(_0x5608dc){if(_0x5608dc[a26_0x1124('0x34')]){}}[a26_0x1124('0x1c')](this))[a26_0x1124('0x35')](function(_0x539a4d){console[a26_0x1124('0x15')](a26_0x1124('0x36'));});}}else{}}[a26_0x1124('0x1b')](){const _0x56bc14=this[a26_0x1124('0xd')]+a26_0x1124('0x37')+this[a26_0x1124('0x2a')];this['httpClientService'][a26_0x1124('0x38')](_0x56bc14,![])['then'](function(_0x33f5a1){if(_0x33f5a1[a26_0x1124('0x34')]){if(_0x33f5a1['data']&&_0x33f5a1['data'][a26_0x1124('0x1e')]>0x0&&_0x33f5a1[a26_0x1124('0x39')][0x0][a26_0x1124('0x31')]){this[a26_0x1124('0x3a')](_0x33f5a1[a26_0x1124('0x39')][0x0]);}}}[a26_0x1124('0x1c')](this))[a26_0x1124('0x35')](function(_0x30a142){console[a26_0x1124('0x15')](_0x30a142);});}['saveImageFile'](_0x3b3abd){let _0x2f0cce='';const _0x2e9234=_0x3b3abd[a26_0x1124('0x31')][a26_0x1124('0x2c')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x3b3abd[a26_0x1124('0x31')][a26_0x1124('0x3b')](/^data:image\/png;base64,/,'')){_0x2f0cce=a26_0x1124('0x3c');}else if(_0x3b3abd[a26_0x1124('0x31')][a26_0x1124('0x3b')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x2f0cce=a26_0x1124('0x3d');}fsExtra['ensureDirSync'](this[a26_0x1124('0xb')]);const _0x35018a=this['folder']+a26_0x1124('0x3e')+_0x2f0cce;const _0xd7c84a=this['folder']+a26_0x1124('0x3f');fsExtra['writeFile'](_0x35018a,_0x2e9234,a26_0x1124('0x40'),function(_0x4edf70){});fsExtra['writeFile'](_0xd7c84a,_0x3b3abd['user_id'],function(_0xe596e1){});}[a26_0x1124('0x41')](){const _0x369e72=new Date();const _0x121695=_0x369e72['getTime']()-currentDriverImageDate[a26_0x1124('0x42')]();if(_0x121695>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x1124('0x43')](process[a26_0x1124('0xe')][a26_0x1124('0x44')]+a26_0x1124('0x45'),a26_0x1124('0x46')+currentDriverImageDate+'\x22}',function(_0x55b349){console[a26_0x1124('0x15')](a26_0x1124('0x47'));if(_0x55b349){return console['log'](_0x55b349);}});}else{extract(this[a26_0x1124('0x9')],(_0x3df200,_0x217ddf)=>{try{if(!_0x3df200){const _0x1f792d=process[a26_0x1124('0xe')][a26_0x1124('0xc')];fsExtra[a26_0x1124('0x48')](_0x1f792d);const _0x29d4f7=_0x1f792d+'current_driver_temp.jpg';const _0x51376d=_0x1f792d+a26_0x1124('0x29');fsExtra[a26_0x1124('0x49')](_0x29d4f7,_0x217ddf);if(!isCorrupted(_0x29d4f7)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x1124('0x15')](a26_0x1124('0x41'),!![],new Date());fsExtra[a26_0x1124('0x4a')](_0x29d4f7,_0x51376d);}else{corruptedCounter++;console[a26_0x1124('0x15')]('setCurrentDriverImage\x20corruptedCounter\x20********************',corruptedCounter);fsExtra[a26_0x1124('0x4a')](_0x29d4f7,_0x29d4f7+new Date()+'.jpg');}}else{console[a26_0x1124('0x4b')]('extract',_0x3df200);}}catch(_0x1bf8db){}finally{}});}}}exports[a26_0x1124('0x4c')]=SyncVehicleService;