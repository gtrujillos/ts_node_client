var a27_0x2c57=['vehicleId','latitude','replace','longitude','speed','eventData:\x20','existsSync','base64Sync','parse','stringify','image_data','then','catch','err','No\x20file:\x20','route_schedules/get_by_vehicle/','get','success','data','length','saveImageFile','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','FILES_FOLDER','current_driver_temp.jpg','writeFileSync','error','extract','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','fs-extra','base64-img','is-corrupted-jpeg','child_process','url','http://localhost:60/index1.jpg','env','apiURL','API_SERVICE_URL','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','httpClientService','HttpClientService','gpsService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','eventResults','driverValidationEvents','file','readFileSync','toString','events/report_event/','encrypt','eventTypeId','locationParts','folder','current_driver.jpg'];(function(_0x401ce2,_0x10bc70){var _0x11c855=function(_0x4bdc83){while(--_0x4bdc83){_0x401ce2['push'](_0x401ce2['shift']());}};_0x11c855(++_0x10bc70);}(a27_0x2c57,0x10e));var a27_0x210f=function(_0xc4b241,_0x3627a3){_0xc4b241=_0xc4b241-0x0;var _0x316332=a27_0x2c57[_0xc4b241];return _0x316332;};'use strict';var __importDefault=this&&this[a27_0x210f('0x0')]||function(_0x5e9709){return _0x5e9709&&_0x5e9709[a27_0x210f('0x1')]?_0x5e9709:{'default':_0x5e9709};};Object[a27_0x210f('0x2')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a27_0x210f('0x3'));const crypt_utils_1=__importDefault(require(a27_0x210f('0x4')));const extract=require('jpeg-extract');const fsExtra=require(a27_0x210f('0x5'));const base64Img=require(a27_0x210f('0x6'));const isCorrupted=require(a27_0x210f('0x7'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x210f('0x8'))['fork'];class SyncVehicleService{constructor(_0x5e0e82){this[a27_0x210f('0x9')]=a27_0x210f('0xa');this['folder']=process[a27_0x210f('0xb')]['FILES_FOLDER'];this[a27_0x210f('0xc')]=process['env'][a27_0x210f('0xd')];this['vehicleId']=process[a27_0x210f('0xb')]['VEHICLE_ID'];this['eventResults']=[{'file':a27_0x210f('0xe'),'result':0x0},{'file':a27_0x210f('0xf'),'result':0x0},{'file':a27_0x210f('0x10'),'result':0x0}];this[a27_0x210f('0x11')]=new HttpClientService_1[(a27_0x210f('0x12'))]();this[a27_0x210f('0x13')]=_0x5e0e82;}[a27_0x210f('0x14')](){console[a27_0x210f('0x15')](a27_0x210f('0x16'));this[a27_0x210f('0x17')]();setInterval(function(){this[a27_0x210f('0x17')]();}[a27_0x210f('0x18')](this),0x2710);setInterval(function(){this[a27_0x210f('0x19')]();}[a27_0x210f('0x18')](this),0x7d0);setInterval(function(){this[a27_0x210f('0x1a')]();}[a27_0x210f('0x18')](this),0x3e8);}[a27_0x210f('0x1a')](){for(let _0x29eb4b=0x0;_0x29eb4b<this[a27_0x210f('0x1b')]['length'];_0x29eb4b++){this[a27_0x210f('0x1c')](_0x29eb4b);}}[a27_0x210f('0x1c')](_0x2af5a4){const _0x1165b8=this[a27_0x210f('0x1b')][_0x2af5a4][a27_0x210f('0x1d')];const _0x56f09d=''+this['folder']+_0x1165b8;if(fsExtra['existsSync'](_0x56f09d)){const _0x4a8c81=fsExtra[a27_0x210f('0x1e')](_0x56f09d)[a27_0x210f('0x1f')]();if(this['eventResults'][_0x2af5a4]['result']!=_0x4a8c81){this['eventResults'][_0x2af5a4]['result']=_0x4a8c81;console['log'](a27_0x210f('0x1a'),this[a27_0x210f('0x1b')][_0x2af5a4]['result'],_0x4a8c81);const _0x104d4e=this[a27_0x210f('0xc')]+a27_0x210f('0x20');const _0x4d4188=crypt_utils_1['default'][a27_0x210f('0x21')](_0x4a8c81);console[a27_0x210f('0x15')](a27_0x210f('0x22'),_0x4d4188);const _0x45567f=this[a27_0x210f('0x13')]?this[a27_0x210f('0x13')][a27_0x210f('0x23')]:{};const _0x34dc50=this[a27_0x210f('0x24')]+a27_0x210f('0x25');let _0x4d66f5=null;const _0x49a040={'event_type_id':_0x4d4188,'vehicle_id':this[a27_0x210f('0x26')],'latitude':_0x45567f[a27_0x210f('0x27')]?_0x45567f[a27_0x210f('0x27')][a27_0x210f('0x28')](',','.'):0x0,'longitude':_0x45567f[a27_0x210f('0x29')]?_0x45567f['longitude'][a27_0x210f('0x28')](',','.'):0x0,'speed':_0x45567f[a27_0x210f('0x2a')]?_0x45567f['speed']:0x0,'reported_at':new Date(),'image_data':_0x4d66f5};console['log'](a27_0x210f('0x2b'),_0x49a040);if(fsExtra[a27_0x210f('0x2c')](_0x34dc50)){_0x4d66f5=base64Img[a27_0x210f('0x2d')](_0x34dc50);_0x4d66f5=JSON[a27_0x210f('0x2e')](JSON[a27_0x210f('0x2f')](_0x4d66f5));_0x49a040[a27_0x210f('0x30')]=_0x4d66f5;}this['httpClientService']['post'](_0x104d4e,_0x49a040,![])[a27_0x210f('0x31')](function(_0x4ea535){if(_0x4ea535['success']){}}['bind'](this))[a27_0x210f('0x32')](function(_0x43a6b5){console['log'](a27_0x210f('0x33'));});}}else{console[a27_0x210f('0x15')](a27_0x210f('0x34'),_0x1165b8);}}['loadAuthorizedDriver'](){const _0x4d20e2=this[a27_0x210f('0xc')]+a27_0x210f('0x35')+this[a27_0x210f('0x26')];this[a27_0x210f('0x11')][a27_0x210f('0x36')](_0x4d20e2,![])[a27_0x210f('0x31')](function(_0x3f2356){if(_0x3f2356[a27_0x210f('0x37')]){if(_0x3f2356[a27_0x210f('0x38')]&&_0x3f2356['data'][a27_0x210f('0x39')]>0x0&&_0x3f2356[a27_0x210f('0x38')][0x0][a27_0x210f('0x30')]){this[a27_0x210f('0x3a')](_0x3f2356['data'][0x0]);}}}['bind'](this))[a27_0x210f('0x32')](function(_0x3c73cb){console['log'](_0x3c73cb);});}['saveImageFile'](_0x163595){let _0xdd35de='';const _0x2323fb=_0x163595['image_data'][a27_0x210f('0x28')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x163595['image_data'][a27_0x210f('0x3b')](/^data:image\/png;base64,/,'')){_0xdd35de=a27_0x210f('0x3c');}else if(_0x163595['image_data'][a27_0x210f('0x3b')](/^data:image\/(jpg|jpeg);base64,/,'')){_0xdd35de=a27_0x210f('0x3d');}fsExtra[a27_0x210f('0x3e')](this[a27_0x210f('0x24')]);const _0x23ac1e=this[a27_0x210f('0x24')]+a27_0x210f('0x3f')+_0xdd35de;const _0x9855b4=this['folder']+a27_0x210f('0x40');fsExtra[a27_0x210f('0x41')](_0x23ac1e,_0x2323fb,'base64',function(_0x2a8323){});fsExtra[a27_0x210f('0x41')](_0x9855b4,_0x163595[a27_0x210f('0x42')],function(_0x27e489){});}['setCurrentDriverImage'](){const _0x13e043=new Date();const _0x20763d=_0x13e043[a27_0x210f('0x43')]()-currentDriverImageDate['getTime']();if(_0x20763d>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x210f('0x41')](process[a27_0x210f('0xb')][a27_0x210f('0x44')]+a27_0x210f('0x45'),a27_0x210f('0x46')+currentDriverImageDate+'\x22}',function(_0x37d148){console[a27_0x210f('0x15')](a27_0x210f('0x47'));if(_0x37d148){return console[a27_0x210f('0x15')](_0x37d148);}});}else{extract(this[a27_0x210f('0x9')],(_0x5b4fc7,_0x4e509e)=>{try{if(!_0x5b4fc7){const _0x59d081=process[a27_0x210f('0xb')][a27_0x210f('0x48')];fsExtra[a27_0x210f('0x3e')](_0x59d081);const _0x23145c=_0x59d081+a27_0x210f('0x49');const _0x24620f=_0x59d081+a27_0x210f('0x25');fsExtra[a27_0x210f('0x4a')](_0x23145c,_0x4e509e);if(!isCorrupted(_0x23145c)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra['copy'](_0x23145c,_0x24620f);}else{corruptedCounter++;console['log'](a27_0x210f('0x19'),corruptedCounter);}}else{console[a27_0x210f('0x4b')](a27_0x210f('0x4c'),_0x5b4fc7);}}catch(_0x4237b1){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;