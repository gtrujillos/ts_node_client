var a27_0x3976=['vehicleId','env','VEHICLE_ID','eventResults','result_driver.txt','httpClientService','HttpClientService','gpsService','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','syncEvents','driverValidationEvents','existsSync','result','log','default','eventTypeId','locationParts','current_driver.jpg','latitude','replace','longitude','speed','base64Sync','parse','stringify','image_data','post','then','success','catch','err','get','data','length','saveImageFile','png','match','jpg','ensureDirSync','authorized_driver.txt','writeFile','base64','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','current_driver_temp.jpg','copy','setCurrentDriverImage','error','extract','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../infrastructure/crypt-utils','fs-extra','is-corrupted-jpeg','child_process','fork','url','http://localhost:60/index1.jpg','folder','FILES_FOLDER','apiURL','API_SERVICE_URL'];(function(_0x399050,_0x556035){var _0x5b4cd0=function(_0xbdec83){while(--_0xbdec83){_0x399050['push'](_0x399050['shift']());}};_0x5b4cd0(++_0x556035);}(a27_0x3976,0x1d4));var a27_0x5426=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a27_0x3976[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a27_0x5426('0x0')]||function(_0x3169fb){return _0x3169fb&&_0x3169fb[a27_0x5426('0x1')]?_0x3169fb:{'default':_0x3169fb};};Object[a27_0x5426('0x2')](exports,a27_0x5426('0x1'),{'value':!![]});const HttpClientService_1=require(a27_0x5426('0x3'));const crypt_utils_1=__importDefault(require(a27_0x5426('0x4')));const extract=require('jpeg-extract');const fsExtra=require(a27_0x5426('0x5'));const base64Img=require('base64-img');const isCorrupted=require(a27_0x5426('0x6'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x5426('0x7'))[a27_0x5426('0x8')];class SyncVehicleService{constructor(_0x44be25){this[a27_0x5426('0x9')]=a27_0x5426('0xa');this[a27_0x5426('0xb')]=process['env'][a27_0x5426('0xc')];this[a27_0x5426('0xd')]=process['env'][a27_0x5426('0xe')];this[a27_0x5426('0xf')]=process[a27_0x5426('0x10')][a27_0x5426('0x11')];this[a27_0x5426('0x12')]=[{'file':a27_0x5426('0x13'),'result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':'result_driver_behaviour.txt','result':0x0}];this[a27_0x5426('0x14')]=new HttpClientService_1[(a27_0x5426('0x15'))]();this[a27_0x5426('0x16')]=_0x44be25;}[a27_0x5426('0x17')](){console['log'](a27_0x5426('0x18'));this['loadAuthorizedDriver']();setInterval(function(){this[a27_0x5426('0x19')]();}[a27_0x5426('0x1a')](this),0x2710);setInterval(function(){this['setCurrentDriverImage']();}[a27_0x5426('0x1a')](this),0x7d0);setInterval(function(){this[a27_0x5426('0x1b')]();}[a27_0x5426('0x1a')](this),0x3e8);}['syncEvents'](){for(let _0x469a1d=0x0;_0x469a1d<this[a27_0x5426('0x12')]['length'];_0x469a1d++){this[a27_0x5426('0x1c')](_0x469a1d);}}[a27_0x5426('0x1c')](_0x2a4f66){const _0xf331d3=this[a27_0x5426('0x12')][_0x2a4f66]['file'];const _0x4e741f=''+this[a27_0x5426('0xb')]+_0xf331d3;if(fsExtra[a27_0x5426('0x1d')](_0x4e741f)){const _0x9a866a=fsExtra['readFileSync'](_0x4e741f)['toString']();if(this[a27_0x5426('0x12')][_0x2a4f66][a27_0x5426('0x1e')]!=_0x9a866a){this['eventResults'][_0x2a4f66][a27_0x5426('0x1e')]=_0x9a866a;console[a27_0x5426('0x1f')](a27_0x5426('0x1b'),this[a27_0x5426('0x12')][_0x2a4f66]['result'],_0x9a866a);const _0x2f2800=this[a27_0x5426('0xd')]+'events/report_event/';const _0x2daf0c=crypt_utils_1[a27_0x5426('0x20')]['encrypt'](_0x9a866a);console['log'](a27_0x5426('0x21'),_0x2daf0c);const _0x45f9bb=this['gpsService']?this[a27_0x5426('0x16')][a27_0x5426('0x22')]:{};const _0x3b9fcc=this['folder']+a27_0x5426('0x23');let _0x4cf75c=null;const _0x5eff17={'event_type_id':_0x2daf0c,'vehicle_id':this['vehicleId'],'latitude':_0x45f9bb['latitude']?_0x45f9bb[a27_0x5426('0x24')][a27_0x5426('0x25')](',','.'):0x0,'longitude':_0x45f9bb[a27_0x5426('0x26')]?_0x45f9bb['longitude'][a27_0x5426('0x25')](',','.'):0x0,'speed':_0x45f9bb[a27_0x5426('0x27')]?_0x45f9bb[a27_0x5426('0x27')]:0x0,'reported_at':new Date(),'image_data':_0x4cf75c};if(fsExtra[a27_0x5426('0x1d')](_0x3b9fcc)){_0x4cf75c=base64Img[a27_0x5426('0x28')](_0x3b9fcc);_0x4cf75c=JSON[a27_0x5426('0x29')](JSON[a27_0x5426('0x2a')](_0x4cf75c));_0x5eff17[a27_0x5426('0x2b')]=_0x4cf75c;}this['httpClientService'][a27_0x5426('0x2c')](_0x2f2800,_0x5eff17,![])[a27_0x5426('0x2d')](function(_0x50b365){if(_0x50b365[a27_0x5426('0x2e')]){}}['bind'](this))[a27_0x5426('0x2f')](function(_0x8eb87c){console[a27_0x5426('0x1f')](a27_0x5426('0x30'));});}}else{}}['loadAuthorizedDriver'](){const _0xbaceb9=this[a27_0x5426('0xd')]+'route_schedules/get_by_vehicle/'+this[a27_0x5426('0xf')];this['httpClientService'][a27_0x5426('0x31')](_0xbaceb9,![])['then'](function(_0x408e98){if(_0x408e98[a27_0x5426('0x2e')]){if(_0x408e98['data']&&_0x408e98[a27_0x5426('0x32')][a27_0x5426('0x33')]>0x0&&_0x408e98[a27_0x5426('0x32')][0x0][a27_0x5426('0x2b')]){this[a27_0x5426('0x34')](_0x408e98[a27_0x5426('0x32')][0x0]);}}}[a27_0x5426('0x1a')](this))[a27_0x5426('0x2f')](function(_0xd67306){console[a27_0x5426('0x1f')](_0xd67306);});}['saveImageFile'](_0x51dbbd){let _0x4088c2='';const _0x37b86f=_0x51dbbd[a27_0x5426('0x2b')][a27_0x5426('0x25')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x51dbbd[a27_0x5426('0x2b')]['match'](/^data:image\/png;base64,/,'')){_0x4088c2=a27_0x5426('0x35');}else if(_0x51dbbd['image_data'][a27_0x5426('0x36')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x4088c2=a27_0x5426('0x37');}fsExtra[a27_0x5426('0x38')](this[a27_0x5426('0xb')]);const _0x28e7ac=this[a27_0x5426('0xb')]+'authorized_driver.'+_0x4088c2;const _0x18269a=this['folder']+a27_0x5426('0x39');fsExtra[a27_0x5426('0x3a')](_0x28e7ac,_0x37b86f,a27_0x5426('0x3b'),function(_0x56b1a5){});fsExtra[a27_0x5426('0x3a')](_0x18269a,_0x51dbbd['user_id'],function(_0x599539){});}['setCurrentDriverImage'](){const _0x2983a=new Date();const _0x58122a=_0x2983a[a27_0x5426('0x3c')]()-currentDriverImageDate[a27_0x5426('0x3c')]();if(_0x58122a>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a27_0x5426('0x10')][a27_0x5426('0x3d')]+a27_0x5426('0x3e'),a27_0x5426('0x3f')+currentDriverImageDate+'\x22}',function(_0x174dfc){console[a27_0x5426('0x1f')]('Video\x20service\x20restarted');if(_0x174dfc){return console[a27_0x5426('0x1f')](_0x174dfc);}});}else{extract(this[a27_0x5426('0x9')],(_0x5cb680,_0x43f540)=>{try{if(!_0x5cb680){const _0x40df26=process['env'][a27_0x5426('0xc')];fsExtra[a27_0x5426('0x38')](_0x40df26);const _0x5f0dec=_0x40df26+a27_0x5426('0x40');const _0xcc3a1b=_0x40df26+a27_0x5426('0x23');fsExtra['writeFileSync'](_0x5f0dec,_0x43f540);if(!isCorrupted(_0x5f0dec)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a27_0x5426('0x1f')]('setCurrentDriverImage',!![],new Date());fsExtra[a27_0x5426('0x41')](_0x5f0dec,_0xcc3a1b);}else{corruptedCounter++;console[a27_0x5426('0x1f')](a27_0x5426('0x42'),corruptedCounter);}}else{console[a27_0x5426('0x43')](a27_0x5426('0x44'),_0x5cb680);}}catch(_0x5bd1ea){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;