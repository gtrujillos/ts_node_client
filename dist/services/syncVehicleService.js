var a26_0x114e=['locationParts','current_driver.jpg','latitude','replace','longitude','speed','existsSync','base64Sync','parse','stringify','image_data','post','then','success','route_schedules/get_by_vehicle/','data','catch','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','Video\x20service\x20restarted','FILES_FOLDER','writeFileSync','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','copy','error','extract','SyncVehicleService','__importDefault','__esModule','defineProperty','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','base64-img','jimp','child_process','fork','http://localhost:60/index1.jpg','folder','env','apiURL','API_SERVICE_URL','vehicleId','VEHICLE_ID','eventResults','result_driver_behaviour.txt','httpClientService','gpsService','init2','log','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','file','readFileSync','toString','result','events/report_event/','default','encrypt'];(function(_0xb2c542,_0x182930){var _0x1c6291=function(_0x5a1c3c){while(--_0x5a1c3c){_0xb2c542['push'](_0xb2c542['shift']());}};_0x1c6291(++_0x182930);}(a26_0x114e,0x1ec));var a26_0x1c46=function(_0x71c851,_0x41b859){_0x71c851=_0x71c851-0x0;var _0x498828=a26_0x114e[_0x71c851];return _0x498828;};'use strict';var __importDefault=this&&this[a26_0x1c46('0x0')]||function(_0x2c0245){return _0x2c0245&&_0x2c0245[a26_0x1c46('0x1')]?_0x2c0245:{'default':_0x2c0245};};Object[a26_0x1c46('0x2')](exports,a26_0x1c46('0x1'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x1c46('0x3')));const extract=require(a26_0x1c46('0x4'));const fsExtra=require(a26_0x1c46('0x5'));const base64Img=require(a26_0x1c46('0x6'));const isCorrupted=require('is-corrupted-jpeg');let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x1c46('0x7'));const fork=require(a26_0x1c46('0x8'))[a26_0x1c46('0x9')];class SyncVehicleService{constructor(_0xd2b4f2){this['url']=a26_0x1c46('0xa');this[a26_0x1c46('0xb')]=process[a26_0x1c46('0xc')]['FILES_FOLDER'];this[a26_0x1c46('0xd')]=process['env'][a26_0x1c46('0xe')];this[a26_0x1c46('0xf')]=process[a26_0x1c46('0xc')][a26_0x1c46('0x10')];this[a26_0x1c46('0x11')]=[{'file':'result_driver.txt','result':0x0},{'file':'result_driver_bus.txt','result':0x0},{'file':a26_0x1c46('0x12'),'result':0x0}];this[a26_0x1c46('0x13')]=new HttpClientService_1['HttpClientService']();this[a26_0x1c46('0x14')]=_0xd2b4f2;}[a26_0x1c46('0x15')](){console[a26_0x1c46('0x16')](a26_0x1c46('0x17'));const _0x197113=this['folder']+a26_0x1c46('0x18');const _0x2fa1da=this[a26_0x1c46('0xb')]+a26_0x1c46('0x19');}['init'](){console['log'](a26_0x1c46('0x1a'));this[a26_0x1c46('0x1b')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x1c46('0x1c')](this),0x2710);setInterval(function(){this[a26_0x1c46('0x1d')]();}[a26_0x1c46('0x1c')](this),0x7d0);setInterval(function(){this[a26_0x1c46('0x1e')]();}[a26_0x1c46('0x1c')](this),0x3e8);}[a26_0x1c46('0x1e')](){for(let _0x3a828b=0x0;_0x3a828b<this[a26_0x1c46('0x11')][a26_0x1c46('0x1f')];_0x3a828b++){this[a26_0x1c46('0x20')](_0x3a828b);}}[a26_0x1c46('0x20')](_0x2cfc39){const _0x456acd=this['eventResults'][_0x2cfc39][a26_0x1c46('0x21')];const _0x11afb7=''+this['folder']+_0x456acd;if(fsExtra['existsSync'](_0x11afb7)){const _0x109af1=fsExtra[a26_0x1c46('0x22')](_0x11afb7)[a26_0x1c46('0x23')]();if(this[a26_0x1c46('0x11')][_0x2cfc39][a26_0x1c46('0x24')]!=_0x109af1){this[a26_0x1c46('0x11')][_0x2cfc39][a26_0x1c46('0x24')]=_0x109af1;console[a26_0x1c46('0x16')]('syncEvents',this['eventResults'][_0x2cfc39][a26_0x1c46('0x24')],_0x109af1);const _0x3df814=this[a26_0x1c46('0xd')]+a26_0x1c46('0x25');const _0x3ba494=crypt_utils_1[a26_0x1c46('0x26')][a26_0x1c46('0x27')](_0x109af1);console['log']('eventTypeId',_0x3ba494);const _0xd8c9b6=this[a26_0x1c46('0x14')]?this[a26_0x1c46('0x14')][a26_0x1c46('0x28')]:{};const _0x4681b6=this[a26_0x1c46('0xb')]+a26_0x1c46('0x29');let _0x12a3df=null;const _0x1243ea={'event_type_id':_0x3ba494,'vehicle_id':this[a26_0x1c46('0xf')],'latitude':_0xd8c9b6[a26_0x1c46('0x2a')]?_0xd8c9b6[a26_0x1c46('0x2a')][a26_0x1c46('0x2b')](',','.'):0x0,'longitude':_0xd8c9b6[a26_0x1c46('0x2c')]?_0xd8c9b6[a26_0x1c46('0x2c')][a26_0x1c46('0x2b')](',','.'):0x0,'speed':_0xd8c9b6[a26_0x1c46('0x2d')]?_0xd8c9b6['speed']:0x0,'reported_at':new Date(),'image_data':_0x12a3df};if(fsExtra[a26_0x1c46('0x2e')](_0x4681b6)){_0x12a3df=base64Img[a26_0x1c46('0x2f')](_0x4681b6);_0x12a3df=JSON[a26_0x1c46('0x30')](JSON[a26_0x1c46('0x31')](_0x12a3df));_0x1243ea[a26_0x1c46('0x32')]=_0x12a3df;}this['httpClientService'][a26_0x1c46('0x33')](_0x3df814,_0x1243ea,![])[a26_0x1c46('0x34')](function(_0x300fa4){if(_0x300fa4[a26_0x1c46('0x35')]){}}[a26_0x1c46('0x1c')](this))['catch'](function(_0x530265){console[a26_0x1c46('0x16')]('err');});}}else{}}[a26_0x1c46('0x1b')](){const _0x9ee267=this[a26_0x1c46('0xd')]+a26_0x1c46('0x36')+this[a26_0x1c46('0xf')];this['httpClientService']['get'](_0x9ee267,![])[a26_0x1c46('0x34')](function(_0x1c888f){if(_0x1c888f[a26_0x1c46('0x35')]){if(_0x1c888f['data']&&_0x1c888f[a26_0x1c46('0x37')][a26_0x1c46('0x1f')]>0x0&&_0x1c888f[a26_0x1c46('0x37')][0x0]['image_data']){this['saveImageFile'](_0x1c888f[a26_0x1c46('0x37')][0x0]);}}}[a26_0x1c46('0x1c')](this))[a26_0x1c46('0x38')](function(_0x327eac){console[a26_0x1c46('0x16')](_0x327eac);});}['saveImageFile'](_0x1f0f06){let _0x215fae='';const _0x1f2f03=_0x1f0f06['image_data'][a26_0x1c46('0x2b')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x1f0f06[a26_0x1c46('0x32')][a26_0x1c46('0x39')](/^data:image\/png;base64,/,'')){_0x215fae=a26_0x1c46('0x3a');}else if(_0x1f0f06[a26_0x1c46('0x32')][a26_0x1c46('0x39')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x215fae=a26_0x1c46('0x3b');}fsExtra[a26_0x1c46('0x3c')](this[a26_0x1c46('0xb')]);const _0x2dc6f9=this[a26_0x1c46('0xb')]+a26_0x1c46('0x3d')+_0x215fae;const _0x4fda81=this[a26_0x1c46('0xb')]+a26_0x1c46('0x3e');fsExtra['writeFile'](_0x2dc6f9,_0x1f2f03,'base64',function(_0x41ed0d){});fsExtra[a26_0x1c46('0x3f')](_0x4fda81,_0x1f0f06[a26_0x1c46('0x40')],function(_0x143e2c){});}[a26_0x1c46('0x1d')](){const _0x18e1b3=new Date();const _0x13fd44=_0x18e1b3[a26_0x1c46('0x41')]()-currentDriverImageDate[a26_0x1c46('0x41')]();if(_0x13fd44>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x1c46('0xc')][a26_0x1c46('0x42')]+a26_0x1c46('0x43'),'{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x34d105){console['log'](a26_0x1c46('0x44'));if(_0x34d105){return console['log'](_0x34d105);}});}else{extract(this['url'],(_0x5a440b,_0x54fb2e)=>{try{if(!_0x5a440b){const _0xc18ef0=process[a26_0x1c46('0xc')][a26_0x1c46('0x45')];fsExtra['ensureDirSync'](_0xc18ef0);const _0x3af0b4=_0xc18ef0+'current_driver_temp.jpg';const _0x4034d6=_0xc18ef0+a26_0x1c46('0x29');fsExtra[a26_0x1c46('0x46')](_0x3af0b4,_0x54fb2e);if(!isCorrupted(_0x3af0b4)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x1c46('0x16')]('setCurrentDriverImage',!![],new Date());fsExtra['copy'](_0x3af0b4,_0x4034d6);}else{corruptedCounter++;console['log'](a26_0x1c46('0x47'),corruptedCounter);const _0x2d5288=new Date();const _0x41dff3=_0x2d5288[a26_0x1c46('0x41')]();fsExtra[a26_0x1c46('0x48')](_0x3af0b4,_0xc18ef0+_0x41dff3[a26_0x1c46('0x23')]()+'.jpg');}}else{console[a26_0x1c46('0x49')](a26_0x1c46('0x4a'),_0x5a440b);}}catch(_0x124edb){}finally{}});}}}exports[a26_0x1c46('0x4b')]=SyncVehicleService;