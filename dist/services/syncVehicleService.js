var a26_0x5da1=['loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','existsSync','readFileSync','toString','result','apiURL','events/report_event/','default','encrypt','eventTypeId','current_driver.jpg','vehicleId','latitude','replace','longitude','speed','base64Sync','parse','stringify','image_data','httpClientService','then','success','err','route_schedules/get_by_vehicle/','data','saveImageFile','match','png','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','user_id','getTime','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','writeFileSync','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','.jpg','__importDefault','__esModule','defineProperty','../infrastructure/HttpClientService','../modules/jpeg-extract','fs-extra','base64-img','is-corrupted-jpeg','jimp','child_process','urlVideo','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','API_SERVICE_URL','VEHICLE_ID','eventResults','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','gpsService','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','log','init\x20SyncVehicleService'];(function(_0x48ddeb,_0x4f02d0){var _0x3a87ca=function(_0x21d5d0){while(--_0x21d5d0){_0x48ddeb['push'](_0x48ddeb['shift']());}};_0x3a87ca(++_0x4f02d0);}(a26_0x5da1,0xca));var a26_0x5b5d=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a26_0x5da1[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a26_0x5b5d('0x0')]||function(_0x35d75f){return _0x35d75f&&_0x35d75f[a26_0x5b5d('0x1')]?_0x35d75f:{'default':_0x35d75f};};Object[a26_0x5b5d('0x2')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a26_0x5b5d('0x3'));const crypt_utils_1=__importDefault(require('../infrastructure/crypt-utils'));const extract=require(a26_0x5b5d('0x4'));const fsExtra=require(a26_0x5b5d('0x5'));const base64Img=require(a26_0x5b5d('0x6'));const isCorrupted=require(a26_0x5b5d('0x7'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x5b5d('0x8'));const fork=require(a26_0x5b5d('0x9'))['fork'];class SyncVehicleService{constructor(_0x38ccd5){this[a26_0x5b5d('0xa')]=a26_0x5b5d('0xb');this[a26_0x5b5d('0xc')]=process[a26_0x5b5d('0xd')][a26_0x5b5d('0xe')];this['apiURL']=process['env'][a26_0x5b5d('0xf')];this['vehicleId']=process[a26_0x5b5d('0xd')][a26_0x5b5d('0x10')];this[a26_0x5b5d('0x11')]=[{'file':a26_0x5b5d('0x12'),'result':0x0},{'file':a26_0x5b5d('0x13'),'result':0x0},{'file':a26_0x5b5d('0x14'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x5b5d('0x15'))]();this[a26_0x5b5d('0x16')]=_0x38ccd5;}['init2'](){console['log'](a26_0x5b5d('0x17'));const _0x1b0ff2=this[a26_0x5b5d('0xc')]+a26_0x5b5d('0x18');const _0x5b9337=this[a26_0x5b5d('0xc')]+a26_0x5b5d('0x19');}[a26_0x5b5d('0x1a')](){console[a26_0x5b5d('0x1b')](a26_0x5b5d('0x1c'));this[a26_0x5b5d('0x1d')]();setInterval(function(){this['loadAuthorizedDriver']();}[a26_0x5b5d('0x1e')](this),0x2710);setInterval(function(){this[a26_0x5b5d('0x1f')]();}[a26_0x5b5d('0x1e')](this),0x7d0);setInterval(function(){this[a26_0x5b5d('0x20')]();}[a26_0x5b5d('0x1e')](this),0x3e8);}[a26_0x5b5d('0x20')](){for(let _0x2fd03a=0x0;_0x2fd03a<this[a26_0x5b5d('0x11')][a26_0x5b5d('0x21')];_0x2fd03a++){this[a26_0x5b5d('0x22')](_0x2fd03a);}}['driverValidationEvents'](_0x59f9b7){const _0x2f1ac2=this['eventResults'][_0x59f9b7]['file'];const _0x46d38b=''+this[a26_0x5b5d('0xc')]+_0x2f1ac2;if(fsExtra[a26_0x5b5d('0x23')](_0x46d38b)){const _0x1ad529=fsExtra[a26_0x5b5d('0x24')](_0x46d38b)[a26_0x5b5d('0x25')]();if(this['eventResults'][_0x59f9b7][a26_0x5b5d('0x26')]!=_0x1ad529){this['eventResults'][_0x59f9b7][a26_0x5b5d('0x26')]=_0x1ad529;console[a26_0x5b5d('0x1b')](a26_0x5b5d('0x20'),this['eventResults'][_0x59f9b7]['result'],_0x1ad529);const _0x1ae19f=this[a26_0x5b5d('0x27')]+a26_0x5b5d('0x28');const _0x415cdc=crypt_utils_1[a26_0x5b5d('0x29')][a26_0x5b5d('0x2a')](_0x1ad529);console[a26_0x5b5d('0x1b')](a26_0x5b5d('0x2b'),_0x415cdc);const _0x984b55=this['gpsService']?this[a26_0x5b5d('0x16')]['locationParts']:{};const _0x50b38f=this['folder']+a26_0x5b5d('0x2c');let _0x47ad16=null;const _0x3ddd6f={'event_type_id':_0x415cdc,'vehicle_id':this[a26_0x5b5d('0x2d')],'latitude':_0x984b55[a26_0x5b5d('0x2e')]?_0x984b55[a26_0x5b5d('0x2e')][a26_0x5b5d('0x2f')](',','.'):0x0,'longitude':_0x984b55['longitude']?_0x984b55[a26_0x5b5d('0x30')][a26_0x5b5d('0x2f')](',','.'):0x0,'speed':_0x984b55[a26_0x5b5d('0x31')]?_0x984b55['speed']:0x0,'reported_at':new Date(),'image_data':_0x47ad16};if(fsExtra[a26_0x5b5d('0x23')](_0x50b38f)){_0x47ad16=base64Img[a26_0x5b5d('0x32')](_0x50b38f);_0x47ad16=JSON[a26_0x5b5d('0x33')](JSON[a26_0x5b5d('0x34')](_0x47ad16));_0x3ddd6f[a26_0x5b5d('0x35')]=_0x47ad16;}this[a26_0x5b5d('0x36')]['post'](_0x1ae19f,_0x3ddd6f,![])[a26_0x5b5d('0x37')](function(_0x2e716c){if(_0x2e716c[a26_0x5b5d('0x38')]){}}[a26_0x5b5d('0x1e')](this))['catch'](function(_0x41bd3e){console[a26_0x5b5d('0x1b')](a26_0x5b5d('0x39'));});}}else{}}['loadAuthorizedDriver'](){const _0x249f65=this[a26_0x5b5d('0x27')]+a26_0x5b5d('0x3a')+this[a26_0x5b5d('0x2d')];this[a26_0x5b5d('0x36')]['get'](_0x249f65,![])['then'](function(_0x1cc091){if(_0x1cc091['success']){if(_0x1cc091[a26_0x5b5d('0x3b')]&&_0x1cc091['data']['length']>0x0&&_0x1cc091[a26_0x5b5d('0x3b')][0x0]['image_data']){this[a26_0x5b5d('0x3c')](_0x1cc091[a26_0x5b5d('0x3b')][0x0]);}}}[a26_0x5b5d('0x1e')](this))['catch'](function(_0x3aa90e){console[a26_0x5b5d('0x1b')](_0x3aa90e);});}[a26_0x5b5d('0x3c')](_0x3cd740){let _0x1e851d='';const _0xfa8a3e=_0x3cd740[a26_0x5b5d('0x35')][a26_0x5b5d('0x2f')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x3cd740[a26_0x5b5d('0x35')][a26_0x5b5d('0x3d')](/^data:image\/png;base64,/,'')){_0x1e851d=a26_0x5b5d('0x3e');}else if(_0x3cd740[a26_0x5b5d('0x35')][a26_0x5b5d('0x3d')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x1e851d='jpg';}fsExtra[a26_0x5b5d('0x3f')](this[a26_0x5b5d('0xc')]);const _0x5f1565=this[a26_0x5b5d('0xc')]+a26_0x5b5d('0x40')+_0x1e851d;const _0x1cfbb9=this[a26_0x5b5d('0xc')]+a26_0x5b5d('0x41');fsExtra[a26_0x5b5d('0x42')](_0x5f1565,_0xfa8a3e,a26_0x5b5d('0x43'),function(_0x2c058a){});fsExtra['writeFile'](_0x1cfbb9,_0x3cd740[a26_0x5b5d('0x44')],function(_0x4d0c5f){});}['setCurrentDriverImage'](){const _0xece6f3=new Date();const _0x4e5b47=_0xece6f3[a26_0x5b5d('0x45')]()-currentDriverImageDate[a26_0x5b5d('0x45')]();if(_0x4e5b47>0x7530){currentDriverImageDate=new Date();fsExtra[a26_0x5b5d('0x42')](process[a26_0x5b5d('0xd')]['VIDEO_SERVICE_FILES_FOLDER']+'status.json',a26_0x5b5d('0x46')+currentDriverImageDate+'\x22}',function(_0x2751de){console[a26_0x5b5d('0x1b')](a26_0x5b5d('0x47'));if(_0x2751de){return console[a26_0x5b5d('0x1b')](_0x2751de);}});}else{extract(this['urlVideo'],(_0xbbf8b0,_0x2deae7)=>{try{if(!_0xbbf8b0){const _0x323f0c=process['env'][a26_0x5b5d('0xe')];fsExtra[a26_0x5b5d('0x3f')](_0x323f0c);const _0x1de118=_0x323f0c+a26_0x5b5d('0x48');const _0x4dd440=_0x323f0c+a26_0x5b5d('0x2c');fsExtra[a26_0x5b5d('0x49')](_0x1de118,_0x2deae7);if(!isCorrupted(_0x1de118)){corruptedCounter=0x0;currentDriverImageDate=new Date();fsExtra[a26_0x5b5d('0x4a')](_0x1de118,_0x4dd440);}else{corruptedCounter++;console['log'](a26_0x5b5d('0x4b'),corruptedCounter);const _0x151821=new Date();const _0x4f61eb=_0x151821['getTime']();fsExtra[a26_0x5b5d('0x4a')](_0x1de118,_0x323f0c+_0x4f61eb[a26_0x5b5d('0x25')]()+a26_0x5b5d('0x4c'));}}else{}}catch(_0x1b0832){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;