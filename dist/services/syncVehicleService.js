var a27_0x40bb=['syncEvents','result_driver.txt','readFileSync','toString','currentDriverResult','events/report_event/','Send\x20event','driverResult','encrypt','eventTypeId','current_driver.jpg','existsSync','base64Sync','parse','stringify','vehicleId','latitude','longitude','speed','then','success','catch','route_schedules/get_by_vehicle/','get','data','image_data','saveImageFile','replace','png','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','user_id','getTime','status.json','{\x22status\x22:\x20\x22','The\x20file\x20was\x20saved!','copy','extract','SyncVehicleService','__importDefault','__esModule','../infrastructure/crypt-utils','jpeg-extract','fs-extra','is-corrupted-jpeg','child_process','fork','url','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','apiURL','API_SERVICE_URL','VEHICLE_ID','httpClientService','HttpClientService','gpsService','log','init\x20SyncVehicleService','loadAuthorizedDriver','setCurrentDriverImage','bind'];(function(_0x50e497,_0x2f5d1b){var _0x2830d9=function(_0x4e2fd2){while(--_0x4e2fd2){_0x50e497['push'](_0x50e497['shift']());}};_0x2830d9(++_0x2f5d1b);}(a27_0x40bb,0x70));var a27_0x56ba=function(_0x45fc2a,_0x148c45){_0x45fc2a=_0x45fc2a-0x0;var _0x823e49=a27_0x40bb[_0x45fc2a];return _0x823e49;};'use strict';var __importDefault=this&&this[a27_0x56ba('0x0')]||function(_0x4ebf6c){return _0x4ebf6c&&_0x4ebf6c[a27_0x56ba('0x1')]?_0x4ebf6c:{'default':_0x4ebf6c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a27_0x56ba('0x2')));const extract=require(a27_0x56ba('0x3'));const fsExtra=require(a27_0x56ba('0x4'));const base64Img=require('base64-img');const isCorrupted=require(a27_0x56ba('0x5'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x56ba('0x6'))[a27_0x56ba('0x7')];class SyncVehicleService{constructor(_0x356c11){this[a27_0x56ba('0x8')]=a27_0x56ba('0x9');this['currentDriverResult']=null;this[a27_0x56ba('0xa')]=process[a27_0x56ba('0xb')][a27_0x56ba('0xc')];this[a27_0x56ba('0xd')]=process[a27_0x56ba('0xb')][a27_0x56ba('0xe')];this['vehicleId']=process[a27_0x56ba('0xb')][a27_0x56ba('0xf')];this[a27_0x56ba('0x10')]=new HttpClientService_1[(a27_0x56ba('0x11'))]();this[a27_0x56ba('0x12')]=_0x356c11;}['init'](){console[a27_0x56ba('0x13')](a27_0x56ba('0x14'));this[a27_0x56ba('0x15')]();setInterval(function(){this[a27_0x56ba('0x15')]();}['bind'](this),0x2710);setInterval(function(){this[a27_0x56ba('0x16')]();}['bind'](this),0x7d0);setInterval(function(){this['syncEvents']();}[a27_0x56ba('0x17')](this),0x3e8);}[a27_0x56ba('0x18')](){const _0xbdbc7d=this[a27_0x56ba('0xa')]+a27_0x56ba('0x19');if(fsExtra['existsSync'](_0xbdbc7d)){const _0x5af3eb=fsExtra[a27_0x56ba('0x1a')](_0xbdbc7d)[a27_0x56ba('0x1b')]();if(this[a27_0x56ba('0x1c')]!=_0x5af3eb){this[a27_0x56ba('0x1c')]=_0x5af3eb;const _0x498274=this[a27_0x56ba('0xd')]+a27_0x56ba('0x1d');console[a27_0x56ba('0x13')](a27_0x56ba('0x1e'),_0x498274);console[a27_0x56ba('0x13')](a27_0x56ba('0x1f'),_0x5af3eb);const _0x1fb705=crypt_utils_1['default'][a27_0x56ba('0x20')](_0x5af3eb);console[a27_0x56ba('0x13')](a27_0x56ba('0x21'),_0x1fb705);const _0x48381a=this[a27_0x56ba('0x12')]?this[a27_0x56ba('0x12')]['locationParts']:{};const _0x5e9abd=this[a27_0x56ba('0xa')]+a27_0x56ba('0x22');let _0xecda8e=null;if(fsExtra[a27_0x56ba('0x23')](_0x5e9abd)){_0xecda8e=base64Img[a27_0x56ba('0x24')](_0x5e9abd);_0xecda8e=JSON[a27_0x56ba('0x25')](JSON[a27_0x56ba('0x26')](_0xecda8e));_0xecda8e=_0xecda8e;}const _0x279b3c={'event_type_id':_0x1fb705,'vehicle_id':this[a27_0x56ba('0x27')],'latitude':_0x48381a[a27_0x56ba('0x28')]?_0x48381a[a27_0x56ba('0x28')]:0x0,'longitude':_0x48381a[a27_0x56ba('0x29')]?_0x48381a[a27_0x56ba('0x29')]:0x0,'speed':_0x48381a[a27_0x56ba('0x2a')]?_0x48381a[a27_0x56ba('0x2a')]:0x0,'reported_at':new Date(),'image_data':_0xecda8e};this[a27_0x56ba('0x10')]['post'](_0x498274,_0x279b3c,![])[a27_0x56ba('0x2b')](function(_0x5e3f07){if(_0x5e3f07[a27_0x56ba('0x2c')]){}}['bind'](this))[a27_0x56ba('0x2d')](function(_0x3b156b){console['log'](_0x3b156b);});}}}[a27_0x56ba('0x15')](){console[a27_0x56ba('0x13')]('loadAuthorizedDriver');const _0x124160=this[a27_0x56ba('0xd')]+a27_0x56ba('0x2e')+this[a27_0x56ba('0x27')];console['log']('loadAuthorizedDriver',_0x124160);this[a27_0x56ba('0x10')][a27_0x56ba('0x2f')](_0x124160,![])['then'](function(_0x11cf1b){if(_0x11cf1b[a27_0x56ba('0x2c')]){if(_0x11cf1b[a27_0x56ba('0x30')]&&_0x11cf1b['data']['length']>0x0&&_0x11cf1b[a27_0x56ba('0x30')][0x0][a27_0x56ba('0x31')]){this['saveImageFile'](_0x11cf1b['data'][0x0]);}}}['bind'](this))[a27_0x56ba('0x2d')](function(_0x451f5e){console['log'](_0x451f5e);});}[a27_0x56ba('0x32')](_0x5a19b0){let _0x5fa761='';const _0x47b183=_0x5a19b0[a27_0x56ba('0x31')][a27_0x56ba('0x33')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x5a19b0[a27_0x56ba('0x31')]['match'](/^data:image\/png;base64,/,'')){_0x5fa761=a27_0x56ba('0x34');}else if(_0x5a19b0[a27_0x56ba('0x31')][a27_0x56ba('0x35')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x5fa761=a27_0x56ba('0x36');}fsExtra[a27_0x56ba('0x37')](this[a27_0x56ba('0xa')]);const _0x3281ee=this[a27_0x56ba('0xa')]+a27_0x56ba('0x38')+_0x5fa761;const _0x52374a=this[a27_0x56ba('0xa')]+a27_0x56ba('0x39');fsExtra[a27_0x56ba('0x3a')](_0x3281ee,_0x47b183,a27_0x56ba('0x3b'),function(_0x435464){});fsExtra[a27_0x56ba('0x3a')](_0x52374a,_0x5a19b0[a27_0x56ba('0x3c')],function(_0x1524a0){});}[a27_0x56ba('0x16')](){console[a27_0x56ba('0x13')](a27_0x56ba('0x16'),currentDriverImageDate);const _0x1d2d39=new Date();const _0x95ec35=_0x1d2d39[a27_0x56ba('0x3d')]()-currentDriverImageDate[a27_0x56ba('0x3d')]();console['log'](_0x95ec35);if(_0x95ec35>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x56ba('0x3a')](process[a27_0x56ba('0xb')]['VIDEO_SERVICE_FILES_FOLDER']+a27_0x56ba('0x3e'),a27_0x56ba('0x3f')+currentDriverImageDate+'\x22}',function(_0x3b6c91){if(_0x3b6c91){return console[a27_0x56ba('0x13')](_0x3b6c91);}console[a27_0x56ba('0x13')](a27_0x56ba('0x40'));});}else{extract(this[a27_0x56ba('0x8')],(_0x173706,_0x4caca5)=>{try{if(!_0x173706){console['log']('extracted');const _0x3c1455=process[a27_0x56ba('0xb')]['FILES_FOLDER'];fsExtra['ensureDirSync'](_0x3c1455);const _0x62d6fa=_0x3c1455+'current_driver_temp.jpg';const _0x5430cf=_0x3c1455+a27_0x56ba('0x22');fsExtra['writeFileSync'](_0x62d6fa,_0x4caca5);if(!isCorrupted(_0x62d6fa)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a27_0x56ba('0x13')](a27_0x56ba('0x16'),!![]);fsExtra[a27_0x56ba('0x41')](_0x62d6fa,_0x5430cf);}else{corruptedCounter++;console[a27_0x56ba('0x13')]('setCurrentDriverImage',corruptedCounter);}}else{console['error'](a27_0x56ba('0x42'),_0x173706);}}catch(_0x3232e7){}finally{}});}}}exports[a27_0x56ba('0x43')]=SyncVehicleService;