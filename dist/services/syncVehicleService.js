var a26_0x59ef=['image_data','httpClientService','post','then','success','catch','err','route_schedules/get_by_vehicle/','get','data','saveImageFile','match','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','base64','getTime','status.json','copy','setCurrentDriverImage\x20corruptedCounter\x20********************:\x20','toString','.jpg','error','extract','SyncVehicleService','__importDefault','__esModule','../infrastructure/crypt-utils','../modules/jpeg-extract','fs-extra','jimp','fork','url','folder','FILES_FOLDER','apiURL','env','API_SERVICE_URL','vehicleId','VEHICLE_ID','eventResults','result_driver.txt','result_driver_bus.txt','result_driver_behaviour.txt','HttpClientService','log','init\x20SyncVehicleService\x20test22','image1.jpg','image2.jpg','init','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','length','driverValidationEvents','file','existsSync','readFileSync','result','encrypt','eventTypeId','gpsService','locationParts','current_driver.jpg','latitude','longitude','replace','speed','base64Sync','parse','stringify'];(function(_0x3cbafb,_0x1d1cae){var _0x3c6b81=function(_0x1e7081){while(--_0x1e7081){_0x3cbafb['push'](_0x3cbafb['shift']());}};_0x3c6b81(++_0x1d1cae);}(a26_0x59ef,0x66));var a26_0x315d=function(_0x21f362,_0x3ac0cb){_0x21f362=_0x21f362-0x0;var _0x398544=a26_0x59ef[_0x21f362];return _0x398544;};'use strict';var __importDefault=this&&this[a26_0x315d('0x0')]||function(_0x1876c8){return _0x1876c8&&_0x1876c8[a26_0x315d('0x1')]?_0x1876c8:{'default':_0x1876c8};};Object['defineProperty'](exports,a26_0x315d('0x1'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a26_0x315d('0x2')));const extract=require(a26_0x315d('0x3'));const fsExtra=require(a26_0x315d('0x4'));const base64Img=require('base64-img');const isCorrupted=require('is-corrupted-jpeg');let corruptedCounter=0x0;let currentDriverImageDate=new Date();const Jimp=require(a26_0x315d('0x5'));const fork=require('child_process')[a26_0x315d('0x6')];class SyncVehicleService{constructor(_0x58b316){this[a26_0x315d('0x7')]='http://localhost:60/index1.jpg';this[a26_0x315d('0x8')]=process['env'][a26_0x315d('0x9')];this[a26_0x315d('0xa')]=process[a26_0x315d('0xb')][a26_0x315d('0xc')];this[a26_0x315d('0xd')]=process['env'][a26_0x315d('0xe')];this[a26_0x315d('0xf')]=[{'file':a26_0x315d('0x10'),'result':0x0},{'file':a26_0x315d('0x11'),'result':0x0},{'file':a26_0x315d('0x12'),'result':0x0}];this['httpClientService']=new HttpClientService_1[(a26_0x315d('0x13'))]();this['gpsService']=_0x58b316;}['init2'](){console[a26_0x315d('0x14')](a26_0x315d('0x15'));const _0x2167b4=this['folder']+a26_0x315d('0x16');const _0x146265=this['folder']+a26_0x315d('0x17');}[a26_0x315d('0x18')](){console[a26_0x315d('0x14')](a26_0x315d('0x19'));this['loadAuthorizedDriver']();setInterval(function(){this[a26_0x315d('0x1a')]();}[a26_0x315d('0x1b')](this),0x2710);setInterval(function(){this[a26_0x315d('0x1c')]();}[a26_0x315d('0x1b')](this),0x7d0);setInterval(function(){this['syncEvents']();}['bind'](this),0x3e8);}[a26_0x315d('0x1d')](){for(let _0x59b3ef=0x0;_0x59b3ef<this[a26_0x315d('0xf')][a26_0x315d('0x1e')];_0x59b3ef++){this[a26_0x315d('0x1f')](_0x59b3ef);}}['driverValidationEvents'](_0x556328){const _0x441a12=this[a26_0x315d('0xf')][_0x556328][a26_0x315d('0x20')];const _0x2f958e=''+this[a26_0x315d('0x8')]+_0x441a12;if(fsExtra[a26_0x315d('0x21')](_0x2f958e)){const _0x458a0a=fsExtra[a26_0x315d('0x22')](_0x2f958e)['toString']();if(this['eventResults'][_0x556328][a26_0x315d('0x23')]!=_0x458a0a){this[a26_0x315d('0xf')][_0x556328]['result']=_0x458a0a;console['log'](a26_0x315d('0x1d'),this['eventResults'][_0x556328][a26_0x315d('0x23')],_0x458a0a);const _0x51c024=this[a26_0x315d('0xa')]+'events/report_event/';const _0x1d0ef3=crypt_utils_1['default'][a26_0x315d('0x24')](_0x458a0a);console[a26_0x315d('0x14')](a26_0x315d('0x25'),_0x1d0ef3);const _0x21b9ca=this[a26_0x315d('0x26')]?this['gpsService'][a26_0x315d('0x27')]:{};const _0x27ad30=this[a26_0x315d('0x8')]+a26_0x315d('0x28');let _0x577f8a=null;const _0x3d3c71={'event_type_id':_0x1d0ef3,'vehicle_id':this[a26_0x315d('0xd')],'latitude':_0x21b9ca[a26_0x315d('0x29')]?_0x21b9ca[a26_0x315d('0x29')]['replace'](',','.'):0x0,'longitude':_0x21b9ca[a26_0x315d('0x2a')]?_0x21b9ca[a26_0x315d('0x2a')][a26_0x315d('0x2b')](',','.'):0x0,'speed':_0x21b9ca[a26_0x315d('0x2c')]?_0x21b9ca['speed']:0x0,'reported_at':new Date(),'image_data':_0x577f8a};if(fsExtra[a26_0x315d('0x21')](_0x27ad30)){_0x577f8a=base64Img[a26_0x315d('0x2d')](_0x27ad30);_0x577f8a=JSON[a26_0x315d('0x2e')](JSON[a26_0x315d('0x2f')](_0x577f8a));_0x3d3c71[a26_0x315d('0x30')]=_0x577f8a;}this[a26_0x315d('0x31')][a26_0x315d('0x32')](_0x51c024,_0x3d3c71,![])[a26_0x315d('0x33')](function(_0x1ed350){if(_0x1ed350[a26_0x315d('0x34')]){}}[a26_0x315d('0x1b')](this))[a26_0x315d('0x35')](function(_0x337d8d){console[a26_0x315d('0x14')](a26_0x315d('0x36'));});}}else{}}[a26_0x315d('0x1a')](){const _0x32f80f=this[a26_0x315d('0xa')]+a26_0x315d('0x37')+this[a26_0x315d('0xd')];this[a26_0x315d('0x31')][a26_0x315d('0x38')](_0x32f80f,![])[a26_0x315d('0x33')](function(_0x30a40b){if(_0x30a40b[a26_0x315d('0x34')]){if(_0x30a40b[a26_0x315d('0x39')]&&_0x30a40b[a26_0x315d('0x39')][a26_0x315d('0x1e')]>0x0&&_0x30a40b['data'][0x0][a26_0x315d('0x30')]){this[a26_0x315d('0x3a')](_0x30a40b[a26_0x315d('0x39')][0x0]);}}}[a26_0x315d('0x1b')](this))[a26_0x315d('0x35')](function(_0x35fd14){console[a26_0x315d('0x14')](_0x35fd14);});}[a26_0x315d('0x3a')](_0x210412){let _0x273bdd='';const _0x490894=_0x210412[a26_0x315d('0x30')]['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x210412[a26_0x315d('0x30')][a26_0x315d('0x3b')](/^data:image\/png;base64,/,'')){_0x273bdd='png';}else if(_0x210412['image_data']['match'](/^data:image\/(jpg|jpeg);base64,/,'')){_0x273bdd=a26_0x315d('0x3c');}fsExtra[a26_0x315d('0x3d')](this['folder']);const _0x51e612=this[a26_0x315d('0x8')]+a26_0x315d('0x3e')+_0x273bdd;const _0x5aa222=this[a26_0x315d('0x8')]+a26_0x315d('0x3f');fsExtra[a26_0x315d('0x40')](_0x51e612,_0x490894,a26_0x315d('0x41'),function(_0x336a2c){});fsExtra[a26_0x315d('0x40')](_0x5aa222,_0x210412['user_id'],function(_0x102d6b){});}['setCurrentDriverImage'](){const _0x25a04e=new Date();const _0x2b13e0=_0x25a04e[a26_0x315d('0x42')]()-currentDriverImageDate['getTime']();if(_0x2b13e0>0x7530){currentDriverImageDate=new Date();fsExtra['writeFile'](process[a26_0x315d('0xb')]['VIDEO_SERVICE_FILES_FOLDER']+a26_0x315d('0x43'),'{\x22status\x22:\x20\x22'+currentDriverImageDate+'\x22}',function(_0x420051){console[a26_0x315d('0x14')]('Video\x20service\x20restarted');if(_0x420051){return console[a26_0x315d('0x14')](_0x420051);}});}else{extract(this['url'],(_0x3f0f55,_0x168e32)=>{try{if(!_0x3f0f55){const _0x283eb4=process['env'][a26_0x315d('0x9')];fsExtra[a26_0x315d('0x3d')](_0x283eb4);const _0x360629=_0x283eb4+'current_driver_temp.jpg';const _0x279a62=_0x283eb4+a26_0x315d('0x28');fsExtra['writeFileSync'](_0x360629,_0x168e32);if(!isCorrupted(_0x360629)){corruptedCounter=0x0;currentDriverImageDate=new Date();console[a26_0x315d('0x14')](a26_0x315d('0x1c'),!![],new Date());fsExtra[a26_0x315d('0x44')](_0x360629,_0x279a62);}else{corruptedCounter++;console[a26_0x315d('0x14')](a26_0x315d('0x45'),corruptedCounter);const _0x4a818c=new Date();const _0x402daa=_0x4a818c['getTime']();fsExtra[a26_0x315d('0x44')](_0x360629,_0x283eb4+_0x402daa[a26_0x315d('0x46')]()+a26_0x315d('0x47'));}}else{console[a26_0x315d('0x48')](a26_0x315d('0x49'),_0x3f0f55);}}catch(_0x327a98){}finally{}});}}}exports[a26_0x315d('0x4a')]=SyncVehicleService;