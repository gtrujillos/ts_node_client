var a27_0x42a9=['loadAuthorizedDriver','bind','setCurrentDriverImage','syncEvents','eventResults','length','driverValidationEvents','file','existsSync','readFileSync','toString','result','events/report_event/','encrypt','locationParts','latitude','replace','longitude','speed','base64Sync','parse','stringify','post','then','success','catch','err','route_schedules/get_by_vehicle/','get','data','image_data','saveImageFile','png','match','jpg','ensureDirSync','authorized_driver.txt','writeFile','base64','user_id','getTime','VIDEO_SERVICE_FILES_FOLDER','status.json','{\x22status\x22:\x20\x22','Video\x20service\x20restarted','current_driver_temp.jpg','current_driver.jpg','writeFileSync','copy','extract','__importDefault','defineProperty','__esModule','../infrastructure/crypt-utils','base64-img','is-corrupted-jpeg','child_process','fork','url','folder','FILES_FOLDER','apiURL','env','vehicleId','VEHICLE_ID','result_driver.txt','result_driver_bus.txt','httpClientService','HttpClientService','gpsService','log','init\x20SyncVehicleService'];(function(_0x5888d9,_0x504abc){var _0x414228=function(_0x1277eb){while(--_0x1277eb){_0x5888d9['push'](_0x5888d9['shift']());}};_0x414228(++_0x504abc);}(a27_0x42a9,0x10a));var a27_0x3181=function(_0x187dcf,_0xa638d6){_0x187dcf=_0x187dcf-0x0;var _0x15c443=a27_0x42a9[_0x187dcf];return _0x15c443;};'use strict';var __importDefault=this&&this[a27_0x3181('0x0')]||function(_0x466282){return _0x466282&&_0x466282['__esModule']?_0x466282:{'default':_0x466282};};Object[a27_0x3181('0x1')](exports,a27_0x3181('0x2'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const crypt_utils_1=__importDefault(require(a27_0x3181('0x3')));const extract=require('jpeg-extract');const fsExtra=require('fs-extra');const base64Img=require(a27_0x3181('0x4'));const isCorrupted=require(a27_0x3181('0x5'));let corruptedCounter=0x0;let currentDriverImageDate=new Date();const fork=require(a27_0x3181('0x6'))[a27_0x3181('0x7')];class SyncVehicleService{constructor(_0x126b30){this[a27_0x3181('0x8')]='http://localhost:60/index1.jpg';this[a27_0x3181('0x9')]=process['env'][a27_0x3181('0xa')];this[a27_0x3181('0xb')]=process[a27_0x3181('0xc')]['API_SERVICE_URL'];this[a27_0x3181('0xd')]=process[a27_0x3181('0xc')][a27_0x3181('0xe')];this['eventResults']=[{'file':a27_0x3181('0xf'),'result':0x0},{'file':a27_0x3181('0x10'),'result':0x0},{'file':'result_driver_behaviour.txt','result':0x0}];this[a27_0x3181('0x11')]=new HttpClientService_1[(a27_0x3181('0x12'))]();this[a27_0x3181('0x13')]=_0x126b30;}['init'](){console[a27_0x3181('0x14')](a27_0x3181('0x15'));this[a27_0x3181('0x16')]();setInterval(function(){this[a27_0x3181('0x16')]();}[a27_0x3181('0x17')](this),0x2710);setInterval(function(){this[a27_0x3181('0x18')]();}['bind'](this),0x7d0);setInterval(function(){this['syncEvents']();}['bind'](this),0x3e8);}[a27_0x3181('0x19')](){for(let _0x4bf611=0x0;_0x4bf611<this[a27_0x3181('0x1a')][a27_0x3181('0x1b')];_0x4bf611++){this[a27_0x3181('0x1c')](_0x4bf611);}}[a27_0x3181('0x1c')](_0x38ed31){const _0x4d1283=this[a27_0x3181('0x1a')][_0x38ed31][a27_0x3181('0x1d')];const _0x23904f=''+this['folder']+_0x4d1283;if(fsExtra[a27_0x3181('0x1e')](_0x23904f)){const _0x3b1f7b=fsExtra[a27_0x3181('0x1f')](_0x23904f)[a27_0x3181('0x20')]();if(this[a27_0x3181('0x1a')][_0x38ed31][a27_0x3181('0x21')]!=_0x3b1f7b){this[a27_0x3181('0x1a')][_0x38ed31][a27_0x3181('0x21')]=_0x3b1f7b;console['log'](a27_0x3181('0x19'),this[a27_0x3181('0x1a')][_0x38ed31][a27_0x3181('0x21')],_0x3b1f7b);const _0x1dcf5c=this[a27_0x3181('0xb')]+a27_0x3181('0x22');const _0x4de94f=crypt_utils_1['default'][a27_0x3181('0x23')](_0x3b1f7b);console[a27_0x3181('0x14')]('eventTypeId',_0x4de94f);const _0x14c547=this[a27_0x3181('0x13')]?this[a27_0x3181('0x13')][a27_0x3181('0x24')]:{};const _0x3f4b08=this[a27_0x3181('0x9')]+'current_driver.jpg';let _0x56a6be=null;const _0x424069={'event_type_id':_0x4de94f,'vehicle_id':this[a27_0x3181('0xd')],'latitude':_0x14c547[a27_0x3181('0x25')]?_0x14c547['latitude'][a27_0x3181('0x26')](',','.'):0x0,'longitude':_0x14c547[a27_0x3181('0x27')]?_0x14c547[a27_0x3181('0x27')][a27_0x3181('0x26')](',','.'):0x0,'speed':_0x14c547['speed']?_0x14c547[a27_0x3181('0x28')]:0x0,'reported_at':new Date(),'image_data':_0x56a6be};if(fsExtra[a27_0x3181('0x1e')](_0x3f4b08)){_0x56a6be=base64Img[a27_0x3181('0x29')](_0x3f4b08);_0x56a6be=JSON[a27_0x3181('0x2a')](JSON[a27_0x3181('0x2b')](_0x56a6be));_0x424069['image_data']=_0x56a6be;}this['httpClientService'][a27_0x3181('0x2c')](_0x1dcf5c,_0x424069,![])[a27_0x3181('0x2d')](function(_0x35b111){if(_0x35b111[a27_0x3181('0x2e')]){}}['bind'](this))[a27_0x3181('0x2f')](function(_0xbc1b1c){console[a27_0x3181('0x14')](a27_0x3181('0x30'));});}}else{}}[a27_0x3181('0x16')](){const _0x2a04bc=this['apiURL']+a27_0x3181('0x31')+this[a27_0x3181('0xd')];this[a27_0x3181('0x11')][a27_0x3181('0x32')](_0x2a04bc,![])[a27_0x3181('0x2d')](function(_0x27ad90){if(_0x27ad90['success']){if(_0x27ad90[a27_0x3181('0x33')]&&_0x27ad90[a27_0x3181('0x33')][a27_0x3181('0x1b')]>0x0&&_0x27ad90[a27_0x3181('0x33')][0x0][a27_0x3181('0x34')]){this[a27_0x3181('0x35')](_0x27ad90['data'][0x0]);}}}[a27_0x3181('0x17')](this))[a27_0x3181('0x2f')](function(_0x5e7b43){console['log'](_0x5e7b43);});}['saveImageFile'](_0x4bdfb6){let _0x120ed5='';const _0x1c7150=_0x4bdfb6[a27_0x3181('0x34')][a27_0x3181('0x26')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x4bdfb6['image_data']['match'](/^data:image\/png;base64,/,'')){_0x120ed5=a27_0x3181('0x36');}else if(_0x4bdfb6[a27_0x3181('0x34')][a27_0x3181('0x37')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x120ed5=a27_0x3181('0x38');}fsExtra[a27_0x3181('0x39')](this['folder']);const _0x4da03d=this['folder']+'authorized_driver.'+_0x120ed5;const _0x140f44=this['folder']+a27_0x3181('0x3a');fsExtra[a27_0x3181('0x3b')](_0x4da03d,_0x1c7150,a27_0x3181('0x3c'),function(_0x25a4d2){});fsExtra[a27_0x3181('0x3b')](_0x140f44,_0x4bdfb6[a27_0x3181('0x3d')],function(_0x2afda3){});}[a27_0x3181('0x18')](){const _0x1ffed5=new Date();const _0x57c3ed=_0x1ffed5['getTime']()-currentDriverImageDate[a27_0x3181('0x3e')]();if(_0x57c3ed>0x7530){currentDriverImageDate=new Date();fsExtra[a27_0x3181('0x3b')](process[a27_0x3181('0xc')][a27_0x3181('0x3f')]+a27_0x3181('0x40'),a27_0x3181('0x41')+currentDriverImageDate+'\x22}',function(_0x16dd2f){console['log'](a27_0x3181('0x42'));if(_0x16dd2f){return console[a27_0x3181('0x14')](_0x16dd2f);}});}else{extract(this[a27_0x3181('0x8')],(_0x118048,_0x55f3f2)=>{try{if(!_0x118048){const _0x105780=process[a27_0x3181('0xc')][a27_0x3181('0xa')];fsExtra[a27_0x3181('0x39')](_0x105780);const _0x10b088=_0x105780+a27_0x3181('0x43');const _0x52536f=_0x105780+a27_0x3181('0x44');fsExtra[a27_0x3181('0x45')](_0x10b088,_0x55f3f2);if(!isCorrupted(_0x10b088)){corruptedCounter=0x0;currentDriverImageDate=new Date();console['log'](a27_0x3181('0x18'),!![],new Date());fsExtra[a27_0x3181('0x46')](_0x10b088,_0x52536f);}else{corruptedCounter++;console[a27_0x3181('0x14')](a27_0x3181('0x18'),corruptedCounter);}}else{console['error'](a27_0x3181('0x47'),_0x118048);}}catch(_0x47960e){}finally{}});}}}exports['SyncVehicleService']=SyncVehicleService;