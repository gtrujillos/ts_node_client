var a25_0x30d4=['SyncVehicleService','__esModule','jpeg-extract','base64-img','child_process','fork','url','http://localhost:60/index1.jpg','folder','env','FILES_FOLDER','API_SERVICE_URL','vehicleId','VEHICLE_ID','httpClientService','init','log','init\x20SyncVehicleService','loadAuthorizedDriver','bind','setCurrentDriverImage','existsSync','toString','currentDriverResult','apiURL','Send\x20event','ca78317f4e86fddb6e8caf5dd7bb96e2','gpsService','locationParts','current_driver.jpg','base64Sync','parse','stringify','latitude','longitude','speed','post','response:','catch','route_schedules/get_by_vehicle/','get','success','response.data[0].id:','data','length','image_data','saveImageFile','replace','match','png','jpg','ensureDirSync','authorized_driver.','authorized_driver.txt','writeFile','user_id','then','writeFileSync','error','../passcontrol.video_streaming/example/express-app'];(function(_0x185e10,_0x1b3fd9){var _0x2c82ae=function(_0x439b8b){while(--_0x439b8b){_0x185e10['push'](_0x185e10['shift']());}};_0x2c82ae(++_0x1b3fd9);}(a25_0x30d4,0x1a5));var a25_0xd859=function(_0x498676,_0x5f3aa9){_0x498676=_0x498676-0x0;var _0x508b5d=a25_0x30d4[_0x498676];return _0x508b5d;};'use strict';Object['defineProperty'](exports,a25_0xd859('0x0'),{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const extract=require(a25_0xd859('0x1'));const fsExtra=require('fs-extra');const base64Img=require(a25_0xd859('0x2'));const fork=require(a25_0xd859('0x3'))[a25_0xd859('0x4')];let child;class SyncVehicleService{constructor(_0x5b31a1){this[a25_0xd859('0x5')]=a25_0xd859('0x6');this['currentDriverResult']=null;this[a25_0xd859('0x7')]=process[a25_0xd859('0x8')][a25_0xd859('0x9')];this['apiURL']=process['env'][a25_0xd859('0xa')];this[a25_0xd859('0xb')]=process[a25_0xd859('0x8')][a25_0xd859('0xc')];this[a25_0xd859('0xd')]=new HttpClientService_1['HttpClientService']();this['gpsService']=_0x5b31a1;}[a25_0xd859('0xe')](){console[a25_0xd859('0xf')](a25_0xd859('0x10'));this[a25_0xd859('0x11')]();setInterval(function(){this[a25_0xd859('0x11')]();}[a25_0xd859('0x12')](this),0x2710);setInterval(function(){this[a25_0xd859('0x13')]();}[a25_0xd859('0x12')](this),0x3e8);setInterval(function(){this['syncEvents']();}[a25_0xd859('0x12')](this),0x3e8);}['syncEvents'](){const _0xdf082=this[a25_0xd859('0x7')]+'result_driver.txt';if(fsExtra[a25_0xd859('0x14')](_0xdf082)){const _0x5aa1ee=fsExtra['readFileSync'](_0xdf082)[a25_0xd859('0x15')]();if(this[a25_0xd859('0x16')]!=_0x5aa1ee){this['currentDriverResult']=_0x5aa1ee;const _0x5301d2=this[a25_0xd859('0x17')]+'events/report_event/';console['log'](a25_0xd859('0x18'),_0x5301d2);const _0x79d222=a25_0xd859('0x19');if(_0x5aa1ee==0x0){}switch(_0x5aa1ee){case 0x0:{break;}case 0x1:{break;}case 0x2:{break;}}const _0x28f256=this[a25_0xd859('0x1a')]?this[a25_0xd859('0x1a')][a25_0xd859('0x1b')]:{};const _0x9419b7=this[a25_0xd859('0x7')]+a25_0xd859('0x1c');let _0x50a627=null;if(fsExtra[a25_0xd859('0x14')](_0x9419b7)){_0x50a627=base64Img[a25_0xd859('0x1d')](_0x9419b7);_0x50a627=JSON[a25_0xd859('0x1e')](JSON[a25_0xd859('0x1f')](_0x50a627));_0x50a627=_0x50a627;}const _0x403a0b={'event_type_id':_0x79d222,'vehicle_id':this['vehicleId'],'latitude':_0x28f256[a25_0xd859('0x20')]?_0x28f256['latitude']:0x0,'longitude':_0x28f256[a25_0xd859('0x21')]?_0x28f256[a25_0xd859('0x21')]:0x0,'speed':_0x28f256[a25_0xd859('0x22')]?_0x28f256[a25_0xd859('0x22')]:0x0,'reported_at':new Date(),'image_data':_0x50a627};this[a25_0xd859('0xd')][a25_0xd859('0x23')](_0x5301d2,_0x403a0b,![])['then'](function(_0x523c79){console[a25_0xd859('0xf')](a25_0xd859('0x24'),_0x523c79);if(_0x523c79['success']){}}['bind'](this))[a25_0xd859('0x25')](function(_0x5d5341){console[a25_0xd859('0xf')](_0x5d5341);});}}}[a25_0xd859('0x11')](){console[a25_0xd859('0xf')](a25_0xd859('0x11'));const _0xf8476=this[a25_0xd859('0x17')]+a25_0xd859('0x26')+this[a25_0xd859('0xb')];this[a25_0xd859('0xd')][a25_0xd859('0x27')](_0xf8476,![])['then'](function(_0x258ccf){if(_0x258ccf[a25_0xd859('0x28')]){console[a25_0xd859('0xf')](a25_0xd859('0x29'),_0x258ccf[a25_0xd859('0x2a')][0x0]['id']);if(_0x258ccf[a25_0xd859('0x2a')]&&_0x258ccf[a25_0xd859('0x2a')][a25_0xd859('0x2b')]>0x0&&_0x258ccf[a25_0xd859('0x2a')][0x0][a25_0xd859('0x2c')]){this[a25_0xd859('0x2d')](_0x258ccf['data'][0x0]);}}}[a25_0xd859('0x12')](this))[a25_0xd859('0x25')](function(_0x2ff924){});}['saveImageFile'](_0x5338cd){let _0x5895d4='';const _0x5ea58a=_0x5338cd[a25_0xd859('0x2c')][a25_0xd859('0x2e')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x5338cd['image_data'][a25_0xd859('0x2f')](/^data:image\/png;base64,/,'')){_0x5895d4=a25_0xd859('0x30');}else if(_0x5338cd[a25_0xd859('0x2c')][a25_0xd859('0x2f')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x5895d4=a25_0xd859('0x31');}fsExtra[a25_0xd859('0x32')](this[a25_0xd859('0x7')]);const _0x5e63dc=this['folder']+a25_0xd859('0x33')+_0x5895d4;const _0x223979=this[a25_0xd859('0x7')]+a25_0xd859('0x34');fsExtra[a25_0xd859('0x35')](_0x5e63dc,_0x5ea58a,'base64',function(_0x3086f5){});fsExtra[a25_0xd859('0x35')](_0x223979,_0x5338cd[a25_0xd859('0x36')],function(_0x203e52){});}['setCurrentDriverImage'](){console['log'](a25_0xd859('0x13'));extract(this[a25_0xd859('0x5')])[a25_0xd859('0x37')](_0x36b9fd=>{const _0x4c1315=process['env'][a25_0xd859('0x9')];fsExtra[a25_0xd859('0x32')](_0x4c1315);const _0x2b08dc=_0x4c1315+a25_0xd859('0x1c');fsExtra[a25_0xd859('0x38')](_0x2b08dc,_0x36b9fd);})['catch'](_0x4d720f=>{console[a25_0xd859('0x39')](_0x4d720f);if(child!=null){child['kill']();child=null;}child=fork(a25_0xd859('0x3a'));});}}exports[a25_0xd859('0x3b')]=SyncVehicleService;