var a27_0x50b0=['process/','Successfully\x20renamed\x20','sendFile','WEB_SERVICE_URL','sync_files/upload_event','serviceUrl:\x20','post','Response\x20body:\x20','status','success/','error','rename','SyncEventsService','defineProperty','__esModule','../infrastructure/stationSettings','fs-extra','folder','env','FILES_FOLDER','eventsRepository','EventsRepository','init','log','syncEvents','bind','StationContext','settings','eventFileFolder','forEach','readFile','trim','parse','reportEvent','then','success','removeSync','exploreDir','readdir','includes','stat','ctime','getTime','syncFile'];(function(_0x3a749c,_0x321081){var _0x3345f0=function(_0x2dd8fc){while(--_0x2dd8fc){_0x3a749c['push'](_0x3a749c['shift']());}};_0x3345f0(++_0x321081);}(a27_0x50b0,0x65));var a27_0x2291=function(_0x40f5ed,_0x3d56f6){_0x40f5ed=_0x40f5ed-0x0;var _0xf7eab8=a27_0x50b0[_0x40f5ed];return _0xf7eab8;};'use strict';Object[a27_0x2291('0x0')](exports,a27_0x2291('0x1'),{'value':!![]});const stationSettings_1=require(a27_0x2291('0x2'));const eventsRepository_1=require('../repositories/eventsRepository');const fsExtra=require(a27_0x2291('0x3'));const request=require('request');class SyncEventsService{constructor(){this[a27_0x2291('0x4')]=process[a27_0x2291('0x5')][a27_0x2291('0x6')];this[a27_0x2291('0x7')]=new eventsRepository_1[(a27_0x2291('0x8'))]();}[a27_0x2291('0x9')](){console[a27_0x2291('0xa')]('init\x20SyncEventsService');setInterval(function(){this[a27_0x2291('0xb')]();}[a27_0x2291('0xc')](this),0x3e8);}[a27_0x2291('0xb')](){const _0x3f7857=this[a27_0x2291('0x4')]+stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')][a27_0x2291('0xf')];fsExtra['readdir'](_0x3f7857,(_0x1b289b,_0x15f307)=>{if(_0x15f307!=null){_0x15f307[a27_0x2291('0x10')](_0x5f180c=>{const _0x56f11a=_0x3f7857+_0x5f180c;const _0x508a0d=fsExtra[a27_0x2291('0x11')](_0x56f11a,function(_0x1b289b,_0x1f892c){try{const _0x4bf23f=_0x1f892c['toString']()[a27_0x2291('0x12')]();const _0x23c1a8=JSON[a27_0x2291('0x13')](_0x4bf23f);this['eventsRepository'][a27_0x2291('0x14')](_0x23c1a8)[a27_0x2291('0x15')](function(_0x4c92c2){if(_0x4c92c2[a27_0x2291('0x16')]){fsExtra[a27_0x2291('0x17')](_0x56f11a);}});}catch(_0x2d64b3){}}['bind'](this));});}});}[a27_0x2291('0x18')](_0x511faf){fsExtra[a27_0x2291('0x19')](stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')][a27_0x2291('0xf')],(_0x54243e,_0x2df2b7)=>{if(_0x2df2b7!=null){_0x2df2b7[a27_0x2291('0x10')](_0x54f725=>{if(_0x54f725[a27_0x2291('0x1a')]('.gz')){fsExtra[a27_0x2291('0x1b')](stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')][a27_0x2291('0xf')]+_0x54f725,(_0x3ea49c,_0xc1266e)=>{const _0x40e398=Math['abs'](new Date()['getTime']()-_0xc1266e[a27_0x2291('0x1c')][a27_0x2291('0x1d')]());if(_0x40e398>0x2710){this[a27_0x2291('0x1e')](_0x54f725);}});}});}});setTimeout(()=>{this[a27_0x2291('0x18')](++_0x511faf);},0x1388);}['syncFile'](_0x35e147){const _0x543088=stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')]['eventFileFolder']+_0x35e147;const _0x54f365=stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')][a27_0x2291('0xf')]+a27_0x2291('0x1f')+_0x35e147;fsExtra['rename'](_0x543088,_0x54f365,_0x1d47e1=>{if(_0x1d47e1){console[a27_0x2291('0xa')](_0x1d47e1);}else{console[a27_0x2291('0xa')](a27_0x2291('0x20')+_0x54f365);this[a27_0x2291('0x21')](_0x35e147,_0x54f365);}});}[a27_0x2291('0x21')](_0x3d929e,_0x5d5c12){const _0x344369=process[a27_0x2291('0x5')][a27_0x2291('0x22')]+a27_0x2291('0x23');const _0x565fb5={'file':fsExtra['createReadStream'](_0x5d5c12)};console[a27_0x2291('0xa')](new Date());console[a27_0x2291('0xa')](a27_0x2291('0x24')+_0x344369);console[a27_0x2291('0xa')]('Sending\x20file:\x20'+_0x3d929e);try{request[a27_0x2291('0x25')]({'url':_0x344369,'formData':_0x565fb5},function(_0xc4d29,_0x39dd24,_0x4e7f71){let _0x1ae4d1=null;let _0x418852='';if(_0xc4d29){_0x418852='';}else{try{console[a27_0x2291('0xa')](a27_0x2291('0x26')+_0x4e7f71);_0x1ae4d1=JSON[a27_0x2291('0x13')](_0x4e7f71);if(_0x1ae4d1[a27_0x2291('0x27')]==0x1){_0x418852=a27_0x2291('0x28');}else{_0x418852='';}}catch(_0x203893){console[a27_0x2291('0x29')](_0x203893);_0x418852='';}}const _0x4efdbc=stationSettings_1[a27_0x2291('0xd')][a27_0x2291('0xe')][a27_0x2291('0xf')]+_0x418852+_0x3d929e;fsExtra[a27_0x2291('0x2a')](_0x5d5c12,_0x4efdbc,function(_0xc4d29){if(_0xc4d29){console[a27_0x2291('0xa')](_0xc4d29);}console['log'](a27_0x2291('0x20')+_0x4efdbc);});});}catch(_0x172e42){console[a27_0x2291('0x29')](_0x172e42);}}}exports[a27_0x2291('0x2b')]=SyncEventsService;