var a21_0x2ba5=['status','error','SyncEventsService','defineProperty','__esModule','../infrastructure/stationSettings','init','log','StationContext','settings','eventFileFolder','includes','abs','getTime','syncFile','exploreDir','rename','Successfully\x20renamed\x20','sendFile','env','WEB_SERVICE_URL','sync_files/upload_event','createReadStream','serviceUrl:\x20','Sending\x20file:\x20','Response\x20body:\x20','parse'];(function(_0x29e24f,_0x11e29f){var _0x3e1e36=function(_0x46db2b){while(--_0x46db2b){_0x29e24f['push'](_0x29e24f['shift']());}};_0x3e1e36(++_0x11e29f);}(a21_0x2ba5,0x17d));var a21_0x403e=function(_0x34db59,_0x1ea273){_0x34db59=_0x34db59-0x0;var _0xe1e7d9=a21_0x2ba5[_0x34db59];return _0xe1e7d9;};'use strict';Object[a21_0x403e('0x0')](exports,a21_0x403e('0x1'),{'value':!![]});const stationSettings_1=require(a21_0x403e('0x2'));const fs=require('fs');const request=require('request');class SyncEventsService{constructor(){}[a21_0x403e('0x3')](){console[a21_0x403e('0x4')]('init\x20SyncEventsService');this['exploreDir'](0x0);}['exploreDir'](_0x22b226){fs['readdir'](stationSettings_1[a21_0x403e('0x5')][a21_0x403e('0x6')][a21_0x403e('0x7')],(_0x206f1b,_0x1067d9)=>{if(_0x1067d9!=null){_0x1067d9['forEach'](_0x1a071f=>{if(_0x1a071f[a21_0x403e('0x8')]('.gz')){fs['stat'](stationSettings_1[a21_0x403e('0x5')]['settings'][a21_0x403e('0x7')]+_0x1a071f,(_0xd97a33,_0x22ca20)=>{const _0x3c5352=Math[a21_0x403e('0x9')](new Date()[a21_0x403e('0xa')]()-_0x22ca20['ctime'][a21_0x403e('0xa')]());if(_0x3c5352>0x2710){this[a21_0x403e('0xb')](_0x1a071f);}});}});}});setTimeout(()=>{this[a21_0x403e('0xc')](++_0x22b226);},0x1388);}['syncFile'](_0x3c8182){const _0x1f7086=stationSettings_1[a21_0x403e('0x5')][a21_0x403e('0x6')][a21_0x403e('0x7')]+_0x3c8182;const _0x2980b2=stationSettings_1[a21_0x403e('0x5')][a21_0x403e('0x6')]['eventFileFolder']+'process/'+_0x3c8182;fs[a21_0x403e('0xd')](_0x1f7086,_0x2980b2,_0x1911b2=>{if(_0x1911b2){console[a21_0x403e('0x4')](_0x1911b2);}else{console['log'](a21_0x403e('0xe')+_0x2980b2);this[a21_0x403e('0xf')](_0x3c8182,_0x2980b2);}});}['sendFile'](_0x503278,_0x587422){const _0xd08107=process[a21_0x403e('0x10')][a21_0x403e('0x11')]+a21_0x403e('0x12');const _0x5802d6={'file':fs[a21_0x403e('0x13')](_0x587422)};console['log'](new Date());console['log'](a21_0x403e('0x14')+_0xd08107);console[a21_0x403e('0x4')](a21_0x403e('0x15')+_0x503278);try{request['post']({'url':_0xd08107,'formData':_0x5802d6},function(_0x10793e,_0x1662a3,_0x80f8c1){let _0x53bb20=null;let _0x3daa66='';if(_0x10793e){_0x3daa66='';}else{try{console[a21_0x403e('0x4')](a21_0x403e('0x16')+_0x80f8c1);_0x53bb20=JSON[a21_0x403e('0x17')](_0x80f8c1);if(_0x53bb20[a21_0x403e('0x18')]==0x1){_0x3daa66='success/';}else{_0x3daa66='';}}catch(_0x53df95){console[a21_0x403e('0x19')](_0x53df95);_0x3daa66='';}}const _0x21e811=stationSettings_1[a21_0x403e('0x5')]['settings']['eventFileFolder']+_0x3daa66+_0x503278;fs['rename'](_0x587422,_0x21e811,function(_0x10793e){if(_0x10793e){console[a21_0x403e('0x4')](_0x10793e);}console[a21_0x403e('0x4')](a21_0x403e('0xe')+_0x21e811);});});}catch(_0x277d06){console[a21_0x403e('0x19')](_0x277d06);}}}exports[a21_0x403e('0x1a')]=SyncEventsService;