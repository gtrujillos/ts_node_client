var a22_0x2ba5=['status','error','SyncEventsService','defineProperty','__esModule','../infrastructure/stationSettings','init','log','StationContext','settings','eventFileFolder','includes','abs','getTime','syncFile','exploreDir','rename','Successfully\x20renamed\x20','sendFile','env','WEB_SERVICE_URL','sync_files/upload_event','createReadStream','serviceUrl:\x20','Sending\x20file:\x20','Response\x20body:\x20','parse'];(function(_0x1f04de,_0x5a9624){var _0x129d55=function(_0x47b292){while(--_0x47b292){_0x1f04de['push'](_0x1f04de['shift']());}};_0x129d55(++_0x5a9624);}(a22_0x2ba5,0x17d));var a22_0x403e=function(_0x184753,_0x33110c){_0x184753=_0x184753-0x0;var _0x1eecae=a22_0x2ba5[_0x184753];return _0x1eecae;};'use strict';Object[a22_0x403e('0x0')](exports,a22_0x403e('0x1'),{'value':!![]});const stationSettings_1=require(a22_0x403e('0x2'));const fs=require('fs');const request=require('request');class SyncEventsService{constructor(){}[a22_0x403e('0x3')](){console[a22_0x403e('0x4')]('init\x20SyncEventsService');this['exploreDir'](0x0);}['exploreDir'](_0x22b226){fs['readdir'](stationSettings_1[a22_0x403e('0x5')][a22_0x403e('0x6')][a22_0x403e('0x7')],(_0x206f1b,_0x1067d9)=>{if(_0x1067d9!=null){_0x1067d9['forEach'](_0x1a071f=>{if(_0x1a071f[a22_0x403e('0x8')]('.gz')){fs['stat'](stationSettings_1[a22_0x403e('0x5')]['settings'][a22_0x403e('0x7')]+_0x1a071f,(_0xd97a33,_0x22ca20)=>{const _0x3c5352=Math[a22_0x403e('0x9')](new Date()[a22_0x403e('0xa')]()-_0x22ca20['ctime'][a22_0x403e('0xa')]());if(_0x3c5352>0x2710){this[a22_0x403e('0xb')](_0x1a071f);}});}});}});setTimeout(()=>{this[a22_0x403e('0xc')](++_0x22b226);},0x1388);}['syncFile'](_0x3c8182){const _0x1f7086=stationSettings_1[a22_0x403e('0x5')][a22_0x403e('0x6')][a22_0x403e('0x7')]+_0x3c8182;const _0x2980b2=stationSettings_1[a22_0x403e('0x5')][a22_0x403e('0x6')]['eventFileFolder']+'process/'+_0x3c8182;fs[a22_0x403e('0xd')](_0x1f7086,_0x2980b2,_0x1911b2=>{if(_0x1911b2){console[a22_0x403e('0x4')](_0x1911b2);}else{console['log'](a22_0x403e('0xe')+_0x2980b2);this[a22_0x403e('0xf')](_0x3c8182,_0x2980b2);}});}['sendFile'](_0x503278,_0x587422){const _0xd08107=process[a22_0x403e('0x10')][a22_0x403e('0x11')]+a22_0x403e('0x12');const _0x5802d6={'file':fs[a22_0x403e('0x13')](_0x587422)};console['log'](new Date());console['log'](a22_0x403e('0x14')+_0xd08107);console[a22_0x403e('0x4')](a22_0x403e('0x15')+_0x503278);try{request['post']({'url':_0xd08107,'formData':_0x5802d6},function(_0x10793e,_0x1662a3,_0x80f8c1){let _0x53bb20=null;let _0x3daa66='';if(_0x10793e){_0x3daa66='';}else{try{console[a22_0x403e('0x4')](a22_0x403e('0x16')+_0x80f8c1);_0x53bb20=JSON[a22_0x403e('0x17')](_0x80f8c1);if(_0x53bb20[a22_0x403e('0x18')]==0x1){_0x3daa66='success/';}else{_0x3daa66='';}}catch(_0x53df95){console[a22_0x403e('0x19')](_0x53df95);_0x3daa66='';}}const _0x21e811=stationSettings_1[a22_0x403e('0x5')]['settings']['eventFileFolder']+_0x3daa66+_0x503278;fs['rename'](_0x587422,_0x21e811,function(_0x10793e){if(_0x10793e){console[a22_0x403e('0x4')](_0x10793e);}console[a22_0x403e('0x4')](a22_0x403e('0xe')+_0x21e811);});});}catch(_0x277d06){console[a22_0x403e('0x19')](_0x277d06);}}}exports[a22_0x403e('0x1a')]=SyncEventsService;