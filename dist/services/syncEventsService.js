var a27_0x173b=['init','bind','syncEvents','StationContext','settings','eventFileFolder','forEach','readFile','toString','trim','parse','reportEvent','success','removeSync','exploreDir','readdir','includes','.gz','abs','getTime','ctime','syncFile','process/','log','sendFile','sync_files/upload_event','createReadStream','serviceUrl:\x20','Sending\x20file:\x20','post','Response\x20body:\x20','status','success/','rename','Successfully\x20renamed\x20','error','SyncEventsService','defineProperty','__esModule','../repositories/eventsRepository','fs-extra','request','folder','FILES_FOLDER','EventsRepository'];(function(_0x597fd2,_0x3a3763){var _0x2c7d7b=function(_0x59fb18){while(--_0x59fb18){_0x597fd2['push'](_0x597fd2['shift']());}};_0x2c7d7b(++_0x3a3763);}(a27_0x173b,0x1ba));var a27_0x637b=function(_0x649bf0,_0x2588d7){_0x649bf0=_0x649bf0-0x0;var _0x166704=a27_0x173b[_0x649bf0];return _0x166704;};'use strict';Object[a27_0x637b('0x0')](exports,a27_0x637b('0x1'),{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const eventsRepository_1=require(a27_0x637b('0x2'));const fsExtra=require(a27_0x637b('0x3'));const request=require(a27_0x637b('0x4'));class SyncEventsService{constructor(){this[a27_0x637b('0x5')]=process['env'][a27_0x637b('0x6')];this['eventsRepository']=new eventsRepository_1[(a27_0x637b('0x7'))]();}[a27_0x637b('0x8')](){console['log']('init\x20SyncEventsService');setInterval(function(){this['syncEvents']();}[a27_0x637b('0x9')](this),0x3e8);}[a27_0x637b('0xa')](){const _0x1c398b=this[a27_0x637b('0x5')]+stationSettings_1[a27_0x637b('0xb')][a27_0x637b('0xc')][a27_0x637b('0xd')];fsExtra['readdir'](_0x1c398b,(_0x43b399,_0x1bf50e)=>{if(_0x1bf50e!=null){_0x1bf50e[a27_0x637b('0xe')](_0x3b44a8=>{const _0x1b1028=_0x1c398b+_0x3b44a8;const _0x492029=fsExtra[a27_0x637b('0xf')](_0x1b1028,function(_0x43b399,_0x31be30){try{const _0x539138=_0x31be30[a27_0x637b('0x10')]()[a27_0x637b('0x11')]();const _0x2f51a5=JSON[a27_0x637b('0x12')](_0x539138);this['eventsRepository'][a27_0x637b('0x13')](_0x2f51a5)['then'](function(_0x82c62d){if(_0x82c62d[a27_0x637b('0x14')]){fsExtra[a27_0x637b('0x15')](_0x1b1028);}});}catch(_0x219dc7){}}[a27_0x637b('0x9')](this));});}});}[a27_0x637b('0x16')](_0xcb83d){fsExtra[a27_0x637b('0x17')](stationSettings_1['StationContext'][a27_0x637b('0xc')]['eventFileFolder'],(_0x3a7639,_0x1d89fb)=>{if(_0x1d89fb!=null){_0x1d89fb['forEach'](_0x2faed2=>{if(_0x2faed2[a27_0x637b('0x18')](a27_0x637b('0x19'))){fsExtra['stat'](stationSettings_1[a27_0x637b('0xb')][a27_0x637b('0xc')]['eventFileFolder']+_0x2faed2,(_0x529b95,_0x3bcc49)=>{const _0x516d73=Math[a27_0x637b('0x1a')](new Date()[a27_0x637b('0x1b')]()-_0x3bcc49[a27_0x637b('0x1c')][a27_0x637b('0x1b')]());if(_0x516d73>0x2710){this[a27_0x637b('0x1d')](_0x2faed2);}});}});}});setTimeout(()=>{this[a27_0x637b('0x16')](++_0xcb83d);},0x1388);}[a27_0x637b('0x1d')](_0x24b878){const _0x4fe200=stationSettings_1['StationContext'][a27_0x637b('0xc')][a27_0x637b('0xd')]+_0x24b878;const _0x407a36=stationSettings_1[a27_0x637b('0xb')]['settings'][a27_0x637b('0xd')]+a27_0x637b('0x1e')+_0x24b878;fsExtra['rename'](_0x4fe200,_0x407a36,_0x2d4a3a=>{if(_0x2d4a3a){console['log'](_0x2d4a3a);}else{console[a27_0x637b('0x1f')]('Successfully\x20renamed\x20'+_0x407a36);this[a27_0x637b('0x20')](_0x24b878,_0x407a36);}});}[a27_0x637b('0x20')](_0x23b14e,_0x6ef057){const _0x11b726=process['env']['WEB_SERVICE_URL']+a27_0x637b('0x21');const _0x466cff={'file':fsExtra[a27_0x637b('0x22')](_0x6ef057)};console['log'](new Date());console[a27_0x637b('0x1f')](a27_0x637b('0x23')+_0x11b726);console[a27_0x637b('0x1f')](a27_0x637b('0x24')+_0x23b14e);try{request[a27_0x637b('0x25')]({'url':_0x11b726,'formData':_0x466cff},function(_0xe17d02,_0x2e4f50,_0x12fcfd){let _0x1c38d1=null;let _0x51787d='';if(_0xe17d02){_0x51787d='';}else{try{console['log'](a27_0x637b('0x26')+_0x12fcfd);_0x1c38d1=JSON[a27_0x637b('0x12')](_0x12fcfd);if(_0x1c38d1[a27_0x637b('0x27')]==0x1){_0x51787d=a27_0x637b('0x28');}else{_0x51787d='';}}catch(_0x4ad265){console['error'](_0x4ad265);_0x51787d='';}}const _0x467b69=stationSettings_1[a27_0x637b('0xb')][a27_0x637b('0xc')][a27_0x637b('0xd')]+_0x51787d+_0x23b14e;fsExtra[a27_0x637b('0x29')](_0x6ef057,_0x467b69,function(_0xe17d02){if(_0xe17d02){console[a27_0x637b('0x1f')](_0xe17d02);}console['log'](a27_0x637b('0x2a')+_0x467b69);});});}catch(_0x5428cd){console[a27_0x637b('0x2b')](_0x5428cd);}}}exports[a27_0x637b('0x2c')]=SyncEventsService;