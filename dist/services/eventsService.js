var a15_0x46fc=['pipe','finish','log','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','request','eventDateParts','startDateParts','gpsService','countingWebSocketService','createEvent','bind','sensorsService','startDate','DateUtils','eventDate','getDateParts','createJson','createFile','1-71767930-','year','month','day','hour','minute','second','StationContext','settings','routeCode','routeName','nit','locationParts','hdop','longitude','speed','CountingInfo','Out','zlib','plate','eventFileFolder','writeFile','error','.gz','createGzip','createReadStream','createWriteStream'];(function(_0x2da1de,_0x5557a3){var _0x120269=function(_0x5c42a0){while(--_0x5c42a0){_0x2da1de['push'](_0x2da1de['shift']());}};_0x120269(++_0x5557a3);}(a15_0x46fc,0x132));var a15_0x3081=function(_0x35ec2b,_0x192e0b){_0x35ec2b=_0x35ec2b-0x0;var _0x1e8ca7=a15_0x46fc[_0x35ec2b];return _0x1e8ca7;};'use strict';Object[a15_0x3081('0x0')](exports,a15_0x3081('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x3081('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require(a15_0x3081('0x3'));class EventsService{constructor(_0x55bf45,_0x528439,_0x3385a2){this[a15_0x3081('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3081('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3081('0x6')]=_0x55bf45;this['sensorsService']=_0x528439;this[a15_0x3081('0x7')]=_0x3385a2;this[a15_0x3081('0x6')][a15_0x3081('0x8')]=this[a15_0x3081('0x8')][a15_0x3081('0x9')](this);this[a15_0x3081('0xa')][a15_0x3081('0x8')]=this['createEvent'][a15_0x3081('0x9')](this);this[a15_0x3081('0x7')][a15_0x3081('0x8')]=this[a15_0x3081('0x8')][a15_0x3081('0x9')](this);this[a15_0x3081('0xb')]=new Date();this[a15_0x3081('0x5')]=dateUtils_1[a15_0x3081('0xc')]['getDateParts'](this[a15_0x3081('0xb')]);}['createEvent'](_0x5f44ad){try{this[a15_0x3081('0xd')]=new Date();this[a15_0x3081('0x4')]=dateUtils_1[a15_0x3081('0xc')][a15_0x3081('0xe')](this[a15_0x3081('0xd')]);const _0x4bcde6=this[a15_0x3081('0xf')](_0x5f44ad);const _0x25faff=this[a15_0x3081('0x10')](_0x4bcde6);}catch(_0x679615){console['log'](_0x679615);}}[a15_0x3081('0xf')](_0x5b61ad){const _0x197588={'idViaje':a15_0x3081('0x11')+this['eventDateParts'][a15_0x3081('0x12')]+this[a15_0x3081('0x4')][a15_0x3081('0x13')]+this[a15_0x3081('0x4')][a15_0x3081('0x14')]+'-'+this[a15_0x3081('0x4')][a15_0x3081('0x15')]+this[a15_0x3081('0x4')][a15_0x3081('0x16')]+this[a15_0x3081('0x4')][a15_0x3081('0x17')]+'-00001','cedula':stationSettings_1[a15_0x3081('0x18')][a15_0x3081('0x19')]['driverDocument'],'codigoRuta':stationSettings_1[a15_0x3081('0x18')]['settings'][a15_0x3081('0x1a')],'ruta':stationSettings_1[a15_0x3081('0x18')][a15_0x3081('0x19')][a15_0x3081('0x1b')],'nit':stationSettings_1[a15_0x3081('0x18')]['settings'][a15_0x3081('0x1c')],'placa':stationSettings_1['StationContext']['settings']['plate'],'inicio_viaje':this[a15_0x3081('0x4')][a15_0x3081('0x14')]+'/'+this[a15_0x3081('0x4')][a15_0x3081('0x13')]+'/'+this[a15_0x3081('0x4')][a15_0x3081('0x12')]+'\x20'+this[a15_0x3081('0x4')]['hour']+':'+this[a15_0x3081('0x4')][a15_0x3081('0x16')]+':'+this[a15_0x3081('0x4')]['second'],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts'][a15_0x3081('0x12')]+this['eventDateParts']['month']+this['eventDateParts']['day'],'hora':this[a15_0x3081('0x4')]['hour']+this[a15_0x3081('0x4')][a15_0x3081('0x16')]+this[a15_0x3081('0x4')][a15_0x3081('0x17')],'dop':this[a15_0x3081('0x6')][a15_0x3081('0x1d')][a15_0x3081('0x1e')],'longitud':this['gpsService'][a15_0x3081('0x1d')][a15_0x3081('0x1f')],'latitud':this[a15_0x3081('0x6')][a15_0x3081('0x1d')]['latitude'],'velocidad':this['gpsService']['locationParts'][a15_0x3081('0x20')],'puerta':[{'estado':this['sensorsService']['doorStatus'],'idPuerta':0x0,'ingresos':_0x5b61ad!=null?_0x5b61ad[a15_0x3081('0x21')][0x0]['In']:0x0,'salidas':_0x5b61ad!=null?_0x5b61ad['CountingInfo'][0x0][a15_0x3081('0x22')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x197588;}['createFile'](_0x18f489){const _0x5f3ae2=require('fs');const _0x9b1a71=require(a15_0x3081('0x23'));const _0x3b793a=stationSettings_1[a15_0x3081('0x18')][a15_0x3081('0x19')]['nit']+stationSettings_1[a15_0x3081('0x18')][a15_0x3081('0x19')][a15_0x3081('0x24')]+this[a15_0x3081('0x4')]['day']+this[a15_0x3081('0x4')][a15_0x3081('0x13')]+this['eventDateParts'][a15_0x3081('0x12')]+this[a15_0x3081('0x4')][a15_0x3081('0x15')]+this[a15_0x3081('0x4')][a15_0x3081('0x16')]+this[a15_0x3081('0x4')]['second'];const _0x27b18e=stationSettings_1['StationContext']['settings'][a15_0x3081('0x25')]+_0x3b793a;const _0x47cadf=JSON['stringify'](_0x18f489);_0x5f3ae2[a15_0x3081('0x26')](_0x27b18e,_0x47cadf,_0x52969c=>{if(_0x52969c)return console[a15_0x3081('0x27')](_0x52969c);const _0x54dff4=_0x27b18e+a15_0x3081('0x28');const _0x346cd6=_0x9b1a71[a15_0x3081('0x29')]();const _0x59e00e=_0x5f3ae2[a15_0x3081('0x2a')](_0x27b18e);const _0x61f1fe=_0x5f3ae2[a15_0x3081('0x2b')](_0x54dff4);_0x59e00e[a15_0x3081('0x2c')](_0x346cd6)[a15_0x3081('0x2c')](_0x61f1fe)['on'](a15_0x3081('0x2d'),_0x52969c=>{if(_0x52969c)return console[a15_0x3081('0x27')](_0x52969c);else{if(_0x5f3ae2['existsSync'](_0x27b18e)){_0x5f3ae2['unlink'](_0x27b18e,_0x52969c=>{if(_0x52969c)throw _0x52969c;console[a15_0x3081('0x2e')](a15_0x3081('0x2f')+_0x27b18e);});}console[a15_0x3081('0x2e')](a15_0x3081('0x30')+_0x54dff4);return _0x54dff4;}});});}}exports[a15_0x3081('0x31')]=EventsService;