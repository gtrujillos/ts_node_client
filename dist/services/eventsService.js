var a15_0x29ba=['eventDateParts','gpsService','sensorsService','createEvent','bind','countingWebSocketService','startDate','startDateParts','DateUtils','getDateParts','eventDate','createJson','createFile','1-71767930-','month','minute','second','settings','driverDocument','routeCode','StationContext','routeName','nit','plate','day','year','hour','hdop','locationParts','longitude','latitude','speed','doorStatus','CountingInfo','Out','zlib','eventFileFolder','stringify','writeFile','error','createGzip','createReadStream','pipe','finish','existsSync','unlink','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request'];(function(_0x219796,_0xe6401){var _0x79edc7=function(_0x3a6f26){while(--_0x3a6f26){_0x219796['push'](_0x219796['shift']());}};_0x79edc7(++_0xe6401);}(a15_0x29ba,0x104));var a15_0x15b2=function(_0x4dbf90,_0x470f7f){_0x4dbf90=_0x4dbf90-0x0;var _0x342a5c=a15_0x29ba[_0x4dbf90];return _0x342a5c;};'use strict';Object[a15_0x15b2('0x0')](exports,a15_0x15b2('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x15b2('0x2'));const dateUtils_1=require(a15_0x15b2('0x3'));const fs=require('fs');const request=require(a15_0x15b2('0x4'));class EventsService{constructor(_0x2be5da,_0x5abd37,_0x1a7940){this[a15_0x15b2('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x15b2('0x6')]=_0x2be5da;this[a15_0x15b2('0x7')]=_0x5abd37;this['countingWebSocketService']=_0x1a7940;this['gpsService'][a15_0x15b2('0x8')]=this['createEvent'][a15_0x15b2('0x9')](this);this['sensorsService']['createEvent']=this[a15_0x15b2('0x8')]['bind'](this);this[a15_0x15b2('0xa')][a15_0x15b2('0x8')]=this['createEvent'][a15_0x15b2('0x9')](this);this[a15_0x15b2('0xb')]=new Date();this[a15_0x15b2('0xc')]=dateUtils_1[a15_0x15b2('0xd')][a15_0x15b2('0xe')](this[a15_0x15b2('0xb')]);}[a15_0x15b2('0x8')](_0x1a92c4){try{this[a15_0x15b2('0xf')]=new Date();this[a15_0x15b2('0x5')]=dateUtils_1[a15_0x15b2('0xd')]['getDateParts'](this['eventDate']);const _0x490b8d=this[a15_0x15b2('0x10')](_0x1a92c4);const _0x2d86fd=this[a15_0x15b2('0x11')](_0x490b8d);}catch(_0x356473){console['log'](_0x356473);}}[a15_0x15b2('0x10')](_0x4adc28){const _0x1f4225={'idViaje':a15_0x15b2('0x12')+this[a15_0x15b2('0x5')]['year']+this[a15_0x15b2('0x5')][a15_0x15b2('0x13')]+this[a15_0x15b2('0x5')]['day']+'-'+this['eventDateParts']['hour']+this[a15_0x15b2('0x5')][a15_0x15b2('0x14')]+this['eventDateParts'][a15_0x15b2('0x15')]+'-00001','cedula':stationSettings_1['StationContext'][a15_0x15b2('0x16')][a15_0x15b2('0x17')],'codigoRuta':stationSettings_1['StationContext'][a15_0x15b2('0x16')][a15_0x15b2('0x18')],'ruta':stationSettings_1[a15_0x15b2('0x19')][a15_0x15b2('0x16')][a15_0x15b2('0x1a')],'nit':stationSettings_1['StationContext'][a15_0x15b2('0x16')][a15_0x15b2('0x1b')],'placa':stationSettings_1[a15_0x15b2('0x19')]['settings'][a15_0x15b2('0x1c')],'inicio_viaje':this[a15_0x15b2('0x5')][a15_0x15b2('0x1d')]+'/'+this[a15_0x15b2('0x5')][a15_0x15b2('0x13')]+'/'+this[a15_0x15b2('0x5')][a15_0x15b2('0x1e')]+'\x20'+this[a15_0x15b2('0x5')][a15_0x15b2('0x1f')]+':'+this[a15_0x15b2('0x5')]['minute']+':'+this[a15_0x15b2('0x5')][a15_0x15b2('0x15')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x15b2('0x5')][a15_0x15b2('0x1e')]+this[a15_0x15b2('0x5')][a15_0x15b2('0x13')]+this[a15_0x15b2('0x5')][a15_0x15b2('0x1d')],'hora':this[a15_0x15b2('0x5')]['hour']+this[a15_0x15b2('0x5')][a15_0x15b2('0x14')]+this[a15_0x15b2('0x5')]['second'],'dop':this['gpsService']['locationParts'][a15_0x15b2('0x20')],'longitud':this[a15_0x15b2('0x6')][a15_0x15b2('0x21')][a15_0x15b2('0x22')],'latitud':this[a15_0x15b2('0x6')]['locationParts'][a15_0x15b2('0x23')],'velocidad':this['gpsService'][a15_0x15b2('0x21')][a15_0x15b2('0x24')],'puerta':[{'estado':this[a15_0x15b2('0x7')][a15_0x15b2('0x25')],'idPuerta':0x0,'ingresos':_0x4adc28!=null?_0x4adc28[a15_0x15b2('0x26')][0x0]['In']:0x0,'salidas':_0x4adc28!=null?_0x4adc28[a15_0x15b2('0x26')][0x0][a15_0x15b2('0x27')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x1f4225;}[a15_0x15b2('0x11')](_0x47f7d6){const _0x1d3609=require('fs');const _0x434104=require(a15_0x15b2('0x28'));const _0x2da2e7=stationSettings_1['StationContext']['settings']['nit']+stationSettings_1['StationContext'][a15_0x15b2('0x16')]['plate']+this[a15_0x15b2('0x5')][a15_0x15b2('0x1d')]+this['eventDateParts']['month']+this[a15_0x15b2('0x5')][a15_0x15b2('0x1e')]+this['eventDateParts'][a15_0x15b2('0x1f')]+this[a15_0x15b2('0x5')][a15_0x15b2('0x14')]+this[a15_0x15b2('0x5')][a15_0x15b2('0x15')];const _0x394f05=stationSettings_1[a15_0x15b2('0x19')][a15_0x15b2('0x16')][a15_0x15b2('0x29')]+_0x2da2e7;const _0x45a5d2=JSON[a15_0x15b2('0x2a')](_0x47f7d6);_0x1d3609[a15_0x15b2('0x2b')](_0x394f05,_0x45a5d2,_0x1fad7f=>{if(_0x1fad7f)return console[a15_0x15b2('0x2c')](_0x1fad7f);const _0xb304d3=_0x394f05+'.gz';const _0x52b821=_0x434104[a15_0x15b2('0x2d')]();const _0x22ba0a=_0x1d3609[a15_0x15b2('0x2e')](_0x394f05);const _0x54dab1=_0x1d3609['createWriteStream'](_0xb304d3);_0x22ba0a[a15_0x15b2('0x2f')](_0x52b821)[a15_0x15b2('0x2f')](_0x54dab1)['on'](a15_0x15b2('0x30'),_0x1fad7f=>{if(_0x1fad7f)return console[a15_0x15b2('0x2c')](_0x1fad7f);else{if(_0x1d3609[a15_0x15b2('0x31')](_0x394f05)){_0x1d3609[a15_0x15b2('0x32')](_0x394f05,_0x1fad7f=>{if(_0x1fad7f)throw _0x1fad7f;console['log']('successfully\x20deleted\x20'+_0x394f05);});}console['log'](a15_0x15b2('0x33')+_0xb304d3);return _0xb304d3;}});});}}exports[a15_0x15b2('0x34')]=EventsService;