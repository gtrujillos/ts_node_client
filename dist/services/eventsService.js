var a15_0x291d=['settings','routeCode','routeName','nit','plate','minute','second','hdop','locationParts','longitude','latitude','speed','CountingInfo','Out','createFile','zlib','eventFileFolder','stringify','writeFile','error','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','getDateParts','eventDate','DateUtils','log','createJson','1-71767930-','year','month','day','hour','-00001','StationContext','driverDocument'];(function(_0x4ff97d,_0x573bc8){var _0x24dada=function(_0x12322b){while(--_0x12322b){_0x4ff97d['push'](_0x4ff97d['shift']());}};_0x24dada(++_0x573bc8);}(a15_0x291d,0x1a0));var a15_0x1849=function(_0x5433a0,_0x4b0197){_0x5433a0=_0x5433a0-0x0;var _0x2dd8d6=a15_0x291d[_0x5433a0];return _0x2dd8d6;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const stationSettings_1=require(a15_0x1849('0x0'));const dateUtils_1=require(a15_0x1849('0x1'));const fs=require('fs');const request=require(a15_0x1849('0x2'));class EventsService{constructor(_0xeb678b,_0x28883e,_0x345d3d){this[a15_0x1849('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1849('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1849('0x5')]=_0xeb678b;this[a15_0x1849('0x6')]=_0x28883e;this[a15_0x1849('0x7')]=_0x345d3d;this[a15_0x1849('0x5')]['createEvent']=this[a15_0x1849('0x8')][a15_0x1849('0x9')](this);this[a15_0x1849('0x6')][a15_0x1849('0x8')]=this[a15_0x1849('0x8')][a15_0x1849('0x9')](this);this[a15_0x1849('0x7')][a15_0x1849('0x8')]=this[a15_0x1849('0x8')][a15_0x1849('0x9')](this);this[a15_0x1849('0xa')]=new Date();this[a15_0x1849('0x4')]=dateUtils_1['DateUtils'][a15_0x1849('0xb')](this['startDate']);}['createEvent'](_0x53dccb){try{this[a15_0x1849('0xc')]=new Date();this[a15_0x1849('0x3')]=dateUtils_1[a15_0x1849('0xd')][a15_0x1849('0xb')](this[a15_0x1849('0xc')]);const _0x2cbe4e=this['createJson'](_0x53dccb);const _0x6ab0ce=this['createFile'](_0x2cbe4e);}catch(_0x1d2558){console[a15_0x1849('0xe')](_0x1d2558);}}[a15_0x1849('0xf')](_0x51e7f6){const _0x371df7={'idViaje':a15_0x1849('0x10')+this[a15_0x1849('0x3')][a15_0x1849('0x11')]+this[a15_0x1849('0x3')][a15_0x1849('0x12')]+this['eventDateParts'][a15_0x1849('0x13')]+'-'+this[a15_0x1849('0x3')][a15_0x1849('0x14')]+this[a15_0x1849('0x3')]['minute']+this[a15_0x1849('0x3')]['second']+a15_0x1849('0x15'),'cedula':stationSettings_1[a15_0x1849('0x16')]['settings'][a15_0x1849('0x17')],'codigoRuta':stationSettings_1[a15_0x1849('0x16')][a15_0x1849('0x18')][a15_0x1849('0x19')],'ruta':stationSettings_1['StationContext'][a15_0x1849('0x18')][a15_0x1849('0x1a')],'nit':stationSettings_1['StationContext'][a15_0x1849('0x18')][a15_0x1849('0x1b')],'placa':stationSettings_1[a15_0x1849('0x16')][a15_0x1849('0x18')][a15_0x1849('0x1c')],'inicio_viaje':this[a15_0x1849('0x3')][a15_0x1849('0x13')]+'/'+this[a15_0x1849('0x3')][a15_0x1849('0x12')]+'/'+this[a15_0x1849('0x3')][a15_0x1849('0x11')]+'\x20'+this['eventDateParts'][a15_0x1849('0x14')]+':'+this['eventDateParts'][a15_0x1849('0x1d')]+':'+this[a15_0x1849('0x3')][a15_0x1849('0x1e')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x1849('0x3')][a15_0x1849('0x11')]+this[a15_0x1849('0x3')][a15_0x1849('0x12')]+this['eventDateParts'][a15_0x1849('0x13')],'hora':this[a15_0x1849('0x3')][a15_0x1849('0x14')]+this['eventDateParts'][a15_0x1849('0x1d')]+this[a15_0x1849('0x3')][a15_0x1849('0x1e')],'dop':this[a15_0x1849('0x5')]['locationParts'][a15_0x1849('0x1f')],'longitud':this['gpsService'][a15_0x1849('0x20')][a15_0x1849('0x21')],'latitud':this['gpsService'][a15_0x1849('0x20')][a15_0x1849('0x22')],'velocidad':this['gpsService'][a15_0x1849('0x20')][a15_0x1849('0x23')],'puerta':[{'estado':this['sensorsService']['doorStatus'],'idPuerta':0x0,'ingresos':_0x51e7f6!=null?_0x51e7f6['CountingInfo'][0x0]['In']:0x0,'salidas':_0x51e7f6!=null?_0x51e7f6[a15_0x1849('0x24')][0x0][a15_0x1849('0x25')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x371df7;}[a15_0x1849('0x26')](_0xf661e1){const _0x3ccfee=require('fs');const _0x558197=require(a15_0x1849('0x27'));const _0x405461=stationSettings_1['StationContext'][a15_0x1849('0x18')]['nit']+stationSettings_1['StationContext'][a15_0x1849('0x18')][a15_0x1849('0x1c')]+this[a15_0x1849('0x3')][a15_0x1849('0x13')]+this[a15_0x1849('0x3')][a15_0x1849('0x12')]+this[a15_0x1849('0x3')][a15_0x1849('0x11')]+this[a15_0x1849('0x3')][a15_0x1849('0x14')]+this['eventDateParts'][a15_0x1849('0x1d')]+this['eventDateParts']['second'];const _0x478415=stationSettings_1[a15_0x1849('0x16')]['settings'][a15_0x1849('0x28')]+_0x405461;const _0x576c70=JSON[a15_0x1849('0x29')](_0xf661e1);_0x3ccfee[a15_0x1849('0x2a')](_0x478415,_0x576c70,_0x2b2426=>{if(_0x2b2426)return console[a15_0x1849('0x2b')](_0x2b2426);const _0xbbda4b=_0x478415+a15_0x1849('0x2c');const _0x2eaaef=_0x558197[a15_0x1849('0x2d')]();const _0x5b3aa5=_0x3ccfee[a15_0x1849('0x2e')](_0x478415);const _0x3f744d=_0x3ccfee[a15_0x1849('0x2f')](_0xbbda4b);_0x5b3aa5[a15_0x1849('0x30')](_0x2eaaef)[a15_0x1849('0x30')](_0x3f744d)['on'](a15_0x1849('0x31'),_0x2b2426=>{if(_0x2b2426)return console['error'](_0x2b2426);else{if(_0x3ccfee[a15_0x1849('0x32')](_0x478415)){_0x3ccfee[a15_0x1849('0x33')](_0x478415,_0x2b2426=>{if(_0x2b2426)throw _0x2b2426;console['log'](a15_0x1849('0x34')+_0x478415);});}console[a15_0x1849('0xe')](a15_0x1849('0x35')+_0xbbda4b);return _0xbbda4b;}});});}}exports[a15_0x1849('0x36')]=EventsService;