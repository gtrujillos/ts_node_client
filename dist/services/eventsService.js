var a15_0x16a4=['hour','locationParts','latitude','doorStatus','CountingInfo','Out','zlib','stringify','writeFile','.gz','createGzip','createReadStream','pipe','finish','error','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','defineProperty','__esModule','eventDateParts','startDateParts','gpsService','sensorsService','createEvent','bind','countingWebSocketService','startDate','getDateParts','DateUtils','eventDate','createJson','createFile','log','month','day','minute','second','settings','StationContext','routeName','plate','year'];(function(_0x43deac,_0x4e9747){var _0x40e819=function(_0x24c31d){while(--_0x24c31d){_0x43deac['push'](_0x43deac['shift']());}};_0x40e819(++_0x4e9747);}(a15_0x16a4,0x97));var a15_0x3b98=function(_0x3a842f,_0xfec595){_0x3a842f=_0x3a842f-0x0;var _0x5e4897=a15_0x16a4[_0x3a842f];return _0x5e4897;};'use strict';Object[a15_0x3b98('0x0')](exports,a15_0x3b98('0x1'),{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require('request');class EventsService{constructor(_0x1fe514,_0x2feabc,_0x382cc2){this[a15_0x3b98('0x2')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3b98('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3b98('0x4')]=_0x1fe514;this[a15_0x3b98('0x5')]=_0x2feabc;this['countingWebSocketService']=_0x382cc2;this['gpsService']['createEvent']=this[a15_0x3b98('0x6')][a15_0x3b98('0x7')](this);this[a15_0x3b98('0x5')][a15_0x3b98('0x6')]=this[a15_0x3b98('0x6')][a15_0x3b98('0x7')](this);this[a15_0x3b98('0x8')][a15_0x3b98('0x6')]=this[a15_0x3b98('0x6')][a15_0x3b98('0x7')](this);this[a15_0x3b98('0x9')]=new Date();this[a15_0x3b98('0x3')]=dateUtils_1['DateUtils'][a15_0x3b98('0xa')](this['startDate']);}[a15_0x3b98('0x6')](_0x3445a3){try{this['eventDate']=new Date();this[a15_0x3b98('0x2')]=dateUtils_1[a15_0x3b98('0xb')][a15_0x3b98('0xa')](this[a15_0x3b98('0xc')]);const _0x33e9cf=this[a15_0x3b98('0xd')](_0x3445a3);const _0x541d40=this[a15_0x3b98('0xe')](_0x33e9cf);}catch(_0x386ef1){console[a15_0x3b98('0xf')](_0x386ef1);}}['createJson'](_0x4c58ee){const _0x598a34={'idViaje':'1-71767930-'+this['eventDateParts']['year']+this[a15_0x3b98('0x2')][a15_0x3b98('0x10')]+this[a15_0x3b98('0x2')][a15_0x3b98('0x11')]+'-'+this[a15_0x3b98('0x2')]['hour']+this[a15_0x3b98('0x2')][a15_0x3b98('0x12')]+this['eventDateParts'][a15_0x3b98('0x13')]+'-00001','cedula':stationSettings_1['StationContext'][a15_0x3b98('0x14')]['driverDocument'],'codigoRuta':stationSettings_1[a15_0x3b98('0x15')][a15_0x3b98('0x14')]['routeCode'],'ruta':stationSettings_1[a15_0x3b98('0x15')][a15_0x3b98('0x14')][a15_0x3b98('0x16')],'nit':stationSettings_1[a15_0x3b98('0x15')][a15_0x3b98('0x14')]['nit'],'placa':stationSettings_1['StationContext']['settings'][a15_0x3b98('0x17')],'inicio_viaje':this['eventDateParts']['day']+'/'+this[a15_0x3b98('0x2')][a15_0x3b98('0x10')]+'/'+this['eventDateParts'][a15_0x3b98('0x18')]+'\x20'+this[a15_0x3b98('0x2')][a15_0x3b98('0x19')]+':'+this[a15_0x3b98('0x2')][a15_0x3b98('0x12')]+':'+this['eventDateParts'][a15_0x3b98('0x13')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x3b98('0x2')][a15_0x3b98('0x18')]+this[a15_0x3b98('0x2')][a15_0x3b98('0x10')]+this[a15_0x3b98('0x2')][a15_0x3b98('0x11')],'hora':this[a15_0x3b98('0x2')]['hour']+this[a15_0x3b98('0x2')][a15_0x3b98('0x12')]+this[a15_0x3b98('0x2')]['second'],'dop':this['gpsService'][a15_0x3b98('0x1a')]['hdop'],'longitud':this[a15_0x3b98('0x4')]['locationParts']['longitude'],'latitud':this[a15_0x3b98('0x4')][a15_0x3b98('0x1a')][a15_0x3b98('0x1b')],'velocidad':this['gpsService'][a15_0x3b98('0x1a')]['speed'],'puerta':[{'estado':this[a15_0x3b98('0x5')][a15_0x3b98('0x1c')],'idPuerta':0x0,'ingresos':_0x4c58ee!=null?_0x4c58ee[a15_0x3b98('0x1d')][0x0]['In']:0x0,'salidas':_0x4c58ee!=null?_0x4c58ee[a15_0x3b98('0x1d')][0x0][a15_0x3b98('0x1e')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x598a34;}[a15_0x3b98('0xe')](_0x4718c8){const _0xccd510=require('fs');const _0x5896cf=require(a15_0x3b98('0x1f'));const _0x2aa5e0=stationSettings_1[a15_0x3b98('0x15')][a15_0x3b98('0x14')]['nit']+stationSettings_1[a15_0x3b98('0x15')]['settings']['plate']+this[a15_0x3b98('0x2')][a15_0x3b98('0x11')]+this[a15_0x3b98('0x2')][a15_0x3b98('0x10')]+this[a15_0x3b98('0x2')][a15_0x3b98('0x18')]+this[a15_0x3b98('0x2')]['hour']+this[a15_0x3b98('0x2')]['minute']+this[a15_0x3b98('0x2')]['second'];const _0xa6f370=stationSettings_1['StationContext'][a15_0x3b98('0x14')]['eventFileFolder']+_0x2aa5e0;const _0x52bfe2=JSON[a15_0x3b98('0x20')](_0x4718c8);_0xccd510[a15_0x3b98('0x21')](_0xa6f370,_0x52bfe2,_0x89cc69=>{if(_0x89cc69)return console['error'](_0x89cc69);const _0x37faf2=_0xa6f370+a15_0x3b98('0x22');const _0x3861d6=_0x5896cf[a15_0x3b98('0x23')]();const _0x4930fc=_0xccd510[a15_0x3b98('0x24')](_0xa6f370);const _0x258f32=_0xccd510['createWriteStream'](_0x37faf2);_0x4930fc[a15_0x3b98('0x25')](_0x3861d6)[a15_0x3b98('0x25')](_0x258f32)['on'](a15_0x3b98('0x26'),_0x89cc69=>{if(_0x89cc69)return console[a15_0x3b98('0x27')](_0x89cc69);else{if(_0xccd510[a15_0x3b98('0x28')](_0xa6f370)){_0xccd510[a15_0x3b98('0x29')](_0xa6f370,_0x89cc69=>{if(_0x89cc69)throw _0x89cc69;console[a15_0x3b98('0xf')](a15_0x3b98('0x2a')+_0xa6f370);});}console[a15_0x3b98('0xf')](a15_0x3b98('0x2b')+_0x37faf2);return _0x37faf2;}});});}}exports['EventsService']=EventsService;