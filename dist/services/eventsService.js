var a15_0x41e0=['settings','nit','year','hour','second','day','gpsService','locationParts','hdop','latitude','speed','doorStatus','CountingInfo','Out','createFile','zlib','eventFileFolder','stringify','writeFile','error','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','existsSync','successfully\x20deleted\x20','successfully\x20created\x20','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','sensorsService','countingWebSocketService','createEvent','bind','startDateParts','DateUtils','getDateParts','startDate','eventDate','eventDateParts','createJson','log','1-71767930-','month','minute','-00001','driverDocument','StationContext'];(function(_0x278985,_0x5ce33a){var _0x65f227=function(_0xac9d76){while(--_0xac9d76){_0x278985['push'](_0x278985['shift']());}};_0x65f227(++_0x5ce33a);}(a15_0x41e0,0x1df));var a15_0x431d=function(_0x323289,_0x432d29){_0x323289=_0x323289-0x0;var _0x37aea6=a15_0x41e0[_0x323289];return _0x37aea6;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const stationSettings_1=require(a15_0x431d('0x0'));const dateUtils_1=require(a15_0x431d('0x1'));const fs=require('fs');const request=require(a15_0x431d('0x2'));class EventsService{constructor(_0x1cb198,_0xfb65ef,_0x2077bb){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x1cb198;this[a15_0x431d('0x3')]=_0xfb65ef;this[a15_0x431d('0x4')]=_0x2077bb;this['gpsService']['createEvent']=this[a15_0x431d('0x5')][a15_0x431d('0x6')](this);this[a15_0x431d('0x3')]['createEvent']=this[a15_0x431d('0x5')][a15_0x431d('0x6')](this);this[a15_0x431d('0x4')][a15_0x431d('0x5')]=this['createEvent'][a15_0x431d('0x6')](this);this['startDate']=new Date();this[a15_0x431d('0x7')]=dateUtils_1[a15_0x431d('0x8')][a15_0x431d('0x9')](this[a15_0x431d('0xa')]);}[a15_0x431d('0x5')](_0x263c94){try{this[a15_0x431d('0xb')]=new Date();this[a15_0x431d('0xc')]=dateUtils_1[a15_0x431d('0x8')][a15_0x431d('0x9')](this['eventDate']);const _0x31e19b=this[a15_0x431d('0xd')](_0x263c94);const _0x16985f=this['createFile'](_0x31e19b);}catch(_0xeba835){console[a15_0x431d('0xe')](_0xeba835);}}[a15_0x431d('0xd')](_0x3fb755){const _0x4593eb={'idViaje':a15_0x431d('0xf')+this[a15_0x431d('0xc')]['year']+this['eventDateParts'][a15_0x431d('0x10')]+this[a15_0x431d('0xc')]['day']+'-'+this[a15_0x431d('0xc')]['hour']+this[a15_0x431d('0xc')][a15_0x431d('0x11')]+this[a15_0x431d('0xc')]['second']+a15_0x431d('0x12'),'cedula':stationSettings_1['StationContext']['settings'][a15_0x431d('0x13')],'codigoRuta':stationSettings_1[a15_0x431d('0x14')]['settings']['routeCode'],'ruta':stationSettings_1[a15_0x431d('0x14')][a15_0x431d('0x15')]['routeName'],'nit':stationSettings_1[a15_0x431d('0x14')]['settings'][a15_0x431d('0x16')],'placa':stationSettings_1['StationContext'][a15_0x431d('0x15')]['plate'],'inicio_viaje':this[a15_0x431d('0xc')]['day']+'/'+this[a15_0x431d('0xc')][a15_0x431d('0x10')]+'/'+this[a15_0x431d('0xc')][a15_0x431d('0x17')]+'\x20'+this[a15_0x431d('0xc')][a15_0x431d('0x18')]+':'+this[a15_0x431d('0xc')][a15_0x431d('0x11')]+':'+this[a15_0x431d('0xc')][a15_0x431d('0x19')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x431d('0xc')][a15_0x431d('0x17')]+this[a15_0x431d('0xc')][a15_0x431d('0x10')]+this[a15_0x431d('0xc')][a15_0x431d('0x1a')],'hora':this[a15_0x431d('0xc')]['hour']+this[a15_0x431d('0xc')][a15_0x431d('0x11')]+this[a15_0x431d('0xc')][a15_0x431d('0x19')],'dop':this[a15_0x431d('0x1b')][a15_0x431d('0x1c')][a15_0x431d('0x1d')],'longitud':this[a15_0x431d('0x1b')][a15_0x431d('0x1c')]['longitude'],'latitud':this[a15_0x431d('0x1b')][a15_0x431d('0x1c')][a15_0x431d('0x1e')],'velocidad':this[a15_0x431d('0x1b')][a15_0x431d('0x1c')][a15_0x431d('0x1f')],'puerta':[{'estado':this[a15_0x431d('0x3')][a15_0x431d('0x20')],'idPuerta':0x0,'ingresos':_0x3fb755!=null?_0x3fb755[a15_0x431d('0x21')][0x0]['In']:0x0,'salidas':_0x3fb755!=null?_0x3fb755[a15_0x431d('0x21')][0x0][a15_0x431d('0x22')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x4593eb;}[a15_0x431d('0x23')](_0x1e3e53){const _0x2d93ed=require('fs');const _0x9b6e96=require(a15_0x431d('0x24'));const _0x1aa827=stationSettings_1['StationContext']['settings']['nit']+stationSettings_1[a15_0x431d('0x14')][a15_0x431d('0x15')]['plate']+this['eventDateParts'][a15_0x431d('0x1a')]+this['eventDateParts']['month']+this[a15_0x431d('0xc')][a15_0x431d('0x17')]+this[a15_0x431d('0xc')][a15_0x431d('0x18')]+this[a15_0x431d('0xc')][a15_0x431d('0x11')]+this['eventDateParts'][a15_0x431d('0x19')];const _0x287817=stationSettings_1['StationContext'][a15_0x431d('0x15')][a15_0x431d('0x25')]+_0x1aa827;const _0x36881f=JSON[a15_0x431d('0x26')](_0x1e3e53);_0x2d93ed[a15_0x431d('0x27')](_0x287817,_0x36881f,_0x19f0bf=>{if(_0x19f0bf)return console[a15_0x431d('0x28')](_0x19f0bf);const _0x2c9315=_0x287817+a15_0x431d('0x29');const _0x5ab6a0=_0x9b6e96[a15_0x431d('0x2a')]();const _0x2560e4=_0x2d93ed[a15_0x431d('0x2b')](_0x287817);const _0x2559b3=_0x2d93ed[a15_0x431d('0x2c')](_0x2c9315);_0x2560e4[a15_0x431d('0x2d')](_0x5ab6a0)[a15_0x431d('0x2d')](_0x2559b3)['on'](a15_0x431d('0x2e'),_0x19f0bf=>{if(_0x19f0bf)return console[a15_0x431d('0x28')](_0x19f0bf);else{if(_0x2d93ed[a15_0x431d('0x2f')](_0x287817)){_0x2d93ed['unlink'](_0x287817,_0x19f0bf=>{if(_0x19f0bf)throw _0x19f0bf;console[a15_0x431d('0xe')](a15_0x431d('0x30')+_0x287817);});}console[a15_0x431d('0xe')](a15_0x431d('0x31')+_0x2c9315);return _0x2c9315;}});});}}exports['EventsService']=EventsService;