var a15_0x2e44=['writeFile','error','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','existsSync','unlink','EventsService','__esModule','../infrastructure/utils/dateUtils','request','eventDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','startDateParts','DateUtils','getDateParts','eventDate','createJson','createFile','log','1-71767930-','year','month','day','hour','second','-00001','settings','driverDocument','StationContext','routeCode','routeName','nit','minute','locationParts','speed','doorStatus','CountingInfo','zlib','plate','stringify'];(function(_0x4e6a74,_0x2c3644){var _0x35768d=function(_0x47e9a2){while(--_0x47e9a2){_0x4e6a74['push'](_0x4e6a74['shift']());}};_0x35768d(++_0x2c3644);}(a15_0x2e44,0x9e));var a15_0x2ae4=function(_0x136359,_0x56ac8d){_0x136359=_0x136359-0x0;var _0x50d30e=a15_0x2e44[_0x136359];return _0x50d30e;};'use strict';Object['defineProperty'](exports,a15_0x2ae4('0x0'),{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require(a15_0x2ae4('0x1'));const fs=require('fs');const request=require(a15_0x2ae4('0x2'));class EventsService{constructor(_0x316900,_0x20f125,_0x2ff089){this[a15_0x2ae4('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x2ae4('0x4')]=_0x316900;this[a15_0x2ae4('0x5')]=_0x20f125;this[a15_0x2ae4('0x6')]=_0x2ff089;this[a15_0x2ae4('0x4')][a15_0x2ae4('0x7')]=this[a15_0x2ae4('0x7')]['bind'](this);this[a15_0x2ae4('0x5')]['createEvent']=this[a15_0x2ae4('0x7')][a15_0x2ae4('0x8')](this);this[a15_0x2ae4('0x6')][a15_0x2ae4('0x7')]=this[a15_0x2ae4('0x7')][a15_0x2ae4('0x8')](this);this[a15_0x2ae4('0x9')]=new Date();this[a15_0x2ae4('0xa')]=dateUtils_1[a15_0x2ae4('0xb')][a15_0x2ae4('0xc')](this[a15_0x2ae4('0x9')]);}[a15_0x2ae4('0x7')](_0x92e892){try{this[a15_0x2ae4('0xd')]=new Date();this[a15_0x2ae4('0x3')]=dateUtils_1[a15_0x2ae4('0xb')][a15_0x2ae4('0xc')](this['eventDate']);const _0x3b0748=this[a15_0x2ae4('0xe')](_0x92e892);const _0x4cd0b8=this[a15_0x2ae4('0xf')](_0x3b0748);}catch(_0x5ac140){console[a15_0x2ae4('0x10')](_0x5ac140);}}['createJson'](_0x473248){const _0x44bf88={'idViaje':a15_0x2ae4('0x11')+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x12')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x13')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x14')]+'-'+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x15')]+this[a15_0x2ae4('0x3')]['minute']+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x16')]+a15_0x2ae4('0x17'),'cedula':stationSettings_1['StationContext'][a15_0x2ae4('0x18')][a15_0x2ae4('0x19')],'codigoRuta':stationSettings_1[a15_0x2ae4('0x1a')][a15_0x2ae4('0x18')][a15_0x2ae4('0x1b')],'ruta':stationSettings_1[a15_0x2ae4('0x1a')][a15_0x2ae4('0x18')][a15_0x2ae4('0x1c')],'nit':stationSettings_1['StationContext'][a15_0x2ae4('0x18')][a15_0x2ae4('0x1d')],'placa':stationSettings_1[a15_0x2ae4('0x1a')][a15_0x2ae4('0x18')]['plate'],'inicio_viaje':this[a15_0x2ae4('0x3')]['day']+'/'+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x13')]+'/'+this['eventDateParts']['year']+'\x20'+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x15')]+':'+this[a15_0x2ae4('0x3')]['minute']+':'+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x2ae4('0x3')][a15_0x2ae4('0x12')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x13')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x14')],'hora':this[a15_0x2ae4('0x3')][a15_0x2ae4('0x15')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x1e')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x16')],'dop':this[a15_0x2ae4('0x4')][a15_0x2ae4('0x1f')]['hdop'],'longitud':this[a15_0x2ae4('0x4')][a15_0x2ae4('0x1f')]['longitude'],'latitud':this['gpsService'][a15_0x2ae4('0x1f')]['latitude'],'velocidad':this['gpsService'][a15_0x2ae4('0x1f')][a15_0x2ae4('0x20')],'puerta':[{'estado':this[a15_0x2ae4('0x5')][a15_0x2ae4('0x21')],'idPuerta':0x0,'ingresos':_0x473248!=null?_0x473248[a15_0x2ae4('0x22')][0x0]['In']:0x0,'salidas':_0x473248!=null?_0x473248['CountingInfo'][0x0]['Out']:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x44bf88;}[a15_0x2ae4('0xf')](_0x4275f9){const _0x9a0ab3=require('fs');const _0x3a786f=require(a15_0x2ae4('0x23'));const _0x4968b0=stationSettings_1['StationContext'][a15_0x2ae4('0x18')][a15_0x2ae4('0x1d')]+stationSettings_1['StationContext'][a15_0x2ae4('0x18')][a15_0x2ae4('0x24')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x14')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x13')]+this[a15_0x2ae4('0x3')]['year']+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x15')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x1e')]+this[a15_0x2ae4('0x3')][a15_0x2ae4('0x16')];const _0x443f17=stationSettings_1[a15_0x2ae4('0x1a')][a15_0x2ae4('0x18')]['eventFileFolder']+_0x4968b0;const _0x5ba7c1=JSON[a15_0x2ae4('0x25')](_0x4275f9);_0x9a0ab3[a15_0x2ae4('0x26')](_0x443f17,_0x5ba7c1,_0x263900=>{if(_0x263900)return console[a15_0x2ae4('0x27')](_0x263900);const _0x2a8665=_0x443f17+a15_0x2ae4('0x28');const _0x1fc174=_0x3a786f[a15_0x2ae4('0x29')]();const _0x3bd3b0=_0x9a0ab3[a15_0x2ae4('0x2a')](_0x443f17);const _0x3ad6a7=_0x9a0ab3[a15_0x2ae4('0x2b')](_0x2a8665);_0x3bd3b0[a15_0x2ae4('0x2c')](_0x1fc174)[a15_0x2ae4('0x2c')](_0x3ad6a7)['on'](a15_0x2ae4('0x2d'),_0x263900=>{if(_0x263900)return console[a15_0x2ae4('0x27')](_0x263900);else{if(_0x9a0ab3[a15_0x2ae4('0x2e')](_0x443f17)){_0x9a0ab3[a15_0x2ae4('0x2f')](_0x443f17,_0x263900=>{if(_0x263900)throw _0x263900;console[a15_0x2ae4('0x10')]('successfully\x20deleted\x20'+_0x443f17);});}console['log']('successfully\x20created\x20'+_0x2a8665);return _0x2a8665;}});});}}exports[a15_0x2ae4('0x30')]=EventsService;