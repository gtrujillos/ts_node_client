var a15_0x28c6=['eventFileFolder','stringify','writeFile','error','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','existsSync','unlink','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','gpsService','sensorsService','createEvent','bind','getDateParts','startDate','eventDate','DateUtils','createFile','log','createJson','month','day','hour','minute','second','-00001','StationContext','driverDocument','settings','routeCode','routeName','nit','plate','year','locationParts','hdop','longitude','latitude','speed','CountingInfo','Out','zlib'];(function(_0x16177c,_0x4ae892){var _0x63ede4=function(_0x2c28dd){while(--_0x2c28dd){_0x16177c['push'](_0x16177c['shift']());}};_0x63ede4(++_0x4ae892);}(a15_0x28c6,0x180));var a15_0x1375=function(_0x5aeebd,_0x7ecd2a){_0x5aeebd=_0x5aeebd-0x0;var _0x118d1e=a15_0x28c6[_0x5aeebd];return _0x118d1e;};'use strict';Object[a15_0x1375('0x0')](exports,a15_0x1375('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x1375('0x2'));const dateUtils_1=require(a15_0x1375('0x3'));const fs=require('fs');const request=require(a15_0x1375('0x4'));class EventsService{constructor(_0xa7d0d8,_0x128a63,_0x2b7734){this[a15_0x1375('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1375('0x6')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1375('0x7')]=_0xa7d0d8;this[a15_0x1375('0x8')]=_0x128a63;this['countingWebSocketService']=_0x2b7734;this['gpsService'][a15_0x1375('0x9')]=this[a15_0x1375('0x9')][a15_0x1375('0xa')](this);this['sensorsService']['createEvent']=this[a15_0x1375('0x9')][a15_0x1375('0xa')](this);this['countingWebSocketService'][a15_0x1375('0x9')]=this[a15_0x1375('0x9')][a15_0x1375('0xa')](this);this['startDate']=new Date();this[a15_0x1375('0x6')]=dateUtils_1['DateUtils'][a15_0x1375('0xb')](this[a15_0x1375('0xc')]);}[a15_0x1375('0x9')](_0x1102b6){try{this[a15_0x1375('0xd')]=new Date();this['eventDateParts']=dateUtils_1[a15_0x1375('0xe')]['getDateParts'](this['eventDate']);const _0x2de74f=this['createJson'](_0x1102b6);const _0x1b3ef4=this[a15_0x1375('0xf')](_0x2de74f);}catch(_0x457c24){console[a15_0x1375('0x10')](_0x457c24);}}[a15_0x1375('0x11')](_0xd92a70){const _0x3bc884={'idViaje':'1-71767930-'+this[a15_0x1375('0x5')]['year']+this[a15_0x1375('0x5')][a15_0x1375('0x12')]+this[a15_0x1375('0x5')][a15_0x1375('0x13')]+'-'+this[a15_0x1375('0x5')][a15_0x1375('0x14')]+this[a15_0x1375('0x5')][a15_0x1375('0x15')]+this[a15_0x1375('0x5')][a15_0x1375('0x16')]+a15_0x1375('0x17'),'cedula':stationSettings_1[a15_0x1375('0x18')]['settings'][a15_0x1375('0x19')],'codigoRuta':stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')][a15_0x1375('0x1b')],'ruta':stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')][a15_0x1375('0x1c')],'nit':stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')][a15_0x1375('0x1d')],'placa':stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')][a15_0x1375('0x1e')],'inicio_viaje':this[a15_0x1375('0x5')][a15_0x1375('0x13')]+'/'+this[a15_0x1375('0x5')][a15_0x1375('0x12')]+'/'+this[a15_0x1375('0x5')][a15_0x1375('0x1f')]+'\x20'+this[a15_0x1375('0x5')][a15_0x1375('0x14')]+':'+this[a15_0x1375('0x5')][a15_0x1375('0x15')]+':'+this['eventDateParts'][a15_0x1375('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x1375('0x5')][a15_0x1375('0x1f')]+this[a15_0x1375('0x5')][a15_0x1375('0x12')]+this[a15_0x1375('0x5')][a15_0x1375('0x13')],'hora':this[a15_0x1375('0x5')][a15_0x1375('0x14')]+this['eventDateParts'][a15_0x1375('0x15')]+this['eventDateParts']['second'],'dop':this[a15_0x1375('0x7')][a15_0x1375('0x20')][a15_0x1375('0x21')],'longitud':this[a15_0x1375('0x7')]['locationParts'][a15_0x1375('0x22')],'latitud':this[a15_0x1375('0x7')]['locationParts'][a15_0x1375('0x23')],'velocidad':this['gpsService'][a15_0x1375('0x20')][a15_0x1375('0x24')],'puerta':[{'estado':this[a15_0x1375('0x8')]['doorStatus'],'idPuerta':0x0,'ingresos':_0xd92a70!=null?_0xd92a70[a15_0x1375('0x25')][0x0]['In']:0x0,'salidas':_0xd92a70!=null?_0xd92a70['CountingInfo'][0x0][a15_0x1375('0x26')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x3bc884;}[a15_0x1375('0xf')](_0x1bb403){const _0xa71c61=require('fs');const _0x282493=require(a15_0x1375('0x27'));const _0x22f811=stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')]['nit']+stationSettings_1[a15_0x1375('0x18')]['settings']['plate']+this[a15_0x1375('0x5')][a15_0x1375('0x13')]+this[a15_0x1375('0x5')]['month']+this[a15_0x1375('0x5')][a15_0x1375('0x1f')]+this[a15_0x1375('0x5')][a15_0x1375('0x14')]+this[a15_0x1375('0x5')][a15_0x1375('0x15')]+this[a15_0x1375('0x5')][a15_0x1375('0x16')];const _0x2379cd=stationSettings_1[a15_0x1375('0x18')][a15_0x1375('0x1a')][a15_0x1375('0x28')]+_0x22f811;const _0x251d33=JSON[a15_0x1375('0x29')](_0x1bb403);_0xa71c61[a15_0x1375('0x2a')](_0x2379cd,_0x251d33,_0x487794=>{if(_0x487794)return console[a15_0x1375('0x2b')](_0x487794);const _0x554874=_0x2379cd+a15_0x1375('0x2c');const _0x4d04f2=_0x282493[a15_0x1375('0x2d')]();const _0x1ce909=_0xa71c61[a15_0x1375('0x2e')](_0x2379cd);const _0x2e90dc=_0xa71c61[a15_0x1375('0x2f')](_0x554874);_0x1ce909['pipe'](_0x4d04f2)[a15_0x1375('0x30')](_0x2e90dc)['on'](a15_0x1375('0x31'),_0x487794=>{if(_0x487794)return console[a15_0x1375('0x2b')](_0x487794);else{if(_0xa71c61[a15_0x1375('0x32')](_0x2379cd)){_0xa71c61[a15_0x1375('0x33')](_0x2379cd,_0x487794=>{if(_0x487794)throw _0x487794;console[a15_0x1375('0x10')]('successfully\x20deleted\x20'+_0x2379cd);});}console[a15_0x1375('0x10')]('successfully\x20created\x20'+_0x554874);return _0x554874;}});});}}exports[a15_0x1375('0x34')]=EventsService;