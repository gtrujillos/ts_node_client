var a15_0x5855=['createJson','createFile','log','year','month','day','minute','second','-00001','StationContext','settings','routeCode','nit','plate','hour','hdop','locationParts','longitude','latitude','speed','doorStatus','CountingInfo','Out','zlib','eventFileFolder','stringify','writeFile','error','createGzip','pipe','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','startDateParts','gpsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','getDateParts','eventDate','eventDateParts'];(function(_0x280e60,_0x2ccd99){var _0x17f4c1=function(_0x193bdc){while(--_0x193bdc){_0x280e60['push'](_0x280e60['shift']());}};_0x17f4c1(++_0x2ccd99);}(a15_0x5855,0x87));var a15_0xe280=function(_0x53dfcc,_0xdc0e11){_0x53dfcc=_0x53dfcc-0x0;var _0x25d11c=a15_0x5855[_0x53dfcc];return _0x25d11c;};'use strict';Object[a15_0xe280('0x0')](exports,a15_0xe280('0x1'),{'value':!![]});const stationSettings_1=require(a15_0xe280('0x2'));const dateUtils_1=require(a15_0xe280('0x3'));const fs=require('fs');const request=require(a15_0xe280('0x4'));class EventsService{constructor(_0x5d5747,_0x255ed1,_0x3ae58f){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0xe280('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0xe280('0x6')]=_0x5d5747;this['sensorsService']=_0x255ed1;this[a15_0xe280('0x7')]=_0x3ae58f;this['gpsService'][a15_0xe280('0x8')]=this[a15_0xe280('0x8')][a15_0xe280('0x9')](this);this['sensorsService'][a15_0xe280('0x8')]=this[a15_0xe280('0x8')]['bind'](this);this[a15_0xe280('0x7')][a15_0xe280('0x8')]=this[a15_0xe280('0x8')][a15_0xe280('0x9')](this);this[a15_0xe280('0xa')]=new Date();this[a15_0xe280('0x5')]=dateUtils_1[a15_0xe280('0xb')][a15_0xe280('0xc')](this['startDate']);}[a15_0xe280('0x8')](_0x14e3d7){try{this[a15_0xe280('0xd')]=new Date();this[a15_0xe280('0xe')]=dateUtils_1['DateUtils'][a15_0xe280('0xc')](this[a15_0xe280('0xd')]);const _0x26d3d0=this[a15_0xe280('0xf')](_0x14e3d7);const _0x163723=this[a15_0xe280('0x10')](_0x26d3d0);}catch(_0x3d4407){console[a15_0xe280('0x11')](_0x3d4407);}}[a15_0xe280('0xf')](_0x56f554){const _0x2d5415={'idViaje':'1-71767930-'+this[a15_0xe280('0xe')][a15_0xe280('0x12')]+this[a15_0xe280('0xe')][a15_0xe280('0x13')]+this[a15_0xe280('0xe')][a15_0xe280('0x14')]+'-'+this[a15_0xe280('0xe')]['hour']+this[a15_0xe280('0xe')][a15_0xe280('0x15')]+this[a15_0xe280('0xe')][a15_0xe280('0x16')]+a15_0xe280('0x17'),'cedula':stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')]['driverDocument'],'codigoRuta':stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')][a15_0xe280('0x1a')],'ruta':stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')]['routeName'],'nit':stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')][a15_0xe280('0x1b')],'placa':stationSettings_1['StationContext']['settings'][a15_0xe280('0x1c')],'inicio_viaje':this['eventDateParts']['day']+'/'+this[a15_0xe280('0xe')][a15_0xe280('0x13')]+'/'+this[a15_0xe280('0xe')][a15_0xe280('0x12')]+'\x20'+this['eventDateParts'][a15_0xe280('0x1d')]+':'+this[a15_0xe280('0xe')][a15_0xe280('0x15')]+':'+this['eventDateParts'][a15_0xe280('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts'][a15_0xe280('0x12')]+this[a15_0xe280('0xe')][a15_0xe280('0x13')]+this['eventDateParts']['day'],'hora':this[a15_0xe280('0xe')][a15_0xe280('0x1d')]+this[a15_0xe280('0xe')][a15_0xe280('0x15')]+this[a15_0xe280('0xe')][a15_0xe280('0x16')],'dop':this[a15_0xe280('0x6')]['locationParts'][a15_0xe280('0x1e')],'longitud':this[a15_0xe280('0x6')][a15_0xe280('0x1f')][a15_0xe280('0x20')],'latitud':this['gpsService'][a15_0xe280('0x1f')][a15_0xe280('0x21')],'velocidad':this[a15_0xe280('0x6')]['locationParts'][a15_0xe280('0x22')],'puerta':[{'estado':this['sensorsService'][a15_0xe280('0x23')],'idPuerta':0x0,'ingresos':_0x56f554!=null?_0x56f554[a15_0xe280('0x24')][0x0]['In']:0x0,'salidas':_0x56f554!=null?_0x56f554['CountingInfo'][0x0][a15_0xe280('0x25')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x2d5415;}['createFile'](_0x3aa547){const _0x42ea3a=require('fs');const _0x1bf85e=require(a15_0xe280('0x26'));const _0x5d1fc9=stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')][a15_0xe280('0x1b')]+stationSettings_1['StationContext'][a15_0xe280('0x19')][a15_0xe280('0x1c')]+this[a15_0xe280('0xe')][a15_0xe280('0x14')]+this[a15_0xe280('0xe')]['month']+this['eventDateParts']['year']+this['eventDateParts'][a15_0xe280('0x1d')]+this[a15_0xe280('0xe')][a15_0xe280('0x15')]+this[a15_0xe280('0xe')]['second'];const _0x282f5c=stationSettings_1[a15_0xe280('0x18')][a15_0xe280('0x19')][a15_0xe280('0x27')]+_0x5d1fc9;const _0x48d07e=JSON[a15_0xe280('0x28')](_0x3aa547);_0x42ea3a[a15_0xe280('0x29')](_0x282f5c,_0x48d07e,_0x830fb8=>{if(_0x830fb8)return console[a15_0xe280('0x2a')](_0x830fb8);const _0x196cb7=_0x282f5c+'.gz';const _0x29a79c=_0x1bf85e[a15_0xe280('0x2b')]();const _0x2fa4b5=_0x42ea3a['createReadStream'](_0x282f5c);const _0x251a7b=_0x42ea3a['createWriteStream'](_0x196cb7);_0x2fa4b5[a15_0xe280('0x2c')](_0x29a79c)[a15_0xe280('0x2c')](_0x251a7b)['on']('finish',_0x830fb8=>{if(_0x830fb8)return console[a15_0xe280('0x2a')](_0x830fb8);else{if(_0x42ea3a[a15_0xe280('0x2d')](_0x282f5c)){_0x42ea3a[a15_0xe280('0x2e')](_0x282f5c,_0x830fb8=>{if(_0x830fb8)throw _0x830fb8;console[a15_0xe280('0x11')](a15_0xe280('0x2f')+_0x282f5c);});}console[a15_0xe280('0x11')](a15_0xe280('0x30')+_0x196cb7);return _0x196cb7;}});});}}exports[a15_0xe280('0x31')]=EventsService;