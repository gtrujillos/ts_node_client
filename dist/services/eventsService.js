var a14_0x9cbe=['pipe','finish','existsSync','unlink','successfully\x20deleted\x20','log','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','startDateParts','gpsService','countingWebSocketService','createEvent','bind','startDate','getDateParts','eventDateParts','DateUtils','eventDate','createJson','1-71767930-','year','day','minute','second','-00001','StationContext','driverDocument','settings','routeCode','nit','month','locationParts','hdop','longitude','speed','sensorsService','CountingInfo','zlib','plate','eventFileFolder','stringify','writeFile','error','.gz','createReadStream','createWriteStream'];(function(_0xc8a0ae,_0x41cf45){var _0x58849d=function(_0x373af9){while(--_0x373af9){_0xc8a0ae['push'](_0xc8a0ae['shift']());}};_0x58849d(++_0x41cf45);}(a14_0x9cbe,0x16d));var a14_0x27c8=function(_0xb0a18c,_0x24497e){_0xb0a18c=_0xb0a18c-0x0;var _0x2fa079=a14_0x9cbe[_0xb0a18c];return _0x2fa079;};'use strict';Object[a14_0x27c8('0x0')](exports,a14_0x27c8('0x1'),{'value':!![]});const stationSettings_1=require(a14_0x27c8('0x2'));const dateUtils_1=require(a14_0x27c8('0x3'));const fs=require('fs');const request=require(a14_0x27c8('0x4'));class EventsService{constructor(_0x4260e2,_0x405d12,_0x398829){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x27c8('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x27c8('0x6')]=_0x4260e2;this['sensorsService']=_0x405d12;this[a14_0x27c8('0x7')]=_0x398829;this[a14_0x27c8('0x6')][a14_0x27c8('0x8')]=this[a14_0x27c8('0x8')][a14_0x27c8('0x9')](this);this['sensorsService'][a14_0x27c8('0x8')]=this[a14_0x27c8('0x8')][a14_0x27c8('0x9')](this);this[a14_0x27c8('0x7')][a14_0x27c8('0x8')]=this[a14_0x27c8('0x8')][a14_0x27c8('0x9')](this);this[a14_0x27c8('0xa')]=new Date();this[a14_0x27c8('0x5')]=dateUtils_1['DateUtils'][a14_0x27c8('0xb')](this[a14_0x27c8('0xa')]);}[a14_0x27c8('0x8')](_0x42aa4){try{this['eventDate']=new Date();this[a14_0x27c8('0xc')]=dateUtils_1[a14_0x27c8('0xd')]['getDateParts'](this[a14_0x27c8('0xe')]);const _0xf38837=this[a14_0x27c8('0xf')](_0x42aa4);const _0xf38c20=this['createFile'](_0xf38837);}catch(_0xdbbb18){console['log'](_0xdbbb18);}}['createJson'](_0x53f150){const _0xe26cea={'idViaje':a14_0x27c8('0x10')+this[a14_0x27c8('0xc')][a14_0x27c8('0x11')]+this['eventDateParts']['month']+this[a14_0x27c8('0xc')][a14_0x27c8('0x12')]+'-'+this['eventDateParts']['hour']+this[a14_0x27c8('0xc')][a14_0x27c8('0x13')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x14')]+a14_0x27c8('0x15'),'cedula':stationSettings_1[a14_0x27c8('0x16')]['settings'][a14_0x27c8('0x17')],'codigoRuta':stationSettings_1[a14_0x27c8('0x16')][a14_0x27c8('0x18')][a14_0x27c8('0x19')],'ruta':stationSettings_1[a14_0x27c8('0x16')][a14_0x27c8('0x18')]['routeName'],'nit':stationSettings_1[a14_0x27c8('0x16')][a14_0x27c8('0x18')][a14_0x27c8('0x1a')],'placa':stationSettings_1['StationContext']['settings']['plate'],'inicio_viaje':this[a14_0x27c8('0xc')][a14_0x27c8('0x12')]+'/'+this[a14_0x27c8('0xc')][a14_0x27c8('0x1b')]+'/'+this[a14_0x27c8('0xc')]['year']+'\x20'+this[a14_0x27c8('0xc')]['hour']+':'+this['eventDateParts'][a14_0x27c8('0x13')]+':'+this[a14_0x27c8('0xc')][a14_0x27c8('0x14')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a14_0x27c8('0xc')][a14_0x27c8('0x11')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x1b')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x12')],'hora':this['eventDateParts']['hour']+this[a14_0x27c8('0xc')][a14_0x27c8('0x13')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x14')],'dop':this[a14_0x27c8('0x6')][a14_0x27c8('0x1c')][a14_0x27c8('0x1d')],'longitud':this[a14_0x27c8('0x6')][a14_0x27c8('0x1c')][a14_0x27c8('0x1e')],'latitud':this[a14_0x27c8('0x6')][a14_0x27c8('0x1c')]['latitude'],'velocidad':this[a14_0x27c8('0x6')][a14_0x27c8('0x1c')][a14_0x27c8('0x1f')],'puerta':[{'estado':this[a14_0x27c8('0x20')]['doorStatus'],'idPuerta':0x0,'ingresos':_0x53f150!=null?_0x53f150[a14_0x27c8('0x21')][0x0]['In']:0x0,'salidas':_0x53f150!=null?_0x53f150['CountingInfo'][0x0]['Out']:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0xe26cea;}['createFile'](_0x29501a){const _0x55ea91=require('fs');const _0x28df42=require(a14_0x27c8('0x22'));const _0x5849fd=stationSettings_1['StationContext'][a14_0x27c8('0x18')]['nit']+stationSettings_1['StationContext']['settings'][a14_0x27c8('0x23')]+this[a14_0x27c8('0xc')]['day']+this[a14_0x27c8('0xc')][a14_0x27c8('0x1b')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x11')]+this[a14_0x27c8('0xc')]['hour']+this[a14_0x27c8('0xc')][a14_0x27c8('0x13')]+this[a14_0x27c8('0xc')][a14_0x27c8('0x14')];const _0x1802d6=stationSettings_1['StationContext'][a14_0x27c8('0x18')][a14_0x27c8('0x24')]+_0x5849fd;const _0x599bb9=JSON[a14_0x27c8('0x25')](_0x29501a);_0x55ea91[a14_0x27c8('0x26')](_0x1802d6,_0x599bb9,_0x1636fd=>{if(_0x1636fd)return console[a14_0x27c8('0x27')](_0x1636fd);const _0x2a7da2=_0x1802d6+a14_0x27c8('0x28');const _0x5ce6ec=_0x28df42['createGzip']();const _0x470ad6=_0x55ea91[a14_0x27c8('0x29')](_0x1802d6);const _0x4f92b7=_0x55ea91[a14_0x27c8('0x2a')](_0x2a7da2);_0x470ad6[a14_0x27c8('0x2b')](_0x5ce6ec)[a14_0x27c8('0x2b')](_0x4f92b7)['on'](a14_0x27c8('0x2c'),_0x1636fd=>{if(_0x1636fd)return console[a14_0x27c8('0x27')](_0x1636fd);else{if(_0x55ea91[a14_0x27c8('0x2d')](_0x1802d6)){_0x55ea91[a14_0x27c8('0x2e')](_0x1802d6,_0x1636fd=>{if(_0x1636fd)throw _0x1636fd;console['log'](a14_0x27c8('0x2f')+_0x1802d6);});}console[a14_0x27c8('0x30')](a14_0x27c8('0x31')+_0x2a7da2);return _0x2a7da2;}});});}}exports[a14_0x27c8('0x32')]=EventsService;