var a15_0x5343=['createEvent','bind','DateUtils','getDateParts','eventDate','log','createJson','1-71767930-','year','day','hour','minute','second','-00001','StationContext','driverDocument','settings','nit','plate','month','gpsService','locationParts','speed','doorStatus','CountingInfo','Out','createFile','zlib','stringify','writeFile','error','.gz','createReadStream','createWriteStream','pipe','existsSync','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','request','eventDateParts','startDateParts','sensorsService','countingWebSocketService'];(function(_0x2bda25,_0x57438a){var _0x442321=function(_0x5acc16){while(--_0x5acc16){_0x2bda25['push'](_0x2bda25['shift']());}};_0x442321(++_0x57438a);}(a15_0x5343,0x112));var a15_0x3c0c=function(_0x164623,_0x2936db){_0x164623=_0x164623-0x0;var _0x769810=a15_0x5343[_0x164623];return _0x769810;};'use strict';Object[a15_0x3c0c('0x0')](exports,a15_0x3c0c('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x3c0c('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require(a15_0x3c0c('0x3'));class EventsService{constructor(_0x58db47,_0x45dd1d,_0x2a14b4){this[a15_0x3c0c('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3c0c('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x58db47;this[a15_0x3c0c('0x6')]=_0x45dd1d;this[a15_0x3c0c('0x7')]=_0x2a14b4;this['gpsService'][a15_0x3c0c('0x8')]=this[a15_0x3c0c('0x8')][a15_0x3c0c('0x9')](this);this[a15_0x3c0c('0x6')][a15_0x3c0c('0x8')]=this[a15_0x3c0c('0x8')][a15_0x3c0c('0x9')](this);this['countingWebSocketService'][a15_0x3c0c('0x8')]=this[a15_0x3c0c('0x8')][a15_0x3c0c('0x9')](this);this['startDate']=new Date();this['startDateParts']=dateUtils_1[a15_0x3c0c('0xa')][a15_0x3c0c('0xb')](this['startDate']);}[a15_0x3c0c('0x8')](_0x1d1e5a){try{this[a15_0x3c0c('0xc')]=new Date();this[a15_0x3c0c('0x4')]=dateUtils_1['DateUtils']['getDateParts'](this['eventDate']);const _0x3aae83=this['createJson'](_0x1d1e5a);const _0x3360b2=this['createFile'](_0x3aae83);}catch(_0x5bf556){console[a15_0x3c0c('0xd')](_0x5bf556);}}[a15_0x3c0c('0xe')](_0x41e073){const _0xc379e1={'idViaje':a15_0x3c0c('0xf')+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x10')]+this[a15_0x3c0c('0x4')]['month']+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x11')]+'-'+this['eventDateParts'][a15_0x3c0c('0x12')]+this['eventDateParts'][a15_0x3c0c('0x13')]+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x14')]+a15_0x3c0c('0x15'),'cedula':stationSettings_1[a15_0x3c0c('0x16')]['settings'][a15_0x3c0c('0x17')],'codigoRuta':stationSettings_1[a15_0x3c0c('0x16')][a15_0x3c0c('0x18')]['routeCode'],'ruta':stationSettings_1['StationContext'][a15_0x3c0c('0x18')]['routeName'],'nit':stationSettings_1[a15_0x3c0c('0x16')]['settings'][a15_0x3c0c('0x19')],'placa':stationSettings_1[a15_0x3c0c('0x16')][a15_0x3c0c('0x18')][a15_0x3c0c('0x1a')],'inicio_viaje':this['eventDateParts'][a15_0x3c0c('0x11')]+'/'+this[a15_0x3c0c('0x4')]['month']+'/'+this[a15_0x3c0c('0x4')]['year']+'\x20'+this['eventDateParts'][a15_0x3c0c('0x12')]+':'+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x13')]+':'+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x14')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x3c0c('0x4')][a15_0x3c0c('0x10')]+this['eventDateParts'][a15_0x3c0c('0x1b')]+this['eventDateParts'][a15_0x3c0c('0x11')],'hora':this['eventDateParts'][a15_0x3c0c('0x12')]+this['eventDateParts'][a15_0x3c0c('0x13')]+this['eventDateParts'][a15_0x3c0c('0x14')],'dop':this[a15_0x3c0c('0x1c')][a15_0x3c0c('0x1d')]['hdop'],'longitud':this[a15_0x3c0c('0x1c')][a15_0x3c0c('0x1d')]['longitude'],'latitud':this[a15_0x3c0c('0x1c')][a15_0x3c0c('0x1d')]['latitude'],'velocidad':this['gpsService']['locationParts'][a15_0x3c0c('0x1e')],'puerta':[{'estado':this[a15_0x3c0c('0x6')][a15_0x3c0c('0x1f')],'idPuerta':0x0,'ingresos':_0x41e073!=null?_0x41e073[a15_0x3c0c('0x20')][0x0]['In']:0x0,'salidas':_0x41e073!=null?_0x41e073[a15_0x3c0c('0x20')][0x0][a15_0x3c0c('0x21')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0xc379e1;}[a15_0x3c0c('0x22')](_0x152835){const _0x5c1c82=require('fs');const _0x3e825f=require(a15_0x3c0c('0x23'));const _0x423b16=stationSettings_1[a15_0x3c0c('0x16')][a15_0x3c0c('0x18')][a15_0x3c0c('0x19')]+stationSettings_1[a15_0x3c0c('0x16')][a15_0x3c0c('0x18')][a15_0x3c0c('0x1a')]+this[a15_0x3c0c('0x4')]['day']+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x1b')]+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x10')]+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x12')]+this['eventDateParts']['minute']+this[a15_0x3c0c('0x4')][a15_0x3c0c('0x14')];const _0x11e137=stationSettings_1[a15_0x3c0c('0x16')][a15_0x3c0c('0x18')]['eventFileFolder']+_0x423b16;const _0x1a954c=JSON[a15_0x3c0c('0x24')](_0x152835);_0x5c1c82[a15_0x3c0c('0x25')](_0x11e137,_0x1a954c,_0x20eb6d=>{if(_0x20eb6d)return console[a15_0x3c0c('0x26')](_0x20eb6d);const _0x167aa0=_0x11e137+a15_0x3c0c('0x27');const _0x389237=_0x3e825f['createGzip']();const _0x1c458b=_0x5c1c82[a15_0x3c0c('0x28')](_0x11e137);const _0x2bcfc0=_0x5c1c82[a15_0x3c0c('0x29')](_0x167aa0);_0x1c458b[a15_0x3c0c('0x2a')](_0x389237)[a15_0x3c0c('0x2a')](_0x2bcfc0)['on']('finish',_0x20eb6d=>{if(_0x20eb6d)return console[a15_0x3c0c('0x26')](_0x20eb6d);else{if(_0x5c1c82[a15_0x3c0c('0x2b')](_0x11e137)){_0x5c1c82['unlink'](_0x11e137,_0x20eb6d=>{if(_0x20eb6d)throw _0x20eb6d;console[a15_0x3c0c('0xd')](a15_0x3c0c('0x2c')+_0x11e137);});}console[a15_0x3c0c('0xd')](a15_0x3c0c('0x2d')+_0x167aa0);return _0x167aa0;}});});}}exports[a15_0x3c0c('0x2e')]=EventsService;