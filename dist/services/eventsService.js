var a17_0x1e35=['month','day','hour','minute','-00001','settings','driverDocument','StationContext','routeCode','year','second','hdop','locationParts','longitude','latitude','doorStatus','CountingInfo','zlib','plate','eventFileFolder','stringify','error','createGzip','createReadStream','createWriteStream','pipe','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','log','init\x20EventsService','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','getDateParts','eventDate','createJson','1-71767930-'];(function(_0x434ce6,_0xbcc853){var _0x2893e4=function(_0x5c7106){while(--_0x5c7106){_0x434ce6['push'](_0x434ce6['shift']());}};_0x2893e4(++_0xbcc853);}(a17_0x1e35,0x1e1));var a17_0x5a05=function(_0x29515e,_0x2d1a49){_0x29515e=_0x29515e-0x0;var _0xbc900d=a17_0x1e35[_0x29515e];return _0xbc900d;};'use strict';Object[a17_0x5a05('0x0')](exports,a17_0x5a05('0x1'),{'value':!![]});const stationSettings_1=require(a17_0x5a05('0x2'));const dateUtils_1=require(a17_0x5a05('0x3'));const fs=require('fs');const request=require(a17_0x5a05('0x4'));class EventsService{constructor(_0x2048b2,_0x39f824,_0x23f64f){this[a17_0x5a05('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};console[a17_0x5a05('0x6')](a17_0x5a05('0x7'));this[a17_0x5a05('0x8')]=_0x2048b2;this[a17_0x5a05('0x9')]=_0x39f824;this[a17_0x5a05('0xa')]=_0x23f64f;this[a17_0x5a05('0x8')]['createEvent']=this[a17_0x5a05('0xb')][a17_0x5a05('0xc')](this);this[a17_0x5a05('0x9')][a17_0x5a05('0xb')]=this['createEvent'][a17_0x5a05('0xc')](this);this[a17_0x5a05('0xa')][a17_0x5a05('0xb')]=this[a17_0x5a05('0xb')][a17_0x5a05('0xc')](this);this[a17_0x5a05('0xd')]=new Date();this['startDateParts']=dateUtils_1[a17_0x5a05('0xe')][a17_0x5a05('0xf')](this['startDate']);}[a17_0x5a05('0xb')](_0x3116fb){try{this[a17_0x5a05('0x10')]=new Date();this[a17_0x5a05('0x5')]=dateUtils_1[a17_0x5a05('0xe')][a17_0x5a05('0xf')](this[a17_0x5a05('0x10')]);const _0x524f7b=this[a17_0x5a05('0x11')](_0x3116fb);const _0x41c652=this['createFile'](_0x524f7b);}catch(_0xb0c872){console[a17_0x5a05('0x6')](_0xb0c872);}}[a17_0x5a05('0x11')](_0x385f00){const _0x281576={'idViaje':a17_0x5a05('0x12')+this[a17_0x5a05('0x5')]['year']+this['eventDateParts'][a17_0x5a05('0x13')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x14')]+'-'+this[a17_0x5a05('0x5')][a17_0x5a05('0x15')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x16')]+this[a17_0x5a05('0x5')]['second']+a17_0x5a05('0x17'),'cedula':stationSettings_1['StationContext'][a17_0x5a05('0x18')][a17_0x5a05('0x19')],'codigoRuta':stationSettings_1[a17_0x5a05('0x1a')][a17_0x5a05('0x18')][a17_0x5a05('0x1b')],'ruta':stationSettings_1[a17_0x5a05('0x1a')]['settings']['routeName'],'nit':stationSettings_1[a17_0x5a05('0x1a')]['settings']['nit'],'placa':stationSettings_1[a17_0x5a05('0x1a')][a17_0x5a05('0x18')]['plate'],'inicio_viaje':this[a17_0x5a05('0x5')]['day']+'/'+this['eventDateParts'][a17_0x5a05('0x13')]+'/'+this[a17_0x5a05('0x5')][a17_0x5a05('0x1c')]+'\x20'+this[a17_0x5a05('0x5')][a17_0x5a05('0x15')]+':'+this[a17_0x5a05('0x5')]['minute']+':'+this[a17_0x5a05('0x5')][a17_0x5a05('0x1d')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a17_0x5a05('0x5')][a17_0x5a05('0x1c')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x13')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x14')],'hora':this['eventDateParts'][a17_0x5a05('0x15')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x16')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x1d')],'dop':this[a17_0x5a05('0x8')]['locationParts'][a17_0x5a05('0x1e')],'longitud':this['gpsService'][a17_0x5a05('0x1f')][a17_0x5a05('0x20')],'latitud':this[a17_0x5a05('0x8')][a17_0x5a05('0x1f')][a17_0x5a05('0x21')],'velocidad':this['gpsService'][a17_0x5a05('0x1f')]['speed'],'puerta':[{'estado':this[a17_0x5a05('0x9')][a17_0x5a05('0x22')],'idPuerta':0x0,'ingresos':_0x385f00!=null?_0x385f00[a17_0x5a05('0x23')][0x0]['In']:0x0,'salidas':_0x385f00!=null?_0x385f00['CountingInfo'][0x0]['Out']:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x281576;}['createFile'](_0x3573be){const _0xe6b0b3=require('fs');const _0x327a81=require(a17_0x5a05('0x24'));const _0x2e3493=stationSettings_1[a17_0x5a05('0x1a')]['settings']['nit']+stationSettings_1[a17_0x5a05('0x1a')]['settings'][a17_0x5a05('0x25')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x14')]+this[a17_0x5a05('0x5')][a17_0x5a05('0x13')]+this['eventDateParts'][a17_0x5a05('0x1c')]+this[a17_0x5a05('0x5')]['hour']+this['eventDateParts']['minute']+this[a17_0x5a05('0x5')][a17_0x5a05('0x1d')];const _0x4a176f=stationSettings_1[a17_0x5a05('0x1a')]['settings'][a17_0x5a05('0x26')]+_0x2e3493;const _0x1cb058=JSON[a17_0x5a05('0x27')](_0x3573be);_0xe6b0b3['writeFile'](_0x4a176f,_0x1cb058,_0x52d76d=>{if(_0x52d76d)return console[a17_0x5a05('0x28')](_0x52d76d);const _0x5e67fe=_0x4a176f+'.gz';const _0x3e99cd=_0x327a81[a17_0x5a05('0x29')]();const _0x5212ff=_0xe6b0b3[a17_0x5a05('0x2a')](_0x4a176f);const _0x1922b4=_0xe6b0b3[a17_0x5a05('0x2b')](_0x5e67fe);_0x5212ff[a17_0x5a05('0x2c')](_0x3e99cd)[a17_0x5a05('0x2c')](_0x1922b4)['on']('finish',_0x52d76d=>{if(_0x52d76d)return console[a17_0x5a05('0x28')](_0x52d76d);else{if(_0xe6b0b3[a17_0x5a05('0x2d')](_0x4a176f)){_0xe6b0b3[a17_0x5a05('0x2e')](_0x4a176f,_0x52d76d=>{if(_0x52d76d)throw _0x52d76d;console[a17_0x5a05('0x6')](a17_0x5a05('0x2f')+_0x4a176f);});}console[a17_0x5a05('0x6')](a17_0x5a05('0x30')+_0x5e67fe);return _0x5e67fe;}});});}}exports[a17_0x5a05('0x31')]=EventsService;