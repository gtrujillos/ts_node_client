var a15_0x4299=['zlib','nit','stringify','writeFile','error','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','existsSync','unlink','successfully\x20created\x20','defineProperty','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDateParts','DateUtils','eventDate','getDateParts','createJson','createFile','log','1-71767930-','year','month','day','hour','second','-00001','settings','driverDocument','StationContext','routeName','plate','minute','locationParts','hdop','longitude','latitude','speed','doorStatus','CountingInfo','Out'];(function(_0xcf63c8,_0x494366){var _0xf7dea2=function(_0x39f39d){while(--_0x39f39d){_0xcf63c8['push'](_0xcf63c8['shift']());}};_0xf7dea2(++_0x494366);}(a15_0x4299,0x146));var a15_0x490c=function(_0x575c9c,_0x569231){_0x575c9c=_0x575c9c-0x0;var _0x545df6=a15_0x4299[_0x575c9c];return _0x545df6;};'use strict';Object[a15_0x490c('0x0')](exports,'__esModule',{'value':!![]});const stationSettings_1=require(a15_0x490c('0x1'));const dateUtils_1=require(a15_0x490c('0x2'));const fs=require('fs');const request=require(a15_0x490c('0x3'));class EventsService{constructor(_0xca5113,_0x430a01,_0x2e8380){this[a15_0x490c('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x490c('0x5')]=_0xca5113;this[a15_0x490c('0x6')]=_0x430a01;this[a15_0x490c('0x7')]=_0x2e8380;this[a15_0x490c('0x5')][a15_0x490c('0x8')]=this['createEvent'][a15_0x490c('0x9')](this);this['sensorsService'][a15_0x490c('0x8')]=this[a15_0x490c('0x8')][a15_0x490c('0x9')](this);this[a15_0x490c('0x7')]['createEvent']=this['createEvent'][a15_0x490c('0x9')](this);this['startDate']=new Date();this[a15_0x490c('0xa')]=dateUtils_1[a15_0x490c('0xb')]['getDateParts'](this['startDate']);}[a15_0x490c('0x8')](_0x32bf51){try{this[a15_0x490c('0xc')]=new Date();this[a15_0x490c('0x4')]=dateUtils_1[a15_0x490c('0xb')][a15_0x490c('0xd')](this[a15_0x490c('0xc')]);const _0x381fab=this[a15_0x490c('0xe')](_0x32bf51);const _0x21d040=this[a15_0x490c('0xf')](_0x381fab);}catch(_0x2361dd){console[a15_0x490c('0x10')](_0x2361dd);}}[a15_0x490c('0xe')](_0x5059f4){const _0x61d5b2={'idViaje':a15_0x490c('0x11')+this[a15_0x490c('0x4')][a15_0x490c('0x12')]+this[a15_0x490c('0x4')][a15_0x490c('0x13')]+this['eventDateParts'][a15_0x490c('0x14')]+'-'+this[a15_0x490c('0x4')][a15_0x490c('0x15')]+this[a15_0x490c('0x4')]['minute']+this['eventDateParts'][a15_0x490c('0x16')]+a15_0x490c('0x17'),'cedula':stationSettings_1['StationContext'][a15_0x490c('0x18')][a15_0x490c('0x19')],'codigoRuta':stationSettings_1[a15_0x490c('0x1a')][a15_0x490c('0x18')]['routeCode'],'ruta':stationSettings_1['StationContext'][a15_0x490c('0x18')][a15_0x490c('0x1b')],'nit':stationSettings_1[a15_0x490c('0x1a')]['settings']['nit'],'placa':stationSettings_1['StationContext']['settings'][a15_0x490c('0x1c')],'inicio_viaje':this[a15_0x490c('0x4')][a15_0x490c('0x14')]+'/'+this[a15_0x490c('0x4')]['month']+'/'+this['eventDateParts'][a15_0x490c('0x12')]+'\x20'+this[a15_0x490c('0x4')][a15_0x490c('0x15')]+':'+this[a15_0x490c('0x4')][a15_0x490c('0x1d')]+':'+this[a15_0x490c('0x4')][a15_0x490c('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x490c('0x4')]['year']+this[a15_0x490c('0x4')]['month']+this[a15_0x490c('0x4')][a15_0x490c('0x14')],'hora':this[a15_0x490c('0x4')][a15_0x490c('0x15')]+this[a15_0x490c('0x4')][a15_0x490c('0x1d')]+this[a15_0x490c('0x4')][a15_0x490c('0x16')],'dop':this['gpsService'][a15_0x490c('0x1e')][a15_0x490c('0x1f')],'longitud':this[a15_0x490c('0x5')][a15_0x490c('0x1e')][a15_0x490c('0x20')],'latitud':this[a15_0x490c('0x5')][a15_0x490c('0x1e')][a15_0x490c('0x21')],'velocidad':this[a15_0x490c('0x5')][a15_0x490c('0x1e')][a15_0x490c('0x22')],'puerta':[{'estado':this[a15_0x490c('0x6')][a15_0x490c('0x23')],'idPuerta':0x0,'ingresos':_0x5059f4!=null?_0x5059f4[a15_0x490c('0x24')][0x0]['In']:0x0,'salidas':_0x5059f4!=null?_0x5059f4['CountingInfo'][0x0][a15_0x490c('0x25')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x61d5b2;}[a15_0x490c('0xf')](_0x2257e1){const _0x4aaa3d=require('fs');const _0x1e8d43=require(a15_0x490c('0x26'));const _0x3a59cb=stationSettings_1[a15_0x490c('0x1a')][a15_0x490c('0x18')][a15_0x490c('0x27')]+stationSettings_1[a15_0x490c('0x1a')]['settings'][a15_0x490c('0x1c')]+this[a15_0x490c('0x4')][a15_0x490c('0x14')]+this[a15_0x490c('0x4')][a15_0x490c('0x13')]+this['eventDateParts']['year']+this['eventDateParts']['hour']+this[a15_0x490c('0x4')][a15_0x490c('0x1d')]+this[a15_0x490c('0x4')][a15_0x490c('0x16')];const _0x3e39b6=stationSettings_1[a15_0x490c('0x1a')]['settings']['eventFileFolder']+_0x3a59cb;const _0x195fab=JSON[a15_0x490c('0x28')](_0x2257e1);_0x4aaa3d[a15_0x490c('0x29')](_0x3e39b6,_0x195fab,_0x3a3423=>{if(_0x3a3423)return console[a15_0x490c('0x2a')](_0x3a3423);const _0x172289=_0x3e39b6+a15_0x490c('0x2b');const _0x29dbc7=_0x1e8d43[a15_0x490c('0x2c')]();const _0x4d98be=_0x4aaa3d[a15_0x490c('0x2d')](_0x3e39b6);const _0x246a6=_0x4aaa3d[a15_0x490c('0x2e')](_0x172289);_0x4d98be[a15_0x490c('0x2f')](_0x29dbc7)[a15_0x490c('0x2f')](_0x246a6)['on'](a15_0x490c('0x30'),_0x3a3423=>{if(_0x3a3423)return console[a15_0x490c('0x2a')](_0x3a3423);else{if(_0x4aaa3d[a15_0x490c('0x31')](_0x3e39b6)){_0x4aaa3d[a15_0x490c('0x32')](_0x3e39b6,_0x3a3423=>{if(_0x3a3423)throw _0x3a3423;console[a15_0x490c('0x10')]('successfully\x20deleted\x20'+_0x3e39b6);});}console[a15_0x490c('0x10')](a15_0x490c('0x33')+_0x172289);return _0x172289;}});});}}exports['EventsService']=EventsService;