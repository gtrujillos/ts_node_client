var a14_0x5e80=['../infrastructure/stationSettings','startDateParts','gpsService','countingWebSocketService','createEvent','bind','sensorsService','getDateParts','startDate','eventDate','DateUtils','createFile','createJson','1-71767930-','eventDateParts','year','month','day','hour','minute','second','-00001','StationContext','settings','routeCode','routeName','plate','locationParts','hdop','longitude','speed','doorStatus','CountingInfo','Out','zlib','eventFileFolder','writeFile','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','error','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a14_0x5e80,0x97));var a14_0x3d39=function(_0x1efb05,_0x45c1cd){_0x1efb05=_0x1efb05-0x0;var _0x59cec2=a14_0x5e80[_0x1efb05];return _0x59cec2;};'use strict';Object[a14_0x3d39('0x0')](exports,a14_0x3d39('0x1'),{'value':!![]});const stationSettings_1=require(a14_0x3d39('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require('request');class EventsService{constructor(_0x4b048e,_0x57735e,_0x416f0f){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x3d39('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x3d39('0x4')]=_0x4b048e;this['sensorsService']=_0x57735e;this[a14_0x3d39('0x5')]=_0x416f0f;this[a14_0x3d39('0x4')][a14_0x3d39('0x6')]=this[a14_0x3d39('0x6')][a14_0x3d39('0x7')](this);this[a14_0x3d39('0x8')][a14_0x3d39('0x6')]=this[a14_0x3d39('0x6')][a14_0x3d39('0x7')](this);this[a14_0x3d39('0x5')][a14_0x3d39('0x6')]=this[a14_0x3d39('0x6')]['bind'](this);this['startDate']=new Date();this[a14_0x3d39('0x3')]=dateUtils_1['DateUtils'][a14_0x3d39('0x9')](this[a14_0x3d39('0xa')]);}['createEvent'](_0x2e0b79){try{this[a14_0x3d39('0xb')]=new Date();this['eventDateParts']=dateUtils_1[a14_0x3d39('0xc')][a14_0x3d39('0x9')](this[a14_0x3d39('0xb')]);const _0x369ce6=this['createJson'](_0x2e0b79);const _0x5a8bb1=this[a14_0x3d39('0xd')](_0x369ce6);}catch(_0x4db0a7){console['log'](_0x4db0a7);}}[a14_0x3d39('0xe')](_0x27efbf){const _0x35f852={'idViaje':a14_0x3d39('0xf')+this[a14_0x3d39('0x10')][a14_0x3d39('0x11')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x12')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x13')]+'-'+this[a14_0x3d39('0x10')][a14_0x3d39('0x14')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x15')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x16')]+a14_0x3d39('0x17'),'cedula':stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')]['driverDocument'],'codigoRuta':stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')][a14_0x3d39('0x1a')],'ruta':stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')][a14_0x3d39('0x1b')],'nit':stationSettings_1[a14_0x3d39('0x18')]['settings']['nit'],'placa':stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')][a14_0x3d39('0x1c')],'inicio_viaje':this[a14_0x3d39('0x10')][a14_0x3d39('0x13')]+'/'+this['eventDateParts'][a14_0x3d39('0x12')]+'/'+this[a14_0x3d39('0x10')][a14_0x3d39('0x11')]+'\x20'+this[a14_0x3d39('0x10')][a14_0x3d39('0x14')]+':'+this['eventDateParts'][a14_0x3d39('0x15')]+':'+this[a14_0x3d39('0x10')][a14_0x3d39('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a14_0x3d39('0x10')][a14_0x3d39('0x11')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x12')]+this['eventDateParts'][a14_0x3d39('0x13')],'hora':this[a14_0x3d39('0x10')][a14_0x3d39('0x14')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x15')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x16')],'dop':this[a14_0x3d39('0x4')][a14_0x3d39('0x1d')][a14_0x3d39('0x1e')],'longitud':this['gpsService'][a14_0x3d39('0x1d')][a14_0x3d39('0x1f')],'latitud':this[a14_0x3d39('0x4')][a14_0x3d39('0x1d')]['latitude'],'velocidad':this[a14_0x3d39('0x4')]['locationParts'][a14_0x3d39('0x20')],'puerta':[{'estado':this[a14_0x3d39('0x8')][a14_0x3d39('0x21')],'idPuerta':0x0,'ingresos':_0x27efbf!=null?_0x27efbf[a14_0x3d39('0x22')][0x0]['In']:0x0,'salidas':_0x27efbf!=null?_0x27efbf[a14_0x3d39('0x22')][0x0][a14_0x3d39('0x23')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x35f852;}[a14_0x3d39('0xd')](_0x309398){const _0x1bfa56=require('fs');const _0xb4fc5a=require(a14_0x3d39('0x24'));const _0x308f8f=stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')]['nit']+stationSettings_1['StationContext'][a14_0x3d39('0x19')][a14_0x3d39('0x1c')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x13')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x12')]+this[a14_0x3d39('0x10')][a14_0x3d39('0x11')]+this['eventDateParts'][a14_0x3d39('0x14')]+this[a14_0x3d39('0x10')]['minute']+this[a14_0x3d39('0x10')]['second'];const _0x4624e3=stationSettings_1[a14_0x3d39('0x18')][a14_0x3d39('0x19')][a14_0x3d39('0x25')]+_0x308f8f;const _0x172ce9=JSON['stringify'](_0x309398);_0x1bfa56[a14_0x3d39('0x26')](_0x4624e3,_0x172ce9,_0x48309d=>{if(_0x48309d)return console['error'](_0x48309d);const _0x42c584=_0x4624e3+a14_0x3d39('0x27');const _0x4c4676=_0xb4fc5a[a14_0x3d39('0x28')]();const _0x263372=_0x1bfa56[a14_0x3d39('0x29')](_0x4624e3);const _0x255b31=_0x1bfa56[a14_0x3d39('0x2a')](_0x42c584);_0x263372[a14_0x3d39('0x2b')](_0x4c4676)['pipe'](_0x255b31)['on'](a14_0x3d39('0x2c'),_0x48309d=>{if(_0x48309d)return console[a14_0x3d39('0x2d')](_0x48309d);else{if(_0x1bfa56[a14_0x3d39('0x2e')](_0x4624e3)){_0x1bfa56[a14_0x3d39('0x2f')](_0x4624e3,_0x48309d=>{if(_0x48309d)throw _0x48309d;console['log'](a14_0x3d39('0x30')+_0x4624e3);});}console['log'](a14_0x3d39('0x31')+_0x42c584);return _0x42c584;}});});}}exports[a14_0x3d39('0x32')]=EventsService;