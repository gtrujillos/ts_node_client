var a15_0x2a86=['successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','sensorsService','gpsService','createEvent','bind','DateUtils','startDate','eventDateParts','getDateParts','createFile','createJson','1-71767930-','year','month','day','hour','minute','second','-00001','StationContext','settings','routeCode','nit','plate','locationParts','longitude','latitude','speed','doorStatus','CountingInfo','Out','zlib','eventFileFolder','.gz','createGzip','createReadStream','createWriteStream','pipe','finish','error','existsSync','unlink','log','successfully\x20deleted\x20'];(function(_0x2d924f,_0x42e15d){var _0xfc5c0d=function(_0x1383a0){while(--_0x1383a0){_0x2d924f['push'](_0x2d924f['shift']());}};_0xfc5c0d(++_0x42e15d);}(a15_0x2a86,0x66));var a15_0x2023=function(_0x1d9318,_0x458e46){_0x1d9318=_0x1d9318-0x0;var _0x245ded=a15_0x2a86[_0x1d9318];return _0x245ded;};'use strict';Object[a15_0x2023('0x0')](exports,a15_0x2023('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x2023('0x2'));const dateUtils_1=require(a15_0x2023('0x3'));const fs=require('fs');const request=require(a15_0x2023('0x4'));class EventsService{constructor(_0x63757c,_0x4fdf46,_0x36aeb5){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x63757c;this[a15_0x2023('0x5')]=_0x4fdf46;this['countingWebSocketService']=_0x36aeb5;this[a15_0x2023('0x6')][a15_0x2023('0x7')]=this[a15_0x2023('0x7')][a15_0x2023('0x8')](this);this[a15_0x2023('0x5')][a15_0x2023('0x7')]=this[a15_0x2023('0x7')][a15_0x2023('0x8')](this);this['countingWebSocketService']['createEvent']=this[a15_0x2023('0x7')][a15_0x2023('0x8')](this);this['startDate']=new Date();this['startDateParts']=dateUtils_1[a15_0x2023('0x9')]['getDateParts'](this[a15_0x2023('0xa')]);}[a15_0x2023('0x7')](_0x424089){try{this['eventDate']=new Date();this[a15_0x2023('0xb')]=dateUtils_1[a15_0x2023('0x9')][a15_0x2023('0xc')](this['eventDate']);const _0x474efa=this['createJson'](_0x424089);const _0x54a14a=this[a15_0x2023('0xd')](_0x474efa);}catch(_0x3a1df9){console['log'](_0x3a1df9);}}[a15_0x2023('0xe')](_0x1a1865){const _0x1ec94b={'idViaje':a15_0x2023('0xf')+this[a15_0x2023('0xb')][a15_0x2023('0x10')]+this[a15_0x2023('0xb')][a15_0x2023('0x11')]+this[a15_0x2023('0xb')][a15_0x2023('0x12')]+'-'+this[a15_0x2023('0xb')][a15_0x2023('0x13')]+this[a15_0x2023('0xb')][a15_0x2023('0x14')]+this['eventDateParts'][a15_0x2023('0x15')]+a15_0x2023('0x16'),'cedula':stationSettings_1[a15_0x2023('0x17')]['settings']['driverDocument'],'codigoRuta':stationSettings_1[a15_0x2023('0x17')][a15_0x2023('0x18')][a15_0x2023('0x19')],'ruta':stationSettings_1['StationContext'][a15_0x2023('0x18')]['routeName'],'nit':stationSettings_1[a15_0x2023('0x17')]['settings'][a15_0x2023('0x1a')],'placa':stationSettings_1[a15_0x2023('0x17')]['settings'][a15_0x2023('0x1b')],'inicio_viaje':this[a15_0x2023('0xb')][a15_0x2023('0x12')]+'/'+this[a15_0x2023('0xb')]['month']+'/'+this[a15_0x2023('0xb')][a15_0x2023('0x10')]+'\x20'+this[a15_0x2023('0xb')][a15_0x2023('0x13')]+':'+this[a15_0x2023('0xb')][a15_0x2023('0x14')]+':'+this[a15_0x2023('0xb')][a15_0x2023('0x15')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x2023('0xb')][a15_0x2023('0x10')]+this[a15_0x2023('0xb')][a15_0x2023('0x11')]+this[a15_0x2023('0xb')]['day'],'hora':this[a15_0x2023('0xb')][a15_0x2023('0x13')]+this[a15_0x2023('0xb')][a15_0x2023('0x14')]+this['eventDateParts']['second'],'dop':this[a15_0x2023('0x6')][a15_0x2023('0x1c')]['hdop'],'longitud':this[a15_0x2023('0x6')][a15_0x2023('0x1c')][a15_0x2023('0x1d')],'latitud':this[a15_0x2023('0x6')][a15_0x2023('0x1c')][a15_0x2023('0x1e')],'velocidad':this['gpsService'][a15_0x2023('0x1c')][a15_0x2023('0x1f')],'puerta':[{'estado':this[a15_0x2023('0x5')][a15_0x2023('0x20')],'idPuerta':0x0,'ingresos':_0x1a1865!=null?_0x1a1865['CountingInfo'][0x0]['In']:0x0,'salidas':_0x1a1865!=null?_0x1a1865[a15_0x2023('0x21')][0x0][a15_0x2023('0x22')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x1ec94b;}['createFile'](_0x498898){const _0x51bb4d=require('fs');const _0x34ebb5=require(a15_0x2023('0x23'));const _0x5a0d50=stationSettings_1[a15_0x2023('0x17')][a15_0x2023('0x18')][a15_0x2023('0x1a')]+stationSettings_1[a15_0x2023('0x17')][a15_0x2023('0x18')]['plate']+this[a15_0x2023('0xb')][a15_0x2023('0x12')]+this[a15_0x2023('0xb')][a15_0x2023('0x11')]+this[a15_0x2023('0xb')]['year']+this[a15_0x2023('0xb')][a15_0x2023('0x13')]+this['eventDateParts']['minute']+this['eventDateParts'][a15_0x2023('0x15')];const _0x6e0049=stationSettings_1[a15_0x2023('0x17')]['settings'][a15_0x2023('0x24')]+_0x5a0d50;const _0xde24b6=JSON['stringify'](_0x498898);_0x51bb4d['writeFile'](_0x6e0049,_0xde24b6,_0x3ba30e=>{if(_0x3ba30e)return console['error'](_0x3ba30e);const _0x3a27e9=_0x6e0049+a15_0x2023('0x25');const _0x48cf22=_0x34ebb5[a15_0x2023('0x26')]();const _0x5e7419=_0x51bb4d[a15_0x2023('0x27')](_0x6e0049);const _0x4d52fe=_0x51bb4d[a15_0x2023('0x28')](_0x3a27e9);_0x5e7419[a15_0x2023('0x29')](_0x48cf22)['pipe'](_0x4d52fe)['on'](a15_0x2023('0x2a'),_0x3ba30e=>{if(_0x3ba30e)return console[a15_0x2023('0x2b')](_0x3ba30e);else{if(_0x51bb4d[a15_0x2023('0x2c')](_0x6e0049)){_0x51bb4d[a15_0x2023('0x2d')](_0x6e0049,_0x3ba30e=>{if(_0x3ba30e)throw _0x3ba30e;console[a15_0x2023('0x2e')](a15_0x2023('0x2f')+_0x6e0049);});}console[a15_0x2023('0x2e')](a15_0x2023('0x30')+_0x3a27e9);return _0x3a27e9;}});});}}exports[a15_0x2023('0x31')]=EventsService;