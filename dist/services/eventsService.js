var a15_0x2398=['eventDateParts','getDateParts','createJson','log','1-71767930-','year','month','day','hour','minute','second','-00001','StationContext','driverDocument','settings','routeCode','routeName','nit','plate','locationParts','hdop','longitude','latitude','speed','CountingInfo','Out','createFile','zlib','eventFileFolder','writeFile','error','.gz','createGzip','createWriteStream','pipe','finish','existsSync','EventsService','__esModule','../infrastructure/stationSettings','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','eventDate'];(function(_0x5e9339,_0x171005){var _0x55c1f0=function(_0x56a852){while(--_0x56a852){_0x5e9339['push'](_0x5e9339['shift']());}};_0x55c1f0(++_0x171005);}(a15_0x2398,0xb9));var a15_0x573a=function(_0x388c53,_0x445f96){_0x388c53=_0x388c53-0x0;var _0x445bb3=a15_0x2398[_0x388c53];return _0x445bb3;};'use strict';Object['defineProperty'](exports,a15_0x573a('0x0'),{'value':!![]});const stationSettings_1=require(a15_0x573a('0x1'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require('request');class EventsService{constructor(_0x160167,_0x13703b,_0x57f31c){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x573a('0x2')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x573a('0x3')]=_0x160167;this[a15_0x573a('0x4')]=_0x13703b;this[a15_0x573a('0x5')]=_0x57f31c;this[a15_0x573a('0x3')][a15_0x573a('0x6')]=this[a15_0x573a('0x6')][a15_0x573a('0x7')](this);this['sensorsService']['createEvent']=this[a15_0x573a('0x6')][a15_0x573a('0x7')](this);this[a15_0x573a('0x5')][a15_0x573a('0x6')]=this['createEvent'][a15_0x573a('0x7')](this);this[a15_0x573a('0x8')]=new Date();this['startDateParts']=dateUtils_1[a15_0x573a('0x9')]['getDateParts'](this[a15_0x573a('0x8')]);}[a15_0x573a('0x6')](_0x38c1d9){try{this[a15_0x573a('0xa')]=new Date();this[a15_0x573a('0xb')]=dateUtils_1['DateUtils'][a15_0x573a('0xc')](this[a15_0x573a('0xa')]);const _0x52bab1=this[a15_0x573a('0xd')](_0x38c1d9);const _0x60bcaf=this['createFile'](_0x52bab1);}catch(_0x4c8a93){console[a15_0x573a('0xe')](_0x4c8a93);}}[a15_0x573a('0xd')](_0x85352e){const _0x1efa0d={'idViaje':a15_0x573a('0xf')+this[a15_0x573a('0xb')][a15_0x573a('0x10')]+this[a15_0x573a('0xb')][a15_0x573a('0x11')]+this[a15_0x573a('0xb')][a15_0x573a('0x12')]+'-'+this[a15_0x573a('0xb')][a15_0x573a('0x13')]+this[a15_0x573a('0xb')][a15_0x573a('0x14')]+this[a15_0x573a('0xb')][a15_0x573a('0x15')]+a15_0x573a('0x16'),'cedula':stationSettings_1[a15_0x573a('0x17')]['settings'][a15_0x573a('0x18')],'codigoRuta':stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x1a')],'ruta':stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x1b')],'nit':stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x1c')],'placa':stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x1d')],'inicio_viaje':this[a15_0x573a('0xb')]['day']+'/'+this[a15_0x573a('0xb')][a15_0x573a('0x11')]+'/'+this[a15_0x573a('0xb')]['year']+'\x20'+this[a15_0x573a('0xb')][a15_0x573a('0x13')]+':'+this[a15_0x573a('0xb')]['minute']+':'+this[a15_0x573a('0xb')]['second'],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts'][a15_0x573a('0x10')]+this[a15_0x573a('0xb')][a15_0x573a('0x11')]+this[a15_0x573a('0xb')]['day'],'hora':this[a15_0x573a('0xb')][a15_0x573a('0x13')]+this[a15_0x573a('0xb')]['minute']+this[a15_0x573a('0xb')][a15_0x573a('0x15')],'dop':this['gpsService'][a15_0x573a('0x1e')][a15_0x573a('0x1f')],'longitud':this[a15_0x573a('0x3')][a15_0x573a('0x1e')][a15_0x573a('0x20')],'latitud':this['gpsService']['locationParts'][a15_0x573a('0x21')],'velocidad':this[a15_0x573a('0x3')][a15_0x573a('0x1e')][a15_0x573a('0x22')],'puerta':[{'estado':this[a15_0x573a('0x4')]['doorStatus'],'idPuerta':0x0,'ingresos':_0x85352e!=null?_0x85352e[a15_0x573a('0x23')][0x0]['In']:0x0,'salidas':_0x85352e!=null?_0x85352e['CountingInfo'][0x0][a15_0x573a('0x24')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x1efa0d;}[a15_0x573a('0x25')](_0x38c59b){const _0x396234=require('fs');const _0x5f3e66=require(a15_0x573a('0x26'));const _0x83f281=stationSettings_1[a15_0x573a('0x17')]['settings'][a15_0x573a('0x1c')]+stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x1d')]+this['eventDateParts'][a15_0x573a('0x12')]+this[a15_0x573a('0xb')][a15_0x573a('0x11')]+this[a15_0x573a('0xb')][a15_0x573a('0x10')]+this['eventDateParts'][a15_0x573a('0x13')]+this[a15_0x573a('0xb')][a15_0x573a('0x14')]+this[a15_0x573a('0xb')][a15_0x573a('0x15')];const _0x1b9561=stationSettings_1[a15_0x573a('0x17')][a15_0x573a('0x19')][a15_0x573a('0x27')]+_0x83f281;const _0x3ec781=JSON['stringify'](_0x38c59b);_0x396234[a15_0x573a('0x28')](_0x1b9561,_0x3ec781,_0xb683ba=>{if(_0xb683ba)return console[a15_0x573a('0x29')](_0xb683ba);const _0xc738f7=_0x1b9561+a15_0x573a('0x2a');const _0x2f01fb=_0x5f3e66[a15_0x573a('0x2b')]();const _0x57da7b=_0x396234['createReadStream'](_0x1b9561);const _0x1b1bda=_0x396234[a15_0x573a('0x2c')](_0xc738f7);_0x57da7b['pipe'](_0x2f01fb)[a15_0x573a('0x2d')](_0x1b1bda)['on'](a15_0x573a('0x2e'),_0xb683ba=>{if(_0xb683ba)return console[a15_0x573a('0x29')](_0xb683ba);else{if(_0x396234[a15_0x573a('0x2f')](_0x1b9561)){_0x396234['unlink'](_0x1b9561,_0xb683ba=>{if(_0xb683ba)throw _0xb683ba;console[a15_0x573a('0xe')]('successfully\x20deleted\x20'+_0x1b9561);});}console['log']('successfully\x20created\x20'+_0xc738f7);return _0xc738f7;}});});}}exports[a15_0x573a('0x30')]=EventsService;