var a15_0x544b=['error','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','startDate','DateUtils','getDateParts','eventDate','createJson','createFile','log','1-71767930-','month','day','minute','second','-00001','StationContext','settings','routeCode','routeName','nit','plate','year','hour','locationParts','longitude','latitude','speed','CountingInfo','Out','zlib','eventFileFolder','stringify','createGzip','createWriteStream','pipe','finish'];(function(_0x145327,_0x266911){var _0x3821e8=function(_0x43197b){while(--_0x43197b){_0x145327['push'](_0x145327['shift']());}};_0x3821e8(++_0x266911);}(a15_0x544b,0x196));var a15_0x1ae3=function(_0x3d5ffe,_0x45f813){_0x3d5ffe=_0x3d5ffe-0x0;var _0x2399b5=a15_0x544b[_0x3d5ffe];return _0x2399b5;};'use strict';Object[a15_0x1ae3('0x0')](exports,a15_0x1ae3('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x1ae3('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require(a15_0x1ae3('0x3'));class EventsService{constructor(_0x3e2c46,_0x2c029a,_0x32a513){this[a15_0x1ae3('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1ae3('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x1ae3('0x6')]=_0x3e2c46;this[a15_0x1ae3('0x7')]=_0x2c029a;this[a15_0x1ae3('0x8')]=_0x32a513;this[a15_0x1ae3('0x6')]['createEvent']=this[a15_0x1ae3('0x9')]['bind'](this);this[a15_0x1ae3('0x7')][a15_0x1ae3('0x9')]=this[a15_0x1ae3('0x9')]['bind'](this);this[a15_0x1ae3('0x8')][a15_0x1ae3('0x9')]=this['createEvent']['bind'](this);this[a15_0x1ae3('0xa')]=new Date();this[a15_0x1ae3('0x5')]=dateUtils_1[a15_0x1ae3('0xb')][a15_0x1ae3('0xc')](this[a15_0x1ae3('0xa')]);}['createEvent'](_0x431d22){try{this[a15_0x1ae3('0xd')]=new Date();this[a15_0x1ae3('0x4')]=dateUtils_1['DateUtils'][a15_0x1ae3('0xc')](this[a15_0x1ae3('0xd')]);const _0x245176=this[a15_0x1ae3('0xe')](_0x431d22);const _0x55b002=this[a15_0x1ae3('0xf')](_0x245176);}catch(_0x31d545){console[a15_0x1ae3('0x10')](_0x31d545);}}['createJson'](_0x5040cb){const _0x5ca51c={'idViaje':a15_0x1ae3('0x11')+this[a15_0x1ae3('0x4')]['year']+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x12')]+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x13')]+'-'+this[a15_0x1ae3('0x4')]['hour']+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x14')]+this['eventDateParts'][a15_0x1ae3('0x15')]+a15_0x1ae3('0x16'),'cedula':stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')]['driverDocument'],'codigoRuta':stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x19')],'ruta':stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x1a')],'nit':stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x1b')],'placa':stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x1c')],'inicio_viaje':this[a15_0x1ae3('0x4')][a15_0x1ae3('0x13')]+'/'+this['eventDateParts']['month']+'/'+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x1d')]+'\x20'+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x1e')]+':'+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x14')]+':'+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x15')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts']['year']+this[a15_0x1ae3('0x4')]['month']+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x13')],'hora':this[a15_0x1ae3('0x4')]['hour']+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x14')]+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x15')],'dop':this[a15_0x1ae3('0x6')][a15_0x1ae3('0x1f')]['hdop'],'longitud':this['gpsService'][a15_0x1ae3('0x1f')][a15_0x1ae3('0x20')],'latitud':this[a15_0x1ae3('0x6')][a15_0x1ae3('0x1f')][a15_0x1ae3('0x21')],'velocidad':this['gpsService'][a15_0x1ae3('0x1f')][a15_0x1ae3('0x22')],'puerta':[{'estado':this['sensorsService']['doorStatus'],'idPuerta':0x0,'ingresos':_0x5040cb!=null?_0x5040cb[a15_0x1ae3('0x23')][0x0]['In']:0x0,'salidas':_0x5040cb!=null?_0x5040cb[a15_0x1ae3('0x23')][0x0][a15_0x1ae3('0x24')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x5ca51c;}[a15_0x1ae3('0xf')](_0x573f93){const _0x5d93b2=require('fs');const _0x542f90=require(a15_0x1ae3('0x25'));const _0x1f6068=stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x1b')]+stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x1c')]+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x13')]+this['eventDateParts'][a15_0x1ae3('0x12')]+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x1d')]+this[a15_0x1ae3('0x4')][a15_0x1ae3('0x1e')]+this['eventDateParts'][a15_0x1ae3('0x14')]+this['eventDateParts'][a15_0x1ae3('0x15')];const _0x214b51=stationSettings_1[a15_0x1ae3('0x17')][a15_0x1ae3('0x18')][a15_0x1ae3('0x26')]+_0x1f6068;const _0x267954=JSON[a15_0x1ae3('0x27')](_0x573f93);_0x5d93b2['writeFile'](_0x214b51,_0x267954,_0x50533b=>{if(_0x50533b)return console['error'](_0x50533b);const _0x2a7595=_0x214b51+'.gz';const _0x1327d3=_0x542f90[a15_0x1ae3('0x28')]();const _0x5762b4=_0x5d93b2['createReadStream'](_0x214b51);const _0x4249ad=_0x5d93b2[a15_0x1ae3('0x29')](_0x2a7595);_0x5762b4[a15_0x1ae3('0x2a')](_0x1327d3)[a15_0x1ae3('0x2a')](_0x4249ad)['on'](a15_0x1ae3('0x2b'),_0x50533b=>{if(_0x50533b)return console[a15_0x1ae3('0x2c')](_0x50533b);else{if(_0x5d93b2[a15_0x1ae3('0x2d')](_0x214b51)){_0x5d93b2[a15_0x1ae3('0x2e')](_0x214b51,_0x50533b=>{if(_0x50533b)throw _0x50533b;console[a15_0x1ae3('0x10')](a15_0x1ae3('0x2f')+_0x214b51);});}console[a15_0x1ae3('0x10')](a15_0x1ae3('0x30')+_0x2a7595);return _0x2a7595;}});});}}exports[a15_0x1ae3('0x31')]=EventsService;