var a14_0x4c55=['DateUtils','createFile','log','createJson','1-71767930-','month','day','hour','minute','second','-00001','settings','driverDocument','routeCode','StationContext','nit','plate','year','locationParts','hdop','longitude','latitude','doorStatus','CountingInfo','Out','zlib','stringify','createGzip','createWriteStream','pipe','finish','error','unlink','successfully\x20deleted\x20','successfully\x20created\x20','defineProperty','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','countingWebSocketService','gpsService','createEvent','sensorsService','bind','startDate','getDateParts','eventDate'];(function(_0x16af9f,_0x4b8a24){var _0x1279a1=function(_0x2f2e7a){while(--_0x2f2e7a){_0x16af9f['push'](_0x16af9f['shift']());}};_0x1279a1(++_0x4b8a24);}(a14_0x4c55,0x143));var a14_0x1fb8=function(_0x331785,_0x13821a){_0x331785=_0x331785-0x0;var _0x24e1eb=a14_0x4c55[_0x331785];return _0x24e1eb;};'use strict';Object[a14_0x1fb8('0x0')](exports,'__esModule',{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require(a14_0x1fb8('0x1'));const fs=require('fs');const request=require(a14_0x1fb8('0x2'));class EventsService{constructor(_0x280db7,_0x1aba2f,_0x2efbd1){this[a14_0x1fb8('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x1fb8('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x280db7;this['sensorsService']=_0x1aba2f;this[a14_0x1fb8('0x5')]=_0x2efbd1;this[a14_0x1fb8('0x6')]['createEvent']=this[a14_0x1fb8('0x7')]['bind'](this);this[a14_0x1fb8('0x8')][a14_0x1fb8('0x7')]=this[a14_0x1fb8('0x7')][a14_0x1fb8('0x9')](this);this[a14_0x1fb8('0x5')]['createEvent']=this[a14_0x1fb8('0x7')]['bind'](this);this[a14_0x1fb8('0xa')]=new Date();this[a14_0x1fb8('0x4')]=dateUtils_1['DateUtils'][a14_0x1fb8('0xb')](this[a14_0x1fb8('0xa')]);}['createEvent'](_0x341908){try{this[a14_0x1fb8('0xc')]=new Date();this[a14_0x1fb8('0x3')]=dateUtils_1[a14_0x1fb8('0xd')]['getDateParts'](this['eventDate']);const _0x2d8010=this['createJson'](_0x341908);const _0x252be9=this[a14_0x1fb8('0xe')](_0x2d8010);}catch(_0x100d41){console[a14_0x1fb8('0xf')](_0x100d41);}}[a14_0x1fb8('0x10')](_0x5cc922){const _0x508189={'idViaje':a14_0x1fb8('0x11')+this[a14_0x1fb8('0x3')]['year']+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x12')]+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x13')]+'-'+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x14')]+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x15')]+this['eventDateParts'][a14_0x1fb8('0x16')]+a14_0x1fb8('0x17'),'cedula':stationSettings_1['StationContext'][a14_0x1fb8('0x18')][a14_0x1fb8('0x19')],'codigoRuta':stationSettings_1['StationContext'][a14_0x1fb8('0x18')][a14_0x1fb8('0x1a')],'ruta':stationSettings_1[a14_0x1fb8('0x1b')][a14_0x1fb8('0x18')]['routeName'],'nit':stationSettings_1[a14_0x1fb8('0x1b')][a14_0x1fb8('0x18')][a14_0x1fb8('0x1c')],'placa':stationSettings_1[a14_0x1fb8('0x1b')][a14_0x1fb8('0x18')][a14_0x1fb8('0x1d')],'inicio_viaje':this[a14_0x1fb8('0x3')][a14_0x1fb8('0x13')]+'/'+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x12')]+'/'+this['eventDateParts'][a14_0x1fb8('0x1e')]+'\x20'+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x14')]+':'+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x15')]+':'+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts'][a14_0x1fb8('0x1e')]+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x12')]+this[a14_0x1fb8('0x3')]['day'],'hora':this['eventDateParts'][a14_0x1fb8('0x14')]+this[a14_0x1fb8('0x3')]['minute']+this['eventDateParts'][a14_0x1fb8('0x16')],'dop':this[a14_0x1fb8('0x6')][a14_0x1fb8('0x1f')][a14_0x1fb8('0x20')],'longitud':this[a14_0x1fb8('0x6')][a14_0x1fb8('0x1f')][a14_0x1fb8('0x21')],'latitud':this['gpsService']['locationParts'][a14_0x1fb8('0x22')],'velocidad':this[a14_0x1fb8('0x6')]['locationParts']['speed'],'puerta':[{'estado':this[a14_0x1fb8('0x8')][a14_0x1fb8('0x23')],'idPuerta':0x0,'ingresos':_0x5cc922!=null?_0x5cc922[a14_0x1fb8('0x24')][0x0]['In']:0x0,'salidas':_0x5cc922!=null?_0x5cc922[a14_0x1fb8('0x24')][0x0][a14_0x1fb8('0x25')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x508189;}[a14_0x1fb8('0xe')](_0xf1c95b){const _0x363986=require('fs');const _0x368fc3=require(a14_0x1fb8('0x26'));const _0x3ddacf=stationSettings_1[a14_0x1fb8('0x1b')]['settings'][a14_0x1fb8('0x1c')]+stationSettings_1[a14_0x1fb8('0x1b')][a14_0x1fb8('0x18')]['plate']+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x13')]+this['eventDateParts'][a14_0x1fb8('0x12')]+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x1e')]+this['eventDateParts']['hour']+this[a14_0x1fb8('0x3')]['minute']+this[a14_0x1fb8('0x3')][a14_0x1fb8('0x16')];const _0x46e7eb=stationSettings_1[a14_0x1fb8('0x1b')]['settings']['eventFileFolder']+_0x3ddacf;const _0xe80090=JSON[a14_0x1fb8('0x27')](_0xf1c95b);_0x363986['writeFile'](_0x46e7eb,_0xe80090,_0x728430=>{if(_0x728430)return console['error'](_0x728430);const _0x6ae642=_0x46e7eb+'.gz';const _0x486d29=_0x368fc3[a14_0x1fb8('0x28')]();const _0x11d269=_0x363986['createReadStream'](_0x46e7eb);const _0x3907b1=_0x363986[a14_0x1fb8('0x29')](_0x6ae642);_0x11d269[a14_0x1fb8('0x2a')](_0x486d29)[a14_0x1fb8('0x2a')](_0x3907b1)['on'](a14_0x1fb8('0x2b'),_0x728430=>{if(_0x728430)return console[a14_0x1fb8('0x2c')](_0x728430);else{if(_0x363986['existsSync'](_0x46e7eb)){_0x363986[a14_0x1fb8('0x2d')](_0x46e7eb,_0x728430=>{if(_0x728430)throw _0x728430;console['log'](a14_0x1fb8('0x2e')+_0x46e7eb);});}console['log'](a14_0x1fb8('0x2f')+_0x6ae642);return _0x6ae642;}});});}}exports['EventsService']=EventsService;