var a15_0x2e1e=['CountingInfo','Out','zlib','plate','eventFileFolder','stringify','writeFile','error','.gz','createGzip','pipe','finish','existsSync','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','gpsService','sensorsService','createEvent','countingWebSocketService','bind','startDate','getDateParts','DateUtils','eventDate','createJson','createFile','log','1-71767930-','year','month','minute','second','-00001','settings','driverDocument','routeCode','StationContext','nit','day','hour','locationParts','longitude','latitude','speed','doorStatus'];(function(_0x64a8be,_0x45a68d){var _0x1dff18=function(_0x155397){while(--_0x155397){_0x64a8be['push'](_0x64a8be['shift']());}};_0x1dff18(++_0x45a68d);}(a15_0x2e1e,0x1b8));var a15_0x2335=function(_0x5edbae,_0x1f1f08){_0x5edbae=_0x5edbae-0x0;var _0xb5f4e2=a15_0x2e1e[_0x5edbae];return _0xb5f4e2;};'use strict';Object[a15_0x2335('0x0')](exports,a15_0x2335('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x2335('0x2'));const dateUtils_1=require(a15_0x2335('0x3'));const fs=require('fs');const request=require(a15_0x2335('0x4'));class EventsService{constructor(_0x2461aa,_0x6a1cb5,_0x2406d7){this[a15_0x2335('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x2335('0x6')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x2335('0x7')]=_0x2461aa;this[a15_0x2335('0x8')]=_0x6a1cb5;this['countingWebSocketService']=_0x2406d7;this[a15_0x2335('0x7')][a15_0x2335('0x9')]=this[a15_0x2335('0x9')]['bind'](this);this[a15_0x2335('0x8')][a15_0x2335('0x9')]=this['createEvent']['bind'](this);this[a15_0x2335('0xa')][a15_0x2335('0x9')]=this[a15_0x2335('0x9')][a15_0x2335('0xb')](this);this[a15_0x2335('0xc')]=new Date();this[a15_0x2335('0x6')]=dateUtils_1['DateUtils'][a15_0x2335('0xd')](this['startDate']);}[a15_0x2335('0x9')](_0xa3ff09){try{this['eventDate']=new Date();this[a15_0x2335('0x5')]=dateUtils_1[a15_0x2335('0xe')][a15_0x2335('0xd')](this[a15_0x2335('0xf')]);const _0x2c35a0=this[a15_0x2335('0x10')](_0xa3ff09);const _0x267843=this[a15_0x2335('0x11')](_0x2c35a0);}catch(_0x4f2b57){console[a15_0x2335('0x12')](_0x4f2b57);}}[a15_0x2335('0x10')](_0x1694a5){const _0x29ef3d={'idViaje':a15_0x2335('0x13')+this[a15_0x2335('0x5')][a15_0x2335('0x14')]+this[a15_0x2335('0x5')][a15_0x2335('0x15')]+this[a15_0x2335('0x5')]['day']+'-'+this['eventDateParts']['hour']+this['eventDateParts'][a15_0x2335('0x16')]+this[a15_0x2335('0x5')][a15_0x2335('0x17')]+a15_0x2335('0x18'),'cedula':stationSettings_1['StationContext'][a15_0x2335('0x19')][a15_0x2335('0x1a')],'codigoRuta':stationSettings_1['StationContext'][a15_0x2335('0x19')][a15_0x2335('0x1b')],'ruta':stationSettings_1[a15_0x2335('0x1c')][a15_0x2335('0x19')]['routeName'],'nit':stationSettings_1[a15_0x2335('0x1c')]['settings'][a15_0x2335('0x1d')],'placa':stationSettings_1[a15_0x2335('0x1c')][a15_0x2335('0x19')]['plate'],'inicio_viaje':this[a15_0x2335('0x5')][a15_0x2335('0x1e')]+'/'+this['eventDateParts']['month']+'/'+this[a15_0x2335('0x5')][a15_0x2335('0x14')]+'\x20'+this['eventDateParts'][a15_0x2335('0x1f')]+':'+this[a15_0x2335('0x5')][a15_0x2335('0x16')]+':'+this['eventDateParts'][a15_0x2335('0x17')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts']['year']+this[a15_0x2335('0x5')][a15_0x2335('0x15')]+this['eventDateParts'][a15_0x2335('0x1e')],'hora':this[a15_0x2335('0x5')][a15_0x2335('0x1f')]+this[a15_0x2335('0x5')][a15_0x2335('0x16')]+this[a15_0x2335('0x5')][a15_0x2335('0x17')],'dop':this[a15_0x2335('0x7')][a15_0x2335('0x20')]['hdop'],'longitud':this[a15_0x2335('0x7')]['locationParts'][a15_0x2335('0x21')],'latitud':this['gpsService'][a15_0x2335('0x20')][a15_0x2335('0x22')],'velocidad':this[a15_0x2335('0x7')][a15_0x2335('0x20')][a15_0x2335('0x23')],'puerta':[{'estado':this[a15_0x2335('0x8')][a15_0x2335('0x24')],'idPuerta':0x0,'ingresos':_0x1694a5!=null?_0x1694a5[a15_0x2335('0x25')][0x0]['In']:0x0,'salidas':_0x1694a5!=null?_0x1694a5['CountingInfo'][0x0][a15_0x2335('0x26')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x29ef3d;}['createFile'](_0x174eeb){const _0x201b6=require('fs');const _0x22904e=require(a15_0x2335('0x27'));const _0x84ad52=stationSettings_1[a15_0x2335('0x1c')][a15_0x2335('0x19')][a15_0x2335('0x1d')]+stationSettings_1['StationContext'][a15_0x2335('0x19')][a15_0x2335('0x28')]+this[a15_0x2335('0x5')][a15_0x2335('0x1e')]+this[a15_0x2335('0x5')][a15_0x2335('0x15')]+this[a15_0x2335('0x5')]['year']+this[a15_0x2335('0x5')][a15_0x2335('0x1f')]+this[a15_0x2335('0x5')][a15_0x2335('0x16')]+this[a15_0x2335('0x5')][a15_0x2335('0x17')];const _0x12648c=stationSettings_1[a15_0x2335('0x1c')][a15_0x2335('0x19')][a15_0x2335('0x29')]+_0x84ad52;const _0x1d3dd9=JSON[a15_0x2335('0x2a')](_0x174eeb);_0x201b6[a15_0x2335('0x2b')](_0x12648c,_0x1d3dd9,_0x41d36b=>{if(_0x41d36b)return console[a15_0x2335('0x2c')](_0x41d36b);const _0x1ee5d1=_0x12648c+a15_0x2335('0x2d');const _0x424f87=_0x22904e[a15_0x2335('0x2e')]();const _0x565cf1=_0x201b6['createReadStream'](_0x12648c);const _0x424ad4=_0x201b6['createWriteStream'](_0x1ee5d1);_0x565cf1[a15_0x2335('0x2f')](_0x424f87)['pipe'](_0x424ad4)['on'](a15_0x2335('0x30'),_0x41d36b=>{if(_0x41d36b)return console['error'](_0x41d36b);else{if(_0x201b6[a15_0x2335('0x31')](_0x12648c)){_0x201b6['unlink'](_0x12648c,_0x41d36b=>{if(_0x41d36b)throw _0x41d36b;console['log'](a15_0x2335('0x32')+_0x12648c);});}console[a15_0x2335('0x12')](a15_0x2335('0x33')+_0x1ee5d1);return _0x1ee5d1;}});});}}exports[a15_0x2335('0x34')]=EventsService;