var a15_0x387e=['defineProperty','__esModule','../infrastructure/stationSettings','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','getDateParts','eventDate','createJson','createFile','year','month','hour','minute','second','-00001','StationContext','settings','driverDocument','routeCode','plate','day','locationParts','hdop','latitude','doorStatus','CountingInfo','Out','zlib','nit','eventFileFolder','writeFile','error','.gz','createGzip','pipe','finish','existsSync','log','EventsService'];(function(_0x1efadb,_0x3815ab){var _0x3c81a4=function(_0x201f67){while(--_0x201f67){_0x1efadb['push'](_0x1efadb['shift']());}};_0x3c81a4(++_0x3815ab);}(a15_0x387e,0xeb));var a15_0x3759=function(_0x13acac,_0x19b25c){_0x13acac=_0x13acac-0x0;var _0x52e415=a15_0x387e[_0x13acac];return _0x52e415;};'use strict';Object[a15_0x3759('0x0')](exports,a15_0x3759('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x3759('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require(a15_0x3759('0x3'));class EventsService{constructor(_0x5968c6,_0x1b12a0,_0x50eea4){this[a15_0x3759('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3759('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x3759('0x6')]=_0x5968c6;this[a15_0x3759('0x7')]=_0x1b12a0;this[a15_0x3759('0x8')]=_0x50eea4;this[a15_0x3759('0x6')][a15_0x3759('0x9')]=this['createEvent'][a15_0x3759('0xa')](this);this['sensorsService'][a15_0x3759('0x9')]=this[a15_0x3759('0x9')][a15_0x3759('0xa')](this);this[a15_0x3759('0x8')]['createEvent']=this[a15_0x3759('0x9')][a15_0x3759('0xa')](this);this[a15_0x3759('0xb')]=new Date();this[a15_0x3759('0x5')]=dateUtils_1[a15_0x3759('0xc')][a15_0x3759('0xd')](this[a15_0x3759('0xb')]);}['createEvent'](_0x2099fd){try{this[a15_0x3759('0xe')]=new Date();this['eventDateParts']=dateUtils_1['DateUtils'][a15_0x3759('0xd')](this[a15_0x3759('0xe')]);const _0x85c455=this[a15_0x3759('0xf')](_0x2099fd);const _0x17931c=this[a15_0x3759('0x10')](_0x85c455);}catch(_0x3f1383){console['log'](_0x3f1383);}}[a15_0x3759('0xf')](_0x22b3bd){const _0x3e4c25={'idViaje':'1-71767930-'+this[a15_0x3759('0x4')][a15_0x3759('0x11')]+this[a15_0x3759('0x4')][a15_0x3759('0x12')]+this['eventDateParts']['day']+'-'+this[a15_0x3759('0x4')][a15_0x3759('0x13')]+this[a15_0x3759('0x4')][a15_0x3759('0x14')]+this[a15_0x3759('0x4')][a15_0x3759('0x15')]+a15_0x3759('0x16'),'cedula':stationSettings_1[a15_0x3759('0x17')][a15_0x3759('0x18')][a15_0x3759('0x19')],'codigoRuta':stationSettings_1[a15_0x3759('0x17')][a15_0x3759('0x18')][a15_0x3759('0x1a')],'ruta':stationSettings_1['StationContext']['settings']['routeName'],'nit':stationSettings_1['StationContext']['settings']['nit'],'placa':stationSettings_1['StationContext'][a15_0x3759('0x18')][a15_0x3759('0x1b')],'inicio_viaje':this[a15_0x3759('0x4')][a15_0x3759('0x1c')]+'/'+this['eventDateParts']['month']+'/'+this['eventDateParts'][a15_0x3759('0x11')]+'\x20'+this['eventDateParts'][a15_0x3759('0x13')]+':'+this['eventDateParts'][a15_0x3759('0x14')]+':'+this[a15_0x3759('0x4')][a15_0x3759('0x15')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x3759('0x4')][a15_0x3759('0x11')]+this[a15_0x3759('0x4')][a15_0x3759('0x12')]+this['eventDateParts'][a15_0x3759('0x1c')],'hora':this[a15_0x3759('0x4')][a15_0x3759('0x13')]+this[a15_0x3759('0x4')][a15_0x3759('0x14')]+this[a15_0x3759('0x4')][a15_0x3759('0x15')],'dop':this[a15_0x3759('0x6')][a15_0x3759('0x1d')][a15_0x3759('0x1e')],'longitud':this[a15_0x3759('0x6')][a15_0x3759('0x1d')]['longitude'],'latitud':this[a15_0x3759('0x6')]['locationParts'][a15_0x3759('0x1f')],'velocidad':this['gpsService']['locationParts']['speed'],'puerta':[{'estado':this[a15_0x3759('0x7')][a15_0x3759('0x20')],'idPuerta':0x0,'ingresos':_0x22b3bd!=null?_0x22b3bd[a15_0x3759('0x21')][0x0]['In']:0x0,'salidas':_0x22b3bd!=null?_0x22b3bd[a15_0x3759('0x21')][0x0][a15_0x3759('0x22')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x3e4c25;}[a15_0x3759('0x10')](_0xbffcef){const _0x53edb7=require('fs');const _0x36a3e6=require(a15_0x3759('0x23'));const _0x42e6de=stationSettings_1['StationContext']['settings'][a15_0x3759('0x24')]+stationSettings_1[a15_0x3759('0x17')][a15_0x3759('0x18')][a15_0x3759('0x1b')]+this['eventDateParts'][a15_0x3759('0x1c')]+this[a15_0x3759('0x4')]['month']+this['eventDateParts'][a15_0x3759('0x11')]+this['eventDateParts'][a15_0x3759('0x13')]+this[a15_0x3759('0x4')]['minute']+this[a15_0x3759('0x4')]['second'];const _0x7fdffa=stationSettings_1['StationContext'][a15_0x3759('0x18')][a15_0x3759('0x25')]+_0x42e6de;const _0x403ff6=JSON['stringify'](_0xbffcef);_0x53edb7[a15_0x3759('0x26')](_0x7fdffa,_0x403ff6,_0x5c50e7=>{if(_0x5c50e7)return console[a15_0x3759('0x27')](_0x5c50e7);const _0x38a34a=_0x7fdffa+a15_0x3759('0x28');const _0x41ebb7=_0x36a3e6[a15_0x3759('0x29')]();const _0x3f6a5b=_0x53edb7['createReadStream'](_0x7fdffa);const _0x2355e7=_0x53edb7['createWriteStream'](_0x38a34a);_0x3f6a5b[a15_0x3759('0x2a')](_0x41ebb7)[a15_0x3759('0x2a')](_0x2355e7)['on'](a15_0x3759('0x2b'),_0x5c50e7=>{if(_0x5c50e7)return console[a15_0x3759('0x27')](_0x5c50e7);else{if(_0x53edb7[a15_0x3759('0x2c')](_0x7fdffa)){_0x53edb7['unlink'](_0x7fdffa,_0x5c50e7=>{if(_0x5c50e7)throw _0x5c50e7;console[a15_0x3759('0x2d')]('successfully\x20deleted\x20'+_0x7fdffa);});}console[a15_0x3759('0x2d')]('successfully\x20created\x20'+_0x38a34a);return _0x38a34a;}});});}}exports[a15_0x3759('0x2e')]=EventsService;