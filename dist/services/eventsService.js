var a14_0x53ce=['locationParts','latitude','speed','doorStatus','CountingInfo','Out','stringify','writeFile','error','.gz','createGzip','createWriteStream','pipe','unlink','successfully\x20deleted\x20','log','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','getDateParts','eventDate','createJson','createFile','year','month','day','hour','minute','second','-00001','StationContext','driverDocument','settings','routeName','nit','plate'];(function(_0x447293,_0x121e2d){var _0x1dc332=function(_0x53f0fd){while(--_0x53f0fd){_0x447293['push'](_0x447293['shift']());}};_0x1dc332(++_0x121e2d);}(a14_0x53ce,0x1e7));var a14_0x4ca5=function(_0xcb1166,_0x55132e){_0xcb1166=_0xcb1166-0x0;var _0x139d4f=a14_0x53ce[_0xcb1166];return _0x139d4f;};'use strict';Object[a14_0x4ca5('0x0')](exports,a14_0x4ca5('0x1'),{'value':!![]});const stationSettings_1=require(a14_0x4ca5('0x2'));const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require(a14_0x4ca5('0x3'));class EventsService{constructor(_0x3111f7,_0x15092b,_0x2485ef){this[a14_0x4ca5('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x4ca5('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a14_0x4ca5('0x6')]=_0x3111f7;this[a14_0x4ca5('0x7')]=_0x15092b;this[a14_0x4ca5('0x8')]=_0x2485ef;this[a14_0x4ca5('0x6')]['createEvent']=this[a14_0x4ca5('0x9')][a14_0x4ca5('0xa')](this);this[a14_0x4ca5('0x7')]['createEvent']=this[a14_0x4ca5('0x9')]['bind'](this);this[a14_0x4ca5('0x8')]['createEvent']=this[a14_0x4ca5('0x9')][a14_0x4ca5('0xa')](this);this[a14_0x4ca5('0xb')]=new Date();this[a14_0x4ca5('0x5')]=dateUtils_1[a14_0x4ca5('0xc')][a14_0x4ca5('0xd')](this[a14_0x4ca5('0xb')]);}[a14_0x4ca5('0x9')](_0x1aa841){try{this[a14_0x4ca5('0xe')]=new Date();this['eventDateParts']=dateUtils_1[a14_0x4ca5('0xc')]['getDateParts'](this['eventDate']);const _0x5dfb92=this[a14_0x4ca5('0xf')](_0x1aa841);const _0x56b523=this[a14_0x4ca5('0x10')](_0x5dfb92);}catch(_0x5e6e10){console['log'](_0x5e6e10);}}[a14_0x4ca5('0xf')](_0x5159a4){const _0x27ac0e={'idViaje':'1-71767930-'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x11')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x12')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x13')]+'-'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x14')]+this['eventDateParts'][a14_0x4ca5('0x15')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x16')]+a14_0x4ca5('0x17'),'cedula':stationSettings_1[a14_0x4ca5('0x18')]['settings'][a14_0x4ca5('0x19')],'codigoRuta':stationSettings_1[a14_0x4ca5('0x18')][a14_0x4ca5('0x1a')]['routeCode'],'ruta':stationSettings_1[a14_0x4ca5('0x18')][a14_0x4ca5('0x1a')][a14_0x4ca5('0x1b')],'nit':stationSettings_1[a14_0x4ca5('0x18')][a14_0x4ca5('0x1a')][a14_0x4ca5('0x1c')],'placa':stationSettings_1['StationContext'][a14_0x4ca5('0x1a')][a14_0x4ca5('0x1d')],'inicio_viaje':this[a14_0x4ca5('0x4')][a14_0x4ca5('0x13')]+'/'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x12')]+'/'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x11')]+'\x20'+this['eventDateParts'][a14_0x4ca5('0x14')]+':'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x15')]+':'+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a14_0x4ca5('0x4')][a14_0x4ca5('0x11')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x12')]+this['eventDateParts'][a14_0x4ca5('0x13')],'hora':this['eventDateParts'][a14_0x4ca5('0x14')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x15')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x16')],'dop':this[a14_0x4ca5('0x6')][a14_0x4ca5('0x1e')]['hdop'],'longitud':this[a14_0x4ca5('0x6')][a14_0x4ca5('0x1e')]['longitude'],'latitud':this['gpsService'][a14_0x4ca5('0x1e')][a14_0x4ca5('0x1f')],'velocidad':this[a14_0x4ca5('0x6')][a14_0x4ca5('0x1e')][a14_0x4ca5('0x20')],'puerta':[{'estado':this[a14_0x4ca5('0x7')][a14_0x4ca5('0x21')],'idPuerta':0x0,'ingresos':_0x5159a4!=null?_0x5159a4[a14_0x4ca5('0x22')][0x0]['In']:0x0,'salidas':_0x5159a4!=null?_0x5159a4[a14_0x4ca5('0x22')][0x0][a14_0x4ca5('0x23')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x27ac0e;}[a14_0x4ca5('0x10')](_0x8f7085){const _0x265f8d=require('fs');const _0x443707=require('zlib');const _0x1c78ba=stationSettings_1['StationContext'][a14_0x4ca5('0x1a')][a14_0x4ca5('0x1c')]+stationSettings_1[a14_0x4ca5('0x18')][a14_0x4ca5('0x1a')][a14_0x4ca5('0x1d')]+this[a14_0x4ca5('0x4')]['day']+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x12')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x11')]+this[a14_0x4ca5('0x4')]['hour']+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x15')]+this[a14_0x4ca5('0x4')][a14_0x4ca5('0x16')];const _0x2a0c46=stationSettings_1['StationContext']['settings']['eventFileFolder']+_0x1c78ba;const _0xbaa9f=JSON[a14_0x4ca5('0x24')](_0x8f7085);_0x265f8d[a14_0x4ca5('0x25')](_0x2a0c46,_0xbaa9f,_0x544e58=>{if(_0x544e58)return console[a14_0x4ca5('0x26')](_0x544e58);const _0x1a0159=_0x2a0c46+a14_0x4ca5('0x27');const _0x2574fa=_0x443707[a14_0x4ca5('0x28')]();const _0x5abb67=_0x265f8d['createReadStream'](_0x2a0c46);const _0x185467=_0x265f8d[a14_0x4ca5('0x29')](_0x1a0159);_0x5abb67[a14_0x4ca5('0x2a')](_0x2574fa)['pipe'](_0x185467)['on']('finish',_0x544e58=>{if(_0x544e58)return console[a14_0x4ca5('0x26')](_0x544e58);else{if(_0x265f8d['existsSync'](_0x2a0c46)){_0x265f8d[a14_0x4ca5('0x2b')](_0x2a0c46,_0x544e58=>{if(_0x544e58)throw _0x544e58;console['log'](a14_0x4ca5('0x2c')+_0x2a0c46);});}console[a14_0x4ca5('0x2d')]('successfully\x20created\x20'+_0x1a0159);return _0x1a0159;}});});}}exports[a14_0x4ca5('0x2e')]=EventsService;