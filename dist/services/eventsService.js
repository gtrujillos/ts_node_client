var a15_0x2157=['second','locationParts','longitude','latitude','speed','CountingInfo','Out','zlib','nit','stringify','error','.gz','createGzip','createReadStream','pipe','finish','existsSync','unlink','successfully\x20deleted\x20','EventsService','../infrastructure/utils/dateUtils','request','startDateParts','sensorsService','countingWebSocketService','gpsService','createEvent','bind','DateUtils','getDateParts','startDate','eventDate','eventDateParts','createJson','createFile','log','1-71767930-','year','day','hour','minute','-00001','StationContext','settings','driverDocument','routeCode','plate','month'];(function(_0x1ef1fb,_0xcf9a6b){var _0x333acc=function(_0x556563){while(--_0x556563){_0x1ef1fb['push'](_0x1ef1fb['shift']());}};_0x333acc(++_0xcf9a6b);}(a15_0x2157,0xd4));var a15_0x27e9=function(_0xcb16d8,_0x57015b){_0xcb16d8=_0xcb16d8-0x0;var _0x52cf63=a15_0x2157[_0xcb16d8];return _0x52cf63;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require(a15_0x27e9('0x0'));const fs=require('fs');const request=require(a15_0x27e9('0x1'));class EventsService{constructor(_0x34b7c6,_0x159877,_0x46a573){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x27e9('0x2')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x34b7c6;this[a15_0x27e9('0x3')]=_0x159877;this[a15_0x27e9('0x4')]=_0x46a573;this[a15_0x27e9('0x5')]['createEvent']=this[a15_0x27e9('0x6')][a15_0x27e9('0x7')](this);this['sensorsService'][a15_0x27e9('0x6')]=this[a15_0x27e9('0x6')][a15_0x27e9('0x7')](this);this[a15_0x27e9('0x4')][a15_0x27e9('0x6')]=this[a15_0x27e9('0x6')][a15_0x27e9('0x7')](this);this['startDate']=new Date();this[a15_0x27e9('0x2')]=dateUtils_1[a15_0x27e9('0x8')][a15_0x27e9('0x9')](this[a15_0x27e9('0xa')]);}['createEvent'](_0x194c84){try{this[a15_0x27e9('0xb')]=new Date();this[a15_0x27e9('0xc')]=dateUtils_1[a15_0x27e9('0x8')][a15_0x27e9('0x9')](this[a15_0x27e9('0xb')]);const _0x2336be=this[a15_0x27e9('0xd')](_0x194c84);const _0x375fa3=this[a15_0x27e9('0xe')](_0x2336be);}catch(_0x2a6cae){console[a15_0x27e9('0xf')](_0x2a6cae);}}[a15_0x27e9('0xd')](_0x15df04){const _0x8338f8={'idViaje':a15_0x27e9('0x10')+this['eventDateParts'][a15_0x27e9('0x11')]+this['eventDateParts']['month']+this[a15_0x27e9('0xc')][a15_0x27e9('0x12')]+'-'+this['eventDateParts'][a15_0x27e9('0x13')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x14')]+this[a15_0x27e9('0xc')]['second']+a15_0x27e9('0x15'),'cedula':stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')][a15_0x27e9('0x18')],'codigoRuta':stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')][a15_0x27e9('0x19')],'ruta':stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')]['routeName'],'nit':stationSettings_1['StationContext']['settings']['nit'],'placa':stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')][a15_0x27e9('0x1a')],'inicio_viaje':this['eventDateParts'][a15_0x27e9('0x12')]+'/'+this[a15_0x27e9('0xc')][a15_0x27e9('0x1b')]+'/'+this[a15_0x27e9('0xc')][a15_0x27e9('0x11')]+'\x20'+this[a15_0x27e9('0xc')][a15_0x27e9('0x13')]+':'+this[a15_0x27e9('0xc')][a15_0x27e9('0x14')]+':'+this[a15_0x27e9('0xc')][a15_0x27e9('0x1c')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this['eventDateParts']['year']+this[a15_0x27e9('0xc')]['month']+this['eventDateParts'][a15_0x27e9('0x12')],'hora':this['eventDateParts'][a15_0x27e9('0x13')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x14')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x1c')],'dop':this['gpsService'][a15_0x27e9('0x1d')]['hdop'],'longitud':this[a15_0x27e9('0x5')][a15_0x27e9('0x1d')][a15_0x27e9('0x1e')],'latitud':this['gpsService'][a15_0x27e9('0x1d')][a15_0x27e9('0x1f')],'velocidad':this['gpsService'][a15_0x27e9('0x1d')][a15_0x27e9('0x20')],'puerta':[{'estado':this[a15_0x27e9('0x3')]['doorStatus'],'idPuerta':0x0,'ingresos':_0x15df04!=null?_0x15df04[a15_0x27e9('0x21')][0x0]['In']:0x0,'salidas':_0x15df04!=null?_0x15df04[a15_0x27e9('0x21')][0x0][a15_0x27e9('0x22')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x8338f8;}[a15_0x27e9('0xe')](_0x285932){const _0x40ce94=require('fs');const _0x311485=require(a15_0x27e9('0x23'));const _0x2707df=stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')][a15_0x27e9('0x24')]+stationSettings_1['StationContext'][a15_0x27e9('0x17')][a15_0x27e9('0x1a')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x12')]+this['eventDateParts']['month']+this['eventDateParts'][a15_0x27e9('0x11')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x13')]+this[a15_0x27e9('0xc')][a15_0x27e9('0x14')]+this['eventDateParts'][a15_0x27e9('0x1c')];const _0xe1cdd9=stationSettings_1[a15_0x27e9('0x16')][a15_0x27e9('0x17')]['eventFileFolder']+_0x2707df;const _0x53b686=JSON[a15_0x27e9('0x25')](_0x285932);_0x40ce94['writeFile'](_0xe1cdd9,_0x53b686,_0x44ae5e=>{if(_0x44ae5e)return console[a15_0x27e9('0x26')](_0x44ae5e);const _0x436fc0=_0xe1cdd9+a15_0x27e9('0x27');const _0x5ce922=_0x311485[a15_0x27e9('0x28')]();const _0x1d967a=_0x40ce94[a15_0x27e9('0x29')](_0xe1cdd9);const _0x19c964=_0x40ce94['createWriteStream'](_0x436fc0);_0x1d967a[a15_0x27e9('0x2a')](_0x5ce922)[a15_0x27e9('0x2a')](_0x19c964)['on'](a15_0x27e9('0x2b'),_0x44ae5e=>{if(_0x44ae5e)return console[a15_0x27e9('0x26')](_0x44ae5e);else{if(_0x40ce94[a15_0x27e9('0x2c')](_0xe1cdd9)){_0x40ce94[a15_0x27e9('0x2d')](_0xe1cdd9,_0x44ae5e=>{if(_0x44ae5e)throw _0x44ae5e;console[a15_0x27e9('0xf')](a15_0x27e9('0x2e')+_0xe1cdd9);});}console['log']('successfully\x20created\x20'+_0x436fc0);return _0x436fc0;}});});}}exports[a15_0x27e9('0x2f')]=EventsService;