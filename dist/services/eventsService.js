var a15_0x5070=['CountingInfo','Out','createFile','zlib','plate','eventFileFolder','.gz','createGzip','createReadStream','pipe','finish','existsSync','unlink','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','startDate','DateUtils','getDateParts','eventDate','createJson','log','1-71767930-','month','day','hour','minute','second','-00001','driverDocument','StationContext','routeCode','routeName','settings','nit','year','locationParts','speed','doorStatus'];(function(_0x58e312,_0x1bde04){var _0x122b86=function(_0x14e282){while(--_0x14e282){_0x58e312['push'](_0x58e312['shift']());}};_0x122b86(++_0x1bde04);}(a15_0x5070,0x1a8));var a15_0x530d=function(_0x1b45c1,_0x4ce9a7){_0x1b45c1=_0x1b45c1-0x0;var _0x55ef77=a15_0x5070[_0x1b45c1];return _0x55ef77;};'use strict';Object[a15_0x530d('0x0')](exports,a15_0x530d('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x530d('0x2'));const dateUtils_1=require(a15_0x530d('0x3'));const fs=require('fs');const request=require(a15_0x530d('0x4'));class EventsService{constructor(_0x125efe,_0x2999c2,_0x56974b){this[a15_0x530d('0x5')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x530d('0x6')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x530d('0x7')]=_0x125efe;this[a15_0x530d('0x8')]=_0x2999c2;this[a15_0x530d('0x9')]=_0x56974b;this[a15_0x530d('0x7')][a15_0x530d('0xa')]=this['createEvent'][a15_0x530d('0xb')](this);this[a15_0x530d('0x8')][a15_0x530d('0xa')]=this[a15_0x530d('0xa')]['bind'](this);this['countingWebSocketService'][a15_0x530d('0xa')]=this[a15_0x530d('0xa')][a15_0x530d('0xb')](this);this[a15_0x530d('0xc')]=new Date();this[a15_0x530d('0x6')]=dateUtils_1[a15_0x530d('0xd')][a15_0x530d('0xe')](this[a15_0x530d('0xc')]);}[a15_0x530d('0xa')](_0x59e55d){try{this['eventDate']=new Date();this[a15_0x530d('0x5')]=dateUtils_1[a15_0x530d('0xd')][a15_0x530d('0xe')](this[a15_0x530d('0xf')]);const _0x3941ed=this[a15_0x530d('0x10')](_0x59e55d);const _0x5a115f=this['createFile'](_0x3941ed);}catch(_0xcdcf61){console[a15_0x530d('0x11')](_0xcdcf61);}}[a15_0x530d('0x10')](_0x147a1e){const _0x2e107c={'idViaje':a15_0x530d('0x12')+this['eventDateParts']['year']+this[a15_0x530d('0x5')][a15_0x530d('0x13')]+this[a15_0x530d('0x5')][a15_0x530d('0x14')]+'-'+this[a15_0x530d('0x5')][a15_0x530d('0x15')]+this[a15_0x530d('0x5')][a15_0x530d('0x16')]+this['eventDateParts'][a15_0x530d('0x17')]+a15_0x530d('0x18'),'cedula':stationSettings_1['StationContext']['settings'][a15_0x530d('0x19')],'codigoRuta':stationSettings_1[a15_0x530d('0x1a')]['settings'][a15_0x530d('0x1b')],'ruta':stationSettings_1['StationContext']['settings'][a15_0x530d('0x1c')],'nit':stationSettings_1['StationContext'][a15_0x530d('0x1d')][a15_0x530d('0x1e')],'placa':stationSettings_1[a15_0x530d('0x1a')][a15_0x530d('0x1d')]['plate'],'inicio_viaje':this[a15_0x530d('0x5')][a15_0x530d('0x14')]+'/'+this['eventDateParts']['month']+'/'+this[a15_0x530d('0x5')][a15_0x530d('0x1f')]+'\x20'+this['eventDateParts'][a15_0x530d('0x15')]+':'+this[a15_0x530d('0x5')]['minute']+':'+this[a15_0x530d('0x5')]['second'],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x530d('0x5')][a15_0x530d('0x1f')]+this['eventDateParts'][a15_0x530d('0x13')]+this[a15_0x530d('0x5')]['day'],'hora':this['eventDateParts'][a15_0x530d('0x15')]+this[a15_0x530d('0x5')][a15_0x530d('0x16')]+this[a15_0x530d('0x5')][a15_0x530d('0x17')],'dop':this['gpsService'][a15_0x530d('0x20')]['hdop'],'longitud':this[a15_0x530d('0x7')][a15_0x530d('0x20')]['longitude'],'latitud':this[a15_0x530d('0x7')]['locationParts']['latitude'],'velocidad':this['gpsService'][a15_0x530d('0x20')][a15_0x530d('0x21')],'puerta':[{'estado':this[a15_0x530d('0x8')][a15_0x530d('0x22')],'idPuerta':0x0,'ingresos':_0x147a1e!=null?_0x147a1e['CountingInfo'][0x0]['In']:0x0,'salidas':_0x147a1e!=null?_0x147a1e[a15_0x530d('0x23')][0x0][a15_0x530d('0x24')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x2e107c;}[a15_0x530d('0x25')](_0x141be3){const _0x29755c=require('fs');const _0x251135=require(a15_0x530d('0x26'));const _0x4b9966=stationSettings_1[a15_0x530d('0x1a')][a15_0x530d('0x1d')][a15_0x530d('0x1e')]+stationSettings_1[a15_0x530d('0x1a')][a15_0x530d('0x1d')][a15_0x530d('0x27')]+this[a15_0x530d('0x5')]['day']+this[a15_0x530d('0x5')][a15_0x530d('0x13')]+this[a15_0x530d('0x5')][a15_0x530d('0x1f')]+this['eventDateParts'][a15_0x530d('0x15')]+this['eventDateParts'][a15_0x530d('0x16')]+this[a15_0x530d('0x5')][a15_0x530d('0x17')];const _0x2d9e76=stationSettings_1[a15_0x530d('0x1a')][a15_0x530d('0x1d')][a15_0x530d('0x28')]+_0x4b9966;const _0x2c5ae0=JSON['stringify'](_0x141be3);_0x29755c['writeFile'](_0x2d9e76,_0x2c5ae0,_0x334c11=>{if(_0x334c11)return console['error'](_0x334c11);const _0x3fb7dc=_0x2d9e76+a15_0x530d('0x29');const _0xf2f1a3=_0x251135[a15_0x530d('0x2a')]();const _0x454601=_0x29755c[a15_0x530d('0x2b')](_0x2d9e76);const _0x43f2b7=_0x29755c['createWriteStream'](_0x3fb7dc);_0x454601['pipe'](_0xf2f1a3)[a15_0x530d('0x2c')](_0x43f2b7)['on'](a15_0x530d('0x2d'),_0x334c11=>{if(_0x334c11)return console['error'](_0x334c11);else{if(_0x29755c[a15_0x530d('0x2e')](_0x2d9e76)){_0x29755c[a15_0x530d('0x2f')](_0x2d9e76,_0x334c11=>{if(_0x334c11)throw _0x334c11;console[a15_0x530d('0x11')](a15_0x530d('0x30')+_0x2d9e76);});}console[a15_0x530d('0x11')](a15_0x530d('0x31')+_0x3fb7dc);return _0x3fb7dc;}});});}}exports[a15_0x530d('0x32')]=EventsService;