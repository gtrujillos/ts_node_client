var a15_0x5076=['finish','successfully\x20deleted\x20','EventsService','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','request','eventDateParts','startDateParts','gpsService','sensorsService','countingWebSocketService','createEvent','bind','DateUtils','getDateParts','eventDate','createJson','createFile','log','1-71767930-','year','month','day','hour','minute','second','StationContext','driverDocument','settings','routeName','nit','plate','hdop','longitude','locationParts','latitude','speed','doorStatus','CountingInfo','Out','zlib','eventFileFolder','stringify','error','.gz','createGzip','createReadStream','createWriteStream','pipe'];(function(_0x4b39ac,_0x481c26){var _0x3f22c9=function(_0x4a16e8){while(--_0x4a16e8){_0x4b39ac['push'](_0x4b39ac['shift']());}};_0x3f22c9(++_0x481c26);}(a15_0x5076,0x65));var a15_0x5afe=function(_0x2d0c94,_0x461a38){_0x2d0c94=_0x2d0c94-0x0;var _0x3b44d9=a15_0x5076[_0x2d0c94];return _0x3b44d9;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const stationSettings_1=require(a15_0x5afe('0x0'));const dateUtils_1=require(a15_0x5afe('0x1'));const fs=require('fs');const request=require(a15_0x5afe('0x2'));class EventsService{constructor(_0x2ad804,_0x4b646a,_0x28b532){this[a15_0x5afe('0x3')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x5afe('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x5afe('0x5')]=_0x2ad804;this[a15_0x5afe('0x6')]=_0x4b646a;this[a15_0x5afe('0x7')]=_0x28b532;this[a15_0x5afe('0x5')]['createEvent']=this[a15_0x5afe('0x8')][a15_0x5afe('0x9')](this);this[a15_0x5afe('0x6')][a15_0x5afe('0x8')]=this[a15_0x5afe('0x8')]['bind'](this);this[a15_0x5afe('0x7')][a15_0x5afe('0x8')]=this[a15_0x5afe('0x8')][a15_0x5afe('0x9')](this);this['startDate']=new Date();this['startDateParts']=dateUtils_1[a15_0x5afe('0xa')][a15_0x5afe('0xb')](this['startDate']);}[a15_0x5afe('0x8')](_0x404f3d){try{this['eventDate']=new Date();this[a15_0x5afe('0x3')]=dateUtils_1['DateUtils'][a15_0x5afe('0xb')](this[a15_0x5afe('0xc')]);const _0x503237=this[a15_0x5afe('0xd')](_0x404f3d);const _0x299f44=this[a15_0x5afe('0xe')](_0x503237);}catch(_0x46806d){console[a15_0x5afe('0xf')](_0x46806d);}}[a15_0x5afe('0xd')](_0x119d7f){const _0x2c3561={'idViaje':a15_0x5afe('0x10')+this['eventDateParts'][a15_0x5afe('0x11')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x12')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x13')]+'-'+this['eventDateParts'][a15_0x5afe('0x14')]+this['eventDateParts'][a15_0x5afe('0x15')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x16')]+'-00001','cedula':stationSettings_1[a15_0x5afe('0x17')]['settings'][a15_0x5afe('0x18')],'codigoRuta':stationSettings_1[a15_0x5afe('0x17')][a15_0x5afe('0x19')]['routeCode'],'ruta':stationSettings_1[a15_0x5afe('0x17')]['settings'][a15_0x5afe('0x1a')],'nit':stationSettings_1[a15_0x5afe('0x17')][a15_0x5afe('0x19')][a15_0x5afe('0x1b')],'placa':stationSettings_1['StationContext'][a15_0x5afe('0x19')][a15_0x5afe('0x1c')],'inicio_viaje':this[a15_0x5afe('0x3')]['day']+'/'+this[a15_0x5afe('0x3')][a15_0x5afe('0x12')]+'/'+this[a15_0x5afe('0x3')][a15_0x5afe('0x11')]+'\x20'+this[a15_0x5afe('0x3')]['hour']+':'+this[a15_0x5afe('0x3')][a15_0x5afe('0x15')]+':'+this[a15_0x5afe('0x3')][a15_0x5afe('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x5afe('0x3')][a15_0x5afe('0x11')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x12')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x13')],'hora':this[a15_0x5afe('0x3')][a15_0x5afe('0x14')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x15')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x16')],'dop':this[a15_0x5afe('0x5')]['locationParts'][a15_0x5afe('0x1d')],'longitud':this[a15_0x5afe('0x5')]['locationParts'][a15_0x5afe('0x1e')],'latitud':this[a15_0x5afe('0x5')][a15_0x5afe('0x1f')][a15_0x5afe('0x20')],'velocidad':this[a15_0x5afe('0x5')]['locationParts'][a15_0x5afe('0x21')],'puerta':[{'estado':this['sensorsService'][a15_0x5afe('0x22')],'idPuerta':0x0,'ingresos':_0x119d7f!=null?_0x119d7f[a15_0x5afe('0x23')][0x0]['In']:0x0,'salidas':_0x119d7f!=null?_0x119d7f[a15_0x5afe('0x23')][0x0][a15_0x5afe('0x24')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x2c3561;}[a15_0x5afe('0xe')](_0x287283){const _0x5121b6=require('fs');const _0x2bdc1d=require(a15_0x5afe('0x25'));const _0x5091c8=stationSettings_1[a15_0x5afe('0x17')]['settings'][a15_0x5afe('0x1b')]+stationSettings_1['StationContext']['settings'][a15_0x5afe('0x1c')]+this['eventDateParts'][a15_0x5afe('0x13')]+this['eventDateParts'][a15_0x5afe('0x12')]+this[a15_0x5afe('0x3')][a15_0x5afe('0x11')]+this[a15_0x5afe('0x3')]['hour']+this[a15_0x5afe('0x3')]['minute']+this['eventDateParts'][a15_0x5afe('0x16')];const _0x3a9383=stationSettings_1['StationContext'][a15_0x5afe('0x19')][a15_0x5afe('0x26')]+_0x5091c8;const _0x254d28=JSON[a15_0x5afe('0x27')](_0x287283);_0x5121b6['writeFile'](_0x3a9383,_0x254d28,_0x517726=>{if(_0x517726)return console[a15_0x5afe('0x28')](_0x517726);const _0x250037=_0x3a9383+a15_0x5afe('0x29');const _0x291d18=_0x2bdc1d[a15_0x5afe('0x2a')]();const _0x3f1d70=_0x5121b6[a15_0x5afe('0x2b')](_0x3a9383);const _0x5118b6=_0x5121b6[a15_0x5afe('0x2c')](_0x250037);_0x3f1d70[a15_0x5afe('0x2d')](_0x291d18)['pipe'](_0x5118b6)['on'](a15_0x5afe('0x2e'),_0x517726=>{if(_0x517726)return console['error'](_0x517726);else{if(_0x5121b6['existsSync'](_0x3a9383)){_0x5121b6['unlink'](_0x3a9383,_0x517726=>{if(_0x517726)throw _0x517726;console['log'](a15_0x5afe('0x2f')+_0x3a9383);});}console['log']('successfully\x20created\x20'+_0x250037);return _0x250037;}});});}}exports[a15_0x5afe('0x30')]=EventsService;