var a15_0x3499=['createFile','zlib','stringify','writeFile','error','.gz','createGzip','createWriteStream','pipe','existsSync','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','eventDateParts','sensorsService','countingWebSocketService','gpsService','createEvent','bind','startDate','startDateParts','DateUtils','getDateParts','eventDate','log','1-71767930-','year','month','day','hour','minute','second','-00001','StationContext','driverDocument','routeCode','settings','routeName','nit','plate','locationParts','hdop','longitude','latitude','speed','CountingInfo','Out'];(function(_0x16c442,_0x2a5900){var _0x14c97e=function(_0x3a720){while(--_0x3a720){_0x16c442['push'](_0x16c442['shift']());}};_0x14c97e(++_0x2a5900);}(a15_0x3499,0x1c6));var a15_0x2029=function(_0x46a414,_0x364237){_0x46a414=_0x46a414-0x0;var _0x5cb7c6=a15_0x3499[_0x46a414];return _0x5cb7c6;};'use strict';Object[a15_0x2029('0x0')](exports,a15_0x2029('0x1'),{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require('../infrastructure/utils/dateUtils');const fs=require('fs');const request=require('request');class EventsService{constructor(_0x2eb47a,_0xf5ea7f,_0x21ff44){this[a15_0x2029('0x2')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x2eb47a;this[a15_0x2029('0x3')]=_0xf5ea7f;this[a15_0x2029('0x4')]=_0x21ff44;this[a15_0x2029('0x5')][a15_0x2029('0x6')]=this[a15_0x2029('0x6')][a15_0x2029('0x7')](this);this[a15_0x2029('0x3')][a15_0x2029('0x6')]=this[a15_0x2029('0x6')][a15_0x2029('0x7')](this);this[a15_0x2029('0x4')][a15_0x2029('0x6')]=this[a15_0x2029('0x6')][a15_0x2029('0x7')](this);this[a15_0x2029('0x8')]=new Date();this[a15_0x2029('0x9')]=dateUtils_1[a15_0x2029('0xa')][a15_0x2029('0xb')](this[a15_0x2029('0x8')]);}['createEvent'](_0x2f8cd8){try{this[a15_0x2029('0xc')]=new Date();this[a15_0x2029('0x2')]=dateUtils_1[a15_0x2029('0xa')][a15_0x2029('0xb')](this[a15_0x2029('0xc')]);const _0x293e19=this['createJson'](_0x2f8cd8);const _0x5930f2=this['createFile'](_0x293e19);}catch(_0x40ab29){console[a15_0x2029('0xd')](_0x40ab29);}}['createJson'](_0x40cb7b){const _0x1106f9={'idViaje':a15_0x2029('0xe')+this[a15_0x2029('0x2')][a15_0x2029('0xf')]+this[a15_0x2029('0x2')][a15_0x2029('0x10')]+this[a15_0x2029('0x2')][a15_0x2029('0x11')]+'-'+this['eventDateParts'][a15_0x2029('0x12')]+this[a15_0x2029('0x2')][a15_0x2029('0x13')]+this[a15_0x2029('0x2')][a15_0x2029('0x14')]+a15_0x2029('0x15'),'cedula':stationSettings_1[a15_0x2029('0x16')]['settings'][a15_0x2029('0x17')],'codigoRuta':stationSettings_1['StationContext']['settings'][a15_0x2029('0x18')],'ruta':stationSettings_1[a15_0x2029('0x16')][a15_0x2029('0x19')][a15_0x2029('0x1a')],'nit':stationSettings_1['StationContext'][a15_0x2029('0x19')][a15_0x2029('0x1b')],'placa':stationSettings_1[a15_0x2029('0x16')][a15_0x2029('0x19')][a15_0x2029('0x1c')],'inicio_viaje':this[a15_0x2029('0x2')][a15_0x2029('0x11')]+'/'+this[a15_0x2029('0x2')][a15_0x2029('0x10')]+'/'+this['eventDateParts']['year']+'\x20'+this[a15_0x2029('0x2')][a15_0x2029('0x12')]+':'+this['eventDateParts'][a15_0x2029('0x13')]+':'+this['eventDateParts'][a15_0x2029('0x14')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x2029('0x2')][a15_0x2029('0xf')]+this[a15_0x2029('0x2')][a15_0x2029('0x10')]+this[a15_0x2029('0x2')][a15_0x2029('0x11')],'hora':this['eventDateParts'][a15_0x2029('0x12')]+this[a15_0x2029('0x2')][a15_0x2029('0x13')]+this[a15_0x2029('0x2')][a15_0x2029('0x14')],'dop':this[a15_0x2029('0x5')][a15_0x2029('0x1d')][a15_0x2029('0x1e')],'longitud':this[a15_0x2029('0x5')][a15_0x2029('0x1d')][a15_0x2029('0x1f')],'latitud':this[a15_0x2029('0x5')]['locationParts'][a15_0x2029('0x20')],'velocidad':this['gpsService'][a15_0x2029('0x1d')][a15_0x2029('0x21')],'puerta':[{'estado':this[a15_0x2029('0x3')]['doorStatus'],'idPuerta':0x0,'ingresos':_0x40cb7b!=null?_0x40cb7b[a15_0x2029('0x22')][0x0]['In']:0x0,'salidas':_0x40cb7b!=null?_0x40cb7b[a15_0x2029('0x22')][0x0][a15_0x2029('0x23')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x1106f9;}[a15_0x2029('0x24')](_0x5f57e8){const _0x1f27b6=require('fs');const _0x245722=require(a15_0x2029('0x25'));const _0x4bf85e=stationSettings_1[a15_0x2029('0x16')][a15_0x2029('0x19')][a15_0x2029('0x1b')]+stationSettings_1[a15_0x2029('0x16')][a15_0x2029('0x19')][a15_0x2029('0x1c')]+this[a15_0x2029('0x2')][a15_0x2029('0x11')]+this[a15_0x2029('0x2')]['month']+this[a15_0x2029('0x2')][a15_0x2029('0xf')]+this[a15_0x2029('0x2')][a15_0x2029('0x12')]+this[a15_0x2029('0x2')][a15_0x2029('0x13')]+this['eventDateParts'][a15_0x2029('0x14')];const _0x4f7600=stationSettings_1[a15_0x2029('0x16')]['settings']['eventFileFolder']+_0x4bf85e;const _0x20aff1=JSON[a15_0x2029('0x26')](_0x5f57e8);_0x1f27b6[a15_0x2029('0x27')](_0x4f7600,_0x20aff1,_0x520a47=>{if(_0x520a47)return console[a15_0x2029('0x28')](_0x520a47);const _0x5e92f3=_0x4f7600+a15_0x2029('0x29');const _0x5db082=_0x245722[a15_0x2029('0x2a')]();const _0x9b75c4=_0x1f27b6['createReadStream'](_0x4f7600);const _0x4ee3d0=_0x1f27b6[a15_0x2029('0x2b')](_0x5e92f3);_0x9b75c4[a15_0x2029('0x2c')](_0x5db082)[a15_0x2029('0x2c')](_0x4ee3d0)['on']('finish',_0x520a47=>{if(_0x520a47)return console[a15_0x2029('0x28')](_0x520a47);else{if(_0x1f27b6[a15_0x2029('0x2d')](_0x4f7600)){_0x1f27b6['unlink'](_0x4f7600,_0x520a47=>{if(_0x520a47)throw _0x520a47;console[a15_0x2029('0xd')](a15_0x2029('0x2e')+_0x4f7600);});}console[a15_0x2029('0xd')](a15_0x2029('0x2f')+_0x5e92f3);return _0x5e92f3;}});});}}exports[a15_0x2029('0x30')]=EventsService;