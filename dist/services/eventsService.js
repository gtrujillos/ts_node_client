var a15_0x162b=['hdop','locationParts','longitude','latitude','speed','doorStatus','CountingInfo','eventFileFolder','stringify','writeFile','error','.gz','createGzip','createWriteStream','pipe','existsSync','successfully\x20created\x20','defineProperty','__esModule','../infrastructure/utils/dateUtils','request','startDateParts','gpsService','sensorsService','createEvent','bind','countingWebSocketService','startDate','DateUtils','getDateParts','eventDateParts','eventDate','createJson','createFile','log','1-71767930-','year','month','day','hour','minute','-00001','StationContext','settings','driverDocument','routeCode','routeName','nit','plate','second'];(function(_0x7ad1a3,_0x46aac7){var _0x1c746a=function(_0x5baa77){while(--_0x5baa77){_0x7ad1a3['push'](_0x7ad1a3['shift']());}};_0x1c746a(++_0x46aac7);}(a15_0x162b,0xa7));var a15_0x53a4=function(_0x4d63bc,_0x5d5be2){_0x4d63bc=_0x4d63bc-0x0;var _0x529d0a=a15_0x162b[_0x4d63bc];return _0x529d0a;};'use strict';Object[a15_0x53a4('0x0')](exports,a15_0x53a4('0x1'),{'value':!![]});const stationSettings_1=require('../infrastructure/stationSettings');const dateUtils_1=require(a15_0x53a4('0x2'));const fs=require('fs');const request=require(a15_0x53a4('0x3'));class EventsService{constructor(_0x506657,_0x49c6a0,_0x4da7cc){this['eventDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x53a4('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this[a15_0x53a4('0x5')]=_0x506657;this[a15_0x53a4('0x6')]=_0x49c6a0;this['countingWebSocketService']=_0x4da7cc;this[a15_0x53a4('0x5')][a15_0x53a4('0x7')]=this[a15_0x53a4('0x7')][a15_0x53a4('0x8')](this);this[a15_0x53a4('0x6')][a15_0x53a4('0x7')]=this['createEvent'][a15_0x53a4('0x8')](this);this[a15_0x53a4('0x9')][a15_0x53a4('0x7')]=this[a15_0x53a4('0x7')][a15_0x53a4('0x8')](this);this[a15_0x53a4('0xa')]=new Date();this['startDateParts']=dateUtils_1[a15_0x53a4('0xb')][a15_0x53a4('0xc')](this[a15_0x53a4('0xa')]);}[a15_0x53a4('0x7')](_0x5b7eb8){try{this['eventDate']=new Date();this[a15_0x53a4('0xd')]=dateUtils_1['DateUtils'][a15_0x53a4('0xc')](this[a15_0x53a4('0xe')]);const _0x2daa43=this[a15_0x53a4('0xf')](_0x5b7eb8);const _0x5c6c83=this[a15_0x53a4('0x10')](_0x2daa43);}catch(_0x6f3f7b){console[a15_0x53a4('0x11')](_0x6f3f7b);}}[a15_0x53a4('0xf')](_0x5b9325){const _0x14a3ac={'idViaje':a15_0x53a4('0x12')+this['eventDateParts'][a15_0x53a4('0x13')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x14')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x15')]+'-'+this[a15_0x53a4('0xd')][a15_0x53a4('0x16')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x17')]+this[a15_0x53a4('0xd')]['second']+a15_0x53a4('0x18'),'cedula':stationSettings_1[a15_0x53a4('0x19')][a15_0x53a4('0x1a')][a15_0x53a4('0x1b')],'codigoRuta':stationSettings_1[a15_0x53a4('0x19')][a15_0x53a4('0x1a')][a15_0x53a4('0x1c')],'ruta':stationSettings_1[a15_0x53a4('0x19')]['settings'][a15_0x53a4('0x1d')],'nit':stationSettings_1[a15_0x53a4('0x19')][a15_0x53a4('0x1a')][a15_0x53a4('0x1e')],'placa':stationSettings_1['StationContext'][a15_0x53a4('0x1a')][a15_0x53a4('0x1f')],'inicio_viaje':this[a15_0x53a4('0xd')][a15_0x53a4('0x15')]+'/'+this[a15_0x53a4('0xd')][a15_0x53a4('0x14')]+'/'+this['eventDateParts'][a15_0x53a4('0x13')]+'\x20'+this['eventDateParts'][a15_0x53a4('0x16')]+':'+this[a15_0x53a4('0xd')][a15_0x53a4('0x17')]+':'+this[a15_0x53a4('0xd')][a15_0x53a4('0x20')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x53a4('0xd')]['year']+this['eventDateParts'][a15_0x53a4('0x14')]+this[a15_0x53a4('0xd')]['day'],'hora':this['eventDateParts'][a15_0x53a4('0x16')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x17')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x20')],'dop':this[a15_0x53a4('0x5')]['locationParts'][a15_0x53a4('0x21')],'longitud':this[a15_0x53a4('0x5')][a15_0x53a4('0x22')][a15_0x53a4('0x23')],'latitud':this[a15_0x53a4('0x5')][a15_0x53a4('0x22')][a15_0x53a4('0x24')],'velocidad':this['gpsService']['locationParts'][a15_0x53a4('0x25')],'puerta':[{'estado':this[a15_0x53a4('0x6')][a15_0x53a4('0x26')],'idPuerta':0x0,'ingresos':_0x5b9325!=null?_0x5b9325['CountingInfo'][0x0]['In']:0x0,'salidas':_0x5b9325!=null?_0x5b9325[a15_0x53a4('0x27')][0x0]['Out']:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x14a3ac;}['createFile'](_0x90e8a3){const _0x22b4a9=require('fs');const _0x1076c4=require('zlib');const _0x1121a0=stationSettings_1[a15_0x53a4('0x19')]['settings'][a15_0x53a4('0x1e')]+stationSettings_1['StationContext'][a15_0x53a4('0x1a')]['plate']+this['eventDateParts'][a15_0x53a4('0x15')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x14')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x13')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x16')]+this['eventDateParts'][a15_0x53a4('0x17')]+this[a15_0x53a4('0xd')][a15_0x53a4('0x20')];const _0x3f8296=stationSettings_1[a15_0x53a4('0x19')]['settings'][a15_0x53a4('0x28')]+_0x1121a0;const _0x324774=JSON[a15_0x53a4('0x29')](_0x90e8a3);_0x22b4a9[a15_0x53a4('0x2a')](_0x3f8296,_0x324774,_0x1b5ab9=>{if(_0x1b5ab9)return console[a15_0x53a4('0x2b')](_0x1b5ab9);const _0x2b60d5=_0x3f8296+a15_0x53a4('0x2c');const _0x569531=_0x1076c4[a15_0x53a4('0x2d')]();const _0x3fcb7f=_0x22b4a9['createReadStream'](_0x3f8296);const _0x3c15d4=_0x22b4a9[a15_0x53a4('0x2e')](_0x2b60d5);_0x3fcb7f[a15_0x53a4('0x2f')](_0x569531)[a15_0x53a4('0x2f')](_0x3c15d4)['on']('finish',_0x1b5ab9=>{if(_0x1b5ab9)return console[a15_0x53a4('0x2b')](_0x1b5ab9);else{if(_0x22b4a9[a15_0x53a4('0x30')](_0x3f8296)){_0x22b4a9['unlink'](_0x3f8296,_0x1b5ab9=>{if(_0x1b5ab9)throw _0x1b5ab9;console['log']('successfully\x20deleted\x20'+_0x3f8296);});}console[a15_0x53a4('0x11')](a15_0x53a4('0x31')+_0x2b60d5);return _0x2b60d5;}});});}}exports['EventsService']=EventsService;