var a15_0x12c3=['createEvent','bind','startDateParts','getDateParts','startDate','DateUtils','eventDate','createFile','createJson','1-71767930-','year','month','hour','minute','second','-00001','StationContext','settings','routeCode','routeName','nit','day','locationParts','hdop','longitude','latitude','speed','doorStatus','CountingInfo','Out','zlib','plate','eventFileFolder','writeFile','error','.gz','createReadStream','createWriteStream','pipe','existsSync','successfully\x20deleted\x20','successfully\x20created\x20','EventsService','defineProperty','__esModule','../infrastructure/stationSettings','../infrastructure/utils/dateUtils','eventDateParts','sensorsService','countingWebSocketService','gpsService'];(function(_0x7e7ff,_0x3f5cff){var _0x58b26a=function(_0x40acdb){while(--_0x40acdb){_0x7e7ff['push'](_0x7e7ff['shift']());}};_0x58b26a(++_0x3f5cff);}(a15_0x12c3,0x12a));var a15_0x5ba8=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a15_0x12c3[_0x2d8f05];return _0x4d74cb;};'use strict';Object[a15_0x5ba8('0x0')](exports,a15_0x5ba8('0x1'),{'value':!![]});const stationSettings_1=require(a15_0x5ba8('0x2'));const dateUtils_1=require(a15_0x5ba8('0x3'));const fs=require('fs');const request=require('request');class EventsService{constructor(_0x47be7d,_0x26fd4e,_0x4b4ee7){this[a15_0x5ba8('0x4')]={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['startDateParts']={'day':'','month':'','year':'','hour':'','minute':'','second':''};this['gpsService']=_0x47be7d;this[a15_0x5ba8('0x5')]=_0x26fd4e;this[a15_0x5ba8('0x6')]=_0x4b4ee7;this[a15_0x5ba8('0x7')][a15_0x5ba8('0x8')]=this[a15_0x5ba8('0x8')][a15_0x5ba8('0x9')](this);this[a15_0x5ba8('0x5')][a15_0x5ba8('0x8')]=this[a15_0x5ba8('0x8')][a15_0x5ba8('0x9')](this);this[a15_0x5ba8('0x6')][a15_0x5ba8('0x8')]=this['createEvent'][a15_0x5ba8('0x9')](this);this['startDate']=new Date();this[a15_0x5ba8('0xa')]=dateUtils_1['DateUtils'][a15_0x5ba8('0xb')](this[a15_0x5ba8('0xc')]);}[a15_0x5ba8('0x8')](_0x45febb){try{this['eventDate']=new Date();this[a15_0x5ba8('0x4')]=dateUtils_1[a15_0x5ba8('0xd')][a15_0x5ba8('0xb')](this[a15_0x5ba8('0xe')]);const _0x3e8af9=this['createJson'](_0x45febb);const _0xfb149e=this[a15_0x5ba8('0xf')](_0x3e8af9);}catch(_0x4c8007){console['log'](_0x4c8007);}}[a15_0x5ba8('0x10')](_0x373e0c){const _0x8ffc46={'idViaje':a15_0x5ba8('0x11')+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x12')]+this['eventDateParts'][a15_0x5ba8('0x13')]+this[a15_0x5ba8('0x4')]['day']+'-'+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x14')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x15')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x16')]+a15_0x5ba8('0x17'),'cedula':stationSettings_1[a15_0x5ba8('0x18')][a15_0x5ba8('0x19')]['driverDocument'],'codigoRuta':stationSettings_1[a15_0x5ba8('0x18')][a15_0x5ba8('0x19')][a15_0x5ba8('0x1a')],'ruta':stationSettings_1[a15_0x5ba8('0x18')][a15_0x5ba8('0x19')][a15_0x5ba8('0x1b')],'nit':stationSettings_1[a15_0x5ba8('0x18')]['settings'][a15_0x5ba8('0x1c')],'placa':stationSettings_1[a15_0x5ba8('0x18')]['settings']['plate'],'inicio_viaje':this[a15_0x5ba8('0x4')]['day']+'/'+this['eventDateParts'][a15_0x5ba8('0x13')]+'/'+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x12')]+'\x20'+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x14')]+':'+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x15')]+':'+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x16')],'fin_viaje':'','estado':'0','eventos':[{'archivo_enviado':![],'fecha':this[a15_0x5ba8('0x4')][a15_0x5ba8('0x12')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x13')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x1d')],'hora':this['eventDateParts']['hour']+this[a15_0x5ba8('0x4')]['minute']+this['eventDateParts']['second'],'dop':this[a15_0x5ba8('0x7')][a15_0x5ba8('0x1e')][a15_0x5ba8('0x1f')],'longitud':this[a15_0x5ba8('0x7')][a15_0x5ba8('0x1e')][a15_0x5ba8('0x20')],'latitud':this[a15_0x5ba8('0x7')][a15_0x5ba8('0x1e')][a15_0x5ba8('0x21')],'velocidad':this[a15_0x5ba8('0x7')][a15_0x5ba8('0x1e')][a15_0x5ba8('0x22')],'puerta':[{'estado':this[a15_0x5ba8('0x5')][a15_0x5ba8('0x23')],'idPuerta':0x0,'ingresos':_0x373e0c!=null?_0x373e0c[a15_0x5ba8('0x24')][0x0]['In']:0x0,'salidas':_0x373e0c!=null?_0x373e0c[a15_0x5ba8('0x24')][0x0][a15_0x5ba8('0x25')]:0x0},{'estado':0x0,'idPuerta':0x1,'ingresos':0x0,'salidas':0x0}]}]};return _0x8ffc46;}[a15_0x5ba8('0xf')](_0x217afa){const _0x5443d9=require('fs');const _0x593a84=require(a15_0x5ba8('0x26'));const _0x4efa85=stationSettings_1['StationContext'][a15_0x5ba8('0x19')]['nit']+stationSettings_1[a15_0x5ba8('0x18')][a15_0x5ba8('0x19')][a15_0x5ba8('0x27')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x1d')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x13')]+this[a15_0x5ba8('0x4')]['year']+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x14')]+this[a15_0x5ba8('0x4')][a15_0x5ba8('0x15')]+this[a15_0x5ba8('0x4')]['second'];const _0x49893e=stationSettings_1[a15_0x5ba8('0x18')][a15_0x5ba8('0x19')][a15_0x5ba8('0x28')]+_0x4efa85;const _0x5f1ac0=JSON['stringify'](_0x217afa);_0x5443d9[a15_0x5ba8('0x29')](_0x49893e,_0x5f1ac0,_0x397235=>{if(_0x397235)return console[a15_0x5ba8('0x2a')](_0x397235);const _0x4cce26=_0x49893e+a15_0x5ba8('0x2b');const _0x470ea5=_0x593a84['createGzip']();const _0x543b0f=_0x5443d9[a15_0x5ba8('0x2c')](_0x49893e);const _0x2d0f12=_0x5443d9[a15_0x5ba8('0x2d')](_0x4cce26);_0x543b0f[a15_0x5ba8('0x2e')](_0x470ea5)['pipe'](_0x2d0f12)['on']('finish',_0x397235=>{if(_0x397235)return console[a15_0x5ba8('0x2a')](_0x397235);else{if(_0x5443d9[a15_0x5ba8('0x2f')](_0x49893e)){_0x5443d9['unlink'](_0x49893e,_0x397235=>{if(_0x397235)throw _0x397235;console['log'](a15_0x5ba8('0x30')+_0x49893e);});}console['log'](a15_0x5ba8('0x31')+_0x4cce26);return _0x4cce26;}});});}}exports[a15_0x5ba8('0x32')]=EventsService;