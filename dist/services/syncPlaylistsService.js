var a22_0x33e1=['stderr:\x20','close','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','info','Download\x20started','_filename','size:\x20','complete','finished\x20youtube\x20downloading!','.mp4','finishProcess','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','path','media_type','/home/osmc/luloclient/media/files/','Finished','shutdown','defineProperty','__esModule','../infrastructure/HttpClientService','url','http','request-progress','child_process','spawn','is-image','youtube-dl','uuid/v4','config.json','mediaFolder','filesFolder','files/','playListFile','m3uFile','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','httpClientService','HttpClientService','init','parse','readFileSync','context','playerId','config','baseURL','env','WEB_SERVICE_URL','deploy/','playListServiceURL','registerClient','checkFolders','loadMediaList','deviceUuid','stringify','networkInterfaces','post','http://restapi.lulo.run/player_devices/register','then','parsedBody','log','catch','ensureDir','hasPlayListChanged','tempFolder','push','Total:\x20','length','download','bind','reloadMediaList','existsSync','toString','error','this.currentFile:\x20','substring','lastIndexOf','downloadYouTube','downloadHTTPFile','downloadHTTPFileCallback','Attempting\x20to\x20download\x20','\x20to\x20','Max\x20redirects\x20reached','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','downloadFile\x20callback\x20result\x20undefined:\x20','globalAgent','host','pathname','get','\x20Progress:\x20unknown\x09','\x20Progress:\x20','statusCode','headers','content-length','stat','Have\x20already\x20downloaded\x20','size','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(','createWriteStream','data','finish','location','Redirect\x20','Redirect\x20limit\x20encountered\x20for\x20','302','Problem\x20downloading\x20','\x20STATUS:\x20','Error\x20Downloading:\x20','message','image','duration','createImageVideo','video','downloadRequestFile','progress','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','pipe','split','join','ffmpeg','1/2','-loop','-pattern_type','glob','-c:v','-pix_fmt','yuv420p','-vf','scale=1920:1080','stdout','Converting\x20','stderr'];(function(_0x594278,_0x910177){var _0x158d6=function(_0x114699){while(--_0x114699){_0x594278['push'](_0x594278['shift']());}};_0x158d6(++_0x910177);}(a22_0x33e1,0x1b5));var a22_0xc0b5=function(_0xd03e43,_0x2e08dc){_0xd03e43=_0xd03e43-0x0;var _0x46eea0=a22_0x33e1[_0xd03e43];return _0x46eea0;};'use strict';Object[a22_0xc0b5('0x0')](exports,a22_0xc0b5('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0xc0b5('0x2'));const fs=require('fs');const url=require(a22_0xc0b5('0x3'));const http=require(a22_0xc0b5('0x4'));const fsExtra=require('fs-extra');const request=require('request');const progress=require(a22_0xc0b5('0x5'));const spawn=require(a22_0xc0b5('0x6'))[a22_0xc0b5('0x7')];const isImage=require(a22_0xc0b5('0x8'));const format=require('string-template');const os=require('os');const youtubedl=require(a22_0xc0b5('0x9'));const uuidv4=require(a22_0xc0b5('0xa'));const configFile=a22_0xc0b5('0xb');const contextFile='context.json';class SyncPlaylistsService{constructor(){this[a22_0xc0b5('0xc')]='media/';this['tempFolder']=this[a22_0xc0b5('0xc')]+'temp/';this[a22_0xc0b5('0xd')]=this[a22_0xc0b5('0xc')]+a22_0xc0b5('0xe');this[a22_0xc0b5('0xf')]=this['mediaFolder']+'playlist.txt';this[a22_0xc0b5('0x10')]=this['filesFolder']+a22_0xc0b5('0x11');this[a22_0xc0b5('0x12')]=0x0;this[a22_0xc0b5('0x13')]=[];this[a22_0xc0b5('0x14')]={};this[a22_0xc0b5('0x15')]=new HttpClientService_1[(a22_0xc0b5('0x16'))]();}[a22_0xc0b5('0x17')](){this['config']=JSON[a22_0xc0b5('0x18')](fs[a22_0xc0b5('0x19')](configFile));this[a22_0xc0b5('0x1a')]=JSON['parse'](fs[a22_0xc0b5('0x19')](contextFile));this[a22_0xc0b5('0x1b')]=this[a22_0xc0b5('0x1c')][a22_0xc0b5('0x1b')];this[a22_0xc0b5('0x1d')]=process[a22_0xc0b5('0x1e')][a22_0xc0b5('0x1f')]+a22_0xc0b5('0x20');this[a22_0xc0b5('0x21')]=this[a22_0xc0b5('0x1d')]+'api/player_playlist.php?player_id={0}';this[a22_0xc0b5('0x22')]();this[a22_0xc0b5('0x23')]();this[a22_0xc0b5('0x24')]();}[a22_0xc0b5('0x22')](){const _0x416481=this[a22_0xc0b5('0x1c')][a22_0xc0b5('0x25')];if(!_0x416481||_0x416481==''){this['config']['deviceUuid']=uuidv4();this[a22_0xc0b5('0x1c')]={'deviceUuid':this[a22_0xc0b5('0x1c')][a22_0xc0b5('0x25')],'playerId':this[a22_0xc0b5('0x1c')][a22_0xc0b5('0x1b')]};fs['writeFileSync'](configFile,JSON[a22_0xc0b5('0x26')](this['config']));}const _0x169e3a={'player_id':this[a22_0xc0b5('0x1b')],'device_uuid':this['config'][a22_0xc0b5('0x25')],'network_info':JSON[a22_0xc0b5('0x26')](os[a22_0xc0b5('0x27')]()),'firmware_info':JSON[a22_0xc0b5('0x26')](this[a22_0xc0b5('0x1a')]),'status':0x1};this['httpClientService'][a22_0xc0b5('0x28')](a22_0xc0b5('0x29'),_0x169e3a,![])[a22_0xc0b5('0x2a')](function(_0x1a374a){console['log'](a22_0xc0b5('0x2b'));console[a22_0xc0b5('0x2c')](_0x1a374a);})[a22_0xc0b5('0x2d')](function(_0x3e99d0){});}[a22_0xc0b5('0x23')](){fsExtra[a22_0xc0b5('0x2e')](this['mediaFolder'],_0x4a6fb9=>{});fsExtra[a22_0xc0b5('0x2e')](this['tempFolder'],_0x1ac3dd=>{});fsExtra[a22_0xc0b5('0x2e')](this['filesFolder'],_0x4962bf=>{});}['loadMediaList'](){const _0x196aff=format(this[a22_0xc0b5('0x21')],this['playerId']);console['log'](_0x196aff);request({'url':_0x196aff,'json':!![]},function(_0x2b4cfb,_0x40b578,_0x1a75db){console[a22_0xc0b5('0x2c')](_0x1a75db);this[a22_0xc0b5('0x14')]=_0x1a75db;if(this[a22_0xc0b5('0x2f')]()){fsExtra['emptyDirSync'](this[a22_0xc0b5('0x30')]);this[a22_0xc0b5('0x13')]=[];this[a22_0xc0b5('0x12')]=0x0;for(const _0x2fabdc in _0x1a75db){this[a22_0xc0b5('0x13')][a22_0xc0b5('0x31')](_0x1a75db[_0x2fabdc]);}console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x32')+this[a22_0xc0b5('0x13')][a22_0xc0b5('0x33')]);if(this[a22_0xc0b5('0x13')]['length']>0x0){this[a22_0xc0b5('0x34')]();}}else{console[a22_0xc0b5('0x2c')]('No\x20playlist\x20changes');}}[a22_0xc0b5('0x35')](this));}[a22_0xc0b5('0x36')](){if(fsExtra[a22_0xc0b5('0x37')](this[a22_0xc0b5('0xf')])){fsExtra['removeSync'](this[a22_0xc0b5('0xf')]);}this['loadMediaList']();}[a22_0xc0b5('0x2f')](){const _0x227372=JSON[a22_0xc0b5('0x26')](this[a22_0xc0b5('0x14')]);try{if(!fs[a22_0xc0b5('0x37')](this['playListFile'])){return!![];}else{const _0x5e858e=fs[a22_0xc0b5('0x19')](this[a22_0xc0b5('0xf')])[a22_0xc0b5('0x38')]();if(_0x5e858e!=_0x227372){return!![];}}}catch(_0x3bd6eb){console[a22_0xc0b5('0x39')](_0x3bd6eb);}return![];}[a22_0xc0b5('0x34')](){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x3a')+this[a22_0xc0b5('0x12')]);if(this[a22_0xc0b5('0x12')]>=this[a22_0xc0b5('0x13')]['length']){this['finishProcess']();return;}const _0x4ebe42=String(this['downloadFiles'][this['currentFile']]['path']);const _0x26a2b3=this[a22_0xc0b5('0x13')][this[a22_0xc0b5('0x12')]]['media_type'];const _0x5473dc=_0x4ebe42[a22_0xc0b5('0x3b')](_0x4ebe42[a22_0xc0b5('0x3c')]('/')+0x1);const _0x2cc48e=this[a22_0xc0b5('0x1d')]+_0x4ebe42;console[a22_0xc0b5('0x2c')]('Downloading:\x20'+_0x2cc48e);if(_0x26a2b3=='youtube_single'){this[a22_0xc0b5('0x3d')](_0x4ebe42);}else{this[a22_0xc0b5('0x3e')](_0x2cc48e,_0x5473dc,_0x26a2b3,this[a22_0xc0b5('0x3f')][a22_0xc0b5('0x35')](this));}}[a22_0xc0b5('0x3e')](_0xc3128,_0x393ad8,_0x394009,_0x2cd451){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x3e'));console[a22_0xc0b5('0x2c')](_0xc3128);const _0x167f6d=!![];let _0x4309e7=0x0;const _0x5a1eb3='';console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x40')+_0xc3128+a22_0xc0b5('0x41')+_0x393ad8);if(_0x4309e7){if(_0x4309e7>0x5){_0x2cd451(a22_0xc0b5('0x42'),_0xc3128,_0x394009,null);return;}}else{_0x4309e7=0x0;}const _0x3cb89e=this['tempFolder']+_0x393ad8;let _0x86fe39;if(_0x2cd451===undefined){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x43')+_0xc3128+'\x20to\x20'+_0x3cb89e);_0x2cd451=function(_0x140b38,_0x39eeb0){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x44'),_0x140b38,_0x39eeb0);};}http[a22_0xc0b5('0x45')]['maxSockets']=0x64;const _0x290566={'host':url[a22_0xc0b5('0x18')](_0xc3128)[a22_0xc0b5('0x46')],'port':0x50,'path':url[a22_0xc0b5('0x18')](_0xc3128)[a22_0xc0b5('0x47')]};const _0x184782=http[a22_0xc0b5('0x48')](_0x290566,function(_0x230499){let _0x559283=0x0;let _0x619561=0x0;function _0x5c9c28(){if(_0x559283===undefined){console[a22_0xc0b5('0x2c')](_0x393ad8+a22_0xc0b5('0x49')+_0x619561+'/'+'?');}const _0x3c651a=_0x619561/_0x559283*0x64;console[a22_0xc0b5('0x2c')](_0x393ad8+a22_0xc0b5('0x4a')+_0x3c651a+'%\x09'+_0x619561+'/'+_0x559283);}console[a22_0xc0b5('0x2c')](_0x393ad8+'\x20'+_0x230499[a22_0xc0b5('0x4b')]);switch(_0x230499['statusCode']){case 0xc8:_0x559283=_0x230499[a22_0xc0b5('0x4c')][a22_0xc0b5('0x4d')]||_0x5a1eb3;fs[a22_0xc0b5('0x4e')](_0x3cb89e,function(_0x5ab4ec,_0x10146){if(!_0x5ab4ec){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x4f')+_0x3cb89e);if(_0x10146[a22_0xc0b5('0x50')]==_0x559283){console['log']('And\x20the\x20file\x20size\x20matches\x20('+_0x559283+')');console[a22_0xc0b5('0x2c')]('Redownloading');}else{console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x51')+_0x10146[a22_0xc0b5('0x50')]+')\x20vs\x20New('+_0x559283+')');}}_0x86fe39=fs[a22_0xc0b5('0x52')](_0x3cb89e);_0x230499['pipe'](_0x86fe39);_0x230499['on'](a22_0xc0b5('0x53'),function(_0x257a5d){_0x619561+=_0x257a5d['length'];_0x5c9c28();});_0x184782['on']('error',function(_0x5ab4ec){console[a22_0xc0b5('0x2c')]('err:\x20');console[a22_0xc0b5('0x2c')](_0x5ab4ec);});_0x86fe39['on'](a22_0xc0b5('0x54'),function(){console[a22_0xc0b5('0x2c')]('Downloaded\x20'+_0xc3128+a22_0xc0b5('0x41')+_0x393ad8);_0x2cd451(null,_0x393ad8,_0x394009,_0x393ad8);}[a22_0xc0b5('0x35')](this));});break;case 0x12e:const _0x18acc3=_0x230499[a22_0xc0b5('0x4c')][a22_0xc0b5('0x55')];console['log'](a22_0xc0b5('0x56')+_0xc3128+'\x20to\x20'+_0x18acc3);if(_0x4309e7<0x5){this[a22_0xc0b5('0x3e')](_0x18acc3,_0x393ad8,_0x2cd451,_0x4309e7++);}else{console[a22_0xc0b5('0x39')](a22_0xc0b5('0x57')+_0xc3128+'.');_0x2cd451(a22_0xc0b5('0x58'),null,null,null);}return;case 0x194:console['log']('File\x20Not\x20Found\x20'+_0xc3128);default:console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x59')+_0xc3128+a22_0xc0b5('0x5a')+_0x230499[a22_0xc0b5('0x4b')]);_0x184782['abort']();_0x2cd451(_0x230499['statusCode'],null,null,null);return;}})['on'](a22_0xc0b5('0x39'),function(_0x1bf125){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x5b')+_0xc3128+'\x20'+_0x1bf125[a22_0xc0b5('0x5c')]);_0x2cd451(_0x1bf125,null,null,null);});}[a22_0xc0b5('0x3f')](_0x1fd818,_0x218efa,_0x346bae,_0x2c2e7d){console['log'](a22_0xc0b5('0x3f'));console['log'](_0x1fd818);console['log'](_0x218efa);console[a22_0xc0b5('0x2c')](_0x346bae);console[a22_0xc0b5('0x2c')](_0x2c2e7d);if(_0x346bae==a22_0xc0b5('0x5d')){const _0x167bcd=this[a22_0xc0b5('0x13')][this['currentFile']][a22_0xc0b5('0x5e')]!=null?this[a22_0xc0b5('0x13')][this[a22_0xc0b5('0x12')]]['duration']:0x1e;this[a22_0xc0b5('0x5f')](_0x2c2e7d,_0x167bcd);}else if(_0x346bae==a22_0xc0b5('0x60')){if(_0x1fd818==null&&_0x218efa!=''){this[a22_0xc0b5('0x12')]++;}this['download']();}console[a22_0xc0b5('0x2c')](this[a22_0xc0b5('0x12')]);}[a22_0xc0b5('0x61')](_0xefa40b,_0x48332f,_0x4435d5){progress(request(_0xefa40b),{})['on'](a22_0xc0b5('0x62'),function(_0x1bdf57){console['log'](_0x1bdf57);})['on']('error',function(_0x3b7769){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x63'));this['download']();})['on'](a22_0xc0b5('0x64'),function(){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x65')+_0x48332f);console['log'](a22_0xc0b5('0x66')+_0x4435d5);if(_0x4435d5=='image'){const _0x513ff1=this[a22_0xc0b5('0x13')][this[a22_0xc0b5('0x12')]]['duration']!=null?this[a22_0xc0b5('0x13')][this['currentFile']]['duration']:0x1e;this[a22_0xc0b5('0x5f')](_0x48332f,_0x513ff1);}else if(_0x4435d5=='video'){this[a22_0xc0b5('0x12')]++;this[a22_0xc0b5('0x34')]();}}[a22_0xc0b5('0x35')](this))[a22_0xc0b5('0x67')](fs['createWriteStream'](this[a22_0xc0b5('0x30')]+_0x48332f));}[a22_0xc0b5('0x5f')](_0x6e2d6a,_0x4b191c=0x1e){const _0x42d032=this[a22_0xc0b5('0x30')]+_0x6e2d6a;console[a22_0xc0b5('0x2c')](_0x42d032);console[a22_0xc0b5('0x2c')](_0x6e2d6a);const _0x47e211=_0x6e2d6a[a22_0xc0b5('0x68')]('.')['slice'](0x0,-0x1)[a22_0xc0b5('0x69')]('.');const _0x328077=a22_0xc0b5('0x6a');const _0x5be96c=['-y','-r',a22_0xc0b5('0x6b'),a22_0xc0b5('0x6c'),'1',a22_0xc0b5('0x6d'),a22_0xc0b5('0x6e'),'-i',_0x42d032,'-t',String(_0x4b191c),a22_0xc0b5('0x6f'),'libx264',a22_0xc0b5('0x70'),a22_0xc0b5('0x71'),'-r','25',a22_0xc0b5('0x72'),a22_0xc0b5('0x73'),this[a22_0xc0b5('0x30')]+_0x47e211+'.mp4'];const _0x2f8692=spawn(_0x328077,_0x5be96c);_0x2f8692[a22_0xc0b5('0x74')]['on'](a22_0xc0b5('0x53'),function(_0x396633){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x75')+_0x42d032);});_0x2f8692[a22_0xc0b5('0x76')]['on'](a22_0xc0b5('0x53'),function(_0x1b4f66){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x77')+_0x1b4f66);}[a22_0xc0b5('0x35')](this));_0x2f8692['on'](a22_0xc0b5('0x78'),function(){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x79'));this[a22_0xc0b5('0x12')]++;this[a22_0xc0b5('0x34')]();}[a22_0xc0b5('0x35')](this));}[a22_0xc0b5('0x3d')](_0xcd8d0d){const _0x3c586c=youtubedl(a22_0xc0b5('0x7a')+_0xcd8d0d,['--format=18'],{'cwd':__dirname});_0x3c586c['on'](a22_0xc0b5('0x7b'),function(_0x47411a){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x7c'));console[a22_0xc0b5('0x2c')]('filename:\x20'+_0x47411a[a22_0xc0b5('0x7d')]);console['log'](a22_0xc0b5('0x7e')+_0x47411a[a22_0xc0b5('0x50')]);});_0x3c586c['on'](a22_0xc0b5('0x7f'),function complete(_0x2df94a){'use strict';console[a22_0xc0b5('0x2c')]('filename:\x20'+_0x2df94a['_filename']+'\x20already\x20downloaded.');});_0x3c586c['on']('end',function(){console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x80'));this[a22_0xc0b5('0x12')]++;this['download']();}[a22_0xc0b5('0x35')](this));_0x3c586c[a22_0xc0b5('0x67')](fs[a22_0xc0b5('0x52')](this[a22_0xc0b5('0x30')]+'/'+_0xcd8d0d+a22_0xc0b5('0x81')));}[a22_0xc0b5('0x82')](){fs[a22_0xc0b5('0x83')](this[a22_0xc0b5('0xf')],JSON[a22_0xc0b5('0x26')](this[a22_0xc0b5('0x14')]));let _0x481470=a22_0xc0b5('0x84')+'\x0d\x0a'+a22_0xc0b5('0x85')+'\x0d\x0a';for(const _0x5bced2 in this['downloadFiles']){const _0x3783ad=this[a22_0xc0b5('0x13')][_0x5bced2][a22_0xc0b5('0x86')];const _0x2ec794=this[a22_0xc0b5('0x13')][_0x5bced2][a22_0xc0b5('0x87')];const _0x4b3bcf=_0x3783ad['substring'](_0x3783ad[a22_0xc0b5('0x3c')]('/')+0x1);let _0x455ca4=_0x4b3bcf[a22_0xc0b5('0x68')]('.')['slice'](0x0,-0x1)[a22_0xc0b5('0x69')]('.');if(_0x2ec794=='youtube_single'){_0x455ca4=_0x3783ad;}_0x481470+=a22_0xc0b5('0x88')+_0x455ca4+a22_0xc0b5('0x81')+'\x0d\x0a';}fsExtra['emptyDirSync'](this[a22_0xc0b5('0xd')]);fsExtra['copySync'](this[a22_0xc0b5('0x30')],this[a22_0xc0b5('0xd')]);fs['writeFileSync'](this[a22_0xc0b5('0x10')],_0x481470);fsExtra['emptyDirSync'](this[a22_0xc0b5('0x30')]);console[a22_0xc0b5('0x2c')](a22_0xc0b5('0x89'));const _0x10ec9b=spawn(a22_0xc0b5('0x8a'),['-r','now']);}}exports['SyncPlaylistsService']=SyncPlaylistsService;