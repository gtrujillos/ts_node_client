var a21_0x2f93=['log','hasPlayListChanged','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','stringify','existsSync','toString','error','this.currentFile:\x20','finishProcess','path','media_type','substring','Downloading:\x20','youtube_single','progress','percent','Error\x20downloading\x20file','mediaType:\x20','image','duration','createImageVideo','pipe','split','slice','join','ffmpeg','1/2','-loop','glob','-c:v','libx264','-pix_fmt','yuv420p','scale=1920:1080','.mp4','Converting\x20','stderr','data','stderr:\x20','close','finished\x20mp4\x20convert','downloadYouTube','--format=18','info','Download\x20started','_filename','size:\x20','\x20already\x20downloaded.','end','finished\x20youtube\x20downloading!','createWriteStream','#EXTCPlayListM3U::M3U','lastIndexOf','/home/osmc/luloclient/media/files/','emptyDirSync','copySync','writeFileSync','Finished','shutdown','now','SyncPlaylistsService','defineProperty','__esModule','fs-extra','request-progress','spawn','is-image','string-template','mediaFolder','media/','tempFolder','temp/','filesFolder','playListFile','playlist.txt','m3uFile','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','init','parse','readFileSync','config.json','playerId','env','WEB_SERVICE_URL','deploy/','baseURL','api/player_playlist.php?player_id={0}','checkFolders','ensureDir','loadMediaList','playListServiceURL'];(function(_0x1b733c,_0x335d35){var _0x2befbb=function(_0x26fdae){while(--_0x26fdae){_0x1b733c['push'](_0x1b733c['shift']());}};_0x2befbb(++_0x335d35);}(a21_0x2f93,0x1d8));var a21_0x4c25=function(_0xb2099d,_0x375c5f){_0xb2099d=_0xb2099d-0x0;var _0x541bc6=a21_0x2f93[_0xb2099d];return _0x541bc6;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object[a21_0x4c25('0x0')](exports,a21_0x4c25('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x4c25('0x2'));const request=require('request');const progress=require(a21_0x4c25('0x3'));const spawn=require('child_process')[a21_0x4c25('0x4')];const isImage=require(a21_0x4c25('0x5'));const format=require(a21_0x4c25('0x6'));const os=require('os');const youtubedl=require('youtube-dl');class SyncPlaylistsService{constructor(){this[a21_0x4c25('0x7')]=a21_0x4c25('0x8');this[a21_0x4c25('0x9')]=this[a21_0x4c25('0x7')]+a21_0x4c25('0xa');this[a21_0x4c25('0xb')]=this[a21_0x4c25('0x7')]+'files/';this[a21_0x4c25('0xc')]=this[a21_0x4c25('0x7')]+a21_0x4c25('0xd');this[a21_0x4c25('0xe')]=this['filesFolder']+a21_0x4c25('0xf');this[a21_0x4c25('0x10')]=0x0;this[a21_0x4c25('0x11')]=[];this[a21_0x4c25('0x12')]={};}[a21_0x4c25('0x13')](){const _0x127c1e=JSON[a21_0x4c25('0x14')](fs[a21_0x4c25('0x15')](a21_0x4c25('0x16')));this[a21_0x4c25('0x17')]=_0x127c1e[a21_0x4c25('0x17')];this['baseURL']=process[a21_0x4c25('0x18')][a21_0x4c25('0x19')]+a21_0x4c25('0x1a');this['playListServiceURL']=this[a21_0x4c25('0x1b')]+a21_0x4c25('0x1c');this[a21_0x4c25('0x1d')]();this['loadMediaList']();}[a21_0x4c25('0x1d')](){fsExtra[a21_0x4c25('0x1e')](this['mediaFolder'],_0x109a90=>{});fsExtra[a21_0x4c25('0x1e')](this[a21_0x4c25('0x9')],_0x4015fe=>{});fsExtra[a21_0x4c25('0x1e')](this['filesFolder'],_0x2b326c=>{});}[a21_0x4c25('0x1f')](){const _0x4ce41b=format(this[a21_0x4c25('0x20')],this[a21_0x4c25('0x17')]);console[a21_0x4c25('0x21')](_0x4ce41b);request({'url':_0x4ce41b,'json':!![]},function(_0x515350,_0x220cd5,_0x392376){console[a21_0x4c25('0x21')](_0x392376);this['newPlayList']=_0x392376;if(this[a21_0x4c25('0x22')]()){this[a21_0x4c25('0x11')]=[];this[a21_0x4c25('0x10')]=0x0;for(const _0x540f57 in _0x392376){this['downloadFiles'][a21_0x4c25('0x23')](_0x392376[_0x540f57]);}console[a21_0x4c25('0x21')](a21_0x4c25('0x24')+this[a21_0x4c25('0x11')][a21_0x4c25('0x25')]);if(this['downloadFiles'][a21_0x4c25('0x25')]>0x0){this[a21_0x4c25('0x26')]();}}else{console[a21_0x4c25('0x21')](a21_0x4c25('0x27'));}}[a21_0x4c25('0x28')](this));}[a21_0x4c25('0x29')](){fs[a21_0x4c25('0x2a')](this[a21_0x4c25('0xc')]);this['loadMediaList']();}[a21_0x4c25('0x22')](){const _0x2f08d9=JSON[a21_0x4c25('0x2b')](this[a21_0x4c25('0x12')]);try{if(!fs[a21_0x4c25('0x2c')](this['playListFile'])){return!![];}else{const _0x286641=fs[a21_0x4c25('0x15')](this[a21_0x4c25('0xc')])[a21_0x4c25('0x2d')]();if(_0x286641!=_0x2f08d9){return!![];}}}catch(_0x77a269){console[a21_0x4c25('0x2e')](_0x77a269);}return![];}[a21_0x4c25('0x26')](){console[a21_0x4c25('0x21')](a21_0x4c25('0x2f')+this[a21_0x4c25('0x10')]);if(this[a21_0x4c25('0x10')]>=this[a21_0x4c25('0x11')][a21_0x4c25('0x25')]){this[a21_0x4c25('0x30')]();return;}const _0x4636f4=String(this[a21_0x4c25('0x11')][this[a21_0x4c25('0x10')]][a21_0x4c25('0x31')]);const _0x39ef94=this[a21_0x4c25('0x11')][this[a21_0x4c25('0x10')]][a21_0x4c25('0x32')];const _0x107d2f=_0x4636f4[a21_0x4c25('0x33')](_0x4636f4['lastIndexOf']('/')+0x1);const _0x4af77a=this[a21_0x4c25('0x1b')]+_0x4636f4;console[a21_0x4c25('0x21')](a21_0x4c25('0x34')+_0x4af77a);if(_0x39ef94==a21_0x4c25('0x35')){this['downloadYouTube'](_0x4636f4);}else{progress(request(_0x4af77a),{})['on'](a21_0x4c25('0x36'),function(_0x1f3ed3){console[a21_0x4c25('0x21')](a21_0x4c25('0x36'),_0x1f3ed3[a21_0x4c25('0x37')]);})['on']('error',function(_0x22ada9){console[a21_0x4c25('0x21')](a21_0x4c25('0x38'));this[a21_0x4c25('0x26')]();})['on']('end',function(){console['log']('Downloaded:\x20'+_0x107d2f);console[a21_0x4c25('0x21')](a21_0x4c25('0x39')+_0x39ef94);if(_0x39ef94==a21_0x4c25('0x3a')){const _0x2d2d92=this[a21_0x4c25('0x11')][this['currentFile']][a21_0x4c25('0x3b')]!=null?this[a21_0x4c25('0x11')][this['currentFile']][a21_0x4c25('0x3b')]:0x1e;this[a21_0x4c25('0x3c')](_0x107d2f,_0x2d2d92);}else if(_0x39ef94=='video'){this[a21_0x4c25('0x10')]++;this[a21_0x4c25('0x26')]();}}['bind'](this))[a21_0x4c25('0x3d')](fs['createWriteStream'](this['tempFolder']+_0x107d2f));}}['createImageVideo'](_0xe4994d,_0x4d6f22=0x1e){const _0x112cf4=this[a21_0x4c25('0x9')]+_0xe4994d;const _0x3b00fe=_0xe4994d[a21_0x4c25('0x3e')]('.')[a21_0x4c25('0x3f')](0x0,-0x1)[a21_0x4c25('0x40')]('.');const _0x439e00=a21_0x4c25('0x41');const _0x5e92e2=['-y','-r',a21_0x4c25('0x42'),a21_0x4c25('0x43'),'1','-pattern_type',a21_0x4c25('0x44'),'-i',_0x112cf4,'-t',String(_0x4d6f22),a21_0x4c25('0x45'),a21_0x4c25('0x46'),a21_0x4c25('0x47'),a21_0x4c25('0x48'),'-r','25','-vf',a21_0x4c25('0x49'),this[a21_0x4c25('0x9')]+_0x3b00fe+a21_0x4c25('0x4a')];const _0x3e0210=spawn(_0x439e00,_0x5e92e2);_0x3e0210['stdout']['on']('data',function(_0x7ba60d){console[a21_0x4c25('0x21')](a21_0x4c25('0x4b')+_0x112cf4);});_0x3e0210[a21_0x4c25('0x4c')]['on'](a21_0x4c25('0x4d'),function(_0x111b1e){console[a21_0x4c25('0x21')](a21_0x4c25('0x4e')+_0x111b1e);}[a21_0x4c25('0x28')](this));_0x3e0210['on'](a21_0x4c25('0x4f'),function(){console['log'](a21_0x4c25('0x50'));this[a21_0x4c25('0x10')]++;this['download']();}[a21_0x4c25('0x28')](this));}[a21_0x4c25('0x51')](_0x3a9b1f){const _0x360a27=youtubedl('http://www.youtube.com/watch?v='+_0x3a9b1f,[a21_0x4c25('0x52')],{'cwd':__dirname});_0x360a27['on'](a21_0x4c25('0x53'),function(_0x4a0275){console[a21_0x4c25('0x21')](a21_0x4c25('0x54'));console[a21_0x4c25('0x21')]('filename:\x20'+_0x4a0275[a21_0x4c25('0x55')]);console[a21_0x4c25('0x21')](a21_0x4c25('0x56')+_0x4a0275['size']);});_0x360a27['on']('complete',function complete(_0x74c26){'use strict';console[a21_0x4c25('0x21')]('filename:\x20'+_0x74c26[a21_0x4c25('0x55')]+a21_0x4c25('0x57'));});_0x360a27['on'](a21_0x4c25('0x58'),function(){console[a21_0x4c25('0x21')](a21_0x4c25('0x59'));this[a21_0x4c25('0x10')]++;this[a21_0x4c25('0x26')]();}[a21_0x4c25('0x28')](this));_0x360a27[a21_0x4c25('0x3d')](fs[a21_0x4c25('0x5a')](this[a21_0x4c25('0x9')]+'/'+_0x3a9b1f+a21_0x4c25('0x4a')));}[a21_0x4c25('0x30')](){fs['writeFileSync'](this[a21_0x4c25('0xc')],JSON[a21_0x4c25('0x2b')](this[a21_0x4c25('0x12')]));let _0xf95817=a21_0x4c25('0x5b')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x5ed4c6 in this[a21_0x4c25('0x11')]){const _0x46b467=this[a21_0x4c25('0x11')][_0x5ed4c6]['path'];const _0x378510=this[a21_0x4c25('0x11')][_0x5ed4c6][a21_0x4c25('0x32')];const _0xf22764=_0x46b467[a21_0x4c25('0x33')](_0x46b467[a21_0x4c25('0x5c')]('/')+0x1);let _0x8f35b=_0xf22764[a21_0x4c25('0x3e')]('.')[a21_0x4c25('0x3f')](0x0,-0x1)[a21_0x4c25('0x40')]('.');if(_0x378510=='youtube_single'){_0x8f35b=_0x46b467;}_0xf95817+=a21_0x4c25('0x5d')+_0x8f35b+'.mp4'+'\x0d\x0a';}fsExtra[a21_0x4c25('0x5e')](this['filesFolder']);fsExtra[a21_0x4c25('0x5f')](this['tempFolder'],this[a21_0x4c25('0xb')]);fs[a21_0x4c25('0x60')](this[a21_0x4c25('0xe')],_0xf95817);fsExtra[a21_0x4c25('0x5e')](this['tempFolder']);console[a21_0x4c25('0x21')](a21_0x4c25('0x61'));const _0x31dc83=spawn(a21_0x4c25('0x62'),['-r',a21_0x4c25('0x63')]);}}exports[a21_0x4c25('0x64')]=SyncPlaylistsService;