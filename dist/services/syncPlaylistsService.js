var a22_0xd48a=['downloadFiles','currentFile','push','length','No\x20playlist\x20changes','bind','existsSync','removeSync','error','download','this.currentFile:\x20','finishProcess','path','media_type','substring','downloadYouTube','downloadHTTPFile','Attempting\x20to\x20download\x20','\x20to\x20','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','downloadFile\x20callback\x20result\x20undefined:\x20','globalAgent','host','pathname','get','\x20Progress:\x20','statusCode','headers','content-length','stat','Have\x20already\x20downloaded\x20','size','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','pipe','data','err:\x20','finish','Downloaded\x20','location','Redirect\x20limit\x20encountered\x20for\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','Error\x20Downloading:\x20','downloadHTTPFileCallback','duration','createImageVideo','video','downloadRequestFile','progress','Error\x20downloading\x20file','Downloaded:\x20','mediaType:\x20','image','createWriteStream','slice','join','ffmpeg','1/2','-loop','-pattern_type','glob','-c:v','-pix_fmt','yuv420p','-vf','scale=1920:1080','stdout','stderr','stderr:\x20','finished\x20mp4\x20convert','info','Download\x20started','filename:\x20','size:\x20','complete','\x20already\x20downloaded.','end','finished\x20youtube\x20downloading!','.mp4','#EXTCPlayListM3U::M3U','lastIndexOf','split','youtube_single','emptyDirSync','copySync','m3uFile','shutdown','now','SyncPlaylistsService','defineProperty','url','http','fs-extra','request-progress','child_process','spawn','string-template','youtube-dl','config.json','context.json','mediaFolder','media/','tempFolder','temp/','files/','playListFile','playlist.txt','lulo_playlist.m3u','newPlayList','httpClientService','HttpClientService','init','config','parse','readFileSync','playerId','baseURL','env','WEB_SERVICE_URL','deploy/','playListServiceURL','api/player_playlist.php?player_id={0}','registerClient','loadMediaList','deviceUuid','writeFileSync','stringify','networkInterfaces','context','post','http://restapi.lulo.run/player_devices/register','parsedBody','log','catch','checkFolders','ensureDir','filesFolder','hasPlayListChanged'];(function(_0x10f6a9,_0x596eed){var _0x1001f8=function(_0x76beb3){while(--_0x76beb3){_0x10f6a9['push'](_0x10f6a9['shift']());}};_0x1001f8(++_0x596eed);}(a22_0xd48a,0x176));var a22_0x8da9=function(_0x185dc7,_0x3cb405){_0x185dc7=_0x185dc7-0x0;var _0x986af5=a22_0xd48a[_0x185dc7];return _0x986af5;};'use strict';Object[a22_0x8da9('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('../infrastructure/HttpClientService');const fs=require('fs');const url=require(a22_0x8da9('0x1'));const http=require(a22_0x8da9('0x2'));const fsExtra=require(a22_0x8da9('0x3'));const request=require('request');const progress=require(a22_0x8da9('0x4'));const spawn=require(a22_0x8da9('0x5'))[a22_0x8da9('0x6')];const isImage=require('is-image');const format=require(a22_0x8da9('0x7'));const os=require('os');const youtubedl=require(a22_0x8da9('0x8'));const uuidv4=require('uuid/v4');const configFile=a22_0x8da9('0x9');const contextFile=a22_0x8da9('0xa');class SyncPlaylistsService{constructor(){this[a22_0x8da9('0xb')]=a22_0x8da9('0xc');this[a22_0x8da9('0xd')]=this[a22_0x8da9('0xb')]+a22_0x8da9('0xe');this['filesFolder']=this[a22_0x8da9('0xb')]+a22_0x8da9('0xf');this[a22_0x8da9('0x10')]=this['mediaFolder']+a22_0x8da9('0x11');this['m3uFile']=this['filesFolder']+a22_0x8da9('0x12');this['currentFile']=0x0;this['downloadFiles']=[];this[a22_0x8da9('0x13')]={};this[a22_0x8da9('0x14')]=new HttpClientService_1[(a22_0x8da9('0x15'))]();}[a22_0x8da9('0x16')](){this[a22_0x8da9('0x17')]=JSON[a22_0x8da9('0x18')](fs[a22_0x8da9('0x19')](configFile));this['context']=JSON[a22_0x8da9('0x18')](fs[a22_0x8da9('0x19')](contextFile));this['playerId']=this[a22_0x8da9('0x17')][a22_0x8da9('0x1a')];this[a22_0x8da9('0x1b')]=process[a22_0x8da9('0x1c')][a22_0x8da9('0x1d')]+a22_0x8da9('0x1e');this[a22_0x8da9('0x1f')]=this['baseURL']+a22_0x8da9('0x20');this[a22_0x8da9('0x21')]();this['checkFolders']();this[a22_0x8da9('0x22')]();}['registerClient'](){const _0x355f10=this[a22_0x8da9('0x17')][a22_0x8da9('0x23')];if(!_0x355f10||_0x355f10==''){this[a22_0x8da9('0x17')][a22_0x8da9('0x23')]=uuidv4();this[a22_0x8da9('0x17')]={'deviceUuid':this['config']['deviceUuid'],'playerId':this[a22_0x8da9('0x17')][a22_0x8da9('0x1a')]};fs[a22_0x8da9('0x24')](configFile,JSON[a22_0x8da9('0x25')](this[a22_0x8da9('0x17')]));}const _0x1a585d={'player_id':this[a22_0x8da9('0x1a')],'device_uuid':this[a22_0x8da9('0x17')][a22_0x8da9('0x23')],'network_info':JSON[a22_0x8da9('0x25')](os[a22_0x8da9('0x26')]()),'firmware_info':JSON['stringify'](this[a22_0x8da9('0x27')]),'status':0x1};this[a22_0x8da9('0x14')][a22_0x8da9('0x28')](a22_0x8da9('0x29'),_0x1a585d,![])['then'](function(_0x1b48b5){console['log'](a22_0x8da9('0x2a'));console[a22_0x8da9('0x2b')](_0x1b48b5);})[a22_0x8da9('0x2c')](function(_0x4344b7){});}[a22_0x8da9('0x2d')](){fsExtra[a22_0x8da9('0x2e')](this[a22_0x8da9('0xb')],_0x5c33be=>{});fsExtra[a22_0x8da9('0x2e')](this['tempFolder'],_0x29cb4a=>{});fsExtra[a22_0x8da9('0x2e')](this[a22_0x8da9('0x2f')],_0xdba4fe=>{});}['loadMediaList'](){const _0xec7d35=format(this[a22_0x8da9('0x1f')],this['playerId']);console[a22_0x8da9('0x2b')](_0xec7d35);request({'url':_0xec7d35,'json':!![]},function(_0x381ff0,_0x3513b2,_0x44b399){console['log'](_0x44b399);this[a22_0x8da9('0x13')]=_0x44b399;if(this[a22_0x8da9('0x30')]()){fsExtra['emptyDirSync'](this[a22_0x8da9('0xd')]);this[a22_0x8da9('0x31')]=[];this[a22_0x8da9('0x32')]=0x0;for(const _0x143de5 in _0x44b399){this['downloadFiles'][a22_0x8da9('0x33')](_0x44b399[_0x143de5]);}console[a22_0x8da9('0x2b')]('Total:\x20'+this[a22_0x8da9('0x31')][a22_0x8da9('0x34')]);if(this[a22_0x8da9('0x31')]['length']>0x0){this['download']();}}else{console[a22_0x8da9('0x2b')](a22_0x8da9('0x35'));}}[a22_0x8da9('0x36')](this));}['reloadMediaList'](){if(fsExtra[a22_0x8da9('0x37')](this[a22_0x8da9('0x10')])){fsExtra[a22_0x8da9('0x38')](this['playListFile']);}this['loadMediaList']();}[a22_0x8da9('0x30')](){const _0x4952ef=JSON[a22_0x8da9('0x25')](this[a22_0x8da9('0x13')]);try{if(!fs['existsSync'](this[a22_0x8da9('0x10')])){return!![];}else{const _0x3b3094=fs[a22_0x8da9('0x19')](this[a22_0x8da9('0x10')])['toString']();if(_0x3b3094!=_0x4952ef){return!![];}}}catch(_0x4ea04e){console[a22_0x8da9('0x39')](_0x4ea04e);}return![];}[a22_0x8da9('0x3a')](){console[a22_0x8da9('0x2b')](a22_0x8da9('0x3b')+this[a22_0x8da9('0x32')]);if(this[a22_0x8da9('0x32')]>=this[a22_0x8da9('0x31')][a22_0x8da9('0x34')]){this[a22_0x8da9('0x3c')]();return;}const _0x3785d5=String(this[a22_0x8da9('0x31')][this[a22_0x8da9('0x32')]][a22_0x8da9('0x3d')]);const _0x502f19=this[a22_0x8da9('0x31')][this[a22_0x8da9('0x32')]][a22_0x8da9('0x3e')];const _0x4c8639=_0x3785d5[a22_0x8da9('0x3f')](_0x3785d5['lastIndexOf']('/')+0x1);const _0x1271bc=this[a22_0x8da9('0x1b')]+_0x3785d5;console[a22_0x8da9('0x2b')]('Downloading:\x20'+_0x1271bc);if(_0x502f19=='youtube_single'){this[a22_0x8da9('0x40')](_0x3785d5);}else{this[a22_0x8da9('0x41')](_0x1271bc,_0x4c8639,_0x502f19,this['downloadHTTPFileCallback']['bind'](this));}}[a22_0x8da9('0x41')](_0xe125d7,_0x303507,_0x39097d,_0x164863){console[a22_0x8da9('0x2b')](a22_0x8da9('0x41'));console[a22_0x8da9('0x2b')](_0xe125d7);const _0x2faf8d=!![];let _0x2b61c4=0x0;const _0x1f2c38='';console['log'](a22_0x8da9('0x42')+_0xe125d7+a22_0x8da9('0x43')+_0x303507);if(_0x2b61c4){if(_0x2b61c4>0x5){_0x164863('Max\x20redirects\x20reached',_0xe125d7,_0x39097d,null);return;}}else{_0x2b61c4=0x0;}const _0x2a6855=this[a22_0x8da9('0xd')]+_0x303507;let _0x144679;if(_0x164863===undefined){console[a22_0x8da9('0x2b')](a22_0x8da9('0x44')+_0xe125d7+'\x20to\x20'+_0x2a6855);_0x164863=function(_0x4e545c,_0x210691){console['log'](a22_0x8da9('0x45'),_0x4e545c,_0x210691);};}http[a22_0x8da9('0x46')]['maxSockets']=0x64;const _0xf70c24={'host':url['parse'](_0xe125d7)[a22_0x8da9('0x47')],'port':0x50,'path':url['parse'](_0xe125d7)[a22_0x8da9('0x48')],'agent':![]};const _0x36d090=http[a22_0x8da9('0x49')](_0xf70c24,function(_0x30401b){let _0x555be1=0x0;let _0x17185e=0x0;function _0x244a9f(){if(_0x555be1===undefined){console[a22_0x8da9('0x2b')](_0x303507+'\x20Progress:\x20unknown\x09'+_0x17185e+'/'+'?');}const _0x1bcf2b=_0x17185e/_0x555be1*0x64;console[a22_0x8da9('0x2b')](_0x303507+a22_0x8da9('0x4a')+_0x1bcf2b+'%\x09'+_0x17185e+'/'+_0x555be1);}console[a22_0x8da9('0x2b')](_0x303507+'\x20'+_0x30401b[a22_0x8da9('0x4b')]);switch(_0x30401b[a22_0x8da9('0x4b')]){case 0xc8:_0x555be1=_0x30401b[a22_0x8da9('0x4c')][a22_0x8da9('0x4d')]||_0x1f2c38;fs[a22_0x8da9('0x4e')](_0x2a6855,function(_0x5e88a2,_0x1dfe53){if(!_0x5e88a2){console[a22_0x8da9('0x2b')](a22_0x8da9('0x4f')+_0x2a6855);if(_0x1dfe53[a22_0x8da9('0x50')]==_0x555be1){console[a22_0x8da9('0x2b')]('And\x20the\x20file\x20size\x20matches\x20('+_0x555be1+')');console[a22_0x8da9('0x2b')]('Redownloading');}else{console[a22_0x8da9('0x2b')](a22_0x8da9('0x51')+_0x1dfe53[a22_0x8da9('0x50')]+a22_0x8da9('0x52')+_0x555be1+')');}}_0x144679=fs['createWriteStream'](_0x2a6855);_0x30401b[a22_0x8da9('0x53')](_0x144679);_0x30401b['on'](a22_0x8da9('0x54'),function(_0x1d0eb3){_0x17185e+=_0x1d0eb3['length'];_0x244a9f();});_0x36d090['on'](a22_0x8da9('0x39'),function(_0x5e88a2){console[a22_0x8da9('0x2b')](a22_0x8da9('0x55'));console[a22_0x8da9('0x2b')](_0x5e88a2);});_0x144679['on'](a22_0x8da9('0x56'),function(){console[a22_0x8da9('0x2b')](a22_0x8da9('0x57')+_0xe125d7+a22_0x8da9('0x43')+_0x303507);_0x164863(null,_0x303507,_0x39097d,_0x303507);}[a22_0x8da9('0x36')](this));});break;case 0x12e:const _0x58a66b=_0x30401b[a22_0x8da9('0x4c')][a22_0x8da9('0x58')];console[a22_0x8da9('0x2b')]('Redirect\x20'+_0xe125d7+a22_0x8da9('0x43')+_0x58a66b);if(_0x2b61c4<0x5){this[a22_0x8da9('0x41')](_0x58a66b,_0x303507,_0x164863,_0x2b61c4++);}else{console[a22_0x8da9('0x39')](a22_0x8da9('0x59')+_0xe125d7+'.');_0x164863(a22_0x8da9('0x5a'),null,null,null);}return;case 0x194:console[a22_0x8da9('0x2b')](a22_0x8da9('0x5b')+_0xe125d7);default:console[a22_0x8da9('0x2b')](a22_0x8da9('0x5c')+_0xe125d7+a22_0x8da9('0x5d')+_0x30401b[a22_0x8da9('0x4b')]);_0x36d090['abort']();_0x164863(_0x30401b['statusCode'],null,null,null);return;}})['on'](a22_0x8da9('0x39'),function(_0x2d5eda){console[a22_0x8da9('0x2b')](a22_0x8da9('0x5e')+_0xe125d7+'\x20'+_0x2d5eda['message']);_0x164863(_0x2d5eda,null,null,null);});}[a22_0x8da9('0x5f')](_0x31071f,_0xf2e6d5,_0x59db52,_0x477831){console[a22_0x8da9('0x2b')](a22_0x8da9('0x5f'));console[a22_0x8da9('0x2b')](_0x31071f);console[a22_0x8da9('0x2b')](_0xf2e6d5);console['log'](_0x59db52);console[a22_0x8da9('0x2b')](_0x477831);if(_0x59db52=='image'){const _0x43397c=this[a22_0x8da9('0x31')][this['currentFile']][a22_0x8da9('0x60')]!=null?this['downloadFiles'][this[a22_0x8da9('0x32')]][a22_0x8da9('0x60')]:0x1e;this[a22_0x8da9('0x61')](_0x477831,_0x43397c);}else if(_0x59db52==a22_0x8da9('0x62')){if(_0x31071f==null&&_0xf2e6d5!=''){this[a22_0x8da9('0x32')]++;}this['download']();}console[a22_0x8da9('0x2b')](this[a22_0x8da9('0x32')]);}[a22_0x8da9('0x63')](_0x5906bf,_0x5b45f1,_0x2f5e4e){progress(request(_0x5906bf),{})['on'](a22_0x8da9('0x64'),function(_0x5d46b9){console[a22_0x8da9('0x2b')](_0x5d46b9);})['on'](a22_0x8da9('0x39'),function(_0x3d5845){console[a22_0x8da9('0x2b')](a22_0x8da9('0x65'));this['download']();})['on']('end',function(){console[a22_0x8da9('0x2b')](a22_0x8da9('0x66')+_0x5b45f1);console[a22_0x8da9('0x2b')](a22_0x8da9('0x67')+_0x2f5e4e);if(_0x2f5e4e==a22_0x8da9('0x68')){const _0x2098e5=this[a22_0x8da9('0x31')][this[a22_0x8da9('0x32')]][a22_0x8da9('0x60')]!=null?this['downloadFiles'][this[a22_0x8da9('0x32')]][a22_0x8da9('0x60')]:0x1e;this[a22_0x8da9('0x61')](_0x5b45f1,_0x2098e5);}else if(_0x2f5e4e=='video'){this['currentFile']++;this[a22_0x8da9('0x3a')]();}}[a22_0x8da9('0x36')](this))[a22_0x8da9('0x53')](fs[a22_0x8da9('0x69')](this[a22_0x8da9('0xd')]+_0x5b45f1));}['createImageVideo'](_0x15d205,_0x2e186e=0x1e){const _0x19c470=this['tempFolder']+_0x15d205;console[a22_0x8da9('0x2b')](_0x19c470);console[a22_0x8da9('0x2b')](_0x15d205);const _0x31e49d=_0x15d205['split']('.')[a22_0x8da9('0x6a')](0x0,-0x1)[a22_0x8da9('0x6b')]('.');const _0x56b2f3=a22_0x8da9('0x6c');const _0x558653=['-y','-r',a22_0x8da9('0x6d'),a22_0x8da9('0x6e'),'1',a22_0x8da9('0x6f'),a22_0x8da9('0x70'),'-i',_0x19c470,'-t',String(_0x2e186e),a22_0x8da9('0x71'),'libx264',a22_0x8da9('0x72'),a22_0x8da9('0x73'),'-r','25',a22_0x8da9('0x74'),a22_0x8da9('0x75'),this[a22_0x8da9('0xd')]+_0x31e49d+'.mp4'];const _0x15a835=spawn(_0x56b2f3,_0x558653);_0x15a835[a22_0x8da9('0x76')]['on'](a22_0x8da9('0x54'),function(_0x2960ad){console[a22_0x8da9('0x2b')]('Converting\x20'+_0x19c470);});_0x15a835[a22_0x8da9('0x77')]['on']('data',function(_0x2d62c6){console[a22_0x8da9('0x2b')](a22_0x8da9('0x78')+_0x2d62c6);}[a22_0x8da9('0x36')](this));_0x15a835['on']('close',function(){console[a22_0x8da9('0x2b')](a22_0x8da9('0x79'));this[a22_0x8da9('0x32')]++;this[a22_0x8da9('0x3a')]();}[a22_0x8da9('0x36')](this));}[a22_0x8da9('0x40')](_0x41e901){const _0x5b26df=youtubedl('http://www.youtube.com/watch?v='+_0x41e901,['--format=18'],{'cwd':__dirname});_0x5b26df['on'](a22_0x8da9('0x7a'),function(_0xde1d1f){console[a22_0x8da9('0x2b')](a22_0x8da9('0x7b'));console[a22_0x8da9('0x2b')](a22_0x8da9('0x7c')+_0xde1d1f['_filename']);console['log'](a22_0x8da9('0x7d')+_0xde1d1f[a22_0x8da9('0x50')]);});_0x5b26df['on'](a22_0x8da9('0x7e'),function complete(_0x266efd){'use strict';console['log'](a22_0x8da9('0x7c')+_0x266efd['_filename']+a22_0x8da9('0x7f'));});_0x5b26df['on'](a22_0x8da9('0x80'),function(){console[a22_0x8da9('0x2b')](a22_0x8da9('0x81'));this['currentFile']++;this[a22_0x8da9('0x3a')]();}['bind'](this));_0x5b26df[a22_0x8da9('0x53')](fs['createWriteStream'](this[a22_0x8da9('0xd')]+'/'+_0x41e901+a22_0x8da9('0x82')));}['finishProcess'](){fs[a22_0x8da9('0x24')](this['playListFile'],JSON[a22_0x8da9('0x25')](this[a22_0x8da9('0x13')]));let _0xdc238e=a22_0x8da9('0x83')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x509840 in this['downloadFiles']){const _0x2defda=this[a22_0x8da9('0x31')][_0x509840]['path'];const _0x28c5d7=this[a22_0x8da9('0x31')][_0x509840][a22_0x8da9('0x3e')];const _0x29c314=_0x2defda[a22_0x8da9('0x3f')](_0x2defda[a22_0x8da9('0x84')]('/')+0x1);let _0x8cfd3c=_0x29c314[a22_0x8da9('0x85')]('.')[a22_0x8da9('0x6a')](0x0,-0x1)[a22_0x8da9('0x6b')]('.');if(_0x28c5d7==a22_0x8da9('0x86')){_0x8cfd3c=_0x2defda;}_0xdc238e+='/home/osmc/luloclient/media/files/'+_0x8cfd3c+a22_0x8da9('0x82')+'\x0d\x0a';}fsExtra[a22_0x8da9('0x87')](this[a22_0x8da9('0x2f')]);fsExtra[a22_0x8da9('0x88')](this[a22_0x8da9('0xd')],this[a22_0x8da9('0x2f')]);fs[a22_0x8da9('0x24')](this[a22_0x8da9('0x89')],_0xdc238e);fsExtra[a22_0x8da9('0x87')](this['tempFolder']);console['log']('Finished');const _0x5d8bb1=spawn(a22_0x8da9('0x8a'),['-r',a22_0x8da9('0x8b')]);}}exports[a22_0x8da9('0x8c')]=SyncPlaylistsService;