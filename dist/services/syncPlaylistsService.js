var a22_0x24c8=['#EXTINF:0,luloPlayList','lastIndexOf','/home/osmc/luloclient/media/files/','emptyDirSync','Finished','shutdown','now','SyncPlaylistsService','defineProperty','../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','is-image','string-template','youtube-dl','uuid/v4','config.json','context.json','mediaFolder','media/','temp/','files/','playListFile','m3uFile','currentFile','downloadFiles','newPlayList','httpClientService','HttpClientService','init','config','readFileSync','context','parse','playerId','baseURL','env','api/player_playlist.php?player_id={0}','checkFolders','loadMediaList','registerClient','deviceUuid','writeFileSync','stringify','then','parsedBody','ensureDir','tempFolder','filesFolder','playListServiceURL','log','hasPlayListChanged','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','existsSync','removeSync','toString','error','this.currentFile:\x20','path','media_type','substring','youtube_single','downloadHTTPFile','downloadHTTPFileCallback','Attempting\x20to\x20download\x20','\x20to\x20','Max\x20redirects\x20reached','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','downloadFile\x20callback\x20result\x20undefined:\x20','get','\x20Progress:\x20unknown\x09','\x20Progress:\x20','statusCode','headers','stat','size','And\x20the\x20file\x20size\x20matches\x20(','Redownloading','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(','createWriteStream','data','err:\x20','finish','Downloaded\x20','location','Redirect\x20','Redirect\x20limit\x20encountered\x20for\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','image','duration','createImageVideo','video','downloadRequestFile','progress','end','Downloaded:\x20','mediaType:\x20','pipe','split','slice','join','ffmpeg','1/2','-loop','-pattern_type','glob','-c:v','libx264','-pix_fmt','yuv420p','scale=1920:1080','stdout','Converting\x20','stderr:\x20','close','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','--format=18','info','_filename','complete','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','.mp4','#EXTCPlayListM3U::M3U'];(function(_0x5a6ab1,_0x1e80ff){var _0x55a514=function(_0x5b93c4){while(--_0x5b93c4){_0x5a6ab1['push'](_0x5a6ab1['shift']());}};_0x55a514(++_0x1e80ff);}(a22_0x24c8,0x93));var a22_0x4a91=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=a22_0x24c8[_0xb67384];return _0x156d7c;};'use strict';Object[a22_0x4a91('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a22_0x4a91('0x1'));const fs=require('fs');const http=require('http');const fsExtra=require(a22_0x4a91('0x2'));const request=require('request');const progress=require(a22_0x4a91('0x3'));const spawn=require(a22_0x4a91('0x4'))[a22_0x4a91('0x5')];const isImage=require(a22_0x4a91('0x6'));const format=require(a22_0x4a91('0x7'));const os=require('os');const youtubedl=require(a22_0x4a91('0x8'));const uuidv4=require(a22_0x4a91('0x9'));const configFile=a22_0x4a91('0xa');const contextFile=a22_0x4a91('0xb');class SyncPlaylistsService{constructor(){this[a22_0x4a91('0xc')]=a22_0x4a91('0xd');this['tempFolder']=this['mediaFolder']+a22_0x4a91('0xe');this['filesFolder']=this[a22_0x4a91('0xc')]+a22_0x4a91('0xf');this[a22_0x4a91('0x10')]=this[a22_0x4a91('0xc')]+'playlist.txt';this[a22_0x4a91('0x11')]=this['filesFolder']+'lulo_playlist.m3u';this[a22_0x4a91('0x12')]=0x0;this[a22_0x4a91('0x13')]=[];this[a22_0x4a91('0x14')]={};this[a22_0x4a91('0x15')]=new HttpClientService_1[(a22_0x4a91('0x16'))]();}[a22_0x4a91('0x17')](){this[a22_0x4a91('0x18')]=JSON['parse'](fs[a22_0x4a91('0x19')](configFile));this[a22_0x4a91('0x1a')]=JSON[a22_0x4a91('0x1b')](fs[a22_0x4a91('0x19')](contextFile));this[a22_0x4a91('0x1c')]=this[a22_0x4a91('0x18')][a22_0x4a91('0x1c')];this[a22_0x4a91('0x1d')]=process[a22_0x4a91('0x1e')]['WEB_SERVICE_URL']+'deploy/';this['playListServiceURL']=this['baseURL']+a22_0x4a91('0x1f');this['registerClient']();this[a22_0x4a91('0x20')]();this[a22_0x4a91('0x21')]();}[a22_0x4a91('0x22')](){const _0x32a590=this['config'][a22_0x4a91('0x23')];if(!_0x32a590||_0x32a590==''){this[a22_0x4a91('0x18')]['deviceUuid']=uuidv4();this[a22_0x4a91('0x18')]={'deviceUuid':this['config'][a22_0x4a91('0x23')],'playerId':this[a22_0x4a91('0x18')][a22_0x4a91('0x1c')]};fs[a22_0x4a91('0x24')](configFile,JSON[a22_0x4a91('0x25')](this[a22_0x4a91('0x18')]));}const _0x54e6da={'player_id':this[a22_0x4a91('0x1c')],'device_uuid':this[a22_0x4a91('0x18')]['deviceUuid'],'network_info':JSON[a22_0x4a91('0x25')](os['networkInterfaces']()),'firmware_info':JSON['stringify'](this[a22_0x4a91('0x1a')]),'status':0x1};this[a22_0x4a91('0x15')]['post']('http://restapi.lulo.run/player_devices/register',_0x54e6da,![])[a22_0x4a91('0x26')](function(_0x39aa9a){console['log'](a22_0x4a91('0x27'));console['log'](_0x39aa9a);})['catch'](function(_0x5758a8){});}[a22_0x4a91('0x20')](){fsExtra[a22_0x4a91('0x28')](this[a22_0x4a91('0xc')],_0x2706d3=>{});fsExtra[a22_0x4a91('0x28')](this[a22_0x4a91('0x29')],_0x485105=>{});fsExtra[a22_0x4a91('0x28')](this[a22_0x4a91('0x2a')],_0x1fff9e=>{});}['loadMediaList'](){const _0x4b98fe=format(this[a22_0x4a91('0x2b')],this[a22_0x4a91('0x1c')]);console[a22_0x4a91('0x2c')](_0x4b98fe);request({'url':_0x4b98fe,'json':!![]},function(_0x18fae7,_0x419ca9,_0x15473c){console[a22_0x4a91('0x2c')](_0x15473c);this[a22_0x4a91('0x14')]=_0x15473c;if(this[a22_0x4a91('0x2d')]()){fsExtra['emptyDirSync'](this['tempFolder']);this[a22_0x4a91('0x13')]=[];this[a22_0x4a91('0x12')]=0x0;for(const _0x5f9979 in _0x15473c){this['downloadFiles'][a22_0x4a91('0x2e')](_0x15473c[_0x5f9979]);}console[a22_0x4a91('0x2c')](a22_0x4a91('0x2f')+this[a22_0x4a91('0x13')][a22_0x4a91('0x30')]);if(this[a22_0x4a91('0x13')][a22_0x4a91('0x30')]>0x0){this[a22_0x4a91('0x31')]();}}else{console[a22_0x4a91('0x2c')](a22_0x4a91('0x32'));}}[a22_0x4a91('0x33')](this));}[a22_0x4a91('0x34')](){if(fsExtra[a22_0x4a91('0x35')](this['playListFile'])){fsExtra[a22_0x4a91('0x36')](this['playListFile']);}this[a22_0x4a91('0x21')]();}[a22_0x4a91('0x2d')](){const _0x4b7f4f=JSON[a22_0x4a91('0x25')](this[a22_0x4a91('0x14')]);try{if(!fs[a22_0x4a91('0x35')](this[a22_0x4a91('0x10')])){return!![];}else{const _0x26fa69=fs['readFileSync'](this[a22_0x4a91('0x10')])[a22_0x4a91('0x37')]();if(_0x26fa69!=_0x4b7f4f){return!![];}}}catch(_0x25920b){console[a22_0x4a91('0x38')](_0x25920b);}return![];}[a22_0x4a91('0x31')](){console[a22_0x4a91('0x2c')](a22_0x4a91('0x39')+this[a22_0x4a91('0x12')]);if(this[a22_0x4a91('0x12')]>=this[a22_0x4a91('0x13')][a22_0x4a91('0x30')]){this['finishProcess']();return;}const _0x530704=String(this[a22_0x4a91('0x13')][this[a22_0x4a91('0x12')]][a22_0x4a91('0x3a')]);const _0xbdcc46=this[a22_0x4a91('0x13')][this[a22_0x4a91('0x12')]][a22_0x4a91('0x3b')];const _0x25a3a9=_0x530704[a22_0x4a91('0x3c')](_0x530704['lastIndexOf']('/')+0x1);const _0x49e80d=this[a22_0x4a91('0x1d')]+_0x530704;console[a22_0x4a91('0x2c')]('Downloading:\x20'+_0x49e80d);if(_0xbdcc46==a22_0x4a91('0x3d')){this['downloadYouTube'](_0x530704);}else{this[a22_0x4a91('0x3e')](_0x49e80d,_0x25a3a9,_0xbdcc46,this[a22_0x4a91('0x3f')][a22_0x4a91('0x33')](this));}}[a22_0x4a91('0x3e')](_0x25dabe,_0x46af85,_0x55034c,_0x58499a){console[a22_0x4a91('0x2c')](a22_0x4a91('0x3e'));console[a22_0x4a91('0x2c')](_0x25dabe);const _0x2fc178=!![];let _0x161272=0x0;const _0x35e017='';console['log'](a22_0x4a91('0x40')+_0x25dabe+a22_0x4a91('0x41')+_0x46af85);if(_0x161272){if(_0x161272>0x5){_0x58499a(a22_0x4a91('0x42'),_0x25dabe,_0x55034c,null);return;}}else{_0x161272=0x0;}const _0x3d76dd=this['tempFolder']+_0x46af85;let _0x316d1f;if(_0x58499a===undefined){console[a22_0x4a91('0x2c')](a22_0x4a91('0x43')+_0x25dabe+a22_0x4a91('0x41')+_0x3d76dd);_0x58499a=function(_0x4f1f70,_0x23c014){console[a22_0x4a91('0x2c')](a22_0x4a91('0x44'),_0x4f1f70,_0x23c014);};}const _0x57a60a=http[a22_0x4a91('0x45')](_0x25dabe,function(_0x402d46){let _0x2e2c33=0x0;let _0x32dc54=0x0;function _0x1511ad(){if(_0x2e2c33===undefined){console[a22_0x4a91('0x2c')](_0x46af85+a22_0x4a91('0x46')+_0x32dc54+'/'+'?');}const _0x56895a=_0x32dc54/_0x2e2c33*0x64;console[a22_0x4a91('0x2c')](_0x46af85+a22_0x4a91('0x47')+_0x56895a+'%\x09'+_0x32dc54+'/'+_0x2e2c33);}console[a22_0x4a91('0x2c')](_0x46af85+'\x20'+_0x402d46[a22_0x4a91('0x48')]);switch(_0x402d46[a22_0x4a91('0x48')]){case 0xc8:_0x2e2c33=_0x402d46[a22_0x4a91('0x49')]['content-length']||_0x35e017;fs[a22_0x4a91('0x4a')](_0x3d76dd,function(_0x4b01a8,_0x2f1519){if(!_0x4b01a8){console[a22_0x4a91('0x2c')]('Have\x20already\x20downloaded\x20'+_0x3d76dd);if(_0x2f1519[a22_0x4a91('0x4b')]==_0x2e2c33){console[a22_0x4a91('0x2c')](a22_0x4a91('0x4c')+_0x2e2c33+')');console['log'](a22_0x4a91('0x4d'));}else{console[a22_0x4a91('0x2c')](a22_0x4a91('0x4e')+_0x2f1519['size']+')\x20vs\x20New('+_0x2e2c33+')');}}_0x316d1f=fs[a22_0x4a91('0x4f')](_0x3d76dd);_0x402d46['pipe'](_0x316d1f);_0x402d46['on'](a22_0x4a91('0x50'),function(_0x391e63){_0x32dc54+=_0x391e63['length'];_0x1511ad();});_0x57a60a['on'](a22_0x4a91('0x38'),function(_0x4b01a8){console[a22_0x4a91('0x2c')](a22_0x4a91('0x51'));console[a22_0x4a91('0x2c')](_0x4b01a8);});_0x316d1f['on'](a22_0x4a91('0x52'),function(){console[a22_0x4a91('0x2c')](a22_0x4a91('0x53')+_0x25dabe+a22_0x4a91('0x41')+_0x46af85);_0x58499a(null,_0x46af85,_0x55034c,_0x46af85);}[a22_0x4a91('0x33')](this));});break;case 0x12e:const _0x2ffefd=_0x402d46['headers'][a22_0x4a91('0x54')];console[a22_0x4a91('0x2c')](a22_0x4a91('0x55')+_0x25dabe+a22_0x4a91('0x41')+_0x2ffefd);if(_0x161272<0x5){this['downloadHTTPFile'](_0x2ffefd,_0x46af85,_0x58499a,_0x161272++);}else{console[a22_0x4a91('0x38')](a22_0x4a91('0x56')+_0x25dabe+'.');_0x58499a(a22_0x4a91('0x57'),null,null,null);}return;case 0x194:console[a22_0x4a91('0x2c')](a22_0x4a91('0x58')+_0x25dabe);default:console[a22_0x4a91('0x2c')](a22_0x4a91('0x59')+_0x25dabe+a22_0x4a91('0x5a')+_0x402d46[a22_0x4a91('0x48')]);_0x57a60a[a22_0x4a91('0x5b')]();_0x58499a(_0x402d46[a22_0x4a91('0x48')],null,null,null);return;}})['on']('error',function(_0x3e67a2){console[a22_0x4a91('0x2c')](a22_0x4a91('0x5c')+_0x25dabe+'\x20'+_0x3e67a2[a22_0x4a91('0x5d')]);_0x58499a(_0x3e67a2,null,null,null);});}['downloadHTTPFileCallback'](_0x416649,_0xefcd0a,_0x55dff6,_0xcade2c){console[a22_0x4a91('0x2c')]('downloadHTTPFileCallback');console[a22_0x4a91('0x2c')](_0x416649);console[a22_0x4a91('0x2c')](_0xefcd0a);console[a22_0x4a91('0x2c')](_0x55dff6);console[a22_0x4a91('0x2c')](_0xcade2c);if(_0x55dff6==a22_0x4a91('0x5e')){const _0x9b3ac2=this[a22_0x4a91('0x13')][this[a22_0x4a91('0x12')]][a22_0x4a91('0x5f')]!=null?this[a22_0x4a91('0x13')][this[a22_0x4a91('0x12')]][a22_0x4a91('0x5f')]:0x1e;this[a22_0x4a91('0x60')](_0xcade2c,_0x9b3ac2);}else if(_0x55dff6==a22_0x4a91('0x61')){if(_0x416649==null&&_0xefcd0a!=''){this[a22_0x4a91('0x12')]++;}this[a22_0x4a91('0x31')]();}console[a22_0x4a91('0x2c')](this['currentFile']);}[a22_0x4a91('0x62')](_0x36eb28,_0x21bac3,_0x12cb4e){progress(request(_0x36eb28),{})['on'](a22_0x4a91('0x63'),function(_0x30b805){console[a22_0x4a91('0x2c')](_0x30b805);})['on'](a22_0x4a91('0x38'),function(_0x2e157f){console[a22_0x4a91('0x2c')]('Error\x20downloading\x20file');this[a22_0x4a91('0x31')]();})['on'](a22_0x4a91('0x64'),function(){console[a22_0x4a91('0x2c')](a22_0x4a91('0x65')+_0x21bac3);console['log'](a22_0x4a91('0x66')+_0x12cb4e);if(_0x12cb4e=='image'){const _0x5c6e99=this[a22_0x4a91('0x13')][this['currentFile']][a22_0x4a91('0x5f')]!=null?this[a22_0x4a91('0x13')][this[a22_0x4a91('0x12')]][a22_0x4a91('0x5f')]:0x1e;this[a22_0x4a91('0x60')](_0x21bac3,_0x5c6e99);}else if(_0x12cb4e==a22_0x4a91('0x61')){this[a22_0x4a91('0x12')]++;this[a22_0x4a91('0x31')]();}}['bind'](this))[a22_0x4a91('0x67')](fs[a22_0x4a91('0x4f')](this[a22_0x4a91('0x29')]+_0x21bac3));}[a22_0x4a91('0x60')](_0x359a3b,_0xda8004=0x1e){const _0x43642c=this['tempFolder']+_0x359a3b;console['log'](_0x43642c);console[a22_0x4a91('0x2c')](_0x359a3b);const _0x351e9c=_0x359a3b[a22_0x4a91('0x68')]('.')[a22_0x4a91('0x69')](0x0,-0x1)[a22_0x4a91('0x6a')]('.');const _0x2d0e3f=a22_0x4a91('0x6b');const _0x354580=['-y','-r',a22_0x4a91('0x6c'),a22_0x4a91('0x6d'),'1',a22_0x4a91('0x6e'),a22_0x4a91('0x6f'),'-i',_0x43642c,'-t',String(_0xda8004),a22_0x4a91('0x70'),a22_0x4a91('0x71'),a22_0x4a91('0x72'),a22_0x4a91('0x73'),'-r','25','-vf',a22_0x4a91('0x74'),this[a22_0x4a91('0x29')]+_0x351e9c+'.mp4'];const _0x35daa2=spawn(_0x2d0e3f,_0x354580);_0x35daa2[a22_0x4a91('0x75')]['on']('data',function(_0x40592d){console[a22_0x4a91('0x2c')](a22_0x4a91('0x76')+_0x43642c);});_0x35daa2['stderr']['on'](a22_0x4a91('0x50'),function(_0x30efc4){console['log'](a22_0x4a91('0x77')+_0x30efc4);}[a22_0x4a91('0x33')](this));_0x35daa2['on'](a22_0x4a91('0x78'),function(){console[a22_0x4a91('0x2c')](a22_0x4a91('0x79'));this[a22_0x4a91('0x12')]++;this['download']();}[a22_0x4a91('0x33')](this));}['downloadYouTube'](_0x1ea5d3){const _0x17b6cd=youtubedl(a22_0x4a91('0x7a')+_0x1ea5d3,[a22_0x4a91('0x7b')],{'cwd':__dirname});_0x17b6cd['on'](a22_0x4a91('0x7c'),function(_0x3b1ae3){console[a22_0x4a91('0x2c')]('Download\x20started');console[a22_0x4a91('0x2c')]('filename:\x20'+_0x3b1ae3[a22_0x4a91('0x7d')]);console[a22_0x4a91('0x2c')]('size:\x20'+_0x3b1ae3[a22_0x4a91('0x4b')]);});_0x17b6cd['on'](a22_0x4a91('0x7e'),function complete(_0x17a074){'use strict';console[a22_0x4a91('0x2c')]('filename:\x20'+_0x17a074[a22_0x4a91('0x7d')]+a22_0x4a91('0x7f'));});_0x17b6cd['on'](a22_0x4a91('0x64'),function(){console[a22_0x4a91('0x2c')](a22_0x4a91('0x80'));this['currentFile']++;this['download']();}[a22_0x4a91('0x33')](this));_0x17b6cd['pipe'](fs[a22_0x4a91('0x4f')](this[a22_0x4a91('0x29')]+'/'+_0x1ea5d3+a22_0x4a91('0x81')));}['finishProcess'](){fs[a22_0x4a91('0x24')](this[a22_0x4a91('0x10')],JSON['stringify'](this[a22_0x4a91('0x14')]));let _0x2c0dfd=a22_0x4a91('0x82')+'\x0d\x0a'+a22_0x4a91('0x83')+'\x0d\x0a';for(const _0x507d45 in this[a22_0x4a91('0x13')]){const _0x1783b9=this[a22_0x4a91('0x13')][_0x507d45][a22_0x4a91('0x3a')];const _0x289542=this[a22_0x4a91('0x13')][_0x507d45][a22_0x4a91('0x3b')];const _0x4c8658=_0x1783b9[a22_0x4a91('0x3c')](_0x1783b9[a22_0x4a91('0x84')]('/')+0x1);let _0x15a4c4=_0x4c8658['split']('.')[a22_0x4a91('0x69')](0x0,-0x1)[a22_0x4a91('0x6a')]('.');if(_0x289542==a22_0x4a91('0x3d')){_0x15a4c4=_0x1783b9;}_0x2c0dfd+=a22_0x4a91('0x85')+_0x15a4c4+a22_0x4a91('0x81')+'\x0d\x0a';}fsExtra[a22_0x4a91('0x86')](this['filesFolder']);fsExtra['copySync'](this[a22_0x4a91('0x29')],this['filesFolder']);fs[a22_0x4a91('0x24')](this[a22_0x4a91('0x11')],_0x2c0dfd);fsExtra[a22_0x4a91('0x86')](this[a22_0x4a91('0x29')]);console['log'](a22_0x4a91('0x87'));const _0x223e90=spawn(a22_0x4a91('0x88'),['-r',a22_0x4a91('0x89')]);}}exports[a22_0x4a91('0x8a')]=SyncPlaylistsService;