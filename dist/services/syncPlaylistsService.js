var a22_0x9ba5=['info','Download\x20started','filename:\x20','_filename','size','complete','finished\x20youtube\x20downloading!','pipe','.mp4','#EXTCPlayListM3U::M3U','slice','youtube_single','Finished','now','SyncPlaylistsService','defineProperty','__esModule','../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','string-template','uuid/v4','config.json','mediaFolder','media/','temp/','filesFolder','files/','playListFile','playlist.txt','m3uFile','lulo_playlist.m3u','currentFile','downloadFiles','httpClientService','HttpClientService','config','parse','readFileSync','context','playerId','env','WEB_SERVICE_URL','deploy/','playListServiceURL','baseURL','api/player_playlist.php?player_id={0}','registerClient','checkFolders','deviceUuid','writeFileSync','stringify','networkInterfaces','post','http://restapi.lulo.run/player_devices/register','then','log','catch','ensureDir','tempFolder','newPlayList','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','exist','loadMediaList','hasPlayListChanged','existsSync','error','this.currentFile:\x20','finishProcess','path','media_type','substring','lastIndexOf','Downloading:\x20','downloadYouTube','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','image','duration','createImageVideo','createWriteStream','split','join','1/2','-loop','-pattern_type','glob','-c:v','libx264','-pix_fmt','yuv420p','-vf','scale=1920:1080','stdout','data','Converting\x20','close','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','--format=18'];(function(_0x34f3ee,_0x8bd40f){var _0x59163f=function(_0x503a70){while(--_0x503a70){_0x34f3ee['push'](_0x34f3ee['shift']());}};_0x59163f(++_0x8bd40f);}(a22_0x9ba5,0x1c3));var a22_0xef6c=function(_0x5d4cac,_0x1ec44a){_0x5d4cac=_0x5d4cac-0x0;var _0x1f5dc7=a22_0x9ba5[_0x5d4cac];return _0x1f5dc7;};'use strict';Object[a22_0xef6c('0x0')](exports,a22_0xef6c('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0xef6c('0x2'));const fs=require('fs');const fsExtra=require(a22_0xef6c('0x3'));const request=require(a22_0xef6c('0x4'));const progress=require('request-progress');const spawn=require(a22_0xef6c('0x5'))[a22_0xef6c('0x6')];const isImage=require('is-image');const format=require(a22_0xef6c('0x7'));const os=require('os');const youtubedl=require('youtube-dl');const uuidv4=require(a22_0xef6c('0x8'));const configFile=a22_0xef6c('0x9');const contextFile='context.json';class SyncPlaylistsService{constructor(){this[a22_0xef6c('0xa')]=a22_0xef6c('0xb');this['tempFolder']=this[a22_0xef6c('0xa')]+a22_0xef6c('0xc');this[a22_0xef6c('0xd')]=this['mediaFolder']+a22_0xef6c('0xe');this[a22_0xef6c('0xf')]=this[a22_0xef6c('0xa')]+a22_0xef6c('0x10');this[a22_0xef6c('0x11')]=this[a22_0xef6c('0xd')]+a22_0xef6c('0x12');this[a22_0xef6c('0x13')]=0x0;this[a22_0xef6c('0x14')]=[];this['newPlayList']={};this[a22_0xef6c('0x15')]=new HttpClientService_1[(a22_0xef6c('0x16'))]();}['init'](){this[a22_0xef6c('0x17')]=JSON[a22_0xef6c('0x18')](fs[a22_0xef6c('0x19')](configFile));this[a22_0xef6c('0x1a')]=JSON[a22_0xef6c('0x18')](fs[a22_0xef6c('0x19')](contextFile));this[a22_0xef6c('0x1b')]=this[a22_0xef6c('0x17')][a22_0xef6c('0x1b')];this['baseURL']=process[a22_0xef6c('0x1c')][a22_0xef6c('0x1d')]+a22_0xef6c('0x1e');this[a22_0xef6c('0x1f')]=this[a22_0xef6c('0x20')]+a22_0xef6c('0x21');this[a22_0xef6c('0x22')]();this[a22_0xef6c('0x23')]();this['loadMediaList']();}['registerClient'](){const _0x1f5f37=this[a22_0xef6c('0x17')][a22_0xef6c('0x24')];if(!_0x1f5f37||_0x1f5f37==''){this[a22_0xef6c('0x17')][a22_0xef6c('0x24')]=uuidv4();this[a22_0xef6c('0x17')]={'deviceUuid':this[a22_0xef6c('0x17')][a22_0xef6c('0x24')],'playerId':this[a22_0xef6c('0x17')][a22_0xef6c('0x1b')]};fs[a22_0xef6c('0x25')](configFile,JSON['stringify'](this['config']));}const _0x5daf9d={'player_id':this['playerId'],'device_uuid':this[a22_0xef6c('0x17')][a22_0xef6c('0x24')],'network_info':JSON[a22_0xef6c('0x26')](os[a22_0xef6c('0x27')]()),'firmware_info':JSON[a22_0xef6c('0x26')](this[a22_0xef6c('0x1a')]),'status':0x1};this['httpClientService'][a22_0xef6c('0x28')](a22_0xef6c('0x29'),_0x5daf9d,![])[a22_0xef6c('0x2a')](function(_0x34b115){console['log']('parsedBody');console[a22_0xef6c('0x2b')](_0x34b115);})[a22_0xef6c('0x2c')](function(_0x15bec2){});}[a22_0xef6c('0x23')](){fsExtra['ensureDir'](this[a22_0xef6c('0xa')],_0x4e83d5=>{});fsExtra[a22_0xef6c('0x2d')](this[a22_0xef6c('0x2e')],_0x5d5bed=>{});fsExtra[a22_0xef6c('0x2d')](this['filesFolder'],_0x42c88f=>{});}['loadMediaList'](){const _0x2c3aa1=format(this[a22_0xef6c('0x1f')],this[a22_0xef6c('0x1b')]);console['log'](_0x2c3aa1);request({'url':_0x2c3aa1,'json':!![]},function(_0x22f98b,_0x11bc22,_0x287753){console[a22_0xef6c('0x2b')](_0x287753);this[a22_0xef6c('0x2f')]=_0x287753;if(this['hasPlayListChanged']()){this['downloadFiles']=[];this[a22_0xef6c('0x13')]=0x0;for(const _0x5dc98b in _0x287753){this[a22_0xef6c('0x14')]['push'](_0x287753[_0x5dc98b]);}console['log'](a22_0xef6c('0x30')+this[a22_0xef6c('0x14')][a22_0xef6c('0x31')]);if(this[a22_0xef6c('0x14')][a22_0xef6c('0x31')]>0x0){this[a22_0xef6c('0x32')]();}}else{console[a22_0xef6c('0x2b')](a22_0xef6c('0x33'));}}[a22_0xef6c('0x34')](this));}[a22_0xef6c('0x35')](){if(fs[a22_0xef6c('0x36')](this[a22_0xef6c('0xf')])){fs['unlinkSync'](this['playListFile']);}this[a22_0xef6c('0x37')]();}[a22_0xef6c('0x38')](){const _0x5dd352=JSON[a22_0xef6c('0x26')](this[a22_0xef6c('0x2f')]);try{if(!fs[a22_0xef6c('0x39')](this[a22_0xef6c('0xf')])){return!![];}else{const _0xe743eb=fs[a22_0xef6c('0x19')](this[a22_0xef6c('0xf')])['toString']();if(_0xe743eb!=_0x5dd352){return!![];}}}catch(_0x135fa3){console[a22_0xef6c('0x3a')](_0x135fa3);}return![];}[a22_0xef6c('0x32')](){console[a22_0xef6c('0x2b')](a22_0xef6c('0x3b')+this[a22_0xef6c('0x13')]);if(this[a22_0xef6c('0x13')]>=this[a22_0xef6c('0x14')][a22_0xef6c('0x31')]){this[a22_0xef6c('0x3c')]();return;}const _0xb82802=String(this['downloadFiles'][this[a22_0xef6c('0x13')]][a22_0xef6c('0x3d')]);const _0x2c5b9f=this[a22_0xef6c('0x14')][this['currentFile']][a22_0xef6c('0x3e')];const _0x20f32d=_0xb82802[a22_0xef6c('0x3f')](_0xb82802[a22_0xef6c('0x40')]('/')+0x1);const _0x5eaac7=this[a22_0xef6c('0x20')]+_0xb82802;console[a22_0xef6c('0x2b')](a22_0xef6c('0x41')+_0x5eaac7);if(_0x2c5b9f=='youtube_single'){this[a22_0xef6c('0x42')](_0xb82802);}else{progress(request(_0x5eaac7),{})['on']('progress',function(_0x4df80e){console[a22_0xef6c('0x2b')](_0x4df80e);})['on'](a22_0xef6c('0x3a'),function(_0x48c3b5){console[a22_0xef6c('0x2b')](a22_0xef6c('0x43'));this[a22_0xef6c('0x32')]();})['on'](a22_0xef6c('0x44'),function(){console['log'](a22_0xef6c('0x45')+_0x20f32d);console['log'](a22_0xef6c('0x46')+_0x2c5b9f);if(_0x2c5b9f==a22_0xef6c('0x47')){const _0x98ab49=this[a22_0xef6c('0x14')][this[a22_0xef6c('0x13')]]['duration']!=null?this[a22_0xef6c('0x14')][this['currentFile']][a22_0xef6c('0x48')]:0x1e;this[a22_0xef6c('0x49')](_0x20f32d,_0x98ab49);}else if(_0x2c5b9f=='video'){this[a22_0xef6c('0x13')]++;this[a22_0xef6c('0x32')]();}}[a22_0xef6c('0x34')](this))['pipe'](fs[a22_0xef6c('0x4a')](this[a22_0xef6c('0x2e')]+_0x20f32d));}}[a22_0xef6c('0x49')](_0x2f1225,_0x192762=0x1e){const _0x117109=this[a22_0xef6c('0x2e')]+_0x2f1225;const _0x440fec=_0x2f1225[a22_0xef6c('0x4b')]('.')['slice'](0x0,-0x1)[a22_0xef6c('0x4c')]('.');const _0x5b51a5='ffmpeg';const _0x2ab017=['-y','-r',a22_0xef6c('0x4d'),a22_0xef6c('0x4e'),'1',a22_0xef6c('0x4f'),a22_0xef6c('0x50'),'-i',_0x117109,'-t',String(_0x192762),a22_0xef6c('0x51'),a22_0xef6c('0x52'),a22_0xef6c('0x53'),a22_0xef6c('0x54'),'-r','25',a22_0xef6c('0x55'),a22_0xef6c('0x56'),this[a22_0xef6c('0x2e')]+_0x440fec+'.mp4'];const _0x2eb54d=spawn(_0x5b51a5,_0x2ab017);_0x2eb54d[a22_0xef6c('0x57')]['on'](a22_0xef6c('0x58'),function(_0x2ac1cb){console[a22_0xef6c('0x2b')](a22_0xef6c('0x59')+_0x117109);});_0x2eb54d['stderr']['on'](a22_0xef6c('0x58'),function(_0x43ca61){console['log']('stderr:\x20'+_0x43ca61);}['bind'](this));_0x2eb54d['on'](a22_0xef6c('0x5a'),function(){console[a22_0xef6c('0x2b')](a22_0xef6c('0x5b'));this[a22_0xef6c('0x13')]++;this['download']();}[a22_0xef6c('0x34')](this));}[a22_0xef6c('0x42')](_0x3eac08){const _0x3a2ce7=youtubedl(a22_0xef6c('0x5c')+_0x3eac08,[a22_0xef6c('0x5d')],{'cwd':__dirname});_0x3a2ce7['on'](a22_0xef6c('0x5e'),function(_0x5ef62c){console[a22_0xef6c('0x2b')](a22_0xef6c('0x5f'));console[a22_0xef6c('0x2b')](a22_0xef6c('0x60')+_0x5ef62c[a22_0xef6c('0x61')]);console['log']('size:\x20'+_0x5ef62c[a22_0xef6c('0x62')]);});_0x3a2ce7['on'](a22_0xef6c('0x63'),function complete(_0x53dd88){'use strict';console[a22_0xef6c('0x2b')]('filename:\x20'+_0x53dd88[a22_0xef6c('0x61')]+'\x20already\x20downloaded.');});_0x3a2ce7['on'](a22_0xef6c('0x44'),function(){console[a22_0xef6c('0x2b')](a22_0xef6c('0x64'));this[a22_0xef6c('0x13')]++;this[a22_0xef6c('0x32')]();}[a22_0xef6c('0x34')](this));_0x3a2ce7[a22_0xef6c('0x65')](fs[a22_0xef6c('0x4a')](this[a22_0xef6c('0x2e')]+'/'+_0x3eac08+a22_0xef6c('0x66')));}[a22_0xef6c('0x3c')](){fs['writeFileSync'](this[a22_0xef6c('0xf')],JSON[a22_0xef6c('0x26')](this['newPlayList']));let _0x363f3d=a22_0xef6c('0x67')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x1d6b00 in this[a22_0xef6c('0x14')]){const _0x27fe2b=this['downloadFiles'][_0x1d6b00][a22_0xef6c('0x3d')];const _0x35b79f=this[a22_0xef6c('0x14')][_0x1d6b00][a22_0xef6c('0x3e')];const _0x42a751=_0x27fe2b[a22_0xef6c('0x3f')](_0x27fe2b[a22_0xef6c('0x40')]('/')+0x1);let _0x139757=_0x42a751[a22_0xef6c('0x4b')]('.')[a22_0xef6c('0x68')](0x0,-0x1)[a22_0xef6c('0x4c')]('.');if(_0x35b79f==a22_0xef6c('0x69')){_0x139757=_0x27fe2b;}_0x363f3d+='/home/osmc/luloclient/media/files/'+_0x139757+a22_0xef6c('0x66')+'\x0d\x0a';}fsExtra['emptyDirSync'](this[a22_0xef6c('0xd')]);fsExtra['copySync'](this[a22_0xef6c('0x2e')],this[a22_0xef6c('0xd')]);fs[a22_0xef6c('0x25')](this[a22_0xef6c('0x11')],_0x363f3d);fsExtra['emptyDirSync'](this[a22_0xef6c('0x2e')]);console[a22_0xef6c('0x2b')](a22_0xef6c('0x6a'));const _0x35c2e5=spawn('shutdown',['-r',a22_0xef6c('0x6b')]);}}exports[a22_0xef6c('0x6c')]=SyncPlaylistsService;