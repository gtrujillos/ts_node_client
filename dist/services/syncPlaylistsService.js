var a22_0x46e3=['Finished','now','SyncPlaylistsService','__esModule','../infrastructure/HttpClientService','http','fs-extra','request','request-progress','child_process','is-image','string-template','uuid/v4','context.json','mediaFolder','media/','tempFolder','temp/','filesFolder','files/','playlist.txt','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','httpClientService','HttpClientService','init','config','parse','readFileSync','context','playerId','baseURL','WEB_SERVICE_URL','deploy/','playListServiceURL','api/player_playlist.php?player_id={0}','registerClient','checkFolders','loadMediaList','deviceUuid','writeFileSync','stringify','post','then','log','parsedBody','ensureDir','hasPlayListChanged','push','length','download','No\x20playlist\x20changes','bind','reloadMediaList','exist','playListFile','unlinkSync','existsSync','toString','error','this.currentFile:\x20','finishProcess','path','media_type','substring','lastIndexOf','Downloading:\x20','youtube_single','downloadHTTPFile','downloadHTTPFileCallback','duration','createImageVideo','video','downloadRequestFile','progress','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','image','pipe','createWriteStream','\x20to\x20','Max\x20redirects\x20reached','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','downloadFile\x20callback\x20result\x20undefined:\x20','\x20Progress:\x20unknown\x09','\x20Progress:\x20','statusCode','headers','content-length','stat','size','Redownloading','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','finish','Downloaded\x20','location','Redirect\x20limit\x20encountered\x20for\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','split','slice','join','ffmpeg','1/2','-loop','-c:v','libx264','-pix_fmt','yuv420p','-vf','scale=1920:1080','.mp4','stdout','data','Converting\x20','stderr','stderr:\x20','--format=18','Download\x20started','filename:\x20','_filename','complete','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','emptyDirSync','copySync','m3uFile'];(function(_0x363d11,_0x3718ca){var _0x3a5c09=function(_0x221346){while(--_0x221346){_0x363d11['push'](_0x363d11['shift']());}};_0x3a5c09(++_0x3718ca);}(a22_0x46e3,0x119));var a22_0x258d=function(_0x5b3536,_0x33f618){_0x5b3536=_0x5b3536-0x0;var _0x5e42b8=a22_0x46e3[_0x5b3536];return _0x5e42b8;};'use strict';Object['defineProperty'](exports,a22_0x258d('0x0'),{'value':!![]});const HttpClientService_1=require(a22_0x258d('0x1'));const fs=require('fs');const http=require(a22_0x258d('0x2'));const fsExtra=require(a22_0x258d('0x3'));const request=require(a22_0x258d('0x4'));const progress=require(a22_0x258d('0x5'));const spawn=require(a22_0x258d('0x6'))['spawn'];const isImage=require(a22_0x258d('0x7'));const format=require(a22_0x258d('0x8'));const os=require('os');const youtubedl=require('youtube-dl');const uuidv4=require(a22_0x258d('0x9'));const configFile='config.json';const contextFile=a22_0x258d('0xa');class SyncPlaylistsService{constructor(){this[a22_0x258d('0xb')]=a22_0x258d('0xc');this[a22_0x258d('0xd')]=this['mediaFolder']+a22_0x258d('0xe');this[a22_0x258d('0xf')]=this[a22_0x258d('0xb')]+a22_0x258d('0x10');this['playListFile']=this[a22_0x258d('0xb')]+a22_0x258d('0x11');this['m3uFile']=this[a22_0x258d('0xf')]+a22_0x258d('0x12');this[a22_0x258d('0x13')]=0x0;this[a22_0x258d('0x14')]=[];this[a22_0x258d('0x15')]={};this[a22_0x258d('0x16')]=new HttpClientService_1[(a22_0x258d('0x17'))]();}[a22_0x258d('0x18')](){this[a22_0x258d('0x19')]=JSON[a22_0x258d('0x1a')](fs[a22_0x258d('0x1b')](configFile));this[a22_0x258d('0x1c')]=JSON[a22_0x258d('0x1a')](fs[a22_0x258d('0x1b')](contextFile));this[a22_0x258d('0x1d')]=this['config'][a22_0x258d('0x1d')];this[a22_0x258d('0x1e')]=process['env'][a22_0x258d('0x1f')]+a22_0x258d('0x20');this[a22_0x258d('0x21')]=this[a22_0x258d('0x1e')]+a22_0x258d('0x22');this[a22_0x258d('0x23')]();this[a22_0x258d('0x24')]();this[a22_0x258d('0x25')]();}[a22_0x258d('0x23')](){const _0x253a90=this['config'][a22_0x258d('0x26')];if(!_0x253a90||_0x253a90==''){this[a22_0x258d('0x19')][a22_0x258d('0x26')]=uuidv4();this[a22_0x258d('0x19')]={'deviceUuid':this[a22_0x258d('0x19')][a22_0x258d('0x26')],'playerId':this[a22_0x258d('0x19')]['playerId']};fs[a22_0x258d('0x27')](configFile,JSON[a22_0x258d('0x28')](this[a22_0x258d('0x19')]));}const _0x2431ad={'player_id':this[a22_0x258d('0x1d')],'device_uuid':this[a22_0x258d('0x19')][a22_0x258d('0x26')],'network_info':JSON[a22_0x258d('0x28')](os['networkInterfaces']()),'firmware_info':JSON[a22_0x258d('0x28')](this[a22_0x258d('0x1c')]),'status':0x1};this[a22_0x258d('0x16')][a22_0x258d('0x29')]('http://restapi.lulo.run/player_devices/register',_0x2431ad,![])[a22_0x258d('0x2a')](function(_0x4813c7){console[a22_0x258d('0x2b')](a22_0x258d('0x2c'));console['log'](_0x4813c7);})['catch'](function(_0x2dd596){});}[a22_0x258d('0x24')](){fsExtra['ensureDir'](this['mediaFolder'],_0x5759d2=>{});fsExtra[a22_0x258d('0x2d')](this[a22_0x258d('0xd')],_0x210d02=>{});fsExtra['ensureDir'](this[a22_0x258d('0xf')],_0xe9f02f=>{});}[a22_0x258d('0x25')](){const _0x3f9c6c=format(this[a22_0x258d('0x21')],this[a22_0x258d('0x1d')]);console[a22_0x258d('0x2b')](_0x3f9c6c);request({'url':_0x3f9c6c,'json':!![]},function(_0x5040cf,_0x5a148a,_0x11823e){console[a22_0x258d('0x2b')](_0x11823e);this[a22_0x258d('0x15')]=_0x11823e;if(this[a22_0x258d('0x2e')]()){fsExtra['emptyDirSync'](this[a22_0x258d('0xd')]);this[a22_0x258d('0x14')]=[];this[a22_0x258d('0x13')]=0x0;for(const _0x48c323 in _0x11823e){this[a22_0x258d('0x14')][a22_0x258d('0x2f')](_0x11823e[_0x48c323]);}console[a22_0x258d('0x2b')]('Total:\x20'+this[a22_0x258d('0x14')]['length']);if(this[a22_0x258d('0x14')][a22_0x258d('0x30')]>0x0){this[a22_0x258d('0x31')]();}}else{console[a22_0x258d('0x2b')](a22_0x258d('0x32'));}}[a22_0x258d('0x33')](this));}[a22_0x258d('0x34')](){if(fs[a22_0x258d('0x35')](this[a22_0x258d('0x36')])){fs[a22_0x258d('0x37')](this[a22_0x258d('0x36')]);}this[a22_0x258d('0x25')]();}[a22_0x258d('0x2e')](){const _0x29fbfc=JSON['stringify'](this['newPlayList']);try{if(!fs[a22_0x258d('0x38')](this[a22_0x258d('0x36')])){return!![];}else{const _0x2dfb9b=fs[a22_0x258d('0x1b')](this[a22_0x258d('0x36')])[a22_0x258d('0x39')]();if(_0x2dfb9b!=_0x29fbfc){return!![];}}}catch(_0x1c3f4c){console[a22_0x258d('0x3a')](_0x1c3f4c);}return![];}['download'](){console[a22_0x258d('0x2b')](a22_0x258d('0x3b')+this[a22_0x258d('0x13')]);if(this['currentFile']>=this['downloadFiles']['length']){this[a22_0x258d('0x3c')]();return;}const _0x117a5b=String(this[a22_0x258d('0x14')][this[a22_0x258d('0x13')]][a22_0x258d('0x3d')]);const _0x3316a8=this[a22_0x258d('0x14')][this['currentFile']][a22_0x258d('0x3e')];const _0x319591=_0x117a5b[a22_0x258d('0x3f')](_0x117a5b[a22_0x258d('0x40')]('/')+0x1);const _0x520aa7=this['baseURL']+_0x117a5b;console[a22_0x258d('0x2b')](a22_0x258d('0x41')+_0x520aa7);if(_0x3316a8==a22_0x258d('0x42')){this['downloadYouTube'](_0x117a5b);}else{this[a22_0x258d('0x43')](_0x520aa7,_0x319591,_0x3316a8,this[a22_0x258d('0x44')][a22_0x258d('0x33')](this));}}[a22_0x258d('0x44')](_0x380562,_0x2b64ed,_0x21efb5,_0x28dfbb){console[a22_0x258d('0x2b')]('downloadHTTPFileCallback');console['log'](_0x380562);console[a22_0x258d('0x2b')](_0x2b64ed);console['log'](_0x21efb5);console[a22_0x258d('0x2b')](_0x28dfbb);if(_0x21efb5=='image'){const _0x164e84=this[a22_0x258d('0x14')][this['currentFile']][a22_0x258d('0x45')]!=null?this[a22_0x258d('0x14')][this[a22_0x258d('0x13')]][a22_0x258d('0x45')]:0x1e;this[a22_0x258d('0x46')](_0x28dfbb,_0x164e84);}else if(_0x21efb5==a22_0x258d('0x47')){if(_0x380562==null&&_0x2b64ed!=''){this[a22_0x258d('0x13')]++;}this['download']();}console['log'](this['currentFile']);}[a22_0x258d('0x48')](_0xdd18c6,_0xbd4ff0,_0x35f224){progress(request(_0xdd18c6),{})['on'](a22_0x258d('0x49'),function(_0x16af12){console[a22_0x258d('0x2b')](_0x16af12);})['on'](a22_0x258d('0x3a'),function(_0x186e0f){console[a22_0x258d('0x2b')](a22_0x258d('0x4a'));this[a22_0x258d('0x31')]();})['on'](a22_0x258d('0x4b'),function(){console['log'](a22_0x258d('0x4c')+_0xbd4ff0);console[a22_0x258d('0x2b')](a22_0x258d('0x4d')+_0x35f224);if(_0x35f224==a22_0x258d('0x4e')){const _0x3018bc=this[a22_0x258d('0x14')][this[a22_0x258d('0x13')]][a22_0x258d('0x45')]!=null?this[a22_0x258d('0x14')][this[a22_0x258d('0x13')]][a22_0x258d('0x45')]:0x1e;this[a22_0x258d('0x46')](_0xbd4ff0,_0x3018bc);}else if(_0x35f224==a22_0x258d('0x47')){this[a22_0x258d('0x13')]++;this[a22_0x258d('0x31')]();}}[a22_0x258d('0x33')](this))[a22_0x258d('0x4f')](fs[a22_0x258d('0x50')](this[a22_0x258d('0xd')]+_0xbd4ff0));}[a22_0x258d('0x43')](_0x5c3771,_0x22ca06,_0x2247a8,_0x4c0157){console[a22_0x258d('0x2b')](a22_0x258d('0x43'));console[a22_0x258d('0x2b')](_0x5c3771);const _0x5b1944=!![];let _0x1f17c5=0x0;const _0x26a463='';console[a22_0x258d('0x2b')]('Attempting\x20to\x20download\x20'+_0x5c3771+a22_0x258d('0x51')+_0x22ca06);if(_0x1f17c5){if(_0x1f17c5>0x5){_0x4c0157(a22_0x258d('0x52'),_0x5c3771,_0x2247a8,null);return;}}else{_0x1f17c5=0x0;}const _0x3d61fc=this[a22_0x258d('0xd')]+_0x22ca06;let _0x4d7c5b;if(_0x4c0157===undefined){console[a22_0x258d('0x2b')](a22_0x258d('0x53')+_0x5c3771+a22_0x258d('0x51')+_0x3d61fc);_0x4c0157=function(_0x3b8f34,_0x7042da){console[a22_0x258d('0x2b')](a22_0x258d('0x54'),_0x3b8f34,_0x7042da);};}const _0x38ce1e=http['get'](_0x5c3771,function(_0x418984){let _0x425ff2=0x0;let _0x3e9d76=0x0;function _0x5f330f(){if(_0x425ff2===undefined){console['log'](_0x22ca06+a22_0x258d('0x55')+_0x3e9d76+'/'+'?');}const _0x4c99a8=_0x3e9d76/_0x425ff2*0x64;console[a22_0x258d('0x2b')](_0x22ca06+a22_0x258d('0x56')+_0x4c99a8+'%\x09'+_0x3e9d76+'/'+_0x425ff2);}console[a22_0x258d('0x2b')](_0x22ca06+'\x20'+_0x418984[a22_0x258d('0x57')]);switch(_0x418984[a22_0x258d('0x57')]){case 0xc8:_0x425ff2=_0x418984[a22_0x258d('0x58')][a22_0x258d('0x59')]||_0x26a463;fs[a22_0x258d('0x5a')](_0x3d61fc,function(_0x2559fc,_0x4f1534){if(!_0x2559fc){console[a22_0x258d('0x2b')]('Have\x20already\x20downloaded\x20'+_0x3d61fc);if(_0x4f1534[a22_0x258d('0x5b')]==_0x425ff2){console['log']('And\x20the\x20file\x20size\x20matches\x20('+_0x425ff2+')');console[a22_0x258d('0x2b')](a22_0x258d('0x5c'));}else{console['log'](a22_0x258d('0x5d')+_0x4f1534[a22_0x258d('0x5b')]+a22_0x258d('0x5e')+_0x425ff2+')');}}_0x4d7c5b=fs[a22_0x258d('0x50')](_0x3d61fc);_0x418984[a22_0x258d('0x4f')](_0x4d7c5b);_0x418984['on']('data',function(_0xdc0314){_0x3e9d76+=_0xdc0314[a22_0x258d('0x30')];_0x5f330f();});_0x4d7c5b['on'](a22_0x258d('0x5f'),function(){console[a22_0x258d('0x2b')](a22_0x258d('0x60')+_0x5c3771+a22_0x258d('0x51')+_0x22ca06);_0x4c0157(null,_0x22ca06,_0x2247a8,_0x22ca06);}[a22_0x258d('0x33')](this));});break;case 0x12e:const _0x4252df=_0x418984[a22_0x258d('0x58')][a22_0x258d('0x61')];console[a22_0x258d('0x2b')]('Redirect\x20'+_0x5c3771+a22_0x258d('0x51')+_0x4252df);if(_0x1f17c5<0x5){this['downloadHTTPFile'](_0x4252df,_0x22ca06,_0x4c0157,_0x1f17c5++);}else{console[a22_0x258d('0x3a')](a22_0x258d('0x62')+_0x5c3771+'.');_0x4c0157(a22_0x258d('0x63'),null,null,null);}return;case 0x194:console['log'](a22_0x258d('0x64')+_0x5c3771);default:console[a22_0x258d('0x2b')](a22_0x258d('0x65')+_0x5c3771+a22_0x258d('0x66')+_0x418984[a22_0x258d('0x57')]);_0x38ce1e[a22_0x258d('0x67')]();_0x4c0157(_0x418984[a22_0x258d('0x57')],null,null,null);return;}})['on'](a22_0x258d('0x3a'),function(_0x1c6828){console[a22_0x258d('0x2b')](a22_0x258d('0x68')+_0x5c3771+'\x20'+_0x1c6828[a22_0x258d('0x69')]);_0x4c0157(_0x1c6828,null,null,null);});}[a22_0x258d('0x46')](_0x30ee1d,_0x377267=0x1e){const _0x41e10d=this[a22_0x258d('0xd')]+_0x30ee1d;console[a22_0x258d('0x2b')](_0x41e10d);console['log'](_0x30ee1d);const _0x39fd00=_0x30ee1d[a22_0x258d('0x6a')]('.')[a22_0x258d('0x6b')](0x0,-0x1)[a22_0x258d('0x6c')]('.');const _0x110b1c=a22_0x258d('0x6d');const _0xff291a=['-y','-r',a22_0x258d('0x6e'),a22_0x258d('0x6f'),'1','-pattern_type','glob','-i',_0x41e10d,'-t',String(_0x377267),a22_0x258d('0x70'),a22_0x258d('0x71'),a22_0x258d('0x72'),a22_0x258d('0x73'),'-r','25',a22_0x258d('0x74'),a22_0x258d('0x75'),this[a22_0x258d('0xd')]+_0x39fd00+a22_0x258d('0x76')];const _0x21976d=spawn(_0x110b1c,_0xff291a);_0x21976d[a22_0x258d('0x77')]['on'](a22_0x258d('0x78'),function(_0x2f8f29){console[a22_0x258d('0x2b')](a22_0x258d('0x79')+_0x41e10d);});_0x21976d[a22_0x258d('0x7a')]['on'](a22_0x258d('0x78'),function(_0x44e2cb){console[a22_0x258d('0x2b')](a22_0x258d('0x7b')+_0x44e2cb);}['bind'](this));_0x21976d['on']('close',function(){console[a22_0x258d('0x2b')]('finished\x20mp4\x20convert');this[a22_0x258d('0x13')]++;this[a22_0x258d('0x31')]();}['bind'](this));}['downloadYouTube'](_0x3e7468){const _0x444370=youtubedl('http://www.youtube.com/watch?v='+_0x3e7468,[a22_0x258d('0x7c')],{'cwd':__dirname});_0x444370['on']('info',function(_0x5cc7f1){console[a22_0x258d('0x2b')](a22_0x258d('0x7d'));console[a22_0x258d('0x2b')](a22_0x258d('0x7e')+_0x5cc7f1[a22_0x258d('0x7f')]);console[a22_0x258d('0x2b')]('size:\x20'+_0x5cc7f1[a22_0x258d('0x5b')]);});_0x444370['on'](a22_0x258d('0x80'),function complete(_0x574cfd){'use strict';console['log'](a22_0x258d('0x7e')+_0x574cfd[a22_0x258d('0x7f')]+a22_0x258d('0x81'));});_0x444370['on']('end',function(){console[a22_0x258d('0x2b')](a22_0x258d('0x82'));this[a22_0x258d('0x13')]++;this['download']();}[a22_0x258d('0x33')](this));_0x444370[a22_0x258d('0x4f')](fs[a22_0x258d('0x50')](this['tempFolder']+'/'+_0x3e7468+a22_0x258d('0x76')));}[a22_0x258d('0x3c')](){fs['writeFileSync'](this[a22_0x258d('0x36')],JSON[a22_0x258d('0x28')](this[a22_0x258d('0x15')]));let _0x14c747=a22_0x258d('0x83')+'\x0d\x0a'+a22_0x258d('0x84')+'\x0d\x0a';for(const _0x4b4f1f in this['downloadFiles']){const _0x3eb8f7=this[a22_0x258d('0x14')][_0x4b4f1f]['path'];const _0x3294fb=this[a22_0x258d('0x14')][_0x4b4f1f][a22_0x258d('0x3e')];const _0x5a9a67=_0x3eb8f7[a22_0x258d('0x3f')](_0x3eb8f7['lastIndexOf']('/')+0x1);let _0x54e688=_0x5a9a67[a22_0x258d('0x6a')]('.')[a22_0x258d('0x6b')](0x0,-0x1)[a22_0x258d('0x6c')]('.');if(_0x3294fb==a22_0x258d('0x42')){_0x54e688=_0x3eb8f7;}_0x14c747+='/home/osmc/luloclient/media/files/'+_0x54e688+a22_0x258d('0x76')+'\x0d\x0a';}fsExtra[a22_0x258d('0x85')](this[a22_0x258d('0xf')]);fsExtra[a22_0x258d('0x86')](this[a22_0x258d('0xd')],this[a22_0x258d('0xf')]);fs[a22_0x258d('0x27')](this[a22_0x258d('0x87')],_0x14c747);fsExtra[a22_0x258d('0x85')](this[a22_0x258d('0xd')]);console[a22_0x258d('0x2b')](a22_0x258d('0x88'));const _0x411866=spawn('shutdown',['-r',a22_0x258d('0x89')]);}}exports[a22_0x258d('0x8a')]=SyncPlaylistsService;