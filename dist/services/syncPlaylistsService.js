var a22_0x2157=['stringify','networkInterfaces','context','post','http://restapi.lulo.run/player_devices/register','then','log','parsedBody','catch','ensureDir','hasPlayListChanged','emptyDirSync','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','existsSync','removeSync','toString','error','this.currentFile:\x20','finishProcess','path','substring','lastIndexOf','youtube_single','downloadYouTube','downloadHTTPFile','downloadHTTPFileCallback','Attempting\x20to\x20download\x20','\x20to\x20','Max\x20redirects\x20reached','globalAgent','maxSockets','\x20Progress:\x20unknown\x09','statusCode','headers','content-length','stat','Have\x20already\x20downloaded\x20','size','And\x20the\x20file\x20size\x20matches\x20(','Redownloading','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','createWriteStream','pipe','data','err:\x20','finish','Downloaded\x20','Redirect\x20limit\x20encountered\x20for\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','duration','createImageVideo','video','downloadRequestFile','progress','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','image','split','slice','join','ffmpeg','1/2','-loop','-pattern_type','-c:v','libx264','yuv420p','-vf','scale=1920:1080','stderr','http://www.youtube.com/watch?v=','--format=18','info','_filename','size:\x20','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','.mp4','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','/home/osmc/luloclient/media/files/','copySync','Finished','shutdown','now','SyncPlaylistsService','defineProperty','__esModule','../infrastructure/HttpClientService','http','fs-extra','request','request-progress','child_process','is-image','string-template','youtube-dl','config.json','context.json','mediaFolder','media/','tempFolder','temp/','files/','playListFile','playlist.txt','m3uFile','filesFolder','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','httpClientService','HttpClientService','init','parse','readFileSync','config','playerId','baseURL','env','WEB_SERVICE_URL','playListServiceURL','api/player_playlist.php?player_id={0}','registerClient','checkFolders','loadMediaList','deviceUuid'];(function(_0x5e7704,_0x384c69){var _0x516c2b=function(_0x4dd8fb){while(--_0x4dd8fb){_0x5e7704['push'](_0x5e7704['shift']());}};_0x516c2b(++_0x384c69);}(a22_0x2157,0x66));var a22_0x35e8=function(_0x163562,_0x2ff58f){_0x163562=_0x163562-0x0;var _0x1dcb52=a22_0x2157[_0x163562];return _0x1dcb52;};'use strict';Object[a22_0x35e8('0x0')](exports,a22_0x35e8('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0x35e8('0x2'));const fs=require('fs');const http=require(a22_0x35e8('0x3'));const fsExtra=require(a22_0x35e8('0x4'));const request=require(a22_0x35e8('0x5'));const progress=require(a22_0x35e8('0x6'));const spawn=require(a22_0x35e8('0x7'))['spawn'];const isImage=require(a22_0x35e8('0x8'));const format=require(a22_0x35e8('0x9'));const os=require('os');const youtubedl=require(a22_0x35e8('0xa'));const uuidv4=require('uuid/v4');const configFile=a22_0x35e8('0xb');const contextFile=a22_0x35e8('0xc');class SyncPlaylistsService{constructor(){this[a22_0x35e8('0xd')]=a22_0x35e8('0xe');this[a22_0x35e8('0xf')]=this[a22_0x35e8('0xd')]+a22_0x35e8('0x10');this['filesFolder']=this[a22_0x35e8('0xd')]+a22_0x35e8('0x11');this[a22_0x35e8('0x12')]=this[a22_0x35e8('0xd')]+a22_0x35e8('0x13');this[a22_0x35e8('0x14')]=this[a22_0x35e8('0x15')]+a22_0x35e8('0x16');this[a22_0x35e8('0x17')]=0x0;this[a22_0x35e8('0x18')]=[];this[a22_0x35e8('0x19')]={};this[a22_0x35e8('0x1a')]=new HttpClientService_1[(a22_0x35e8('0x1b'))]();}[a22_0x35e8('0x1c')](){this['config']=JSON[a22_0x35e8('0x1d')](fs[a22_0x35e8('0x1e')](configFile));this['context']=JSON[a22_0x35e8('0x1d')](fs['readFileSync'](contextFile));this['playerId']=this[a22_0x35e8('0x1f')][a22_0x35e8('0x20')];this[a22_0x35e8('0x21')]=process[a22_0x35e8('0x22')][a22_0x35e8('0x23')]+'deploy/';this[a22_0x35e8('0x24')]=this['baseURL']+a22_0x35e8('0x25');this[a22_0x35e8('0x26')]();this[a22_0x35e8('0x27')]();this[a22_0x35e8('0x28')]();}[a22_0x35e8('0x26')](){const _0x4f81ae=this['config'][a22_0x35e8('0x29')];if(!_0x4f81ae||_0x4f81ae==''){this[a22_0x35e8('0x1f')][a22_0x35e8('0x29')]=uuidv4();this[a22_0x35e8('0x1f')]={'deviceUuid':this[a22_0x35e8('0x1f')]['deviceUuid'],'playerId':this[a22_0x35e8('0x1f')][a22_0x35e8('0x20')]};fs['writeFileSync'](configFile,JSON['stringify'](this[a22_0x35e8('0x1f')]));}const _0x507627={'player_id':this[a22_0x35e8('0x20')],'device_uuid':this[a22_0x35e8('0x1f')][a22_0x35e8('0x29')],'network_info':JSON[a22_0x35e8('0x2a')](os[a22_0x35e8('0x2b')]()),'firmware_info':JSON['stringify'](this[a22_0x35e8('0x2c')]),'status':0x1};this[a22_0x35e8('0x1a')][a22_0x35e8('0x2d')](a22_0x35e8('0x2e'),_0x507627,![])[a22_0x35e8('0x2f')](function(_0x945bbb){console[a22_0x35e8('0x30')](a22_0x35e8('0x31'));console[a22_0x35e8('0x30')](_0x945bbb);})[a22_0x35e8('0x32')](function(_0x4a17a3){});}[a22_0x35e8('0x27')](){fsExtra[a22_0x35e8('0x33')](this[a22_0x35e8('0xd')],_0x403ef2=>{});fsExtra[a22_0x35e8('0x33')](this[a22_0x35e8('0xf')],_0x254447=>{});fsExtra['ensureDir'](this['filesFolder'],_0x37d465=>{});}[a22_0x35e8('0x28')](){const _0x547224=format(this[a22_0x35e8('0x24')],this[a22_0x35e8('0x20')]);console[a22_0x35e8('0x30')](_0x547224);request({'url':_0x547224,'json':!![]},function(_0x49b4b2,_0xe9c0e1,_0x53ed1a){console[a22_0x35e8('0x30')](_0x53ed1a);this[a22_0x35e8('0x19')]=_0x53ed1a;if(this[a22_0x35e8('0x34')]()){fsExtra[a22_0x35e8('0x35')](this[a22_0x35e8('0xf')]);this[a22_0x35e8('0x18')]=[];this[a22_0x35e8('0x17')]=0x0;for(const _0x2caee9 in _0x53ed1a){this[a22_0x35e8('0x18')][a22_0x35e8('0x36')](_0x53ed1a[_0x2caee9]);}console[a22_0x35e8('0x30')](a22_0x35e8('0x37')+this['downloadFiles'][a22_0x35e8('0x38')]);if(this[a22_0x35e8('0x18')]['length']>0x0){this[a22_0x35e8('0x39')]();}}else{console['log'](a22_0x35e8('0x3a'));}}[a22_0x35e8('0x3b')](this));}[a22_0x35e8('0x3c')](){if(fsExtra[a22_0x35e8('0x3d')](this[a22_0x35e8('0x12')])){fsExtra[a22_0x35e8('0x3e')](this[a22_0x35e8('0x12')]);}this[a22_0x35e8('0x28')]();}['hasPlayListChanged'](){const _0xf37bed=JSON[a22_0x35e8('0x2a')](this[a22_0x35e8('0x19')]);try{if(!fs[a22_0x35e8('0x3d')](this[a22_0x35e8('0x12')])){return!![];}else{const _0x4edfee=fs['readFileSync'](this[a22_0x35e8('0x12')])[a22_0x35e8('0x3f')]();if(_0x4edfee!=_0xf37bed){return!![];}}}catch(_0x413972){console[a22_0x35e8('0x40')](_0x413972);}return![];}[a22_0x35e8('0x39')](){console[a22_0x35e8('0x30')](a22_0x35e8('0x41')+this['currentFile']);if(this[a22_0x35e8('0x17')]>=this[a22_0x35e8('0x18')][a22_0x35e8('0x38')]){this[a22_0x35e8('0x42')]();return;}const _0x459b34=String(this[a22_0x35e8('0x18')][this[a22_0x35e8('0x17')]][a22_0x35e8('0x43')]);const _0x16994f=this['downloadFiles'][this[a22_0x35e8('0x17')]]['media_type'];const _0x5629e2=_0x459b34[a22_0x35e8('0x44')](_0x459b34[a22_0x35e8('0x45')]('/')+0x1);const _0x23d430=this[a22_0x35e8('0x21')]+_0x459b34;console[a22_0x35e8('0x30')]('Downloading:\x20'+_0x23d430);if(_0x16994f==a22_0x35e8('0x46')){this[a22_0x35e8('0x47')](_0x459b34);}else{this[a22_0x35e8('0x48')](_0x23d430,_0x5629e2,_0x16994f,this[a22_0x35e8('0x49')]['bind'](this));}}['downloadHTTPFile'](_0x26eb8a,_0x4b12d0,_0x5c03c2,_0x540d6e){console[a22_0x35e8('0x30')]('downloadHTTPFile');console[a22_0x35e8('0x30')](_0x26eb8a);const _0x3c79a5=!![];let _0x393423=0x0;const _0x1bcc3e='';console[a22_0x35e8('0x30')](a22_0x35e8('0x4a')+_0x26eb8a+a22_0x35e8('0x4b')+_0x4b12d0);if(_0x393423){if(_0x393423>0x5){_0x540d6e(a22_0x35e8('0x4c'),_0x26eb8a,_0x5c03c2,null);return;}}else{_0x393423=0x0;}const _0x4b3c6c=this[a22_0x35e8('0xf')]+_0x4b12d0;let _0x14e0bc;if(_0x540d6e===undefined){console[a22_0x35e8('0x30')]('WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20'+_0x26eb8a+a22_0x35e8('0x4b')+_0x4b3c6c);_0x540d6e=function(_0x4d5850,_0x77e63f){console[a22_0x35e8('0x30')]('downloadFile\x20callback\x20result\x20undefined:\x20',_0x4d5850,_0x77e63f);};}http[a22_0x35e8('0x4d')][a22_0x35e8('0x4e')]=0x64;const _0x21883a=http['get'](_0x26eb8a,{'agent':![]},function(_0x4794f2){let _0x470b1c=0x0;let _0x40c065=0x0;function _0x1e6f1c(){if(_0x470b1c===undefined){console[a22_0x35e8('0x30')](_0x4b12d0+a22_0x35e8('0x4f')+_0x40c065+'/'+'?');}const _0x45dfe4=_0x40c065/_0x470b1c*0x64;console[a22_0x35e8('0x30')](_0x4b12d0+'\x20Progress:\x20'+_0x45dfe4+'%\x09'+_0x40c065+'/'+_0x470b1c);}console[a22_0x35e8('0x30')](_0x4b12d0+'\x20'+_0x4794f2[a22_0x35e8('0x50')]);switch(_0x4794f2[a22_0x35e8('0x50')]){case 0xc8:_0x470b1c=_0x4794f2[a22_0x35e8('0x51')][a22_0x35e8('0x52')]||_0x1bcc3e;fs[a22_0x35e8('0x53')](_0x4b3c6c,function(_0x467185,_0x3a3c4f){if(!_0x467185){console[a22_0x35e8('0x30')](a22_0x35e8('0x54')+_0x4b3c6c);if(_0x3a3c4f[a22_0x35e8('0x55')]==_0x470b1c){console['log'](a22_0x35e8('0x56')+_0x470b1c+')');console['log'](a22_0x35e8('0x57'));}else{console[a22_0x35e8('0x30')](a22_0x35e8('0x58')+_0x3a3c4f['size']+a22_0x35e8('0x59')+_0x470b1c+')');}}_0x14e0bc=fs[a22_0x35e8('0x5a')](_0x4b3c6c);_0x4794f2[a22_0x35e8('0x5b')](_0x14e0bc);_0x4794f2['on'](a22_0x35e8('0x5c'),function(_0x443623){_0x40c065+=_0x443623['length'];_0x1e6f1c();});_0x21883a['on'](a22_0x35e8('0x40'),function(_0x467185){console[a22_0x35e8('0x30')](a22_0x35e8('0x5d'));console[a22_0x35e8('0x30')](_0x467185);});_0x14e0bc['on'](a22_0x35e8('0x5e'),function(){console[a22_0x35e8('0x30')](a22_0x35e8('0x5f')+_0x26eb8a+a22_0x35e8('0x4b')+_0x4b12d0);_0x540d6e(null,_0x4b12d0,_0x5c03c2,_0x4b12d0);}[a22_0x35e8('0x3b')](this));});break;case 0x12e:const _0x1431c6=_0x4794f2[a22_0x35e8('0x51')]['location'];console[a22_0x35e8('0x30')]('Redirect\x20'+_0x26eb8a+a22_0x35e8('0x4b')+_0x1431c6);if(_0x393423<0x5){this[a22_0x35e8('0x48')](_0x1431c6,_0x4b12d0,_0x540d6e,_0x393423++);}else{console['error'](a22_0x35e8('0x60')+_0x26eb8a+'.');_0x540d6e(a22_0x35e8('0x61'),null,null,null);}return;case 0x194:console[a22_0x35e8('0x30')](a22_0x35e8('0x62')+_0x26eb8a);default:console[a22_0x35e8('0x30')](a22_0x35e8('0x63')+_0x26eb8a+a22_0x35e8('0x64')+_0x4794f2['statusCode']);_0x21883a[a22_0x35e8('0x65')]();_0x540d6e(_0x4794f2[a22_0x35e8('0x50')],null,null,null);return;}})['on']('error',function(_0x5c09cd){console[a22_0x35e8('0x30')](a22_0x35e8('0x66')+_0x26eb8a+'\x20'+_0x5c09cd[a22_0x35e8('0x67')]);_0x540d6e(_0x5c09cd,null,null,null);});}[a22_0x35e8('0x49')](_0x5cacfe,_0x8e62ac,_0x30b339,_0x577bf7){console[a22_0x35e8('0x30')](a22_0x35e8('0x49'));console[a22_0x35e8('0x30')](_0x5cacfe);console['log'](_0x8e62ac);console['log'](_0x30b339);console[a22_0x35e8('0x30')](_0x577bf7);if(_0x30b339=='image'){const _0xa3c8da=this['downloadFiles'][this[a22_0x35e8('0x17')]][a22_0x35e8('0x68')]!=null?this[a22_0x35e8('0x18')][this[a22_0x35e8('0x17')]][a22_0x35e8('0x68')]:0x1e;this[a22_0x35e8('0x69')](_0x577bf7,_0xa3c8da);}else if(_0x30b339==a22_0x35e8('0x6a')){if(_0x5cacfe==null&&_0x8e62ac!=''){this[a22_0x35e8('0x17')]++;}this[a22_0x35e8('0x39')]();}console[a22_0x35e8('0x30')](this[a22_0x35e8('0x17')]);}[a22_0x35e8('0x6b')](_0x3de08c,_0x5524a2,_0x36e7ac){progress(request(_0x3de08c),{})['on'](a22_0x35e8('0x6c'),function(_0x5500ed){console['log'](_0x5500ed);})['on'](a22_0x35e8('0x40'),function(_0x322cc0){console[a22_0x35e8('0x30')](a22_0x35e8('0x6d'));this[a22_0x35e8('0x39')]();})['on'](a22_0x35e8('0x6e'),function(){console[a22_0x35e8('0x30')](a22_0x35e8('0x6f')+_0x5524a2);console[a22_0x35e8('0x30')](a22_0x35e8('0x70')+_0x36e7ac);if(_0x36e7ac==a22_0x35e8('0x71')){const _0x2bc125=this[a22_0x35e8('0x18')][this[a22_0x35e8('0x17')]][a22_0x35e8('0x68')]!=null?this['downloadFiles'][this[a22_0x35e8('0x17')]]['duration']:0x1e;this[a22_0x35e8('0x69')](_0x5524a2,_0x2bc125);}else if(_0x36e7ac==a22_0x35e8('0x6a')){this[a22_0x35e8('0x17')]++;this['download']();}}[a22_0x35e8('0x3b')](this))['pipe'](fs[a22_0x35e8('0x5a')](this['tempFolder']+_0x5524a2));}[a22_0x35e8('0x69')](_0x4c6699,_0x3b0829=0x1e){const _0x3f641d=this[a22_0x35e8('0xf')]+_0x4c6699;console[a22_0x35e8('0x30')](_0x3f641d);console[a22_0x35e8('0x30')](_0x4c6699);const _0x85f25e=_0x4c6699[a22_0x35e8('0x72')]('.')[a22_0x35e8('0x73')](0x0,-0x1)[a22_0x35e8('0x74')]('.');const _0x2bc087=a22_0x35e8('0x75');const _0xf5c271=['-y','-r',a22_0x35e8('0x76'),a22_0x35e8('0x77'),'1',a22_0x35e8('0x78'),'glob','-i',_0x3f641d,'-t',String(_0x3b0829),a22_0x35e8('0x79'),a22_0x35e8('0x7a'),'-pix_fmt',a22_0x35e8('0x7b'),'-r','25',a22_0x35e8('0x7c'),a22_0x35e8('0x7d'),this['tempFolder']+_0x85f25e+'.mp4'];const _0x1debcf=spawn(_0x2bc087,_0xf5c271);_0x1debcf['stdout']['on'](a22_0x35e8('0x5c'),function(_0x273a27){console[a22_0x35e8('0x30')]('Converting\x20'+_0x3f641d);});_0x1debcf[a22_0x35e8('0x7e')]['on'](a22_0x35e8('0x5c'),function(_0x4cf05f){console[a22_0x35e8('0x30')]('stderr:\x20'+_0x4cf05f);}[a22_0x35e8('0x3b')](this));_0x1debcf['on']('close',function(){console[a22_0x35e8('0x30')]('finished\x20mp4\x20convert');this[a22_0x35e8('0x17')]++;this[a22_0x35e8('0x39')]();}[a22_0x35e8('0x3b')](this));}[a22_0x35e8('0x47')](_0x51dc04){const _0x1cddde=youtubedl(a22_0x35e8('0x7f')+_0x51dc04,[a22_0x35e8('0x80')],{'cwd':__dirname});_0x1cddde['on'](a22_0x35e8('0x81'),function(_0x49bcc7){console['log']('Download\x20started');console['log']('filename:\x20'+_0x49bcc7[a22_0x35e8('0x82')]);console[a22_0x35e8('0x30')](a22_0x35e8('0x83')+_0x49bcc7[a22_0x35e8('0x55')]);});_0x1cddde['on']('complete',function complete(_0x2f2a34){'use strict';console['log']('filename:\x20'+_0x2f2a34['_filename']+a22_0x35e8('0x84'));});_0x1cddde['on'](a22_0x35e8('0x6e'),function(){console[a22_0x35e8('0x30')](a22_0x35e8('0x85'));this['currentFile']++;this[a22_0x35e8('0x39')]();}[a22_0x35e8('0x3b')](this));_0x1cddde[a22_0x35e8('0x5b')](fs[a22_0x35e8('0x5a')](this['tempFolder']+'/'+_0x51dc04+a22_0x35e8('0x86')));}['finishProcess'](){fs[a22_0x35e8('0x87')](this[a22_0x35e8('0x12')],JSON['stringify'](this[a22_0x35e8('0x19')]));let _0x32c5b3=a22_0x35e8('0x88')+'\x0d\x0a'+a22_0x35e8('0x89')+'\x0d\x0a';for(const _0xc85c0e in this['downloadFiles']){const _0x125de8=this[a22_0x35e8('0x18')][_0xc85c0e][a22_0x35e8('0x43')];const _0xf3cd59=this[a22_0x35e8('0x18')][_0xc85c0e]['media_type'];const _0x5efdc6=_0x125de8['substring'](_0x125de8['lastIndexOf']('/')+0x1);let _0x5a790d=_0x5efdc6[a22_0x35e8('0x72')]('.')[a22_0x35e8('0x73')](0x0,-0x1)[a22_0x35e8('0x74')]('.');if(_0xf3cd59==a22_0x35e8('0x46')){_0x5a790d=_0x125de8;}_0x32c5b3+=a22_0x35e8('0x8a')+_0x5a790d+a22_0x35e8('0x86')+'\x0d\x0a';}fsExtra[a22_0x35e8('0x35')](this['filesFolder']);fsExtra[a22_0x35e8('0x8b')](this[a22_0x35e8('0xf')],this[a22_0x35e8('0x15')]);fs[a22_0x35e8('0x87')](this[a22_0x35e8('0x14')],_0x32c5b3);fsExtra['emptyDirSync'](this[a22_0x35e8('0xf')]);console[a22_0x35e8('0x30')](a22_0x35e8('0x8c'));const _0x46428b=spawn(a22_0x35e8('0x8d'),['-r',a22_0x35e8('0x8e')]);}}exports[a22_0x35e8('0x8f')]=SyncPlaylistsService;