var a21_0x3992=['substring','lastIndexOf','Downloading:\x20','progress','percent','Error\x20downloading\x20file','duration','createWriteStream','tempFolder','createImageVideo','join','ffmpeg','1/2','glob','-c:v','-pix_fmt','yuv420p','.mp4','stdout','data','Converting\x20','stderr:\x20','close','finished\x20mp4\x20convert','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','slice','/home/osmc/luloclient/media/files/','emptyDirSync','Finished','shutdown','now','defineProperty','__esModule','fs-extra','request','request-progress','spawn','string-template','mediaFolder','temp/','filesFolder','files/','playListFile','playlist.txt','lulo_playlist.m3u','downloadFiles','newPlayList','init','parse','readFileSync','config.json','playerId','baseURL','env','player_playlist.php?player_id={0}','checkFolders','loadMediaList','ensureDir','playListServiceURL','log','hasPlayListChanged','currentFile','length','download','No\x20playlist\x20changes','bind','stringify','existsSync','toString','error','this.currentFile:\x20','path'];(function(_0x1efb3d,_0x28d719){var _0x4d00d3=function(_0x37af3a){while(--_0x37af3a){_0x1efb3d['push'](_0x1efb3d['shift']());}};_0x4d00d3(++_0x28d719);}(a21_0x3992,0x1dd));var a21_0x3922=function(_0x15a9c0,_0x3f38e6){_0x15a9c0=_0x15a9c0-0x0;var _0x40f71a=a21_0x3992[_0x15a9c0];return _0x40f71a;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object[a21_0x3922('0x0')](exports,a21_0x3922('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x3922('0x2'));const request=require(a21_0x3922('0x3'));const progress=require(a21_0x3922('0x4'));const spawn=require('child_process')[a21_0x3922('0x5')];const isImage=require('is-image');const format=require(a21_0x3922('0x6'));const os=require('os');class SyncPlaylistsService{constructor(){this['mediaFolder']='media/';this['tempFolder']=this[a21_0x3922('0x7')]+a21_0x3922('0x8');this[a21_0x3922('0x9')]=this[a21_0x3922('0x7')]+a21_0x3922('0xa');this[a21_0x3922('0xb')]=this['mediaFolder']+a21_0x3922('0xc');this['m3uFile']=this[a21_0x3922('0x9')]+a21_0x3922('0xd');this['currentFile']=0x0;this[a21_0x3922('0xe')]=[];this[a21_0x3922('0xf')]={};}[a21_0x3922('0x10')](){const _0x3f7b53=JSON[a21_0x3922('0x11')](fs[a21_0x3922('0x12')](a21_0x3922('0x13')));this[a21_0x3922('0x14')]=_0x3f7b53[a21_0x3922('0x14')];this[a21_0x3922('0x15')]=process[a21_0x3922('0x16')]['WEB_SERVICE_URL'];this['playListServiceURL']=this[a21_0x3922('0x15')]+a21_0x3922('0x17');this[a21_0x3922('0x18')]();this[a21_0x3922('0x19')]();}[a21_0x3922('0x18')](){fsExtra[a21_0x3922('0x1a')](this['mediaFolder'],_0x12c258=>{});fsExtra[a21_0x3922('0x1a')](this['tempFolder'],_0x37ee7f=>{});fsExtra[a21_0x3922('0x1a')](this[a21_0x3922('0x9')],_0x20ed34=>{});}['loadMediaList'](){const _0x39e0a7=format(this[a21_0x3922('0x1b')],this['playerId']);console[a21_0x3922('0x1c')](_0x39e0a7);request({'url':_0x39e0a7,'json':!![]},function(_0x557ce8,_0x3a9c44,_0x2b9408){this[a21_0x3922('0xf')]=_0x2b9408;if(this[a21_0x3922('0x1d')]()){this[a21_0x3922('0xe')]=[];this[a21_0x3922('0x1e')]=0x0;for(const _0x4c37c9 in _0x2b9408){this['downloadFiles']['push'](_0x2b9408[_0x4c37c9]);}console[a21_0x3922('0x1c')]('Total:\x20'+this['downloadFiles'][a21_0x3922('0x1f')]);if(this['downloadFiles'][a21_0x3922('0x1f')]>0x0){this[a21_0x3922('0x20')]();}}else{console[a21_0x3922('0x1c')](a21_0x3922('0x21'));}}[a21_0x3922('0x22')](this));}['reloadMediaList'](){fs['unlinkSync'](this[a21_0x3922('0xb')]);this[a21_0x3922('0x19')]();}['hasPlayListChanged'](){const _0x5cb12e=JSON[a21_0x3922('0x23')](this['newPlayList']);try{if(!fs[a21_0x3922('0x24')](this[a21_0x3922('0xb')])){return!![];}else{const _0x2f050b=fs['readFileSync'](this[a21_0x3922('0xb')])[a21_0x3922('0x25')]();if(_0x2f050b!=_0x5cb12e){return!![];}}}catch(_0x594477){console[a21_0x3922('0x26')](_0x594477);}return![];}[a21_0x3922('0x20')](){console['log'](a21_0x3922('0x27')+this[a21_0x3922('0x1e')]);if(this[a21_0x3922('0x1e')]>=this['downloadFiles'][a21_0x3922('0x1f')]){this['finishProcess']();return;}const _0x3d8e7a=String(this['downloadFiles'][this[a21_0x3922('0x1e')]][a21_0x3922('0x28')]);const _0x243cf8=_0x3d8e7a[a21_0x3922('0x29')](_0x3d8e7a[a21_0x3922('0x2a')]('/')+0x1);console[a21_0x3922('0x1c')](a21_0x3922('0x2b')+_0x243cf8);progress(request(this['baseURL']+_0x3d8e7a),{})['on'](a21_0x3922('0x2c'),function(_0x48d837){console[a21_0x3922('0x1c')](a21_0x3922('0x2c'),_0x48d837[a21_0x3922('0x2d')]);})['on'](a21_0x3922('0x26'),function(_0x183b6a){console[a21_0x3922('0x1c')](a21_0x3922('0x2e'));this[a21_0x3922('0x20')]();})['on']('end',function(){console[a21_0x3922('0x1c')]('Downloaded:\x20'+_0x243cf8);if(isImage(_0x243cf8)){const _0x6ef78a=this[a21_0x3922('0xe')][this[a21_0x3922('0x1e')]]['duration']!=null?this[a21_0x3922('0xe')][this[a21_0x3922('0x1e')]][a21_0x3922('0x2f')]:0x1e;this['createImageVideo'](_0x243cf8,_0x6ef78a);}else{this[a21_0x3922('0x1e')]++;this[a21_0x3922('0x20')]();}}[a21_0x3922('0x22')](this))['pipe'](fs[a21_0x3922('0x30')](this[a21_0x3922('0x31')]+_0x243cf8));}[a21_0x3922('0x32')](_0x4e993c,_0xeecfef=0x1e){const _0x1c407c=this[a21_0x3922('0x31')]+_0x4e993c;const _0x5b2682=_0x4e993c['split']('.')['slice'](0x0,-0x1)[a21_0x3922('0x33')]('.');const _0x1182d2=a21_0x3922('0x34');const _0x254da8=['-y','-r',a21_0x3922('0x35'),'-loop','1','-pattern_type',a21_0x3922('0x36'),'-i',_0x1c407c,'-t',String(_0xeecfef),a21_0x3922('0x37'),'libx264',a21_0x3922('0x38'),a21_0x3922('0x39'),'-r','25','-vf','scale=1920:1080',this['tempFolder']+_0x5b2682+a21_0x3922('0x3a')];const _0x330e3b=spawn(_0x1182d2,_0x254da8);_0x330e3b[a21_0x3922('0x3b')]['on'](a21_0x3922('0x3c'),function(_0x1b6a85){console['log'](a21_0x3922('0x3d')+_0x1c407c);});_0x330e3b['stderr']['on'](a21_0x3922('0x3c'),function(_0x244276){console[a21_0x3922('0x1c')](a21_0x3922('0x3e')+_0x244276);}[a21_0x3922('0x22')](this));_0x330e3b['on'](a21_0x3922('0x3f'),function(){console[a21_0x3922('0x1c')](a21_0x3922('0x40'));this[a21_0x3922('0x1e')]++;this['download']();}[a21_0x3922('0x22')](this));}['finishProcess'](){fs[a21_0x3922('0x41')](this[a21_0x3922('0xb')],JSON[a21_0x3922('0x23')](this[a21_0x3922('0xf')]));let _0x4bd6dc=a21_0x3922('0x42')+'\x0d\x0a'+a21_0x3922('0x43')+'\x0d\x0a';for(const _0x1c0f15 in this[a21_0x3922('0xe')]){const _0x2d959a=this[a21_0x3922('0xe')][_0x1c0f15][a21_0x3922('0x28')];const _0x6659df=_0x2d959a[a21_0x3922('0x29')](_0x2d959a[a21_0x3922('0x2a')]('/')+0x1);const _0x254a88=_0x6659df['split']('.')[a21_0x3922('0x44')](0x0,-0x1)[a21_0x3922('0x33')]('.');_0x4bd6dc+=a21_0x3922('0x45')+_0x254a88+a21_0x3922('0x3a')+'\x0d\x0a';}fsExtra[a21_0x3922('0x46')](this['filesFolder']);fsExtra['copySync'](this[a21_0x3922('0x31')],this['filesFolder']);fs['writeFileSync'](this['m3uFile'],_0x4bd6dc);fsExtra[a21_0x3922('0x46')](this[a21_0x3922('0x31')]);console[a21_0x3922('0x1c')](a21_0x3922('0x47'));const _0x45519a=spawn(a21_0x3922('0x48'),['-r',a21_0x3922('0x49')]);}}exports['SyncPlaylistsService']=SyncPlaylistsService;