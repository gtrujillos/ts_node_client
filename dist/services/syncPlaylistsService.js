var a22_0x28fd=['stdout','data','Converting\x20','stderr','stderr:\x20','close','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','info','filename:\x20','size:\x20','complete','_filename','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','finishProcess','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','path','media_type','split','/home/osmc/luloclient/media/files/','copySync','shutdown','now','SyncPlaylistsService','defineProperty','../infrastructure/HttpClientService','url','http','fs-extra','request-progress','child_process','spawn','is-image','string-template','youtube-dl','uuid/v4','config.json','mt-files-downloader','media/','mediaFolder','temp/','filesFolder','files/','m3uFile','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','HttpClientService','init','config','parse','readFileSync','context','playerId','env','WEB_SERVICE_URL','deploy/','playListServiceURL','baseURL','api/player_playlist.php?player_id={0}','checkFolders','loadMediaList','registerClient','deviceUuid','writeFileSync','stringify','httpClientService','post','then','ensureDir','tempFolder','log','hasPlayListChanged','emptyDirSync','length','No\x20playlist\x20changes','bind','reloadMediaList','existsSync','playListFile','removeSync','toString','\x20of\x20','substring','lastIndexOf','Downloading:\x20','downloadYouTube','downloader','downloading:\x20','start','start:\x20','download','end','Downloaded:\x20','mediaType:\x20','image','duration','createImageVideo','video','stopped','destroyed','retry','downloadHTTPFile','Attempting\x20to\x20download\x20','\x20to\x20','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','globalAgent','maxSockets','host','get','\x20Progress:\x20unknown\x09','statusCode','content-length','stat','Have\x20already\x20downloaded\x20','size','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','createWriteStream','pipe','error','err:\x20','finish','Downloaded\x20','headers','location','Redirect\x20','302','File\x20Not\x20Found\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','downloadHTTPFileCallback','downloadRequestFile','progress','Error\x20downloading\x20file','slice','join','ffmpeg','1/2','-loop','glob','-c:v','libx264','-pix_fmt','yuv420p','scale=1920:1080','.mp4'];(function(_0x326b86,_0x5c7ca7){var _0xf07ccc=function(_0x19e8d9){while(--_0x19e8d9){_0x326b86['push'](_0x326b86['shift']());}};_0xf07ccc(++_0x5c7ca7);}(a22_0x28fd,0x14a));var a22_0x4afe=function(_0x4721ba,_0x1993ad){_0x4721ba=_0x4721ba-0x0;var _0xf5219b=a22_0x28fd[_0x4721ba];return _0xf5219b;};'use strict';Object[a22_0x4afe('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a22_0x4afe('0x1'));const fs=require('fs');const url=require(a22_0x4afe('0x2'));const http=require(a22_0x4afe('0x3'));const fsExtra=require(a22_0x4afe('0x4'));const request=require('request');const progress=require(a22_0x4afe('0x5'));const spawn=require(a22_0x4afe('0x6'))[a22_0x4afe('0x7')];const isImage=require(a22_0x4afe('0x8'));const format=require(a22_0x4afe('0x9'));const os=require('os');const youtubedl=require(a22_0x4afe('0xa'));const uuidv4=require(a22_0x4afe('0xb'));const configFile=a22_0x4afe('0xc');const contextFile='context.json';const Downloader=require(a22_0x4afe('0xd'));class SyncPlaylistsService{constructor(){this['mediaFolder']=a22_0x4afe('0xe');this['tempFolder']=this[a22_0x4afe('0xf')]+a22_0x4afe('0x10');this[a22_0x4afe('0x11')]=this['mediaFolder']+a22_0x4afe('0x12');this['playListFile']=this[a22_0x4afe('0xf')]+'playlist.txt';this[a22_0x4afe('0x13')]=this[a22_0x4afe('0x11')]+a22_0x4afe('0x14');this[a22_0x4afe('0x15')]=0x0;this[a22_0x4afe('0x16')]=[];this[a22_0x4afe('0x17')]={};this['httpClientService']=new HttpClientService_1[(a22_0x4afe('0x18'))]();}[a22_0x4afe('0x19')](){this[a22_0x4afe('0x1a')]=JSON[a22_0x4afe('0x1b')](fs[a22_0x4afe('0x1c')](configFile));this[a22_0x4afe('0x1d')]=JSON[a22_0x4afe('0x1b')](fs[a22_0x4afe('0x1c')](contextFile));this[a22_0x4afe('0x1e')]=this[a22_0x4afe('0x1a')]['playerId'];this['baseURL']=process[a22_0x4afe('0x1f')][a22_0x4afe('0x20')]+a22_0x4afe('0x21');this[a22_0x4afe('0x22')]=this[a22_0x4afe('0x23')]+a22_0x4afe('0x24');this['registerClient']();this[a22_0x4afe('0x25')]();this[a22_0x4afe('0x26')]();}[a22_0x4afe('0x27')](){const _0x1f8238=this[a22_0x4afe('0x1a')][a22_0x4afe('0x28')];if(!_0x1f8238||_0x1f8238==''){this[a22_0x4afe('0x1a')][a22_0x4afe('0x28')]=uuidv4();this[a22_0x4afe('0x1a')]={'deviceUuid':this[a22_0x4afe('0x1a')][a22_0x4afe('0x28')],'playerId':this[a22_0x4afe('0x1a')][a22_0x4afe('0x1e')]};fs[a22_0x4afe('0x29')](configFile,JSON['stringify'](this[a22_0x4afe('0x1a')]));}const _0x455dd5={'player_id':this['playerId'],'device_uuid':this[a22_0x4afe('0x1a')][a22_0x4afe('0x28')],'network_info':JSON['stringify'](os['networkInterfaces']()),'firmware_info':JSON[a22_0x4afe('0x2a')](this[a22_0x4afe('0x1d')]),'status':0x1};this[a22_0x4afe('0x2b')][a22_0x4afe('0x2c')]('http://restapi.lulo.run/player_devices/register',_0x455dd5,![])[a22_0x4afe('0x2d')](function(_0x9adbc0){console['log']('parsedBody');console['log'](_0x9adbc0);})['catch'](function(_0x37d41d){});}[a22_0x4afe('0x25')](){fsExtra[a22_0x4afe('0x2e')](this[a22_0x4afe('0xf')],_0x25c295=>{});fsExtra[a22_0x4afe('0x2e')](this[a22_0x4afe('0x2f')],_0x30bd5c=>{});fsExtra[a22_0x4afe('0x2e')](this['filesFolder'],_0x20edcc=>{});}[a22_0x4afe('0x26')](){const _0x58aa11=format(this[a22_0x4afe('0x22')],this['playerId']);console[a22_0x4afe('0x30')](_0x58aa11);request({'url':_0x58aa11,'json':!![]},function(_0x28863b,_0x27dd97,_0x513bdd){console[a22_0x4afe('0x30')](_0x513bdd);this[a22_0x4afe('0x17')]=_0x513bdd;if(this[a22_0x4afe('0x31')]()){fsExtra[a22_0x4afe('0x32')](this['tempFolder']);this['downloadFiles']=[];this['currentFile']=0x0;for(const _0x110c6c in _0x513bdd){this[a22_0x4afe('0x16')]['push'](_0x513bdd[_0x110c6c]);}console[a22_0x4afe('0x30')]('Total:\x20'+this['downloadFiles'][a22_0x4afe('0x33')]);if(this[a22_0x4afe('0x16')][a22_0x4afe('0x33')]>0x0){this['download']();}}else{console['log'](a22_0x4afe('0x34'));}}[a22_0x4afe('0x35')](this));}[a22_0x4afe('0x36')](){if(fsExtra[a22_0x4afe('0x37')](this[a22_0x4afe('0x38')])){fsExtra[a22_0x4afe('0x39')](this[a22_0x4afe('0x38')]);}this[a22_0x4afe('0x26')]();}[a22_0x4afe('0x31')](){const _0x28f000=JSON[a22_0x4afe('0x2a')](this[a22_0x4afe('0x17')]);try{if(!fs[a22_0x4afe('0x37')](this[a22_0x4afe('0x38')])){return!![];}else{const _0x5ac955=fs['readFileSync'](this[a22_0x4afe('0x38')])[a22_0x4afe('0x3a')]();if(_0x5ac955!=_0x28f000){return!![];}}}catch(_0x34fbc5){console['error'](_0x34fbc5);}return![];}['download'](){console['log']('this.currentFile:\x20'+this['currentFile']+a22_0x4afe('0x3b')+this[a22_0x4afe('0x16')][a22_0x4afe('0x33')]);if(this[a22_0x4afe('0x15')]>=this[a22_0x4afe('0x16')][a22_0x4afe('0x33')]){this['finishProcess']();return;}const _0x744be=String(this[a22_0x4afe('0x16')][this['currentFile']]['path']);const _0x15139a=this[a22_0x4afe('0x16')][this[a22_0x4afe('0x15')]]['media_type'];const _0x587ad7=_0x744be[a22_0x4afe('0x3c')](_0x744be[a22_0x4afe('0x3d')]('/')+0x1);const _0x56ad41=this[a22_0x4afe('0x23')]+_0x744be;console[a22_0x4afe('0x30')](a22_0x4afe('0x3e')+_0x56ad41);if(_0x15139a=='youtube_single'){this[a22_0x4afe('0x3f')](_0x744be);}else{this[a22_0x4afe('0x40')](_0x56ad41,_0x587ad7,_0x15139a);}}['downloader'](_0x31bfa8,_0x13abe5,_0x2625c9){console['log'](a22_0x4afe('0x41')+_0x31bfa8);const _0x3a3976=new Downloader();console[a22_0x4afe('0x30')](_0x31bfa8);console['log'](_0x13abe5);console[a22_0x4afe('0x30')](_0x2625c9);const _0x1c78d0=_0x3a3976['download'](_0x31bfa8,this[a22_0x4afe('0x2f')]+_0x13abe5);_0x1c78d0['start']();_0x1c78d0['on'](a22_0x4afe('0x42'),function(_0x1c78d0){console[a22_0x4afe('0x30')](a22_0x4afe('0x43')+_0x31bfa8);});_0x1c78d0['on']('error',function(_0x1c78d0){console[a22_0x4afe('0x30')]('error');this[a22_0x4afe('0x44')]();}[a22_0x4afe('0x35')](this));_0x1c78d0['on'](a22_0x4afe('0x45'),function(_0x1c78d0){console[a22_0x4afe('0x30')]('end');console[a22_0x4afe('0x30')](a22_0x4afe('0x46')+_0x13abe5);console[a22_0x4afe('0x30')](a22_0x4afe('0x47')+_0x2625c9);if(_0x2625c9==a22_0x4afe('0x48')){const _0x39373f=this['downloadFiles'][this[a22_0x4afe('0x15')]][a22_0x4afe('0x49')]!=null?this[a22_0x4afe('0x16')][this[a22_0x4afe('0x15')]][a22_0x4afe('0x49')]:0x1e;this[a22_0x4afe('0x4a')](_0x13abe5,_0x39373f);}else if(_0x2625c9==a22_0x4afe('0x4b')){this[a22_0x4afe('0x15')]++;this[a22_0x4afe('0x44')]();}}[a22_0x4afe('0x35')](this));_0x1c78d0['on'](a22_0x4afe('0x4c'),function(_0x1c78d0){console[a22_0x4afe('0x30')](a22_0x4afe('0x4c'));});_0x1c78d0['on'](a22_0x4afe('0x4d'),function(_0x1c78d0){console[a22_0x4afe('0x30')](a22_0x4afe('0x4d'));});_0x1c78d0['on'](a22_0x4afe('0x4e'),function(_0x1c78d0){console[a22_0x4afe('0x30')](a22_0x4afe('0x4e'));});}['downloadHTTPFile'](_0x304aab,_0x20659a,_0x56c242,_0x25a6c3){console[a22_0x4afe('0x30')](a22_0x4afe('0x4f'));console['log'](_0x304aab);const _0x51f206=!![];let _0x56248c=0x0;const _0x3153f0='';console['log'](a22_0x4afe('0x50')+_0x304aab+a22_0x4afe('0x51')+_0x20659a);if(_0x56248c){if(_0x56248c>0x5){_0x25a6c3('Max\x20redirects\x20reached',_0x304aab,_0x56c242,null);return;}}else{_0x56248c=0x0;}const _0x326b26=this[a22_0x4afe('0x2f')]+_0x20659a;let _0x3d80fb;if(_0x25a6c3===undefined){console[a22_0x4afe('0x30')](a22_0x4afe('0x52')+_0x304aab+'\x20to\x20'+_0x326b26);_0x25a6c3=function(_0x1bfed9,_0x2900cd){console['log']('downloadFile\x20callback\x20result\x20undefined:\x20',_0x1bfed9,_0x2900cd);};}http[a22_0x4afe('0x53')][a22_0x4afe('0x54')]=0x64;const _0x23b5b6={'host':url[a22_0x4afe('0x1b')](_0x304aab)[a22_0x4afe('0x55')],'port':0x50,'path':url[a22_0x4afe('0x1b')](_0x304aab)['pathname'],'agent':![]};const _0x1d2fa0=http[a22_0x4afe('0x56')](_0x23b5b6,function(_0x130e5e){let _0x92844a=0x0;let _0x1806fc=0x0;function _0x4419e9(){if(_0x92844a===undefined){console[a22_0x4afe('0x30')](_0x20659a+a22_0x4afe('0x57')+_0x1806fc+'/'+'?');}const _0x3d641a=_0x1806fc/_0x92844a*0x64;console[a22_0x4afe('0x30')](_0x20659a+'\x20Progress:\x20'+_0x3d641a+'%\x09'+_0x1806fc+'/'+_0x92844a);}console[a22_0x4afe('0x30')](_0x20659a+'\x20'+_0x130e5e[a22_0x4afe('0x58')]);switch(_0x130e5e[a22_0x4afe('0x58')]){case 0xc8:_0x92844a=_0x130e5e['headers'][a22_0x4afe('0x59')]||_0x3153f0;fs[a22_0x4afe('0x5a')](_0x326b26,function(_0x31e618,_0x134c5a){if(!_0x31e618){console['log'](a22_0x4afe('0x5b')+_0x326b26);if(_0x134c5a[a22_0x4afe('0x5c')]==_0x92844a){console[a22_0x4afe('0x30')]('And\x20the\x20file\x20size\x20matches\x20('+_0x92844a+')');console[a22_0x4afe('0x30')]('Redownloading');}else{console['log'](a22_0x4afe('0x5d')+_0x134c5a['size']+a22_0x4afe('0x5e')+_0x92844a+')');}}_0x3d80fb=fs[a22_0x4afe('0x5f')](_0x326b26);_0x130e5e[a22_0x4afe('0x60')](_0x3d80fb);_0x130e5e['on']('data',function(_0x57b0cb){_0x1806fc+=_0x57b0cb[a22_0x4afe('0x33')];_0x4419e9();});_0x1d2fa0['on'](a22_0x4afe('0x61'),function(_0x31e618){console['log'](a22_0x4afe('0x62'));console[a22_0x4afe('0x30')](_0x31e618);});_0x3d80fb['on'](a22_0x4afe('0x63'),function(){console[a22_0x4afe('0x30')](a22_0x4afe('0x64')+_0x304aab+a22_0x4afe('0x51')+_0x20659a);_0x25a6c3(null,_0x20659a,_0x56c242,_0x20659a);}['bind'](this));});break;case 0x12e:const _0x3c6067=_0x130e5e[a22_0x4afe('0x65')][a22_0x4afe('0x66')];console['log'](a22_0x4afe('0x67')+_0x304aab+a22_0x4afe('0x51')+_0x3c6067);if(_0x56248c<0x5){this[a22_0x4afe('0x4f')](_0x3c6067,_0x20659a,_0x25a6c3,_0x56248c++);}else{console[a22_0x4afe('0x61')]('Redirect\x20limit\x20encountered\x20for\x20'+_0x304aab+'.');_0x25a6c3(a22_0x4afe('0x68'),null,null,null);}return;case 0x194:console['log'](a22_0x4afe('0x69')+_0x304aab);default:console[a22_0x4afe('0x30')]('Problem\x20downloading\x20'+_0x304aab+a22_0x4afe('0x6a')+_0x130e5e[a22_0x4afe('0x58')]);_0x1d2fa0[a22_0x4afe('0x6b')]();_0x25a6c3(_0x130e5e[a22_0x4afe('0x58')],null,null,null);return;}})['on'](a22_0x4afe('0x61'),function(_0x29043d){console[a22_0x4afe('0x30')](a22_0x4afe('0x6c')+_0x304aab+'\x20'+_0x29043d[a22_0x4afe('0x6d')]);_0x25a6c3(_0x29043d,null,null,null);});}['downloadHTTPFileCallback'](_0x4191fb,_0x48899a,_0x411ab7,_0x388684){console[a22_0x4afe('0x30')](a22_0x4afe('0x6e'));console['log'](_0x4191fb);console[a22_0x4afe('0x30')](_0x48899a);console[a22_0x4afe('0x30')](_0x411ab7);console[a22_0x4afe('0x30')](_0x388684);if(_0x411ab7==a22_0x4afe('0x48')){const _0x51f6c6=this[a22_0x4afe('0x16')][this[a22_0x4afe('0x15')]]['duration']!=null?this['downloadFiles'][this[a22_0x4afe('0x15')]][a22_0x4afe('0x49')]:0x1e;this[a22_0x4afe('0x4a')](_0x388684,_0x51f6c6);}else if(_0x411ab7=='video'){if(_0x4191fb==null&&_0x48899a!=''){this['currentFile']++;}this[a22_0x4afe('0x44')]();}console[a22_0x4afe('0x30')](this[a22_0x4afe('0x15')]);}[a22_0x4afe('0x6f')](_0x2828f9,_0x5d6663,_0x4890c6){progress(request(_0x2828f9),{})['on'](a22_0x4afe('0x70'),function(_0x3298d9){console[a22_0x4afe('0x30')](_0x3298d9);})['on'](a22_0x4afe('0x61'),function(_0x751733){console['log'](a22_0x4afe('0x71'));this[a22_0x4afe('0x44')]();})['on']('end',function(){console[a22_0x4afe('0x30')]('Downloaded:\x20'+_0x5d6663);console[a22_0x4afe('0x30')](a22_0x4afe('0x47')+_0x4890c6);if(_0x4890c6==a22_0x4afe('0x48')){const _0x4fd888=this['downloadFiles'][this[a22_0x4afe('0x15')]]['duration']!=null?this[a22_0x4afe('0x16')][this[a22_0x4afe('0x15')]][a22_0x4afe('0x49')]:0x1e;this['createImageVideo'](_0x5d6663,_0x4fd888);}else if(_0x4890c6==a22_0x4afe('0x4b')){this[a22_0x4afe('0x15')]++;this[a22_0x4afe('0x44')]();}}[a22_0x4afe('0x35')](this))['pipe'](fs[a22_0x4afe('0x5f')](this[a22_0x4afe('0x2f')]+_0x5d6663));}[a22_0x4afe('0x4a')](_0x30fdca,_0x255a80=0x1e){const _0x280c57=this[a22_0x4afe('0x2f')]+_0x30fdca;console['log'](_0x280c57);console[a22_0x4afe('0x30')](_0x30fdca);const _0x190dc4=_0x30fdca['split']('.')[a22_0x4afe('0x72')](0x0,-0x1)[a22_0x4afe('0x73')]('.');const _0x539a8d=a22_0x4afe('0x74');const _0x2d211d=['-y','-r',a22_0x4afe('0x75'),a22_0x4afe('0x76'),'1','-pattern_type',a22_0x4afe('0x77'),'-i',_0x280c57,'-t',String(_0x255a80),a22_0x4afe('0x78'),a22_0x4afe('0x79'),a22_0x4afe('0x7a'),a22_0x4afe('0x7b'),'-r','25','-vf',a22_0x4afe('0x7c'),this[a22_0x4afe('0x2f')]+_0x190dc4+a22_0x4afe('0x7d')];const _0x3d1e8d=spawn(_0x539a8d,_0x2d211d);_0x3d1e8d[a22_0x4afe('0x7e')]['on'](a22_0x4afe('0x7f'),function(_0x56da64){console[a22_0x4afe('0x30')](a22_0x4afe('0x80')+_0x280c57);});_0x3d1e8d[a22_0x4afe('0x81')]['on'](a22_0x4afe('0x7f'),function(_0x45997b){console['log'](a22_0x4afe('0x82')+_0x45997b);}['bind'](this));_0x3d1e8d['on'](a22_0x4afe('0x83'),function(){console['log'](a22_0x4afe('0x84'));this[a22_0x4afe('0x15')]++;this[a22_0x4afe('0x44')]();}[a22_0x4afe('0x35')](this));}[a22_0x4afe('0x3f')](_0x59100a){const _0x546dc4=youtubedl(a22_0x4afe('0x85')+_0x59100a,['--format=18'],{'cwd':__dirname});_0x546dc4['on'](a22_0x4afe('0x86'),function(_0x5c6b15){console[a22_0x4afe('0x30')]('Download\x20started');console[a22_0x4afe('0x30')](a22_0x4afe('0x87')+_0x5c6b15['_filename']);console[a22_0x4afe('0x30')](a22_0x4afe('0x88')+_0x5c6b15['size']);});_0x546dc4['on'](a22_0x4afe('0x89'),function complete(_0x1ccc5e){'use strict';console['log'](a22_0x4afe('0x87')+_0x1ccc5e[a22_0x4afe('0x8a')]+a22_0x4afe('0x8b'));});_0x546dc4['on'](a22_0x4afe('0x45'),function(){console[a22_0x4afe('0x30')](a22_0x4afe('0x8c'));this[a22_0x4afe('0x15')]++;this[a22_0x4afe('0x44')]();}['bind'](this));_0x546dc4[a22_0x4afe('0x60')](fs[a22_0x4afe('0x5f')](this[a22_0x4afe('0x2f')]+'/'+_0x59100a+a22_0x4afe('0x7d')));}[a22_0x4afe('0x8d')](){fs['writeFileSync'](this[a22_0x4afe('0x38')],JSON[a22_0x4afe('0x2a')](this[a22_0x4afe('0x17')]));let _0x3eec2b=a22_0x4afe('0x8e')+'\x0d\x0a'+a22_0x4afe('0x8f')+'\x0d\x0a';for(const _0x351f45 in this['downloadFiles']){const _0x12aae5=this['downloadFiles'][_0x351f45][a22_0x4afe('0x90')];const _0xa3214b=this[a22_0x4afe('0x16')][_0x351f45][a22_0x4afe('0x91')];const _0x523cdf=_0x12aae5[a22_0x4afe('0x3c')](_0x12aae5[a22_0x4afe('0x3d')]('/')+0x1);let _0x2fb1f9=_0x523cdf[a22_0x4afe('0x92')]('.')[a22_0x4afe('0x72')](0x0,-0x1)[a22_0x4afe('0x73')]('.');if(_0xa3214b=='youtube_single'){_0x2fb1f9=_0x12aae5;}_0x3eec2b+=a22_0x4afe('0x93')+_0x2fb1f9+'.mp4'+'\x0d\x0a';}fsExtra[a22_0x4afe('0x32')](this[a22_0x4afe('0x11')]);fsExtra[a22_0x4afe('0x94')](this[a22_0x4afe('0x2f')],this[a22_0x4afe('0x11')]);fs[a22_0x4afe('0x29')](this[a22_0x4afe('0x13')],_0x3eec2b);fsExtra[a22_0x4afe('0x32')](this[a22_0x4afe('0x2f')]);console[a22_0x4afe('0x30')]('Finished');const _0x478410=spawn(a22_0x4afe('0x95'),['-r',a22_0x4afe('0x96')]);}}exports[a22_0x4afe('0x97')]=SyncPlaylistsService;