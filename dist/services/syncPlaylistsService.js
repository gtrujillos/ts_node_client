var a22_0x5393=['finished\x20mp4\x20convert','--format=18','info','Download\x20started','_filename','size:\x20','complete','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','.mp4','#EXTCPlayListM3U::M3U','lastIndexOf','join','youtube_single','/home/osmc/luloclient/media/files/','copySync','shutdown','now','SyncPlaylistsService','defineProperty','__esModule','../infrastructure/HttpClientService','http','fs-extra','request','request-progress','child_process','is-image','youtube-dl','uuid/v4','config.json','context.json','tempFolder','mediaFolder','temp/','filesFolder','files/','playlist.txt','lulo_playlist.m3u','downloadFiles','newPlayList','httpClientService','HttpClientService','init','config','readFileSync','context','parse','playerId','baseURL','env','WEB_SERVICE_URL','deploy/','playListServiceURL','checkFolders','loadMediaList','deviceUuid','writeFileSync','stringify','networkInterfaces','post','http://restapi.lulo.run/player_devices/register','then','log','parsedBody','catch','ensureDir','hasPlayListChanged','emptyDirSync','currentFile','push','Total:\x20','length','No\x20playlist\x20changes','bind','reloadMediaList','existsSync','playListFile','removeSync','toString','error','download','finishProcess','path','media_type','substring','Downloading:\x20','downloadYouTube','downloadHTTPFile','downloadHTTPFileCallback','\x20to\x20','Max\x20redirects\x20reached','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','downloadFile\x20callback\x20result\x20undefined:\x20','globalAgent','maxSockets','host','get','\x20Progress:\x20unknown\x09','\x20Progress:\x20','statusCode','headers','content-length','Have\x20already\x20downloaded\x20','size','Redownloading','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','createWriteStream','pipe','data','err:\x20','location','Redirect\x20','Redirect\x20limit\x20encountered\x20for\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','image','duration','createImageVideo','video','progress','Error\x20downloading\x20file','end','split','slice','1/2','-loop','-pattern_type','glob','-c:v','libx264','-pix_fmt','yuv420p','stdout','stderr','close'];(function(_0x116fd5,_0x18c9bd){var _0x4d3ef3=function(_0x244dc4){while(--_0x244dc4){_0x116fd5['push'](_0x116fd5['shift']());}};_0x4d3ef3(++_0x18c9bd);}(a22_0x5393,0x12f));var a22_0x34fe=function(_0x2f184b,_0x150adb){_0x2f184b=_0x2f184b-0x0;var _0x66a54d=a22_0x5393[_0x2f184b];return _0x66a54d;};'use strict';Object[a22_0x34fe('0x0')](exports,a22_0x34fe('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0x34fe('0x2'));const fs=require('fs');const url=require('url');const http=require(a22_0x34fe('0x3'));const fsExtra=require(a22_0x34fe('0x4'));const request=require(a22_0x34fe('0x5'));const progress=require(a22_0x34fe('0x6'));const spawn=require(a22_0x34fe('0x7'))['spawn'];const isImage=require(a22_0x34fe('0x8'));const format=require('string-template');const os=require('os');const youtubedl=require(a22_0x34fe('0x9'));const uuidv4=require(a22_0x34fe('0xa'));const configFile=a22_0x34fe('0xb');const contextFile=a22_0x34fe('0xc');class SyncPlaylistsService{constructor(){this['mediaFolder']='media/';this[a22_0x34fe('0xd')]=this[a22_0x34fe('0xe')]+a22_0x34fe('0xf');this[a22_0x34fe('0x10')]=this['mediaFolder']+a22_0x34fe('0x11');this['playListFile']=this[a22_0x34fe('0xe')]+a22_0x34fe('0x12');this['m3uFile']=this[a22_0x34fe('0x10')]+a22_0x34fe('0x13');this['currentFile']=0x0;this[a22_0x34fe('0x14')]=[];this[a22_0x34fe('0x15')]={};this[a22_0x34fe('0x16')]=new HttpClientService_1[(a22_0x34fe('0x17'))]();}[a22_0x34fe('0x18')](){this[a22_0x34fe('0x19')]=JSON['parse'](fs[a22_0x34fe('0x1a')](configFile));this[a22_0x34fe('0x1b')]=JSON[a22_0x34fe('0x1c')](fs[a22_0x34fe('0x1a')](contextFile));this['playerId']=this[a22_0x34fe('0x19')][a22_0x34fe('0x1d')];this[a22_0x34fe('0x1e')]=process[a22_0x34fe('0x1f')][a22_0x34fe('0x20')]+a22_0x34fe('0x21');this[a22_0x34fe('0x22')]=this[a22_0x34fe('0x1e')]+'api/player_playlist.php?player_id={0}';this['registerClient']();this[a22_0x34fe('0x23')]();this[a22_0x34fe('0x24')]();}['registerClient'](){const _0x39be58=this[a22_0x34fe('0x19')][a22_0x34fe('0x25')];if(!_0x39be58||_0x39be58==''){this[a22_0x34fe('0x19')][a22_0x34fe('0x25')]=uuidv4();this[a22_0x34fe('0x19')]={'deviceUuid':this[a22_0x34fe('0x19')]['deviceUuid'],'playerId':this[a22_0x34fe('0x19')][a22_0x34fe('0x1d')]};fs[a22_0x34fe('0x26')](configFile,JSON[a22_0x34fe('0x27')](this[a22_0x34fe('0x19')]));}const _0x1e57ee={'player_id':this[a22_0x34fe('0x1d')],'device_uuid':this['config'][a22_0x34fe('0x25')],'network_info':JSON[a22_0x34fe('0x27')](os[a22_0x34fe('0x28')]()),'firmware_info':JSON[a22_0x34fe('0x27')](this['context']),'status':0x1};this['httpClientService'][a22_0x34fe('0x29')](a22_0x34fe('0x2a'),_0x1e57ee,![])[a22_0x34fe('0x2b')](function(_0x33406d){console[a22_0x34fe('0x2c')](a22_0x34fe('0x2d'));console['log'](_0x33406d);})[a22_0x34fe('0x2e')](function(_0x589e20){});}[a22_0x34fe('0x23')](){fsExtra[a22_0x34fe('0x2f')](this[a22_0x34fe('0xe')],_0x2d18ab=>{});fsExtra[a22_0x34fe('0x2f')](this[a22_0x34fe('0xd')],_0x50407b=>{});fsExtra[a22_0x34fe('0x2f')](this[a22_0x34fe('0x10')],_0x1883c1=>{});}[a22_0x34fe('0x24')](){const _0x4305e0=format(this[a22_0x34fe('0x22')],this[a22_0x34fe('0x1d')]);console[a22_0x34fe('0x2c')](_0x4305e0);request({'url':_0x4305e0,'json':!![]},function(_0x15bf4e,_0x2ec2e9,_0x2a8310){console['log'](_0x2a8310);this[a22_0x34fe('0x15')]=_0x2a8310;if(this[a22_0x34fe('0x30')]()){fsExtra[a22_0x34fe('0x31')](this[a22_0x34fe('0xd')]);this[a22_0x34fe('0x14')]=[];this[a22_0x34fe('0x32')]=0x0;for(const _0x3789e0 in _0x2a8310){this[a22_0x34fe('0x14')][a22_0x34fe('0x33')](_0x2a8310[_0x3789e0]);}console['log'](a22_0x34fe('0x34')+this[a22_0x34fe('0x14')][a22_0x34fe('0x35')]);if(this['downloadFiles'][a22_0x34fe('0x35')]>0x0){this['download']();}}else{console[a22_0x34fe('0x2c')](a22_0x34fe('0x36'));}}[a22_0x34fe('0x37')](this));}[a22_0x34fe('0x38')](){if(fsExtra[a22_0x34fe('0x39')](this[a22_0x34fe('0x3a')])){fsExtra[a22_0x34fe('0x3b')](this['playListFile']);}this['loadMediaList']();}[a22_0x34fe('0x30')](){const _0xfcb434=JSON[a22_0x34fe('0x27')](this[a22_0x34fe('0x15')]);try{if(!fs[a22_0x34fe('0x39')](this[a22_0x34fe('0x3a')])){return!![];}else{const _0x4e6a5e=fs[a22_0x34fe('0x1a')](this[a22_0x34fe('0x3a')])[a22_0x34fe('0x3c')]();if(_0x4e6a5e!=_0xfcb434){return!![];}}}catch(_0x57c862){console[a22_0x34fe('0x3d')](_0x57c862);}return![];}[a22_0x34fe('0x3e')](){console[a22_0x34fe('0x2c')]('this.currentFile:\x20'+this[a22_0x34fe('0x32')]);if(this[a22_0x34fe('0x32')]>=this[a22_0x34fe('0x14')]['length']){this[a22_0x34fe('0x3f')]();return;}const _0x23ed1d=String(this[a22_0x34fe('0x14')][this[a22_0x34fe('0x32')]][a22_0x34fe('0x40')]);const _0x51c66e=this[a22_0x34fe('0x14')][this['currentFile']][a22_0x34fe('0x41')];const _0x38db1b=_0x23ed1d[a22_0x34fe('0x42')](_0x23ed1d['lastIndexOf']('/')+0x1);const _0x39784b=this[a22_0x34fe('0x1e')]+_0x23ed1d;console['log'](a22_0x34fe('0x43')+_0x39784b);if(_0x51c66e=='youtube_single'){this[a22_0x34fe('0x44')](_0x23ed1d);}else{this[a22_0x34fe('0x45')](_0x39784b,_0x38db1b,_0x51c66e,this[a22_0x34fe('0x46')]['bind'](this));}}[a22_0x34fe('0x45')](_0x2c7ee0,_0x2c1e49,_0x2cacca,_0xb2e85c){console[a22_0x34fe('0x2c')]('downloadHTTPFile');console[a22_0x34fe('0x2c')](_0x2c7ee0);const _0x24e8a5=!![];let _0x5ef253=0x0;const _0x49cad2='';console[a22_0x34fe('0x2c')]('Attempting\x20to\x20download\x20'+_0x2c7ee0+a22_0x34fe('0x47')+_0x2c1e49);if(_0x5ef253){if(_0x5ef253>0x5){_0xb2e85c(a22_0x34fe('0x48'),_0x2c7ee0,_0x2cacca,null);return;}}else{_0x5ef253=0x0;}const _0x1d8ab1=this[a22_0x34fe('0xd')]+_0x2c1e49;let _0x5e3f66;if(_0xb2e85c===undefined){console['log'](a22_0x34fe('0x49')+_0x2c7ee0+'\x20to\x20'+_0x1d8ab1);_0xb2e85c=function(_0x522a9e,_0x2ae437){console[a22_0x34fe('0x2c')](a22_0x34fe('0x4a'),_0x522a9e,_0x2ae437);};}http[a22_0x34fe('0x4b')][a22_0x34fe('0x4c')]=0x64;const _0x2af478={'host':url['parse'](_0x2c7ee0)[a22_0x34fe('0x4d')],'port':0x50,'path':url[a22_0x34fe('0x1c')](_0x2c7ee0)['pathname'],'agent':![]};const _0x2cc50d=http[a22_0x34fe('0x4e')](_0x2af478,function(_0x56a5f0){let _0x19cb67=0x0;let _0x51ed52=0x0;function _0x149589(){if(_0x19cb67===undefined){console[a22_0x34fe('0x2c')](_0x2c1e49+a22_0x34fe('0x4f')+_0x51ed52+'/'+'?');}const _0x42d92e=_0x51ed52/_0x19cb67*0x64;console[a22_0x34fe('0x2c')](_0x2c1e49+a22_0x34fe('0x50')+_0x42d92e+'%\x09'+_0x51ed52+'/'+_0x19cb67);}console[a22_0x34fe('0x2c')](_0x2c1e49+'\x20'+_0x56a5f0[a22_0x34fe('0x51')]);switch(_0x56a5f0[a22_0x34fe('0x51')]){case 0xc8:_0x19cb67=_0x56a5f0[a22_0x34fe('0x52')][a22_0x34fe('0x53')]||_0x49cad2;fs['stat'](_0x1d8ab1,function(_0x5462c0,_0x4bc643){if(!_0x5462c0){console[a22_0x34fe('0x2c')](a22_0x34fe('0x54')+_0x1d8ab1);if(_0x4bc643[a22_0x34fe('0x55')]==_0x19cb67){console[a22_0x34fe('0x2c')]('And\x20the\x20file\x20size\x20matches\x20('+_0x19cb67+')');console[a22_0x34fe('0x2c')](a22_0x34fe('0x56'));}else{console[a22_0x34fe('0x2c')](a22_0x34fe('0x57')+_0x4bc643['size']+a22_0x34fe('0x58')+_0x19cb67+')');}}_0x5e3f66=fs[a22_0x34fe('0x59')](_0x1d8ab1);_0x56a5f0[a22_0x34fe('0x5a')](_0x5e3f66);_0x56a5f0['on'](a22_0x34fe('0x5b'),function(_0x1d60e5){_0x51ed52+=_0x1d60e5[a22_0x34fe('0x35')];_0x149589();});_0x2cc50d['on'](a22_0x34fe('0x3d'),function(_0x5462c0){console[a22_0x34fe('0x2c')](a22_0x34fe('0x5c'));console['log'](_0x5462c0);});_0x5e3f66['on']('finish',function(){console[a22_0x34fe('0x2c')]('Downloaded\x20'+_0x2c7ee0+a22_0x34fe('0x47')+_0x2c1e49);_0xb2e85c(null,_0x2c1e49,_0x2cacca,_0x2c1e49);}['bind'](this));});break;case 0x12e:const _0x191ef0=_0x56a5f0['headers'][a22_0x34fe('0x5d')];console[a22_0x34fe('0x2c')](a22_0x34fe('0x5e')+_0x2c7ee0+a22_0x34fe('0x47')+_0x191ef0);if(_0x5ef253<0x5){this['downloadHTTPFile'](_0x191ef0,_0x2c1e49,_0xb2e85c,_0x5ef253++);}else{console[a22_0x34fe('0x3d')](a22_0x34fe('0x5f')+_0x2c7ee0+'.');_0xb2e85c(a22_0x34fe('0x60'),null,null,null);}return;case 0x194:console[a22_0x34fe('0x2c')](a22_0x34fe('0x61')+_0x2c7ee0);default:console[a22_0x34fe('0x2c')](a22_0x34fe('0x62')+_0x2c7ee0+a22_0x34fe('0x63')+_0x56a5f0[a22_0x34fe('0x51')]);_0x2cc50d[a22_0x34fe('0x64')]();_0xb2e85c(_0x56a5f0[a22_0x34fe('0x51')],null,null,null);return;}})['on'](a22_0x34fe('0x3d'),function(_0x4aa98c){console['log'](a22_0x34fe('0x65')+_0x2c7ee0+'\x20'+_0x4aa98c[a22_0x34fe('0x66')]);_0xb2e85c(_0x4aa98c,null,null,null);});}[a22_0x34fe('0x46')](_0xfb75f0,_0x214976,_0x1be64c,_0x284495){console[a22_0x34fe('0x2c')](a22_0x34fe('0x46'));console[a22_0x34fe('0x2c')](_0xfb75f0);console[a22_0x34fe('0x2c')](_0x214976);console['log'](_0x1be64c);console['log'](_0x284495);if(_0x1be64c==a22_0x34fe('0x67')){const _0x3cd479=this[a22_0x34fe('0x14')][this[a22_0x34fe('0x32')]][a22_0x34fe('0x68')]!=null?this[a22_0x34fe('0x14')][this[a22_0x34fe('0x32')]][a22_0x34fe('0x68')]:0x1e;this[a22_0x34fe('0x69')](_0x284495,_0x3cd479);}else if(_0x1be64c==a22_0x34fe('0x6a')){if(_0xfb75f0==null&&_0x214976!=''){this[a22_0x34fe('0x32')]++;}this[a22_0x34fe('0x3e')]();}console[a22_0x34fe('0x2c')](this[a22_0x34fe('0x32')]);}['downloadRequestFile'](_0x43f492,_0x5ee917,_0x20fd3d){progress(request(_0x43f492),{})['on'](a22_0x34fe('0x6b'),function(_0x2c9222){console[a22_0x34fe('0x2c')](_0x2c9222);})['on']('error',function(_0x51443f){console[a22_0x34fe('0x2c')](a22_0x34fe('0x6c'));this[a22_0x34fe('0x3e')]();})['on'](a22_0x34fe('0x6d'),function(){console[a22_0x34fe('0x2c')]('Downloaded:\x20'+_0x5ee917);console[a22_0x34fe('0x2c')]('mediaType:\x20'+_0x20fd3d);if(_0x20fd3d==a22_0x34fe('0x67')){const _0x3f9b99=this['downloadFiles'][this[a22_0x34fe('0x32')]]['duration']!=null?this[a22_0x34fe('0x14')][this[a22_0x34fe('0x32')]][a22_0x34fe('0x68')]:0x1e;this['createImageVideo'](_0x5ee917,_0x3f9b99);}else if(_0x20fd3d==a22_0x34fe('0x6a')){this[a22_0x34fe('0x32')]++;this[a22_0x34fe('0x3e')]();}}[a22_0x34fe('0x37')](this))[a22_0x34fe('0x5a')](fs[a22_0x34fe('0x59')](this[a22_0x34fe('0xd')]+_0x5ee917));}['createImageVideo'](_0x286355,_0x32de2c=0x1e){const _0x4c7efc=this['tempFolder']+_0x286355;console['log'](_0x4c7efc);console[a22_0x34fe('0x2c')](_0x286355);const _0x2b907e=_0x286355[a22_0x34fe('0x6e')]('.')[a22_0x34fe('0x6f')](0x0,-0x1)['join']('.');const _0x36cb51='ffmpeg';const _0x40051d=['-y','-r',a22_0x34fe('0x70'),a22_0x34fe('0x71'),'1',a22_0x34fe('0x72'),a22_0x34fe('0x73'),'-i',_0x4c7efc,'-t',String(_0x32de2c),a22_0x34fe('0x74'),a22_0x34fe('0x75'),a22_0x34fe('0x76'),a22_0x34fe('0x77'),'-r','25','-vf','scale=1920:1080',this[a22_0x34fe('0xd')]+_0x2b907e+'.mp4'];const _0x105768=spawn(_0x36cb51,_0x40051d);_0x105768[a22_0x34fe('0x78')]['on'](a22_0x34fe('0x5b'),function(_0x5e14f1){console[a22_0x34fe('0x2c')]('Converting\x20'+_0x4c7efc);});_0x105768[a22_0x34fe('0x79')]['on'](a22_0x34fe('0x5b'),function(_0x2be2c9){console[a22_0x34fe('0x2c')]('stderr:\x20'+_0x2be2c9);}[a22_0x34fe('0x37')](this));_0x105768['on'](a22_0x34fe('0x7a'),function(){console[a22_0x34fe('0x2c')](a22_0x34fe('0x7b'));this[a22_0x34fe('0x32')]++;this[a22_0x34fe('0x3e')]();}[a22_0x34fe('0x37')](this));}[a22_0x34fe('0x44')](_0x3e6819){const _0x33a5b2=youtubedl('http://www.youtube.com/watch?v='+_0x3e6819,[a22_0x34fe('0x7c')],{'cwd':__dirname});_0x33a5b2['on'](a22_0x34fe('0x7d'),function(_0x11fb37){console[a22_0x34fe('0x2c')](a22_0x34fe('0x7e'));console[a22_0x34fe('0x2c')]('filename:\x20'+_0x11fb37[a22_0x34fe('0x7f')]);console['log'](a22_0x34fe('0x80')+_0x11fb37[a22_0x34fe('0x55')]);});_0x33a5b2['on'](a22_0x34fe('0x81'),function complete(_0x1a6fdc){'use strict';console[a22_0x34fe('0x2c')]('filename:\x20'+_0x1a6fdc[a22_0x34fe('0x7f')]+a22_0x34fe('0x82'));});_0x33a5b2['on'](a22_0x34fe('0x6d'),function(){console[a22_0x34fe('0x2c')](a22_0x34fe('0x83'));this[a22_0x34fe('0x32')]++;this[a22_0x34fe('0x3e')]();}['bind'](this));_0x33a5b2[a22_0x34fe('0x5a')](fs[a22_0x34fe('0x59')](this[a22_0x34fe('0xd')]+'/'+_0x3e6819+a22_0x34fe('0x84')));}[a22_0x34fe('0x3f')](){fs['writeFileSync'](this[a22_0x34fe('0x3a')],JSON[a22_0x34fe('0x27')](this['newPlayList']));let _0x2ae29f=a22_0x34fe('0x85')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x1c4e1a in this[a22_0x34fe('0x14')]){const _0x4ba515=this[a22_0x34fe('0x14')][_0x1c4e1a]['path'];const _0x3204dd=this['downloadFiles'][_0x1c4e1a][a22_0x34fe('0x41')];const _0x4aca65=_0x4ba515['substring'](_0x4ba515[a22_0x34fe('0x86')]('/')+0x1);let _0x33f968=_0x4aca65[a22_0x34fe('0x6e')]('.')[a22_0x34fe('0x6f')](0x0,-0x1)[a22_0x34fe('0x87')]('.');if(_0x3204dd==a22_0x34fe('0x88')){_0x33f968=_0x4ba515;}_0x2ae29f+=a22_0x34fe('0x89')+_0x33f968+a22_0x34fe('0x84')+'\x0d\x0a';}fsExtra[a22_0x34fe('0x31')](this[a22_0x34fe('0x10')]);fsExtra[a22_0x34fe('0x8a')](this[a22_0x34fe('0xd')],this[a22_0x34fe('0x10')]);fs['writeFileSync'](this['m3uFile'],_0x2ae29f);fsExtra['emptyDirSync'](this[a22_0x34fe('0xd')]);console[a22_0x34fe('0x2c')]('Finished');const _0x26c20c=spawn(a22_0x34fe('0x8b'),['-r',a22_0x34fe('0x8c')]);}}exports[a22_0x34fe('0x8d')]=SyncPlaylistsService;