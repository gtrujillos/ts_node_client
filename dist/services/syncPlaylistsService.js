var a21_0x2c94=['progress','percent','Error\x20downloading\x20file','end','Downloaded:\x20','duration','createImageVideo','pipe','createWriteStream','slice','join','-loop','-pattern_type','glob','libx264','-pix_fmt','yuv420p','-vf','scale=1920:1080','.mp4','stdout','data','Converting\x20','stderr','stderr:\x20','close','finished\x20mp4\x20convert','finishProcess','#EXTCPlayListM3U::M3U','path','substring','split','emptyDirSync','Finished','shutdown','now','SyncPlaylistsService','__esModule','fs-extra','request','request-progress','child_process','is-image','string-template','media/','mediaFolder','temp/','filesFolder','playListFile','m3uFile','lulo_playlist.m3u','currentFile','readFileSync','playerId','baseURL','WEB_SERVICE_URL','playListServiceURL','deploy/api/player_playlist.php?player_id={0}','loadMediaList','checkFolders','ensureDir','tempFolder','newPlayList','downloadFiles','log','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','stringify','toString','error','this.currentFile:\x20','lastIndexOf','Downloading:\x20'];(function(_0x1733e3,_0x5aec13){var _0x592c03=function(_0x4fd3be){while(--_0x4fd3be){_0x1733e3['push'](_0x1733e3['shift']());}};_0x592c03(++_0x5aec13);}(a21_0x2c94,0x1ab));var a21_0x3af6=function(_0x4f01e1,_0x245850){_0x4f01e1=_0x4f01e1-0x0;var _0xe879c9=a21_0x2c94[_0x4f01e1];return _0xe879c9;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object['defineProperty'](exports,a21_0x3af6('0x0'),{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x3af6('0x1'));const request=require(a21_0x3af6('0x2'));const progress=require(a21_0x3af6('0x3'));const spawn=require(a21_0x3af6('0x4'))['spawn'];const isImage=require(a21_0x3af6('0x5'));const format=require(a21_0x3af6('0x6'));const os=require('os');class SyncPlaylistsService{constructor(){this['mediaFolder']=a21_0x3af6('0x7');this['tempFolder']=this[a21_0x3af6('0x8')]+a21_0x3af6('0x9');this[a21_0x3af6('0xa')]=this[a21_0x3af6('0x8')]+'files/';this[a21_0x3af6('0xb')]=this[a21_0x3af6('0x8')]+'playlist.txt';this[a21_0x3af6('0xc')]=this[a21_0x3af6('0xa')]+a21_0x3af6('0xd');this[a21_0x3af6('0xe')]=0x0;this['downloadFiles']=[];this['newPlayList']={};}['init'](){const _0x549ddf=JSON['parse'](fs[a21_0x3af6('0xf')]('config.json'));this['playerId']=_0x549ddf[a21_0x3af6('0x10')];this[a21_0x3af6('0x11')]=process['env'][a21_0x3af6('0x12')];this[a21_0x3af6('0x13')]=this['baseURL']+a21_0x3af6('0x14');this['checkFolders']();this[a21_0x3af6('0x15')]();}[a21_0x3af6('0x16')](){fsExtra[a21_0x3af6('0x17')](this['mediaFolder'],_0x40d00f=>{});fsExtra[a21_0x3af6('0x17')](this[a21_0x3af6('0x18')],_0x5ced33=>{});fsExtra[a21_0x3af6('0x17')](this[a21_0x3af6('0xa')],_0x2f2023=>{});}['loadMediaList'](){const _0x36e748=format(this['playListServiceURL'],this[a21_0x3af6('0x10')]);console['log'](_0x36e748);request({'url':_0x36e748,'json':!![]},function(_0x44dae7,_0x4ea122,_0x1312e8){this[a21_0x3af6('0x19')]=_0x1312e8;if(this['hasPlayListChanged']()){this['downloadFiles']=[];this[a21_0x3af6('0xe')]=0x0;for(const _0x157189 in _0x1312e8){this[a21_0x3af6('0x1a')]['push'](_0x1312e8[_0x157189]);}console[a21_0x3af6('0x1b')](a21_0x3af6('0x1c')+this[a21_0x3af6('0x1a')]['length']);if(this[a21_0x3af6('0x1a')][a21_0x3af6('0x1d')]>0x0){this[a21_0x3af6('0x1e')]();}}else{console['log'](a21_0x3af6('0x1f'));}}[a21_0x3af6('0x20')](this));}[a21_0x3af6('0x21')](){fs[a21_0x3af6('0x22')](this[a21_0x3af6('0xb')]);this[a21_0x3af6('0x15')]();}['hasPlayListChanged'](){const _0x5bfc81=JSON[a21_0x3af6('0x23')](this[a21_0x3af6('0x19')]);try{if(!fs['existsSync'](this[a21_0x3af6('0xb')])){return!![];}else{const _0x4f030c=fs['readFileSync'](this[a21_0x3af6('0xb')])[a21_0x3af6('0x24')]();if(_0x4f030c!=_0x5bfc81){return!![];}}}catch(_0x2f4b94){console[a21_0x3af6('0x25')](_0x2f4b94);}return![];}[a21_0x3af6('0x1e')](){console[a21_0x3af6('0x1b')](a21_0x3af6('0x26')+this[a21_0x3af6('0xe')]);if(this[a21_0x3af6('0xe')]>=this['downloadFiles']['length']){this['finishProcess']();return;}const _0xba162c=String(this[a21_0x3af6('0x1a')][this['currentFile']]['path']);const _0x59870a=_0xba162c['substring'](_0xba162c[a21_0x3af6('0x27')]('/')+0x1);console[a21_0x3af6('0x1b')](a21_0x3af6('0x28')+_0x59870a);progress(request(this[a21_0x3af6('0x11')]+_0xba162c),{})['on'](a21_0x3af6('0x29'),function(_0x252ada){console['log'](a21_0x3af6('0x29'),_0x252ada[a21_0x3af6('0x2a')]);})['on']('error',function(_0x4f63de){console[a21_0x3af6('0x1b')](a21_0x3af6('0x2b'));this['download']();})['on'](a21_0x3af6('0x2c'),function(){console[a21_0x3af6('0x1b')](a21_0x3af6('0x2d')+_0x59870a);if(isImage(_0x59870a)){const _0xfe788b=this['downloadFiles'][this['currentFile']][a21_0x3af6('0x2e')]!=null?this[a21_0x3af6('0x1a')][this[a21_0x3af6('0xe')]][a21_0x3af6('0x2e')]:0x1e;this[a21_0x3af6('0x2f')](_0x59870a,_0xfe788b);}else{this[a21_0x3af6('0xe')]++;this[a21_0x3af6('0x1e')]();}}[a21_0x3af6('0x20')](this))[a21_0x3af6('0x30')](fs[a21_0x3af6('0x31')](this['tempFolder']+_0x59870a));}[a21_0x3af6('0x2f')](_0x3335c3,_0x24955d=0x1e){const _0x229672=this[a21_0x3af6('0x18')]+_0x3335c3;const _0x2cc10f=_0x3335c3['split']('.')[a21_0x3af6('0x32')](0x0,-0x1)[a21_0x3af6('0x33')]('.');const _0x33cbdb='ffmpeg';const _0xfa4359=['-y','-r','1/2',a21_0x3af6('0x34'),'1',a21_0x3af6('0x35'),a21_0x3af6('0x36'),'-i',_0x229672,'-t',String(_0x24955d),'-c:v',a21_0x3af6('0x37'),a21_0x3af6('0x38'),a21_0x3af6('0x39'),'-r','25',a21_0x3af6('0x3a'),a21_0x3af6('0x3b'),this[a21_0x3af6('0x18')]+_0x2cc10f+a21_0x3af6('0x3c')];const _0x57e9ed=spawn(_0x33cbdb,_0xfa4359);_0x57e9ed[a21_0x3af6('0x3d')]['on'](a21_0x3af6('0x3e'),function(_0x1ae2e9){console[a21_0x3af6('0x1b')](a21_0x3af6('0x3f')+_0x229672);});_0x57e9ed[a21_0x3af6('0x40')]['on']('data',function(_0x41e0fe){console[a21_0x3af6('0x1b')](a21_0x3af6('0x41')+_0x41e0fe);}['bind'](this));_0x57e9ed['on'](a21_0x3af6('0x42'),function(){console[a21_0x3af6('0x1b')](a21_0x3af6('0x43'));this[a21_0x3af6('0xe')]++;this['download']();}[a21_0x3af6('0x20')](this));}[a21_0x3af6('0x44')](){fs['writeFileSync'](this[a21_0x3af6('0xb')],JSON[a21_0x3af6('0x23')](this['newPlayList']));let _0x1d05df=a21_0x3af6('0x45')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x398d89 in this[a21_0x3af6('0x1a')]){const _0x163820=this[a21_0x3af6('0x1a')][_0x398d89][a21_0x3af6('0x46')];const _0x3b3019=_0x163820[a21_0x3af6('0x47')](_0x163820[a21_0x3af6('0x27')]('/')+0x1);const _0x5f3f70=_0x3b3019[a21_0x3af6('0x48')]('.')[a21_0x3af6('0x32')](0x0,-0x1)[a21_0x3af6('0x33')]('.');_0x1d05df+='/home/osmc/luloclient/media/files/'+_0x5f3f70+a21_0x3af6('0x3c')+'\x0d\x0a';}fsExtra[a21_0x3af6('0x49')](this[a21_0x3af6('0xa')]);fsExtra['copySync'](this[a21_0x3af6('0x18')],this['filesFolder']);fs['writeFileSync'](this['m3uFile'],_0x1d05df);fsExtra[a21_0x3af6('0x49')](this[a21_0x3af6('0x18')]);console[a21_0x3af6('0x1b')](a21_0x3af6('0x4a'));const _0x577793=spawn(a21_0x3af6('0x4b'),['-r',a21_0x3af6('0x4c')]);}}exports[a21_0x3af6('0x4d')]=SyncPlaylistsService;