var a22_0x2dd3=['Downloading:\x20','downloadYouTube','downloadHTTPFileCallback','downloadHTTPFile','Attempting\x20to\x20download\x20','\x20to\x20','Max\x20redirects\x20reached','WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20','get','\x20Progress:\x20unknown\x09','statusCode','headers','content-length','stat','size','And\x20the\x20file\x20size\x20matches\x20(','Redownloading','pipe','finish','bind','Redirect\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','abort','Error\x20Downloading:\x20','message','image','duration','video','downloadRequestFile','progress','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','createImageVideo','createWriteStream','split','slice','join','1/2','-loop','-pattern_type','glob','-c:v','libx264','-pix_fmt','.mp4','stdout','stderr','data','stderr:\x20','http://www.youtube.com/watch?v=','--format=18','Download\x20started','filename:\x20','_filename','size:\x20','complete','finished\x20youtube\x20downloading!','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','substring','youtube_single','/home/osmc/luloclient/media/files/','copySync','Finished','now','SyncPlaylistsService','defineProperty','__esModule','../infrastructure/HttpClientService','http','fs-extra','request','child_process','spawn','is-image','youtube-dl','uuid/v4','config.json','context.json','media/','files/','playListFile','mediaFolder','playlist.txt','m3uFile','filesFolder','currentFile','downloadFiles','newPlayList','httpClientService','HttpClientService','init','config','parse','readFileSync','context','playerId','baseURL','env','WEB_SERVICE_URL','deploy/','api/player_playlist.php?player_id={0}','registerClient','checkFolders','loadMediaList','deviceUuid','stringify','http://restapi.lulo.run/player_devices/register','then','log','parsedBody','catch','ensureDir','playListServiceURL','hasPlayListChanged','emptyDirSync','tempFolder','Total:\x20','length','download','No\x20playlist\x20changes','reloadMediaList','existsSync','toString','error','this.currentFile:\x20','finishProcess','path','media_type','lastIndexOf'];(function(_0x19fe28,_0x2496b3){var _0x5bc879=function(_0x4fcfb1){while(--_0x4fcfb1){_0x19fe28['push'](_0x19fe28['shift']());}};_0x5bc879(++_0x2496b3);}(a22_0x2dd3,0x1e0));var a22_0x4af8=function(_0x360471,_0x1b6f48){_0x360471=_0x360471-0x0;var _0xff2d3c=a22_0x2dd3[_0x360471];return _0xff2d3c;};'use strict';Object[a22_0x4af8('0x0')](exports,a22_0x4af8('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0x4af8('0x2'));const fs=require('fs');const http=require(a22_0x4af8('0x3'));const fsExtra=require(a22_0x4af8('0x4'));const request=require(a22_0x4af8('0x5'));const progress=require('request-progress');const spawn=require(a22_0x4af8('0x6'))[a22_0x4af8('0x7')];const isImage=require(a22_0x4af8('0x8'));const format=require('string-template');const os=require('os');const youtubedl=require(a22_0x4af8('0x9'));const uuidv4=require(a22_0x4af8('0xa'));const configFile=a22_0x4af8('0xb');const contextFile=a22_0x4af8('0xc');class SyncPlaylistsService{constructor(){this['mediaFolder']=a22_0x4af8('0xd');this['tempFolder']=this['mediaFolder']+'temp/';this['filesFolder']=this['mediaFolder']+a22_0x4af8('0xe');this[a22_0x4af8('0xf')]=this[a22_0x4af8('0x10')]+a22_0x4af8('0x11');this[a22_0x4af8('0x12')]=this[a22_0x4af8('0x13')]+'lulo_playlist.m3u';this[a22_0x4af8('0x14')]=0x0;this[a22_0x4af8('0x15')]=[];this[a22_0x4af8('0x16')]={};this[a22_0x4af8('0x17')]=new HttpClientService_1[(a22_0x4af8('0x18'))]();}[a22_0x4af8('0x19')](){this[a22_0x4af8('0x1a')]=JSON[a22_0x4af8('0x1b')](fs[a22_0x4af8('0x1c')](configFile));this[a22_0x4af8('0x1d')]=JSON[a22_0x4af8('0x1b')](fs['readFileSync'](contextFile));this[a22_0x4af8('0x1e')]=this[a22_0x4af8('0x1a')][a22_0x4af8('0x1e')];this[a22_0x4af8('0x1f')]=process[a22_0x4af8('0x20')][a22_0x4af8('0x21')]+a22_0x4af8('0x22');this['playListServiceURL']=this[a22_0x4af8('0x1f')]+a22_0x4af8('0x23');this[a22_0x4af8('0x24')]();this[a22_0x4af8('0x25')]();this[a22_0x4af8('0x26')]();}[a22_0x4af8('0x24')](){const _0x2f9fa9=this[a22_0x4af8('0x1a')][a22_0x4af8('0x27')];if(!_0x2f9fa9||_0x2f9fa9==''){this[a22_0x4af8('0x1a')][a22_0x4af8('0x27')]=uuidv4();this[a22_0x4af8('0x1a')]={'deviceUuid':this[a22_0x4af8('0x1a')][a22_0x4af8('0x27')],'playerId':this[a22_0x4af8('0x1a')][a22_0x4af8('0x1e')]};fs['writeFileSync'](configFile,JSON[a22_0x4af8('0x28')](this[a22_0x4af8('0x1a')]));}const _0x61f497={'player_id':this['playerId'],'device_uuid':this['config'][a22_0x4af8('0x27')],'network_info':JSON[a22_0x4af8('0x28')](os['networkInterfaces']()),'firmware_info':JSON['stringify'](this[a22_0x4af8('0x1d')]),'status':0x1};this['httpClientService']['post'](a22_0x4af8('0x29'),_0x61f497,![])[a22_0x4af8('0x2a')](function(_0xc2bfd9){console[a22_0x4af8('0x2b')](a22_0x4af8('0x2c'));console[a22_0x4af8('0x2b')](_0xc2bfd9);})[a22_0x4af8('0x2d')](function(_0x3562c5){});}[a22_0x4af8('0x25')](){fsExtra[a22_0x4af8('0x2e')](this[a22_0x4af8('0x10')],_0x2c54a1=>{});fsExtra[a22_0x4af8('0x2e')](this['tempFolder'],_0x250931=>{});fsExtra['ensureDir'](this[a22_0x4af8('0x13')],_0x4db924=>{});}[a22_0x4af8('0x26')](){const _0x28d565=format(this[a22_0x4af8('0x2f')],this['playerId']);console[a22_0x4af8('0x2b')](_0x28d565);request({'url':_0x28d565,'json':!![]},function(_0x5f1b7e,_0x2e3ab6,_0x16e3ac){console[a22_0x4af8('0x2b')](_0x16e3ac);this[a22_0x4af8('0x16')]=_0x16e3ac;if(this[a22_0x4af8('0x30')]()){fsExtra[a22_0x4af8('0x31')](this[a22_0x4af8('0x32')]);this[a22_0x4af8('0x15')]=[];this[a22_0x4af8('0x14')]=0x0;for(const _0xd3f419 in _0x16e3ac){this['downloadFiles']['push'](_0x16e3ac[_0xd3f419]);}console[a22_0x4af8('0x2b')](a22_0x4af8('0x33')+this[a22_0x4af8('0x15')][a22_0x4af8('0x34')]);if(this[a22_0x4af8('0x15')][a22_0x4af8('0x34')]>0x0){this[a22_0x4af8('0x35')]();}}else{console[a22_0x4af8('0x2b')](a22_0x4af8('0x36'));}}['bind'](this));}[a22_0x4af8('0x37')](){if(fsExtra[a22_0x4af8('0x38')](this[a22_0x4af8('0xf')])){fsExtra['removeSync'](this[a22_0x4af8('0xf')]);}this[a22_0x4af8('0x26')]();}[a22_0x4af8('0x30')](){const _0x161bd0=JSON[a22_0x4af8('0x28')](this[a22_0x4af8('0x16')]);try{if(!fs[a22_0x4af8('0x38')](this[a22_0x4af8('0xf')])){return!![];}else{const _0x25b7f5=fs['readFileSync'](this['playListFile'])[a22_0x4af8('0x39')]();if(_0x25b7f5!=_0x161bd0){return!![];}}}catch(_0x3d0685){console[a22_0x4af8('0x3a')](_0x3d0685);}return![];}[a22_0x4af8('0x35')](){console['log'](a22_0x4af8('0x3b')+this['currentFile']);if(this[a22_0x4af8('0x14')]>=this['downloadFiles']['length']){this[a22_0x4af8('0x3c')]();return;}const _0x55e785=String(this[a22_0x4af8('0x15')][this[a22_0x4af8('0x14')]][a22_0x4af8('0x3d')]);const _0xf9e771=this[a22_0x4af8('0x15')][this[a22_0x4af8('0x14')]][a22_0x4af8('0x3e')];const _0x560105=_0x55e785['substring'](_0x55e785[a22_0x4af8('0x3f')]('/')+0x1);const _0x595739=this[a22_0x4af8('0x1f')]+_0x55e785;console[a22_0x4af8('0x2b')](a22_0x4af8('0x40')+_0x595739);if(_0xf9e771=='youtube_single'){this[a22_0x4af8('0x41')](_0x55e785);}else{this['downloadHTTPFile'](_0x595739,_0x560105,_0xf9e771,this[a22_0x4af8('0x42')]['bind'](this));}}[a22_0x4af8('0x43')](_0xe148d,_0x3b43fc,_0x50442b,_0x464d7d){console[a22_0x4af8('0x2b')](a22_0x4af8('0x43'));console['log'](_0xe148d);const _0x1b0299=!![];let _0x2c0acd=0x0;const _0x3610c2='';console['log'](a22_0x4af8('0x44')+_0xe148d+a22_0x4af8('0x45')+_0x3b43fc);if(_0x2c0acd){if(_0x2c0acd>0x5){_0x464d7d(a22_0x4af8('0x46'),_0xe148d,_0x50442b,null);return;}}else{_0x2c0acd=0x0;}const _0x2b553f=this[a22_0x4af8('0x32')]+_0x3b43fc;let _0x1386f4;if(_0x464d7d===undefined){console[a22_0x4af8('0x2b')](a22_0x4af8('0x47')+_0xe148d+a22_0x4af8('0x45')+_0x2b553f);_0x464d7d=function(_0x31e16c,_0x17145b){console[a22_0x4af8('0x2b')]('downloadFile\x20callback\x20result\x20undefined:\x20',_0x31e16c,_0x17145b);};}const _0x2e7d39=http[a22_0x4af8('0x48')](_0xe148d,function(_0x4c101a){let _0x223462=0x0;let _0x15f22f=0x0;function _0x3766bd(){if(_0x223462===undefined){console[a22_0x4af8('0x2b')](_0x3b43fc+a22_0x4af8('0x49')+_0x15f22f+'/'+'?');}const _0x8eea95=_0x15f22f/_0x223462*0x64;console[a22_0x4af8('0x2b')](_0x3b43fc+'\x20Progress:\x20'+_0x8eea95+'%\x09'+_0x15f22f+'/'+_0x223462);}console[a22_0x4af8('0x2b')](_0x3b43fc+'\x20'+_0x4c101a[a22_0x4af8('0x4a')]);switch(_0x4c101a['statusCode']){case 0xc8:_0x223462=_0x4c101a[a22_0x4af8('0x4b')][a22_0x4af8('0x4c')]||_0x3610c2;fs[a22_0x4af8('0x4d')](_0x2b553f,function(_0x20b728,_0x58d465){if(!_0x20b728){console['log']('Have\x20already\x20downloaded\x20'+_0x2b553f);if(_0x58d465[a22_0x4af8('0x4e')]==_0x223462){console[a22_0x4af8('0x2b')](a22_0x4af8('0x4f')+_0x223462+')');console[a22_0x4af8('0x2b')](a22_0x4af8('0x50'));}else{console[a22_0x4af8('0x2b')]('But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old('+_0x58d465[a22_0x4af8('0x4e')]+')\x20vs\x20New('+_0x223462+')');}}_0x1386f4=fs['createWriteStream'](_0x2b553f);_0x4c101a[a22_0x4af8('0x51')](_0x1386f4);_0x4c101a['on']('data',function(_0x56f51a){_0x15f22f+=_0x56f51a[a22_0x4af8('0x34')];_0x3766bd();});_0x1386f4['on'](a22_0x4af8('0x52'),function(){console[a22_0x4af8('0x2b')]('Downloaded\x20'+_0xe148d+a22_0x4af8('0x45')+_0x3b43fc);_0x464d7d(null,_0x3b43fc,_0x50442b,_0x3b43fc);}[a22_0x4af8('0x53')](this));});break;case 0x12e:const _0x51187f=_0x4c101a['headers']['location'];console[a22_0x4af8('0x2b')](a22_0x4af8('0x54')+_0xe148d+a22_0x4af8('0x45')+_0x51187f);if(_0x2c0acd<0x5){this[a22_0x4af8('0x43')](_0x51187f,_0x3b43fc,_0x464d7d,_0x2c0acd++);}else{console[a22_0x4af8('0x3a')]('Redirect\x20limit\x20encountered\x20for\x20'+_0xe148d+'.');_0x464d7d(a22_0x4af8('0x55'),null,null,null);}return;case 0x194:console[a22_0x4af8('0x2b')](a22_0x4af8('0x56')+_0xe148d);default:console[a22_0x4af8('0x2b')](a22_0x4af8('0x57')+_0xe148d+a22_0x4af8('0x58')+_0x4c101a['statusCode']);_0x2e7d39[a22_0x4af8('0x59')]();_0x464d7d(_0x4c101a[a22_0x4af8('0x4a')],null,null,null);return;}})['on']('error',function(_0x1a0588){console[a22_0x4af8('0x2b')](a22_0x4af8('0x5a')+_0xe148d+'\x20'+_0x1a0588[a22_0x4af8('0x5b')]);_0x464d7d(_0x1a0588,null,null,null);});}[a22_0x4af8('0x42')](_0xa73f88,_0x2c52d6,_0x3465aa,_0x58bec1){console[a22_0x4af8('0x2b')](a22_0x4af8('0x42'));console[a22_0x4af8('0x2b')](_0xa73f88);console['log'](_0x2c52d6);console[a22_0x4af8('0x2b')](_0x3465aa);console[a22_0x4af8('0x2b')](_0x58bec1);if(_0x3465aa==a22_0x4af8('0x5c')){const _0x37fe1f=this[a22_0x4af8('0x15')][this[a22_0x4af8('0x14')]][a22_0x4af8('0x5d')]!=null?this[a22_0x4af8('0x15')][this[a22_0x4af8('0x14')]][a22_0x4af8('0x5d')]:0x1e;this['createImageVideo'](_0x58bec1,_0x37fe1f);}else if(_0x3465aa==a22_0x4af8('0x5e')){if(_0xa73f88==null&&_0x2c52d6!=''){this[a22_0x4af8('0x14')]++;}this[a22_0x4af8('0x35')]();}console[a22_0x4af8('0x2b')](this[a22_0x4af8('0x14')]);}[a22_0x4af8('0x5f')](_0x23459d,_0x46952c,_0x541a30){progress(request(_0x23459d),{})['on'](a22_0x4af8('0x60'),function(_0xd7faf4){console['log'](_0xd7faf4);})['on'](a22_0x4af8('0x3a'),function(_0x11c7be){console[a22_0x4af8('0x2b')](a22_0x4af8('0x61'));this[a22_0x4af8('0x35')]();})['on'](a22_0x4af8('0x62'),function(){console['log'](a22_0x4af8('0x63')+_0x46952c);console[a22_0x4af8('0x2b')](a22_0x4af8('0x64')+_0x541a30);if(_0x541a30==a22_0x4af8('0x5c')){const _0x291b62=this[a22_0x4af8('0x15')][this[a22_0x4af8('0x14')]][a22_0x4af8('0x5d')]!=null?this[a22_0x4af8('0x15')][this['currentFile']][a22_0x4af8('0x5d')]:0x1e;this[a22_0x4af8('0x65')](_0x46952c,_0x291b62);}else if(_0x541a30==a22_0x4af8('0x5e')){this[a22_0x4af8('0x14')]++;this[a22_0x4af8('0x35')]();}}[a22_0x4af8('0x53')](this))['pipe'](fs[a22_0x4af8('0x66')](this[a22_0x4af8('0x32')]+_0x46952c));}['createImageVideo'](_0x193394,_0x1e77b6=0x1e){const _0x580d9f=this[a22_0x4af8('0x32')]+_0x193394;console[a22_0x4af8('0x2b')](_0x580d9f);console[a22_0x4af8('0x2b')](_0x193394);const _0x5f310e=_0x193394[a22_0x4af8('0x67')]('.')[a22_0x4af8('0x68')](0x0,-0x1)[a22_0x4af8('0x69')]('.');const _0x14c82a='ffmpeg';const _0x934b2f=['-y','-r',a22_0x4af8('0x6a'),a22_0x4af8('0x6b'),'1',a22_0x4af8('0x6c'),a22_0x4af8('0x6d'),'-i',_0x580d9f,'-t',String(_0x1e77b6),a22_0x4af8('0x6e'),a22_0x4af8('0x6f'),a22_0x4af8('0x70'),'yuv420p','-r','25','-vf','scale=1920:1080',this[a22_0x4af8('0x32')]+_0x5f310e+a22_0x4af8('0x71')];const _0x1bcef6=spawn(_0x14c82a,_0x934b2f);_0x1bcef6[a22_0x4af8('0x72')]['on']('data',function(_0x28e9da){console[a22_0x4af8('0x2b')]('Converting\x20'+_0x580d9f);});_0x1bcef6[a22_0x4af8('0x73')]['on'](a22_0x4af8('0x74'),function(_0x42150e){console[a22_0x4af8('0x2b')](a22_0x4af8('0x75')+_0x42150e);}['bind'](this));_0x1bcef6['on']('close',function(){console[a22_0x4af8('0x2b')]('finished\x20mp4\x20convert');this[a22_0x4af8('0x14')]++;this[a22_0x4af8('0x35')]();}[a22_0x4af8('0x53')](this));}[a22_0x4af8('0x41')](_0x5ceaf9){const _0x4283c7=youtubedl(a22_0x4af8('0x76')+_0x5ceaf9,[a22_0x4af8('0x77')],{'cwd':__dirname});_0x4283c7['on']('info',function(_0x57b272){console[a22_0x4af8('0x2b')](a22_0x4af8('0x78'));console[a22_0x4af8('0x2b')](a22_0x4af8('0x79')+_0x57b272[a22_0x4af8('0x7a')]);console[a22_0x4af8('0x2b')](a22_0x4af8('0x7b')+_0x57b272[a22_0x4af8('0x4e')]);});_0x4283c7['on'](a22_0x4af8('0x7c'),function complete(_0x20d4c7){'use strict';console[a22_0x4af8('0x2b')]('filename:\x20'+_0x20d4c7[a22_0x4af8('0x7a')]+'\x20already\x20downloaded.');});_0x4283c7['on'](a22_0x4af8('0x62'),function(){console[a22_0x4af8('0x2b')](a22_0x4af8('0x7d'));this[a22_0x4af8('0x14')]++;this[a22_0x4af8('0x35')]();}['bind'](this));_0x4283c7[a22_0x4af8('0x51')](fs[a22_0x4af8('0x66')](this[a22_0x4af8('0x32')]+'/'+_0x5ceaf9+a22_0x4af8('0x71')));}[a22_0x4af8('0x3c')](){fs[a22_0x4af8('0x7e')](this[a22_0x4af8('0xf')],JSON[a22_0x4af8('0x28')](this[a22_0x4af8('0x16')]));let _0x2bdd9f=a22_0x4af8('0x7f')+'\x0d\x0a'+a22_0x4af8('0x80')+'\x0d\x0a';for(const _0x578b5f in this[a22_0x4af8('0x15')]){const _0x259a37=this[a22_0x4af8('0x15')][_0x578b5f][a22_0x4af8('0x3d')];const _0x4bd405=this[a22_0x4af8('0x15')][_0x578b5f][a22_0x4af8('0x3e')];const _0x4b527b=_0x259a37[a22_0x4af8('0x81')](_0x259a37['lastIndexOf']('/')+0x1);let _0x174bd6=_0x4b527b[a22_0x4af8('0x67')]('.')[a22_0x4af8('0x68')](0x0,-0x1)[a22_0x4af8('0x69')]('.');if(_0x4bd405==a22_0x4af8('0x82')){_0x174bd6=_0x259a37;}_0x2bdd9f+=a22_0x4af8('0x83')+_0x174bd6+a22_0x4af8('0x71')+'\x0d\x0a';}fsExtra['emptyDirSync'](this['filesFolder']);fsExtra[a22_0x4af8('0x84')](this[a22_0x4af8('0x32')],this[a22_0x4af8('0x13')]);fs['writeFileSync'](this[a22_0x4af8('0x12')],_0x2bdd9f);fsExtra['emptyDirSync'](this[a22_0x4af8('0x32')]);console[a22_0x4af8('0x2b')](a22_0x4af8('0x85'));const _0x195ef1=spawn('shutdown',['-r',a22_0x4af8('0x86')]);}}exports[a22_0x4af8('0x87')]=SyncPlaylistsService;