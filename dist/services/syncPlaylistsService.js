var a22_0x4c06=['-c:v','libx264','-pix_fmt','yuv420p','-vf','scale=1920:1080','.mp4','stdout','data','Converting\x20','stderr','close','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','info','Download\x20started','_filename','size:\x20','size','complete','filename:\x20','finished\x20youtube\x20downloading!','pipe','createWriteStream','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','path','split','/home/osmc/luloclient/media/files/','emptyDirSync','copySync','Finished','shutdown','now','defineProperty','__esModule','../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','string-template','youtube-dl','uuid/v4','mediaFolder','tempFolder','temp/','filesFolder','files/','playListFile','playlist.txt','m3uFile','lulo_playlist.m3u','currentFile','downloadFiles','init','parse','readFileSync','config','playerId','WEB_SERVICE_URL','deploy/','playListServiceURL','baseURL','registerClient','loadMediaList','deviceUuid','stringify','networkInterfaces','post','http://restapi.lulo.run/player_devices/register','then','parsedBody','log','catch','checkFolders','ensureDir','newPlayList','push','Total:\x20','length','download','No\x20playlist\x20changes','unlinkSync','hasPlayListChanged','toString','error','this.currentFile:\x20','finishProcess','media_type','substring','lastIndexOf','Downloading:\x20','youtube_single','downloadYouTube','progress','percent','Error\x20downloading\x20file','end','Downloaded:\x20','duration','createImageVideo','bind','slice','join','1/2','-loop','-pattern_type','glob'];(function(_0x562a71,_0x53aa3a){var _0x5a3e02=function(_0x430522){while(--_0x430522){_0x562a71['push'](_0x562a71['shift']());}};_0x5a3e02(++_0x53aa3a);}(a22_0x4c06,0x91));var a22_0x56c7=function(_0x208080,_0x406010){_0x208080=_0x208080-0x0;var _0x5e4209=a22_0x4c06[_0x208080];return _0x5e4209;};'use strict';Object[a22_0x56c7('0x0')](exports,a22_0x56c7('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0x56c7('0x2'));const fs=require('fs');const fsExtra=require(a22_0x56c7('0x3'));const request=require(a22_0x56c7('0x4'));const progress=require('request-progress');const spawn=require(a22_0x56c7('0x5'))[a22_0x56c7('0x6')];const isImage=require('is-image');const format=require(a22_0x56c7('0x7'));const os=require('os');const youtubedl=require(a22_0x56c7('0x8'));const uuidv4=require(a22_0x56c7('0x9'));const configFile='config.json';class SyncPlaylistsService{constructor(){this[a22_0x56c7('0xa')]='media/';this[a22_0x56c7('0xb')]=this[a22_0x56c7('0xa')]+a22_0x56c7('0xc');this[a22_0x56c7('0xd')]=this['mediaFolder']+a22_0x56c7('0xe');this[a22_0x56c7('0xf')]=this[a22_0x56c7('0xa')]+a22_0x56c7('0x10');this[a22_0x56c7('0x11')]=this['filesFolder']+a22_0x56c7('0x12');this[a22_0x56c7('0x13')]=0x0;this[a22_0x56c7('0x14')]=[];this['newPlayList']={};this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a22_0x56c7('0x15')](){this['config']=JSON[a22_0x56c7('0x16')](fs[a22_0x56c7('0x17')](configFile));this['playerId']=this[a22_0x56c7('0x18')][a22_0x56c7('0x19')];this['baseURL']=process['env'][a22_0x56c7('0x1a')]+a22_0x56c7('0x1b');this[a22_0x56c7('0x1c')]=this[a22_0x56c7('0x1d')]+'api/player_playlist.php?player_id={0}';this[a22_0x56c7('0x1e')]();this['checkFolders']();this[a22_0x56c7('0x1f')]();}['registerClient'](){const _0x571e36=this[a22_0x56c7('0x18')][a22_0x56c7('0x20')];if(!_0x571e36||_0x571e36==''){this[a22_0x56c7('0x18')][a22_0x56c7('0x20')]=uuidv4();this[a22_0x56c7('0x18')]={'deviceUuid':this[a22_0x56c7('0x18')]['deviceUuid'],'playerId':this[a22_0x56c7('0x18')][a22_0x56c7('0x19')]};fs['writeFileSync'](configFile,JSON[a22_0x56c7('0x21')](this[a22_0x56c7('0x18')]));}const _0x5e3b0d={'player_id':this['playerId'],'device_uuid':this[a22_0x56c7('0x18')]['deviceUuid'],'network_info':JSON[a22_0x56c7('0x21')](os[a22_0x56c7('0x22')]()),'status':0x1};this['httpClientService'][a22_0x56c7('0x23')](a22_0x56c7('0x24'),_0x5e3b0d,![])[a22_0x56c7('0x25')](function(_0x4de685){console['log'](a22_0x56c7('0x26'));console[a22_0x56c7('0x27')](_0x4de685);})[a22_0x56c7('0x28')](function(_0x3d3384){});}[a22_0x56c7('0x29')](){fsExtra['ensureDir'](this[a22_0x56c7('0xa')],_0x6cd267=>{});fsExtra[a22_0x56c7('0x2a')](this[a22_0x56c7('0xb')],_0x18882f=>{});fsExtra[a22_0x56c7('0x2a')](this[a22_0x56c7('0xd')],_0x287348=>{});}[a22_0x56c7('0x1f')](){const _0x4198a4=format(this['playListServiceURL'],this[a22_0x56c7('0x19')]);console[a22_0x56c7('0x27')](_0x4198a4);request({'url':_0x4198a4,'json':!![]},function(_0x19a139,_0x24d6a9,_0x13cd41){console['log'](_0x13cd41);this[a22_0x56c7('0x2b')]=_0x13cd41;if(this['hasPlayListChanged']()){this['downloadFiles']=[];this[a22_0x56c7('0x13')]=0x0;for(const _0x422989 in _0x13cd41){this[a22_0x56c7('0x14')][a22_0x56c7('0x2c')](_0x13cd41[_0x422989]);}console[a22_0x56c7('0x27')](a22_0x56c7('0x2d')+this['downloadFiles'][a22_0x56c7('0x2e')]);if(this[a22_0x56c7('0x14')]['length']>0x0){this[a22_0x56c7('0x2f')]();}}else{console[a22_0x56c7('0x27')](a22_0x56c7('0x30'));}}['bind'](this));}['reloadMediaList'](){fs[a22_0x56c7('0x31')](this[a22_0x56c7('0xf')]);this[a22_0x56c7('0x1f')]();}[a22_0x56c7('0x32')](){const _0x3cd957=JSON[a22_0x56c7('0x21')](this[a22_0x56c7('0x2b')]);try{if(!fs['existsSync'](this[a22_0x56c7('0xf')])){return!![];}else{const _0x4c341f=fs['readFileSync'](this['playListFile'])[a22_0x56c7('0x33')]();if(_0x4c341f!=_0x3cd957){return!![];}}}catch(_0x4914f0){console[a22_0x56c7('0x34')](_0x4914f0);}return![];}[a22_0x56c7('0x2f')](){console['log'](a22_0x56c7('0x35')+this[a22_0x56c7('0x13')]);if(this[a22_0x56c7('0x13')]>=this[a22_0x56c7('0x14')][a22_0x56c7('0x2e')]){this[a22_0x56c7('0x36')]();return;}const _0x5c9bee=String(this['downloadFiles'][this[a22_0x56c7('0x13')]]['path']);const _0x2c18a0=this[a22_0x56c7('0x14')][this[a22_0x56c7('0x13')]][a22_0x56c7('0x37')];const _0x24f32c=_0x5c9bee[a22_0x56c7('0x38')](_0x5c9bee[a22_0x56c7('0x39')]('/')+0x1);const _0x3e9d41=this['baseURL']+_0x5c9bee;console[a22_0x56c7('0x27')](a22_0x56c7('0x3a')+_0x3e9d41);if(_0x2c18a0==a22_0x56c7('0x3b')){this[a22_0x56c7('0x3c')](_0x5c9bee);}else{progress(request(_0x3e9d41),{})['on'](a22_0x56c7('0x3d'),function(_0xca6712){console[a22_0x56c7('0x27')]('progress',_0xca6712[a22_0x56c7('0x3e')]);})['on'](a22_0x56c7('0x34'),function(_0x57e809){console[a22_0x56c7('0x27')](a22_0x56c7('0x3f'));this[a22_0x56c7('0x2f')]();})['on'](a22_0x56c7('0x40'),function(){console[a22_0x56c7('0x27')](a22_0x56c7('0x41')+_0x24f32c);console['log']('mediaType:\x20'+_0x2c18a0);if(_0x2c18a0=='image'){const _0x4a3d6e=this['downloadFiles'][this[a22_0x56c7('0x13')]][a22_0x56c7('0x42')]!=null?this['downloadFiles'][this[a22_0x56c7('0x13')]][a22_0x56c7('0x42')]:0x1e;this[a22_0x56c7('0x43')](_0x24f32c,_0x4a3d6e);}else if(_0x2c18a0=='video'){this[a22_0x56c7('0x13')]++;this[a22_0x56c7('0x2f')]();}}[a22_0x56c7('0x44')](this))['pipe'](fs['createWriteStream'](this[a22_0x56c7('0xb')]+_0x24f32c));}}['createImageVideo'](_0xa7656a,_0x3bf067=0x1e){const _0x3de64c=this[a22_0x56c7('0xb')]+_0xa7656a;const _0x263eb2=_0xa7656a['split']('.')[a22_0x56c7('0x45')](0x0,-0x1)[a22_0x56c7('0x46')]('.');const _0x487029='ffmpeg';const _0x2b54e8=['-y','-r',a22_0x56c7('0x47'),a22_0x56c7('0x48'),'1',a22_0x56c7('0x49'),a22_0x56c7('0x4a'),'-i',_0x3de64c,'-t',String(_0x3bf067),a22_0x56c7('0x4b'),a22_0x56c7('0x4c'),a22_0x56c7('0x4d'),a22_0x56c7('0x4e'),'-r','25',a22_0x56c7('0x4f'),a22_0x56c7('0x50'),this['tempFolder']+_0x263eb2+a22_0x56c7('0x51')];const _0x5a511b=spawn(_0x487029,_0x2b54e8);_0x5a511b[a22_0x56c7('0x52')]['on'](a22_0x56c7('0x53'),function(_0xa2f7b5){console[a22_0x56c7('0x27')](a22_0x56c7('0x54')+_0x3de64c);});_0x5a511b[a22_0x56c7('0x55')]['on'](a22_0x56c7('0x53'),function(_0x2c3679){console[a22_0x56c7('0x27')]('stderr:\x20'+_0x2c3679);}[a22_0x56c7('0x44')](this));_0x5a511b['on'](a22_0x56c7('0x56'),function(){console[a22_0x56c7('0x27')](a22_0x56c7('0x57'));this[a22_0x56c7('0x13')]++;this[a22_0x56c7('0x2f')]();}[a22_0x56c7('0x44')](this));}[a22_0x56c7('0x3c')](_0x4a2138){const _0x48ad05=youtubedl(a22_0x56c7('0x58')+_0x4a2138,['--format=18'],{'cwd':__dirname});_0x48ad05['on'](a22_0x56c7('0x59'),function(_0x45a2d4){console['log'](a22_0x56c7('0x5a'));console[a22_0x56c7('0x27')]('filename:\x20'+_0x45a2d4[a22_0x56c7('0x5b')]);console[a22_0x56c7('0x27')](a22_0x56c7('0x5c')+_0x45a2d4[a22_0x56c7('0x5d')]);});_0x48ad05['on'](a22_0x56c7('0x5e'),function complete(_0x366a85){'use strict';console['log'](a22_0x56c7('0x5f')+_0x366a85[a22_0x56c7('0x5b')]+'\x20already\x20downloaded.');});_0x48ad05['on'](a22_0x56c7('0x40'),function(){console['log'](a22_0x56c7('0x60'));this[a22_0x56c7('0x13')]++;this[a22_0x56c7('0x2f')]();}[a22_0x56c7('0x44')](this));_0x48ad05[a22_0x56c7('0x61')](fs[a22_0x56c7('0x62')](this[a22_0x56c7('0xb')]+'/'+_0x4a2138+'.mp4'));}['finishProcess'](){fs[a22_0x56c7('0x63')](this['playListFile'],JSON[a22_0x56c7('0x21')](this[a22_0x56c7('0x2b')]));let _0xa288ca=a22_0x56c7('0x64')+'\x0d\x0a'+a22_0x56c7('0x65')+'\x0d\x0a';for(const _0x5a4d14 in this[a22_0x56c7('0x14')]){const _0x3ad8c6=this['downloadFiles'][_0x5a4d14][a22_0x56c7('0x66')];const _0x21143f=this[a22_0x56c7('0x14')][_0x5a4d14][a22_0x56c7('0x37')];const _0x29c821=_0x3ad8c6[a22_0x56c7('0x38')](_0x3ad8c6['lastIndexOf']('/')+0x1);let _0x5460dc=_0x29c821[a22_0x56c7('0x67')]('.')['slice'](0x0,-0x1)[a22_0x56c7('0x46')]('.');if(_0x21143f==a22_0x56c7('0x3b')){_0x5460dc=_0x3ad8c6;}_0xa288ca+=a22_0x56c7('0x68')+_0x5460dc+a22_0x56c7('0x51')+'\x0d\x0a';}fsExtra[a22_0x56c7('0x69')](this[a22_0x56c7('0xd')]);fsExtra[a22_0x56c7('0x6a')](this[a22_0x56c7('0xb')],this[a22_0x56c7('0xd')]);fs['writeFileSync'](this[a22_0x56c7('0x11')],_0xa288ca);fsExtra[a22_0x56c7('0x69')](this['tempFolder']);console[a22_0x56c7('0x27')](a22_0x56c7('0x6b'));const _0x825e9b=spawn(a22_0x56c7('0x6c'),['-r',a22_0x56c7('0x6d')]);}}exports['SyncPlaylistsService']=SyncPlaylistsService;