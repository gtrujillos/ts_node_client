var a21_0x438d=['copySync','Finished','shutdown','defineProperty','__esModule','request','request-progress','child_process','is-image','string-template','mediaFolder','temp/','filesFolder','files/','playListFile','m3uFile','lulo_playlist.m3u','currentFile','newPlayList','init','parse','readFileSync','config.json','playerId','baseURL','env','WEB_SERVICE_URL','deploy/','api/player_playlist.php?player_id={0}','checkFolders','loadMediaList','ensureDir','tempFolder','playListServiceURL','hasPlayListChanged','downloadFiles','push','Total:\x20','length','download','No\x20playlist\x20changes','reloadMediaList','unlinkSync','existsSync','toString','error','log','this.currentFile:\x20','finishProcess','Downloading:\x20','progress','Error\x20downloading\x20file','end','Downloaded:\x20','duration','createImageVideo','createWriteStream','split','slice','ffmpeg','1/2','-loop','-pattern_type','libx264','-pix_fmt','yuv420p','-vf','scale=1920:1080','data','Converting\x20','stderr','stderr:\x20','bind','close','writeFileSync','stringify','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','path','lastIndexOf','join','/home/osmc/luloclient/media/files/','.mp4','emptyDirSync'];(function(_0x5d1073,_0x1760a4){var _0x386b6a=function(_0xb3dfd8){while(--_0xb3dfd8){_0x5d1073['push'](_0x5d1073['shift']());}};_0x386b6a(++_0x1760a4);}(a21_0x438d,0x153));var a21_0x544a=function(_0xaa0acb,_0x542052){_0xaa0acb=_0xaa0acb-0x0;var _0x5bcbfb=a21_0x438d[_0xaa0acb];return _0x5bcbfb;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object[a21_0x544a('0x0')](exports,a21_0x544a('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a21_0x544a('0x2'));const progress=require(a21_0x544a('0x3'));const spawn=require(a21_0x544a('0x4'))['spawn'];const isImage=require(a21_0x544a('0x5'));const format=require(a21_0x544a('0x6'));const os=require('os');class SyncPlaylistsService{constructor(){this['mediaFolder']='media/';this['tempFolder']=this[a21_0x544a('0x7')]+a21_0x544a('0x8');this[a21_0x544a('0x9')]=this[a21_0x544a('0x7')]+a21_0x544a('0xa');this[a21_0x544a('0xb')]=this[a21_0x544a('0x7')]+'playlist.txt';this[a21_0x544a('0xc')]=this['filesFolder']+a21_0x544a('0xd');this[a21_0x544a('0xe')]=0x0;this['downloadFiles']=[];this[a21_0x544a('0xf')]={};}[a21_0x544a('0x10')](){const _0x52ae78=JSON[a21_0x544a('0x11')](fs[a21_0x544a('0x12')](a21_0x544a('0x13')));this[a21_0x544a('0x14')]=_0x52ae78['playerId'];this[a21_0x544a('0x15')]=process[a21_0x544a('0x16')][a21_0x544a('0x17')]+a21_0x544a('0x18');this['playListServiceURL']=this[a21_0x544a('0x15')]+a21_0x544a('0x19');this[a21_0x544a('0x1a')]();this[a21_0x544a('0x1b')]();}[a21_0x544a('0x1a')](){fsExtra['ensureDir'](this[a21_0x544a('0x7')],_0x357e64=>{});fsExtra[a21_0x544a('0x1c')](this[a21_0x544a('0x1d')],_0x43d20c=>{});fsExtra[a21_0x544a('0x1c')](this[a21_0x544a('0x9')],_0x32e6c2=>{});}['loadMediaList'](){const _0xc90217=format(this[a21_0x544a('0x1e')],this[a21_0x544a('0x14')]);console['log'](_0xc90217);request({'url':_0xc90217,'json':!![]},function(_0x978742,_0x53bda0,_0xa0b1f8){this['newPlayList']=_0xa0b1f8;if(this[a21_0x544a('0x1f')]()){this[a21_0x544a('0x20')]=[];this[a21_0x544a('0xe')]=0x0;for(const _0xd1664b in _0xa0b1f8){this[a21_0x544a('0x20')][a21_0x544a('0x21')](_0xa0b1f8[_0xd1664b]);}console['log'](a21_0x544a('0x22')+this[a21_0x544a('0x20')]['length']);if(this[a21_0x544a('0x20')][a21_0x544a('0x23')]>0x0){this[a21_0x544a('0x24')]();}}else{console['log'](a21_0x544a('0x25'));}}['bind'](this));}[a21_0x544a('0x26')](){fs[a21_0x544a('0x27')](this[a21_0x544a('0xb')]);this[a21_0x544a('0x1b')]();}[a21_0x544a('0x1f')](){const _0x582bf1=JSON['stringify'](this['newPlayList']);try{if(!fs[a21_0x544a('0x28')](this[a21_0x544a('0xb')])){return!![];}else{const _0xc26368=fs['readFileSync'](this[a21_0x544a('0xb')])[a21_0x544a('0x29')]();if(_0xc26368!=_0x582bf1){return!![];}}}catch(_0x110044){console[a21_0x544a('0x2a')](_0x110044);}return![];}['download'](){console[a21_0x544a('0x2b')](a21_0x544a('0x2c')+this[a21_0x544a('0xe')]);if(this[a21_0x544a('0xe')]>=this[a21_0x544a('0x20')]['length']){this[a21_0x544a('0x2d')]();return;}const _0x24b017=String(this['downloadFiles'][this[a21_0x544a('0xe')]]['path']);const _0xedb9b7=_0x24b017['substring'](_0x24b017['lastIndexOf']('/')+0x1);const _0x4f2106=this[a21_0x544a('0x15')]+_0x24b017;console[a21_0x544a('0x2b')](a21_0x544a('0x2e')+_0x4f2106);progress(request(_0x4f2106),{})['on'](a21_0x544a('0x2f'),function(_0x35bbda){console[a21_0x544a('0x2b')](a21_0x544a('0x2f'),_0x35bbda['percent']);})['on'](a21_0x544a('0x2a'),function(_0x4468ea){console[a21_0x544a('0x2b')](a21_0x544a('0x30'));this[a21_0x544a('0x24')]();})['on'](a21_0x544a('0x31'),function(){console[a21_0x544a('0x2b')](a21_0x544a('0x32')+_0xedb9b7);if(isImage(_0xedb9b7)){const _0x3eaab4=this['downloadFiles'][this[a21_0x544a('0xe')]][a21_0x544a('0x33')]!=null?this[a21_0x544a('0x20')][this[a21_0x544a('0xe')]][a21_0x544a('0x33')]:0x1e;this[a21_0x544a('0x34')](_0xedb9b7,_0x3eaab4);}else{this[a21_0x544a('0xe')]++;this[a21_0x544a('0x24')]();}}['bind'](this))['pipe'](fs[a21_0x544a('0x35')](this[a21_0x544a('0x1d')]+_0xedb9b7));}[a21_0x544a('0x34')](_0x494703,_0x5e1223=0x1e){const _0x4e8880=this[a21_0x544a('0x1d')]+_0x494703;const _0x5aaaae=_0x494703[a21_0x544a('0x36')]('.')[a21_0x544a('0x37')](0x0,-0x1)['join']('.');const _0x52e3c8=a21_0x544a('0x38');const _0x3e19a1=['-y','-r',a21_0x544a('0x39'),a21_0x544a('0x3a'),'1',a21_0x544a('0x3b'),'glob','-i',_0x4e8880,'-t',String(_0x5e1223),'-c:v',a21_0x544a('0x3c'),a21_0x544a('0x3d'),a21_0x544a('0x3e'),'-r','25',a21_0x544a('0x3f'),a21_0x544a('0x40'),this[a21_0x544a('0x1d')]+_0x5aaaae+'.mp4'];const _0x2af4a0=spawn(_0x52e3c8,_0x3e19a1);_0x2af4a0['stdout']['on'](a21_0x544a('0x41'),function(_0x2a347b){console[a21_0x544a('0x2b')](a21_0x544a('0x42')+_0x4e8880);});_0x2af4a0[a21_0x544a('0x43')]['on'](a21_0x544a('0x41'),function(_0x343650){console['log'](a21_0x544a('0x44')+_0x343650);}[a21_0x544a('0x45')](this));_0x2af4a0['on'](a21_0x544a('0x46'),function(){console['log']('finished\x20mp4\x20convert');this['currentFile']++;this[a21_0x544a('0x24')]();}['bind'](this));}['finishProcess'](){fs[a21_0x544a('0x47')](this[a21_0x544a('0xb')],JSON[a21_0x544a('0x48')](this[a21_0x544a('0xf')]));let _0x634c65=a21_0x544a('0x49')+'\x0d\x0a'+a21_0x544a('0x4a')+'\x0d\x0a';for(const _0x47f532 in this[a21_0x544a('0x20')]){const _0x437893=this[a21_0x544a('0x20')][_0x47f532][a21_0x544a('0x4b')];const _0x89afdf=_0x437893['substring'](_0x437893[a21_0x544a('0x4c')]('/')+0x1);const _0x4eafd8=_0x89afdf['split']('.')['slice'](0x0,-0x1)[a21_0x544a('0x4d')]('.');_0x634c65+=a21_0x544a('0x4e')+_0x4eafd8+a21_0x544a('0x4f')+'\x0d\x0a';}fsExtra[a21_0x544a('0x50')](this[a21_0x544a('0x9')]);fsExtra[a21_0x544a('0x51')](this['tempFolder'],this[a21_0x544a('0x9')]);fs[a21_0x544a('0x47')](this[a21_0x544a('0xc')],_0x634c65);fsExtra[a21_0x544a('0x50')](this[a21_0x544a('0x1d')]);console[a21_0x544a('0x2b')](a21_0x544a('0x52'));const _0x2060b7=spawn(a21_0x544a('0x53'),['-r','now']);}}exports['SyncPlaylistsService']=SyncPlaylistsService;