var a22_0x314e=['Download\x20started','filename:\x20','_filename','size:\x20','size','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','slice','/home/osmc/luloclient/media/files/','copySync','Finished','shutdown','now','SyncPlaylistsService','__esModule','../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','is-image','string-template','youtube-dl','uuid/v4','config.json','mediaFolder','tempFolder','temp/','files/','playListFile','m3uFile','filesFolder','lulo_playlist.m3u','downloadFiles','newPlayList','httpClientService','HttpClientService','init','config','parse','context','readFileSync','playerId','baseURL','env','WEB_SERVICE_URL','playListServiceURL','registerClient','deviceUuid','writeFileSync','stringify','networkInterfaces','post','then','log','catch','checkFolders','ensureDir','loadMediaList','hasPlayListChanged','push','length','download','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','existsSync','error','this.currentFile:\x20','currentFile','finishProcess','path','media_type','substring','lastIndexOf','youtube_single','downloadYouTube','progress','percent','end','Downloaded:\x20','mediaType:\x20','image','duration','video','pipe','createWriteStream','createImageVideo','split','-loop','-pattern_type','glob','-c:v','-pix_fmt','yuv420p','-vf','scale=1920:1080','.mp4','Converting\x20','stderr','data','stderr:\x20','finished\x20mp4\x20convert','http://www.youtube.com/watch?v=','info'];(function(_0x478aa6,_0x30012d){var _0x19366f=function(_0x36efeb){while(--_0x36efeb){_0x478aa6['push'](_0x478aa6['shift']());}};_0x19366f(++_0x30012d);}(a22_0x314e,0x1c0));var a22_0xb708=function(_0x2bf022,_0x4cc8fd){_0x2bf022=_0x2bf022-0x0;var _0x1cd2ea=a22_0x314e[_0x2bf022];return _0x1cd2ea;};'use strict';Object['defineProperty'](exports,a22_0xb708('0x0'),{'value':!![]});const HttpClientService_1=require(a22_0xb708('0x1'));const fs=require('fs');const fsExtra=require(a22_0xb708('0x2'));const request=require(a22_0xb708('0x3'));const progress=require(a22_0xb708('0x4'));const spawn=require('child_process')[a22_0xb708('0x5')];const isImage=require(a22_0xb708('0x6'));const format=require(a22_0xb708('0x7'));const os=require('os');const youtubedl=require(a22_0xb708('0x8'));const uuidv4=require(a22_0xb708('0x9'));const configFile=a22_0xb708('0xa');const contextFile='context.json';class SyncPlaylistsService{constructor(){this[a22_0xb708('0xb')]='media/';this[a22_0xb708('0xc')]=this['mediaFolder']+a22_0xb708('0xd');this['filesFolder']=this[a22_0xb708('0xb')]+a22_0xb708('0xe');this[a22_0xb708('0xf')]=this['mediaFolder']+'playlist.txt';this[a22_0xb708('0x10')]=this[a22_0xb708('0x11')]+a22_0xb708('0x12');this['currentFile']=0x0;this[a22_0xb708('0x13')]=[];this[a22_0xb708('0x14')]={};this[a22_0xb708('0x15')]=new HttpClientService_1[(a22_0xb708('0x16'))]();}[a22_0xb708('0x17')](){this[a22_0xb708('0x18')]=JSON[a22_0xb708('0x19')](fs['readFileSync'](configFile));this[a22_0xb708('0x1a')]=JSON[a22_0xb708('0x19')](fs[a22_0xb708('0x1b')](contextFile));this[a22_0xb708('0x1c')]=this[a22_0xb708('0x18')][a22_0xb708('0x1c')];this[a22_0xb708('0x1d')]=process[a22_0xb708('0x1e')][a22_0xb708('0x1f')]+'deploy/';this[a22_0xb708('0x20')]=this[a22_0xb708('0x1d')]+'api/player_playlist.php?player_id={0}';this[a22_0xb708('0x21')]();this['checkFolders']();this['loadMediaList']();}[a22_0xb708('0x21')](){const _0xd304f5=this[a22_0xb708('0x18')][a22_0xb708('0x22')];if(!_0xd304f5||_0xd304f5==''){this[a22_0xb708('0x18')]['deviceUuid']=uuidv4();this['config']={'deviceUuid':this[a22_0xb708('0x18')][a22_0xb708('0x22')],'playerId':this[a22_0xb708('0x18')][a22_0xb708('0x1c')]};fs[a22_0xb708('0x23')](configFile,JSON[a22_0xb708('0x24')](this[a22_0xb708('0x18')]));}const _0x200ef7={'player_id':this[a22_0xb708('0x1c')],'device_uuid':this[a22_0xb708('0x18')][a22_0xb708('0x22')],'network_info':JSON[a22_0xb708('0x24')](os[a22_0xb708('0x25')]()),'firmware_info':JSON[a22_0xb708('0x24')](this[a22_0xb708('0x1a')]),'status':0x1};this[a22_0xb708('0x15')][a22_0xb708('0x26')]('http://restapi.lulo.run/player_devices/register',_0x200ef7,![])[a22_0xb708('0x27')](function(_0x43db4f){console[a22_0xb708('0x28')]('parsedBody');console[a22_0xb708('0x28')](_0x43db4f);})[a22_0xb708('0x29')](function(_0x14243b){});}[a22_0xb708('0x2a')](){fsExtra[a22_0xb708('0x2b')](this[a22_0xb708('0xb')],_0x28bf43=>{});fsExtra[a22_0xb708('0x2b')](this['tempFolder'],_0x5d6215=>{});fsExtra['ensureDir'](this[a22_0xb708('0x11')],_0x22598e=>{});}[a22_0xb708('0x2c')](){const _0x483c6f=format(this['playListServiceURL'],this['playerId']);console[a22_0xb708('0x28')](_0x483c6f);request({'url':_0x483c6f,'json':!![]},function(_0x3c8192,_0x16a3c7,_0x7aa71){console[a22_0xb708('0x28')](_0x7aa71);this['newPlayList']=_0x7aa71;if(this[a22_0xb708('0x2d')]()){this[a22_0xb708('0x13')]=[];this['currentFile']=0x0;for(const _0x57b9da in _0x7aa71){this['downloadFiles'][a22_0xb708('0x2e')](_0x7aa71[_0x57b9da]);}console[a22_0xb708('0x28')]('Total:\x20'+this[a22_0xb708('0x13')]['length']);if(this[a22_0xb708('0x13')][a22_0xb708('0x2f')]>0x0){this[a22_0xb708('0x30')]();}}else{console['log'](a22_0xb708('0x31'));}}[a22_0xb708('0x32')](this));}[a22_0xb708('0x33')](){fs[a22_0xb708('0x34')](this[a22_0xb708('0xf')]);this['loadMediaList']();}[a22_0xb708('0x2d')](){const _0x51c010=JSON[a22_0xb708('0x24')](this[a22_0xb708('0x14')]);try{if(!fs[a22_0xb708('0x35')](this[a22_0xb708('0xf')])){return!![];}else{const _0x378faa=fs[a22_0xb708('0x1b')](this[a22_0xb708('0xf')])['toString']();if(_0x378faa!=_0x51c010){return!![];}}}catch(_0x5227a7){console[a22_0xb708('0x36')](_0x5227a7);}return![];}[a22_0xb708('0x30')](){console['log'](a22_0xb708('0x37')+this[a22_0xb708('0x38')]);if(this[a22_0xb708('0x38')]>=this['downloadFiles'][a22_0xb708('0x2f')]){this[a22_0xb708('0x39')]();return;}const _0x187184=String(this[a22_0xb708('0x13')][this[a22_0xb708('0x38')]][a22_0xb708('0x3a')]);const _0x3e8cf4=this[a22_0xb708('0x13')][this[a22_0xb708('0x38')]][a22_0xb708('0x3b')];const _0xd5a64d=_0x187184[a22_0xb708('0x3c')](_0x187184[a22_0xb708('0x3d')]('/')+0x1);const _0xdcb8ef=this[a22_0xb708('0x1d')]+_0x187184;console[a22_0xb708('0x28')]('Downloading:\x20'+_0xdcb8ef);if(_0x3e8cf4==a22_0xb708('0x3e')){this[a22_0xb708('0x3f')](_0x187184);}else{progress(request(_0xdcb8ef),{})['on'](a22_0xb708('0x40'),function(_0x242609){console[a22_0xb708('0x28')](a22_0xb708('0x40'),_0x242609[a22_0xb708('0x41')]);})['on'](a22_0xb708('0x36'),function(_0x1c6d11){console[a22_0xb708('0x28')]('Error\x20downloading\x20file');this[a22_0xb708('0x30')]();})['on'](a22_0xb708('0x42'),function(){console[a22_0xb708('0x28')](a22_0xb708('0x43')+_0xd5a64d);console['log'](a22_0xb708('0x44')+_0x3e8cf4);if(_0x3e8cf4==a22_0xb708('0x45')){const _0x3d5280=this['downloadFiles'][this['currentFile']][a22_0xb708('0x46')]!=null?this['downloadFiles'][this[a22_0xb708('0x38')]][a22_0xb708('0x46')]:0x1e;this['createImageVideo'](_0xd5a64d,_0x3d5280);}else if(_0x3e8cf4==a22_0xb708('0x47')){this[a22_0xb708('0x38')]++;this[a22_0xb708('0x30')]();}}[a22_0xb708('0x32')](this))[a22_0xb708('0x48')](fs[a22_0xb708('0x49')](this[a22_0xb708('0xc')]+_0xd5a64d));}}[a22_0xb708('0x4a')](_0x157871,_0x525a74=0x1e){const _0x5d61c1=this[a22_0xb708('0xc')]+_0x157871;const _0x550ea6=_0x157871[a22_0xb708('0x4b')]('.')['slice'](0x0,-0x1)['join']('.');const _0x356db0='ffmpeg';const _0x2f9982=['-y','-r','1/2',a22_0xb708('0x4c'),'1',a22_0xb708('0x4d'),a22_0xb708('0x4e'),'-i',_0x5d61c1,'-t',String(_0x525a74),a22_0xb708('0x4f'),'libx264',a22_0xb708('0x50'),a22_0xb708('0x51'),'-r','25',a22_0xb708('0x52'),a22_0xb708('0x53'),this[a22_0xb708('0xc')]+_0x550ea6+a22_0xb708('0x54')];const _0x5e8572=spawn(_0x356db0,_0x2f9982);_0x5e8572['stdout']['on']('data',function(_0xc5280c){console[a22_0xb708('0x28')](a22_0xb708('0x55')+_0x5d61c1);});_0x5e8572[a22_0xb708('0x56')]['on'](a22_0xb708('0x57'),function(_0x2d47c6){console['log'](a22_0xb708('0x58')+_0x2d47c6);}[a22_0xb708('0x32')](this));_0x5e8572['on']('close',function(){console['log'](a22_0xb708('0x59'));this[a22_0xb708('0x38')]++;this[a22_0xb708('0x30')]();}[a22_0xb708('0x32')](this));}[a22_0xb708('0x3f')](_0xb46776){const _0x590154=youtubedl(a22_0xb708('0x5a')+_0xb46776,['--format=18'],{'cwd':__dirname});_0x590154['on'](a22_0xb708('0x5b'),function(_0x1dad4c){console[a22_0xb708('0x28')](a22_0xb708('0x5c'));console['log'](a22_0xb708('0x5d')+_0x1dad4c[a22_0xb708('0x5e')]);console[a22_0xb708('0x28')](a22_0xb708('0x5f')+_0x1dad4c[a22_0xb708('0x60')]);});_0x590154['on']('complete',function complete(_0x14001c){'use strict';console[a22_0xb708('0x28')](a22_0xb708('0x5d')+_0x14001c[a22_0xb708('0x5e')]+a22_0xb708('0x61'));});_0x590154['on']('end',function(){console[a22_0xb708('0x28')](a22_0xb708('0x62'));this[a22_0xb708('0x38')]++;this[a22_0xb708('0x30')]();}[a22_0xb708('0x32')](this));_0x590154[a22_0xb708('0x48')](fs[a22_0xb708('0x49')](this['tempFolder']+'/'+_0xb46776+a22_0xb708('0x54')));}['finishProcess'](){fs[a22_0xb708('0x23')](this[a22_0xb708('0xf')],JSON['stringify'](this[a22_0xb708('0x14')]));let _0x44e3a0=a22_0xb708('0x63')+'\x0d\x0a'+a22_0xb708('0x64')+'\x0d\x0a';for(const _0x412d1b in this[a22_0xb708('0x13')]){const _0x337d06=this['downloadFiles'][_0x412d1b][a22_0xb708('0x3a')];const _0x3ff731=this[a22_0xb708('0x13')][_0x412d1b][a22_0xb708('0x3b')];const _0x5b9ab5=_0x337d06['substring'](_0x337d06['lastIndexOf']('/')+0x1);let _0x2471ad=_0x5b9ab5[a22_0xb708('0x4b')]('.')[a22_0xb708('0x65')](0x0,-0x1)['join']('.');if(_0x3ff731=='youtube_single'){_0x2471ad=_0x337d06;}_0x44e3a0+=a22_0xb708('0x66')+_0x2471ad+a22_0xb708('0x54')+'\x0d\x0a';}fsExtra['emptyDirSync'](this[a22_0xb708('0x11')]);fsExtra[a22_0xb708('0x67')](this[a22_0xb708('0xc')],this['filesFolder']);fs[a22_0xb708('0x23')](this[a22_0xb708('0x10')],_0x44e3a0);fsExtra['emptyDirSync'](this[a22_0xb708('0xc')]);console[a22_0xb708('0x28')](a22_0xb708('0x68'));const _0x267aef=spawn(a22_0xb708('0x69'),['-r',a22_0xb708('0x6a')]);}}exports[a22_0xb708('0x6b')]=SyncPlaylistsService;