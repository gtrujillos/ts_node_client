var a21_0x10f2=['end','Downloaded:\x20','duration','createImageVideo','pipe','split','slice','join','ffmpeg','1/2','-pattern_type','glob','-c:v','libx264','-pix_fmt','yuv420p','-vf','.mp4','stdout','data','Converting\x20','stderr','stderr:\x20','close','finished\x20mp4\x20convert','writeFileSync','#EXTCPlayListM3U::M3U','lastIndexOf','emptyDirSync','copySync','now','SyncPlaylistsService','__esModule','request','request-progress','child_process','is-image','string-template','mediaFolder','media/','tempFolder','temp/','filesFolder','files/','playListFile','playlist.txt','m3uFile','currentFile','downloadFiles','newPlayList','parse','config.json','playerId','env','WEB_SERVICE_URL','playListServiceURL','baseURL','checkFolders','ensureDir','log','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','unlinkSync','loadMediaList','stringify','existsSync','readFileSync','toString','error','this.currentFile:\x20','finishProcess','path','substring','Downloading:\x20','progress','percent','Error\x20downloading\x20file'];(function(_0x205d1f,_0xfa65ce){var _0x496dc3=function(_0x49eb3b){while(--_0x49eb3b){_0x205d1f['push'](_0x205d1f['shift']());}};_0x496dc3(++_0xfa65ce);}(a21_0x10f2,0xc2));var a21_0x3bea=function(_0x53f597,_0x36e892){_0x53f597=_0x53f597-0x0;var _0x50c3b0=a21_0x10f2[_0x53f597];return _0x50c3b0;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object['defineProperty'](exports,a21_0x3bea('0x0'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a21_0x3bea('0x1'));const progress=require(a21_0x3bea('0x2'));const spawn=require(a21_0x3bea('0x3'))['spawn'];const isImage=require(a21_0x3bea('0x4'));const format=require(a21_0x3bea('0x5'));const os=require('os');class SyncPlaylistsService{constructor(){this[a21_0x3bea('0x6')]=a21_0x3bea('0x7');this[a21_0x3bea('0x8')]=this[a21_0x3bea('0x6')]+a21_0x3bea('0x9');this[a21_0x3bea('0xa')]=this['mediaFolder']+a21_0x3bea('0xb');this[a21_0x3bea('0xc')]=this[a21_0x3bea('0x6')]+a21_0x3bea('0xd');this[a21_0x3bea('0xe')]=this[a21_0x3bea('0xa')]+'lulo_playlist.m3u';this[a21_0x3bea('0xf')]=0x0;this[a21_0x3bea('0x10')]=[];this[a21_0x3bea('0x11')]={};}['init'](){const _0xa72408=JSON[a21_0x3bea('0x12')](fs['readFileSync'](a21_0x3bea('0x13')));this[a21_0x3bea('0x14')]=_0xa72408[a21_0x3bea('0x14')];this['baseURL']=process[a21_0x3bea('0x15')][a21_0x3bea('0x16')];this[a21_0x3bea('0x17')]=this[a21_0x3bea('0x18')]+'deploy/api/player_playlist.php?player_id={0}';this[a21_0x3bea('0x19')]();this['loadMediaList']();}[a21_0x3bea('0x19')](){fsExtra[a21_0x3bea('0x1a')](this[a21_0x3bea('0x6')],_0x10e78d=>{});fsExtra['ensureDir'](this[a21_0x3bea('0x8')],_0x42d8f8=>{});fsExtra[a21_0x3bea('0x1a')](this[a21_0x3bea('0xa')],_0x3554bd=>{});}['loadMediaList'](){const _0x3a5241=format(this[a21_0x3bea('0x17')],this[a21_0x3bea('0x14')]);console[a21_0x3bea('0x1b')](_0x3a5241);request({'url':_0x3a5241,'json':!![]},function(_0x252665,_0xbc1f33,_0x3a0ecd){this[a21_0x3bea('0x11')]=_0x3a0ecd;if(this['hasPlayListChanged']()){this['downloadFiles']=[];this['currentFile']=0x0;for(const _0x3c3059 in _0x3a0ecd){this[a21_0x3bea('0x10')][a21_0x3bea('0x1c')](_0x3a0ecd[_0x3c3059]);}console[a21_0x3bea('0x1b')](a21_0x3bea('0x1d')+this[a21_0x3bea('0x10')]['length']);if(this[a21_0x3bea('0x10')][a21_0x3bea('0x1e')]>0x0){this[a21_0x3bea('0x1f')]();}}else{console[a21_0x3bea('0x1b')](a21_0x3bea('0x20'));}}[a21_0x3bea('0x21')](this));}['reloadMediaList'](){fs[a21_0x3bea('0x22')](this['playListFile']);this[a21_0x3bea('0x23')]();}['hasPlayListChanged'](){const _0x147a7c=JSON[a21_0x3bea('0x24')](this[a21_0x3bea('0x11')]);try{if(!fs[a21_0x3bea('0x25')](this['playListFile'])){return!![];}else{const _0x27ea6b=fs[a21_0x3bea('0x26')](this[a21_0x3bea('0xc')])[a21_0x3bea('0x27')]();if(_0x27ea6b!=_0x147a7c){return!![];}}}catch(_0x1faa15){console[a21_0x3bea('0x28')](_0x1faa15);}return![];}['download'](){console[a21_0x3bea('0x1b')](a21_0x3bea('0x29')+this['currentFile']);if(this[a21_0x3bea('0xf')]>=this[a21_0x3bea('0x10')][a21_0x3bea('0x1e')]){this[a21_0x3bea('0x2a')]();return;}const _0x117350=String(this['downloadFiles'][this[a21_0x3bea('0xf')]][a21_0x3bea('0x2b')]);const _0x5b774e=_0x117350[a21_0x3bea('0x2c')](_0x117350['lastIndexOf']('/')+0x1);console[a21_0x3bea('0x1b')](a21_0x3bea('0x2d')+_0x5b774e);progress(request(this['baseURL']+_0x117350),{})['on'](a21_0x3bea('0x2e'),function(_0x213d54){console[a21_0x3bea('0x1b')](a21_0x3bea('0x2e'),_0x213d54[a21_0x3bea('0x2f')]);})['on']('error',function(_0x168577){console[a21_0x3bea('0x1b')](a21_0x3bea('0x30'));this['download']();})['on'](a21_0x3bea('0x31'),function(){console[a21_0x3bea('0x1b')](a21_0x3bea('0x32')+_0x5b774e);if(isImage(_0x5b774e)){const _0x2c24fa=this[a21_0x3bea('0x10')][this[a21_0x3bea('0xf')]][a21_0x3bea('0x33')]!=null?this[a21_0x3bea('0x10')][this[a21_0x3bea('0xf')]][a21_0x3bea('0x33')]:0x1e;this[a21_0x3bea('0x34')](_0x5b774e,_0x2c24fa);}else{this[a21_0x3bea('0xf')]++;this[a21_0x3bea('0x1f')]();}}['bind'](this))[a21_0x3bea('0x35')](fs['createWriteStream'](this[a21_0x3bea('0x8')]+_0x5b774e));}['createImageVideo'](_0x3fff08,_0x532758=0x1e){const _0xd0a5e7=this['tempFolder']+_0x3fff08;const _0x712b84=_0x3fff08[a21_0x3bea('0x36')]('.')[a21_0x3bea('0x37')](0x0,-0x1)[a21_0x3bea('0x38')]('.');const _0x7d0163=a21_0x3bea('0x39');const _0x23e0ef=['-y','-r',a21_0x3bea('0x3a'),'-loop','1',a21_0x3bea('0x3b'),a21_0x3bea('0x3c'),'-i',_0xd0a5e7,'-t',String(_0x532758),a21_0x3bea('0x3d'),a21_0x3bea('0x3e'),a21_0x3bea('0x3f'),a21_0x3bea('0x40'),'-r','25',a21_0x3bea('0x41'),'scale=1920:1080',this[a21_0x3bea('0x8')]+_0x712b84+a21_0x3bea('0x42')];const _0x4460a6=spawn(_0x7d0163,_0x23e0ef);_0x4460a6[a21_0x3bea('0x43')]['on'](a21_0x3bea('0x44'),function(_0x2e64bf){console['log'](a21_0x3bea('0x45')+_0xd0a5e7);});_0x4460a6[a21_0x3bea('0x46')]['on'](a21_0x3bea('0x44'),function(_0x1725a0){console[a21_0x3bea('0x1b')](a21_0x3bea('0x47')+_0x1725a0);}[a21_0x3bea('0x21')](this));_0x4460a6['on'](a21_0x3bea('0x48'),function(){console['log'](a21_0x3bea('0x49'));this[a21_0x3bea('0xf')]++;this[a21_0x3bea('0x1f')]();}['bind'](this));}[a21_0x3bea('0x2a')](){fs[a21_0x3bea('0x4a')](this[a21_0x3bea('0xc')],JSON[a21_0x3bea('0x24')](this[a21_0x3bea('0x11')]));let _0x33aa39=a21_0x3bea('0x4b')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x5098b4 in this[a21_0x3bea('0x10')]){const _0x4e0079=this[a21_0x3bea('0x10')][_0x5098b4][a21_0x3bea('0x2b')];const _0x24e714=_0x4e0079[a21_0x3bea('0x2c')](_0x4e0079[a21_0x3bea('0x4c')]('/')+0x1);const _0x3eb815=_0x24e714['split']('.')[a21_0x3bea('0x37')](0x0,-0x1)[a21_0x3bea('0x38')]('.');_0x33aa39+='/home/osmc/luloclient/media/files/'+_0x3eb815+a21_0x3bea('0x42')+'\x0d\x0a';}fsExtra[a21_0x3bea('0x4d')](this[a21_0x3bea('0xa')]);fsExtra[a21_0x3bea('0x4e')](this['tempFolder'],this['filesFolder']);fs['writeFileSync'](this['m3uFile'],_0x33aa39);fsExtra['emptyDirSync'](this['tempFolder']);console[a21_0x3bea('0x1b')]('Finished');const _0x3c83ea=spawn('shutdown',['-r',a21_0x3bea('0x4f')]);}}exports[a21_0x3bea('0x50')]=SyncPlaylistsService;