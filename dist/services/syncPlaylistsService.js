var a22_0x48b3=['files/','playListFile','playlist.txt','m3uFile','filesFolder','lulo_playlist.m3u','currentFile','newPlayList','HttpClientService','init','config','parse','readFileSync','context','playerId','WEB_SERVICE_URL','deploy/','playListServiceURL','baseURL','registerClient','loadMediaList','deviceUuid','writeFileSync','stringify','networkInterfaces','httpClientService','post','http://restapi.lulo.run/player_devices/register','then','log','parsedBody','catch','ensureDir','hasPlayListChanged','downloadFiles','push','length','download','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','existsSync','toString','error','this.currentFile:\x20','finishProcess','media_type','substring','lastIndexOf','Downloading:\x20','downloadYouTube','progress','Error\x20downloading\x20file','end','Downloaded:\x20','mediaType:\x20','image','duration','video','pipe','createWriteStream','createImageVideo','split','join','ffmpeg','1/2','-loop','-pattern_type','glob','-c:v','libx264','yuv420p','-vf','scale=1920:1080','.mp4','stdout','data','Converting\x20','stderr:\x20','close','http://www.youtube.com/watch?v=','--format=18','info','filename:\x20','_filename','size:\x20','size','complete','finished\x20youtube\x20downloading!','#EXTCPlayListM3U::M3U','path','slice','youtube_single','/home/osmc/luloclient/media/files/','copySync','emptyDirSync','Finished','shutdown','now','SyncPlaylistsService','defineProperty','__esModule','../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','is-image','string-template','context.json','mediaFolder','media/','tempFolder','temp/'];(function(_0x3cdfc0,_0x5ca108){var _0x15b5c4=function(_0x4dcb02){while(--_0x4dcb02){_0x3cdfc0['push'](_0x3cdfc0['shift']());}};_0x15b5c4(++_0x5ca108);}(a22_0x48b3,0x65));var a22_0x651d=function(_0x1a9dbd,_0x3300e2){_0x1a9dbd=_0x1a9dbd-0x0;var _0x54443a=a22_0x48b3[_0x1a9dbd];return _0x54443a;};'use strict';Object[a22_0x651d('0x0')](exports,a22_0x651d('0x1'),{'value':!![]});const HttpClientService_1=require(a22_0x651d('0x2'));const fs=require('fs');const fsExtra=require(a22_0x651d('0x3'));const request=require(a22_0x651d('0x4'));const progress=require('request-progress');const spawn=require(a22_0x651d('0x5'))[a22_0x651d('0x6')];const isImage=require(a22_0x651d('0x7'));const format=require(a22_0x651d('0x8'));const os=require('os');const youtubedl=require('youtube-dl');const uuidv4=require('uuid/v4');const configFile='config.json';const contextFile=a22_0x651d('0x9');class SyncPlaylistsService{constructor(){this[a22_0x651d('0xa')]=a22_0x651d('0xb');this[a22_0x651d('0xc')]=this[a22_0x651d('0xa')]+a22_0x651d('0xd');this['filesFolder']=this[a22_0x651d('0xa')]+a22_0x651d('0xe');this[a22_0x651d('0xf')]=this[a22_0x651d('0xa')]+a22_0x651d('0x10');this[a22_0x651d('0x11')]=this[a22_0x651d('0x12')]+a22_0x651d('0x13');this[a22_0x651d('0x14')]=0x0;this['downloadFiles']=[];this[a22_0x651d('0x15')]={};this['httpClientService']=new HttpClientService_1[(a22_0x651d('0x16'))]();}[a22_0x651d('0x17')](){this[a22_0x651d('0x18')]=JSON[a22_0x651d('0x19')](fs[a22_0x651d('0x1a')](configFile));this[a22_0x651d('0x1b')]=JSON[a22_0x651d('0x19')](fs[a22_0x651d('0x1a')](contextFile));this[a22_0x651d('0x1c')]=this[a22_0x651d('0x18')][a22_0x651d('0x1c')];this['baseURL']=process['env'][a22_0x651d('0x1d')]+a22_0x651d('0x1e');this[a22_0x651d('0x1f')]=this[a22_0x651d('0x20')]+'api/player_playlist.php?player_id={0}';this[a22_0x651d('0x21')]();this['checkFolders']();this[a22_0x651d('0x22')]();}[a22_0x651d('0x21')](){const _0x7fbf67=this[a22_0x651d('0x18')][a22_0x651d('0x23')];if(!_0x7fbf67||_0x7fbf67==''){this[a22_0x651d('0x18')]['deviceUuid']=uuidv4();this['config']={'deviceUuid':this[a22_0x651d('0x18')][a22_0x651d('0x23')],'playerId':this[a22_0x651d('0x18')][a22_0x651d('0x1c')]};fs[a22_0x651d('0x24')](configFile,JSON[a22_0x651d('0x25')](this['config']));}const _0x63c820={'player_id':this[a22_0x651d('0x1c')],'device_uuid':this[a22_0x651d('0x18')][a22_0x651d('0x23')],'network_info':JSON[a22_0x651d('0x25')](os[a22_0x651d('0x26')]()),'firmware_info':JSON['stringify'](this['context']),'status':0x1};this[a22_0x651d('0x27')][a22_0x651d('0x28')](a22_0x651d('0x29'),_0x63c820,![])[a22_0x651d('0x2a')](function(_0x1fa92b){console[a22_0x651d('0x2b')](a22_0x651d('0x2c'));console[a22_0x651d('0x2b')](_0x1fa92b);})[a22_0x651d('0x2d')](function(_0x15a2c3){});}['checkFolders'](){fsExtra[a22_0x651d('0x2e')](this['mediaFolder'],_0xf6c158=>{});fsExtra['ensureDir'](this['tempFolder'],_0x2ef0aa=>{});fsExtra['ensureDir'](this['filesFolder'],_0x47c4b=>{});}[a22_0x651d('0x22')](){const _0x34e264=format(this[a22_0x651d('0x1f')],this[a22_0x651d('0x1c')]);console['log'](_0x34e264);request({'url':_0x34e264,'json':!![]},function(_0x448617,_0x4681c5,_0x1ca35a){console[a22_0x651d('0x2b')](_0x1ca35a);this[a22_0x651d('0x15')]=_0x1ca35a;if(this[a22_0x651d('0x2f')]()){this[a22_0x651d('0x30')]=[];this['currentFile']=0x0;for(const _0x1590b4 in _0x1ca35a){this[a22_0x651d('0x30')][a22_0x651d('0x31')](_0x1ca35a[_0x1590b4]);}console[a22_0x651d('0x2b')]('Total:\x20'+this[a22_0x651d('0x30')][a22_0x651d('0x32')]);if(this['downloadFiles'][a22_0x651d('0x32')]>0x0){this[a22_0x651d('0x33')]();}}else{console[a22_0x651d('0x2b')](a22_0x651d('0x34'));}}[a22_0x651d('0x35')](this));}[a22_0x651d('0x36')](){fs[a22_0x651d('0x37')](this['playListFile']);this[a22_0x651d('0x22')]();}[a22_0x651d('0x2f')](){const _0x37be4e=JSON[a22_0x651d('0x25')](this[a22_0x651d('0x15')]);try{if(!fs[a22_0x651d('0x38')](this[a22_0x651d('0xf')])){return!![];}else{const _0x2f0a45=fs[a22_0x651d('0x1a')](this[a22_0x651d('0xf')])[a22_0x651d('0x39')]();if(_0x2f0a45!=_0x37be4e){return!![];}}}catch(_0x165d14){console[a22_0x651d('0x3a')](_0x165d14);}return![];}[a22_0x651d('0x33')](){console['log'](a22_0x651d('0x3b')+this['currentFile']);if(this[a22_0x651d('0x14')]>=this[a22_0x651d('0x30')][a22_0x651d('0x32')]){this[a22_0x651d('0x3c')]();return;}const _0x5300a5=String(this[a22_0x651d('0x30')][this[a22_0x651d('0x14')]]['path']);const _0x23d890=this[a22_0x651d('0x30')][this[a22_0x651d('0x14')]][a22_0x651d('0x3d')];const _0x1f60bd=_0x5300a5[a22_0x651d('0x3e')](_0x5300a5[a22_0x651d('0x3f')]('/')+0x1);const _0x675461=this['baseURL']+_0x5300a5;console[a22_0x651d('0x2b')](a22_0x651d('0x40')+_0x675461);if(_0x23d890=='youtube_single'){this[a22_0x651d('0x41')](_0x5300a5);}else{progress(request(_0x675461),{})['on']('progress',function(_0x5c545f){console[a22_0x651d('0x2b')](a22_0x651d('0x42'),_0x5c545f['percent']);})['on']('error',function(_0x628603){console[a22_0x651d('0x2b')](a22_0x651d('0x43'));this[a22_0x651d('0x33')]();})['on'](a22_0x651d('0x44'),function(){console[a22_0x651d('0x2b')](a22_0x651d('0x45')+_0x1f60bd);console[a22_0x651d('0x2b')](a22_0x651d('0x46')+_0x23d890);if(_0x23d890==a22_0x651d('0x47')){const _0x200864=this[a22_0x651d('0x30')][this[a22_0x651d('0x14')]][a22_0x651d('0x48')]!=null?this['downloadFiles'][this[a22_0x651d('0x14')]][a22_0x651d('0x48')]:0x1e;this['createImageVideo'](_0x1f60bd,_0x200864);}else if(_0x23d890==a22_0x651d('0x49')){this[a22_0x651d('0x14')]++;this[a22_0x651d('0x33')]();}}[a22_0x651d('0x35')](this))[a22_0x651d('0x4a')](fs[a22_0x651d('0x4b')](this['tempFolder']+_0x1f60bd));}}[a22_0x651d('0x4c')](_0x465361,_0x540c41=0x1e){const _0x35d442=this[a22_0x651d('0xc')]+_0x465361;const _0x45c6aa=_0x465361[a22_0x651d('0x4d')]('.')['slice'](0x0,-0x1)[a22_0x651d('0x4e')]('.');const _0x43919e=a22_0x651d('0x4f');const _0x13e16a=['-y','-r',a22_0x651d('0x50'),a22_0x651d('0x51'),'1',a22_0x651d('0x52'),a22_0x651d('0x53'),'-i',_0x35d442,'-t',String(_0x540c41),a22_0x651d('0x54'),a22_0x651d('0x55'),'-pix_fmt',a22_0x651d('0x56'),'-r','25',a22_0x651d('0x57'),a22_0x651d('0x58'),this[a22_0x651d('0xc')]+_0x45c6aa+a22_0x651d('0x59')];const _0x55f4f8=spawn(_0x43919e,_0x13e16a);_0x55f4f8[a22_0x651d('0x5a')]['on'](a22_0x651d('0x5b'),function(_0x27c3ee){console[a22_0x651d('0x2b')](a22_0x651d('0x5c')+_0x35d442);});_0x55f4f8['stderr']['on'](a22_0x651d('0x5b'),function(_0x85bedb){console[a22_0x651d('0x2b')](a22_0x651d('0x5d')+_0x85bedb);}[a22_0x651d('0x35')](this));_0x55f4f8['on'](a22_0x651d('0x5e'),function(){console[a22_0x651d('0x2b')]('finished\x20mp4\x20convert');this[a22_0x651d('0x14')]++;this[a22_0x651d('0x33')]();}[a22_0x651d('0x35')](this));}['downloadYouTube'](_0x3c9de3){const _0x2222b6=youtubedl(a22_0x651d('0x5f')+_0x3c9de3,[a22_0x651d('0x60')],{'cwd':__dirname});_0x2222b6['on'](a22_0x651d('0x61'),function(_0x1b71a3){console[a22_0x651d('0x2b')]('Download\x20started');console[a22_0x651d('0x2b')](a22_0x651d('0x62')+_0x1b71a3[a22_0x651d('0x63')]);console[a22_0x651d('0x2b')](a22_0x651d('0x64')+_0x1b71a3[a22_0x651d('0x65')]);});_0x2222b6['on'](a22_0x651d('0x66'),function complete(_0x1af4aa){'use strict';console[a22_0x651d('0x2b')](a22_0x651d('0x62')+_0x1af4aa[a22_0x651d('0x63')]+'\x20already\x20downloaded.');});_0x2222b6['on']('end',function(){console[a22_0x651d('0x2b')](a22_0x651d('0x67'));this[a22_0x651d('0x14')]++;this[a22_0x651d('0x33')]();}[a22_0x651d('0x35')](this));_0x2222b6[a22_0x651d('0x4a')](fs[a22_0x651d('0x4b')](this['tempFolder']+'/'+_0x3c9de3+a22_0x651d('0x59')));}[a22_0x651d('0x3c')](){fs[a22_0x651d('0x24')](this[a22_0x651d('0xf')],JSON[a22_0x651d('0x25')](this[a22_0x651d('0x15')]));let _0x5e1849=a22_0x651d('0x68')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x151741 in this['downloadFiles']){const _0x25a1b2=this['downloadFiles'][_0x151741][a22_0x651d('0x69')];const _0x4c035b=this[a22_0x651d('0x30')][_0x151741][a22_0x651d('0x3d')];const _0x411c1f=_0x25a1b2[a22_0x651d('0x3e')](_0x25a1b2[a22_0x651d('0x3f')]('/')+0x1);let _0x576475=_0x411c1f[a22_0x651d('0x4d')]('.')[a22_0x651d('0x6a')](0x0,-0x1)[a22_0x651d('0x4e')]('.');if(_0x4c035b==a22_0x651d('0x6b')){_0x576475=_0x25a1b2;}_0x5e1849+=a22_0x651d('0x6c')+_0x576475+a22_0x651d('0x59')+'\x0d\x0a';}fsExtra['emptyDirSync'](this[a22_0x651d('0x12')]);fsExtra[a22_0x651d('0x6d')](this[a22_0x651d('0xc')],this[a22_0x651d('0x12')]);fs[a22_0x651d('0x24')](this[a22_0x651d('0x11')],_0x5e1849);fsExtra[a22_0x651d('0x6e')](this['tempFolder']);console['log'](a22_0x651d('0x6f'));const _0x11e18a=spawn(a22_0x651d('0x70'),['-r',a22_0x651d('0x71')]);}}exports[a22_0x651d('0x72')]=SyncPlaylistsService;