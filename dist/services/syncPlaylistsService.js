var a21_0x5b67=['#EXTINF:0,luloPlayList','split','join','.mp4','emptyDirSync','copySync','Finished','shutdown','now','SyncPlaylistsService','defineProperty','__esModule','request-progress','spawn','is-image','media/','tempFolder','temp/','filesFolder','mediaFolder','playListFile','playlist.txt','m3uFile','lulo_playlist.m3u','currentFile','newPlayList','parse','readFileSync','config.json','playerId','baseURL','env','WEB_SERVICE_URL','player_playlist.php?player_id={0}','checkFolders','loadMediaList','ensureDir','log','hasPlayListChanged','downloadFiles','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','stringify','existsSync','error','this.currentFile:\x20','finishProcess','path','substring','lastIndexOf','progress','percent','Error\x20downloading\x20file','end','Downloaded:\x20','duration','createImageVideo','createWriteStream','slice','-pattern_type','glob','libx264','-pix_fmt','-vf','scale=1920:1080','stdout','data','Converting\x20','stderr:\x20','close','finished\x20mp4\x20convert','writeFileSync','#EXTCPlayListM3U::M3U'];(function(_0x2a2798,_0x10b6c8){var _0x569cb7=function(_0x2f3f17){while(--_0x2f3f17){_0x2a2798['push'](_0x2a2798['shift']());}};_0x569cb7(++_0x10b6c8);}(a21_0x5b67,0xa8));var a21_0x3e0a=function(_0x505984,_0x31961c){_0x505984=_0x505984-0x0;var _0x164359=a21_0x5b67[_0x505984];return _0x164359;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object[a21_0x3e0a('0x0')](exports,a21_0x3e0a('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a21_0x3e0a('0x2'));const spawn=require('child_process')[a21_0x3e0a('0x3')];const isImage=require(a21_0x3e0a('0x4'));const format=require('string-template');const os=require('os');class SyncPlaylistsService{constructor(){this['mediaFolder']=a21_0x3e0a('0x5');this[a21_0x3e0a('0x6')]=this['mediaFolder']+a21_0x3e0a('0x7');this[a21_0x3e0a('0x8')]=this[a21_0x3e0a('0x9')]+'files/';this[a21_0x3e0a('0xa')]=this[a21_0x3e0a('0x9')]+a21_0x3e0a('0xb');this[a21_0x3e0a('0xc')]=this[a21_0x3e0a('0x8')]+a21_0x3e0a('0xd');this[a21_0x3e0a('0xe')]=0x0;this['downloadFiles']=[];this[a21_0x3e0a('0xf')]={};}['init'](){const _0x6ce565=JSON[a21_0x3e0a('0x10')](fs[a21_0x3e0a('0x11')](a21_0x3e0a('0x12')));this[a21_0x3e0a('0x13')]=_0x6ce565[a21_0x3e0a('0x13')];this[a21_0x3e0a('0x14')]=process[a21_0x3e0a('0x15')][a21_0x3e0a('0x16')];this['playListServiceURL']=this[a21_0x3e0a('0x14')]+a21_0x3e0a('0x17');this[a21_0x3e0a('0x18')]();this[a21_0x3e0a('0x19')]();}[a21_0x3e0a('0x18')](){fsExtra[a21_0x3e0a('0x1a')](this[a21_0x3e0a('0x9')],_0x352992=>{});fsExtra['ensureDir'](this[a21_0x3e0a('0x6')],_0x76021=>{});fsExtra[a21_0x3e0a('0x1a')](this['filesFolder'],_0xcf799e=>{});}[a21_0x3e0a('0x19')](){const _0x552f74=format(this['playListServiceURL'],this['playerId']);console[a21_0x3e0a('0x1b')](_0x552f74);request({'url':_0x552f74,'json':!![]},function(_0x50d000,_0x130dae,_0x5d7aa8){this['newPlayList']=_0x5d7aa8;if(this[a21_0x3e0a('0x1c')]()){this[a21_0x3e0a('0x1d')]=[];this[a21_0x3e0a('0xe')]=0x0;for(const _0x5abbc8 in _0x5d7aa8){this[a21_0x3e0a('0x1d')][a21_0x3e0a('0x1e')](_0x5d7aa8[_0x5abbc8]);}console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x1f')+this[a21_0x3e0a('0x1d')]['length']);if(this['downloadFiles'][a21_0x3e0a('0x20')]>0x0){this[a21_0x3e0a('0x21')]();}}else{console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x22'));}}[a21_0x3e0a('0x23')](this));}[a21_0x3e0a('0x24')](){fs[a21_0x3e0a('0x25')](this[a21_0x3e0a('0xa')]);this[a21_0x3e0a('0x19')]();}[a21_0x3e0a('0x1c')](){const _0xd49b22=JSON[a21_0x3e0a('0x26')](this[a21_0x3e0a('0xf')]);try{if(!fs[a21_0x3e0a('0x27')](this[a21_0x3e0a('0xa')])){return!![];}else{const _0x4cf23e=fs[a21_0x3e0a('0x11')](this['playListFile'])['toString']();if(_0x4cf23e!=_0xd49b22){return!![];}}}catch(_0x48fc88){console[a21_0x3e0a('0x28')](_0x48fc88);}return![];}[a21_0x3e0a('0x21')](){console['log'](a21_0x3e0a('0x29')+this['currentFile']);if(this[a21_0x3e0a('0xe')]>=this[a21_0x3e0a('0x1d')]['length']){this[a21_0x3e0a('0x2a')]();return;}const _0x269b2a=String(this[a21_0x3e0a('0x1d')][this[a21_0x3e0a('0xe')]][a21_0x3e0a('0x2b')]);const _0x5adecc=_0x269b2a[a21_0x3e0a('0x2c')](_0x269b2a[a21_0x3e0a('0x2d')]('/')+0x1);console[a21_0x3e0a('0x1b')]('Downloading:\x20'+_0x5adecc);progress(request(this[a21_0x3e0a('0x14')]+_0x269b2a),{})['on'](a21_0x3e0a('0x2e'),function(_0x40dcef){console['log'](a21_0x3e0a('0x2e'),_0x40dcef[a21_0x3e0a('0x2f')]);})['on'](a21_0x3e0a('0x28'),function(_0x2dc36b){console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x30'));this[a21_0x3e0a('0x21')]();})['on'](a21_0x3e0a('0x31'),function(){console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x32')+_0x5adecc);if(isImage(_0x5adecc)){const _0x4dd17b=this[a21_0x3e0a('0x1d')][this[a21_0x3e0a('0xe')]][a21_0x3e0a('0x33')]!=null?this['downloadFiles'][this[a21_0x3e0a('0xe')]][a21_0x3e0a('0x33')]:0x1e;this[a21_0x3e0a('0x34')](_0x5adecc,_0x4dd17b);}else{this[a21_0x3e0a('0xe')]++;this[a21_0x3e0a('0x21')]();}}[a21_0x3e0a('0x23')](this))['pipe'](fs[a21_0x3e0a('0x35')](this[a21_0x3e0a('0x6')]+_0x5adecc));}[a21_0x3e0a('0x34')](_0xdb3c7,_0x3bf8be=0x1e){const _0x2c6ac6=this[a21_0x3e0a('0x6')]+_0xdb3c7;const _0x5b4784=_0xdb3c7['split']('.')[a21_0x3e0a('0x36')](0x0,-0x1)['join']('.');const _0x34f0e7='ffmpeg';const _0x182cd1=['-y','-r','1/2','-loop','1',a21_0x3e0a('0x37'),a21_0x3e0a('0x38'),'-i',_0x2c6ac6,'-t',String(_0x3bf8be),'-c:v',a21_0x3e0a('0x39'),a21_0x3e0a('0x3a'),'yuv420p','-r','25',a21_0x3e0a('0x3b'),a21_0x3e0a('0x3c'),this[a21_0x3e0a('0x6')]+_0x5b4784+'.mp4'];const _0x53bd6c=spawn(_0x34f0e7,_0x182cd1);_0x53bd6c[a21_0x3e0a('0x3d')]['on'](a21_0x3e0a('0x3e'),function(_0x94b255){console['log'](a21_0x3e0a('0x3f')+_0x2c6ac6);});_0x53bd6c['stderr']['on'](a21_0x3e0a('0x3e'),function(_0x5c8f42){console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x40')+_0x5c8f42);}[a21_0x3e0a('0x23')](this));_0x53bd6c['on'](a21_0x3e0a('0x41'),function(){console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x42'));this['currentFile']++;this[a21_0x3e0a('0x21')]();}[a21_0x3e0a('0x23')](this));}['finishProcess'](){fs[a21_0x3e0a('0x43')](this[a21_0x3e0a('0xa')],JSON[a21_0x3e0a('0x26')](this[a21_0x3e0a('0xf')]));let _0x55b29c=a21_0x3e0a('0x44')+'\x0d\x0a'+a21_0x3e0a('0x45')+'\x0d\x0a';for(const _0x4167f4 in this[a21_0x3e0a('0x1d')]){const _0x3f1310=this[a21_0x3e0a('0x1d')][_0x4167f4]['path'];const _0x1aab64=_0x3f1310['substring'](_0x3f1310['lastIndexOf']('/')+0x1);const _0x2cb4fe=_0x1aab64[a21_0x3e0a('0x46')]('.')[a21_0x3e0a('0x36')](0x0,-0x1)[a21_0x3e0a('0x47')]('.');_0x55b29c+='/home/osmc/luloclient/media/files/'+_0x2cb4fe+a21_0x3e0a('0x48')+'\x0d\x0a';}fsExtra[a21_0x3e0a('0x49')](this[a21_0x3e0a('0x8')]);fsExtra[a21_0x3e0a('0x4a')](this[a21_0x3e0a('0x6')],this[a21_0x3e0a('0x8')]);fs[a21_0x3e0a('0x43')](this[a21_0x3e0a('0xc')],_0x55b29c);fsExtra['emptyDirSync'](this[a21_0x3e0a('0x6')]);console[a21_0x3e0a('0x1b')](a21_0x3e0a('0x4b'));const _0x3dcbe0=spawn(a21_0x3e0a('0x4c'),['-r',a21_0x3e0a('0x4d')]);}}exports[a21_0x3e0a('0x4e')]=SyncPlaylistsService;