var a21_0x3f24=['fs-extra','request','child_process','spawn','is-image','string-template','media/','tempFolder','temp/','mediaFolder','files/','playListFile','playlist.txt','filesFolder','lulo_playlist.m3u','currentFile','downloadFiles','newPlayList','init','parse','config.json','baseURL','playListServiceURL','deploy/api/player_playlist.php?player_id={0}','checkFolders','ensureDir','loadMediaList','playerId','log','hasPlayListChanged','push','Total:\x20','length','No\x20playlist\x20changes','bind','reloadMediaList','unlinkSync','existsSync','readFileSync','error','download','this.currentFile:\x20','path','substring','lastIndexOf','Downloading:\x20','progress','percent','Error\x20downloading\x20file','end','duration','createImageVideo','pipe','createWriteStream','split','slice','join','ffmpeg','-loop','-pattern_type','glob','libx264','-pix_fmt','scale=1920:1080','stdout','data','close','finished\x20mp4\x20convert','finishProcess','writeFileSync','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','/home/osmc/luloclient/media/files/','copySync','m3uFile','Finished','shutdown','now','SyncPlaylistsService','defineProperty'];(function(_0x5d4cac,_0x1ec44a){var _0x1f5dc7=function(_0x5cdf16){while(--_0x5cdf16){_0x5d4cac['push'](_0x5d4cac['shift']());}};_0x1f5dc7(++_0x1ec44a);}(a21_0x3f24,0x1df));var a21_0x5775=function(_0x289bce,_0x2a485d){_0x289bce=_0x289bce-0x0;var _0x26e816=a21_0x3f24[_0x289bce];return _0x26e816;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object[a21_0x5775('0x0')](exports,'__esModule',{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x5775('0x1'));const request=require(a21_0x5775('0x2'));const progress=require('request-progress');const spawn=require(a21_0x5775('0x3'))[a21_0x5775('0x4')];const isImage=require(a21_0x5775('0x5'));const format=require(a21_0x5775('0x6'));const os=require('os');class SyncPlaylistsService{constructor(){this['mediaFolder']=a21_0x5775('0x7');this[a21_0x5775('0x8')]=this['mediaFolder']+a21_0x5775('0x9');this['filesFolder']=this[a21_0x5775('0xa')]+a21_0x5775('0xb');this[a21_0x5775('0xc')]=this[a21_0x5775('0xa')]+a21_0x5775('0xd');this['m3uFile']=this[a21_0x5775('0xe')]+a21_0x5775('0xf');this[a21_0x5775('0x10')]=0x0;this[a21_0x5775('0x11')]=[];this[a21_0x5775('0x12')]={};}[a21_0x5775('0x13')](){const _0x125ac4=JSON[a21_0x5775('0x14')](fs['readFileSync'](a21_0x5775('0x15')));this['playerId']=_0x125ac4['playerId'];this[a21_0x5775('0x16')]=process['env']['WEB_SERVICE_URL'];this[a21_0x5775('0x17')]=this['baseURL']+a21_0x5775('0x18');this[a21_0x5775('0x19')]();this['loadMediaList']();}[a21_0x5775('0x19')](){fsExtra[a21_0x5775('0x1a')](this[a21_0x5775('0xa')],_0x33d21f=>{});fsExtra[a21_0x5775('0x1a')](this[a21_0x5775('0x8')],_0x276747=>{});fsExtra[a21_0x5775('0x1a')](this['filesFolder'],_0x1444ff=>{});}[a21_0x5775('0x1b')](){const _0x276173=format(this['playListServiceURL'],this[a21_0x5775('0x1c')]);console[a21_0x5775('0x1d')](_0x276173);request({'url':_0x276173,'json':!![]},function(_0x48c577,_0xa37ff2,_0x1ca69f){this[a21_0x5775('0x12')]=_0x1ca69f;if(this[a21_0x5775('0x1e')]()){this[a21_0x5775('0x11')]=[];this[a21_0x5775('0x10')]=0x0;for(const _0x4dcd3b in _0x1ca69f){this['downloadFiles'][a21_0x5775('0x1f')](_0x1ca69f[_0x4dcd3b]);}console[a21_0x5775('0x1d')](a21_0x5775('0x20')+this['downloadFiles']['length']);if(this[a21_0x5775('0x11')][a21_0x5775('0x21')]>0x0){this['download']();}}else{console['log'](a21_0x5775('0x22'));}}[a21_0x5775('0x23')](this));}[a21_0x5775('0x24')](){fs[a21_0x5775('0x25')](this[a21_0x5775('0xc')]);this['loadMediaList']();}[a21_0x5775('0x1e')](){const _0x3ba553=JSON['stringify'](this[a21_0x5775('0x12')]);try{if(!fs[a21_0x5775('0x26')](this[a21_0x5775('0xc')])){return!![];}else{const _0x1624ec=fs[a21_0x5775('0x27')](this[a21_0x5775('0xc')])['toString']();if(_0x1624ec!=_0x3ba553){return!![];}}}catch(_0x2997ce){console[a21_0x5775('0x28')](_0x2997ce);}return![];}[a21_0x5775('0x29')](){console[a21_0x5775('0x1d')](a21_0x5775('0x2a')+this[a21_0x5775('0x10')]);if(this['currentFile']>=this[a21_0x5775('0x11')][a21_0x5775('0x21')]){this['finishProcess']();return;}const _0x53f69c=String(this[a21_0x5775('0x11')][this[a21_0x5775('0x10')]][a21_0x5775('0x2b')]);const _0x561560=_0x53f69c[a21_0x5775('0x2c')](_0x53f69c[a21_0x5775('0x2d')]('/')+0x1);console[a21_0x5775('0x1d')](a21_0x5775('0x2e')+_0x561560);progress(request(this[a21_0x5775('0x16')]+_0x53f69c),{})['on'](a21_0x5775('0x2f'),function(_0x2fbe49){console[a21_0x5775('0x1d')](a21_0x5775('0x2f'),_0x2fbe49[a21_0x5775('0x30')]);})['on'](a21_0x5775('0x28'),function(_0x437204){console[a21_0x5775('0x1d')](a21_0x5775('0x31'));this[a21_0x5775('0x29')]();})['on'](a21_0x5775('0x32'),function(){console[a21_0x5775('0x1d')]('Downloaded:\x20'+_0x561560);if(isImage(_0x561560)){const _0x484aca=this[a21_0x5775('0x11')][this[a21_0x5775('0x10')]][a21_0x5775('0x33')]!=null?this[a21_0x5775('0x11')][this[a21_0x5775('0x10')]]['duration']:0x1e;this[a21_0x5775('0x34')](_0x561560,_0x484aca);}else{this['currentFile']++;this[a21_0x5775('0x29')]();}}[a21_0x5775('0x23')](this))[a21_0x5775('0x35')](fs[a21_0x5775('0x36')](this[a21_0x5775('0x8')]+_0x561560));}[a21_0x5775('0x34')](_0x3f2027,_0xd8ed1c=0x1e){const _0x32b8af=this[a21_0x5775('0x8')]+_0x3f2027;const _0x2eb1d5=_0x3f2027[a21_0x5775('0x37')]('.')[a21_0x5775('0x38')](0x0,-0x1)[a21_0x5775('0x39')]('.');const _0x208389=a21_0x5775('0x3a');const _0x4743f1=['-y','-r','1/2',a21_0x5775('0x3b'),'1',a21_0x5775('0x3c'),a21_0x5775('0x3d'),'-i',_0x32b8af,'-t',String(_0xd8ed1c),'-c:v',a21_0x5775('0x3e'),a21_0x5775('0x3f'),'yuv420p','-r','25','-vf',a21_0x5775('0x40'),this[a21_0x5775('0x8')]+_0x2eb1d5+'.mp4'];const _0x492971=spawn(_0x208389,_0x4743f1);_0x492971[a21_0x5775('0x41')]['on']('data',function(_0x28c43e){console[a21_0x5775('0x1d')]('Converting\x20'+_0x32b8af);});_0x492971['stderr']['on'](a21_0x5775('0x42'),function(_0x300110){console[a21_0x5775('0x1d')]('stderr:\x20'+_0x300110);}[a21_0x5775('0x23')](this));_0x492971['on'](a21_0x5775('0x43'),function(){console[a21_0x5775('0x1d')](a21_0x5775('0x44'));this[a21_0x5775('0x10')]++;this['download']();}[a21_0x5775('0x23')](this));}[a21_0x5775('0x45')](){fs[a21_0x5775('0x46')](this['playListFile'],JSON['stringify'](this[a21_0x5775('0x12')]));let _0x78d07e=a21_0x5775('0x47')+'\x0d\x0a'+a21_0x5775('0x48')+'\x0d\x0a';for(const _0xeb6b66 in this['downloadFiles']){const _0x2796af=this[a21_0x5775('0x11')][_0xeb6b66][a21_0x5775('0x2b')];const _0x45a70f=_0x2796af[a21_0x5775('0x2c')](_0x2796af[a21_0x5775('0x2d')]('/')+0x1);const _0x5a9418=_0x45a70f['split']('.')[a21_0x5775('0x38')](0x0,-0x1)[a21_0x5775('0x39')]('.');_0x78d07e+=a21_0x5775('0x49')+_0x5a9418+'.mp4'+'\x0d\x0a';}fsExtra['emptyDirSync'](this[a21_0x5775('0xe')]);fsExtra[a21_0x5775('0x4a')](this[a21_0x5775('0x8')],this[a21_0x5775('0xe')]);fs[a21_0x5775('0x46')](this[a21_0x5775('0x4b')],_0x78d07e);fsExtra['emptyDirSync'](this[a21_0x5775('0x8')]);console[a21_0x5775('0x1d')](a21_0x5775('0x4c'));const _0x34a454=spawn(a21_0x5775('0x4d'),['-r',a21_0x5775('0x4e')]);}}exports[a21_0x5775('0x4f')]=SyncPlaylistsService;