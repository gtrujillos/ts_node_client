var a21_0x2ddb=['config.json','playerId','baseURL','env','WEB_SERVICE_URL','playListServiceURL','player_playlist.php?player_id={0}','checkFolders','loadMediaList','ensureDir','log','newPlayList','hasPlayListChanged','push','length','No\x20playlist\x20changes','reloadMediaList','unlinkSync','playListFile','existsSync','toString','path','lastIndexOf','Downloading:\x20','percent','error','download','end','Downloaded:\x20','duration','createImageVideo','split','join','ffmpeg','1/2','-loop','glob','-c:v','libx264','scale=1920:1080','.mp4','stdout','data','stderr:\x20','bind','close','finishProcess','stringify','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','slice','emptyDirSync','copySync','writeFileSync','shutdown','now','SyncPlaylistsService','__esModule','fs-extra','request-progress','child_process','is-image','string-template','mediaFolder','tempFolder','filesFolder','files/','playlist.txt','m3uFile','currentFile','downloadFiles','init','parse','readFileSync'];(function(_0x3d5d85,_0x52ce52){var _0x4b9406=function(_0x9ad71a){while(--_0x9ad71a){_0x3d5d85['push'](_0x3d5d85['shift']());}};_0x4b9406(++_0x52ce52);}(a21_0x2ddb,0x161));var a21_0x3eea=function(_0x54b4ae,_0x57cc4c){_0x54b4ae=_0x54b4ae-0x0;var _0x4f4845=a21_0x2ddb[_0x54b4ae];return _0x4f4845;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object['defineProperty'](exports,a21_0x3eea('0x0'),{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x3eea('0x1'));const request=require('request');const progress=require(a21_0x3eea('0x2'));const spawn=require(a21_0x3eea('0x3'))['spawn'];const isImage=require(a21_0x3eea('0x4'));const format=require(a21_0x3eea('0x5'));const os=require('os');class SyncPlaylistsService{constructor(){this[a21_0x3eea('0x6')]='media/';this[a21_0x3eea('0x7')]=this[a21_0x3eea('0x6')]+'temp/';this[a21_0x3eea('0x8')]=this[a21_0x3eea('0x6')]+a21_0x3eea('0x9');this['playListFile']=this[a21_0x3eea('0x6')]+a21_0x3eea('0xa');this[a21_0x3eea('0xb')]=this['filesFolder']+'lulo_playlist.m3u';this[a21_0x3eea('0xc')]=0x0;this[a21_0x3eea('0xd')]=[];this['newPlayList']={};}[a21_0x3eea('0xe')](){const _0x4e7a19=JSON[a21_0x3eea('0xf')](fs[a21_0x3eea('0x10')](a21_0x3eea('0x11')));this[a21_0x3eea('0x12')]=_0x4e7a19[a21_0x3eea('0x12')];this[a21_0x3eea('0x13')]=process[a21_0x3eea('0x14')][a21_0x3eea('0x15')];this[a21_0x3eea('0x16')]=this[a21_0x3eea('0x13')]+a21_0x3eea('0x17');this[a21_0x3eea('0x18')]();this[a21_0x3eea('0x19')]();}[a21_0x3eea('0x18')](){fsExtra[a21_0x3eea('0x1a')](this[a21_0x3eea('0x6')],_0x3245f6=>{});fsExtra[a21_0x3eea('0x1a')](this['tempFolder'],_0x45fc90=>{});fsExtra[a21_0x3eea('0x1a')](this[a21_0x3eea('0x8')],_0x55184c=>{});}[a21_0x3eea('0x19')](){const _0x546a06=format(this[a21_0x3eea('0x16')],this['playerId']);console[a21_0x3eea('0x1b')](_0x546a06);request({'url':_0x546a06,'json':!![]},function(_0x12f4f1,_0x6193c6,_0x4cf34a){this[a21_0x3eea('0x1c')]=_0x4cf34a;if(this[a21_0x3eea('0x1d')]()){this[a21_0x3eea('0xd')]=[];this[a21_0x3eea('0xc')]=0x0;for(const _0x28b6c8 in _0x4cf34a){this['downloadFiles'][a21_0x3eea('0x1e')](_0x4cf34a[_0x28b6c8]);}console[a21_0x3eea('0x1b')]('Total:\x20'+this['downloadFiles'][a21_0x3eea('0x1f')]);if(this[a21_0x3eea('0xd')]['length']>0x0){this['download']();}}else{console[a21_0x3eea('0x1b')](a21_0x3eea('0x20'));}}['bind'](this));}[a21_0x3eea('0x21')](){fs[a21_0x3eea('0x22')](this[a21_0x3eea('0x23')]);this[a21_0x3eea('0x19')]();}[a21_0x3eea('0x1d')](){const _0x3f07cc=JSON['stringify'](this['newPlayList']);try{if(!fs[a21_0x3eea('0x24')](this[a21_0x3eea('0x23')])){return!![];}else{const _0x43256b=fs[a21_0x3eea('0x10')](this['playListFile'])[a21_0x3eea('0x25')]();if(_0x43256b!=_0x3f07cc){return!![];}}}catch(_0x244bea){console['error'](_0x244bea);}return![];}['download'](){console[a21_0x3eea('0x1b')]('this.currentFile:\x20'+this['currentFile']);if(this[a21_0x3eea('0xc')]>=this[a21_0x3eea('0xd')][a21_0x3eea('0x1f')]){this['finishProcess']();return;}const _0x26e900=String(this[a21_0x3eea('0xd')][this['currentFile']][a21_0x3eea('0x26')]);const _0x2746ea=_0x26e900['substring'](_0x26e900[a21_0x3eea('0x27')]('/')+0x1);console[a21_0x3eea('0x1b')](a21_0x3eea('0x28')+_0x2746ea);progress(request(this[a21_0x3eea('0x13')]+_0x26e900),{})['on']('progress',function(_0x2c254a){console[a21_0x3eea('0x1b')]('progress',_0x2c254a[a21_0x3eea('0x29')]);})['on'](a21_0x3eea('0x2a'),function(_0x1dcc72){console[a21_0x3eea('0x1b')]('Error\x20downloading\x20file');this[a21_0x3eea('0x2b')]();})['on'](a21_0x3eea('0x2c'),function(){console[a21_0x3eea('0x1b')](a21_0x3eea('0x2d')+_0x2746ea);if(isImage(_0x2746ea)){const _0x272ed6=this[a21_0x3eea('0xd')][this['currentFile']][a21_0x3eea('0x2e')]!=null?this[a21_0x3eea('0xd')][this[a21_0x3eea('0xc')]]['duration']:0x1e;this[a21_0x3eea('0x2f')](_0x2746ea,_0x272ed6);}else{this['currentFile']++;this[a21_0x3eea('0x2b')]();}}['bind'](this))['pipe'](fs['createWriteStream'](this[a21_0x3eea('0x7')]+_0x2746ea));}[a21_0x3eea('0x2f')](_0x25dad5,_0x10c5aa=0x1e){const _0x37b959=this[a21_0x3eea('0x7')]+_0x25dad5;const _0xff66fe=_0x25dad5[a21_0x3eea('0x30')]('.')['slice'](0x0,-0x1)[a21_0x3eea('0x31')]('.');const _0x505244=a21_0x3eea('0x32');const _0x49b439=['-y','-r',a21_0x3eea('0x33'),a21_0x3eea('0x34'),'1','-pattern_type',a21_0x3eea('0x35'),'-i',_0x37b959,'-t',String(_0x10c5aa),a21_0x3eea('0x36'),a21_0x3eea('0x37'),'-pix_fmt','yuv420p','-r','25','-vf',a21_0x3eea('0x38'),this['tempFolder']+_0xff66fe+a21_0x3eea('0x39')];const _0x4ddd99=spawn(_0x505244,_0x49b439);_0x4ddd99[a21_0x3eea('0x3a')]['on'](a21_0x3eea('0x3b'),function(_0x2de5ab){console[a21_0x3eea('0x1b')]('Converting\x20'+_0x37b959);});_0x4ddd99['stderr']['on'](a21_0x3eea('0x3b'),function(_0x2eabad){console[a21_0x3eea('0x1b')](a21_0x3eea('0x3c')+_0x2eabad);}[a21_0x3eea('0x3d')](this));_0x4ddd99['on'](a21_0x3eea('0x3e'),function(){console[a21_0x3eea('0x1b')]('finished\x20mp4\x20convert');this[a21_0x3eea('0xc')]++;this[a21_0x3eea('0x2b')]();}[a21_0x3eea('0x3d')](this));}[a21_0x3eea('0x3f')](){fs['writeFileSync'](this[a21_0x3eea('0x23')],JSON[a21_0x3eea('0x40')](this[a21_0x3eea('0x1c')]));let _0x1bc823=a21_0x3eea('0x41')+'\x0d\x0a'+a21_0x3eea('0x42')+'\x0d\x0a';for(const _0x7cee1d in this[a21_0x3eea('0xd')]){const _0x4e15f3=this[a21_0x3eea('0xd')][_0x7cee1d][a21_0x3eea('0x26')];const _0x5560b4=_0x4e15f3['substring'](_0x4e15f3[a21_0x3eea('0x27')]('/')+0x1);const _0x1aaacf=_0x5560b4[a21_0x3eea('0x30')]('.')[a21_0x3eea('0x43')](0x0,-0x1)[a21_0x3eea('0x31')]('.');_0x1bc823+='/home/osmc/luloclient/media/files/'+_0x1aaacf+a21_0x3eea('0x39')+'\x0d\x0a';}fsExtra[a21_0x3eea('0x44')](this['filesFolder']);fsExtra[a21_0x3eea('0x45')](this[a21_0x3eea('0x7')],this[a21_0x3eea('0x8')]);fs[a21_0x3eea('0x46')](this[a21_0x3eea('0xb')],_0x1bc823);fsExtra[a21_0x3eea('0x44')](this['tempFolder']);console[a21_0x3eea('0x1b')]('Finished');const _0x1eaae0=spawn(a21_0x3eea('0x47'),['-r',a21_0x3eea('0x48')]);}}exports[a21_0x3eea('0x49')]=SyncPlaylistsService;