var a21_0x2a26=['error','finishProcess','path','substring','lastIndexOf','Downloading:\x20','progress','percent','Error\x20downloading\x20file','end','duration','createImageVideo','createWriteStream','split','slice','join','ffmpeg','1/2','-loop','-pattern_type','glob','-c:v','-pix_fmt','yuv420p','-vf','scale=1920:1080','.mp4','stdout','Converting\x20','stderr','stderr:\x20','close','writeFileSync','#EXTCPlayListM3U::M3U','emptyDirSync','Finished','shutdown','now','SyncPlaylistsService','fs-extra','request','child_process','spawn','is-image','string-template','mediaFolder','media/','tempFolder','temp/','filesFolder','files/','playListFile','playlist.txt','m3uFile','newPlayList','parse','readFileSync','config.json','playerId','baseURL','env','WEB_SERVICE_URL','player_playlist.php?player_id={0}','checkFolders','ensureDir','loadMediaList','playListServiceURL','log','downloadFiles','currentFile','push','Total:\x20','length','download','No\x20playlist\x20changes','bind','unlinkSync','hasPlayListChanged','stringify','existsSync','toString'];(function(_0x52527b,_0x9cb409){var _0x1f05f0=function(_0x908f76){while(--_0x908f76){_0x52527b['push'](_0x52527b['shift']());}};_0x1f05f0(++_0x9cb409);}(a21_0x2a26,0x16b));var a21_0x1a22=function(_0x498582,_0x1d2355){_0x498582=_0x498582-0x0;var _0x26149e=a21_0x2a26[_0x498582];return _0x26149e;};'use strict';// import { StationContext } from '../infrastructure/stationSettings';
             // import { cat } from 'shelljs';
             // import { NetworkInfo } from 'simple-ifconfig';
Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=require('fs');const fsExtra=require(a21_0x1a22('0x0'));const request=require(a21_0x1a22('0x1'));const progress=require('request-progress');const spawn=require(a21_0x1a22('0x2'))[a21_0x1a22('0x3')];const isImage=require(a21_0x1a22('0x4'));const format=require(a21_0x1a22('0x5'));const os=require('os');class SyncPlaylistsService{constructor(){this[a21_0x1a22('0x6')]=a21_0x1a22('0x7');this[a21_0x1a22('0x8')]=this['mediaFolder']+a21_0x1a22('0x9');this[a21_0x1a22('0xa')]=this[a21_0x1a22('0x6')]+a21_0x1a22('0xb');this[a21_0x1a22('0xc')]=this[a21_0x1a22('0x6')]+a21_0x1a22('0xd');this[a21_0x1a22('0xe')]=this[a21_0x1a22('0xa')]+'lulo_playlist.m3u';this['currentFile']=0x0;this['downloadFiles']=[];this[a21_0x1a22('0xf')]={};}['init'](){const _0x3d7471=JSON[a21_0x1a22('0x10')](fs[a21_0x1a22('0x11')](a21_0x1a22('0x12')));this['playerId']=_0x3d7471[a21_0x1a22('0x13')];this[a21_0x1a22('0x14')]=process[a21_0x1a22('0x15')][a21_0x1a22('0x16')];this['playListServiceURL']=this['baseURL']+a21_0x1a22('0x17');this[a21_0x1a22('0x18')]();this['loadMediaList']();}['checkFolders'](){fsExtra[a21_0x1a22('0x19')](this['mediaFolder'],_0x5c1d35=>{});fsExtra[a21_0x1a22('0x19')](this[a21_0x1a22('0x8')],_0x13f310=>{});fsExtra[a21_0x1a22('0x19')](this[a21_0x1a22('0xa')],_0x6e84e8=>{});}[a21_0x1a22('0x1a')](){const _0x5b0bc9=format(this[a21_0x1a22('0x1b')],this[a21_0x1a22('0x13')]);console[a21_0x1a22('0x1c')](_0x5b0bc9);request({'url':_0x5b0bc9,'json':!![]},function(_0x320508,_0x5038ad,_0x5d398d){this['newPlayList']=_0x5d398d;if(this['hasPlayListChanged']()){this[a21_0x1a22('0x1d')]=[];this[a21_0x1a22('0x1e')]=0x0;for(const _0xbc4fb1 in _0x5d398d){this[a21_0x1a22('0x1d')][a21_0x1a22('0x1f')](_0x5d398d[_0xbc4fb1]);}console[a21_0x1a22('0x1c')](a21_0x1a22('0x20')+this[a21_0x1a22('0x1d')]['length']);if(this[a21_0x1a22('0x1d')][a21_0x1a22('0x21')]>0x0){this[a21_0x1a22('0x22')]();}}else{console[a21_0x1a22('0x1c')](a21_0x1a22('0x23'));}}[a21_0x1a22('0x24')](this));}['reloadMediaList'](){fs[a21_0x1a22('0x25')](this['playListFile']);this[a21_0x1a22('0x1a')]();}[a21_0x1a22('0x26')](){const _0x518092=JSON[a21_0x1a22('0x27')](this[a21_0x1a22('0xf')]);try{if(!fs[a21_0x1a22('0x28')](this[a21_0x1a22('0xc')])){return!![];}else{const _0x4b7f4c=fs['readFileSync'](this[a21_0x1a22('0xc')])[a21_0x1a22('0x29')]();if(_0x4b7f4c!=_0x518092){return!![];}}}catch(_0x1e2a70){console[a21_0x1a22('0x2a')](_0x1e2a70);}return![];}[a21_0x1a22('0x22')](){console[a21_0x1a22('0x1c')]('this.currentFile:\x20'+this['currentFile']);if(this[a21_0x1a22('0x1e')]>=this[a21_0x1a22('0x1d')][a21_0x1a22('0x21')]){this[a21_0x1a22('0x2b')]();return;}const _0x4b4120=String(this[a21_0x1a22('0x1d')][this[a21_0x1a22('0x1e')]][a21_0x1a22('0x2c')]);const _0x190f49=_0x4b4120[a21_0x1a22('0x2d')](_0x4b4120[a21_0x1a22('0x2e')]('/')+0x1);console[a21_0x1a22('0x1c')](a21_0x1a22('0x2f')+_0x190f49);progress(request(this[a21_0x1a22('0x14')]+_0x4b4120),{})['on'](a21_0x1a22('0x30'),function(_0x5e99cb){console['log'](a21_0x1a22('0x30'),_0x5e99cb[a21_0x1a22('0x31')]);})['on'](a21_0x1a22('0x2a'),function(_0x34ae7d){console[a21_0x1a22('0x1c')](a21_0x1a22('0x32'));this[a21_0x1a22('0x22')]();})['on'](a21_0x1a22('0x33'),function(){console[a21_0x1a22('0x1c')]('Downloaded:\x20'+_0x190f49);if(isImage(_0x190f49)){const _0x37502e=this[a21_0x1a22('0x1d')][this[a21_0x1a22('0x1e')]][a21_0x1a22('0x34')]!=null?this[a21_0x1a22('0x1d')][this[a21_0x1a22('0x1e')]][a21_0x1a22('0x34')]:0x1e;this[a21_0x1a22('0x35')](_0x190f49,_0x37502e);}else{this[a21_0x1a22('0x1e')]++;this['download']();}}[a21_0x1a22('0x24')](this))['pipe'](fs[a21_0x1a22('0x36')](this['tempFolder']+_0x190f49));}[a21_0x1a22('0x35')](_0x2524dc,_0x4ddbc2=0x1e){const _0x4e3900=this[a21_0x1a22('0x8')]+_0x2524dc;const _0x1c7b65=_0x2524dc[a21_0x1a22('0x37')]('.')[a21_0x1a22('0x38')](0x0,-0x1)[a21_0x1a22('0x39')]('.');const _0x430424=a21_0x1a22('0x3a');const _0x321706=['-y','-r',a21_0x1a22('0x3b'),a21_0x1a22('0x3c'),'1',a21_0x1a22('0x3d'),a21_0x1a22('0x3e'),'-i',_0x4e3900,'-t',String(_0x4ddbc2),a21_0x1a22('0x3f'),'libx264',a21_0x1a22('0x40'),a21_0x1a22('0x41'),'-r','25',a21_0x1a22('0x42'),a21_0x1a22('0x43'),this['tempFolder']+_0x1c7b65+a21_0x1a22('0x44')];const _0x223a72=spawn(_0x430424,_0x321706);_0x223a72[a21_0x1a22('0x45')]['on']('data',function(_0x57538e){console[a21_0x1a22('0x1c')](a21_0x1a22('0x46')+_0x4e3900);});_0x223a72[a21_0x1a22('0x47')]['on']('data',function(_0x1d9a07){console[a21_0x1a22('0x1c')](a21_0x1a22('0x48')+_0x1d9a07);}[a21_0x1a22('0x24')](this));_0x223a72['on'](a21_0x1a22('0x49'),function(){console[a21_0x1a22('0x1c')]('finished\x20mp4\x20convert');this[a21_0x1a22('0x1e')]++;this['download']();}[a21_0x1a22('0x24')](this));}[a21_0x1a22('0x2b')](){fs[a21_0x1a22('0x4a')](this[a21_0x1a22('0xc')],JSON[a21_0x1a22('0x27')](this[a21_0x1a22('0xf')]));let _0x26303f=a21_0x1a22('0x4b')+'\x0d\x0a'+'#EXTINF:0,luloPlayList'+'\x0d\x0a';for(const _0x4f4f4e in this['downloadFiles']){const _0xedc658=this[a21_0x1a22('0x1d')][_0x4f4f4e]['path'];const _0x20491f=_0xedc658[a21_0x1a22('0x2d')](_0xedc658['lastIndexOf']('/')+0x1);const _0x24bba2=_0x20491f[a21_0x1a22('0x37')]('.')[a21_0x1a22('0x38')](0x0,-0x1)[a21_0x1a22('0x39')]('.');_0x26303f+='/home/osmc/luloclient/media/files/'+_0x24bba2+'.mp4'+'\x0d\x0a';}fsExtra[a21_0x1a22('0x4c')](this[a21_0x1a22('0xa')]);fsExtra['copySync'](this['tempFolder'],this[a21_0x1a22('0xa')]);fs[a21_0x1a22('0x4a')](this[a21_0x1a22('0xe')],_0x26303f);fsExtra[a21_0x1a22('0x4c')](this[a21_0x1a22('0x8')]);console[a21_0x1a22('0x1c')](a21_0x1a22('0x4d'));const _0x5ebd59=spawn(a21_0x1a22('0x4e'),['-r',a21_0x1a22('0x4f')]);}}exports[a21_0x1a22('0x50')]=SyncPlaylistsService;