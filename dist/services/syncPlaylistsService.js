var a22_0x1ddb=['stderr:\x20','finished\x20mp4\x20convert','downloadYouTube','http://www.youtube.com/watch?v=','--format=18','info','_filename','size:\x20','complete','filename:\x20','\x20already\x20downloaded.','finished\x20youtube\x20downloading!','.mp4','#EXTCPlayListM3U::M3U','#EXTINF:0,luloPlayList','Finished','now','SyncPlaylistsService','__esModule','../infrastructure/HttpClientService','url','http','request','spawn','is-image','string-template','youtube-dl','uuid/v4','context.json','mt-files-downloader','media/','tempFolder','mediaFolder','filesFolder','files/','m3uFile','currentFile','downloadFiles','newPlayList','httpClientService','init','config','readFileSync','context','playerId','baseURL','env','WEB_SERVICE_URL','deploy/','playListServiceURL','api/player_playlist.php?player_id={0}','registerClient','loadMediaList','deviceUuid','writeFileSync','stringify','networkInterfaces','http://restapi.lulo.run/player_devices/register','then','log','parsedBody','catch','checkFolders','ensureDir','hasPlayListChanged','emptyDirSync','push','Total:\x20','length','No\x20playlist\x20changes','bind','reloadMediaList','playListFile','removeSync','existsSync','toString','finishProcess','path','media_type','substring','Downloading:\x20','youtube_single','downloader','downloading:\x20','download','start','error','end','Downloaded:\x20','mediaType:\x20','image','duration','createImageVideo','video','stopped','destroyed','retry','downloadHTTPFile','Attempting\x20to\x20download\x20','\x20to\x20','Max\x20redirects\x20reached','maxSockets','host','parse','pathname','get','\x20Progress:\x20unknown\x09','\x20Progress:\x20','statusCode','headers','content-length','Have\x20already\x20downloaded\x20','size','Redownloading','But\x20the\x20file\x20size\x20does\x20not\x20match\x20so\x20re-downloading\x20Old(',')\x20vs\x20New(','createWriteStream','data','err:\x20','finish','Downloaded\x20','location','Redirect\x20','302','File\x20Not\x20Found\x20','Problem\x20downloading\x20','\x20STATUS:\x20','message','downloadHTTPFileCallback','downloadRequestFile','progress','Error\x20downloading\x20file','pipe','split','slice','join','1/2','-loop','-pattern_type','-c:v','libx264','yuv420p','-vf','scale=1920:1080','stdout','Converting\x20','stderr'];(function(_0x46e032,_0x497605){var _0x5f39fc=function(_0xb543c5){while(--_0xb543c5){_0x46e032['push'](_0x46e032['shift']());}};_0x5f39fc(++_0x497605);}(a22_0x1ddb,0xa5));var a22_0x5d3b=function(_0x29ece2,_0x378665){_0x29ece2=_0x29ece2-0x0;var _0x215f5f=a22_0x1ddb[_0x29ece2];return _0x215f5f;};'use strict';Object['defineProperty'](exports,a22_0x5d3b('0x0'),{'value':!![]});const HttpClientService_1=require(a22_0x5d3b('0x1'));const fs=require('fs');const url=require(a22_0x5d3b('0x2'));const http=require(a22_0x5d3b('0x3'));const fsExtra=require('fs-extra');const request=require(a22_0x5d3b('0x4'));const progress=require('request-progress');const spawn=require('child_process')[a22_0x5d3b('0x5')];const isImage=require(a22_0x5d3b('0x6'));const format=require(a22_0x5d3b('0x7'));const os=require('os');const youtubedl=require(a22_0x5d3b('0x8'));const uuidv4=require(a22_0x5d3b('0x9'));const configFile='config.json';const contextFile=a22_0x5d3b('0xa');const Downloader=require(a22_0x5d3b('0xb'));class SyncPlaylistsService{constructor(){this['mediaFolder']=a22_0x5d3b('0xc');this[a22_0x5d3b('0xd')]=this[a22_0x5d3b('0xe')]+'temp/';this[a22_0x5d3b('0xf')]=this[a22_0x5d3b('0xe')]+a22_0x5d3b('0x10');this['playListFile']=this[a22_0x5d3b('0xe')]+'playlist.txt';this[a22_0x5d3b('0x11')]=this[a22_0x5d3b('0xf')]+'lulo_playlist.m3u';this[a22_0x5d3b('0x12')]=0x0;this[a22_0x5d3b('0x13')]=[];this[a22_0x5d3b('0x14')]={};this[a22_0x5d3b('0x15')]=new HttpClientService_1['HttpClientService']();}[a22_0x5d3b('0x16')](){this[a22_0x5d3b('0x17')]=JSON['parse'](fs[a22_0x5d3b('0x18')](configFile));this[a22_0x5d3b('0x19')]=JSON['parse'](fs[a22_0x5d3b('0x18')](contextFile));this[a22_0x5d3b('0x1a')]=this[a22_0x5d3b('0x17')][a22_0x5d3b('0x1a')];this[a22_0x5d3b('0x1b')]=process[a22_0x5d3b('0x1c')][a22_0x5d3b('0x1d')]+a22_0x5d3b('0x1e');this[a22_0x5d3b('0x1f')]=this['baseURL']+a22_0x5d3b('0x20');this[a22_0x5d3b('0x21')]();this['checkFolders']();this[a22_0x5d3b('0x22')]();}[a22_0x5d3b('0x21')](){const _0x475f3b=this['config'][a22_0x5d3b('0x23')];if(!_0x475f3b||_0x475f3b==''){this[a22_0x5d3b('0x17')][a22_0x5d3b('0x23')]=uuidv4();this[a22_0x5d3b('0x17')]={'deviceUuid':this['config']['deviceUuid'],'playerId':this[a22_0x5d3b('0x17')]['playerId']};fs[a22_0x5d3b('0x24')](configFile,JSON[a22_0x5d3b('0x25')](this[a22_0x5d3b('0x17')]));}const _0x9a8e3e={'player_id':this[a22_0x5d3b('0x1a')],'device_uuid':this[a22_0x5d3b('0x17')][a22_0x5d3b('0x23')],'network_info':JSON[a22_0x5d3b('0x25')](os[a22_0x5d3b('0x26')]()),'firmware_info':JSON[a22_0x5d3b('0x25')](this[a22_0x5d3b('0x19')]),'status':0x1};this[a22_0x5d3b('0x15')]['post'](a22_0x5d3b('0x27'),_0x9a8e3e,![])[a22_0x5d3b('0x28')](function(_0x380a65){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x2a'));console[a22_0x5d3b('0x29')](_0x380a65);})[a22_0x5d3b('0x2b')](function(_0x891a06){});}[a22_0x5d3b('0x2c')](){fsExtra['ensureDir'](this[a22_0x5d3b('0xe')],_0x5cf63a=>{});fsExtra[a22_0x5d3b('0x2d')](this[a22_0x5d3b('0xd')],_0x25463e=>{});fsExtra[a22_0x5d3b('0x2d')](this['filesFolder'],_0xbd1c26=>{});}[a22_0x5d3b('0x22')](){const _0x557346=format(this[a22_0x5d3b('0x1f')],this['playerId']);console[a22_0x5d3b('0x29')](_0x557346);request({'url':_0x557346,'json':!![]},function(_0x3251b9,_0x160a9e,_0x5f582f){console[a22_0x5d3b('0x29')](_0x5f582f);this[a22_0x5d3b('0x14')]=_0x5f582f;if(this[a22_0x5d3b('0x2e')]()){fsExtra[a22_0x5d3b('0x2f')](this['tempFolder']);this[a22_0x5d3b('0x13')]=[];this[a22_0x5d3b('0x12')]=0x0;for(const _0x462b91 in _0x5f582f){this[a22_0x5d3b('0x13')][a22_0x5d3b('0x30')](_0x5f582f[_0x462b91]);}console[a22_0x5d3b('0x29')](a22_0x5d3b('0x31')+this[a22_0x5d3b('0x13')][a22_0x5d3b('0x32')]);if(this[a22_0x5d3b('0x13')][a22_0x5d3b('0x32')]>0x0){this['download']();}}else{console[a22_0x5d3b('0x29')](a22_0x5d3b('0x33'));}}[a22_0x5d3b('0x34')](this));}[a22_0x5d3b('0x35')](){if(fsExtra['existsSync'](this[a22_0x5d3b('0x36')])){fsExtra[a22_0x5d3b('0x37')](this[a22_0x5d3b('0x36')]);}this['loadMediaList']();}[a22_0x5d3b('0x2e')](){const _0x3475e4=JSON['stringify'](this[a22_0x5d3b('0x14')]);try{if(!fs[a22_0x5d3b('0x38')](this[a22_0x5d3b('0x36')])){return!![];}else{const _0x4571b6=fs[a22_0x5d3b('0x18')](this[a22_0x5d3b('0x36')])[a22_0x5d3b('0x39')]();if(_0x4571b6!=_0x3475e4){return!![];}}}catch(_0x3d9b26){console['error'](_0x3d9b26);}return![];}['download'](){console['log']('this.currentFile:\x20'+this['currentFile']);if(this[a22_0x5d3b('0x12')]>=this['downloadFiles'][a22_0x5d3b('0x32')]){this[a22_0x5d3b('0x3a')]();return;}const _0x3a42c1=String(this[a22_0x5d3b('0x13')][this['currentFile']][a22_0x5d3b('0x3b')]);const _0x24860e=this['downloadFiles'][this[a22_0x5d3b('0x12')]][a22_0x5d3b('0x3c')];const _0x34f404=_0x3a42c1[a22_0x5d3b('0x3d')](_0x3a42c1['lastIndexOf']('/')+0x1);const _0x2c2aeb=this[a22_0x5d3b('0x1b')]+_0x3a42c1;console[a22_0x5d3b('0x29')](a22_0x5d3b('0x3e')+_0x2c2aeb);if(_0x24860e==a22_0x5d3b('0x3f')){this['downloadYouTube'](_0x3a42c1);}else{this[a22_0x5d3b('0x40')](_0x2c2aeb,_0x34f404,_0x24860e);}}[a22_0x5d3b('0x40')](_0x2867e1,_0x1f7d2e,_0x32bfa9){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x41')+_0x2867e1);const _0x32d7ea=new Downloader();console['log'](_0x2867e1);console['log'](_0x1f7d2e);console[a22_0x5d3b('0x29')](_0x32bfa9);const _0x583cb0=_0x32d7ea[a22_0x5d3b('0x42')](_0x2867e1,this[a22_0x5d3b('0xd')]+_0x1f7d2e);_0x583cb0[a22_0x5d3b('0x43')]();_0x583cb0['on']('start',function(_0x583cb0){console['log']('start:\x20'+_0x2867e1);});_0x583cb0['on']('error',function(_0x583cb0){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x44'));this[a22_0x5d3b('0x42')]();}[a22_0x5d3b('0x34')](this));_0x583cb0['on'](a22_0x5d3b('0x45'),function(_0x583cb0){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x45'));console['log'](a22_0x5d3b('0x46')+_0x1f7d2e);console['log'](a22_0x5d3b('0x47')+_0x32bfa9);if(_0x32bfa9==a22_0x5d3b('0x48')){const _0x41df08=this[a22_0x5d3b('0x13')][this[a22_0x5d3b('0x12')]][a22_0x5d3b('0x49')]!=null?this['downloadFiles'][this[a22_0x5d3b('0x12')]][a22_0x5d3b('0x49')]:0x1e;this[a22_0x5d3b('0x4a')](_0x1f7d2e,_0x41df08);}else if(_0x32bfa9==a22_0x5d3b('0x4b')){this[a22_0x5d3b('0x12')]++;this[a22_0x5d3b('0x42')]();}}['bind'](this));_0x583cb0['on'](a22_0x5d3b('0x4c'),function(_0x583cb0){console['log']('stopped');});_0x583cb0['on'](a22_0x5d3b('0x4d'),function(_0x583cb0){console['log'](a22_0x5d3b('0x4d'));});_0x583cb0['on'](a22_0x5d3b('0x4e'),function(_0x583cb0){console['log'](a22_0x5d3b('0x4e'));});}[a22_0x5d3b('0x4f')](_0x155253,_0x2ca6c1,_0x3ca983,_0x5dec67){console['log'](a22_0x5d3b('0x4f'));console[a22_0x5d3b('0x29')](_0x155253);const _0x531d10=!![];let _0x136f65=0x0;const _0x26ab54='';console[a22_0x5d3b('0x29')](a22_0x5d3b('0x50')+_0x155253+a22_0x5d3b('0x51')+_0x2ca6c1);if(_0x136f65){if(_0x136f65>0x5){_0x5dec67(a22_0x5d3b('0x52'),_0x155253,_0x3ca983,null);return;}}else{_0x136f65=0x0;}const _0x11eb09=this[a22_0x5d3b('0xd')]+_0x2ca6c1;let _0x12beab;if(_0x5dec67===undefined){console[a22_0x5d3b('0x29')]('WARNING\x20downloadFile\x20callback\x20is\x20undefined\x20for\x20'+_0x155253+'\x20to\x20'+_0x11eb09);_0x5dec67=function(_0x2f3ae6,_0x259fda){console[a22_0x5d3b('0x29')]('downloadFile\x20callback\x20result\x20undefined:\x20',_0x2f3ae6,_0x259fda);};}http['globalAgent'][a22_0x5d3b('0x53')]=0x64;const _0xdbf91f={'host':url['parse'](_0x155253)[a22_0x5d3b('0x54')],'port':0x50,'path':url[a22_0x5d3b('0x55')](_0x155253)[a22_0x5d3b('0x56')],'agent':![]};const _0xd02919=http[a22_0x5d3b('0x57')](_0xdbf91f,function(_0x2a44d6){let _0x1ae388=0x0;let _0xf9e36f=0x0;function _0x4ddf6b(){if(_0x1ae388===undefined){console[a22_0x5d3b('0x29')](_0x2ca6c1+a22_0x5d3b('0x58')+_0xf9e36f+'/'+'?');}const _0x3ec709=_0xf9e36f/_0x1ae388*0x64;console['log'](_0x2ca6c1+a22_0x5d3b('0x59')+_0x3ec709+'%\x09'+_0xf9e36f+'/'+_0x1ae388);}console[a22_0x5d3b('0x29')](_0x2ca6c1+'\x20'+_0x2a44d6[a22_0x5d3b('0x5a')]);switch(_0x2a44d6['statusCode']){case 0xc8:_0x1ae388=_0x2a44d6[a22_0x5d3b('0x5b')][a22_0x5d3b('0x5c')]||_0x26ab54;fs['stat'](_0x11eb09,function(_0x4c0b09,_0x58ea52){if(!_0x4c0b09){console['log'](a22_0x5d3b('0x5d')+_0x11eb09);if(_0x58ea52[a22_0x5d3b('0x5e')]==_0x1ae388){console[a22_0x5d3b('0x29')]('And\x20the\x20file\x20size\x20matches\x20('+_0x1ae388+')');console[a22_0x5d3b('0x29')](a22_0x5d3b('0x5f'));}else{console['log'](a22_0x5d3b('0x60')+_0x58ea52[a22_0x5d3b('0x5e')]+a22_0x5d3b('0x61')+_0x1ae388+')');}}_0x12beab=fs[a22_0x5d3b('0x62')](_0x11eb09);_0x2a44d6['pipe'](_0x12beab);_0x2a44d6['on'](a22_0x5d3b('0x63'),function(_0x40e6e3){_0xf9e36f+=_0x40e6e3['length'];_0x4ddf6b();});_0xd02919['on'](a22_0x5d3b('0x44'),function(_0x4c0b09){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x64'));console[a22_0x5d3b('0x29')](_0x4c0b09);});_0x12beab['on'](a22_0x5d3b('0x65'),function(){console['log'](a22_0x5d3b('0x66')+_0x155253+'\x20to\x20'+_0x2ca6c1);_0x5dec67(null,_0x2ca6c1,_0x3ca983,_0x2ca6c1);}[a22_0x5d3b('0x34')](this));});break;case 0x12e:const _0x176a28=_0x2a44d6['headers'][a22_0x5d3b('0x67')];console[a22_0x5d3b('0x29')](a22_0x5d3b('0x68')+_0x155253+a22_0x5d3b('0x51')+_0x176a28);if(_0x136f65<0x5){this[a22_0x5d3b('0x4f')](_0x176a28,_0x2ca6c1,_0x5dec67,_0x136f65++);}else{console[a22_0x5d3b('0x44')]('Redirect\x20limit\x20encountered\x20for\x20'+_0x155253+'.');_0x5dec67(a22_0x5d3b('0x69'),null,null,null);}return;case 0x194:console[a22_0x5d3b('0x29')](a22_0x5d3b('0x6a')+_0x155253);default:console['log'](a22_0x5d3b('0x6b')+_0x155253+a22_0x5d3b('0x6c')+_0x2a44d6[a22_0x5d3b('0x5a')]);_0xd02919['abort']();_0x5dec67(_0x2a44d6[a22_0x5d3b('0x5a')],null,null,null);return;}})['on'](a22_0x5d3b('0x44'),function(_0x1fbf76){console[a22_0x5d3b('0x29')]('Error\x20Downloading:\x20'+_0x155253+'\x20'+_0x1fbf76[a22_0x5d3b('0x6d')]);_0x5dec67(_0x1fbf76,null,null,null);});}[a22_0x5d3b('0x6e')](_0x3c362f,_0x59a19d,_0x1c4942,_0x20af65){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x6e'));console['log'](_0x3c362f);console['log'](_0x59a19d);console[a22_0x5d3b('0x29')](_0x1c4942);console[a22_0x5d3b('0x29')](_0x20af65);if(_0x1c4942==a22_0x5d3b('0x48')){const _0x421cc5=this[a22_0x5d3b('0x13')][this[a22_0x5d3b('0x12')]][a22_0x5d3b('0x49')]!=null?this[a22_0x5d3b('0x13')][this['currentFile']][a22_0x5d3b('0x49')]:0x1e;this['createImageVideo'](_0x20af65,_0x421cc5);}else if(_0x1c4942==a22_0x5d3b('0x4b')){if(_0x3c362f==null&&_0x59a19d!=''){this[a22_0x5d3b('0x12')]++;}this[a22_0x5d3b('0x42')]();}console[a22_0x5d3b('0x29')](this[a22_0x5d3b('0x12')]);}[a22_0x5d3b('0x6f')](_0x25e720,_0x2c2636,_0x2175d6){progress(request(_0x25e720),{})['on'](a22_0x5d3b('0x70'),function(_0x35035b){console[a22_0x5d3b('0x29')](_0x35035b);})['on'](a22_0x5d3b('0x44'),function(_0x3011fc){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x71'));this[a22_0x5d3b('0x42')]();})['on'](a22_0x5d3b('0x45'),function(){console[a22_0x5d3b('0x29')]('Downloaded:\x20'+_0x2c2636);console['log'](a22_0x5d3b('0x47')+_0x2175d6);if(_0x2175d6=='image'){const _0x2cab90=this[a22_0x5d3b('0x13')][this['currentFile']]['duration']!=null?this[a22_0x5d3b('0x13')][this[a22_0x5d3b('0x12')]][a22_0x5d3b('0x49')]:0x1e;this[a22_0x5d3b('0x4a')](_0x2c2636,_0x2cab90);}else if(_0x2175d6==a22_0x5d3b('0x4b')){this[a22_0x5d3b('0x12')]++;this[a22_0x5d3b('0x42')]();}}[a22_0x5d3b('0x34')](this))[a22_0x5d3b('0x72')](fs['createWriteStream'](this[a22_0x5d3b('0xd')]+_0x2c2636));}[a22_0x5d3b('0x4a')](_0x5bb2f2,_0x130a27=0x1e){const _0x208993=this['tempFolder']+_0x5bb2f2;console['log'](_0x208993);console[a22_0x5d3b('0x29')](_0x5bb2f2);const _0x4dfc75=_0x5bb2f2[a22_0x5d3b('0x73')]('.')[a22_0x5d3b('0x74')](0x0,-0x1)[a22_0x5d3b('0x75')]('.');const _0x2a4102='ffmpeg';const _0x4ee72c=['-y','-r',a22_0x5d3b('0x76'),a22_0x5d3b('0x77'),'1',a22_0x5d3b('0x78'),'glob','-i',_0x208993,'-t',String(_0x130a27),a22_0x5d3b('0x79'),a22_0x5d3b('0x7a'),'-pix_fmt',a22_0x5d3b('0x7b'),'-r','25',a22_0x5d3b('0x7c'),a22_0x5d3b('0x7d'),this[a22_0x5d3b('0xd')]+_0x4dfc75+'.mp4'];const _0xef4ae2=spawn(_0x2a4102,_0x4ee72c);_0xef4ae2[a22_0x5d3b('0x7e')]['on'](a22_0x5d3b('0x63'),function(_0x34e111){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x7f')+_0x208993);});_0xef4ae2[a22_0x5d3b('0x80')]['on'](a22_0x5d3b('0x63'),function(_0x1ab6c3){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x81')+_0x1ab6c3);}[a22_0x5d3b('0x34')](this));_0xef4ae2['on']('close',function(){console[a22_0x5d3b('0x29')](a22_0x5d3b('0x82'));this[a22_0x5d3b('0x12')]++;this[a22_0x5d3b('0x42')]();}[a22_0x5d3b('0x34')](this));}[a22_0x5d3b('0x83')](_0x10e133){const _0x223314=youtubedl(a22_0x5d3b('0x84')+_0x10e133,[a22_0x5d3b('0x85')],{'cwd':__dirname});_0x223314['on'](a22_0x5d3b('0x86'),function(_0x491c31){console[a22_0x5d3b('0x29')]('Download\x20started');console[a22_0x5d3b('0x29')]('filename:\x20'+_0x491c31[a22_0x5d3b('0x87')]);console['log'](a22_0x5d3b('0x88')+_0x491c31[a22_0x5d3b('0x5e')]);});_0x223314['on'](a22_0x5d3b('0x89'),function complete(_0x168a01){'use strict';console[a22_0x5d3b('0x29')](a22_0x5d3b('0x8a')+_0x168a01[a22_0x5d3b('0x87')]+a22_0x5d3b('0x8b'));});_0x223314['on'](a22_0x5d3b('0x45'),function(){console['log'](a22_0x5d3b('0x8c'));this[a22_0x5d3b('0x12')]++;this[a22_0x5d3b('0x42')]();}['bind'](this));_0x223314['pipe'](fs[a22_0x5d3b('0x62')](this['tempFolder']+'/'+_0x10e133+a22_0x5d3b('0x8d')));}['finishProcess'](){fs[a22_0x5d3b('0x24')](this[a22_0x5d3b('0x36')],JSON['stringify'](this[a22_0x5d3b('0x14')]));let _0x495168=a22_0x5d3b('0x8e')+'\x0d\x0a'+a22_0x5d3b('0x8f')+'\x0d\x0a';for(const _0x2e6e82 in this[a22_0x5d3b('0x13')]){const _0x4062de=this['downloadFiles'][_0x2e6e82][a22_0x5d3b('0x3b')];const _0x2a870c=this[a22_0x5d3b('0x13')][_0x2e6e82][a22_0x5d3b('0x3c')];const _0x32679b=_0x4062de[a22_0x5d3b('0x3d')](_0x4062de['lastIndexOf']('/')+0x1);let _0x534494=_0x32679b[a22_0x5d3b('0x73')]('.')[a22_0x5d3b('0x74')](0x0,-0x1)['join']('.');if(_0x2a870c==a22_0x5d3b('0x3f')){_0x534494=_0x4062de;}_0x495168+='/home/osmc/luloclient/media/files/'+_0x534494+a22_0x5d3b('0x8d')+'\x0d\x0a';}fsExtra[a22_0x5d3b('0x2f')](this[a22_0x5d3b('0xf')]);fsExtra['copySync'](this[a22_0x5d3b('0xd')],this[a22_0x5d3b('0xf')]);fs['writeFileSync'](this[a22_0x5d3b('0x11')],_0x495168);fsExtra['emptyDirSync'](this['tempFolder']);console['log'](a22_0x5d3b('0x90'));const _0x5effd5=spawn('shutdown',['-r',a22_0x5d3b('0x91')]);}}exports[a22_0x5d3b('0x92')]=SyncPlaylistsService;