var a20_0x26c4=['handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','all','registerClient','playerId','handleUpdateRequest:\x20','simple-git','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest','turnOnTV','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','closing','stack','player/connected','false','now','readFileSync','defineProperty','fs-extra','request-progress','child_process','spawn','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_google','log','velvety-glazing-252020','my-node-device','RS256','resources/keys/rsa_private.pem','events','projects/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','/config','subscribe','/state','/commands/#','connect','Client\x20not\x20connected...','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','toString','ascii','packetsend','mqttInit_mosquitto','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','exit','handleAppExit','SIGINT','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/update_settings','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','player/register'];(function(_0x369aa7,_0x57522c){var _0x38d0ed=function(_0x5b1bdc){while(--_0x5b1bdc){_0x369aa7['push'](_0x369aa7['shift']());}};_0x38d0ed(++_0x57522c);}(a20_0x26c4,0x100));var a20_0xbfb6=function(_0x465bbc,_0x515bc9){_0x465bbc=_0x465bbc-0x0;var _0x225543=a20_0x26c4[_0x465bbc];return _0x225543;};'use strict';Object[a20_0xbfb6('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a20_0xbfb6('0x1'));const request=require('request');const progress=require(a20_0xbfb6('0x2'));const spawn=require(a20_0xbfb6('0x3'))[a20_0xbfb6('0x4')];const exec=require('child_process')['exec'];const isImage=require('is-image');const format=require(a20_0xbfb6('0x5'));const os=require('os');const mqtt=require(a20_0xbfb6('0x6'));const uuidv4=require(a20_0xbfb6('0x7'));const jwt=require(a20_0xbfb6('0x8'));class MqttService{constructor(_0x4dfeaa){this[a20_0xbfb6('0x9')]=_0x4dfeaa;this[a20_0xbfb6('0xa')]=a20_0xbfb6('0xb');this[a20_0xbfb6('0xc')]=new HttpClientService_1[(a20_0xbfb6('0xd'))]();}[a20_0xbfb6('0xe')](){this['mqttInit_mosquitto']();}[a20_0xbfb6('0xf')](){console[a20_0xbfb6('0x10')]('mqttInit');const _0x206948=a20_0xbfb6('0x11');const _0x1622c4=a20_0xbfb6('0x12');const _0x57869d='my-registry';const _0x44032a='us-central1';const _0x469872=a20_0xbfb6('0x13');const _0x1830ec=a20_0xbfb6('0x14');const _0x4b388f='mqtt.googleapis.com';const _0x3a1ab1=0x1bb;const _0x5d5534=a20_0xbfb6('0x15');const _0xd6afa6=0x5;const _0x1654c4=a20_0xbfb6('0x16')+_0x206948+'/locations/'+_0x44032a+a20_0xbfb6('0x17')+_0x57869d+a20_0xbfb6('0x18')+_0x1622c4;const _0x4178ce={'host':_0x4b388f,'port':_0x3a1ab1,'clientId':_0x1654c4,'username':a20_0xbfb6('0x19'),'password':this[a20_0xbfb6('0x1a')](_0x206948,_0x1830ec,_0x469872),'protocol':a20_0xbfb6('0x1b'),'secureProtocol':a20_0xbfb6('0x1c')};const _0x1f0498=Math[a20_0xbfb6('0x1d')](Date['now']()/0x3e8);const _0x2d59f8=mqtt['connect'](_0x4178ce);_0x2d59f8['subscribe'](a20_0xbfb6('0x18')+_0x1622c4+a20_0xbfb6('0x1e'),{'qos':0x1});_0x2d59f8[a20_0xbfb6('0x1f')](a20_0xbfb6('0x18')+_0x1622c4+a20_0xbfb6('0x20'),{'qos':0x1});_0x2d59f8[a20_0xbfb6('0x1f')](a20_0xbfb6('0x18')+_0x1622c4+a20_0xbfb6('0x21'),{'qos':0x0});const _0x15b286=a20_0xbfb6('0x18')+_0x1622c4+'/'+_0x5d5534;_0x2d59f8['on'](a20_0xbfb6('0x22'),_0x470d7c=>{console[a20_0xbfb6('0x10')](a20_0xbfb6('0x22'));if(!_0x470d7c){console['log'](a20_0xbfb6('0x23'));}else{const _0x15b286='/projects/velvety-glazing-252020/topics/my-topic';const _0x3a6872=_0x57869d+'/'+_0x1622c4+'-payload-0';_0x2d59f8[a20_0xbfb6('0x24')](_0x15b286,_0x3a6872,{'qos':0x1},_0x343d17=>{console['log'](a20_0xbfb6('0x25'));console['log'](_0x343d17);if(!_0x343d17){}});}});_0x2d59f8['on'](a20_0xbfb6('0x26'),()=>{console[a20_0xbfb6('0x10')](a20_0xbfb6('0x26'));});_0x2d59f8['on'](a20_0xbfb6('0x27'),_0x4d31d2=>{console[a20_0xbfb6('0x10')](a20_0xbfb6('0x27'),_0x4d31d2);});_0x2d59f8['on'](a20_0xbfb6('0x28'),(_0x20c0df,_0x41bcb2)=>{let _0x5dbe24=a20_0xbfb6('0x29');console[a20_0xbfb6('0x10')](_0x20c0df);console[a20_0xbfb6('0x10')](_0x41bcb2+'');if(_0x20c0df===a20_0xbfb6('0x18')+_0x1622c4+a20_0xbfb6('0x1e')){_0x5dbe24=a20_0xbfb6('0x2a');}else if(_0x20c0df['startsWith'](a20_0xbfb6('0x18')+_0x1622c4+a20_0xbfb6('0x2b'))){_0x5dbe24=a20_0xbfb6('0x2c');}_0x5dbe24+=Buffer['from'](_0x41bcb2,'base64')[a20_0xbfb6('0x2d')](a20_0xbfb6('0x2e'));console[a20_0xbfb6('0x10')](_0x5dbe24);});_0x2d59f8['on'](a20_0xbfb6('0x2f'),()=>{});console[a20_0xbfb6('0x10')](_0x4178ce);}[a20_0xbfb6('0x30')](){console[a20_0xbfb6('0x10')]('mqttInit');this[a20_0xbfb6('0x31')]=uuidv4();console['log'](a20_0xbfb6('0x32'));console[a20_0xbfb6('0x10')](this[a20_0xbfb6('0x31')]);const _0x379cb5={'clientId':this[a20_0xbfb6('0x31')],'username':a20_0xbfb6('0x33'),'password':a20_0xbfb6('0x34'),'clean':!![]};this['mqttClient']=mqtt[a20_0xbfb6('0x22')](a20_0xbfb6('0x35'),_0x379cb5);this[a20_0xbfb6('0x36')]['on'](a20_0xbfb6('0x22'),this[a20_0xbfb6('0x37')][a20_0xbfb6('0x38')](this));this[a20_0xbfb6('0x36')]['on'](a20_0xbfb6('0x28'),this['mqttClient_message'][a20_0xbfb6('0x38')](this));this['mqttClient']['on'](a20_0xbfb6('0x26'),()=>{console['log'](a20_0xbfb6('0x26'));});process['on'](a20_0xbfb6('0x39'),this[a20_0xbfb6('0x3a')][a20_0xbfb6('0x38')](this));process['on'](a20_0xbfb6('0x3b'),this[a20_0xbfb6('0x3a')][a20_0xbfb6('0x38')](this));process['on'](a20_0xbfb6('0x3c'),this['handleAppExit'][a20_0xbfb6('0x38')](this));}['mqttClient_connect'](){console['log']('Connected\x20to\x20broker\x20client:'+this[a20_0xbfb6('0x31')]);this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')](a20_0xbfb6('0x3d'));this['mqttClient'][a20_0xbfb6('0x1f')](a20_0xbfb6('0x3e'));this[a20_0xbfb6('0x36')]['subscribe'](a20_0xbfb6('0x3f'),{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')](a20_0xbfb6('0x40'),{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')](a20_0xbfb6('0x41'),{'qos':0x2});this['mqttClient']['subscribe']('player/update',{'qos':0x2});this[a20_0xbfb6('0x36')]['subscribe'](a20_0xbfb6('0x42'),{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')]('player/register',{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')](a20_0xbfb6('0x43'),{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')]('player/turn_off_tv',{'qos':0x2});this[a20_0xbfb6('0x36')][a20_0xbfb6('0x1f')](a20_0xbfb6('0x44'),{'qos':0x2});}[a20_0xbfb6('0x45')](){}[a20_0xbfb6('0x46')](_0x7c726,_0x4b4b47){console[a20_0xbfb6('0x10')](a20_0xbfb6('0x47'),_0x7c726,_0x4b4b47);switch(_0x7c726){case'player/open':return this[a20_0xbfb6('0x48')](_0x4b4b47);case a20_0xbfb6('0x3e'):return this[a20_0xbfb6('0x49')](_0x4b4b47);case'player/reboot':return this[a20_0xbfb6('0x4a')](_0x4b4b47);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x4b4b47);case'player/load_playlist':return this[a20_0xbfb6('0x4b')](_0x4b4b47);case a20_0xbfb6('0x4c'):return this[a20_0xbfb6('0x4d')](_0x4b4b47);case a20_0xbfb6('0x42'):return this[a20_0xbfb6('0x4e')](_0x4b4b47);case a20_0xbfb6('0x4f'):return this[a20_0xbfb6('0x50')](_0x4b4b47);case a20_0xbfb6('0x43'):return this[a20_0xbfb6('0x51')](_0x4b4b47);case'player/turn_off_tv':return this[a20_0xbfb6('0x52')](_0x4b4b47);case a20_0xbfb6('0x44'):return this['handleTurnOnTVRequest'](_0x4b4b47);}}['handleRegisterRequest'](_0x1b1459){if(_0x1b1459==a20_0xbfb6('0x53')||_0x1b1459==String(this[a20_0xbfb6('0x9')]['playerId'])){this[a20_0xbfb6('0x9')][a20_0xbfb6('0x54')]();}}[a20_0xbfb6('0x4e')](_0x55c007){if(_0x55c007=='all'||_0x55c007==String(this['syncPlaylistsService'][a20_0xbfb6('0x55')])){}}[a20_0xbfb6('0x4d')](_0x1d3791){console[a20_0xbfb6('0x10')](a20_0xbfb6('0x56')+_0x1d3791);if(_0x1d3791==a20_0xbfb6('0x53')||_0x1d3791==String(this[a20_0xbfb6('0x9')][a20_0xbfb6('0x55')])){const _0x325c46=__dirname;const _0x56e802=require(a20_0xbfb6('0x57'))(_0x325c46);console['log']('Git\x20updating');_0x56e802['pull']((_0x52c7a0,_0x2dd8c0)=>{if(_0x52c7a0){console[a20_0xbfb6('0x10')](a20_0xbfb6('0x58'));this[a20_0xbfb6('0x4d')](_0x1d3791);return;}else{}console[a20_0xbfb6('0x10')](a20_0xbfb6('0x59'));console[a20_0xbfb6('0x10')](_0x2dd8c0);if(_0x2dd8c0&&_0x2dd8c0[a20_0xbfb6('0x5a')][a20_0xbfb6('0x5b')]){this['syncPlaylistsService'][a20_0xbfb6('0x5c')]();}else{}});}}['handleLoadPlaylistRequest'](_0x3714c1){if(_0x3714c1==a20_0xbfb6('0x53')||_0x3714c1==String(this[a20_0xbfb6('0x9')]['playerId'])){this['syncPlaylistsService'][a20_0xbfb6('0x5d')]();}}[a20_0xbfb6('0x5e')](_0x50f596){if(String(_0x50f596)=='all'||String(_0x50f596)==String(this[a20_0xbfb6('0x9')][a20_0xbfb6('0x55')])){this['syncPlaylistsService'][a20_0xbfb6('0x5f')]();}}[a20_0xbfb6('0x4a')](_0x4aec82){if(_0x4aec82==a20_0xbfb6('0x53')||_0x4aec82==String(this[a20_0xbfb6('0x9')][a20_0xbfb6('0x55')])){console[a20_0xbfb6('0x10')](a20_0xbfb6('0x60'));try{this[a20_0xbfb6('0x9')][a20_0xbfb6('0x5c')]();}catch(_0x5569ec){console[a20_0xbfb6('0x10')](_0x5569ec);}}}['handleUpdateSettingsRequest'](_0x5b234c){if(_0x5b234c=='all'||_0x5b234c==String(this['syncPlaylistsService'][a20_0xbfb6('0x55')])){console[a20_0xbfb6('0x10')](a20_0xbfb6('0x61'));try{this['syncPlaylistsService']['updateSettings']();}catch(_0x138ae2){console[a20_0xbfb6('0x10')](_0x138ae2);}}}[a20_0xbfb6('0x62')](_0xf60f71){if(_0xf60f71==a20_0xbfb6('0x53')||_0xf60f71==String(this['syncPlaylistsService']['playerId'])){console['log']('handleTurnOnTVRequest:\x20');try{this[a20_0xbfb6('0x9')][a20_0xbfb6('0x63')]();}catch(_0x198579){console[a20_0xbfb6('0x10')](_0x198579);}}}['handleTurnOffTVRequest'](_0x19572c){if(_0x19572c==a20_0xbfb6('0x53')||_0x19572c==String(this['syncPlaylistsService'][a20_0xbfb6('0x55')])){console[a20_0xbfb6('0x10')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a20_0xbfb6('0x64')]();}catch(_0x3f2cd3){console[a20_0xbfb6('0x10')](_0x3f2cd3);}}}[a20_0xbfb6('0x65')](){console['log'](a20_0xbfb6('0x66'),this['state']);this[a20_0xbfb6('0x36')][a20_0xbfb6('0x24')](a20_0xbfb6('0x67'),this[a20_0xbfb6('0x9')]['playerId']+'-'+this[a20_0xbfb6('0xa')]);}[a20_0xbfb6('0x48')](_0x186f65){if(this['state']!==a20_0xbfb6('0x68')&&this[a20_0xbfb6('0xa')]!=='opening'){console[a20_0xbfb6('0x10')]('opening\x20player\x20door');this[a20_0xbfb6('0xa')]=a20_0xbfb6('0x69');this[a20_0xbfb6('0x65')]();setTimeout(()=>{this[a20_0xbfb6('0xa')]=a20_0xbfb6('0x68');this['sendStateUpdate']();},0x1388);}}[a20_0xbfb6('0x49')](_0x336a2d){if(this[a20_0xbfb6('0xa')]!==a20_0xbfb6('0xb')&&this[a20_0xbfb6('0xa')]!=='closing'){this[a20_0xbfb6('0xa')]=a20_0xbfb6('0x6a');this[a20_0xbfb6('0x65')]();setTimeout(()=>{this[a20_0xbfb6('0xa')]=a20_0xbfb6('0xb');this[a20_0xbfb6('0x65')]();},0x1388);}}[a20_0xbfb6('0x3a')](_0xa7a4e0,_0x48974f){if(_0x48974f){console['log'](_0x48974f[a20_0xbfb6('0x6b')]);}this[a20_0xbfb6('0x36')][a20_0xbfb6('0x24')](a20_0xbfb6('0x6c'),a20_0xbfb6('0x6d'));}[a20_0xbfb6('0x1a')](_0x7cf8a7,_0x5b2617,_0x10904b){const _0x50162f={'iat':Math[a20_0xbfb6('0x1d')](Date[a20_0xbfb6('0x6e')]()/0x3e8),'exp':Math[a20_0xbfb6('0x1d')](Date[a20_0xbfb6('0x6e')]()/0x3e8)+0x14*0x3c,'aud':_0x7cf8a7};const _0x5c76fc=fs[a20_0xbfb6('0x6f')](_0x5b2617);return jwt['sign'](_0x50162f,_0x5c76fc,{'algorithm':_0x10904b});}}exports['MqttService']=MqttService;