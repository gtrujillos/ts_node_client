var a20_0x23e7=['/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','player/open','handleOpenRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/ifconfig','handleIfconfigRequest','player/register','handleRegisterRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','syncPlaylistsService','registerClient','all','simple-git','Git\x20updating','Error\x20git\x20updated','handleUpdateRequest','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','state','publish','open','opening\x20player\x20door','opening','closed','closing','stack','false','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','exec','is-image','string-template','uuid/v4','httpClientService','HttpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','round','now','connect','subscribe'];(function(_0xd22f20,_0x4ec512){var _0x3f1ead=function(_0x44b142){while(--_0x44b142){_0xd22f20['push'](_0xd22f20['shift']());}};_0x3f1ead(++_0x4ec512);}(a20_0x23e7,0xcb));var a20_0x235e=function(_0x30924d,_0x5a885f){_0x30924d=_0x30924d-0x0;var _0x3046f7=a20_0x23e7[_0x30924d];return _0x3046f7;};'use strict';Object[a20_0x235e('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x235e('0x1'));const fs=require('fs');const fsExtra=require(a20_0x235e('0x2'));const request=require('request');const progress=require(a20_0x235e('0x3'));const spawn=require(a20_0x235e('0x4'))[a20_0x235e('0x5')];const exec=require(a20_0x235e('0x4'))[a20_0x235e('0x6')];const isImage=require(a20_0x235e('0x7'));const format=require(a20_0x235e('0x8'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a20_0x235e('0x9'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x2987ce){this['syncPlaylistsService']=_0x2987ce;this['state']='closed';this[a20_0x235e('0xa')]=new HttpClientService_1[(a20_0x235e('0xb'))]();}[a20_0x235e('0xc')](){this[a20_0x235e('0xd')]();}['mqttInit_google'](){console[a20_0x235e('0xe')](a20_0x235e('0xf'));const _0xe07c13=a20_0x235e('0x10');const _0x549e7a=a20_0x235e('0x11');const _0x5a79a1=a20_0x235e('0x12');const _0x3e5ade='us-central1';const _0xa4be67=a20_0x235e('0x13');const _0x1b8e01=a20_0x235e('0x14');const _0x27589f='mqtt.googleapis.com';const _0x266e7f=0x1bb;const _0x56825a=a20_0x235e('0x15');const _0x218dc9=0x5;const _0x2d31c5=a20_0x235e('0x16')+_0xe07c13+a20_0x235e('0x17')+_0x3e5ade+a20_0x235e('0x18')+_0x5a79a1+a20_0x235e('0x19')+_0x549e7a;const _0x13a099={'host':_0x27589f,'port':_0x266e7f,'clientId':_0x2d31c5,'username':a20_0x235e('0x1a'),'password':this[a20_0x235e('0x1b')](_0xe07c13,_0x1b8e01,_0xa4be67),'protocol':'mqtts','secureProtocol':a20_0x235e('0x1c')};const _0x3d88a8=Math[a20_0x235e('0x1d')](Date[a20_0x235e('0x1e')]()/0x3e8);const _0x5a4ce0=mqtt[a20_0x235e('0x1f')](_0x13a099);_0x5a4ce0[a20_0x235e('0x20')](a20_0x235e('0x19')+_0x549e7a+a20_0x235e('0x21'),{'qos':0x1});_0x5a4ce0['subscribe'](a20_0x235e('0x19')+_0x549e7a+a20_0x235e('0x22'),{'qos':0x1});_0x5a4ce0[a20_0x235e('0x20')](a20_0x235e('0x19')+_0x549e7a+a20_0x235e('0x23'),{'qos':0x0});const _0x23bd72=a20_0x235e('0x19')+_0x549e7a+'/'+_0x56825a;_0x5a4ce0['on']('connect',_0x4adc87=>{console[a20_0x235e('0xe')](a20_0x235e('0x1f'));if(!_0x4adc87){console[a20_0x235e('0xe')](a20_0x235e('0x24'));}else{const _0x23bd72=a20_0x235e('0x25');const _0x9fc256=_0x5a79a1+'/'+_0x549e7a+'-payload-0';_0x5a4ce0['publish'](_0x23bd72,_0x9fc256,{'qos':0x1},_0x167ece=>{console['log'](a20_0x235e('0x26'));console['log'](_0x167ece);if(!_0x167ece){}});}});_0x5a4ce0['on']('close',()=>{console[a20_0x235e('0xe')](a20_0x235e('0x27'));});_0x5a4ce0['on'](a20_0x235e('0x28'),_0x39273e=>{console[a20_0x235e('0xe')](a20_0x235e('0x28'),_0x39273e);});_0x5a4ce0['on'](a20_0x235e('0x29'),(_0x390e53,_0x5da6c8)=>{let _0x337f64=a20_0x235e('0x2a');console[a20_0x235e('0xe')](_0x390e53);console['log'](_0x5da6c8+'');if(_0x390e53==='/devices/'+_0x549e7a+a20_0x235e('0x21')){_0x337f64=a20_0x235e('0x2b');}else if(_0x390e53[a20_0x235e('0x2c')](a20_0x235e('0x19')+_0x549e7a+'/commands')){_0x337f64=a20_0x235e('0x2d');}_0x337f64+=Buffer[a20_0x235e('0x2e')](_0x5da6c8,a20_0x235e('0x2f'))[a20_0x235e('0x30')](a20_0x235e('0x31'));console['log'](_0x337f64);});_0x5a4ce0['on'](a20_0x235e('0x32'),()=>{});console[a20_0x235e('0xe')](_0x13a099);}['mqttInit_mosquitto'](){console['log'](a20_0x235e('0xf'));this[a20_0x235e('0x33')]=uuidv4();console[a20_0x235e('0xe')](a20_0x235e('0x34'));console[a20_0x235e('0xe')](this[a20_0x235e('0x33')]);const _0x1a28c8={'clientId':this[a20_0x235e('0x33')],'username':a20_0x235e('0x35'),'password':a20_0x235e('0x36'),'clean':!![]};this[a20_0x235e('0x37')]=mqtt['connect']('mqtt://lulo.run',_0x1a28c8);this[a20_0x235e('0x37')]['on'](a20_0x235e('0x1f'),this['mqttClient_connect'][a20_0x235e('0x38')](this));this['mqttClient']['on'](a20_0x235e('0x29'),this[a20_0x235e('0x39')][a20_0x235e('0x38')](this));this[a20_0x235e('0x37')]['on'](a20_0x235e('0x27'),()=>{console[a20_0x235e('0xe')](a20_0x235e('0x27'));});process['on'](a20_0x235e('0x3a'),this[a20_0x235e('0x3b')][a20_0x235e('0x38')](this));process['on'](a20_0x235e('0x3c'),this[a20_0x235e('0x3b')][a20_0x235e('0x38')](this));process['on'](a20_0x235e('0x3d'),this[a20_0x235e('0x3b')][a20_0x235e('0x38')](this));}['mqttClient_connect'](){console['log'](a20_0x235e('0x3e')+this[a20_0x235e('0x33')]);this[a20_0x235e('0x37')][a20_0x235e('0x20')]('player/open');this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x3f'));this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x40'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x41'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x42'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x43'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')]('player/ifconfig',{'qos':0x2});this[a20_0x235e('0x37')]['subscribe']('player/register',{'qos':0x2});this[a20_0x235e('0x37')]['subscribe'](a20_0x235e('0x44'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x45'),{'qos':0x2});this[a20_0x235e('0x37')][a20_0x235e('0x20')](a20_0x235e('0x46'),{'qos':0x2});}[a20_0x235e('0x47')](){}['mqttClient_message'](_0x3cfde8,_0x31599f){console[a20_0x235e('0xe')]('received\x20message\x20%s\x20%s',_0x3cfde8,_0x31599f);switch(_0x3cfde8){case a20_0x235e('0x48'):return this[a20_0x235e('0x49')](_0x31599f);case'player/close':return this['handleCloseRequest'](_0x31599f);case a20_0x235e('0x40'):return this[a20_0x235e('0x4a')](_0x31599f);case a20_0x235e('0x42'):return this[a20_0x235e('0x4b')](_0x31599f);case a20_0x235e('0x41'):return this[a20_0x235e('0x4c')](_0x31599f);case a20_0x235e('0x43'):return this['handleUpdateRequest'](_0x31599f);case a20_0x235e('0x4d'):return this[a20_0x235e('0x4e')](_0x31599f);case a20_0x235e('0x4f'):return this[a20_0x235e('0x50')](_0x31599f);case a20_0x235e('0x44'):return this['handleUpdateSettingsRequest'](_0x31599f);case a20_0x235e('0x45'):return this[a20_0x235e('0x51')](_0x31599f);case a20_0x235e('0x46'):return this[a20_0x235e('0x52')](_0x31599f);}}[a20_0x235e('0x50')](_0x2b41c0){if(_0x2b41c0=='all'||_0x2b41c0==String(this['syncPlaylistsService'][a20_0x235e('0x53')])){this[a20_0x235e('0x54')][a20_0x235e('0x55')]();}}[a20_0x235e('0x4e')](_0x6397d9){if(_0x6397d9=='all'||_0x6397d9==String(this['syncPlaylistsService']['playerId'])){}}['handleUpdateRequest'](_0x18df2d){console['log']('handleUpdateRequest:\x20'+_0x18df2d);if(_0x18df2d==a20_0x235e('0x56')||_0x18df2d==String(this[a20_0x235e('0x54')][a20_0x235e('0x53')])){const _0x237e0a=__dirname;const _0x4b0926=require(a20_0x235e('0x57'))(_0x237e0a);console[a20_0x235e('0xe')](a20_0x235e('0x58'));_0x4b0926['pull']((_0x4ee01f,_0x5c595a)=>{if(_0x4ee01f){console[a20_0x235e('0xe')](a20_0x235e('0x59'));this[a20_0x235e('0x5a')](_0x18df2d);return;}else{}console[a20_0x235e('0xe')](a20_0x235e('0x5b'));console[a20_0x235e('0xe')](_0x5c595a);if(_0x5c595a&&_0x5c595a[a20_0x235e('0x5c')][a20_0x235e('0x5d')]){this[a20_0x235e('0x54')][a20_0x235e('0x5e')]();}else{}});}}[a20_0x235e('0x4c')](_0x311cf3){if(_0x311cf3=='all'||_0x311cf3==String(this[a20_0x235e('0x54')]['playerId'])){this[a20_0x235e('0x54')][a20_0x235e('0x5f')]();}}['handleReloadPlaylistRequest'](_0x55b4d6){if(String(_0x55b4d6)=='all'||String(_0x55b4d6)==String(this[a20_0x235e('0x54')][a20_0x235e('0x53')])){this[a20_0x235e('0x54')][a20_0x235e('0x60')]();}}[a20_0x235e('0x4a')](_0x38dbcc){if(_0x38dbcc==a20_0x235e('0x56')||_0x38dbcc==String(this[a20_0x235e('0x54')][a20_0x235e('0x53')])){console['log'](a20_0x235e('0x61'));try{this[a20_0x235e('0x54')][a20_0x235e('0x5e')]();}catch(_0xa95fc9){console[a20_0x235e('0xe')](_0xa95fc9);}}}[a20_0x235e('0x62')](_0x4d7ccd){if(_0x4d7ccd==a20_0x235e('0x56')||_0x4d7ccd==String(this['syncPlaylistsService'][a20_0x235e('0x53')])){console[a20_0x235e('0xe')](a20_0x235e('0x63'));try{this[a20_0x235e('0x54')]['updateSettings']();}catch(_0x2927b9){console[a20_0x235e('0xe')](_0x2927b9);}}}[a20_0x235e('0x52')](_0x5ec26f){if(_0x5ec26f==a20_0x235e('0x56')||_0x5ec26f==String(this[a20_0x235e('0x54')][a20_0x235e('0x53')])){console['log'](a20_0x235e('0x64'));try{this[a20_0x235e('0x54')][a20_0x235e('0x65')]();}catch(_0x52f8fc){console[a20_0x235e('0xe')](_0x52f8fc);}}}[a20_0x235e('0x51')](_0x4d4e04){if(_0x4d4e04==a20_0x235e('0x56')||_0x4d4e04==String(this[a20_0x235e('0x54')][a20_0x235e('0x53')])){console[a20_0x235e('0xe')](a20_0x235e('0x66'));try{this['syncPlaylistsService'][a20_0x235e('0x67')]();}catch(_0x13e90e){console[a20_0x235e('0xe')](_0x13e90e);}}}[a20_0x235e('0x68')](){console[a20_0x235e('0xe')](a20_0x235e('0x69'),this[a20_0x235e('0x6a')]);this[a20_0x235e('0x37')][a20_0x235e('0x6b')]('player/state',this[a20_0x235e('0x54')][a20_0x235e('0x53')]+'-'+this[a20_0x235e('0x6a')]);}[a20_0x235e('0x49')](_0x204f4c){if(this[a20_0x235e('0x6a')]!==a20_0x235e('0x6c')&&this[a20_0x235e('0x6a')]!=='opening'){console['log'](a20_0x235e('0x6d'));this[a20_0x235e('0x6a')]=a20_0x235e('0x6e');this[a20_0x235e('0x68')]();setTimeout(()=>{this[a20_0x235e('0x6a')]=a20_0x235e('0x6c');this[a20_0x235e('0x68')]();},0x1388);}}['handleCloseRequest'](_0x463b08){if(this[a20_0x235e('0x6a')]!==a20_0x235e('0x6f')&&this[a20_0x235e('0x6a')]!=='closing'){this[a20_0x235e('0x6a')]=a20_0x235e('0x70');this[a20_0x235e('0x68')]();setTimeout(()=>{this[a20_0x235e('0x6a')]=a20_0x235e('0x6f');this[a20_0x235e('0x68')]();},0x1388);}}[a20_0x235e('0x3b')](_0x5d8174,_0x266716){if(_0x266716){console[a20_0x235e('0xe')](_0x266716[a20_0x235e('0x71')]);}this[a20_0x235e('0x37')]['publish']('player/connected',a20_0x235e('0x72'));}[a20_0x235e('0x1b')](_0x225609,_0x4b9f51,_0x2f9871){const _0x1e037a={'iat':Math['round'](Date[a20_0x235e('0x1e')]()/0x3e8),'exp':Math[a20_0x235e('0x1d')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x225609};const _0x46bdfa=fs[a20_0x235e('0x73')](_0x4b9f51);return jwt[a20_0x235e('0x74')](_0x1e037a,_0x46bdfa,{'algorithm':_0x2f9871});}}exports[a20_0x235e('0x75')]=MqttService;