var a20_0x1f2c=['./../infrastructure/HttpClientService','request','child_process','exec','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','projects/','/locations/','/registries/','unused','mqtts','TLSv1_2_method','round','connect','/devices/','subscribe','/state','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','close','error','message','Message\x20received:\x20','startsWith','/commands','base64','toString','packetsend','mqttInit_mosquitto','clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','SIGINT','handleAppExit','uncaughtException','player/open','player/reboot','player/reload_playlist','player/update','player/ifconfig','player/register','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','player/update_settings','handleUpdateSettingsRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','Git\x20updated','changes','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','createJwt','sign','MqttService'];(function(_0x12df45,_0x561ac7){var _0x246e8b=function(_0x28fbab){while(--_0x28fbab){_0x12df45['push'](_0x12df45['shift']());}};_0x246e8b(++_0x561ac7);}(a20_0x1f2c,0x1ac));var a20_0x4f2e=function(_0x30cbf3,_0x26aba3){_0x30cbf3=_0x30cbf3-0x0;var _0x5ad93c=a20_0x1f2c[_0x30cbf3];return _0x5ad93c;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x4f2e('0x0'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0x4f2e('0x1'));const progress=require('request-progress');const spawn=require(a20_0x4f2e('0x2'))['spawn'];const exec=require('child_process')[a20_0x4f2e('0x3')];const isImage=require(a20_0x4f2e('0x4'));const format=require(a20_0x4f2e('0x5'));const os=require('os');const mqtt=require(a20_0x4f2e('0x6'));const uuidv4=require(a20_0x4f2e('0x7'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x159269){this[a20_0x4f2e('0x8')]=_0x159269;this[a20_0x4f2e('0x9')]=a20_0x4f2e('0xa');this[a20_0x4f2e('0xb')]=new HttpClientService_1[(a20_0x4f2e('0xc'))]();}[a20_0x4f2e('0xd')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console['log'](a20_0x4f2e('0xe'));const _0x3e95e1=a20_0x4f2e('0xf');const _0x2f7a18=a20_0x4f2e('0x10');const _0x27e5a9=a20_0x4f2e('0x11');const _0x279e26=a20_0x4f2e('0x12');const _0x338249=a20_0x4f2e('0x13');const _0x47cbed=a20_0x4f2e('0x14');const _0x32245f=a20_0x4f2e('0x15');const _0x1e54f9=0x1bb;const _0x579f8f='events';const _0x1f64c5=0x5;const _0x278dec=a20_0x4f2e('0x16')+_0x3e95e1+a20_0x4f2e('0x17')+_0x279e26+a20_0x4f2e('0x18')+_0x27e5a9+'/devices/'+_0x2f7a18;const _0x2c9d08={'host':_0x32245f,'port':_0x1e54f9,'clientId':_0x278dec,'username':a20_0x4f2e('0x19'),'password':this['createJwt'](_0x3e95e1,_0x47cbed,_0x338249),'protocol':a20_0x4f2e('0x1a'),'secureProtocol':a20_0x4f2e('0x1b')};const _0x48b82c=Math[a20_0x4f2e('0x1c')](Date['now']()/0x3e8);const _0x53274b=mqtt[a20_0x4f2e('0x1d')](_0x2c9d08);_0x53274b['subscribe'](a20_0x4f2e('0x1e')+_0x2f7a18+'/config',{'qos':0x1});_0x53274b[a20_0x4f2e('0x1f')](a20_0x4f2e('0x1e')+_0x2f7a18+a20_0x4f2e('0x20'),{'qos':0x1});_0x53274b['subscribe'](a20_0x4f2e('0x1e')+_0x2f7a18+'/commands/#',{'qos':0x0});const _0x2d6ad5=a20_0x4f2e('0x1e')+_0x2f7a18+'/'+_0x579f8f;_0x53274b['on']('connect',_0xeff6f9=>{console[a20_0x4f2e('0x21')](a20_0x4f2e('0x1d'));if(!_0xeff6f9){console[a20_0x4f2e('0x21')](a20_0x4f2e('0x22'));}else{const _0x2d6ad5=a20_0x4f2e('0x23');const _0x4faac7=_0x27e5a9+'/'+_0x2f7a18+'-payload-0';_0x53274b[a20_0x4f2e('0x24')](_0x2d6ad5,_0x4faac7,{'qos':0x1},_0x594c56=>{console[a20_0x4f2e('0x21')]('publish\x20result:');console[a20_0x4f2e('0x21')](_0x594c56);if(!_0x594c56){}});}});_0x53274b['on'](a20_0x4f2e('0x25'),()=>{console[a20_0x4f2e('0x21')]('close');});_0x53274b['on'](a20_0x4f2e('0x26'),_0x50f5a3=>{console[a20_0x4f2e('0x21')](a20_0x4f2e('0x26'),_0x50f5a3);});_0x53274b['on'](a20_0x4f2e('0x27'),(_0x10c8f7,_0x233270)=>{let _0x12af01=a20_0x4f2e('0x28');console[a20_0x4f2e('0x21')](_0x10c8f7);console[a20_0x4f2e('0x21')](_0x233270+'');if(_0x10c8f7===a20_0x4f2e('0x1e')+_0x2f7a18+'/config'){_0x12af01='Config\x20message\x20received:\x20';}else if(_0x10c8f7[a20_0x4f2e('0x29')](a20_0x4f2e('0x1e')+_0x2f7a18+a20_0x4f2e('0x2a'))){_0x12af01='Command\x20message\x20received:\x20';}_0x12af01+=Buffer['from'](_0x233270,a20_0x4f2e('0x2b'))[a20_0x4f2e('0x2c')]('ascii');console[a20_0x4f2e('0x21')](_0x12af01);});_0x53274b['on'](a20_0x4f2e('0x2d'),()=>{});console[a20_0x4f2e('0x21')](_0x2c9d08);}[a20_0x4f2e('0x2e')](){console[a20_0x4f2e('0x21')](a20_0x4f2e('0xe'));this[a20_0x4f2e('0x2f')]=uuidv4();console[a20_0x4f2e('0x21')]('this.clientId');console[a20_0x4f2e('0x21')](this[a20_0x4f2e('0x2f')]);const _0x4f5846={'clientId':this['clientId'],'username':a20_0x4f2e('0x30'),'password':'run.lulo_2018#.','clean':!![]};this[a20_0x4f2e('0x31')]=mqtt[a20_0x4f2e('0x1d')](a20_0x4f2e('0x32'),_0x4f5846);this[a20_0x4f2e('0x31')]['on'](a20_0x4f2e('0x1d'),this[a20_0x4f2e('0x33')][a20_0x4f2e('0x34')](this));this['mqttClient']['on'](a20_0x4f2e('0x27'),this['mqttClient_message'][a20_0x4f2e('0x34')](this));this[a20_0x4f2e('0x31')]['on'](a20_0x4f2e('0x25'),()=>{console[a20_0x4f2e('0x21')](a20_0x4f2e('0x25'));});process['on']('exit',this['handleAppExit']['bind'](this));process['on'](a20_0x4f2e('0x35'),this[a20_0x4f2e('0x36')][a20_0x4f2e('0x34')](this));process['on'](a20_0x4f2e('0x37'),this[a20_0x4f2e('0x36')][a20_0x4f2e('0x34')](this));}[a20_0x4f2e('0x33')](){console[a20_0x4f2e('0x21')]('Connected\x20to\x20broker\x20client:'+this[a20_0x4f2e('0x2f')]);this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')](a20_0x4f2e('0x38'));this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')]('player/close');this[a20_0x4f2e('0x31')]['subscribe'](a20_0x4f2e('0x39'),{'qos':0x2});this[a20_0x4f2e('0x31')]['subscribe']('player/load_playlist',{'qos':0x2});this['mqttClient'][a20_0x4f2e('0x1f')](a20_0x4f2e('0x3a'),{'qos':0x2});this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')](a20_0x4f2e('0x3b'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x4f2e('0x3c'),{'qos':0x2});this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')](a20_0x4f2e('0x3d'),{'qos':0x2});this[a20_0x4f2e('0x31')]['subscribe']('player/update_settings',{'qos':0x2});this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')](a20_0x4f2e('0x3e'),{'qos':0x2});this[a20_0x4f2e('0x31')][a20_0x4f2e('0x1f')](a20_0x4f2e('0x3f'),{'qos':0x2});}[a20_0x4f2e('0x40')](){}['mqttClient_message'](_0x18886b,_0x1f7d4b){console['log'](a20_0x4f2e('0x41'),_0x18886b,_0x1f7d4b);switch(_0x18886b){case a20_0x4f2e('0x38'):return this[a20_0x4f2e('0x42')](_0x1f7d4b);case'player/close':return this[a20_0x4f2e('0x43')](_0x1f7d4b);case a20_0x4f2e('0x39'):return this[a20_0x4f2e('0x44')](_0x1f7d4b);case a20_0x4f2e('0x3a'):return this[a20_0x4f2e('0x45')](_0x1f7d4b);case'player/load_playlist':return this[a20_0x4f2e('0x46')](_0x1f7d4b);case a20_0x4f2e('0x3b'):return this[a20_0x4f2e('0x47')](_0x1f7d4b);case a20_0x4f2e('0x3c'):return this[a20_0x4f2e('0x48')](_0x1f7d4b);case a20_0x4f2e('0x3d'):return this[a20_0x4f2e('0x49')](_0x1f7d4b);case a20_0x4f2e('0x4a'):return this[a20_0x4f2e('0x4b')](_0x1f7d4b);case a20_0x4f2e('0x3e'):return this['handleTurnOffTVRequest'](_0x1f7d4b);case a20_0x4f2e('0x3f'):return this[a20_0x4f2e('0x4c')](_0x1f7d4b);}}[a20_0x4f2e('0x49')](_0x4d2d41){if(_0x4d2d41==a20_0x4f2e('0x4d')||_0x4d2d41==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4f')]();}}['handleIfconfigRequest'](_0x4c76b8){if(_0x4c76b8==a20_0x4f2e('0x4d')||_0x4c76b8==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){}}['handleUpdateRequest'](_0x2b53ce){console['log'](a20_0x4f2e('0x50')+_0x2b53ce);if(_0x2b53ce==a20_0x4f2e('0x4d')||_0x2b53ce==String(this[a20_0x4f2e('0x8')]['playerId'])){const _0x55d688=__dirname;const _0x599435=require(a20_0x4f2e('0x51'))(_0x55d688);console[a20_0x4f2e('0x21')](a20_0x4f2e('0x52'));_0x599435['pull']((_0x1f0b66,_0x3fb8da)=>{if(_0x1f0b66){console[a20_0x4f2e('0x21')]('Error\x20git\x20updated');this['handleUpdateRequest'](_0x2b53ce);return;}else{}console[a20_0x4f2e('0x21')](a20_0x4f2e('0x53'));console['log'](_0x3fb8da);if(_0x3fb8da&&_0x3fb8da['summary'][a20_0x4f2e('0x54')]){this[a20_0x4f2e('0x8')]['reboot']();}else{}});}}[a20_0x4f2e('0x46')](_0x22b5aa){if(_0x22b5aa==a20_0x4f2e('0x4d')||_0x22b5aa==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){this['syncPlaylistsService'][a20_0x4f2e('0x55')]();}}[a20_0x4f2e('0x45')](_0x581876){if(String(_0x581876)==a20_0x4f2e('0x4d')||String(_0x581876)==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){this[a20_0x4f2e('0x8')][a20_0x4f2e('0x56')]();}}[a20_0x4f2e('0x44')](_0x5927e7){if(_0x5927e7==a20_0x4f2e('0x4d')||_0x5927e7==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){console[a20_0x4f2e('0x21')](a20_0x4f2e('0x57'));try{this[a20_0x4f2e('0x8')][a20_0x4f2e('0x58')]();}catch(_0x5c9df8){console[a20_0x4f2e('0x21')](_0x5c9df8);}}}[a20_0x4f2e('0x4b')](_0x2d16fe){if(_0x2d16fe=='all'||_0x2d16fe==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){console[a20_0x4f2e('0x21')]('handleUpdateSettingsRequest:\x20');try{this[a20_0x4f2e('0x8')][a20_0x4f2e('0x59')]();}catch(_0x2837ed){console['log'](_0x2837ed);}}}[a20_0x4f2e('0x4c')](_0x25f19d){if(_0x25f19d==a20_0x4f2e('0x4d')||_0x25f19d==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){console[a20_0x4f2e('0x21')](a20_0x4f2e('0x5a'));try{this[a20_0x4f2e('0x8')][a20_0x4f2e('0x5b')]();}catch(_0x197c02){console[a20_0x4f2e('0x21')](_0x197c02);}}}[a20_0x4f2e('0x5c')](_0x5383a0){if(_0x5383a0==a20_0x4f2e('0x4d')||_0x5383a0==String(this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')])){console['log']('handleTurnOffTVRequest:\x20');try{this[a20_0x4f2e('0x8')][a20_0x4f2e('0x5d')]();}catch(_0x379e83){console['log'](_0x379e83);}}}[a20_0x4f2e('0x5e')](){console[a20_0x4f2e('0x21')](a20_0x4f2e('0x5f'),this[a20_0x4f2e('0x9')]);this['mqttClient'][a20_0x4f2e('0x24')](a20_0x4f2e('0x60'),this[a20_0x4f2e('0x8')][a20_0x4f2e('0x4e')]+'-'+this[a20_0x4f2e('0x9')]);}['handleOpenRequest'](_0x38d98c){if(this['state']!==a20_0x4f2e('0x61')&&this['state']!==a20_0x4f2e('0x62')){console[a20_0x4f2e('0x21')](a20_0x4f2e('0x63'));this[a20_0x4f2e('0x9')]=a20_0x4f2e('0x62');this[a20_0x4f2e('0x5e')]();setTimeout(()=>{this[a20_0x4f2e('0x9')]='open';this[a20_0x4f2e('0x5e')]();},0x1388);}}['handleCloseRequest'](_0x2bc5d2){if(this[a20_0x4f2e('0x9')]!==a20_0x4f2e('0xa')&&this[a20_0x4f2e('0x9')]!==a20_0x4f2e('0x64')){this[a20_0x4f2e('0x9')]=a20_0x4f2e('0x64');this[a20_0x4f2e('0x5e')]();setTimeout(()=>{this[a20_0x4f2e('0x9')]=a20_0x4f2e('0xa');this['sendStateUpdate']();},0x1388);}}[a20_0x4f2e('0x36')](_0x1cd504,_0x4f1fe1){if(_0x4f1fe1){console[a20_0x4f2e('0x21')](_0x4f1fe1[a20_0x4f2e('0x65')]);}this[a20_0x4f2e('0x31')][a20_0x4f2e('0x24')](a20_0x4f2e('0x66'),a20_0x4f2e('0x67'));}[a20_0x4f2e('0x68')](_0x2849b1,_0x53a05f,_0x25fefe){const _0x6cd7c9={'iat':Math[a20_0x4f2e('0x1c')](Date['now']()/0x3e8),'exp':Math[a20_0x4f2e('0x1c')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x2849b1};const _0x28eda3=fs['readFileSync'](_0x53a05f);return jwt[a20_0x4f2e('0x69')](_0x6cd7c9,_0x28eda3,{'algorithm':_0x25fefe});}}exports[a20_0x4f2e('0x6a')]=MqttService;