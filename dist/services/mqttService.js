var a18_0x49c8=['player/state','opening','sendStateUpdate','open','handleCloseRequest','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','exit','handleAppExit','Connected\x20to\x20broker\x20client:','player/open','subscribe','player/close','player/reboot','player/load_playlist','player/update','player/register','reportStatus','handleOpenRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','registerClient','playerId','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','shutdown','now','sending\x20state\x20%s','publish'];(function(_0x25f216,_0x54c986){var _0x2a063f=function(_0x1014b7){while(--_0x1014b7){_0x25f216['push'](_0x25f216['shift']());}};_0x2a063f(++_0x54c986);}(a18_0x49c8,0x122));var a18_0x109f=function(_0x132be9,_0x3a95e7){_0x132be9=_0x132be9-0x0;var _0x3d8797=a18_0x49c8[_0x132be9];return _0x3d8797;};'use strict';Object[a18_0x109f('0x0')](exports,a18_0x109f('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x109f('0x2'));const fs=require('fs');const fsExtra=require(a18_0x109f('0x3'));const request=require(a18_0x109f('0x4'));const progress=require('request-progress');const spawn=require(a18_0x109f('0x5'))['spawn'];const isImage=require(a18_0x109f('0x6'));const format=require(a18_0x109f('0x7'));const os=require('os');const mqtt=require(a18_0x109f('0x8'));const uuidv4=require(a18_0x109f('0x9'));class MqttService{constructor(_0x2f9ac0){this[a18_0x109f('0xa')]=_0x2f9ac0;this[a18_0x109f('0xb')]=a18_0x109f('0xc');this[a18_0x109f('0xd')]=new HttpClientService_1[(a18_0x109f('0xe'))]();}[a18_0x109f('0xf')](){this['mqttInit']();}[a18_0x109f('0x10')](){console[a18_0x109f('0x11')](a18_0x109f('0x10'));this[a18_0x109f('0x12')]=uuidv4();console[a18_0x109f('0x11')](a18_0x109f('0x13'));console[a18_0x109f('0x11')](this[a18_0x109f('0x12')]);const _0x281789={'clientId':this[a18_0x109f('0x12')],'username':a18_0x109f('0x14'),'password':a18_0x109f('0x15'),'clean':!![]};this[a18_0x109f('0x16')]=mqtt[a18_0x109f('0x17')](a18_0x109f('0x18'),_0x281789);this[a18_0x109f('0x16')]['on']('connect',this[a18_0x109f('0x19')][a18_0x109f('0x1a')](this));this[a18_0x109f('0x16')]['on'](a18_0x109f('0x1b'),this['mqttClient_message'][a18_0x109f('0x1a')](this));process['on'](a18_0x109f('0x1c'),this[a18_0x109f('0x1d')][a18_0x109f('0x1a')](this));process['on']('SIGINT',this[a18_0x109f('0x1d')]['bind'](this));process['on']('uncaughtException',this[a18_0x109f('0x1d')]['bind'](this));}[a18_0x109f('0x19')](){console[a18_0x109f('0x11')](a18_0x109f('0x1e')+this['clientId']);this[a18_0x109f('0x16')]['subscribe'](a18_0x109f('0x1f'));this[a18_0x109f('0x16')][a18_0x109f('0x20')](a18_0x109f('0x21'));this['mqttClient'][a18_0x109f('0x20')](a18_0x109f('0x22'),{'qos':0x2});this['mqttClient'][a18_0x109f('0x20')](a18_0x109f('0x23'),{'qos':0x2});this[a18_0x109f('0x16')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x109f('0x16')][a18_0x109f('0x20')](a18_0x109f('0x24'),{'qos':0x2});this['mqttClient']['subscribe']('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x109f('0x20')](a18_0x109f('0x25'),{'qos':0x2});}[a18_0x109f('0x26')](){}['mqttClient_message'](_0x5a4141,_0x504c04){console[a18_0x109f('0x11')]('received\x20message\x20%s\x20%s',_0x5a4141,_0x504c04);switch(_0x5a4141){case a18_0x109f('0x1f'):return this[a18_0x109f('0x27')](_0x504c04);case a18_0x109f('0x21'):return this['handleCloseRequest'](_0x504c04);case'player/reboot':return this[a18_0x109f('0x28')](_0x504c04);case a18_0x109f('0x29'):return this[a18_0x109f('0x2a')](_0x504c04);case a18_0x109f('0x23'):return this['handleLoadPlaylistRequest'](_0x504c04);case'player/update':return this['handleUpdateRequest'](_0x504c04);case a18_0x109f('0x2b'):return this[a18_0x109f('0x2c')](_0x504c04);case a18_0x109f('0x25'):return this[a18_0x109f('0x2d')](_0x504c04);}}[a18_0x109f('0x2d')](_0x38ab82){if(_0x38ab82==a18_0x109f('0x2e')||_0x38ab82==String(this[a18_0x109f('0xa')]['playerId'])){this['syncPlaylistsService'][a18_0x109f('0x2f')]();}}[a18_0x109f('0x2c')](_0x563f5b){if(_0x563f5b==a18_0x109f('0x2e')||_0x563f5b==String(this['syncPlaylistsService'][a18_0x109f('0x30')])){}}[a18_0x109f('0x31')](_0x247392){console['log'](a18_0x109f('0x32')+_0x247392);if(_0x247392==a18_0x109f('0x2e')||_0x247392==String(this[a18_0x109f('0xa')]['playerId'])){const _0x3ac9b1=__dirname;const _0xb3cdc6=require(a18_0x109f('0x33'))(_0x3ac9b1);console['log'](a18_0x109f('0x34'));_0xb3cdc6[a18_0x109f('0x35')]((_0x37240f,_0x273359)=>{if(_0x37240f){console[a18_0x109f('0x11')]('Error\x20git\x20updated');this[a18_0x109f('0x31')](_0x247392);return;}else{}console[a18_0x109f('0x11')](a18_0x109f('0x36'));console[a18_0x109f('0x11')](_0x273359);if(_0x273359&&_0x273359[a18_0x109f('0x37')]['changes']){const _0x247261=spawn(a18_0x109f('0x38'),['-r',a18_0x109f('0x39')]);}else{}});}}['handleLoadPlaylistRequest'](_0x1d8916){if(_0x1d8916==a18_0x109f('0x2e')||_0x1d8916==String(this[a18_0x109f('0xa')]['playerId'])){this[a18_0x109f('0xa')]['loadMediaList']();}}[a18_0x109f('0x2a')](_0x195811){if(String(_0x195811)==a18_0x109f('0x2e')||String(_0x195811)==String(this['syncPlaylistsService']['playerId'])){this['syncPlaylistsService']['reloadMediaList']();}}[a18_0x109f('0x28')](_0x410d8f){if(_0x410d8f==a18_0x109f('0x2e')||_0x410d8f==String(this[a18_0x109f('0xa')]['playerId'])){const _0x450ec2=spawn(a18_0x109f('0x38'),['-r',a18_0x109f('0x39')]);}}['sendStateUpdate'](){console['log'](a18_0x109f('0x3a'),this['state']);this[a18_0x109f('0x16')][a18_0x109f('0x3b')](a18_0x109f('0x3c'),this[a18_0x109f('0xa')][a18_0x109f('0x30')]+'-'+this[a18_0x109f('0xb')]);}[a18_0x109f('0x27')](_0x599c2c){if(this[a18_0x109f('0xb')]!=='open'&&this['state']!==a18_0x109f('0x3d')){console['log']('opening\x20player\x20door');this[a18_0x109f('0xb')]=a18_0x109f('0x3d');this[a18_0x109f('0x3e')]();setTimeout(()=>{this[a18_0x109f('0xb')]=a18_0x109f('0x3f');this[a18_0x109f('0x3e')]();},0x1388);}}[a18_0x109f('0x40')](_0x550f7b){if(this[a18_0x109f('0xb')]!=='closed'&&this[a18_0x109f('0xb')]!=='closing'){this['state']=a18_0x109f('0x41');this[a18_0x109f('0x3e')]();setTimeout(()=>{this[a18_0x109f('0xb')]=a18_0x109f('0xc');this[a18_0x109f('0x3e')]();},0x1388);}}[a18_0x109f('0x1d')](_0x34af1b,_0x4de320){if(_0x4de320){console['log'](_0x4de320[a18_0x109f('0x42')]);}this[a18_0x109f('0x16')][a18_0x109f('0x3b')](a18_0x109f('0x43'),a18_0x109f('0x44'));}}exports[a18_0x109f('0x45')]=MqttService;