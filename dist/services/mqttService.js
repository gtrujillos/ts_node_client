var a23_0x1c09=['handleIfconfigRequest','handleTurnOnTVRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest','handleTurnOffTVRequest:\x20','turnOffTV','opening\x20player\x20door','opening','sendStateUpdate','open','closing','stack','player/connected','false','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','child_process','spawn','exec','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/devices/','createJwt','mqtts','TLSv1_2_method','round','connect','subscribe','/state','/projects/velvety-glazing-252020/topics/my-topic','publish','close','error','message','/config','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','mqttInit','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_on_tv','reportStatus','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest'];(function(_0xb3797c,_0x46ef3d){var _0x22f16a=function(_0x2e0325){while(--_0x2e0325){_0xb3797c['push'](_0xb3797c['shift']());}};_0x22f16a(++_0x46ef3d);}(a23_0x1c09,0x1f4));var a23_0x354f=function(_0x2eefe3,_0x4b3f9d){_0x2eefe3=_0x2eefe3-0x0;var _0x21e0f0=a23_0x1c09[_0x2eefe3];return _0x21e0f0;};'use strict';Object[a23_0x354f('0x0')](exports,a23_0x354f('0x1'),{'value':!![]});const HttpClientService_1=require(a23_0x354f('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a23_0x354f('0x3'));const progress=require('request-progress');const spawn=require(a23_0x354f('0x4'))[a23_0x354f('0x5')];const exec=require('child_process')[a23_0x354f('0x6')];const isImage=require('is-image');const format=require(a23_0x354f('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a23_0x354f('0x8'));const jwt=require(a23_0x354f('0x9'));class MqttService{constructor(_0x37a3ed){this[a23_0x354f('0xa')]=_0x37a3ed;this[a23_0x354f('0xb')]=a23_0x354f('0xc');this[a23_0x354f('0xd')]=new HttpClientService_1[(a23_0x354f('0xe'))]();}[a23_0x354f('0xf')](){this[a23_0x354f('0x10')]();}[a23_0x354f('0x11')](){console[a23_0x354f('0x12')]('mqttInit');const _0x1a26a4=a23_0x354f('0x13');const _0x464def='my-node-device';const _0xc342e1='my-registry';const _0x599fc6=a23_0x354f('0x14');const _0x3caa29=a23_0x354f('0x15');const _0x502210=a23_0x354f('0x16');const _0x1d6709=a23_0x354f('0x17');const _0x5264f1=0x1bb;const _0x4cd7c6=a23_0x354f('0x18');const _0x2e5ea6=0x5;const _0x20d06f=a23_0x354f('0x19')+_0x1a26a4+a23_0x354f('0x1a')+_0x599fc6+'/registries/'+_0xc342e1+a23_0x354f('0x1b')+_0x464def;const _0x296657={'host':_0x1d6709,'port':_0x5264f1,'clientId':_0x20d06f,'username':'unused','password':this[a23_0x354f('0x1c')](_0x1a26a4,_0x502210,_0x3caa29),'protocol':a23_0x354f('0x1d'),'secureProtocol':a23_0x354f('0x1e')};const _0x1f1f80=Math[a23_0x354f('0x1f')](Date['now']()/0x3e8);const _0x50e96e=mqtt[a23_0x354f('0x20')](_0x296657);_0x50e96e[a23_0x354f('0x21')](a23_0x354f('0x1b')+_0x464def+'/config',{'qos':0x1});_0x50e96e[a23_0x354f('0x21')]('/devices/'+_0x464def+a23_0x354f('0x22'),{'qos':0x1});_0x50e96e['subscribe'](a23_0x354f('0x1b')+_0x464def+'/commands/#',{'qos':0x0});const _0x39d654=a23_0x354f('0x1b')+_0x464def+'/'+_0x4cd7c6;_0x50e96e['on']('connect',_0x4711b1=>{console[a23_0x354f('0x12')](a23_0x354f('0x20'));if(!_0x4711b1){console[a23_0x354f('0x12')]('Client\x20not\x20connected...');}else{const _0x39d654=a23_0x354f('0x23');const _0x2a0ce8=_0xc342e1+'/'+_0x464def+'-payload-0';_0x50e96e[a23_0x354f('0x24')](_0x39d654,_0x2a0ce8,{'qos':0x1},_0x301741=>{console[a23_0x354f('0x12')]('publish\x20result:');console[a23_0x354f('0x12')](_0x301741);if(!_0x301741){}});}});_0x50e96e['on'](a23_0x354f('0x25'),()=>{console[a23_0x354f('0x12')](a23_0x354f('0x25'));});_0x50e96e['on'](a23_0x354f('0x26'),_0x4a7e28=>{console['log'](a23_0x354f('0x26'),_0x4a7e28);});_0x50e96e['on'](a23_0x354f('0x27'),(_0x31ab26,_0x34468e)=>{let _0x28434b='Message\x20received:\x20';console[a23_0x354f('0x12')](_0x31ab26);console[a23_0x354f('0x12')](_0x34468e+'');if(_0x31ab26===a23_0x354f('0x1b')+_0x464def+a23_0x354f('0x28')){_0x28434b=a23_0x354f('0x29');}else if(_0x31ab26[a23_0x354f('0x2a')](a23_0x354f('0x1b')+_0x464def+a23_0x354f('0x2b'))){_0x28434b=a23_0x354f('0x2c');}_0x28434b+=Buffer[a23_0x354f('0x2d')](_0x34468e,a23_0x354f('0x2e'))[a23_0x354f('0x2f')](a23_0x354f('0x30'));console[a23_0x354f('0x12')](_0x28434b);});_0x50e96e['on'](a23_0x354f('0x31'),()=>{});console[a23_0x354f('0x12')](_0x296657);}[a23_0x354f('0x10')](){console[a23_0x354f('0x12')](a23_0x354f('0x32'));this[a23_0x354f('0x33')]=uuidv4();console[a23_0x354f('0x12')]('this.clientId');console[a23_0x354f('0x12')](this[a23_0x354f('0x33')]);const _0xcde4e6={'clientId':this['clientId'],'username':a23_0x354f('0x34'),'password':a23_0x354f('0x35'),'clean':!![]};this[a23_0x354f('0x36')]=mqtt['connect']('mqtt://lulo.run',_0xcde4e6);this['mqttClient']['on']('connect',this[a23_0x354f('0x37')][a23_0x354f('0x38')](this));this[a23_0x354f('0x36')]['on'](a23_0x354f('0x27'),this[a23_0x354f('0x39')]['bind'](this));this[a23_0x354f('0x36')]['on']('close',()=>{console['log'](a23_0x354f('0x25'));});process['on'](a23_0x354f('0x3a'),this['handleAppExit'][a23_0x354f('0x38')](this));process['on'](a23_0x354f('0x3b'),this[a23_0x354f('0x3c')][a23_0x354f('0x38')](this));process['on'](a23_0x354f('0x3d'),this[a23_0x354f('0x3c')][a23_0x354f('0x38')](this));}[a23_0x354f('0x37')](){console['log'](a23_0x354f('0x3e')+this[a23_0x354f('0x33')]);this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x3f'));this['mqttClient'][a23_0x354f('0x21')](a23_0x354f('0x40'));this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x41'),{'qos':0x2});this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x42'),{'qos':0x2});this['mqttClient'][a23_0x354f('0x21')]('player/reload_playlist',{'qos':0x2});this[a23_0x354f('0x36')]['subscribe'](a23_0x354f('0x43'),{'qos':0x2});this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x44'),{'qos':0x2});this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x45'),{'qos':0x2});this[a23_0x354f('0x36')][a23_0x354f('0x21')](a23_0x354f('0x46'),{'qos':0x2});this['mqttClient'][a23_0x354f('0x21')]('player/turn_off_tv',{'qos':0x2});this[a23_0x354f('0x36')]['subscribe'](a23_0x354f('0x47'),{'qos':0x2});}[a23_0x354f('0x48')](){}[a23_0x354f('0x39')](_0x5881ac,_0x2456e3){console[a23_0x354f('0x12')]('received\x20message\x20%s\x20%s',_0x5881ac,_0x2456e3);switch(_0x5881ac){case a23_0x354f('0x3f'):return this[a23_0x354f('0x49')](_0x2456e3);case a23_0x354f('0x40'):return this[a23_0x354f('0x4a')](_0x2456e3);case a23_0x354f('0x41'):return this[a23_0x354f('0x4b')](_0x2456e3);case a23_0x354f('0x4c'):return this[a23_0x354f('0x4d')](_0x2456e3);case a23_0x354f('0x42'):return this[a23_0x354f('0x4e')](_0x2456e3);case'player/update':return this[a23_0x354f('0x4f')](_0x2456e3);case a23_0x354f('0x44'):return this[a23_0x354f('0x50')](_0x2456e3);case a23_0x354f('0x45'):return this['handleRegisterRequest'](_0x2456e3);case a23_0x354f('0x46'):return this['handleUpdateSettingsRequest'](_0x2456e3);case'player/turn_off_tv':return this['handleTurnOffTVRequest'](_0x2456e3);case a23_0x354f('0x47'):return this[a23_0x354f('0x51')](_0x2456e3);}}[a23_0x354f('0x52')](_0x3cd4f1){if(_0x3cd4f1==a23_0x354f('0x53')||_0x3cd4f1==String(this[a23_0x354f('0xa')][a23_0x354f('0x54')])){this[a23_0x354f('0xa')][a23_0x354f('0x55')]();}}[a23_0x354f('0x50')](_0x55e805){if(_0x55e805==a23_0x354f('0x53')||_0x55e805==String(this[a23_0x354f('0xa')]['playerId'])){}}[a23_0x354f('0x4f')](_0x1407aa){console[a23_0x354f('0x12')](a23_0x354f('0x56')+_0x1407aa);if(_0x1407aa==a23_0x354f('0x53')||_0x1407aa==String(this[a23_0x354f('0xa')]['playerId'])){const _0x4f7b1f=__dirname;const _0x1a59a5=require(a23_0x354f('0x57'))(_0x4f7b1f);console[a23_0x354f('0x12')]('Git\x20updating');_0x1a59a5[a23_0x354f('0x58')]((_0x1f10ef,_0x182e93)=>{if(_0x1f10ef){console[a23_0x354f('0x12')](a23_0x354f('0x59'));this[a23_0x354f('0x4f')](_0x1407aa);return;}else{}console[a23_0x354f('0x12')](a23_0x354f('0x5a'));console[a23_0x354f('0x12')](_0x182e93);if(_0x182e93&&_0x182e93[a23_0x354f('0x5b')][a23_0x354f('0x5c')]){this[a23_0x354f('0xa')][a23_0x354f('0x5d')]();}else{}});}}[a23_0x354f('0x4e')](_0x5dddc0){if(_0x5dddc0==a23_0x354f('0x53')||_0x5dddc0==String(this[a23_0x354f('0xa')][a23_0x354f('0x54')])){this[a23_0x354f('0xa')][a23_0x354f('0x5e')]();}}[a23_0x354f('0x4d')](_0x4a10ed){if(String(_0x4a10ed)==a23_0x354f('0x53')||String(_0x4a10ed)==String(this['syncPlaylistsService']['playerId'])){this[a23_0x354f('0xa')][a23_0x354f('0x5f')]();}}['handleRebootRequest'](_0x2b0b26){if(_0x2b0b26=='all'||_0x2b0b26==String(this['syncPlaylistsService']['playerId'])){console[a23_0x354f('0x12')](a23_0x354f('0x60'));try{this['syncPlaylistsService'][a23_0x354f('0x5d')]();}catch(_0x4557d0){console[a23_0x354f('0x12')](_0x4557d0);}}}['handleUpdateSettingsRequest'](_0x1b42a4){if(_0x1b42a4==a23_0x354f('0x53')||_0x1b42a4==String(this[a23_0x354f('0xa')][a23_0x354f('0x54')])){console[a23_0x354f('0x12')](a23_0x354f('0x61'));try{this['syncPlaylistsService'][a23_0x354f('0x62')]();}catch(_0x41704b){console[a23_0x354f('0x12')](_0x41704b);}}}[a23_0x354f('0x51')](_0x5d7e8d){if(_0x5d7e8d==a23_0x354f('0x53')||_0x5d7e8d==String(this[a23_0x354f('0xa')]['playerId'])){console[a23_0x354f('0x12')](a23_0x354f('0x63'));try{this[a23_0x354f('0xa')][a23_0x354f('0x64')]();}catch(_0x1921f9){console[a23_0x354f('0x12')](_0x1921f9);}}}[a23_0x354f('0x65')](_0x1f15a6){if(_0x1f15a6==a23_0x354f('0x53')||_0x1f15a6==String(this['syncPlaylistsService'][a23_0x354f('0x54')])){console['log'](a23_0x354f('0x66'));try{this[a23_0x354f('0xa')][a23_0x354f('0x67')]();}catch(_0x43393d){console[a23_0x354f('0x12')](_0x43393d);}}}['sendStateUpdate'](){console[a23_0x354f('0x12')]('sending\x20state\x20%s',this[a23_0x354f('0xb')]);this['mqttClient'][a23_0x354f('0x24')]('player/state',this['syncPlaylistsService'][a23_0x354f('0x54')]+'-'+this['state']);}[a23_0x354f('0x49')](_0x5bb14f){if(this['state']!=='open'&&this[a23_0x354f('0xb')]!=='opening'){console[a23_0x354f('0x12')](a23_0x354f('0x68'));this[a23_0x354f('0xb')]=a23_0x354f('0x69');this[a23_0x354f('0x6a')]();setTimeout(()=>{this[a23_0x354f('0xb')]=a23_0x354f('0x6b');this[a23_0x354f('0x6a')]();},0x1388);}}[a23_0x354f('0x4a')](_0x39b514){if(this['state']!==a23_0x354f('0xc')&&this['state']!==a23_0x354f('0x6c')){this['state']=a23_0x354f('0x6c');this['sendStateUpdate']();setTimeout(()=>{this[a23_0x354f('0xb')]='closed';this['sendStateUpdate']();},0x1388);}}[a23_0x354f('0x3c')](_0xa9385e,_0x5089f3){if(_0x5089f3){console[a23_0x354f('0x12')](_0x5089f3[a23_0x354f('0x6d')]);}this[a23_0x354f('0x36')][a23_0x354f('0x24')](a23_0x354f('0x6e'),a23_0x354f('0x6f'));}[a23_0x354f('0x1c')](_0xe11902,_0x19a1b2,_0xfb7c86){const _0x5d4578={'iat':Math[a23_0x354f('0x1f')](Date['now']()/0x3e8),'exp':Math['round'](Date[a23_0x354f('0x70')]()/0x3e8)+0x14*0x3c,'aud':_0xe11902};const _0x559a0d=fs[a23_0x354f('0x71')](_0x19a1b2);return jwt[a23_0x354f('0x72')](_0x5d4578,_0x559a0d,{'algorithm':_0xfb7c86});}}exports[a23_0x354f('0x73')]=MqttService;