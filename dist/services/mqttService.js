var a18_0x4720=['handleOpenRequest','open','opening','closed','closing','stack','player/connected','false','now','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','init','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','my-registry','resources/keys/rsa_private.pem','events','projects/','/locations/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','subscribe','/state','/commands/#','connect','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','toString','ascii','packetsend','mqttInit_mosquitto','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','received\x20message\x20%s\x20%s','player/open','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','registerClient','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','sendStateUpdate','sending\x20state\x20%s','player/state'];(function(_0x1a4302,_0x24fc26){var _0x799586=function(_0x4d1e0d){while(--_0x4d1e0d){_0x1a4302['push'](_0x1a4302['shift']());}};_0x799586(++_0x24fc26);}(a18_0x4720,0xde));var a18_0x35c0=function(_0x2fbeca,_0x302170){_0x2fbeca=_0x2fbeca-0x0;var _0x1ae02f=a18_0x4720[_0x2fbeca];return _0x1ae02f;};'use strict';Object[a18_0x35c0('0x0')](exports,a18_0x35c0('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x35c0('0x2'));const fs=require('fs');const fsExtra=require(a18_0x35c0('0x3'));const request=require(a18_0x35c0('0x4'));const progress=require(a18_0x35c0('0x5'));const spawn=require(a18_0x35c0('0x6'))['spawn'];const exec=require(a18_0x35c0('0x6'))[a18_0x35c0('0x7')];const isImage=require(a18_0x35c0('0x8'));const format=require(a18_0x35c0('0x9'));const os=require('os');const mqtt=require(a18_0x35c0('0xa'));const uuidv4=require(a18_0x35c0('0xb'));const jwt=require(a18_0x35c0('0xc'));class MqttService{constructor(_0x207641){this[a18_0x35c0('0xd')]=_0x207641;this[a18_0x35c0('0xe')]='closed';this[a18_0x35c0('0xf')]=new HttpClientService_1[(a18_0x35c0('0x10'))]();}[a18_0x35c0('0x11')](){this['mqttInit_mosquitto']();}[a18_0x35c0('0x12')](){console['log'](a18_0x35c0('0x13'));const _0x1ac6bd=a18_0x35c0('0x14');const _0x526b29=a18_0x35c0('0x15');const _0x5517ad=a18_0x35c0('0x16');const _0x3ec4ce='us-central1';const _0x1c62d3='RS256';const _0x21a505=a18_0x35c0('0x17');const _0x585092='mqtt.googleapis.com';const _0x224f16=0x1bb;const _0x446f7c=a18_0x35c0('0x18');const _0x4c349b=0x5;const _0xf9e80c=a18_0x35c0('0x19')+_0x1ac6bd+a18_0x35c0('0x1a')+_0x3ec4ce+'/registries/'+_0x5517ad+a18_0x35c0('0x1b')+_0x526b29;const _0xeca727={'host':_0x585092,'port':_0x224f16,'clientId':_0xf9e80c,'username':a18_0x35c0('0x1c'),'password':this[a18_0x35c0('0x1d')](_0x1ac6bd,_0x21a505,_0x1c62d3),'protocol':a18_0x35c0('0x1e'),'secureProtocol':a18_0x35c0('0x1f')};const _0x30fb17=Math[a18_0x35c0('0x20')](Date['now']()/0x3e8);const _0x46f3c4=mqtt['connect'](_0xeca727);_0x46f3c4[a18_0x35c0('0x21')](a18_0x35c0('0x1b')+_0x526b29+'/config',{'qos':0x1});_0x46f3c4[a18_0x35c0('0x21')](a18_0x35c0('0x1b')+_0x526b29+a18_0x35c0('0x22'),{'qos':0x1});_0x46f3c4[a18_0x35c0('0x21')]('/devices/'+_0x526b29+a18_0x35c0('0x23'),{'qos':0x0});const _0x1806ec=a18_0x35c0('0x1b')+_0x526b29+'/'+_0x446f7c;_0x46f3c4['on'](a18_0x35c0('0x24'),_0x18443a=>{console['log']('connect');if(!_0x18443a){console[a18_0x35c0('0x25')](a18_0x35c0('0x26'));}else{const _0x1806ec=a18_0x35c0('0x27');const _0x42f13c=_0x5517ad+'/'+_0x526b29+a18_0x35c0('0x28');_0x46f3c4[a18_0x35c0('0x29')](_0x1806ec,_0x42f13c,{'qos':0x1},_0x42cce3=>{console[a18_0x35c0('0x25')](a18_0x35c0('0x2a'));console[a18_0x35c0('0x25')](_0x42cce3);if(!_0x42cce3){}});}});_0x46f3c4['on'](a18_0x35c0('0x2b'),()=>{console[a18_0x35c0('0x25')](a18_0x35c0('0x2b'));});_0x46f3c4['on']('error',_0x2aee66=>{console[a18_0x35c0('0x25')]('error',_0x2aee66);});_0x46f3c4['on']('message',(_0x5b91c2,_0x1e96bd)=>{let _0x4a98f7=a18_0x35c0('0x2c');console[a18_0x35c0('0x25')](_0x5b91c2);console['log'](_0x1e96bd+'');if(_0x5b91c2===a18_0x35c0('0x1b')+_0x526b29+a18_0x35c0('0x2d')){_0x4a98f7=a18_0x35c0('0x2e');}else if(_0x5b91c2[a18_0x35c0('0x2f')](a18_0x35c0('0x1b')+_0x526b29+'/commands')){_0x4a98f7='Command\x20message\x20received:\x20';}_0x4a98f7+=Buffer['from'](_0x1e96bd,'base64')[a18_0x35c0('0x30')](a18_0x35c0('0x31'));console[a18_0x35c0('0x25')](_0x4a98f7);});_0x46f3c4['on'](a18_0x35c0('0x32'),()=>{});console[a18_0x35c0('0x25')](_0xeca727);}[a18_0x35c0('0x33')](){console[a18_0x35c0('0x25')](a18_0x35c0('0x13'));this['clientId']=uuidv4();console[a18_0x35c0('0x25')](a18_0x35c0('0x34'));console[a18_0x35c0('0x25')](this[a18_0x35c0('0x35')]);const _0x9c5d48={'clientId':this[a18_0x35c0('0x35')],'username':a18_0x35c0('0x36'),'password':a18_0x35c0('0x37'),'clean':!![]};this[a18_0x35c0('0x38')]=mqtt[a18_0x35c0('0x24')]('mqtt://lulo.run',_0x9c5d48);this['mqttClient']['on'](a18_0x35c0('0x24'),this[a18_0x35c0('0x39')][a18_0x35c0('0x3a')](this));this[a18_0x35c0('0x38')]['on'](a18_0x35c0('0x3b'),this[a18_0x35c0('0x3c')][a18_0x35c0('0x3a')](this));this[a18_0x35c0('0x38')]['on'](a18_0x35c0('0x2b'),()=>{console['log'](a18_0x35c0('0x2b'));});process['on'](a18_0x35c0('0x3d'),this[a18_0x35c0('0x3e')][a18_0x35c0('0x3a')](this));process['on'](a18_0x35c0('0x3f'),this[a18_0x35c0('0x3e')][a18_0x35c0('0x3a')](this));process['on'](a18_0x35c0('0x40'),this[a18_0x35c0('0x3e')][a18_0x35c0('0x3a')](this));}[a18_0x35c0('0x39')](){console[a18_0x35c0('0x25')](a18_0x35c0('0x41')+this[a18_0x35c0('0x35')]);this[a18_0x35c0('0x38')]['subscribe']('player/open');this[a18_0x35c0('0x38')][a18_0x35c0('0x21')](a18_0x35c0('0x42'));this['mqttClient'][a18_0x35c0('0x21')]('player/reboot',{'qos':0x2});this[a18_0x35c0('0x38')]['subscribe'](a18_0x35c0('0x43'),{'qos':0x2});this['mqttClient'][a18_0x35c0('0x21')](a18_0x35c0('0x44'),{'qos':0x2});this[a18_0x35c0('0x38')][a18_0x35c0('0x21')](a18_0x35c0('0x45'),{'qos':0x2});this[a18_0x35c0('0x38')][a18_0x35c0('0x21')](a18_0x35c0('0x46'),{'qos':0x2});this[a18_0x35c0('0x38')][a18_0x35c0('0x21')](a18_0x35c0('0x47'),{'qos':0x2});}['reportStatus'](){}[a18_0x35c0('0x3c')](_0x49b938,_0x4b16d9){console[a18_0x35c0('0x25')](a18_0x35c0('0x48'),_0x49b938,_0x4b16d9);switch(_0x49b938){case a18_0x35c0('0x49'):return this['handleOpenRequest'](_0x4b16d9);case a18_0x35c0('0x42'):return this[a18_0x35c0('0x4a')](_0x4b16d9);case'player/reboot':return this[a18_0x35c0('0x4b')](_0x4b16d9);case a18_0x35c0('0x44'):return this[a18_0x35c0('0x4c')](_0x4b16d9);case a18_0x35c0('0x43'):return this['handleLoadPlaylistRequest'](_0x4b16d9);case a18_0x35c0('0x45'):return this[a18_0x35c0('0x4d')](_0x4b16d9);case a18_0x35c0('0x46'):return this[a18_0x35c0('0x4e')](_0x4b16d9);case a18_0x35c0('0x47'):return this['handleRegisterRequest'](_0x4b16d9);}}[a18_0x35c0('0x4f')](_0xe09c97){if(_0xe09c97==a18_0x35c0('0x50')||_0xe09c97==String(this[a18_0x35c0('0xd')][a18_0x35c0('0x51')])){this[a18_0x35c0('0xd')][a18_0x35c0('0x52')]();}}[a18_0x35c0('0x4e')](_0x132ece){if(_0x132ece==a18_0x35c0('0x50')||_0x132ece==String(this['syncPlaylistsService'][a18_0x35c0('0x51')])){}}[a18_0x35c0('0x4d')](_0x49a53f){console[a18_0x35c0('0x25')]('handleUpdateRequest:\x20'+_0x49a53f);if(_0x49a53f==a18_0x35c0('0x50')||_0x49a53f==String(this['syncPlaylistsService']['playerId'])){const _0x1384ee=__dirname;const _0x297da1=require(a18_0x35c0('0x53'))(_0x1384ee);console[a18_0x35c0('0x25')](a18_0x35c0('0x54'));_0x297da1[a18_0x35c0('0x55')]((_0x526857,_0x97bdf)=>{if(_0x526857){console[a18_0x35c0('0x25')](a18_0x35c0('0x56'));this[a18_0x35c0('0x4d')](_0x49a53f);return;}else{}console['log'](a18_0x35c0('0x57'));console['log'](_0x97bdf);if(_0x97bdf&&_0x97bdf[a18_0x35c0('0x58')]['changes']){this[a18_0x35c0('0xd')][a18_0x35c0('0x59')]();}else{}});}}['handleLoadPlaylistRequest'](_0x29d819){if(_0x29d819==a18_0x35c0('0x50')||_0x29d819==String(this[a18_0x35c0('0xd')]['playerId'])){this['syncPlaylistsService'][a18_0x35c0('0x5a')]();}}[a18_0x35c0('0x4c')](_0x34dcdc){if(String(_0x34dcdc)==a18_0x35c0('0x50')||String(_0x34dcdc)==String(this['syncPlaylistsService']['playerId'])){this[a18_0x35c0('0xd')][a18_0x35c0('0x5b')]();}}[a18_0x35c0('0x4b')](_0x501fc6){if(_0x501fc6==a18_0x35c0('0x50')||_0x501fc6==String(this['syncPlaylistsService'][a18_0x35c0('0x51')])){console[a18_0x35c0('0x25')](a18_0x35c0('0x5c'));try{this[a18_0x35c0('0xd')]['reboot']();}catch(_0x107143){console['log'](_0x107143);}}}[a18_0x35c0('0x5d')](){console['log'](a18_0x35c0('0x5e'),this[a18_0x35c0('0xe')]);this['mqttClient'][a18_0x35c0('0x29')](a18_0x35c0('0x5f'),this[a18_0x35c0('0xd')][a18_0x35c0('0x51')]+'-'+this['state']);}[a18_0x35c0('0x60')](_0x5b71d6){if(this['state']!==a18_0x35c0('0x61')&&this[a18_0x35c0('0xe')]!==a18_0x35c0('0x62')){console[a18_0x35c0('0x25')]('opening\x20player\x20door');this[a18_0x35c0('0xe')]=a18_0x35c0('0x62');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x35c0('0xe')]=a18_0x35c0('0x61');this[a18_0x35c0('0x5d')]();},0x1388);}}[a18_0x35c0('0x4a')](_0x79c7d4){if(this[a18_0x35c0('0xe')]!==a18_0x35c0('0x63')&&this[a18_0x35c0('0xe')]!=='closing'){this['state']=a18_0x35c0('0x64');this[a18_0x35c0('0x5d')]();setTimeout(()=>{this[a18_0x35c0('0xe')]='closed';this[a18_0x35c0('0x5d')]();},0x1388);}}[a18_0x35c0('0x3e')](_0x463474,_0x2c36ad){if(_0x2c36ad){console['log'](_0x2c36ad[a18_0x35c0('0x65')]);}this['mqttClient'][a18_0x35c0('0x29')](a18_0x35c0('0x66'),a18_0x35c0('0x67'));}['createJwt'](_0x3cb8ec,_0x5c28d6,_0x41e419){const _0x534d13={'iat':Math['round'](Date[a18_0x35c0('0x68')]()/0x3e8),'exp':Math[a18_0x35c0('0x20')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x3cb8ec};const _0x7d9811=fs['readFileSync'](_0x5c28d6);return jwt[a18_0x35c0('0x69')](_0x534d13,_0x7d9811,{'algorithm':_0x41e419});}}exports['MqttService']=MqttService;