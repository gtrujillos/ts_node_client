var a18_0x5505=['turnOffTV','turnOnTV','sending\x20state\x20%s','open','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','false','createJwt','now','readFileSync','sign','MqttService','__esModule','./../infrastructure/HttpClientService','request','request-progress','spawn','child_process','exec','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','/locations/','/registries/','/devices/','unused','mqtts','TLSv1_2_method','round','connect','subscribe','/config','/commands/#','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','mqttInit','clientId','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','mqttClient_message','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/register','player/update_settings','received\x20message\x20%s\x20%s','handleOpenRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleRegisterRequest','handleUpdateSettingsRequest','player/turn_on_tv','handleTurnOnTVRequest','player/turn_off_tv','handleTurnOffTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','reset','reset\x20err:','clean','clean\x20result:','pull','Error\x20git\x20updated','Git\x20updated','summary','Git\x20no\x20changes','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOffTVRequest:\x20'];(function(_0x6a72fd,_0x2b6b4a){var _0x31b1d0=function(_0x47a1e6){while(--_0x47a1e6){_0x6a72fd['push'](_0x6a72fd['shift']());}};_0x31b1d0(++_0x2b6b4a);}(a18_0x5505,0x174));var a18_0x1a05=function(_0xc8c8e0,_0x53d9cb){_0xc8c8e0=_0xc8c8e0-0x0;var _0x2b76e4=a18_0x5505[_0xc8c8e0];return _0x2b76e4;};'use strict';Object['defineProperty'](exports,a18_0x1a05('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x1a05('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x1a05('0x2'));const progress=require(a18_0x1a05('0x3'));const spawn=require('child_process')[a18_0x1a05('0x4')];const exec=require(a18_0x1a05('0x5'))[a18_0x1a05('0x6')];const isImage=require(a18_0x1a05('0x7'));const format=require(a18_0x1a05('0x8'));const os=require('os');const mqtt=require(a18_0x1a05('0x9'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x1a05('0xa'));class MqttService{constructor(_0x4f41e1){this[a18_0x1a05('0xb')]=_0x4f41e1;this[a18_0x1a05('0xc')]=a18_0x1a05('0xd');this[a18_0x1a05('0xe')]=new HttpClientService_1[(a18_0x1a05('0xf'))]();}[a18_0x1a05('0x10')](){this[a18_0x1a05('0x11')]();}[a18_0x1a05('0x12')](){console[a18_0x1a05('0x13')]('mqttInit');const _0x39644f='velvety-glazing-252020';const _0xcb6fa6='my-node-device';const _0x1e5a18=a18_0x1a05('0x14');const _0x56cdfb=a18_0x1a05('0x15');const _0x4407b9='RS256';const _0x368b25=a18_0x1a05('0x16');const _0xeb541d=a18_0x1a05('0x17');const _0x589698=0x1bb;const _0x5ecc02='events';const _0x27cda0=0x5;const _0x3c4e88='projects/'+_0x39644f+a18_0x1a05('0x18')+_0x56cdfb+a18_0x1a05('0x19')+_0x1e5a18+a18_0x1a05('0x1a')+_0xcb6fa6;const _0x30a62e={'host':_0xeb541d,'port':_0x589698,'clientId':_0x3c4e88,'username':a18_0x1a05('0x1b'),'password':this['createJwt'](_0x39644f,_0x368b25,_0x4407b9),'protocol':a18_0x1a05('0x1c'),'secureProtocol':a18_0x1a05('0x1d')};const _0x4d1bef=Math[a18_0x1a05('0x1e')](Date['now']()/0x3e8);const _0x422c88=mqtt[a18_0x1a05('0x1f')](_0x30a62e);_0x422c88[a18_0x1a05('0x20')](a18_0x1a05('0x1a')+_0xcb6fa6+a18_0x1a05('0x21'),{'qos':0x1});_0x422c88[a18_0x1a05('0x20')]('/devices/'+_0xcb6fa6+'/state',{'qos':0x1});_0x422c88['subscribe'](a18_0x1a05('0x1a')+_0xcb6fa6+a18_0x1a05('0x22'),{'qos':0x0});const _0x1a3ac3='/devices/'+_0xcb6fa6+'/'+_0x5ecc02;_0x422c88['on'](a18_0x1a05('0x1f'),_0x19d169=>{console['log'](a18_0x1a05('0x1f'));if(!_0x19d169){console[a18_0x1a05('0x13')]('Client\x20not\x20connected...');}else{const _0x1a3ac3=a18_0x1a05('0x23');const _0x47ef51=_0x1e5a18+'/'+_0xcb6fa6+a18_0x1a05('0x24');_0x422c88[a18_0x1a05('0x25')](_0x1a3ac3,_0x47ef51,{'qos':0x1},_0x237e39=>{console['log'](a18_0x1a05('0x26'));console['log'](_0x237e39);if(!_0x237e39){}});}});_0x422c88['on']('close',()=>{console['log'](a18_0x1a05('0x27'));});_0x422c88['on'](a18_0x1a05('0x28'),_0xd2a820=>{console[a18_0x1a05('0x13')](a18_0x1a05('0x28'),_0xd2a820);});_0x422c88['on']('message',(_0x59189d,_0x5dbf7c)=>{let _0x2a3a79='Message\x20received:\x20';console['log'](_0x59189d);console[a18_0x1a05('0x13')](_0x5dbf7c+'');if(_0x59189d===a18_0x1a05('0x1a')+_0xcb6fa6+a18_0x1a05('0x21')){_0x2a3a79=a18_0x1a05('0x29');}else if(_0x59189d[a18_0x1a05('0x2a')](a18_0x1a05('0x1a')+_0xcb6fa6+a18_0x1a05('0x2b'))){_0x2a3a79=a18_0x1a05('0x2c');}_0x2a3a79+=Buffer[a18_0x1a05('0x2d')](_0x5dbf7c,a18_0x1a05('0x2e'))[a18_0x1a05('0x2f')]('ascii');console[a18_0x1a05('0x13')](_0x2a3a79);});_0x422c88['on']('packetsend',()=>{});console[a18_0x1a05('0x13')](_0x30a62e);}[a18_0x1a05('0x11')](){console[a18_0x1a05('0x13')](a18_0x1a05('0x30'));this[a18_0x1a05('0x31')]=uuidv4();console[a18_0x1a05('0x13')](a18_0x1a05('0x32'));console[a18_0x1a05('0x13')](this[a18_0x1a05('0x31')]);const _0x304769={'clientId':this[a18_0x1a05('0x31')],'username':'lulo_mqtt','password':a18_0x1a05('0x33'),'clean':!![]};this[a18_0x1a05('0x34')]=mqtt[a18_0x1a05('0x1f')](a18_0x1a05('0x35'),_0x304769);this[a18_0x1a05('0x34')]['on'](a18_0x1a05('0x1f'),this[a18_0x1a05('0x36')]['bind'](this));this[a18_0x1a05('0x34')]['on']('message',this[a18_0x1a05('0x37')][a18_0x1a05('0x38')](this));this[a18_0x1a05('0x34')]['on'](a18_0x1a05('0x27'),()=>{console[a18_0x1a05('0x13')](a18_0x1a05('0x27'));});process['on'](a18_0x1a05('0x39'),this[a18_0x1a05('0x3a')][a18_0x1a05('0x38')](this));process['on'](a18_0x1a05('0x3b'),this[a18_0x1a05('0x3a')]['bind'](this));process['on'](a18_0x1a05('0x3c'),this[a18_0x1a05('0x3a')][a18_0x1a05('0x38')](this));}['mqttClient_connect'](){console[a18_0x1a05('0x13')](a18_0x1a05('0x3d')+this[a18_0x1a05('0x31')]);this[a18_0x1a05('0x34')][a18_0x1a05('0x20')](a18_0x1a05('0x3e'));this[a18_0x1a05('0x34')]['subscribe'](a18_0x1a05('0x3f'));this['mqttClient'][a18_0x1a05('0x20')](a18_0x1a05('0x40'),{'qos':0x2});this[a18_0x1a05('0x34')][a18_0x1a05('0x20')](a18_0x1a05('0x41'),{'qos':0x2});this[a18_0x1a05('0x34')][a18_0x1a05('0x20')](a18_0x1a05('0x42'),{'qos':0x2});this[a18_0x1a05('0x34')][a18_0x1a05('0x20')](a18_0x1a05('0x43'),{'qos':0x2});this[a18_0x1a05('0x34')][a18_0x1a05('0x20')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x1a05('0x20')](a18_0x1a05('0x44'),{'qos':0x2});this[a18_0x1a05('0x34')][a18_0x1a05('0x20')](a18_0x1a05('0x45'),{'qos':0x2});}['reportStatus'](){}[a18_0x1a05('0x37')](_0x20f4e6,_0x48b651){console[a18_0x1a05('0x13')](a18_0x1a05('0x46'),_0x20f4e6,_0x48b651);switch(_0x20f4e6){case a18_0x1a05('0x3e'):return this[a18_0x1a05('0x47')](_0x48b651);case a18_0x1a05('0x3f'):return this['handleCloseRequest'](_0x48b651);case a18_0x1a05('0x40'):return this['handleRebootRequest'](_0x48b651);case'player/reload_playlist':return this[a18_0x1a05('0x48')](_0x48b651);case a18_0x1a05('0x41'):return this[a18_0x1a05('0x49')](_0x48b651);case'player/update':return this[a18_0x1a05('0x4a')](_0x48b651);case'player/ifconfig':return this['handleIfconfigRequest'](_0x48b651);case a18_0x1a05('0x44'):return this[a18_0x1a05('0x4b')](_0x48b651);case a18_0x1a05('0x45'):return this[a18_0x1a05('0x4c')](_0x48b651);case a18_0x1a05('0x4d'):return this[a18_0x1a05('0x4e')](_0x48b651);case a18_0x1a05('0x4f'):return this[a18_0x1a05('0x50')](_0x48b651);}}[a18_0x1a05('0x4b')](_0x5f20ac){if(_0x5f20ac==a18_0x1a05('0x51')||_0x5f20ac==String(this[a18_0x1a05('0xb')][a18_0x1a05('0x52')])){this[a18_0x1a05('0xb')][a18_0x1a05('0x53')]();}}['handleIfconfigRequest'](_0x995a47){if(_0x995a47=='all'||_0x995a47==String(this[a18_0x1a05('0xb')]['playerId'])){}}[a18_0x1a05('0x4a')](_0xefddc6){console['log'](a18_0x1a05('0x54')+_0xefddc6);if(_0xefddc6==a18_0x1a05('0x51')||_0xefddc6==String(this[a18_0x1a05('0xb')][a18_0x1a05('0x52')])){const _0x20bd6d=__dirname;const _0x207943=require(a18_0x1a05('0x55'))(_0x20bd6d);console[a18_0x1a05('0x13')](a18_0x1a05('0x56'));_0x207943[a18_0x1a05('0x57')]('hard',(_0x1af8cc,_0xf5e333)=>{console[a18_0x1a05('0x13')](a18_0x1a05('0x58')+_0x1af8cc);_0x207943[a18_0x1a05('0x59')]('f',(_0x1af8cc,_0xf5e333)=>{console['log'](a18_0x1a05('0x5a')+_0x1af8cc);_0x207943[a18_0x1a05('0x5b')]((_0x1af8cc,_0x59f70c)=>{if(_0x1af8cc){console[a18_0x1a05('0x13')](a18_0x1a05('0x5c'));this[a18_0x1a05('0x4a')](_0xefddc6);return;}else{}console[a18_0x1a05('0x13')](a18_0x1a05('0x5d'));console[a18_0x1a05('0x13')](_0x59f70c);if(_0x59f70c&&_0x59f70c[a18_0x1a05('0x5e')]['changes']){this[a18_0x1a05('0xb')]['reboot']();}else{console[a18_0x1a05('0x13')](a18_0x1a05('0x5f'));}});});});}}[a18_0x1a05('0x49')](_0x3a6669){if(_0x3a6669==a18_0x1a05('0x51')||_0x3a6669==String(this[a18_0x1a05('0xb')]['playerId'])){this['syncPlaylistsService'][a18_0x1a05('0x60')]();}}[a18_0x1a05('0x48')](_0x33ab52){if(String(_0x33ab52)==a18_0x1a05('0x51')||String(_0x33ab52)==String(this[a18_0x1a05('0xb')][a18_0x1a05('0x52')])){this[a18_0x1a05('0xb')][a18_0x1a05('0x61')]();}}[a18_0x1a05('0x62')](_0x488bd6){if(_0x488bd6==a18_0x1a05('0x51')||_0x488bd6==String(this[a18_0x1a05('0xb')]['playerId'])){console[a18_0x1a05('0x13')](a18_0x1a05('0x63'));try{this[a18_0x1a05('0xb')][a18_0x1a05('0x64')]();}catch(_0x5e792e){console['log'](_0x5e792e);}}}[a18_0x1a05('0x4c')](_0x204450){if(_0x204450==a18_0x1a05('0x51')||_0x204450==String(this[a18_0x1a05('0xb')][a18_0x1a05('0x52')])){console[a18_0x1a05('0x13')](a18_0x1a05('0x65'));try{this[a18_0x1a05('0xb')][a18_0x1a05('0x66')]();}catch(_0x164b07){console[a18_0x1a05('0x13')](_0x164b07);}}}[a18_0x1a05('0x50')](_0x3716ef){if(_0x3716ef==a18_0x1a05('0x51')||_0x3716ef==String(this['syncPlaylistsService']['playerId'])){console[a18_0x1a05('0x13')](a18_0x1a05('0x67'));try{this[a18_0x1a05('0xb')][a18_0x1a05('0x68')]();}catch(_0x2d4c63){console[a18_0x1a05('0x13')](_0x2d4c63);}}}['handleTurnOnTVRequest'](_0x1bcf4f){if(_0x1bcf4f==a18_0x1a05('0x51')||_0x1bcf4f==String(this[a18_0x1a05('0xb')][a18_0x1a05('0x52')])){console[a18_0x1a05('0x13')]('handleTurnOnTVRequest:\x20');try{this[a18_0x1a05('0xb')][a18_0x1a05('0x69')]();}catch(_0x108e42){console[a18_0x1a05('0x13')](_0x108e42);}}}['sendStateUpdate'](){console[a18_0x1a05('0x13')](a18_0x1a05('0x6a'),this[a18_0x1a05('0xc')]);this[a18_0x1a05('0x34')][a18_0x1a05('0x25')]('player/state',this[a18_0x1a05('0xb')]['playerId']+'-'+this[a18_0x1a05('0xc')]);}['handleOpenRequest'](_0x1249e8){if(this[a18_0x1a05('0xc')]!==a18_0x1a05('0x6b')&&this['state']!==a18_0x1a05('0x6c')){console[a18_0x1a05('0x13')](a18_0x1a05('0x6d'));this[a18_0x1a05('0xc')]=a18_0x1a05('0x6c');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1a05('0xc')]=a18_0x1a05('0x6b');this[a18_0x1a05('0x6e')]();},0x1388);}}[a18_0x1a05('0x6f')](_0x5576ee){if(this[a18_0x1a05('0xc')]!=='closed'&&this[a18_0x1a05('0xc')]!==a18_0x1a05('0x70')){this[a18_0x1a05('0xc')]=a18_0x1a05('0x70');this[a18_0x1a05('0x6e')]();setTimeout(()=>{this[a18_0x1a05('0xc')]=a18_0x1a05('0xd');this[a18_0x1a05('0x6e')]();},0x1388);}}[a18_0x1a05('0x3a')](_0x5c90a5,_0x5561b8){if(_0x5561b8){console['log'](_0x5561b8['stack']);}this[a18_0x1a05('0x34')][a18_0x1a05('0x25')]('player/connected',a18_0x1a05('0x71'));}[a18_0x1a05('0x72')](_0x1fe9ca,_0x1055d9,_0x232f73){const _0x58e9ab={'iat':Math[a18_0x1a05('0x1e')](Date[a18_0x1a05('0x73')]()/0x3e8),'exp':Math[a18_0x1a05('0x1e')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x1fe9ca};const _0x475263=fs[a18_0x1a05('0x74')](_0x1055d9);return jwt[a18_0x1a05('0x75')](_0x58e9ab,_0x475263,{'algorithm':_0x232f73});}}exports[a18_0x1a05('0x76')]=MqttService;