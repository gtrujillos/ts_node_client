var a18_0x2357=['request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','closed','httpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','mqttClient','connect','mqttClient_message','bind','handleAppExit','uncaughtException','mqttClient_connect','subscribe','player/open','player/close','player/load_playlist','player/reload_playlist','player/register','reportStatus','handleOpenRequest','handleCloseRequest','player/reboot','handleLoadPlaylistRequest','player/update','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','pull','Git\x20updated','changes','shutdown','loadMediaList','reloadMediaList','now','sending\x20state\x20%s','publish','player/state','state','open','opening\x20player\x20door','sendStateUpdate','closing','stack','player/connected','false','defineProperty','fs-extra'];(function(_0x172299,_0x4fabcb){var _0x45c790=function(_0x2ad19f){while(--_0x2ad19f){_0x172299['push'](_0x172299['shift']());}};_0x45c790(++_0x4fabcb);}(a18_0x2357,0x178));var a18_0x2e57=function(_0x1a624d,_0x341de6){_0x1a624d=_0x1a624d-0x0;var _0x386033=a18_0x2357[_0x1a624d];return _0x386033;};'use strict';Object[a18_0x2e57('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x2e57('0x1'));const request=require('request');const progress=require(a18_0x2e57('0x2'));const spawn=require(a18_0x2e57('0x3'))[a18_0x2e57('0x4')];const isImage=require(a18_0x2e57('0x5'));const format=require(a18_0x2e57('0x6'));const os=require('os');const mqtt=require(a18_0x2e57('0x7'));const uuidv4=require(a18_0x2e57('0x8'));class MqttService{constructor(_0x5bcbb7){this[a18_0x2e57('0x9')]=_0x5bcbb7;this['state']=a18_0x2e57('0xa');this[a18_0x2e57('0xb')]=new HttpClientService_1['HttpClientService']();}[a18_0x2e57('0xc')](){this[a18_0x2e57('0xd')]();}[a18_0x2e57('0xd')](){console[a18_0x2e57('0xe')]('mqttInit');this[a18_0x2e57('0xf')]=uuidv4();console['log'](a18_0x2e57('0x10'));console[a18_0x2e57('0xe')](this[a18_0x2e57('0xf')]);const _0x1a8033={'clientId':this[a18_0x2e57('0xf')],'username':a18_0x2e57('0x11'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x2e57('0x12')]=mqtt[a18_0x2e57('0x13')]('mqtt://lulo.run',_0x1a8033);this[a18_0x2e57('0x12')]['on'](a18_0x2e57('0x13'),this['mqttClient_connect']['bind'](this));this[a18_0x2e57('0x12')]['on']('message',this[a18_0x2e57('0x14')][a18_0x2e57('0x15')](this));process['on']('exit',this[a18_0x2e57('0x16')]['bind'](this));process['on']('SIGINT',this[a18_0x2e57('0x16')]['bind'](this));process['on'](a18_0x2e57('0x17'),this['handleAppExit'][a18_0x2e57('0x15')](this));}[a18_0x2e57('0x18')](){console[a18_0x2e57('0xe')]('Connected\x20to\x20broker\x20client:'+this['clientId']);this['mqttClient'][a18_0x2e57('0x19')](a18_0x2e57('0x1a'));this[a18_0x2e57('0x12')][a18_0x2e57('0x19')](a18_0x2e57('0x1b'));this[a18_0x2e57('0x12')][a18_0x2e57('0x19')]('player/reboot',{'qos':0x2});this[a18_0x2e57('0x12')][a18_0x2e57('0x19')](a18_0x2e57('0x1c'),{'qos':0x2});this[a18_0x2e57('0x12')][a18_0x2e57('0x19')](a18_0x2e57('0x1d'),{'qos':0x2});this[a18_0x2e57('0x12')][a18_0x2e57('0x19')]('player/update',{'qos':0x2});this['mqttClient'][a18_0x2e57('0x19')]('player/ifconfig',{'qos':0x2});this[a18_0x2e57('0x12')][a18_0x2e57('0x19')](a18_0x2e57('0x1e'),{'qos':0x2});}[a18_0x2e57('0x1f')](){}[a18_0x2e57('0x14')](_0x1a40a5,_0x7e413c){console[a18_0x2e57('0xe')]('received\x20message\x20%s\x20%s',_0x1a40a5,_0x7e413c);switch(_0x1a40a5){case'player/open':return this[a18_0x2e57('0x20')](_0x7e413c);case'player/close':return this[a18_0x2e57('0x21')](_0x7e413c);case a18_0x2e57('0x22'):return this['handleRebootRequest'](_0x7e413c);case a18_0x2e57('0x1d'):return this['handleReloadPlaylistRequest'](_0x7e413c);case a18_0x2e57('0x1c'):return this[a18_0x2e57('0x23')](_0x7e413c);case a18_0x2e57('0x24'):return this[a18_0x2e57('0x25')](_0x7e413c);case a18_0x2e57('0x26'):return this[a18_0x2e57('0x27')](_0x7e413c);case a18_0x2e57('0x1e'):return this[a18_0x2e57('0x28')](_0x7e413c);}}['handleRegisterRequest'](_0xb623f9){if(_0xb623f9==a18_0x2e57('0x29')||_0xb623f9==String(this['syncPlaylistsService'][a18_0x2e57('0x2a')])){this[a18_0x2e57('0x9')][a18_0x2e57('0x2b')]();}}['handleIfconfigRequest'](_0x23ffca){if(_0x23ffca==a18_0x2e57('0x29')||_0x23ffca==String(this[a18_0x2e57('0x9')][a18_0x2e57('0x2a')])){}}[a18_0x2e57('0x25')](_0xca5e4a){console['log'](a18_0x2e57('0x2c')+_0xca5e4a);if(_0xca5e4a==a18_0x2e57('0x29')||_0xca5e4a==String(this[a18_0x2e57('0x9')][a18_0x2e57('0x2a')])){const _0x5eb42b=__dirname;const _0x59f802=require('simple-git')(_0x5eb42b);console['log']('Git\x20updating');_0x59f802[a18_0x2e57('0x2d')]((_0x1c7313,_0xf230ee)=>{if(_0x1c7313){console[a18_0x2e57('0xe')]('Error\x20git\x20updated');this['handleUpdateRequest'](_0xca5e4a);return;}else{}console['log'](a18_0x2e57('0x2e'));console['log'](_0xf230ee);if(_0xf230ee&&_0xf230ee['summary'][a18_0x2e57('0x2f')]){const _0x15e6e9=spawn(a18_0x2e57('0x30'),['-r','now']);}else{}});}}[a18_0x2e57('0x23')](_0x29d522){if(_0x29d522=='all'||_0x29d522==String(this['syncPlaylistsService'][a18_0x2e57('0x2a')])){this['syncPlaylistsService'][a18_0x2e57('0x31')]();}}['handleReloadPlaylistRequest'](_0x50ddf5){if(String(_0x50ddf5)==a18_0x2e57('0x29')||String(_0x50ddf5)==String(this[a18_0x2e57('0x9')][a18_0x2e57('0x2a')])){this['syncPlaylistsService'][a18_0x2e57('0x32')]();}}['handleRebootRequest'](_0x56ca5e){if(_0x56ca5e==a18_0x2e57('0x29')||_0x56ca5e==String(this[a18_0x2e57('0x9')][a18_0x2e57('0x2a')])){const _0x692976=spawn(a18_0x2e57('0x30'),['-r',a18_0x2e57('0x33')]);}}['sendStateUpdate'](){console[a18_0x2e57('0xe')](a18_0x2e57('0x34'),this['state']);this[a18_0x2e57('0x12')][a18_0x2e57('0x35')](a18_0x2e57('0x36'),this[a18_0x2e57('0x9')]['playerId']+'-'+this[a18_0x2e57('0x37')]);}[a18_0x2e57('0x20')](_0x365373){if(this[a18_0x2e57('0x37')]!==a18_0x2e57('0x38')&&this[a18_0x2e57('0x37')]!=='opening'){console['log'](a18_0x2e57('0x39'));this[a18_0x2e57('0x37')]='opening';this[a18_0x2e57('0x3a')]();setTimeout(()=>{this[a18_0x2e57('0x37')]=a18_0x2e57('0x38');this['sendStateUpdate']();},0x1388);}}[a18_0x2e57('0x21')](_0x6494c1){if(this[a18_0x2e57('0x37')]!=='closed'&&this[a18_0x2e57('0x37')]!=='closing'){this['state']=a18_0x2e57('0x3b');this[a18_0x2e57('0x3a')]();setTimeout(()=>{this[a18_0x2e57('0x37')]='closed';this[a18_0x2e57('0x3a')]();},0x1388);}}[a18_0x2e57('0x16')](_0x782816,_0x20e51c){if(_0x20e51c){console['log'](_0x20e51c[a18_0x2e57('0x3c')]);}this[a18_0x2e57('0x12')][a18_0x2e57('0x35')](a18_0x2e57('0x3d'),a18_0x2e57('0x3e'));}}exports['MqttService']=MqttService;