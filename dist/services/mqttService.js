var a18_0x4b52=['sending\x20state\x20%s','state','publish','player/state','open','opening','sendStateUpdate','handleCloseRequest','closing','player/connected','false','MqttService','__esModule','fs-extra','request','request-progress','child_process','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit','clientId','log','this.clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','mqttClient_message','bind','exit','handleAppExit','SIGINT','uncaughtException','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','registerClient','all','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','changes','shutdown','now','loadMediaList','reloadMediaList'];(function(_0x46aea4,_0x162266){var _0x55964f=function(_0x4ea669){while(--_0x4ea669){_0x46aea4['push'](_0x46aea4['shift']());}};_0x55964f(++_0x162266);}(a18_0x4b52,0x9a));var a18_0x1061=function(_0x55f028,_0x59e251){_0x55f028=_0x55f028-0x0;var _0x3ac296=a18_0x4b52[_0x55f028];return _0x3ac296;};'use strict';Object['defineProperty'](exports,a18_0x1061('0x0'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x1061('0x1'));const request=require(a18_0x1061('0x2'));const progress=require(a18_0x1061('0x3'));const spawn=require(a18_0x1061('0x4'))['spawn'];const isImage=require(a18_0x1061('0x5'));const format=require(a18_0x1061('0x6'));const os=require('os');const mqtt=require(a18_0x1061('0x7'));const uuidv4=require(a18_0x1061('0x8'));class MqttService{constructor(_0x1f0b39){this[a18_0x1061('0x9')]=_0x1f0b39;this['state']=a18_0x1061('0xa');this[a18_0x1061('0xb')]=new HttpClientService_1[(a18_0x1061('0xc'))]();}[a18_0x1061('0xd')](){this[a18_0x1061('0xe')]();}[a18_0x1061('0xe')](){console['log']('mqttInit');this[a18_0x1061('0xf')]=uuidv4();console[a18_0x1061('0x10')](a18_0x1061('0x11'));console['log'](this[a18_0x1061('0xf')]);const _0x14a90c={'clientId':this[a18_0x1061('0xf')],'username':a18_0x1061('0x12'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x1061('0x13')]=mqtt[a18_0x1061('0x14')](a18_0x1061('0x15'),_0x14a90c);this[a18_0x1061('0x13')]['on'](a18_0x1061('0x14'),this[a18_0x1061('0x16')]['bind'](this));this['mqttClient']['on']('message',this[a18_0x1061('0x17')][a18_0x1061('0x18')](this));process['on'](a18_0x1061('0x19'),this[a18_0x1061('0x1a')]['bind'](this));process['on'](a18_0x1061('0x1b'),this[a18_0x1061('0x1a')][a18_0x1061('0x18')](this));process['on'](a18_0x1061('0x1c'),this[a18_0x1061('0x1a')][a18_0x1061('0x18')](this));}[a18_0x1061('0x16')](){console[a18_0x1061('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x1061('0xf')]);this[a18_0x1061('0x13')][a18_0x1061('0x1d')](a18_0x1061('0x1e'));this[a18_0x1061('0x13')][a18_0x1061('0x1d')](a18_0x1061('0x1f'));this[a18_0x1061('0x13')]['subscribe'](a18_0x1061('0x20'),{'qos':0x2});this['mqttClient'][a18_0x1061('0x1d')](a18_0x1061('0x21'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x1061('0x22'),{'qos':0x2});this['mqttClient'][a18_0x1061('0x1d')]('player/update',{'qos':0x2});this[a18_0x1061('0x13')]['subscribe'](a18_0x1061('0x23'),{'qos':0x2});this[a18_0x1061('0x13')][a18_0x1061('0x1d')]('player/register',{'qos':0x2});}[a18_0x1061('0x24')](){}[a18_0x1061('0x17')](_0xf6114d,_0x23ac54){console['log'](a18_0x1061('0x25'),_0xf6114d,_0x23ac54);switch(_0xf6114d){case a18_0x1061('0x1e'):return this[a18_0x1061('0x26')](_0x23ac54);case a18_0x1061('0x1f'):return this['handleCloseRequest'](_0x23ac54);case a18_0x1061('0x20'):return this[a18_0x1061('0x27')](_0x23ac54);case a18_0x1061('0x22'):return this[a18_0x1061('0x28')](_0x23ac54);case a18_0x1061('0x21'):return this[a18_0x1061('0x29')](_0x23ac54);case'player/update':return this[a18_0x1061('0x2a')](_0x23ac54);case a18_0x1061('0x23'):return this[a18_0x1061('0x2b')](_0x23ac54);case a18_0x1061('0x2c'):return this['handleRegisterRequest'](_0x23ac54);}}['handleRegisterRequest'](_0x3684a1){if(_0x3684a1=='all'||_0x3684a1==String(this[a18_0x1061('0x9')]['playerId'])){this['syncPlaylistsService'][a18_0x1061('0x2d')]();}}[a18_0x1061('0x2b')](_0xb7b984){if(_0xb7b984==a18_0x1061('0x2e')||_0xb7b984==String(this[a18_0x1061('0x9')][a18_0x1061('0x2f')])){}}[a18_0x1061('0x2a')](_0x2c32e9){console[a18_0x1061('0x10')](a18_0x1061('0x30')+_0x2c32e9);if(_0x2c32e9=='all'||_0x2c32e9==String(this['syncPlaylistsService'][a18_0x1061('0x2f')])){const _0x5b2d33=__dirname;const _0x3802cc=require(a18_0x1061('0x31'))(_0x5b2d33);console[a18_0x1061('0x10')](a18_0x1061('0x32'));_0x3802cc[a18_0x1061('0x33')]((_0xd057e3,_0x2986b1)=>{if(_0xd057e3){console['log'](a18_0x1061('0x34'));this['handleUpdateRequest'](_0x2c32e9);return;}else{}console[a18_0x1061('0x10')](a18_0x1061('0x35'));console['log'](_0x2986b1);if(_0x2986b1&&_0x2986b1['summary'][a18_0x1061('0x36')]){const _0x141e66=spawn(a18_0x1061('0x37'),['-r',a18_0x1061('0x38')]);}else{}});}}[a18_0x1061('0x29')](_0x3b63ab){if(_0x3b63ab==a18_0x1061('0x2e')||_0x3b63ab==String(this[a18_0x1061('0x9')][a18_0x1061('0x2f')])){this[a18_0x1061('0x9')][a18_0x1061('0x39')]();}}['handleReloadPlaylistRequest'](_0x4e150e){if(String(_0x4e150e)==a18_0x1061('0x2e')||String(_0x4e150e)==String(this['syncPlaylistsService'][a18_0x1061('0x2f')])){this[a18_0x1061('0x9')][a18_0x1061('0x3a')]();}}[a18_0x1061('0x27')](_0x2e892a){if(_0x2e892a==a18_0x1061('0x2e')||_0x2e892a==String(this[a18_0x1061('0x9')][a18_0x1061('0x2f')])){const _0x1008f3=spawn(a18_0x1061('0x37'),['-r',a18_0x1061('0x38')]);}}['sendStateUpdate'](){console['log'](a18_0x1061('0x3b'),this[a18_0x1061('0x3c')]);this[a18_0x1061('0x13')][a18_0x1061('0x3d')](a18_0x1061('0x3e'),this[a18_0x1061('0x9')][a18_0x1061('0x2f')]+'-'+this[a18_0x1061('0x3c')]);}['handleOpenRequest'](_0xe46171){if(this['state']!==a18_0x1061('0x3f')&&this[a18_0x1061('0x3c')]!==a18_0x1061('0x40')){console[a18_0x1061('0x10')]('opening\x20player\x20door');this[a18_0x1061('0x3c')]='opening';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1061('0x3c')]='open';this[a18_0x1061('0x41')]();},0x1388);}}[a18_0x1061('0x42')](_0x3c01d3){if(this[a18_0x1061('0x3c')]!==a18_0x1061('0xa')&&this[a18_0x1061('0x3c')]!==a18_0x1061('0x43')){this[a18_0x1061('0x3c')]=a18_0x1061('0x43');this[a18_0x1061('0x41')]();setTimeout(()=>{this['state']=a18_0x1061('0xa');this[a18_0x1061('0x41')]();},0x1388);}}[a18_0x1061('0x1a')](_0x2ce23d,_0x22abc6){if(_0x22abc6){console[a18_0x1061('0x10')](_0x22abc6['stack']);}this['mqttClient'][a18_0x1061('0x3d')](a18_0x1061('0x44'),a18_0x1061('0x45'));}}exports[a18_0x1061('0x46')]=MqttService;