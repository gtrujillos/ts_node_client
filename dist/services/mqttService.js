var a18_0xb17d=['child_process','is-image','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','log','Client\x20not\x20connected...','-payload-0','publish','close','error','message','startsWith','base64','ascii','packetsend','clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/load_playlist','player/ifconfig','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','registerClient','all','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','reboot','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','turnOnTV','turnOffTV','sendStateUpdate','player/state','opening','opening\x20player\x20door','open','handleCloseRequest','closing','stack','false','readFileSync','sign','MqttService','defineProperty','__esModule','request'];(function(_0x16e2e5,_0x26deb2){var _0x561e83=function(_0x1db0f6){while(--_0x1db0f6){_0x16e2e5['push'](_0x16e2e5['shift']());}};_0x561e83(++_0x26deb2);}(a18_0xb17d,0x1a5));var a18_0x2c81=function(_0x11ef99,_0x513558){_0x11ef99=_0x11ef99-0x0;var _0x5b3ffd=a18_0xb17d[_0x11ef99];return _0x5b3ffd;};'use strict';Object[a18_0x2c81('0x0')](exports,a18_0x2c81('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x2c81('0x2'));const progress=require('request-progress');const spawn=require(a18_0x2c81('0x3'))['spawn'];const exec=require(a18_0x2c81('0x3'))['exec'];const isImage=require(a18_0x2c81('0x4'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x2c81('0x5'));const uuidv4=require(a18_0x2c81('0x6'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x508c75){this[a18_0x2c81('0x7')]=_0x508c75;this[a18_0x2c81('0x8')]=a18_0x2c81('0x9');this[a18_0x2c81('0xa')]=new HttpClientService_1[(a18_0x2c81('0xb'))]();}[a18_0x2c81('0xc')](){this[a18_0x2c81('0xd')]();}[a18_0x2c81('0xe')](){console['log'](a18_0x2c81('0xf'));const _0x58d50d='velvety-glazing-252020';const _0x20e63a=a18_0x2c81('0x10');const _0x3baad3=a18_0x2c81('0x11');const _0x2ca70c=a18_0x2c81('0x12');const _0x40e500=a18_0x2c81('0x13');const _0x683a3c=a18_0x2c81('0x14');const _0x4537fe=a18_0x2c81('0x15');const _0x48a6d2=0x1bb;const _0xdf4b4d=a18_0x2c81('0x16');const _0x5af955=0x5;const _0x56ce7f=a18_0x2c81('0x17')+_0x58d50d+'/locations/'+_0x2ca70c+a18_0x2c81('0x18')+_0x3baad3+a18_0x2c81('0x19')+_0x20e63a;const _0x29b470={'host':_0x4537fe,'port':_0x48a6d2,'clientId':_0x56ce7f,'username':a18_0x2c81('0x1a'),'password':this[a18_0x2c81('0x1b')](_0x58d50d,_0x683a3c,_0x40e500),'protocol':a18_0x2c81('0x1c'),'secureProtocol':a18_0x2c81('0x1d')};const _0x2432ed=Math[a18_0x2c81('0x1e')](Date[a18_0x2c81('0x1f')]()/0x3e8);const _0x460f44=mqtt[a18_0x2c81('0x20')](_0x29b470);_0x460f44[a18_0x2c81('0x21')](a18_0x2c81('0x19')+_0x20e63a+'/config',{'qos':0x1});_0x460f44[a18_0x2c81('0x21')](a18_0x2c81('0x19')+_0x20e63a+'/state',{'qos':0x1});_0x460f44[a18_0x2c81('0x21')]('/devices/'+_0x20e63a+'/commands/#',{'qos':0x0});const _0xdaeb29='/devices/'+_0x20e63a+'/'+_0xdf4b4d;_0x460f44['on'](a18_0x2c81('0x20'),_0x19bd0a=>{console[a18_0x2c81('0x22')](a18_0x2c81('0x20'));if(!_0x19bd0a){console[a18_0x2c81('0x22')](a18_0x2c81('0x23'));}else{const _0xdaeb29='/projects/velvety-glazing-252020/topics/my-topic';const _0x2e6621=_0x3baad3+'/'+_0x20e63a+a18_0x2c81('0x24');_0x460f44[a18_0x2c81('0x25')](_0xdaeb29,_0x2e6621,{'qos':0x1},_0x2ec2e6=>{console['log']('publish\x20result:');console[a18_0x2c81('0x22')](_0x2ec2e6);if(!_0x2ec2e6){}});}});_0x460f44['on'](a18_0x2c81('0x26'),()=>{console[a18_0x2c81('0x22')](a18_0x2c81('0x26'));});_0x460f44['on']('error',_0x13f7a1=>{console['log'](a18_0x2c81('0x27'),_0x13f7a1);});_0x460f44['on'](a18_0x2c81('0x28'),(_0xc0fb29,_0x592773)=>{let _0x5d298f='Message\x20received:\x20';console['log'](_0xc0fb29);console['log'](_0x592773+'');if(_0xc0fb29==='/devices/'+_0x20e63a+'/config'){_0x5d298f='Config\x20message\x20received:\x20';}else if(_0xc0fb29[a18_0x2c81('0x29')]('/devices/'+_0x20e63a+'/commands')){_0x5d298f='Command\x20message\x20received:\x20';}_0x5d298f+=Buffer['from'](_0x592773,a18_0x2c81('0x2a'))['toString'](a18_0x2c81('0x2b'));console['log'](_0x5d298f);});_0x460f44['on'](a18_0x2c81('0x2c'),()=>{});console['log'](_0x29b470);}[a18_0x2c81('0xd')](){console[a18_0x2c81('0x22')](a18_0x2c81('0xf'));this[a18_0x2c81('0x2d')]=uuidv4();console['log']('this.clientId');console['log'](this[a18_0x2c81('0x2d')]);const _0x4373ef={'clientId':this[a18_0x2c81('0x2d')],'username':a18_0x2c81('0x2e'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x2c81('0x2f')]=mqtt[a18_0x2c81('0x20')](a18_0x2c81('0x30'),_0x4373ef);this[a18_0x2c81('0x2f')]['on'](a18_0x2c81('0x20'),this[a18_0x2c81('0x31')][a18_0x2c81('0x32')](this));this['mqttClient']['on'](a18_0x2c81('0x28'),this['mqttClient_message'][a18_0x2c81('0x32')](this));this['mqttClient']['on'](a18_0x2c81('0x26'),()=>{console[a18_0x2c81('0x22')]('close');});process['on'](a18_0x2c81('0x33'),this[a18_0x2c81('0x34')][a18_0x2c81('0x32')](this));process['on'](a18_0x2c81('0x35'),this[a18_0x2c81('0x34')][a18_0x2c81('0x32')](this));process['on'](a18_0x2c81('0x36'),this[a18_0x2c81('0x34')][a18_0x2c81('0x32')](this));}[a18_0x2c81('0x31')](){console[a18_0x2c81('0x22')](a18_0x2c81('0x37')+this[a18_0x2c81('0x2d')]);this[a18_0x2c81('0x2f')][a18_0x2c81('0x21')](a18_0x2c81('0x38'));this['mqttClient']['subscribe']('player/close');this[a18_0x2c81('0x2f')][a18_0x2c81('0x21')](a18_0x2c81('0x39'),{'qos':0x2});this[a18_0x2c81('0x2f')]['subscribe'](a18_0x2c81('0x3a'),{'qos':0x2});this['mqttClient'][a18_0x2c81('0x21')]('player/reload_playlist',{'qos':0x2});this[a18_0x2c81('0x2f')]['subscribe']('player/update',{'qos':0x2});this[a18_0x2c81('0x2f')][a18_0x2c81('0x21')](a18_0x2c81('0x3b'),{'qos':0x2});this[a18_0x2c81('0x2f')][a18_0x2c81('0x21')]('player/register',{'qos':0x2});this['mqttClient'][a18_0x2c81('0x21')](a18_0x2c81('0x3c'),{'qos':0x2});this[a18_0x2c81('0x2f')][a18_0x2c81('0x21')](a18_0x2c81('0x3d'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x2c81('0x3e'),{'qos':0x2});}[a18_0x2c81('0x3f')](){}[a18_0x2c81('0x40')](_0xee8d6a,_0x4830d8){console[a18_0x2c81('0x22')](a18_0x2c81('0x41'),_0xee8d6a,_0x4830d8);switch(_0xee8d6a){case a18_0x2c81('0x38'):return this[a18_0x2c81('0x42')](_0x4830d8);case a18_0x2c81('0x43'):return this['handleCloseRequest'](_0x4830d8);case a18_0x2c81('0x39'):return this[a18_0x2c81('0x44')](_0x4830d8);case a18_0x2c81('0x45'):return this[a18_0x2c81('0x46')](_0x4830d8);case a18_0x2c81('0x3a'):return this[a18_0x2c81('0x47')](_0x4830d8);case'player/update':return this[a18_0x2c81('0x48')](_0x4830d8);case'player/ifconfig':return this[a18_0x2c81('0x49')](_0x4830d8);case a18_0x2c81('0x4a'):return this[a18_0x2c81('0x4b')](_0x4830d8);case'player/update_settings':return this[a18_0x2c81('0x4c')](_0x4830d8);case'player/turn_off_tv':return this[a18_0x2c81('0x4d')](_0x4830d8);case'player/turn_on_tv':return this[a18_0x2c81('0x4e')](_0x4830d8);}}['handleRegisterRequest'](_0x41176a){if(_0x41176a=='all'||_0x41176a==String(this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')])){this['syncPlaylistsService'][a18_0x2c81('0x50')]();}}[a18_0x2c81('0x49')](_0x384148){if(_0x384148==a18_0x2c81('0x51')||_0x384148==String(this['syncPlaylistsService'][a18_0x2c81('0x4f')])){}}[a18_0x2c81('0x48')](_0x3c10ce){console[a18_0x2c81('0x22')](a18_0x2c81('0x52')+_0x3c10ce);if(_0x3c10ce=='all'||_0x3c10ce==String(this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')])){const _0x432b1d=__dirname;const _0x1bb8b8=require('simple-git')(_0x432b1d);console[a18_0x2c81('0x22')](a18_0x2c81('0x53'));_0x1bb8b8[a18_0x2c81('0x54')]((_0x573e35,_0x3f6815)=>{if(_0x573e35){console[a18_0x2c81('0x22')](a18_0x2c81('0x55'));this[a18_0x2c81('0x48')](_0x3c10ce);return;}else{}console['log']('Git\x20updated');console[a18_0x2c81('0x22')](_0x3f6815);if(_0x3f6815&&_0x3f6815[a18_0x2c81('0x56')][a18_0x2c81('0x57')]){this['syncPlaylistsService'][a18_0x2c81('0x58')]();}else{}});}}[a18_0x2c81('0x47')](_0x5bf2aa){if(_0x5bf2aa=='all'||_0x5bf2aa==String(this[a18_0x2c81('0x7')]['playerId'])){this[a18_0x2c81('0x7')]['loadMediaList']();}}[a18_0x2c81('0x46')](_0x40f934){if(String(_0x40f934)==a18_0x2c81('0x51')||String(_0x40f934)==String(this[a18_0x2c81('0x7')]['playerId'])){this[a18_0x2c81('0x7')][a18_0x2c81('0x59')]();}}[a18_0x2c81('0x44')](_0x1b0388){if(_0x1b0388=='all'||_0x1b0388==String(this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')])){console[a18_0x2c81('0x22')](a18_0x2c81('0x5a'));try{this[a18_0x2c81('0x7')][a18_0x2c81('0x58')]();}catch(_0x4cd00a){console[a18_0x2c81('0x22')](_0x4cd00a);}}}[a18_0x2c81('0x4c')](_0x33ab0c){if(_0x33ab0c==a18_0x2c81('0x51')||_0x33ab0c==String(this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a18_0x2c81('0x7')][a18_0x2c81('0x5b')]();}catch(_0x5b26c8){console[a18_0x2c81('0x22')](_0x5b26c8);}}}[a18_0x2c81('0x4e')](_0x1a2ffd){if(_0x1a2ffd==a18_0x2c81('0x51')||_0x1a2ffd==String(this['syncPlaylistsService'][a18_0x2c81('0x4f')])){console[a18_0x2c81('0x22')]('handleTurnOnTVRequest:\x20');try{this[a18_0x2c81('0x7')][a18_0x2c81('0x5c')]();}catch(_0x15fd08){console[a18_0x2c81('0x22')](_0x15fd08);}}}[a18_0x2c81('0x4d')](_0x34a4c0){if(_0x34a4c0==a18_0x2c81('0x51')||_0x34a4c0==String(this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')])){console[a18_0x2c81('0x22')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a18_0x2c81('0x5d')]();}catch(_0x4e1585){console[a18_0x2c81('0x22')](_0x4e1585);}}}[a18_0x2c81('0x5e')](){console[a18_0x2c81('0x22')]('sending\x20state\x20%s',this[a18_0x2c81('0x8')]);this[a18_0x2c81('0x2f')][a18_0x2c81('0x25')](a18_0x2c81('0x5f'),this[a18_0x2c81('0x7')][a18_0x2c81('0x4f')]+'-'+this['state']);}[a18_0x2c81('0x42')](_0x35f353){if(this[a18_0x2c81('0x8')]!=='open'&&this[a18_0x2c81('0x8')]!==a18_0x2c81('0x60')){console[a18_0x2c81('0x22')](a18_0x2c81('0x61'));this['state']=a18_0x2c81('0x60');this[a18_0x2c81('0x5e')]();setTimeout(()=>{this[a18_0x2c81('0x8')]=a18_0x2c81('0x62');this[a18_0x2c81('0x5e')]();},0x1388);}}[a18_0x2c81('0x63')](_0x4c0275){if(this[a18_0x2c81('0x8')]!==a18_0x2c81('0x9')&&this[a18_0x2c81('0x8')]!==a18_0x2c81('0x64')){this[a18_0x2c81('0x8')]=a18_0x2c81('0x64');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x2c81('0x8')]=a18_0x2c81('0x9');this[a18_0x2c81('0x5e')]();},0x1388);}}[a18_0x2c81('0x34')](_0x2a17e8,_0x209367){if(_0x209367){console[a18_0x2c81('0x22')](_0x209367[a18_0x2c81('0x65')]);}this[a18_0x2c81('0x2f')][a18_0x2c81('0x25')]('player/connected',a18_0x2c81('0x66'));}[a18_0x2c81('0x1b')](_0x3c1081,_0x11a26e,_0x1697d7){const _0x2d7fc9={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a18_0x2c81('0x1e')](Date[a18_0x2c81('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x3c1081};const _0x55523c=fs[a18_0x2c81('0x67')](_0x11a26e);return jwt[a18_0x2c81('0x68')](_0x2d7fc9,_0x55523c,{'algorithm':_0x1697d7});}}exports[a18_0x2c81('0x69')]=MqttService;