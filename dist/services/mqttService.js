var a18_0x54ce=['handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','syncPlaylistsService','registerClient','all','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','changes','loadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','state','player/state','open','opening','opening\x20player\x20door','handleCloseRequest','closing','stack','createJwt','readFileSync','MqttService','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','exec','is-image','mqtt','uuid/v4','closed','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','us-central1','resources/keys/rsa_private.pem','events','projects/','/locations/','/registries/','/devices/','unused','mqtts','round','now','subscribe','/config','/state','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','ascii','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','handleAppExit','Connected\x20to\x20broker\x20client:','player/reboot','player/load_playlist','player/reload_playlist','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','player/close','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest'];(function(_0x479ef2,_0x1472cf){var _0x4d813d=function(_0x57e4bb){while(--_0x57e4bb){_0x479ef2['push'](_0x479ef2['shift']());}};_0x4d813d(++_0x1472cf);}(a18_0x54ce,0x8c));var a18_0x1f23=function(_0x1fdf5f,_0x3375c1){_0x1fdf5f=_0x1fdf5f-0x0;var _0x789531=a18_0x54ce[_0x1fdf5f];return _0x789531;};'use strict';Object['defineProperty'](exports,a18_0x1f23('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x1f23('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x1f23('0x2'));const progress=require(a18_0x1f23('0x3'));const spawn=require(a18_0x1f23('0x4'))[a18_0x1f23('0x5')];const exec=require('child_process')[a18_0x1f23('0x6')];const isImage=require(a18_0x1f23('0x7'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x1f23('0x8'));const uuidv4=require(a18_0x1f23('0x9'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x56b0a0){this['syncPlaylistsService']=_0x56b0a0;this['state']=a18_0x1f23('0xa');this['httpClientService']=new HttpClientService_1[(a18_0x1f23('0xb'))]();}[a18_0x1f23('0xc')](){this[a18_0x1f23('0xd')]();}[a18_0x1f23('0xe')](){console[a18_0x1f23('0xf')](a18_0x1f23('0x10'));const _0x3cfca8=a18_0x1f23('0x11');const _0x1118ce='my-node-device';const _0x115edd=a18_0x1f23('0x12');const _0x1662b3=a18_0x1f23('0x13');const _0x1da150='RS256';const _0x1daa5f=a18_0x1f23('0x14');const _0x980c3b='mqtt.googleapis.com';const _0xb32f33=0x1bb;const _0x47a2d5=a18_0x1f23('0x15');const _0x2fc2a5=0x5;const _0x4f12e4=a18_0x1f23('0x16')+_0x3cfca8+a18_0x1f23('0x17')+_0x1662b3+a18_0x1f23('0x18')+_0x115edd+a18_0x1f23('0x19')+_0x1118ce;const _0x27c398={'host':_0x980c3b,'port':_0xb32f33,'clientId':_0x4f12e4,'username':a18_0x1f23('0x1a'),'password':this['createJwt'](_0x3cfca8,_0x1daa5f,_0x1da150),'protocol':a18_0x1f23('0x1b'),'secureProtocol':'TLSv1_2_method'};const _0x59a21a=Math[a18_0x1f23('0x1c')](Date[a18_0x1f23('0x1d')]()/0x3e8);const _0x2c899a=mqtt['connect'](_0x27c398);_0x2c899a[a18_0x1f23('0x1e')](a18_0x1f23('0x19')+_0x1118ce+a18_0x1f23('0x1f'),{'qos':0x1});_0x2c899a[a18_0x1f23('0x1e')]('/devices/'+_0x1118ce+a18_0x1f23('0x20'),{'qos':0x1});_0x2c899a[a18_0x1f23('0x1e')](a18_0x1f23('0x19')+_0x1118ce+a18_0x1f23('0x21'),{'qos':0x0});const _0x215b93=a18_0x1f23('0x19')+_0x1118ce+'/'+_0x47a2d5;_0x2c899a['on'](a18_0x1f23('0x22'),_0x34df95=>{console[a18_0x1f23('0xf')](a18_0x1f23('0x22'));if(!_0x34df95){console[a18_0x1f23('0xf')](a18_0x1f23('0x23'));}else{const _0x215b93=a18_0x1f23('0x24');const _0x5b1fe8=_0x115edd+'/'+_0x1118ce+a18_0x1f23('0x25');_0x2c899a[a18_0x1f23('0x26')](_0x215b93,_0x5b1fe8,{'qos':0x1},_0x2f6b9e=>{console[a18_0x1f23('0xf')]('publish\x20result:');console[a18_0x1f23('0xf')](_0x2f6b9e);if(!_0x2f6b9e){}});}});_0x2c899a['on'](a18_0x1f23('0x27'),()=>{console['log'](a18_0x1f23('0x27'));});_0x2c899a['on'](a18_0x1f23('0x28'),_0x436166=>{console[a18_0x1f23('0xf')](a18_0x1f23('0x28'),_0x436166);});_0x2c899a['on']('message',(_0x3bdfb3,_0x211c63)=>{let _0x1099d1=a18_0x1f23('0x29');console[a18_0x1f23('0xf')](_0x3bdfb3);console[a18_0x1f23('0xf')](_0x211c63+'');if(_0x3bdfb3===a18_0x1f23('0x19')+_0x1118ce+'/config'){_0x1099d1=a18_0x1f23('0x2a');}else if(_0x3bdfb3[a18_0x1f23('0x2b')](a18_0x1f23('0x19')+_0x1118ce+a18_0x1f23('0x2c'))){_0x1099d1=a18_0x1f23('0x2d');}_0x1099d1+=Buffer['from'](_0x211c63,a18_0x1f23('0x2e'))['toString'](a18_0x1f23('0x2f'));console['log'](_0x1099d1);});_0x2c899a['on']('packetsend',()=>{});console['log'](_0x27c398);}[a18_0x1f23('0xd')](){console[a18_0x1f23('0xf')](a18_0x1f23('0x10'));this[a18_0x1f23('0x30')]=uuidv4();console['log'](a18_0x1f23('0x31'));console[a18_0x1f23('0xf')](this[a18_0x1f23('0x30')]);const _0x322355={'clientId':this[a18_0x1f23('0x30')],'username':a18_0x1f23('0x32'),'password':a18_0x1f23('0x33'),'clean':!![]};this[a18_0x1f23('0x34')]=mqtt[a18_0x1f23('0x22')](a18_0x1f23('0x35'),_0x322355);this[a18_0x1f23('0x34')]['on']('connect',this[a18_0x1f23('0x36')][a18_0x1f23('0x37')](this));this[a18_0x1f23('0x34')]['on'](a18_0x1f23('0x38'),this[a18_0x1f23('0x39')][a18_0x1f23('0x37')](this));this[a18_0x1f23('0x34')]['on'](a18_0x1f23('0x27'),()=>{console[a18_0x1f23('0xf')](a18_0x1f23('0x27'));});process['on']('exit',this[a18_0x1f23('0x3a')][a18_0x1f23('0x37')](this));process['on']('SIGINT',this['handleAppExit'][a18_0x1f23('0x37')](this));process['on']('uncaughtException',this[a18_0x1f23('0x3a')][a18_0x1f23('0x37')](this));}['mqttClient_connect'](){console['log'](a18_0x1f23('0x3b')+this[a18_0x1f23('0x30')]);this['mqttClient']['subscribe']('player/open');this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')]('player/close');this[a18_0x1f23('0x34')]['subscribe'](a18_0x1f23('0x3c'),{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')](a18_0x1f23('0x3d'),{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')](a18_0x1f23('0x3e'),{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')]('player/update',{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x1f23('0x1e')]('player/register',{'qos':0x2});this[a18_0x1f23('0x34')]['subscribe'](a18_0x1f23('0x3f'),{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')](a18_0x1f23('0x40'),{'qos':0x2});this[a18_0x1f23('0x34')][a18_0x1f23('0x1e')](a18_0x1f23('0x41'),{'qos':0x2});}[a18_0x1f23('0x42')](){}['mqttClient_message'](_0xabc2ec,_0x2e1f65){console[a18_0x1f23('0xf')](a18_0x1f23('0x43'),_0xabc2ec,_0x2e1f65);switch(_0xabc2ec){case a18_0x1f23('0x44'):return this[a18_0x1f23('0x45')](_0x2e1f65);case a18_0x1f23('0x46'):return this['handleCloseRequest'](_0x2e1f65);case'player/reboot':return this['handleRebootRequest'](_0x2e1f65);case a18_0x1f23('0x3e'):return this[a18_0x1f23('0x47')](_0x2e1f65);case'player/load_playlist':return this[a18_0x1f23('0x48')](_0x2e1f65);case'player/update':return this[a18_0x1f23('0x49')](_0x2e1f65);case'player/ifconfig':return this[a18_0x1f23('0x4a')](_0x2e1f65);case'player/register':return this[a18_0x1f23('0x4b')](_0x2e1f65);case a18_0x1f23('0x3f'):return this[a18_0x1f23('0x4c')](_0x2e1f65);case a18_0x1f23('0x40'):return this[a18_0x1f23('0x4d')](_0x2e1f65);case a18_0x1f23('0x41'):return this[a18_0x1f23('0x4e')](_0x2e1f65);}}[a18_0x1f23('0x4b')](_0x47f90b){if(_0x47f90b=='all'||_0x47f90b==String(this['syncPlaylistsService'][a18_0x1f23('0x4f')])){this[a18_0x1f23('0x50')][a18_0x1f23('0x51')]();}}[a18_0x1f23('0x4a')](_0x5c55a7){if(_0x5c55a7==a18_0x1f23('0x52')||_0x5c55a7==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){}}[a18_0x1f23('0x49')](_0x278eb0){console[a18_0x1f23('0xf')]('handleUpdateRequest:\x20'+_0x278eb0);if(_0x278eb0=='all'||_0x278eb0==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){const _0x2d6c3a=__dirname;const _0x417a18=require(a18_0x1f23('0x53'))(_0x2d6c3a);console[a18_0x1f23('0xf')](a18_0x1f23('0x54'));_0x417a18['pull']((_0x3d42a6,_0x3e8add)=>{if(_0x3d42a6){console[a18_0x1f23('0xf')](a18_0x1f23('0x55'));this['handleUpdateRequest'](_0x278eb0);return;}else{}console['log'](a18_0x1f23('0x56'));console[a18_0x1f23('0xf')](_0x3e8add);if(_0x3e8add&&_0x3e8add[a18_0x1f23('0x57')][a18_0x1f23('0x58')]){this[a18_0x1f23('0x50')]['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x4038e0){if(_0x4038e0==a18_0x1f23('0x52')||_0x4038e0==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){this[a18_0x1f23('0x50')][a18_0x1f23('0x59')]();}}[a18_0x1f23('0x47')](_0x5230d5){if(String(_0x5230d5)==a18_0x1f23('0x52')||String(_0x5230d5)==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){this['syncPlaylistsService']['reloadMediaList']();}}[a18_0x1f23('0x5a')](_0xaf132f){if(_0xaf132f==a18_0x1f23('0x52')||_0xaf132f==String(this[a18_0x1f23('0x50')]['playerId'])){console['log'](a18_0x1f23('0x5b'));try{this[a18_0x1f23('0x50')]['reboot']();}catch(_0x408cb0){console['log'](_0x408cb0);}}}[a18_0x1f23('0x4c')](_0x100f52){if(_0x100f52==a18_0x1f23('0x52')||_0x100f52==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){console[a18_0x1f23('0xf')](a18_0x1f23('0x5c'));try{this[a18_0x1f23('0x50')]['updateSettings']();}catch(_0xff2b6c){console['log'](_0xff2b6c);}}}[a18_0x1f23('0x4e')](_0x6a1282){if(_0x6a1282==a18_0x1f23('0x52')||_0x6a1282==String(this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')])){console['log']('handleTurnOnTVRequest:\x20');try{this[a18_0x1f23('0x50')][a18_0x1f23('0x5d')]();}catch(_0x4a0ace){console[a18_0x1f23('0xf')](_0x4a0ace);}}}[a18_0x1f23('0x4d')](_0x2a5ff3){if(_0x2a5ff3==a18_0x1f23('0x52')||_0x2a5ff3==String(this['syncPlaylistsService'][a18_0x1f23('0x4f')])){console['log'](a18_0x1f23('0x5e'));try{this[a18_0x1f23('0x50')][a18_0x1f23('0x5f')]();}catch(_0x2e1920){console['log'](_0x2e1920);}}}[a18_0x1f23('0x60')](){console[a18_0x1f23('0xf')]('sending\x20state\x20%s',this[a18_0x1f23('0x61')]);this['mqttClient']['publish'](a18_0x1f23('0x62'),this[a18_0x1f23('0x50')][a18_0x1f23('0x4f')]+'-'+this[a18_0x1f23('0x61')]);}[a18_0x1f23('0x45')](_0xaa82f){if(this['state']!==a18_0x1f23('0x63')&&this[a18_0x1f23('0x61')]!==a18_0x1f23('0x64')){console[a18_0x1f23('0xf')](a18_0x1f23('0x65'));this[a18_0x1f23('0x61')]=a18_0x1f23('0x64');this[a18_0x1f23('0x60')]();setTimeout(()=>{this[a18_0x1f23('0x61')]=a18_0x1f23('0x63');this[a18_0x1f23('0x60')]();},0x1388);}}[a18_0x1f23('0x66')](_0x537ef2){if(this['state']!=='closed'&&this['state']!==a18_0x1f23('0x67')){this[a18_0x1f23('0x61')]=a18_0x1f23('0x67');this[a18_0x1f23('0x60')]();setTimeout(()=>{this[a18_0x1f23('0x61')]=a18_0x1f23('0xa');this[a18_0x1f23('0x60')]();},0x1388);}}['handleAppExit'](_0x28c76b,_0x46eddf){if(_0x46eddf){console[a18_0x1f23('0xf')](_0x46eddf[a18_0x1f23('0x68')]);}this['mqttClient'][a18_0x1f23('0x26')]('player/connected','false');}[a18_0x1f23('0x69')](_0xf98c52,_0x117215,_0x48e751){const _0x3d152c={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a18_0x1f23('0x1c')](Date[a18_0x1f23('0x1d')]()/0x3e8)+0x14*0x3c,'aud':_0xf98c52};const _0x44e3fd=fs[a18_0x1f23('0x6a')](_0x117215);return jwt['sign'](_0x3d152c,_0x44e3fd,{'algorithm':_0x48e751});}}exports[a18_0x1f23('0x6b')]=MqttService;