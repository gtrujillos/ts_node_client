var a18_0x3a11=['defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','connect','/config','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','mqttInit','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','SIGINT','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleCloseRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','now','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','sendStateUpdate','sending\x20state\x20%s','state','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closed','closing','stack','player/connected','round','readFileSync','MqttService'];(function(_0x124515,_0x2307f0){var _0x2839d4=function(_0x1f0956){while(--_0x1f0956){_0x124515['push'](_0x124515['shift']());}};_0x2839d4(++_0x2307f0);}(a18_0x3a11,0x72));var a18_0x544c=function(_0x3f12b6,_0x101095){_0x3f12b6=_0x3f12b6-0x0;var _0xc5d54b=a18_0x3a11[_0x3f12b6];return _0xc5d54b;};'use strict';Object[a18_0x544c('0x0')](exports,a18_0x544c('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x544c('0x2'));const fs=require('fs');const fsExtra=require(a18_0x544c('0x3'));const request=require(a18_0x544c('0x4'));const progress=require(a18_0x544c('0x5'));const {spawn}=require(a18_0x544c('0x6'));const exec=require('child_process')[a18_0x544c('0x7')];const isImage=require('is-image');const format=require(a18_0x544c('0x8'));const os=require('os');const mqtt=require(a18_0x544c('0x9'));const uuidv4=require(a18_0x544c('0xa'));const jwt=require(a18_0x544c('0xb'));class MqttService{constructor(_0x114e73){this[a18_0x544c('0xc')]=_0x114e73;this['state']='closed';this[a18_0x544c('0xd')]=new HttpClientService_1[(a18_0x544c('0xe'))]();}[a18_0x544c('0xf')](){this[a18_0x544c('0x10')]();}[a18_0x544c('0x11')](){console[a18_0x544c('0x12')]('mqttInit');const _0x5888f7=a18_0x544c('0x13');const _0x22c63f=a18_0x544c('0x14');const _0x2033a3=a18_0x544c('0x15');const _0x37227f=a18_0x544c('0x16');const _0x14fa03=a18_0x544c('0x17');const _0x4da7e4=a18_0x544c('0x18');const _0x127aea=a18_0x544c('0x19');const _0x408a98=0x1bb;const _0x21f405=a18_0x544c('0x1a');const _0x1e4fbe=0x5;const _0x1a34ff='projects/'+_0x5888f7+a18_0x544c('0x1b')+_0x37227f+a18_0x544c('0x1c')+_0x2033a3+a18_0x544c('0x1d')+_0x22c63f;const _0x11f15d={'host':_0x127aea,'port':_0x408a98,'clientId':_0x1a34ff,'username':a18_0x544c('0x1e'),'password':this[a18_0x544c('0x1f')](_0x5888f7,_0x4da7e4,_0x14fa03),'protocol':a18_0x544c('0x20'),'secureProtocol':a18_0x544c('0x21')};const _0x5bc297=Math['round'](Date['now']()/0x3e8);const _0x57ce95=mqtt[a18_0x544c('0x22')](_0x11f15d);_0x57ce95['subscribe'](a18_0x544c('0x1d')+_0x22c63f+a18_0x544c('0x23'),{'qos':0x1});_0x57ce95[a18_0x544c('0x24')](a18_0x544c('0x1d')+_0x22c63f+a18_0x544c('0x25'),{'qos':0x1});_0x57ce95['subscribe'](a18_0x544c('0x1d')+_0x22c63f+a18_0x544c('0x26'),{'qos':0x0});const _0x3233d8=a18_0x544c('0x1d')+_0x22c63f+'/'+_0x21f405;_0x57ce95['on'](a18_0x544c('0x22'),_0x38de51=>{console[a18_0x544c('0x12')](a18_0x544c('0x22'));if(!_0x38de51){console['log'](a18_0x544c('0x27'));}else{const _0x3233d8=a18_0x544c('0x28');const _0x5e4ff8=_0x2033a3+'/'+_0x22c63f+a18_0x544c('0x29');_0x57ce95[a18_0x544c('0x2a')](_0x3233d8,_0x5e4ff8,{'qos':0x1},_0x154804=>{console['log'](a18_0x544c('0x2b'));console[a18_0x544c('0x12')](_0x154804);if(!_0x154804){}});}});_0x57ce95['on'](a18_0x544c('0x2c'),()=>{console[a18_0x544c('0x12')]('close');});_0x57ce95['on'](a18_0x544c('0x2d'),_0x3f87b2=>{console[a18_0x544c('0x12')](a18_0x544c('0x2d'),_0x3f87b2);});_0x57ce95['on'](a18_0x544c('0x2e'),(_0x150a2b,_0x381f20)=>{let _0x3473f2='Message\x20received:\x20';console[a18_0x544c('0x12')](_0x150a2b);console['log'](_0x381f20+'');if(_0x150a2b===a18_0x544c('0x1d')+_0x22c63f+'/config'){_0x3473f2='Config\x20message\x20received:\x20';}else if(_0x150a2b[a18_0x544c('0x2f')](a18_0x544c('0x1d')+_0x22c63f+a18_0x544c('0x30'))){_0x3473f2=a18_0x544c('0x31');}_0x3473f2+=Buffer[a18_0x544c('0x32')](_0x381f20,a18_0x544c('0x33'))[a18_0x544c('0x34')](a18_0x544c('0x35'));console[a18_0x544c('0x12')](_0x3473f2);});_0x57ce95['on'](a18_0x544c('0x36'),()=>{});console[a18_0x544c('0x12')](_0x11f15d);}['mqttInit_mosquitto'](){console[a18_0x544c('0x12')](a18_0x544c('0x37'));this[a18_0x544c('0x38')]=uuidv4();console[a18_0x544c('0x12')](a18_0x544c('0x39'));console['log'](this[a18_0x544c('0x38')]);const _0x35ee58={'clientId':this[a18_0x544c('0x38')],'username':a18_0x544c('0x3a'),'password':a18_0x544c('0x3b'),'clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x544c('0x3c'),_0x35ee58);this[a18_0x544c('0x3d')]['on'](a18_0x544c('0x22'),this[a18_0x544c('0x3e')][a18_0x544c('0x3f')](this));this[a18_0x544c('0x3d')]['on'](a18_0x544c('0x2e'),this[a18_0x544c('0x40')]['bind'](this));this[a18_0x544c('0x3d')]['on'](a18_0x544c('0x2c'),()=>{console[a18_0x544c('0x12')]('close');});process['on'](a18_0x544c('0x41'),this['handleAppExit'][a18_0x544c('0x3f')](this));process['on'](a18_0x544c('0x42'),this['handleAppExit'][a18_0x544c('0x3f')](this));process['on'](a18_0x544c('0x43'),this['handleAppExit']['bind'](this));}[a18_0x544c('0x3e')](){console[a18_0x544c('0x12')]('Connected\x20to\x20broker\x20client:'+this[a18_0x544c('0x38')]);this['mqttClient']['subscribe'](a18_0x544c('0x44'));this[a18_0x544c('0x3d')][a18_0x544c('0x24')](a18_0x544c('0x45'));this[a18_0x544c('0x3d')]['subscribe'](a18_0x544c('0x46'),{'qos':0x2});this[a18_0x544c('0x3d')][a18_0x544c('0x24')](a18_0x544c('0x47'),{'qos':0x2});this[a18_0x544c('0x3d')]['subscribe'](a18_0x544c('0x48'),{'qos':0x2});this[a18_0x544c('0x3d')][a18_0x544c('0x24')]('player/update',{'qos':0x2});this['mqttClient']['subscribe'](a18_0x544c('0x49'),{'qos':0x2});this['mqttClient'][a18_0x544c('0x24')](a18_0x544c('0x4a'),{'qos':0x2});}[a18_0x544c('0x4b')](){}[a18_0x544c('0x40')](_0x4b071f,_0x3d2c72){console[a18_0x544c('0x12')](a18_0x544c('0x4c'),_0x4b071f,_0x3d2c72);switch(_0x4b071f){case'player/open':return this['handleOpenRequest'](_0x3d2c72);case a18_0x544c('0x45'):return this[a18_0x544c('0x4d')](_0x3d2c72);case a18_0x544c('0x46'):return this['handleRebootRequest'](_0x3d2c72);case a18_0x544c('0x48'):return this['handleReloadPlaylistRequest'](_0x3d2c72);case a18_0x544c('0x47'):return this[a18_0x544c('0x4e')](_0x3d2c72);case a18_0x544c('0x4f'):return this[a18_0x544c('0x50')](_0x3d2c72);case a18_0x544c('0x49'):return this[a18_0x544c('0x51')](_0x3d2c72);case'player/register':return this[a18_0x544c('0x52')](_0x3d2c72);}}['handleRegisterRequest'](_0x425964){if(_0x425964==a18_0x544c('0x53')||_0x425964==String(this['syncPlaylistsService'][a18_0x544c('0x54')])){this[a18_0x544c('0xc')]['registerClient']();}}['handleIfconfigRequest'](_0x4495a9){if(_0x4495a9=='all'||_0x4495a9==String(this[a18_0x544c('0xc')][a18_0x544c('0x54')])){}}['handleUpdateRequest'](_0x589dee){console[a18_0x544c('0x12')](a18_0x544c('0x55')+_0x589dee);if(_0x589dee==a18_0x544c('0x53')||_0x589dee==String(this[a18_0x544c('0xc')][a18_0x544c('0x54')])){const _0x3a9536=__dirname;const _0x2e585d=require(a18_0x544c('0x56'))(_0x3a9536);console[a18_0x544c('0x12')](a18_0x544c('0x57'));_0x2e585d[a18_0x544c('0x58')]((_0x205517,_0x39a904)=>{if(_0x205517){console['log'](a18_0x544c('0x59'));this[a18_0x544c('0x50')](_0x589dee);return;}else{}console['log'](a18_0x544c('0x5a'));console['log'](_0x39a904);if(_0x39a904&&_0x39a904[a18_0x544c('0x5b')][a18_0x544c('0x5c')]){const _0x191fdc=spawn('shutdown',['-r',a18_0x544c('0x5d')]);}else{}});}}['handleLoadPlaylistRequest'](_0x121986){if(_0x121986==a18_0x544c('0x53')||_0x121986==String(this['syncPlaylistsService'][a18_0x544c('0x54')])){this[a18_0x544c('0xc')]['loadMediaList']();}}[a18_0x544c('0x5e')](_0x2fce8b){if(String(_0x2fce8b)==a18_0x544c('0x53')||String(_0x2fce8b)==String(this[a18_0x544c('0xc')][a18_0x544c('0x54')])){this[a18_0x544c('0xc')][a18_0x544c('0x5f')]();}}[a18_0x544c('0x60')](_0x144798){if(_0x144798==a18_0x544c('0x53')||_0x144798==String(this['syncPlaylistsService'][a18_0x544c('0x54')])){console[a18_0x544c('0x12')](a18_0x544c('0x61'));try{const _0x1d6f05=spawn(a18_0x544c('0x62'));}catch(_0x1cfd24){console[a18_0x544c('0x12')](_0x1cfd24);}}}[a18_0x544c('0x63')](){console[a18_0x544c('0x12')](a18_0x544c('0x64'),this[a18_0x544c('0x65')]);this[a18_0x544c('0x3d')]['publish'](a18_0x544c('0x66'),this[a18_0x544c('0xc')]['playerId']+'-'+this['state']);}[a18_0x544c('0x67')](_0x2bc76c){if(this['state']!==a18_0x544c('0x68')&&this[a18_0x544c('0x65')]!==a18_0x544c('0x69')){console[a18_0x544c('0x12')](a18_0x544c('0x6a'));this['state']=a18_0x544c('0x69');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x544c('0x65')]=a18_0x544c('0x68');this[a18_0x544c('0x63')]();},0x1388);}}['handleCloseRequest'](_0x1b4d56){if(this[a18_0x544c('0x65')]!==a18_0x544c('0x6b')&&this[a18_0x544c('0x65')]!==a18_0x544c('0x6c')){this[a18_0x544c('0x65')]=a18_0x544c('0x6c');this[a18_0x544c('0x63')]();setTimeout(()=>{this[a18_0x544c('0x65')]='closed';this[a18_0x544c('0x63')]();},0x1388);}}['handleAppExit'](_0x541916,_0x1b0717){if(_0x1b0717){console[a18_0x544c('0x12')](_0x1b0717[a18_0x544c('0x6d')]);}this['mqttClient'][a18_0x544c('0x2a')](a18_0x544c('0x6e'),'false');}[a18_0x544c('0x1f')](_0x116c44,_0x46ad24,_0x536cef){const _0x2ab4b1={'iat':Math[a18_0x544c('0x6f')](Date[a18_0x544c('0x5d')]()/0x3e8),'exp':Math[a18_0x544c('0x6f')](Date[a18_0x544c('0x5d')]()/0x3e8)+0x14*0x3c,'aud':_0x116c44};const _0x47756f=fs[a18_0x544c('0x70')](_0x46ad24);return jwt['sign'](_0x2ab4b1,_0x47756f,{'algorithm':_0x536cef});}}exports[a18_0x544c('0x71')]=MqttService;