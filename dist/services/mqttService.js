var a18_0x1415=['-payload-0','publish','publish\x20result:','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','toString','packetsend','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','reportStatus','player/open','handleOpenRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','handleRegisterRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','false','round','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','now','connect','subscribe','/state','/commands/#','/projects/velvety-glazing-252020/topics/my-topic'];(function(_0x1862ae,_0x53c4f1){var _0x9a32b1=function(_0x53a3c8){while(--_0x53a3c8){_0x1862ae['push'](_0x1862ae['shift']());}};_0x9a32b1(++_0x53c4f1);}(a18_0x1415,0x113));var a18_0x12e4=function(_0x2636b7,_0x4680ea){_0x2636b7=_0x2636b7-0x0;var _0x79804a=a18_0x1415[_0x2636b7];return _0x79804a;};'use strict';Object[a18_0x12e4('0x0')](exports,a18_0x12e4('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x12e4('0x2'));const fs=require('fs');const fsExtra=require(a18_0x12e4('0x3'));const request=require(a18_0x12e4('0x4'));const progress=require(a18_0x12e4('0x5'));const spawn=require('child_process')[a18_0x12e4('0x6')];const isImage=require(a18_0x12e4('0x7'));const format=require(a18_0x12e4('0x8'));const os=require('os');const mqtt=require(a18_0x12e4('0x9'));const uuidv4=require(a18_0x12e4('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1dd36d){this[a18_0x12e4('0xb')]=_0x1dd36d;this[a18_0x12e4('0xc')]=a18_0x12e4('0xd');this['httpClientService']=new HttpClientService_1[(a18_0x12e4('0xe'))]();}['init'](){this[a18_0x12e4('0xf')]();}[a18_0x12e4('0x10')](){console[a18_0x12e4('0x11')](a18_0x12e4('0x12'));const _0x3be5b7='velvety-glazing-252020';const _0x2e13e3=a18_0x12e4('0x13');const _0x535715=a18_0x12e4('0x14');const _0x3b18c1='us-central1';const _0x472802=a18_0x12e4('0x15');const _0x5ea187=a18_0x12e4('0x16');const _0x38a673=a18_0x12e4('0x17');const _0x118723=0x1bb;const _0x360d94=a18_0x12e4('0x18');const _0x327e0a=0x5;const _0x2392bc=a18_0x12e4('0x19')+_0x3be5b7+'/locations/'+_0x3b18c1+a18_0x12e4('0x1a')+_0x535715+a18_0x12e4('0x1b')+_0x2e13e3;const _0x311e53={'host':_0x38a673,'port':_0x118723,'clientId':_0x2392bc,'username':'unused','password':this[a18_0x12e4('0x1c')](_0x3be5b7,_0x5ea187,_0x472802),'protocol':a18_0x12e4('0x1d'),'secureProtocol':a18_0x12e4('0x1e')};const _0x214932=Math['round'](Date[a18_0x12e4('0x1f')]()/0x3e8);const _0x1d8313=mqtt[a18_0x12e4('0x20')](_0x311e53);_0x1d8313[a18_0x12e4('0x21')]('/devices/'+_0x2e13e3+'/config',{'qos':0x1});_0x1d8313['subscribe']('/devices/'+_0x2e13e3+a18_0x12e4('0x22'),{'qos':0x1});_0x1d8313[a18_0x12e4('0x21')](a18_0x12e4('0x1b')+_0x2e13e3+a18_0x12e4('0x23'),{'qos':0x0});const _0x361c40='/devices/'+_0x2e13e3+'/'+_0x360d94;_0x1d8313['on'](a18_0x12e4('0x20'),_0x1df0a0=>{console[a18_0x12e4('0x11')](a18_0x12e4('0x20'));if(!_0x1df0a0){console[a18_0x12e4('0x11')]('Client\x20not\x20connected...');}else{const _0x361c40=a18_0x12e4('0x24');const _0x30590a=_0x535715+'/'+_0x2e13e3+a18_0x12e4('0x25');_0x1d8313[a18_0x12e4('0x26')](_0x361c40,_0x30590a,{'qos':0x1},_0x1189d2=>{console[a18_0x12e4('0x11')](a18_0x12e4('0x27'));console['log'](_0x1189d2);if(!_0x1189d2){}});}});_0x1d8313['on'](a18_0x12e4('0x28'),()=>{console['log'](a18_0x12e4('0x28'));});_0x1d8313['on']('error',_0x272db=>{console['log'](a18_0x12e4('0x29'),_0x272db);});_0x1d8313['on']('message',(_0x45cd14,_0x26a97e)=>{let _0x434ce6=a18_0x12e4('0x2a');console[a18_0x12e4('0x11')](_0x45cd14);console['log'](_0x26a97e+'');if(_0x45cd14===a18_0x12e4('0x1b')+_0x2e13e3+a18_0x12e4('0x2b')){_0x434ce6=a18_0x12e4('0x2c');}else if(_0x45cd14[a18_0x12e4('0x2d')](a18_0x12e4('0x1b')+_0x2e13e3+a18_0x12e4('0x2e'))){_0x434ce6=a18_0x12e4('0x2f');}_0x434ce6+=Buffer['from'](_0x26a97e,a18_0x12e4('0x30'))[a18_0x12e4('0x31')]('ascii');console[a18_0x12e4('0x11')](_0x434ce6);});_0x1d8313['on'](a18_0x12e4('0x32'),()=>{});console['log'](_0x311e53);}[a18_0x12e4('0xf')](){console[a18_0x12e4('0x11')]('mqttInit');this['clientId']=uuidv4();console[a18_0x12e4('0x11')](a18_0x12e4('0x33'));console[a18_0x12e4('0x11')](this['clientId']);const _0x5d135a={'clientId':this['clientId'],'username':'lulo_mqtt','password':a18_0x12e4('0x34'),'clean':!![]};this[a18_0x12e4('0x35')]=mqtt[a18_0x12e4('0x20')](a18_0x12e4('0x36'),_0x5d135a);this[a18_0x12e4('0x35')]['on'](a18_0x12e4('0x20'),this[a18_0x12e4('0x37')][a18_0x12e4('0x38')](this));this['mqttClient']['on'](a18_0x12e4('0x39'),this[a18_0x12e4('0x3a')]['bind'](this));this[a18_0x12e4('0x35')]['on'](a18_0x12e4('0x28'),()=>{console[a18_0x12e4('0x11')](a18_0x12e4('0x28'));});process['on'](a18_0x12e4('0x3b'),this[a18_0x12e4('0x3c')][a18_0x12e4('0x38')](this));process['on'](a18_0x12e4('0x3d'),this[a18_0x12e4('0x3c')][a18_0x12e4('0x38')](this));process['on'](a18_0x12e4('0x3e'),this[a18_0x12e4('0x3c')][a18_0x12e4('0x38')](this));}[a18_0x12e4('0x37')](){console[a18_0x12e4('0x11')](a18_0x12e4('0x3f')+this['clientId']);this[a18_0x12e4('0x35')][a18_0x12e4('0x21')]('player/open');this[a18_0x12e4('0x35')][a18_0x12e4('0x21')]('player/close');this[a18_0x12e4('0x35')][a18_0x12e4('0x21')](a18_0x12e4('0x40'),{'qos':0x2});this[a18_0x12e4('0x35')][a18_0x12e4('0x21')](a18_0x12e4('0x41'),{'qos':0x2});this[a18_0x12e4('0x35')]['subscribe'](a18_0x12e4('0x42'),{'qos':0x2});this[a18_0x12e4('0x35')]['subscribe'](a18_0x12e4('0x43'),{'qos':0x2});this[a18_0x12e4('0x35')][a18_0x12e4('0x21')](a18_0x12e4('0x44'),{'qos':0x2});this[a18_0x12e4('0x35')][a18_0x12e4('0x21')]('player/register',{'qos':0x2});}[a18_0x12e4('0x45')](){}['mqttClient_message'](_0x9299be,_0x570db3){console[a18_0x12e4('0x11')]('received\x20message\x20%s\x20%s',_0x9299be,_0x570db3);switch(_0x9299be){case a18_0x12e4('0x46'):return this[a18_0x12e4('0x47')](_0x570db3);case'player/close':return this['handleCloseRequest'](_0x570db3);case'player/reboot':return this[a18_0x12e4('0x48')](_0x570db3);case a18_0x12e4('0x42'):return this[a18_0x12e4('0x49')](_0x570db3);case a18_0x12e4('0x41'):return this[a18_0x12e4('0x4a')](_0x570db3);case a18_0x12e4('0x43'):return this[a18_0x12e4('0x4b')](_0x570db3);case a18_0x12e4('0x44'):return this[a18_0x12e4('0x4c')](_0x570db3);case a18_0x12e4('0x4d'):return this[a18_0x12e4('0x4e')](_0x570db3);}}['handleRegisterRequest'](_0x46f0a4){if(_0x46f0a4=='all'||_0x46f0a4==String(this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')])){this['syncPlaylistsService'][a18_0x12e4('0x50')]();}}['handleIfconfigRequest'](_0x47fb88){if(_0x47fb88==a18_0x12e4('0x51')||_0x47fb88==String(this[a18_0x12e4('0xb')]['playerId'])){}}['handleUpdateRequest'](_0x12397f){console['log'](a18_0x12e4('0x52')+_0x12397f);if(_0x12397f==a18_0x12e4('0x51')||_0x12397f==String(this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')])){const _0x4da078=__dirname;const _0x404f31=require(a18_0x12e4('0x53'))(_0x4da078);console[a18_0x12e4('0x11')](a18_0x12e4('0x54'));_0x404f31[a18_0x12e4('0x55')]((_0x5f2bb5,_0x2b7763)=>{if(_0x5f2bb5){console[a18_0x12e4('0x11')]('Error\x20git\x20updated');this[a18_0x12e4('0x4b')](_0x12397f);return;}else{}console['log'](a18_0x12e4('0x56'));console[a18_0x12e4('0x11')](_0x2b7763);if(_0x2b7763&&_0x2b7763[a18_0x12e4('0x57')][a18_0x12e4('0x58')]){const _0x1f9b8c=spawn('shutdown',['-r','now']);}else{}});}}[a18_0x12e4('0x4a')](_0x27da65){if(_0x27da65=='all'||_0x27da65==String(this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')])){this[a18_0x12e4('0xb')][a18_0x12e4('0x59')]();}}[a18_0x12e4('0x49')](_0x272a2b){if(String(_0x272a2b)=='all'||String(_0x272a2b)==String(this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')])){this[a18_0x12e4('0xb')][a18_0x12e4('0x5a')]();}}[a18_0x12e4('0x48')](_0x249cfc){if(_0x249cfc==a18_0x12e4('0x51')||_0x249cfc==String(this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')])){console[a18_0x12e4('0x11')](a18_0x12e4('0x48'));const _0x990d06=spawn('shutdown',['-r',a18_0x12e4('0x1f')]);}}[a18_0x12e4('0x5b')](){console['log'](a18_0x12e4('0x5c'),this['state']);this[a18_0x12e4('0x35')]['publish'](a18_0x12e4('0x5d'),this[a18_0x12e4('0xb')][a18_0x12e4('0x4f')]+'-'+this[a18_0x12e4('0xc')]);}[a18_0x12e4('0x47')](_0x5cd878){if(this[a18_0x12e4('0xc')]!==a18_0x12e4('0x5e')&&this[a18_0x12e4('0xc')]!==a18_0x12e4('0x5f')){console[a18_0x12e4('0x11')](a18_0x12e4('0x60'));this[a18_0x12e4('0xc')]='opening';this[a18_0x12e4('0x5b')]();setTimeout(()=>{this['state']=a18_0x12e4('0x5e');this[a18_0x12e4('0x5b')]();},0x1388);}}['handleCloseRequest'](_0x330e87){if(this[a18_0x12e4('0xc')]!==a18_0x12e4('0xd')&&this['state']!==a18_0x12e4('0x61')){this['state']='closing';this[a18_0x12e4('0x5b')]();setTimeout(()=>{this['state']=a18_0x12e4('0xd');this[a18_0x12e4('0x5b')]();},0x1388);}}[a18_0x12e4('0x3c')](_0x28acc8,_0x173274){if(_0x173274){console['log'](_0x173274[a18_0x12e4('0x62')]);}this[a18_0x12e4('0x35')][a18_0x12e4('0x26')]('player/connected',a18_0x12e4('0x63'));}[a18_0x12e4('0x1c')](_0x2b8d54,_0x3fa785,_0x5e50b9){const _0x4fed16={'iat':Math[a18_0x12e4('0x64')](Date[a18_0x12e4('0x1f')]()/0x3e8),'exp':Math[a18_0x12e4('0x64')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x2b8d54};const _0x2135f4=fs[a18_0x12e4('0x65')](_0x3fa785);return jwt[a18_0x12e4('0x66')](_0x4fed16,_0x2135f4,{'algorithm':_0x5e50b9});}}exports[a18_0x12e4('0x67')]=MqttService;