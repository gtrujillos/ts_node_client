var a18_0x1f0e=['player/close','player/load_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','playerId','all','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','shutdown','now','handleLoadPlaylistRequest','reloadMediaList','sudo','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closed','closing','stack','publish','player/connected','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','request-progress','spawn','is-image','uuid/v4','syncPlaylistsService','state','httpClientService','HttpClientService','log','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','connect','subscribe','/devices/','/config','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','toString','ascii','packetsend','mqttInit_mosquitto','mqttInit','clientId','this.clientId','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:'];(function(_0x4ea586,_0x4a892b){var _0x43e1b0=function(_0x308536){while(--_0x308536){_0x4ea586['push'](_0x4ea586['shift']());}};_0x43e1b0(++_0x4a892b);}(a18_0x1f0e,0x1b5));var a18_0x511d=function(_0x743885,_0x387242){_0x743885=_0x743885-0x0;var _0x4a108c=a18_0x1f0e[_0x743885];return _0x4a108c;};'use strict';Object[a18_0x511d('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x511d('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a18_0x511d('0x2'));const spawn=require('child_process')[a18_0x511d('0x3')];const isImage=require(a18_0x511d('0x4'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x511d('0x5'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1dba51){this[a18_0x511d('0x6')]=_0x1dba51;this[a18_0x511d('0x7')]='closed';this[a18_0x511d('0x8')]=new HttpClientService_1[(a18_0x511d('0x9'))]();}['init'](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console[a18_0x511d('0xa')]('mqttInit');const _0x253dc1='velvety-glazing-252020';const _0xc7c954='my-node-device';const _0x57d67f='my-registry';const _0x197296=a18_0x511d('0xb');const _0x26c453=a18_0x511d('0xc');const _0x15b49e=a18_0x511d('0xd');const _0x28fedc=a18_0x511d('0xe');const _0x45afb5=0x1bb;const _0x352785=a18_0x511d('0xf');const _0x22f2f1=0x5;const _0x1e018c='projects/'+_0x253dc1+'/locations/'+_0x197296+a18_0x511d('0x10')+_0x57d67f+'/devices/'+_0xc7c954;const _0x2cc3e7={'host':_0x28fedc,'port':_0x45afb5,'clientId':_0x1e018c,'username':a18_0x511d('0x11'),'password':this[a18_0x511d('0x12')](_0x253dc1,_0x15b49e,_0x26c453),'protocol':a18_0x511d('0x13'),'secureProtocol':a18_0x511d('0x14')};const _0x5d0ded=Math[a18_0x511d('0x15')](Date['now']()/0x3e8);const _0x23b61a=mqtt[a18_0x511d('0x16')](_0x2cc3e7);_0x23b61a[a18_0x511d('0x17')](a18_0x511d('0x18')+_0xc7c954+a18_0x511d('0x19'),{'qos':0x1});_0x23b61a['subscribe'](a18_0x511d('0x18')+_0xc7c954+'/state',{'qos':0x1});_0x23b61a[a18_0x511d('0x17')]('/devices/'+_0xc7c954+a18_0x511d('0x1a'),{'qos':0x0});const _0x386f1a=a18_0x511d('0x18')+_0xc7c954+'/'+_0x352785;_0x23b61a['on'](a18_0x511d('0x16'),_0x2c6114=>{console[a18_0x511d('0xa')]('connect');if(!_0x2c6114){console['log'](a18_0x511d('0x1b'));}else{const _0x386f1a=a18_0x511d('0x1c');const _0x560121=_0x57d67f+'/'+_0xc7c954+'-payload-0';_0x23b61a['publish'](_0x386f1a,_0x560121,{'qos':0x1},_0x2a3024=>{console['log']('publish\x20result:');console['log'](_0x2a3024);if(!_0x2a3024){}});}});_0x23b61a['on']('close',()=>{console['log'](a18_0x511d('0x1d'));});_0x23b61a['on'](a18_0x511d('0x1e'),_0x3b93ce=>{console[a18_0x511d('0xa')](a18_0x511d('0x1e'),_0x3b93ce);});_0x23b61a['on'](a18_0x511d('0x1f'),(_0x2ff8d3,_0x87b828)=>{let _0x188a3a=a18_0x511d('0x20');console[a18_0x511d('0xa')](_0x2ff8d3);console['log'](_0x87b828+'');if(_0x2ff8d3===a18_0x511d('0x18')+_0xc7c954+a18_0x511d('0x19')){_0x188a3a=a18_0x511d('0x21');}else if(_0x2ff8d3[a18_0x511d('0x22')](a18_0x511d('0x18')+_0xc7c954+'/commands')){_0x188a3a=a18_0x511d('0x23');}_0x188a3a+=Buffer['from'](_0x87b828,'base64')[a18_0x511d('0x24')](a18_0x511d('0x25'));console[a18_0x511d('0xa')](_0x188a3a);});_0x23b61a['on'](a18_0x511d('0x26'),()=>{});console['log'](_0x2cc3e7);}[a18_0x511d('0x27')](){console[a18_0x511d('0xa')](a18_0x511d('0x28'));this[a18_0x511d('0x29')]=uuidv4();console[a18_0x511d('0xa')](a18_0x511d('0x2a'));console[a18_0x511d('0xa')](this[a18_0x511d('0x29')]);const _0x508587={'clientId':this[a18_0x511d('0x29')],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this[a18_0x511d('0x2b')]=mqtt[a18_0x511d('0x16')](a18_0x511d('0x2c'),_0x508587);this[a18_0x511d('0x2b')]['on']('connect',this['mqttClient_connect'][a18_0x511d('0x2d')](this));this[a18_0x511d('0x2b')]['on'](a18_0x511d('0x1f'),this[a18_0x511d('0x2e')][a18_0x511d('0x2d')](this));this[a18_0x511d('0x2b')]['on']('close',()=>{console['log'](a18_0x511d('0x1d'));});process['on'](a18_0x511d('0x2f'),this[a18_0x511d('0x30')][a18_0x511d('0x2d')](this));process['on'](a18_0x511d('0x31'),this[a18_0x511d('0x30')][a18_0x511d('0x2d')](this));process['on'](a18_0x511d('0x32'),this['handleAppExit']['bind'](this));}[a18_0x511d('0x33')](){console['log'](a18_0x511d('0x34')+this[a18_0x511d('0x29')]);this[a18_0x511d('0x2b')][a18_0x511d('0x17')]('player/open');this[a18_0x511d('0x2b')]['subscribe'](a18_0x511d('0x35'));this['mqttClient']['subscribe']('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x511d('0x17')](a18_0x511d('0x36'),{'qos':0x2});this[a18_0x511d('0x2b')]['subscribe']('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x511d('0x17')](a18_0x511d('0x37'),{'qos':0x2});this[a18_0x511d('0x2b')][a18_0x511d('0x17')](a18_0x511d('0x38'),{'qos':0x2});this[a18_0x511d('0x2b')][a18_0x511d('0x17')](a18_0x511d('0x39'),{'qos':0x2});}[a18_0x511d('0x3a')](){}[a18_0x511d('0x2e')](_0x5347a5,_0x35d73a){console[a18_0x511d('0xa')](a18_0x511d('0x3b'),_0x5347a5,_0x35d73a);switch(_0x5347a5){case a18_0x511d('0x3c'):return this[a18_0x511d('0x3d')](_0x35d73a);case a18_0x511d('0x35'):return this[a18_0x511d('0x3e')](_0x35d73a);case a18_0x511d('0x3f'):return this[a18_0x511d('0x40')](_0x35d73a);case a18_0x511d('0x41'):return this[a18_0x511d('0x42')](_0x35d73a);case a18_0x511d('0x36'):return this['handleLoadPlaylistRequest'](_0x35d73a);case a18_0x511d('0x37'):return this['handleUpdateRequest'](_0x35d73a);case a18_0x511d('0x38'):return this[a18_0x511d('0x43')](_0x35d73a);case a18_0x511d('0x39'):return this[a18_0x511d('0x44')](_0x35d73a);}}[a18_0x511d('0x44')](_0x11d654){if(_0x11d654=='all'||_0x11d654==String(this[a18_0x511d('0x6')][a18_0x511d('0x45')])){this[a18_0x511d('0x6')]['registerClient']();}}[a18_0x511d('0x43')](_0x1c8138){if(_0x1c8138==a18_0x511d('0x46')||_0x1c8138==String(this[a18_0x511d('0x6')][a18_0x511d('0x45')])){}}[a18_0x511d('0x47')](_0x2a2ea2){console['log'](a18_0x511d('0x48')+_0x2a2ea2);if(_0x2a2ea2==a18_0x511d('0x46')||_0x2a2ea2==String(this['syncPlaylistsService']['playerId'])){const _0x121bba=__dirname;const _0xe5eddb=require(a18_0x511d('0x49'))(_0x121bba);console[a18_0x511d('0xa')](a18_0x511d('0x4a'));_0xe5eddb[a18_0x511d('0x4b')]((_0xc17811,_0x397ada)=>{if(_0xc17811){console[a18_0x511d('0xa')](a18_0x511d('0x4c'));this[a18_0x511d('0x47')](_0x2a2ea2);return;}else{}console['log'](a18_0x511d('0x4d'));console[a18_0x511d('0xa')](_0x397ada);if(_0x397ada&&_0x397ada[a18_0x511d('0x4e')]['changes']){const _0x49d8e6=spawn(a18_0x511d('0x4f'),['-r',a18_0x511d('0x50')]);}else{}});}}[a18_0x511d('0x51')](_0x281d1d){if(_0x281d1d==a18_0x511d('0x46')||_0x281d1d==String(this[a18_0x511d('0x6')][a18_0x511d('0x45')])){this[a18_0x511d('0x6')]['loadMediaList']();}}[a18_0x511d('0x42')](_0x559232){if(String(_0x559232)=='all'||String(_0x559232)==String(this[a18_0x511d('0x6')][a18_0x511d('0x45')])){this['syncPlaylistsService'][a18_0x511d('0x52')]();}}[a18_0x511d('0x40')](_0x404b81){if(_0x404b81==a18_0x511d('0x46')||_0x404b81==String(this['syncPlaylistsService']['playerId'])){console[a18_0x511d('0xa')]('handleRebootRequest');const _0x45b806=spawn(a18_0x511d('0x53'),[a18_0x511d('0x4f'),'-r',a18_0x511d('0x50')]);}}[a18_0x511d('0x54')](){console['log'](a18_0x511d('0x55'),this[a18_0x511d('0x7')]);this[a18_0x511d('0x2b')]['publish'](a18_0x511d('0x56'),this[a18_0x511d('0x6')]['playerId']+'-'+this[a18_0x511d('0x7')]);}[a18_0x511d('0x3d')](_0x1fd64e){if(this['state']!==a18_0x511d('0x57')&&this[a18_0x511d('0x7')]!==a18_0x511d('0x58')){console[a18_0x511d('0xa')](a18_0x511d('0x59'));this[a18_0x511d('0x7')]=a18_0x511d('0x58');this[a18_0x511d('0x54')]();setTimeout(()=>{this[a18_0x511d('0x7')]=a18_0x511d('0x57');this[a18_0x511d('0x54')]();},0x1388);}}[a18_0x511d('0x3e')](_0x3911ba){if(this[a18_0x511d('0x7')]!==a18_0x511d('0x5a')&&this[a18_0x511d('0x7')]!==a18_0x511d('0x5b')){this[a18_0x511d('0x7')]=a18_0x511d('0x5b');this[a18_0x511d('0x54')]();setTimeout(()=>{this[a18_0x511d('0x7')]=a18_0x511d('0x5a');this[a18_0x511d('0x54')]();},0x1388);}}['handleAppExit'](_0x4a92ae,_0x515a98){if(_0x515a98){console[a18_0x511d('0xa')](_0x515a98[a18_0x511d('0x5c')]);}this[a18_0x511d('0x2b')][a18_0x511d('0x5d')](a18_0x511d('0x5e'),'false');}[a18_0x511d('0x12')](_0x1acfc3,_0x5dc6d5,_0x202310){const _0x167d9e={'iat':Math[a18_0x511d('0x15')](Date['now']()/0x3e8),'exp':Math[a18_0x511d('0x15')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x1acfc3};const _0xb98ddd=fs[a18_0x511d('0x5f')](_0x5dc6d5);return jwt[a18_0x511d('0x60')](_0x167d9e,_0xb98ddd,{'algorithm':_0x202310});}}exports[a18_0x511d('0x61')]=MqttService;