var a18_0x42ee=['all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updated','summary','changes','shutdown','loadMediaList','sudo','now','sendStateUpdate','sending\x20state\x20%s','publish','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','player/connected','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','is-image','string-template','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','us-central1','resources/keys/rsa_private.pem','events','projects/','/locations/','/devices/','unused','createJwt','mqtts','round','subscribe','/state','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish\x20result:','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','message','bind','exit','handleAppExit','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','mqttClient_message','received\x20message\x20%s\x20%s','player/open','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest'];(function(_0x411373,_0x2f295b){var _0x4b9487=function(_0x5e9802){while(--_0x5e9802){_0x411373['push'](_0x411373['shift']());}};_0x4b9487(++_0x2f295b);}(a18_0x42ee,0x1be));var a18_0x468c=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a18_0x42ee[_0x2d8f05];return _0x4d74cb;};'use strict';Object[a18_0x468c('0x0')](exports,a18_0x468c('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x468c('0x2'));const fs=require('fs');const fsExtra=require(a18_0x468c('0x3'));const request=require('request');const progress=require(a18_0x468c('0x4'));const spawn=require(a18_0x468c('0x5'))[a18_0x468c('0x6')];const isImage=require(a18_0x468c('0x7'));const format=require(a18_0x468c('0x8'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x3d859f){this[a18_0x468c('0x9')]=_0x3d859f;this[a18_0x468c('0xa')]=a18_0x468c('0xb');this[a18_0x468c('0xc')]=new HttpClientService_1[(a18_0x468c('0xd'))]();}[a18_0x468c('0xe')](){this[a18_0x468c('0xf')]();}[a18_0x468c('0x10')](){console[a18_0x468c('0x11')](a18_0x468c('0x12'));const _0x369c40='velvety-glazing-252020';const _0x8380e8=a18_0x468c('0x13');const _0x1aaeea='my-registry';const _0x5f6a66=a18_0x468c('0x14');const _0x960b76='RS256';const _0x1e306e=a18_0x468c('0x15');const _0x370126='mqtt.googleapis.com';const _0xefee53=0x1bb;const _0x360827=a18_0x468c('0x16');const _0x11adfd=0x5;const _0x268f9d=a18_0x468c('0x17')+_0x369c40+a18_0x468c('0x18')+_0x5f6a66+'/registries/'+_0x1aaeea+a18_0x468c('0x19')+_0x8380e8;const _0x2d5e26={'host':_0x370126,'port':_0xefee53,'clientId':_0x268f9d,'username':a18_0x468c('0x1a'),'password':this[a18_0x468c('0x1b')](_0x369c40,_0x1e306e,_0x960b76),'protocol':a18_0x468c('0x1c'),'secureProtocol':'TLSv1_2_method'};const _0x4bc590=Math[a18_0x468c('0x1d')](Date['now']()/0x3e8);const _0x1fafbe=mqtt['connect'](_0x2d5e26);_0x1fafbe[a18_0x468c('0x1e')](a18_0x468c('0x19')+_0x8380e8+'/config',{'qos':0x1});_0x1fafbe[a18_0x468c('0x1e')](a18_0x468c('0x19')+_0x8380e8+a18_0x468c('0x1f'),{'qos':0x1});_0x1fafbe[a18_0x468c('0x1e')](a18_0x468c('0x19')+_0x8380e8+a18_0x468c('0x20'),{'qos':0x0});const _0x1a9ef8=a18_0x468c('0x19')+_0x8380e8+'/'+_0x360827;_0x1fafbe['on'](a18_0x468c('0x21'),_0x38a242=>{console[a18_0x468c('0x11')]('connect');if(!_0x38a242){console[a18_0x468c('0x11')](a18_0x468c('0x22'));}else{const _0x1a9ef8=a18_0x468c('0x23');const _0x11df55=_0x1aaeea+'/'+_0x8380e8+a18_0x468c('0x24');_0x1fafbe['publish'](_0x1a9ef8,_0x11df55,{'qos':0x1},_0x57fa8b=>{console[a18_0x468c('0x11')](a18_0x468c('0x25'));console[a18_0x468c('0x11')](_0x57fa8b);if(!_0x57fa8b){}});}});_0x1fafbe['on']('close',()=>{console[a18_0x468c('0x11')](a18_0x468c('0x26'));});_0x1fafbe['on'](a18_0x468c('0x27'),_0x483bb7=>{console[a18_0x468c('0x11')](a18_0x468c('0x27'),_0x483bb7);});_0x1fafbe['on']('message',(_0x3bc543,_0x1a651f)=>{let _0x174cbd=a18_0x468c('0x28');console[a18_0x468c('0x11')](_0x3bc543);console[a18_0x468c('0x11')](_0x1a651f+'');if(_0x3bc543===a18_0x468c('0x19')+_0x8380e8+a18_0x468c('0x29')){_0x174cbd=a18_0x468c('0x2a');}else if(_0x3bc543[a18_0x468c('0x2b')](a18_0x468c('0x19')+_0x8380e8+a18_0x468c('0x2c'))){_0x174cbd=a18_0x468c('0x2d');}_0x174cbd+=Buffer[a18_0x468c('0x2e')](_0x1a651f,'base64')[a18_0x468c('0x2f')](a18_0x468c('0x30'));console[a18_0x468c('0x11')](_0x174cbd);});_0x1fafbe['on'](a18_0x468c('0x31'),()=>{});console['log'](_0x2d5e26);}[a18_0x468c('0xf')](){console['log'](a18_0x468c('0x12'));this[a18_0x468c('0x32')]=uuidv4();console[a18_0x468c('0x11')](a18_0x468c('0x33'));console[a18_0x468c('0x11')](this[a18_0x468c('0x32')]);const _0x1c4fff={'clientId':this[a18_0x468c('0x32')],'username':a18_0x468c('0x34'),'password':a18_0x468c('0x35'),'clean':!![]};this[a18_0x468c('0x36')]=mqtt[a18_0x468c('0x21')](a18_0x468c('0x37'),_0x1c4fff);this['mqttClient']['on'](a18_0x468c('0x21'),this[a18_0x468c('0x38')]['bind'](this));this[a18_0x468c('0x36')]['on'](a18_0x468c('0x39'),this['mqttClient_message'][a18_0x468c('0x3a')](this));this[a18_0x468c('0x36')]['on']('close',()=>{console[a18_0x468c('0x11')](a18_0x468c('0x26'));});process['on'](a18_0x468c('0x3b'),this[a18_0x468c('0x3c')]['bind'](this));process['on']('SIGINT',this[a18_0x468c('0x3c')][a18_0x468c('0x3a')](this));process['on']('uncaughtException',this[a18_0x468c('0x3c')]['bind'](this));}[a18_0x468c('0x38')](){console[a18_0x468c('0x11')](a18_0x468c('0x3d')+this[a18_0x468c('0x32')]);this[a18_0x468c('0x36')]['subscribe']('player/open');this[a18_0x468c('0x36')]['subscribe'](a18_0x468c('0x3e'));this[a18_0x468c('0x36')][a18_0x468c('0x1e')]('player/reboot',{'qos':0x2});this[a18_0x468c('0x36')][a18_0x468c('0x1e')](a18_0x468c('0x3f'),{'qos':0x2});this[a18_0x468c('0x36')][a18_0x468c('0x1e')](a18_0x468c('0x40'),{'qos':0x2});this[a18_0x468c('0x36')]['subscribe'](a18_0x468c('0x41'),{'qos':0x2});this[a18_0x468c('0x36')][a18_0x468c('0x1e')](a18_0x468c('0x42'),{'qos':0x2});this[a18_0x468c('0x36')][a18_0x468c('0x1e')](a18_0x468c('0x43'),{'qos':0x2});}['reportStatus'](){}[a18_0x468c('0x44')](_0x18ee30,_0xcd5959){console[a18_0x468c('0x11')](a18_0x468c('0x45'),_0x18ee30,_0xcd5959);switch(_0x18ee30){case a18_0x468c('0x46'):return this['handleOpenRequest'](_0xcd5959);case a18_0x468c('0x3e'):return this[a18_0x468c('0x47')](_0xcd5959);case a18_0x468c('0x48'):return this[a18_0x468c('0x49')](_0xcd5959);case a18_0x468c('0x40'):return this[a18_0x468c('0x4a')](_0xcd5959);case a18_0x468c('0x3f'):return this[a18_0x468c('0x4b')](_0xcd5959);case'player/update':return this[a18_0x468c('0x4c')](_0xcd5959);case a18_0x468c('0x42'):return this[a18_0x468c('0x4d')](_0xcd5959);case a18_0x468c('0x43'):return this[a18_0x468c('0x4e')](_0xcd5959);}}[a18_0x468c('0x4e')](_0x374b9f){if(_0x374b9f==a18_0x468c('0x4f')||_0x374b9f==String(this[a18_0x468c('0x9')][a18_0x468c('0x50')])){this[a18_0x468c('0x9')][a18_0x468c('0x51')]();}}[a18_0x468c('0x4d')](_0x376f71){if(_0x376f71=='all'||_0x376f71==String(this[a18_0x468c('0x9')]['playerId'])){}}[a18_0x468c('0x4c')](_0x462ea3){console[a18_0x468c('0x11')](a18_0x468c('0x52')+_0x462ea3);if(_0x462ea3==a18_0x468c('0x4f')||_0x462ea3==String(this[a18_0x468c('0x9')][a18_0x468c('0x50')])){const _0x422d73=__dirname;const _0x436a4b=require(a18_0x468c('0x53'))(_0x422d73);console[a18_0x468c('0x11')]('Git\x20updating');_0x436a4b['pull']((_0x865fc2,_0x4bb77a)=>{if(_0x865fc2){console[a18_0x468c('0x11')]('Error\x20git\x20updated');this[a18_0x468c('0x4c')](_0x462ea3);return;}else{}console[a18_0x468c('0x11')](a18_0x468c('0x54'));console[a18_0x468c('0x11')](_0x4bb77a);if(_0x4bb77a&&_0x4bb77a[a18_0x468c('0x55')][a18_0x468c('0x56')]){const _0x45b6d4=spawn(a18_0x468c('0x57'),['-r','now']);}else{}});}}[a18_0x468c('0x4b')](_0x3b431d){if(_0x3b431d==a18_0x468c('0x4f')||_0x3b431d==String(this[a18_0x468c('0x9')]['playerId'])){this[a18_0x468c('0x9')][a18_0x468c('0x58')]();}}[a18_0x468c('0x4a')](_0x736ef6){if(String(_0x736ef6)==a18_0x468c('0x4f')||String(_0x736ef6)==String(this['syncPlaylistsService'][a18_0x468c('0x50')])){this[a18_0x468c('0x9')]['reloadMediaList']();}}[a18_0x468c('0x49')](_0x847879){if(_0x847879=='all'||_0x847879==String(this[a18_0x468c('0x9')]['playerId'])){console[a18_0x468c('0x11')](a18_0x468c('0x49'));const _0x446fe9=spawn(a18_0x468c('0x59'),[a18_0x468c('0x57'),'-r',a18_0x468c('0x5a')]);}}[a18_0x468c('0x5b')](){console[a18_0x468c('0x11')](a18_0x468c('0x5c'),this[a18_0x468c('0xa')]);this['mqttClient'][a18_0x468c('0x5d')](a18_0x468c('0x5e'),this[a18_0x468c('0x9')][a18_0x468c('0x50')]+'-'+this[a18_0x468c('0xa')]);}[a18_0x468c('0x5f')](_0x12712a){if(this['state']!==a18_0x468c('0x60')&&this[a18_0x468c('0xa')]!==a18_0x468c('0x61')){console[a18_0x468c('0x11')](a18_0x468c('0x62'));this[a18_0x468c('0xa')]='opening';this[a18_0x468c('0x5b')]();setTimeout(()=>{this[a18_0x468c('0xa')]=a18_0x468c('0x60');this[a18_0x468c('0x5b')]();},0x1388);}}[a18_0x468c('0x47')](_0x658eb0){if(this[a18_0x468c('0xa')]!==a18_0x468c('0xb')&&this['state']!=='closing'){this[a18_0x468c('0xa')]=a18_0x468c('0x63');this[a18_0x468c('0x5b')]();setTimeout(()=>{this[a18_0x468c('0xa')]=a18_0x468c('0xb');this[a18_0x468c('0x5b')]();},0x1388);}}['handleAppExit'](_0x39568b,_0x237739){if(_0x237739){console['log'](_0x237739[a18_0x468c('0x64')]);}this['mqttClient'][a18_0x468c('0x5d')](a18_0x468c('0x65'),'false');}[a18_0x468c('0x1b')](_0x44e91d,_0x3520d3,_0x464208){const _0x868071={'iat':Math[a18_0x468c('0x1d')](Date[a18_0x468c('0x5a')]()/0x3e8),'exp':Math[a18_0x468c('0x1d')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x44e91d};const _0x28b496=fs[a18_0x468c('0x66')](_0x3520d3);return jwt[a18_0x468c('0x67')](_0x868071,_0x28b496,{'algorithm':_0x464208});}}exports[a18_0x468c('0x68')]=MqttService;