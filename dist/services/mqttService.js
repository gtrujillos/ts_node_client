var a18_0x3883=['player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','syncPlaylistsService','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','shutdown','handleLoadPlaylistRequest','all','playerId','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','false','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','spawn','is-image','string-template','uuid/v4','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','message','mqttClient_message','bind','exit','handleAppExit','subscribe','player/close','player/load_playlist','player/reload_playlist','reportStatus','received\x20message\x20%s\x20%s'];(function(_0x4f84c9,_0x2d13e6){var _0x1e112f=function(_0x2ae67d){while(--_0x2ae67d){_0x4f84c9['push'](_0x4f84c9['shift']());}};_0x1e112f(++_0x2d13e6);}(a18_0x3883,0x102));var a18_0x9243=function(_0x4bc925,_0x1bb512){_0x4bc925=_0x4bc925-0x0;var _0x45f690=a18_0x3883[_0x4bc925];return _0x45f690;};'use strict';Object[a18_0x9243('0x0')](exports,a18_0x9243('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x9243('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x9243('0x3'));const progress=require(a18_0x9243('0x4'));const spawn=require('child_process')[a18_0x9243('0x5')];const isImage=require(a18_0x9243('0x6'));const format=require(a18_0x9243('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x9243('0x8'));class MqttService{constructor(_0x3f527d){this['syncPlaylistsService']=_0x3f527d;this[a18_0x9243('0x9')]=a18_0x9243('0xa');this[a18_0x9243('0xb')]=new HttpClientService_1[(a18_0x9243('0xc'))]();}[a18_0x9243('0xd')](){this[a18_0x9243('0xe')]();}[a18_0x9243('0xe')](){console[a18_0x9243('0xf')](a18_0x9243('0xe'));this[a18_0x9243('0x10')]=uuidv4();console[a18_0x9243('0xf')]('this.clientId');console[a18_0x9243('0xf')](this[a18_0x9243('0x10')]);const _0x2e105c={'clientId':this[a18_0x9243('0x10')],'username':a18_0x9243('0x11'),'password':a18_0x9243('0x12'),'clean':!![]};this[a18_0x9243('0x13')]=mqtt['connect']('mqtt://lulo.run',_0x2e105c);this[a18_0x9243('0x13')]['on']('connect',this[a18_0x9243('0x14')]['bind'](this));this[a18_0x9243('0x13')]['on'](a18_0x9243('0x15'),this[a18_0x9243('0x16')][a18_0x9243('0x17')](this));process['on'](a18_0x9243('0x18'),this['handleAppExit'][a18_0x9243('0x17')](this));process['on']('SIGINT',this[a18_0x9243('0x19')][a18_0x9243('0x17')](this));process['on']('uncaughtException',this[a18_0x9243('0x19')]['bind'](this));}[a18_0x9243('0x14')](){console[a18_0x9243('0xf')]('Connected\x20to\x20broker\x20client:'+this[a18_0x9243('0x10')]);this[a18_0x9243('0x13')][a18_0x9243('0x1a')]('player/open');this['mqttClient'][a18_0x9243('0x1a')](a18_0x9243('0x1b'));this['mqttClient']['subscribe']('player/reboot',{'qos':0x2});this[a18_0x9243('0x13')]['subscribe'](a18_0x9243('0x1c'),{'qos':0x2});this[a18_0x9243('0x13')]['subscribe'](a18_0x9243('0x1d'),{'qos':0x2});this[a18_0x9243('0x13')][a18_0x9243('0x1a')]('player/update',{'qos':0x2});}[a18_0x9243('0x1e')](){}[a18_0x9243('0x16')](_0x44a762,_0x45e92a){console['log'](a18_0x9243('0x1f'),_0x44a762,_0x45e92a);switch(_0x44a762){case'player/open':return this['handleOpenRequest'](_0x45e92a);case a18_0x9243('0x1b'):return this['handleCloseRequest'](_0x45e92a);case a18_0x9243('0x20'):return this[a18_0x9243('0x21')](_0x45e92a);case'player/reload_playlist':return this[a18_0x9243('0x22')](_0x45e92a);case a18_0x9243('0x1c'):return this['handleLoadPlaylistRequest'](_0x45e92a);case'player/update':return this['handleUpdateRequest'](_0x45e92a);}}[a18_0x9243('0x23')](_0xa425a4){if(_0xa425a4=='all'||_0xa425a4==String(this[a18_0x9243('0x24')]['playerId'])){const _0x292b09=__dirname;const _0x3e1fc6=require(a18_0x9243('0x25'))(_0x292b09);console['log'](a18_0x9243('0x26'));_0x3e1fc6[a18_0x9243('0x27')]((_0x24432b,_0x59fa20)=>{if(_0x24432b){console['log'](a18_0x9243('0x28'));this[a18_0x9243('0x23')](_0xa425a4);return;}else{}console['log']('Git\x20updated');console[a18_0x9243('0xf')](_0x59fa20);if(_0x59fa20&&_0x59fa20[a18_0x9243('0x29')][a18_0x9243('0x2a')]){const _0x3adf87=spawn(a18_0x9243('0x2b'),['-r','now']);}else{}});}}[a18_0x9243('0x2c')](_0x2dbb3b){if(_0x2dbb3b==a18_0x9243('0x2d')||_0x2dbb3b==String(this[a18_0x9243('0x24')][a18_0x9243('0x2e')])){this[a18_0x9243('0x24')]['loadMediaList']();}}[a18_0x9243('0x22')](_0x107727){if(_0x107727=='all'||_0x107727==String(this[a18_0x9243('0x24')]['playerId'])){this['syncPlaylistsService'][a18_0x9243('0x2f')]();}}[a18_0x9243('0x21')](_0x46abf3){if(_0x46abf3=='all'||_0x46abf3==String(this[a18_0x9243('0x24')][a18_0x9243('0x2e')])){const _0x1fa30c=spawn(a18_0x9243('0x2b'),['-r','now']);}}[a18_0x9243('0x30')](){console[a18_0x9243('0xf')](a18_0x9243('0x31'),this['state']);this[a18_0x9243('0x13')]['publish'](a18_0x9243('0x32'),this[a18_0x9243('0x24')][a18_0x9243('0x2e')]+'-'+this[a18_0x9243('0x9')]);}[a18_0x9243('0x33')](_0x47788c){if(this[a18_0x9243('0x9')]!==a18_0x9243('0x34')&&this[a18_0x9243('0x9')]!==a18_0x9243('0x35')){console['log'](a18_0x9243('0x36'));this[a18_0x9243('0x9')]=a18_0x9243('0x35');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x9243('0x9')]='open';this[a18_0x9243('0x30')]();},0x1388);}}['handleCloseRequest'](_0xbef082){if(this[a18_0x9243('0x9')]!==a18_0x9243('0xa')&&this[a18_0x9243('0x9')]!==a18_0x9243('0x37')){this[a18_0x9243('0x9')]=a18_0x9243('0x37');this[a18_0x9243('0x30')]();setTimeout(()=>{this[a18_0x9243('0x9')]=a18_0x9243('0xa');this['sendStateUpdate']();},0x1388);}}[a18_0x9243('0x19')](_0x3033af,_0x2b1eb3){if(_0x2b1eb3){console[a18_0x9243('0xf')](_0x2b1eb3[a18_0x9243('0x38')]);}this[a18_0x9243('0x13')]['publish']('player/connected',a18_0x9243('0x39'));}}exports['MqttService']=MqttService;