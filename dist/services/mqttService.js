var a20_0x4250=['error','message','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','player/close','player/reboot','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','sending\x20state\x20%s','state','publish','player/state','handleOpenRequest','opening','opening\x20player\x20door','sendStateUpdate','open','handleCloseRequest','closing','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','exec','string-template','mqtt','uuid/v4','syncPlaylistsService','closed','HttpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','close'];(function(_0x539cfe,_0x13140b){var _0x4f37dc=function(_0x3c0202){while(--_0x3c0202){_0x539cfe['push'](_0x539cfe['shift']());}};_0x4f37dc(++_0x13140b);}(a20_0x4250,0xc6));var a20_0x1650=function(_0x1e902b,_0x36228f){_0x1e902b=_0x1e902b-0x0;var _0x21feb9=a20_0x4250[_0x1e902b];return _0x21feb9;};'use strict';Object[a20_0x1650('0x0')](exports,a20_0x1650('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x1650('0x2'));const fs=require('fs');const fsExtra=require(a20_0x1650('0x3'));const request=require(a20_0x1650('0x4'));const progress=require(a20_0x1650('0x5'));const spawn=require('child_process')[a20_0x1650('0x6')];const exec=require('child_process')[a20_0x1650('0x7')];const isImage=require('is-image');const format=require(a20_0x1650('0x8'));const os=require('os');const mqtt=require(a20_0x1650('0x9'));const uuidv4=require(a20_0x1650('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x5b626c){this[a20_0x1650('0xb')]=_0x5b626c;this['state']=a20_0x1650('0xc');this['httpClientService']=new HttpClientService_1[(a20_0x1650('0xd'))]();}[a20_0x1650('0xe')](){this[a20_0x1650('0xf')]();}['mqttInit_google'](){console[a20_0x1650('0x10')](a20_0x1650('0x11'));const _0x54e392=a20_0x1650('0x12');const _0x235fd2='my-node-device';const _0x535f84=a20_0x1650('0x13');const _0x25c9a3='us-central1';const _0x29dedb=a20_0x1650('0x14');const _0x3b78a0=a20_0x1650('0x15');const _0x29433c=a20_0x1650('0x16');const _0x4e79e7=0x1bb;const _0x23ea06=a20_0x1650('0x17');const _0x1d560b=0x5;const _0x4d066d=a20_0x1650('0x18')+_0x54e392+a20_0x1650('0x19')+_0x25c9a3+a20_0x1650('0x1a')+_0x535f84+a20_0x1650('0x1b')+_0x235fd2;const _0x4fe948={'host':_0x29433c,'port':_0x4e79e7,'clientId':_0x4d066d,'username':'unused','password':this[a20_0x1650('0x1c')](_0x54e392,_0x3b78a0,_0x29dedb),'protocol':a20_0x1650('0x1d'),'secureProtocol':a20_0x1650('0x1e')};const _0x561b06=Math[a20_0x1650('0x1f')](Date[a20_0x1650('0x20')]()/0x3e8);const _0x5c6b8b=mqtt[a20_0x1650('0x21')](_0x4fe948);_0x5c6b8b[a20_0x1650('0x22')](a20_0x1650('0x1b')+_0x235fd2+a20_0x1650('0x23'),{'qos':0x1});_0x5c6b8b[a20_0x1650('0x22')]('/devices/'+_0x235fd2+a20_0x1650('0x24'),{'qos':0x1});_0x5c6b8b[a20_0x1650('0x22')]('/devices/'+_0x235fd2+a20_0x1650('0x25'),{'qos':0x0});const _0xefb574=a20_0x1650('0x1b')+_0x235fd2+'/'+_0x23ea06;_0x5c6b8b['on'](a20_0x1650('0x21'),_0x52eb09=>{console['log'](a20_0x1650('0x21'));if(!_0x52eb09){console[a20_0x1650('0x10')](a20_0x1650('0x26'));}else{const _0xefb574=a20_0x1650('0x27');const _0x17e445=_0x535f84+'/'+_0x235fd2+a20_0x1650('0x28');_0x5c6b8b['publish'](_0xefb574,_0x17e445,{'qos':0x1},_0x6c281f=>{console['log']('publish\x20result:');console[a20_0x1650('0x10')](_0x6c281f);if(!_0x6c281f){}});}});_0x5c6b8b['on'](a20_0x1650('0x29'),()=>{console[a20_0x1650('0x10')]('close');});_0x5c6b8b['on'](a20_0x1650('0x2a'),_0x4ebf11=>{console[a20_0x1650('0x10')](a20_0x1650('0x2a'),_0x4ebf11);});_0x5c6b8b['on'](a20_0x1650('0x2b'),(_0x3fe532,_0x2ecc94)=>{let _0x267cd6='Message\x20received:\x20';console[a20_0x1650('0x10')](_0x3fe532);console['log'](_0x2ecc94+'');if(_0x3fe532==='/devices/'+_0x235fd2+a20_0x1650('0x23')){_0x267cd6=a20_0x1650('0x2c');}else if(_0x3fe532[a20_0x1650('0x2d')]('/devices/'+_0x235fd2+'/commands')){_0x267cd6=a20_0x1650('0x2e');}_0x267cd6+=Buffer[a20_0x1650('0x2f')](_0x2ecc94,a20_0x1650('0x30'))[a20_0x1650('0x31')](a20_0x1650('0x32'));console[a20_0x1650('0x10')](_0x267cd6);});_0x5c6b8b['on'](a20_0x1650('0x33'),()=>{});console[a20_0x1650('0x10')](_0x4fe948);}[a20_0x1650('0xf')](){console['log']('mqttInit');this[a20_0x1650('0x34')]=uuidv4();console[a20_0x1650('0x10')](a20_0x1650('0x35'));console[a20_0x1650('0x10')](this[a20_0x1650('0x34')]);const _0x123238={'clientId':this[a20_0x1650('0x34')],'username':a20_0x1650('0x36'),'password':a20_0x1650('0x37'),'clean':!![]};this[a20_0x1650('0x38')]=mqtt['connect'](a20_0x1650('0x39'),_0x123238);this[a20_0x1650('0x38')]['on'](a20_0x1650('0x21'),this[a20_0x1650('0x3a')][a20_0x1650('0x3b')](this));this[a20_0x1650('0x38')]['on'](a20_0x1650('0x2b'),this[a20_0x1650('0x3c')]['bind'](this));this[a20_0x1650('0x38')]['on']('close',()=>{console[a20_0x1650('0x10')]('close');});process['on'](a20_0x1650('0x3d'),this[a20_0x1650('0x3e')]['bind'](this));process['on'](a20_0x1650('0x3f'),this[a20_0x1650('0x3e')]['bind'](this));process['on'](a20_0x1650('0x40'),this[a20_0x1650('0x3e')][a20_0x1650('0x3b')](this));}[a20_0x1650('0x3a')](){console[a20_0x1650('0x10')](a20_0x1650('0x41')+this[a20_0x1650('0x34')]);this[a20_0x1650('0x38')][a20_0x1650('0x22')](a20_0x1650('0x42'));this[a20_0x1650('0x38')][a20_0x1650('0x22')]('player/close');this['mqttClient'][a20_0x1650('0x22')]('player/reboot',{'qos':0x2});this[a20_0x1650('0x38')]['subscribe'](a20_0x1650('0x43'),{'qos':0x2});this['mqttClient'][a20_0x1650('0x22')](a20_0x1650('0x44'),{'qos':0x2});this[a20_0x1650('0x38')][a20_0x1650('0x22')](a20_0x1650('0x45'),{'qos':0x2});this['mqttClient'][a20_0x1650('0x22')](a20_0x1650('0x46'),{'qos':0x2});this[a20_0x1650('0x38')][a20_0x1650('0x22')](a20_0x1650('0x47'),{'qos':0x2});this[a20_0x1650('0x38')]['subscribe'](a20_0x1650('0x48'),{'qos':0x2});this[a20_0x1650('0x38')]['subscribe'](a20_0x1650('0x49'),{'qos':0x2});this[a20_0x1650('0x38')][a20_0x1650('0x22')](a20_0x1650('0x4a'),{'qos':0x2});}[a20_0x1650('0x4b')](){}[a20_0x1650('0x3c')](_0x3b1517,_0x25facb){console[a20_0x1650('0x10')](a20_0x1650('0x4c'),_0x3b1517,_0x25facb);switch(_0x3b1517){case a20_0x1650('0x42'):return this['handleOpenRequest'](_0x25facb);case a20_0x1650('0x4d'):return this['handleCloseRequest'](_0x25facb);case a20_0x1650('0x4e'):return this['handleRebootRequest'](_0x25facb);case a20_0x1650('0x44'):return this[a20_0x1650('0x4f')](_0x25facb);case a20_0x1650('0x43'):return this['handleLoadPlaylistRequest'](_0x25facb);case a20_0x1650('0x45'):return this[a20_0x1650('0x50')](_0x25facb);case'player/ifconfig':return this[a20_0x1650('0x51')](_0x25facb);case'player/register':return this['handleRegisterRequest'](_0x25facb);case'player/update_settings':return this[a20_0x1650('0x52')](_0x25facb);case'player/turn_off_tv':return this[a20_0x1650('0x53')](_0x25facb);case a20_0x1650('0x4a'):return this[a20_0x1650('0x54')](_0x25facb);}}[a20_0x1650('0x55')](_0x3373fa){if(_0x3373fa==a20_0x1650('0x56')||_0x3373fa==String(this[a20_0x1650('0xb')][a20_0x1650('0x57')])){this[a20_0x1650('0xb')][a20_0x1650('0x58')]();}}[a20_0x1650('0x51')](_0xc393e7){if(_0xc393e7==a20_0x1650('0x56')||_0xc393e7==String(this['syncPlaylistsService'][a20_0x1650('0x57')])){}}[a20_0x1650('0x50')](_0x2fccb2){console['log'](a20_0x1650('0x59')+_0x2fccb2);if(_0x2fccb2=='all'||_0x2fccb2==String(this[a20_0x1650('0xb')]['playerId'])){const _0x3a0bf1=__dirname;const _0xcd34a8=require(a20_0x1650('0x5a'))(_0x3a0bf1);console[a20_0x1650('0x10')](a20_0x1650('0x5b'));_0xcd34a8['pull']((_0x548435,_0x2bdb5d)=>{if(_0x548435){console[a20_0x1650('0x10')](a20_0x1650('0x5c'));this['handleUpdateRequest'](_0x2fccb2);return;}else{}console[a20_0x1650('0x10')](a20_0x1650('0x5d'));console[a20_0x1650('0x10')](_0x2bdb5d);if(_0x2bdb5d&&_0x2bdb5d[a20_0x1650('0x5e')][a20_0x1650('0x5f')]){this[a20_0x1650('0xb')][a20_0x1650('0x60')]();}else{}});}}[a20_0x1650('0x61')](_0x3ed3e9){if(_0x3ed3e9==a20_0x1650('0x56')||_0x3ed3e9==String(this['syncPlaylistsService'][a20_0x1650('0x57')])){this[a20_0x1650('0xb')][a20_0x1650('0x62')]();}}[a20_0x1650('0x4f')](_0x1538f0){if(String(_0x1538f0)=='all'||String(_0x1538f0)==String(this[a20_0x1650('0xb')][a20_0x1650('0x57')])){this[a20_0x1650('0xb')][a20_0x1650('0x63')]();}}[a20_0x1650('0x64')](_0x2110fd){if(_0x2110fd==a20_0x1650('0x56')||_0x2110fd==String(this[a20_0x1650('0xb')][a20_0x1650('0x57')])){console['log'](a20_0x1650('0x65'));try{this[a20_0x1650('0xb')]['reboot']();}catch(_0x4f5cee){console['log'](_0x4f5cee);}}}[a20_0x1650('0x52')](_0x45f69b){if(_0x45f69b==a20_0x1650('0x56')||_0x45f69b==String(this['syncPlaylistsService'][a20_0x1650('0x57')])){console[a20_0x1650('0x10')](a20_0x1650('0x66'));try{this[a20_0x1650('0xb')]['updateSettings']();}catch(_0x4dd475){console[a20_0x1650('0x10')](_0x4dd475);}}}[a20_0x1650('0x54')](_0x4e994d){if(_0x4e994d==a20_0x1650('0x56')||_0x4e994d==String(this[a20_0x1650('0xb')][a20_0x1650('0x57')])){console[a20_0x1650('0x10')](a20_0x1650('0x67'));try{this[a20_0x1650('0xb')][a20_0x1650('0x68')]();}catch(_0xa7a0a4){console['log'](_0xa7a0a4);}}}[a20_0x1650('0x53')](_0x349497){if(_0x349497==a20_0x1650('0x56')||_0x349497==String(this[a20_0x1650('0xb')][a20_0x1650('0x57')])){console['log'](a20_0x1650('0x69'));try{this[a20_0x1650('0xb')]['turnOffTV']();}catch(_0x1f33ce){console[a20_0x1650('0x10')](_0x1f33ce);}}}['sendStateUpdate'](){console['log'](a20_0x1650('0x6a'),this[a20_0x1650('0x6b')]);this['mqttClient'][a20_0x1650('0x6c')](a20_0x1650('0x6d'),this['syncPlaylistsService'][a20_0x1650('0x57')]+'-'+this['state']);}[a20_0x1650('0x6e')](_0x5d02d3){if(this[a20_0x1650('0x6b')]!=='open'&&this['state']!==a20_0x1650('0x6f')){console[a20_0x1650('0x10')](a20_0x1650('0x70'));this['state']=a20_0x1650('0x6f');this[a20_0x1650('0x71')]();setTimeout(()=>{this[a20_0x1650('0x6b')]=a20_0x1650('0x72');this['sendStateUpdate']();},0x1388);}}[a20_0x1650('0x73')](_0x1b6227){if(this[a20_0x1650('0x6b')]!==a20_0x1650('0xc')&&this[a20_0x1650('0x6b')]!=='closing'){this[a20_0x1650('0x6b')]=a20_0x1650('0x74');this[a20_0x1650('0x71')]();setTimeout(()=>{this[a20_0x1650('0x6b')]=a20_0x1650('0xc');this[a20_0x1650('0x71')]();},0x1388);}}[a20_0x1650('0x3e')](_0x51d01e,_0x5be145){if(_0x5be145){console['log'](_0x5be145['stack']);}this[a20_0x1650('0x38')][a20_0x1650('0x6c')]('player/connected',a20_0x1650('0x75'));}[a20_0x1650('0x1c')](_0x4fddc2,_0x5a1a66,_0x51684e){const _0x30bc7d={'iat':Math[a20_0x1650('0x1f')](Date['now']()/0x3e8),'exp':Math[a20_0x1650('0x1f')](Date[a20_0x1650('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x4fddc2};const _0x2d461c=fs[a20_0x1650('0x76')](_0x5a1a66);return jwt[a20_0x1650('0x77')](_0x30bc7d,_0x2d461c,{'algorithm':_0x51684e});}}exports['MqttService']=MqttService;