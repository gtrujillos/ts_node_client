var a20_0x101f=['handleTurnOnTVRequest','all','registerClient','playerId','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','state','opening\x20player\x20door','opening','open','closing','stack','player/connected','false','createJwt','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','closed','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','events','projects/','/devices/','mqtts','TLSv1_2_method','round','subscribe','/config','/state','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','run.lulo_2018#.','mqtt://lulo.run','mqttClient_connect','bind','mqttClient','message','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','player/load_playlist','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest'];(function(_0xba74d9,_0x443553){var _0xaed992=function(_0xf098bf){while(--_0xf098bf){_0xba74d9['push'](_0xba74d9['shift']());}};_0xaed992(++_0x443553);}(a20_0x101f,0x9c));var a20_0x27ef=function(_0x3d5027,_0x27291d){_0x3d5027=_0x3d5027-0x0;var _0x440410=a20_0x101f[_0x3d5027];return _0x440410;};'use strict';Object[a20_0x27ef('0x0')](exports,a20_0x27ef('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x27ef('0x2'));const fs=require('fs');const fsExtra=require(a20_0x27ef('0x3'));const request=require(a20_0x27ef('0x4'));const progress=require(a20_0x27ef('0x5'));const spawn=require(a20_0x27ef('0x6'))[a20_0x27ef('0x7')];const exec=require('child_process')[a20_0x27ef('0x8')];const isImage=require(a20_0x27ef('0x9'));const format=require(a20_0x27ef('0xa'));const os=require('os');const mqtt=require(a20_0x27ef('0xb'));const uuidv4=require(a20_0x27ef('0xc'));const jwt=require(a20_0x27ef('0xd'));class MqttService{constructor(_0x266bf1){this[a20_0x27ef('0xe')]=_0x266bf1;this['state']=a20_0x27ef('0xf');this['httpClientService']=new HttpClientService_1['HttpClientService']();}['init'](){this[a20_0x27ef('0x10')]();}['mqttInit_google'](){console[a20_0x27ef('0x11')](a20_0x27ef('0x12'));const _0x3c59a1=a20_0x27ef('0x13');const _0x728d1b=a20_0x27ef('0x14');const _0x411448=a20_0x27ef('0x15');const _0x3b7c57=a20_0x27ef('0x16');const _0x34a574=a20_0x27ef('0x17');const _0x3afc63='resources/keys/rsa_private.pem';const _0x5846e2='mqtt.googleapis.com';const _0x4d13c3=0x1bb;const _0x3ccf5f=a20_0x27ef('0x18');const _0x4543c=0x5;const _0x20ed6c=a20_0x27ef('0x19')+_0x3c59a1+'/locations/'+_0x3b7c57+'/registries/'+_0x411448+a20_0x27ef('0x1a')+_0x728d1b;const _0x12e90c={'host':_0x5846e2,'port':_0x4d13c3,'clientId':_0x20ed6c,'username':'unused','password':this['createJwt'](_0x3c59a1,_0x3afc63,_0x34a574),'protocol':a20_0x27ef('0x1b'),'secureProtocol':a20_0x27ef('0x1c')};const _0x47720f=Math[a20_0x27ef('0x1d')](Date['now']()/0x3e8);const _0x53809e=mqtt['connect'](_0x12e90c);_0x53809e[a20_0x27ef('0x1e')](a20_0x27ef('0x1a')+_0x728d1b+a20_0x27ef('0x1f'),{'qos':0x1});_0x53809e[a20_0x27ef('0x1e')](a20_0x27ef('0x1a')+_0x728d1b+a20_0x27ef('0x20'),{'qos':0x1});_0x53809e[a20_0x27ef('0x1e')](a20_0x27ef('0x1a')+_0x728d1b+a20_0x27ef('0x21'),{'qos':0x0});const _0x577256=a20_0x27ef('0x1a')+_0x728d1b+'/'+_0x3ccf5f;_0x53809e['on'](a20_0x27ef('0x22'),_0x429596=>{console[a20_0x27ef('0x11')](a20_0x27ef('0x22'));if(!_0x429596){console[a20_0x27ef('0x11')](a20_0x27ef('0x23'));}else{const _0x577256=a20_0x27ef('0x24');const _0xae6cff=_0x411448+'/'+_0x728d1b+a20_0x27ef('0x25');_0x53809e[a20_0x27ef('0x26')](_0x577256,_0xae6cff,{'qos':0x1},_0x3849f8=>{console[a20_0x27ef('0x11')](a20_0x27ef('0x27'));console[a20_0x27ef('0x11')](_0x3849f8);if(!_0x3849f8){}});}});_0x53809e['on'](a20_0x27ef('0x28'),()=>{console[a20_0x27ef('0x11')](a20_0x27ef('0x28'));});_0x53809e['on'](a20_0x27ef('0x29'),_0x554283=>{console['log'](a20_0x27ef('0x29'),_0x554283);});_0x53809e['on']('message',(_0x5ee63e,_0x2ec57f)=>{let _0x134621=a20_0x27ef('0x2a');console[a20_0x27ef('0x11')](_0x5ee63e);console['log'](_0x2ec57f+'');if(_0x5ee63e===a20_0x27ef('0x1a')+_0x728d1b+'/config'){_0x134621=a20_0x27ef('0x2b');}else if(_0x5ee63e['startsWith'](a20_0x27ef('0x1a')+_0x728d1b+'/commands')){_0x134621=a20_0x27ef('0x2c');}_0x134621+=Buffer[a20_0x27ef('0x2d')](_0x2ec57f,a20_0x27ef('0x2e'))[a20_0x27ef('0x2f')](a20_0x27ef('0x30'));console[a20_0x27ef('0x11')](_0x134621);});_0x53809e['on'](a20_0x27ef('0x31'),()=>{});console[a20_0x27ef('0x11')](_0x12e90c);}['mqttInit_mosquitto'](){console[a20_0x27ef('0x11')]('mqttInit');this[a20_0x27ef('0x32')]=uuidv4();console[a20_0x27ef('0x11')](a20_0x27ef('0x33'));console['log'](this[a20_0x27ef('0x32')]);const _0x4f3a46={'clientId':this[a20_0x27ef('0x32')],'username':'lulo_mqtt','password':a20_0x27ef('0x34'),'clean':!![]};this['mqttClient']=mqtt[a20_0x27ef('0x22')](a20_0x27ef('0x35'),_0x4f3a46);this['mqttClient']['on'](a20_0x27ef('0x22'),this[a20_0x27ef('0x36')][a20_0x27ef('0x37')](this));this[a20_0x27ef('0x38')]['on'](a20_0x27ef('0x39'),this[a20_0x27ef('0x3a')]['bind'](this));this[a20_0x27ef('0x38')]['on']('close',()=>{console[a20_0x27ef('0x11')](a20_0x27ef('0x28'));});process['on'](a20_0x27ef('0x3b'),this[a20_0x27ef('0x3c')][a20_0x27ef('0x37')](this));process['on']('SIGINT',this[a20_0x27ef('0x3c')][a20_0x27ef('0x37')](this));process['on'](a20_0x27ef('0x3d'),this[a20_0x27ef('0x3c')][a20_0x27ef('0x37')](this));}[a20_0x27ef('0x36')](){console[a20_0x27ef('0x11')](a20_0x27ef('0x3e')+this[a20_0x27ef('0x32')]);this[a20_0x27ef('0x38')]['subscribe'](a20_0x27ef('0x3f'));this[a20_0x27ef('0x38')]['subscribe'](a20_0x27ef('0x40'));this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')]('player/reboot',{'qos':0x2});this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')]('player/load_playlist',{'qos':0x2});this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')](a20_0x27ef('0x41'),{'qos':0x2});this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')](a20_0x27ef('0x42'),{'qos':0x2});this[a20_0x27ef('0x38')]['subscribe'](a20_0x27ef('0x43'),{'qos':0x2});this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')](a20_0x27ef('0x44'),{'qos':0x2});this[a20_0x27ef('0x38')][a20_0x27ef('0x1e')](a20_0x27ef('0x45'),{'qos':0x2});this[a20_0x27ef('0x38')]['subscribe'](a20_0x27ef('0x46'),{'qos':0x2});this['mqttClient'][a20_0x27ef('0x1e')](a20_0x27ef('0x47'),{'qos':0x2});}[a20_0x27ef('0x48')](){}[a20_0x27ef('0x3a')](_0x53cde2,_0x13f0d8){console[a20_0x27ef('0x11')](a20_0x27ef('0x49'),_0x53cde2,_0x13f0d8);switch(_0x53cde2){case'player/open':return this[a20_0x27ef('0x4a')](_0x13f0d8);case a20_0x27ef('0x40'):return this[a20_0x27ef('0x4b')](_0x13f0d8);case'player/reboot':return this[a20_0x27ef('0x4c')](_0x13f0d8);case a20_0x27ef('0x41'):return this[a20_0x27ef('0x4d')](_0x13f0d8);case a20_0x27ef('0x4e'):return this['handleLoadPlaylistRequest'](_0x13f0d8);case a20_0x27ef('0x42'):return this[a20_0x27ef('0x4f')](_0x13f0d8);case'player/ifconfig':return this[a20_0x27ef('0x50')](_0x13f0d8);case a20_0x27ef('0x44'):return this[a20_0x27ef('0x51')](_0x13f0d8);case'player/update_settings':return this[a20_0x27ef('0x52')](_0x13f0d8);case a20_0x27ef('0x46'):return this[a20_0x27ef('0x53')](_0x13f0d8);case a20_0x27ef('0x47'):return this[a20_0x27ef('0x54')](_0x13f0d8);}}['handleRegisterRequest'](_0xb1404f){if(_0xb1404f==a20_0x27ef('0x55')||_0xb1404f==String(this[a20_0x27ef('0xe')]['playerId'])){this[a20_0x27ef('0xe')][a20_0x27ef('0x56')]();}}[a20_0x27ef('0x50')](_0x179861){if(_0x179861=='all'||_0x179861==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){}}[a20_0x27ef('0x4f')](_0x42af13){console['log'](a20_0x27ef('0x58')+_0x42af13);if(_0x42af13==a20_0x27ef('0x55')||_0x42af13==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){const _0x42d3c8=__dirname;const _0x813e6d=require('simple-git')(_0x42d3c8);console[a20_0x27ef('0x11')](a20_0x27ef('0x59'));_0x813e6d[a20_0x27ef('0x5a')]((_0x4b6499,_0x2c96a2)=>{if(_0x4b6499){console[a20_0x27ef('0x11')](a20_0x27ef('0x5b'));this[a20_0x27ef('0x4f')](_0x42af13);return;}else{}console[a20_0x27ef('0x11')](a20_0x27ef('0x5c'));console[a20_0x27ef('0x11')](_0x2c96a2);if(_0x2c96a2&&_0x2c96a2[a20_0x27ef('0x5d')][a20_0x27ef('0x5e')]){this[a20_0x27ef('0xe')][a20_0x27ef('0x5f')]();}else{}});}}[a20_0x27ef('0x60')](_0x375867){if(_0x375867==a20_0x27ef('0x55')||_0x375867==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){this[a20_0x27ef('0xe')][a20_0x27ef('0x61')]();}}[a20_0x27ef('0x4d')](_0x1961bf){if(String(_0x1961bf)=='all'||String(_0x1961bf)==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){this[a20_0x27ef('0xe')]['reloadMediaList']();}}[a20_0x27ef('0x4c')](_0x1f3f8d){if(_0x1f3f8d==a20_0x27ef('0x55')||_0x1f3f8d==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){console[a20_0x27ef('0x11')](a20_0x27ef('0x62'));try{this[a20_0x27ef('0xe')][a20_0x27ef('0x5f')]();}catch(_0x1759ff){console[a20_0x27ef('0x11')](_0x1759ff);}}}[a20_0x27ef('0x52')](_0x4df92c){if(_0x4df92c==a20_0x27ef('0x55')||_0x4df92c==String(this['syncPlaylistsService'][a20_0x27ef('0x57')])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a20_0x27ef('0xe')][a20_0x27ef('0x63')]();}catch(_0x46e78a){console[a20_0x27ef('0x11')](_0x46e78a);}}}[a20_0x27ef('0x54')](_0x253028){if(_0x253028==a20_0x27ef('0x55')||_0x253028==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){console[a20_0x27ef('0x11')](a20_0x27ef('0x64'));try{this[a20_0x27ef('0xe')][a20_0x27ef('0x65')]();}catch(_0x5a0f99){console[a20_0x27ef('0x11')](_0x5a0f99);}}}[a20_0x27ef('0x53')](_0x19c3fc){if(_0x19c3fc=='all'||_0x19c3fc==String(this[a20_0x27ef('0xe')][a20_0x27ef('0x57')])){console[a20_0x27ef('0x11')](a20_0x27ef('0x66'));try{this[a20_0x27ef('0xe')][a20_0x27ef('0x67')]();}catch(_0x5a2329){console['log'](_0x5a2329);}}}[a20_0x27ef('0x68')](){console[a20_0x27ef('0x11')](a20_0x27ef('0x69'),this['state']);this['mqttClient'][a20_0x27ef('0x26')](a20_0x27ef('0x6a'),this[a20_0x27ef('0xe')][a20_0x27ef('0x57')]+'-'+this[a20_0x27ef('0x6b')]);}[a20_0x27ef('0x4a')](_0x598447){if(this['state']!=='open'&&this[a20_0x27ef('0x6b')]!=='opening'){console[a20_0x27ef('0x11')](a20_0x27ef('0x6c'));this[a20_0x27ef('0x6b')]=a20_0x27ef('0x6d');this[a20_0x27ef('0x68')]();setTimeout(()=>{this[a20_0x27ef('0x6b')]=a20_0x27ef('0x6e');this[a20_0x27ef('0x68')]();},0x1388);}}[a20_0x27ef('0x4b')](_0x536adc){if(this[a20_0x27ef('0x6b')]!==a20_0x27ef('0xf')&&this[a20_0x27ef('0x6b')]!==a20_0x27ef('0x6f')){this[a20_0x27ef('0x6b')]=a20_0x27ef('0x6f');this[a20_0x27ef('0x68')]();setTimeout(()=>{this[a20_0x27ef('0x6b')]=a20_0x27ef('0xf');this['sendStateUpdate']();},0x1388);}}[a20_0x27ef('0x3c')](_0x317e55,_0x25708a){if(_0x25708a){console[a20_0x27ef('0x11')](_0x25708a[a20_0x27ef('0x70')]);}this[a20_0x27ef('0x38')]['publish'](a20_0x27ef('0x71'),a20_0x27ef('0x72'));}[a20_0x27ef('0x73')](_0x4e1922,_0x506f8f,_0x16befb){const _0x4dad8c={'iat':Math['round'](Date[a20_0x27ef('0x74')]()/0x3e8),'exp':Math[a20_0x27ef('0x1d')](Date[a20_0x27ef('0x74')]()/0x3e8)+0x14*0x3c,'aud':_0x4e1922};const _0x289154=fs[a20_0x27ef('0x75')](_0x506f8f);return jwt[a20_0x27ef('0x76')](_0x4dad8c,_0x289154,{'algorithm':_0x16befb});}}exports[a20_0x27ef('0x77')]=MqttService;