var a18_0x15fe=['request','request-progress','child_process','spawn','is-image','string-template','mqtt','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','now','connect','subscribe','/devices/','/config','/state','/commands/#','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','from','base64','toString','ascii','this.clientId','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','handleLoadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','sendStateUpdate','sending\x20state\x20%s','player/state','opening\x20player\x20door','opening','open','handleCloseRequest','closing','stack','round','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra'];(function(_0x31fa8d,_0xdaa038){var _0x15a675=function(_0x1b25b3){while(--_0x1b25b3){_0x31fa8d['push'](_0x31fa8d['shift']());}};_0x15a675(++_0xdaa038);}(a18_0x15fe,0xd4));var a18_0x2657=function(_0x1690c4,_0x409c2d){_0x1690c4=_0x1690c4-0x0;var _0xa9be0c=a18_0x15fe[_0x1690c4];return _0xa9be0c;};'use strict';Object[a18_0x2657('0x0')](exports,a18_0x2657('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2657('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2657('0x3'));const request=require(a18_0x2657('0x4'));const progress=require(a18_0x2657('0x5'));const spawn=require(a18_0x2657('0x6'))[a18_0x2657('0x7')];const exec=require('child_process')['exec'];const isImage=require(a18_0x2657('0x8'));const format=require(a18_0x2657('0x9'));const os=require('os');const mqtt=require(a18_0x2657('0xa'));const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x5ed3ba){this[a18_0x2657('0xb')]=_0x5ed3ba;this[a18_0x2657('0xc')]=a18_0x2657('0xd');this[a18_0x2657('0xe')]=new HttpClientService_1[(a18_0x2657('0xf'))]();}[a18_0x2657('0x10')](){this[a18_0x2657('0x11')]();}['mqttInit_google'](){console[a18_0x2657('0x12')](a18_0x2657('0x13'));const _0x461551=a18_0x2657('0x14');const _0x2be3ef='my-node-device';const _0x2dfd32=a18_0x2657('0x15');const _0x2df06d=a18_0x2657('0x16');const _0x176630=a18_0x2657('0x17');const _0x3fd94e=a18_0x2657('0x18');const _0x245d99=a18_0x2657('0x19');const _0x2f7c3e=0x1bb;const _0x5d8541=a18_0x2657('0x1a');const _0x44654f=0x5;const _0x243e62=a18_0x2657('0x1b')+_0x461551+a18_0x2657('0x1c')+_0x2df06d+a18_0x2657('0x1d')+_0x2dfd32+'/devices/'+_0x2be3ef;const _0x3566b3={'host':_0x245d99,'port':_0x2f7c3e,'clientId':_0x243e62,'username':a18_0x2657('0x1e'),'password':this[a18_0x2657('0x1f')](_0x461551,_0x3fd94e,_0x176630),'protocol':a18_0x2657('0x20'),'secureProtocol':a18_0x2657('0x21')};const _0x313e46=Math['round'](Date[a18_0x2657('0x22')]()/0x3e8);const _0x3d9b19=mqtt[a18_0x2657('0x23')](_0x3566b3);_0x3d9b19[a18_0x2657('0x24')](a18_0x2657('0x25')+_0x2be3ef+a18_0x2657('0x26'),{'qos':0x1});_0x3d9b19[a18_0x2657('0x24')]('/devices/'+_0x2be3ef+a18_0x2657('0x27'),{'qos':0x1});_0x3d9b19[a18_0x2657('0x24')](a18_0x2657('0x25')+_0x2be3ef+a18_0x2657('0x28'),{'qos':0x0});const _0x4bc492=a18_0x2657('0x25')+_0x2be3ef+'/'+_0x5d8541;_0x3d9b19['on'](a18_0x2657('0x23'),_0x57b6bb=>{console['log'](a18_0x2657('0x23'));if(!_0x57b6bb){console[a18_0x2657('0x12')](a18_0x2657('0x29'));}else{const _0x4bc492='/projects/velvety-glazing-252020/topics/my-topic';const _0x5b6933=_0x2dfd32+'/'+_0x2be3ef+a18_0x2657('0x2a');_0x3d9b19[a18_0x2657('0x2b')](_0x4bc492,_0x5b6933,{'qos':0x1},_0xeef9b9=>{console[a18_0x2657('0x12')](a18_0x2657('0x2c'));console[a18_0x2657('0x12')](_0xeef9b9);if(!_0xeef9b9){}});}});_0x3d9b19['on'](a18_0x2657('0x2d'),()=>{console['log'](a18_0x2657('0x2d'));});_0x3d9b19['on']('error',_0x1a34b7=>{console[a18_0x2657('0x12')](a18_0x2657('0x2e'),_0x1a34b7);});_0x3d9b19['on'](a18_0x2657('0x2f'),(_0x59e9fc,_0x3df0d6)=>{let _0x41e4c1=a18_0x2657('0x30');console[a18_0x2657('0x12')](_0x59e9fc);console[a18_0x2657('0x12')](_0x3df0d6+'');if(_0x59e9fc==='/devices/'+_0x2be3ef+a18_0x2657('0x26')){_0x41e4c1=a18_0x2657('0x31');}else if(_0x59e9fc['startsWith'](a18_0x2657('0x25')+_0x2be3ef+'/commands')){_0x41e4c1='Command\x20message\x20received:\x20';}_0x41e4c1+=Buffer[a18_0x2657('0x32')](_0x3df0d6,a18_0x2657('0x33'))[a18_0x2657('0x34')](a18_0x2657('0x35'));console[a18_0x2657('0x12')](_0x41e4c1);});_0x3d9b19['on']('packetsend',()=>{});console['log'](_0x3566b3);}[a18_0x2657('0x11')](){console[a18_0x2657('0x12')](a18_0x2657('0x13'));this['clientId']=uuidv4();console['log'](a18_0x2657('0x36'));console['log'](this[a18_0x2657('0x37')]);const _0x33b69c={'clientId':this[a18_0x2657('0x37')],'username':'lulo_mqtt','password':a18_0x2657('0x38'),'clean':!![]};this[a18_0x2657('0x39')]=mqtt[a18_0x2657('0x23')](a18_0x2657('0x3a'),_0x33b69c);this[a18_0x2657('0x39')]['on'](a18_0x2657('0x23'),this[a18_0x2657('0x3b')][a18_0x2657('0x3c')](this));this['mqttClient']['on'](a18_0x2657('0x2f'),this[a18_0x2657('0x3d')][a18_0x2657('0x3c')](this));this['mqttClient']['on'](a18_0x2657('0x2d'),()=>{console['log']('close');});process['on'](a18_0x2657('0x3e'),this[a18_0x2657('0x3f')][a18_0x2657('0x3c')](this));process['on'](a18_0x2657('0x40'),this['handleAppExit']['bind'](this));process['on']('uncaughtException',this[a18_0x2657('0x3f')][a18_0x2657('0x3c')](this));}[a18_0x2657('0x3b')](){console[a18_0x2657('0x12')](a18_0x2657('0x41')+this[a18_0x2657('0x37')]);this['mqttClient'][a18_0x2657('0x24')](a18_0x2657('0x42'));this[a18_0x2657('0x39')][a18_0x2657('0x24')](a18_0x2657('0x43'));this[a18_0x2657('0x39')][a18_0x2657('0x24')]('player/reboot',{'qos':0x2});this[a18_0x2657('0x39')][a18_0x2657('0x24')](a18_0x2657('0x44'),{'qos':0x2});this['mqttClient'][a18_0x2657('0x24')](a18_0x2657('0x45'),{'qos':0x2});this[a18_0x2657('0x39')][a18_0x2657('0x24')](a18_0x2657('0x46'),{'qos':0x2});this['mqttClient'][a18_0x2657('0x24')]('player/ifconfig',{'qos':0x2});this[a18_0x2657('0x39')][a18_0x2657('0x24')](a18_0x2657('0x47'),{'qos':0x2});}[a18_0x2657('0x48')](){}['mqttClient_message'](_0x226016,_0x320839){console[a18_0x2657('0x12')](a18_0x2657('0x49'),_0x226016,_0x320839);switch(_0x226016){case a18_0x2657('0x42'):return this[a18_0x2657('0x4a')](_0x320839);case a18_0x2657('0x43'):return this['handleCloseRequest'](_0x320839);case a18_0x2657('0x4b'):return this[a18_0x2657('0x4c')](_0x320839);case a18_0x2657('0x45'):return this[a18_0x2657('0x4d')](_0x320839);case a18_0x2657('0x44'):return this['handleLoadPlaylistRequest'](_0x320839);case a18_0x2657('0x46'):return this[a18_0x2657('0x4e')](_0x320839);case a18_0x2657('0x4f'):return this[a18_0x2657('0x50')](_0x320839);case'player/register':return this[a18_0x2657('0x51')](_0x320839);}}['handleRegisterRequest'](_0x310316){if(_0x310316==a18_0x2657('0x52')||_0x310316==String(this['syncPlaylistsService'][a18_0x2657('0x53')])){this[a18_0x2657('0xb')][a18_0x2657('0x54')]();}}['handleIfconfigRequest'](_0x1cd5b4){if(_0x1cd5b4==a18_0x2657('0x52')||_0x1cd5b4==String(this[a18_0x2657('0xb')][a18_0x2657('0x53')])){}}[a18_0x2657('0x4e')](_0x532025){console['log'](a18_0x2657('0x55')+_0x532025);if(_0x532025==a18_0x2657('0x52')||_0x532025==String(this['syncPlaylistsService'][a18_0x2657('0x53')])){const _0x20116c=__dirname;const _0x5e6349=require(a18_0x2657('0x56'))(_0x20116c);console[a18_0x2657('0x12')](a18_0x2657('0x57'));_0x5e6349[a18_0x2657('0x58')]((_0x5f53ba,_0x3f4c75)=>{if(_0x5f53ba){console[a18_0x2657('0x12')](a18_0x2657('0x59'));this[a18_0x2657('0x4e')](_0x532025);return;}else{}console['log'](a18_0x2657('0x5a'));console[a18_0x2657('0x12')](_0x3f4c75);if(_0x3f4c75&&_0x3f4c75[a18_0x2657('0x5b')][a18_0x2657('0x5c')]){this[a18_0x2657('0xb')]['reboot']();}else{}});}}[a18_0x2657('0x5d')](_0x5912c3){if(_0x5912c3==a18_0x2657('0x52')||_0x5912c3==String(this[a18_0x2657('0xb')][a18_0x2657('0x53')])){this['syncPlaylistsService']['loadMediaList']();}}[a18_0x2657('0x4d')](_0x584a9f){if(String(_0x584a9f)==a18_0x2657('0x52')||String(_0x584a9f)==String(this['syncPlaylistsService']['playerId'])){this[a18_0x2657('0xb')][a18_0x2657('0x5e')]();}}[a18_0x2657('0x4c')](_0x4208d2){if(_0x4208d2=='all'||_0x4208d2==String(this[a18_0x2657('0xb')][a18_0x2657('0x53')])){console[a18_0x2657('0x12')](a18_0x2657('0x5f'));try{this[a18_0x2657('0xb')][a18_0x2657('0x60')]();}catch(_0x195130){console[a18_0x2657('0x12')](_0x195130);}}}[a18_0x2657('0x61')](){console[a18_0x2657('0x12')](a18_0x2657('0x62'),this[a18_0x2657('0xc')]);this['mqttClient']['publish'](a18_0x2657('0x63'),this[a18_0x2657('0xb')][a18_0x2657('0x53')]+'-'+this[a18_0x2657('0xc')]);}[a18_0x2657('0x4a')](_0x725fce){if(this[a18_0x2657('0xc')]!=='open'&&this[a18_0x2657('0xc')]!=='opening'){console[a18_0x2657('0x12')](a18_0x2657('0x64'));this[a18_0x2657('0xc')]=a18_0x2657('0x65');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x2657('0xc')]=a18_0x2657('0x66');this[a18_0x2657('0x61')]();},0x1388);}}[a18_0x2657('0x67')](_0x5e6bf3){if(this[a18_0x2657('0xc')]!==a18_0x2657('0xd')&&this['state']!==a18_0x2657('0x68')){this[a18_0x2657('0xc')]='closing';this[a18_0x2657('0x61')]();setTimeout(()=>{this[a18_0x2657('0xc')]='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x486fb7,_0x5dd970){if(_0x5dd970){console[a18_0x2657('0x12')](_0x5dd970[a18_0x2657('0x69')]);}this[a18_0x2657('0x39')][a18_0x2657('0x2b')]('player/connected','false');}[a18_0x2657('0x1f')](_0x261a35,_0x54b5ed,_0xb05203){const _0x11c0db={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a18_0x2657('0x6a')](Date[a18_0x2657('0x22')]()/0x3e8)+0x14*0x3c,'aud':_0x261a35};const _0x3849e6=fs['readFileSync'](_0x54b5ed);return jwt[a18_0x2657('0x6b')](_0x11c0db,_0x3849e6,{'algorithm':_0xb05203});}}exports['MqttService']=MqttService;