var a20_0x2b18=['handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','turnOnTV','sending\x20state\x20%s','player/state','open','opening\x20player\x20door','opening','sendStateUpdate','closing','player/connected','false','now','readFileSync','sign','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','exec','is-image','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','round','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','ascii','packetsend','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/reload_playlist','player/update','player/register','player/turn_off_tv','player/turn_on_tv','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest'];(function(_0x4074fb,_0x471c26){var _0x3fad8e=function(_0x49fc81){while(--_0x49fc81){_0x4074fb['push'](_0x4074fb['shift']());}};_0x3fad8e(++_0x471c26);}(a20_0x2b18,0x1eb));var a20_0x3eb8=function(_0x27201d,_0x5b0344){_0x27201d=_0x27201d-0x0;var _0x3b14fa=a20_0x2b18[_0x27201d];return _0x3b14fa;};'use strict';Object['defineProperty'](exports,a20_0x3eb8('0x0'),{'value':!![]});const HttpClientService_1=require(a20_0x3eb8('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0x3eb8('0x2'));const progress=require(a20_0x3eb8('0x3'));const spawn=require(a20_0x3eb8('0x4'))['spawn'];const exec=require(a20_0x3eb8('0x4'))[a20_0x3eb8('0x5')];const isImage=require(a20_0x3eb8('0x6'));const format=require('string-template');const os=require('os');const mqtt=require(a20_0x3eb8('0x7'));const uuidv4=require(a20_0x3eb8('0x8'));const jwt=require(a20_0x3eb8('0x9'));class MqttService{constructor(_0x26a595){this[a20_0x3eb8('0xa')]=_0x26a595;this[a20_0x3eb8('0xb')]=a20_0x3eb8('0xc');this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a20_0x3eb8('0xd')](){this[a20_0x3eb8('0xe')]();}[a20_0x3eb8('0xf')](){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x11'));const _0x17ad58=a20_0x3eb8('0x12');const _0x77128=a20_0x3eb8('0x13');const _0x182c47=a20_0x3eb8('0x14');const _0x401c13=a20_0x3eb8('0x15');const _0x1c0301=a20_0x3eb8('0x16');const _0x30494b='resources/keys/rsa_private.pem';const _0x13909c=a20_0x3eb8('0x17');const _0x4447ed=0x1bb;const _0x282ce8=a20_0x3eb8('0x18');const _0x3d4d40=0x5;const _0x42b00e=a20_0x3eb8('0x19')+_0x17ad58+a20_0x3eb8('0x1a')+_0x401c13+a20_0x3eb8('0x1b')+_0x182c47+a20_0x3eb8('0x1c')+_0x77128;const _0x477e0c={'host':_0x13909c,'port':_0x4447ed,'clientId':_0x42b00e,'username':a20_0x3eb8('0x1d'),'password':this[a20_0x3eb8('0x1e')](_0x17ad58,_0x30494b,_0x1c0301),'protocol':'mqtts','secureProtocol':a20_0x3eb8('0x1f')};const _0x430ef3=Math[a20_0x3eb8('0x20')](Date['now']()/0x3e8);const _0x5d3243=mqtt[a20_0x3eb8('0x21')](_0x477e0c);_0x5d3243[a20_0x3eb8('0x22')](a20_0x3eb8('0x1c')+_0x77128+a20_0x3eb8('0x23'),{'qos':0x1});_0x5d3243[a20_0x3eb8('0x22')]('/devices/'+_0x77128+a20_0x3eb8('0x24'),{'qos':0x1});_0x5d3243[a20_0x3eb8('0x22')](a20_0x3eb8('0x1c')+_0x77128+a20_0x3eb8('0x25'),{'qos':0x0});const _0x38fe80=a20_0x3eb8('0x1c')+_0x77128+'/'+_0x282ce8;_0x5d3243['on']('connect',_0x3136cf=>{console['log']('connect');if(!_0x3136cf){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x26'));}else{const _0x38fe80=a20_0x3eb8('0x27');const _0x352605=_0x182c47+'/'+_0x77128+a20_0x3eb8('0x28');_0x5d3243[a20_0x3eb8('0x29')](_0x38fe80,_0x352605,{'qos':0x1},_0x5a17eb=>{console[a20_0x3eb8('0x10')]('publish\x20result:');console['log'](_0x5a17eb);if(!_0x5a17eb){}});}});_0x5d3243['on']('close',()=>{console[a20_0x3eb8('0x10')](a20_0x3eb8('0x2a'));});_0x5d3243['on'](a20_0x3eb8('0x2b'),_0x2c7816=>{console[a20_0x3eb8('0x10')](a20_0x3eb8('0x2b'),_0x2c7816);});_0x5d3243['on']('message',(_0x35440f,_0xb37d41)=>{let _0x5a1921=a20_0x3eb8('0x2c');console[a20_0x3eb8('0x10')](_0x35440f);console[a20_0x3eb8('0x10')](_0xb37d41+'');if(_0x35440f===a20_0x3eb8('0x1c')+_0x77128+'/config'){_0x5a1921=a20_0x3eb8('0x2d');}else if(_0x35440f[a20_0x3eb8('0x2e')](a20_0x3eb8('0x1c')+_0x77128+a20_0x3eb8('0x2f'))){_0x5a1921=a20_0x3eb8('0x30');}_0x5a1921+=Buffer[a20_0x3eb8('0x31')](_0xb37d41,'base64')['toString'](a20_0x3eb8('0x32'));console[a20_0x3eb8('0x10')](_0x5a1921);});_0x5d3243['on'](a20_0x3eb8('0x33'),()=>{});console[a20_0x3eb8('0x10')](_0x477e0c);}[a20_0x3eb8('0xe')](){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x11'));this['clientId']=uuidv4();console['log']('this.clientId');console[a20_0x3eb8('0x10')](this['clientId']);const _0x3d51d9={'clientId':this[a20_0x3eb8('0x34')],'username':a20_0x3eb8('0x35'),'password':a20_0x3eb8('0x36'),'clean':!![]};this[a20_0x3eb8('0x37')]=mqtt['connect']('mqtt://lulo.run',_0x3d51d9);this[a20_0x3eb8('0x37')]['on'](a20_0x3eb8('0x21'),this[a20_0x3eb8('0x38')][a20_0x3eb8('0x39')](this));this['mqttClient']['on']('message',this[a20_0x3eb8('0x3a')][a20_0x3eb8('0x39')](this));this[a20_0x3eb8('0x37')]['on'](a20_0x3eb8('0x2a'),()=>{console[a20_0x3eb8('0x10')](a20_0x3eb8('0x2a'));});process['on'](a20_0x3eb8('0x3b'),this['handleAppExit']['bind'](this));process['on'](a20_0x3eb8('0x3c'),this[a20_0x3eb8('0x3d')]['bind'](this));process['on'](a20_0x3eb8('0x3e'),this[a20_0x3eb8('0x3d')][a20_0x3eb8('0x39')](this));}[a20_0x3eb8('0x38')](){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x3f')+this[a20_0x3eb8('0x34')]);this[a20_0x3eb8('0x37')][a20_0x3eb8('0x22')](a20_0x3eb8('0x40'));this[a20_0x3eb8('0x37')][a20_0x3eb8('0x22')]('player/close');this['mqttClient']['subscribe'](a20_0x3eb8('0x41'),{'qos':0x2});this[a20_0x3eb8('0x37')][a20_0x3eb8('0x22')]('player/load_playlist',{'qos':0x2});this[a20_0x3eb8('0x37')][a20_0x3eb8('0x22')](a20_0x3eb8('0x42'),{'qos':0x2});this['mqttClient'][a20_0x3eb8('0x22')](a20_0x3eb8('0x43'),{'qos':0x2});this['mqttClient'][a20_0x3eb8('0x22')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a20_0x3eb8('0x22')](a20_0x3eb8('0x44'),{'qos':0x2});this[a20_0x3eb8('0x37')][a20_0x3eb8('0x22')]('player/update_settings',{'qos':0x2});this['mqttClient']['subscribe'](a20_0x3eb8('0x45'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x3eb8('0x46'),{'qos':0x2});}['reportStatus'](){}[a20_0x3eb8('0x3a')](_0x244f37,_0x52b433){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x47'),_0x244f37,_0x52b433);switch(_0x244f37){case'player/open':return this[a20_0x3eb8('0x48')](_0x52b433);case a20_0x3eb8('0x49'):return this[a20_0x3eb8('0x4a')](_0x52b433);case'player/reboot':return this[a20_0x3eb8('0x4b')](_0x52b433);case a20_0x3eb8('0x42'):return this[a20_0x3eb8('0x4c')](_0x52b433);case a20_0x3eb8('0x4d'):return this[a20_0x3eb8('0x4e')](_0x52b433);case a20_0x3eb8('0x43'):return this[a20_0x3eb8('0x4f')](_0x52b433);case a20_0x3eb8('0x50'):return this[a20_0x3eb8('0x51')](_0x52b433);case a20_0x3eb8('0x44'):return this[a20_0x3eb8('0x52')](_0x52b433);case'player/update_settings':return this[a20_0x3eb8('0x53')](_0x52b433);case a20_0x3eb8('0x45'):return this[a20_0x3eb8('0x54')](_0x52b433);case a20_0x3eb8('0x46'):return this[a20_0x3eb8('0x55')](_0x52b433);}}[a20_0x3eb8('0x52')](_0x5ef75c){if(_0x5ef75c==a20_0x3eb8('0x56')||_0x5ef75c==String(this[a20_0x3eb8('0xa')][a20_0x3eb8('0x57')])){this['syncPlaylistsService'][a20_0x3eb8('0x58')]();}}[a20_0x3eb8('0x51')](_0x3ec9dc){if(_0x3ec9dc=='all'||_0x3ec9dc==String(this[a20_0x3eb8('0xa')][a20_0x3eb8('0x57')])){}}[a20_0x3eb8('0x4f')](_0x1e541a){console['log'](a20_0x3eb8('0x59')+_0x1e541a);if(_0x1e541a==a20_0x3eb8('0x56')||_0x1e541a==String(this[a20_0x3eb8('0xa')]['playerId'])){const _0x12c57e=__dirname;const _0x11ad1e=require(a20_0x3eb8('0x5a'))(_0x12c57e);console[a20_0x3eb8('0x10')]('Git\x20updating');_0x11ad1e[a20_0x3eb8('0x5b')]((_0x9cf343,_0x507021)=>{if(_0x9cf343){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x5c'));this[a20_0x3eb8('0x4f')](_0x1e541a);return;}else{}console[a20_0x3eb8('0x10')](a20_0x3eb8('0x5d'));console[a20_0x3eb8('0x10')](_0x507021);if(_0x507021&&_0x507021[a20_0x3eb8('0x5e')][a20_0x3eb8('0x5f')]){this['syncPlaylistsService'][a20_0x3eb8('0x60')]();}else{}});}}[a20_0x3eb8('0x4e')](_0x3d7ac6){if(_0x3d7ac6==a20_0x3eb8('0x56')||_0x3d7ac6==String(this[a20_0x3eb8('0xa')][a20_0x3eb8('0x57')])){this['syncPlaylistsService'][a20_0x3eb8('0x61')]();}}[a20_0x3eb8('0x4c')](_0x411bfb){if(String(_0x411bfb)==a20_0x3eb8('0x56')||String(_0x411bfb)==String(this['syncPlaylistsService'][a20_0x3eb8('0x57')])){this[a20_0x3eb8('0xa')][a20_0x3eb8('0x62')]();}}[a20_0x3eb8('0x4b')](_0x53b20e){if(_0x53b20e=='all'||_0x53b20e==String(this[a20_0x3eb8('0xa')]['playerId'])){console['log'](a20_0x3eb8('0x63'));try{this[a20_0x3eb8('0xa')][a20_0x3eb8('0x60')]();}catch(_0x39f608){console[a20_0x3eb8('0x10')](_0x39f608);}}}[a20_0x3eb8('0x53')](_0x4507d7){if(_0x4507d7==a20_0x3eb8('0x56')||_0x4507d7==String(this[a20_0x3eb8('0xa')][a20_0x3eb8('0x57')])){console[a20_0x3eb8('0x10')]('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a20_0x3eb8('0x64')]();}catch(_0xaad1c6){console[a20_0x3eb8('0x10')](_0xaad1c6);}}}['handleTurnOnTVRequest'](_0x20221d){if(_0x20221d==a20_0x3eb8('0x56')||_0x20221d==String(this['syncPlaylistsService'][a20_0x3eb8('0x57')])){console[a20_0x3eb8('0x10')]('handleTurnOnTVRequest:\x20');try{this[a20_0x3eb8('0xa')][a20_0x3eb8('0x65')]();}catch(_0x2efea0){console['log'](_0x2efea0);}}}[a20_0x3eb8('0x54')](_0x5bbe61){if(_0x5bbe61=='all'||_0x5bbe61==String(this['syncPlaylistsService']['playerId'])){console[a20_0x3eb8('0x10')]('handleTurnOffTVRequest:\x20');try{this[a20_0x3eb8('0xa')]['turnOffTV']();}catch(_0x5f18bd){console[a20_0x3eb8('0x10')](_0x5f18bd);}}}['sendStateUpdate'](){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x66'),this['state']);this['mqttClient']['publish'](a20_0x3eb8('0x67'),this[a20_0x3eb8('0xa')][a20_0x3eb8('0x57')]+'-'+this['state']);}[a20_0x3eb8('0x48')](_0x1e445c){if(this['state']!==a20_0x3eb8('0x68')&&this['state']!=='opening'){console[a20_0x3eb8('0x10')](a20_0x3eb8('0x69'));this[a20_0x3eb8('0xb')]=a20_0x3eb8('0x6a');this[a20_0x3eb8('0x6b')]();setTimeout(()=>{this[a20_0x3eb8('0xb')]=a20_0x3eb8('0x68');this[a20_0x3eb8('0x6b')]();},0x1388);}}[a20_0x3eb8('0x4a')](_0x15806f){if(this[a20_0x3eb8('0xb')]!==a20_0x3eb8('0xc')&&this[a20_0x3eb8('0xb')]!==a20_0x3eb8('0x6c')){this[a20_0x3eb8('0xb')]='closing';this[a20_0x3eb8('0x6b')]();setTimeout(()=>{this['state']=a20_0x3eb8('0xc');this[a20_0x3eb8('0x6b')]();},0x1388);}}[a20_0x3eb8('0x3d')](_0x5596ae,_0xfa604c){if(_0xfa604c){console[a20_0x3eb8('0x10')](_0xfa604c['stack']);}this[a20_0x3eb8('0x37')][a20_0x3eb8('0x29')](a20_0x3eb8('0x6d'),a20_0x3eb8('0x6e'));}[a20_0x3eb8('0x1e')](_0x5de54b,_0xaa792e,_0x4b9cff){const _0x218d51={'iat':Math['round'](Date[a20_0x3eb8('0x6f')]()/0x3e8),'exp':Math[a20_0x3eb8('0x20')](Date[a20_0x3eb8('0x6f')]()/0x3e8)+0x14*0x3c,'aud':_0x5de54b};const _0x23e529=fs[a20_0x3eb8('0x70')](_0xaa792e);return jwt[a20_0x3eb8('0x71')](_0x218d51,_0x23e529,{'algorithm':_0x4b9cff});}}exports['MqttService']=MqttService;