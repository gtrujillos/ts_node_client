var a18_0x5abc=['bind','mqttClient_message','exit','handleAppExit','SIGINT','mqttClient_connect','player/open','player/reboot','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','player/load_playlist','handleLoadPlaylistRequest','handleIfconfigRequest','handleUpdateSettingsRequest','handleRegisterRequest','all','playerId','handleUpdateRequest','handleUpdateRequest:\x20','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest','sending\x20state\x20%s','state','publish','player/state','opening','sendStateUpdate','open','closing','player/connected','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','spawn','is-image','mqtt','uuid/v4','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','us-central1','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','round','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','mqttClient'];(function(_0x744374,_0x3e6860){var _0x4a8bbb=function(_0x194bd5){while(--_0x194bd5){_0x744374['push'](_0x744374['shift']());}};_0x4a8bbb(++_0x3e6860);}(a18_0x5abc,0x160));var a18_0x18c7=function(_0x151c90,_0x358714){_0x151c90=_0x151c90-0x0;var _0x57546f=a18_0x5abc[_0x151c90];return _0x57546f;};'use strict';Object[a18_0x18c7('0x0')](exports,a18_0x18c7('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x18c7('0x2'));const fs=require('fs');const fsExtra=require(a18_0x18c7('0x3'));const request=require('request');const progress=require(a18_0x18c7('0x4'));const spawn=require('child_process')[a18_0x18c7('0x5')];const exec=require('child_process')['exec'];const isImage=require(a18_0x18c7('0x6'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x18c7('0x7'));const uuidv4=require(a18_0x18c7('0x8'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x33bec3){this[a18_0x18c7('0x9')]=_0x33bec3;this['state']=a18_0x18c7('0xa');this[a18_0x18c7('0xb')]=new HttpClientService_1[(a18_0x18c7('0xc'))]();}[a18_0x18c7('0xd')](){this[a18_0x18c7('0xe')]();}[a18_0x18c7('0xf')](){console[a18_0x18c7('0x10')](a18_0x18c7('0x11'));const _0x554033=a18_0x18c7('0x12');const _0x4692b6='my-node-device';const _0x4a54b3=a18_0x18c7('0x13');const _0x4b46be=a18_0x18c7('0x14');const _0x2f7c2d='RS256';const _0x4a6839='resources/keys/rsa_private.pem';const _0x4889ab=a18_0x18c7('0x15');const _0x40653e=0x1bb;const _0x1b0666=a18_0x18c7('0x16');const _0x2e3a5d=0x5;const _0x1fa2d8=a18_0x18c7('0x17')+_0x554033+a18_0x18c7('0x18')+_0x4b46be+a18_0x18c7('0x19')+_0x4a54b3+a18_0x18c7('0x1a')+_0x4692b6;const _0x2f43b4={'host':_0x4889ab,'port':_0x40653e,'clientId':_0x1fa2d8,'username':a18_0x18c7('0x1b'),'password':this[a18_0x18c7('0x1c')](_0x554033,_0x4a6839,_0x2f7c2d),'protocol':'mqtts','secureProtocol':'TLSv1_2_method'};const _0x312f63=Math[a18_0x18c7('0x1d')](Date[a18_0x18c7('0x1e')]()/0x3e8);const _0x1c16f2=mqtt[a18_0x18c7('0x1f')](_0x2f43b4);_0x1c16f2[a18_0x18c7('0x20')](a18_0x18c7('0x1a')+_0x4692b6+a18_0x18c7('0x21'),{'qos':0x1});_0x1c16f2[a18_0x18c7('0x20')](a18_0x18c7('0x1a')+_0x4692b6+a18_0x18c7('0x22'),{'qos':0x1});_0x1c16f2[a18_0x18c7('0x20')]('/devices/'+_0x4692b6+a18_0x18c7('0x23'),{'qos':0x0});const _0x1c50ce=a18_0x18c7('0x1a')+_0x4692b6+'/'+_0x1b0666;_0x1c16f2['on'](a18_0x18c7('0x1f'),_0x4b9519=>{console[a18_0x18c7('0x10')](a18_0x18c7('0x1f'));if(!_0x4b9519){console['log'](a18_0x18c7('0x24'));}else{const _0x1c50ce=a18_0x18c7('0x25');const _0x2d78dc=_0x4a54b3+'/'+_0x4692b6+'-payload-0';_0x1c16f2['publish'](_0x1c50ce,_0x2d78dc,{'qos':0x1},_0x23ffc1=>{console[a18_0x18c7('0x10')](a18_0x18c7('0x26'));console[a18_0x18c7('0x10')](_0x23ffc1);if(!_0x23ffc1){}});}});_0x1c16f2['on'](a18_0x18c7('0x27'),()=>{console[a18_0x18c7('0x10')](a18_0x18c7('0x27'));});_0x1c16f2['on'](a18_0x18c7('0x28'),_0x580ee7=>{console['log'](a18_0x18c7('0x28'),_0x580ee7);});_0x1c16f2['on'](a18_0x18c7('0x29'),(_0x127f5c,_0x1af5d6)=>{let _0x4e2af0=a18_0x18c7('0x2a');console[a18_0x18c7('0x10')](_0x127f5c);console[a18_0x18c7('0x10')](_0x1af5d6+'');if(_0x127f5c==='/devices/'+_0x4692b6+a18_0x18c7('0x21')){_0x4e2af0=a18_0x18c7('0x2b');}else if(_0x127f5c[a18_0x18c7('0x2c')](a18_0x18c7('0x1a')+_0x4692b6+a18_0x18c7('0x2d'))){_0x4e2af0=a18_0x18c7('0x2e');}_0x4e2af0+=Buffer[a18_0x18c7('0x2f')](_0x1af5d6,a18_0x18c7('0x30'))[a18_0x18c7('0x31')](a18_0x18c7('0x32'));console[a18_0x18c7('0x10')](_0x4e2af0);});_0x1c16f2['on'](a18_0x18c7('0x33'),()=>{});console[a18_0x18c7('0x10')](_0x2f43b4);}[a18_0x18c7('0xe')](){console[a18_0x18c7('0x10')](a18_0x18c7('0x11'));this[a18_0x18c7('0x34')]=uuidv4();console[a18_0x18c7('0x10')](a18_0x18c7('0x35'));console[a18_0x18c7('0x10')](this[a18_0x18c7('0x34')]);const _0x35b36c={'clientId':this[a18_0x18c7('0x34')],'username':a18_0x18c7('0x36'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x18c7('0x37')]=mqtt['connect']('mqtt://lulo.run',_0x35b36c);this[a18_0x18c7('0x37')]['on'](a18_0x18c7('0x1f'),this['mqttClient_connect'][a18_0x18c7('0x38')](this));this[a18_0x18c7('0x37')]['on'](a18_0x18c7('0x29'),this[a18_0x18c7('0x39')][a18_0x18c7('0x38')](this));this[a18_0x18c7('0x37')]['on'](a18_0x18c7('0x27'),()=>{console[a18_0x18c7('0x10')](a18_0x18c7('0x27'));});process['on'](a18_0x18c7('0x3a'),this[a18_0x18c7('0x3b')][a18_0x18c7('0x38')](this));process['on'](a18_0x18c7('0x3c'),this[a18_0x18c7('0x3b')]['bind'](this));process['on']('uncaughtException',this[a18_0x18c7('0x3b')]['bind'](this));}[a18_0x18c7('0x3d')](){console[a18_0x18c7('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x18c7('0x34')]);this[a18_0x18c7('0x37')]['subscribe'](a18_0x18c7('0x3e'));this[a18_0x18c7('0x37')][a18_0x18c7('0x20')]('player/close');this[a18_0x18c7('0x37')]['subscribe'](a18_0x18c7('0x3f'),{'qos':0x2});this[a18_0x18c7('0x37')]['subscribe']('player/load_playlist',{'qos':0x2});this[a18_0x18c7('0x37')][a18_0x18c7('0x20')](a18_0x18c7('0x40'),{'qos':0x2});this[a18_0x18c7('0x37')]['subscribe'](a18_0x18c7('0x41'),{'qos':0x2});this[a18_0x18c7('0x37')][a18_0x18c7('0x20')](a18_0x18c7('0x42'),{'qos':0x2});this[a18_0x18c7('0x37')][a18_0x18c7('0x20')](a18_0x18c7('0x43'),{'qos':0x2});this['mqttClient'][a18_0x18c7('0x20')](a18_0x18c7('0x44'),{'qos':0x2});}[a18_0x18c7('0x45')](){}[a18_0x18c7('0x39')](_0x235980,_0xa2ece9){console[a18_0x18c7('0x10')](a18_0x18c7('0x46'),_0x235980,_0xa2ece9);switch(_0x235980){case a18_0x18c7('0x3e'):return this[a18_0x18c7('0x47')](_0xa2ece9);case a18_0x18c7('0x48'):return this[a18_0x18c7('0x49')](_0xa2ece9);case'player/reboot':return this['handleRebootRequest'](_0xa2ece9);case a18_0x18c7('0x40'):return this['handleReloadPlaylistRequest'](_0xa2ece9);case a18_0x18c7('0x4a'):return this[a18_0x18c7('0x4b')](_0xa2ece9);case a18_0x18c7('0x41'):return this['handleUpdateRequest'](_0xa2ece9);case'player/ifconfig':return this[a18_0x18c7('0x4c')](_0xa2ece9);case a18_0x18c7('0x43'):return this['handleRegisterRequest'](_0xa2ece9);case a18_0x18c7('0x44'):return this[a18_0x18c7('0x4d')](_0xa2ece9);}}[a18_0x18c7('0x4e')](_0x29157d){if(_0x29157d==a18_0x18c7('0x4f')||_0x29157d==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){this['syncPlaylistsService']['registerClient']();}}[a18_0x18c7('0x4c')](_0x1e6c64){if(_0x1e6c64=='all'||_0x1e6c64==String(this[a18_0x18c7('0x9')]['playerId'])){}}[a18_0x18c7('0x51')](_0x4e17cf){console[a18_0x18c7('0x10')](a18_0x18c7('0x52')+_0x4e17cf);if(_0x4e17cf==a18_0x18c7('0x4f')||_0x4e17cf==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){const _0x4a575e=__dirname;const _0x57f0c7=require('simple-git')(_0x4a575e);console[a18_0x18c7('0x10')]('Git\x20updating');_0x57f0c7['pull']((_0x578bb2,_0x4fcb36)=>{if(_0x578bb2){console[a18_0x18c7('0x10')]('Error\x20git\x20updated');this[a18_0x18c7('0x51')](_0x4e17cf);return;}else{}console[a18_0x18c7('0x10')](a18_0x18c7('0x53'));console[a18_0x18c7('0x10')](_0x4fcb36);if(_0x4fcb36&&_0x4fcb36[a18_0x18c7('0x54')][a18_0x18c7('0x55')]){this[a18_0x18c7('0x9')][a18_0x18c7('0x56')]();}else{}});}}[a18_0x18c7('0x4b')](_0x1796c7){if(_0x1796c7==a18_0x18c7('0x4f')||_0x1796c7==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){this[a18_0x18c7('0x9')][a18_0x18c7('0x57')]();}}['handleReloadPlaylistRequest'](_0x3abc9f){if(String(_0x3abc9f)==a18_0x18c7('0x4f')||String(_0x3abc9f)==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){this[a18_0x18c7('0x9')][a18_0x18c7('0x58')]();}}[a18_0x18c7('0x59')](_0x1f0014){if(_0x1f0014==a18_0x18c7('0x4f')||_0x1f0014==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){console[a18_0x18c7('0x10')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this['syncPlaylistsService'][a18_0x18c7('0x56')]();}catch(_0x482ce2){console['log'](_0x482ce2);}}}['handleUpdateSettingsRequest'](_0x1fa5be){if(_0x1fa5be==a18_0x18c7('0x4f')||_0x1fa5be==String(this[a18_0x18c7('0x9')][a18_0x18c7('0x50')])){console[a18_0x18c7('0x10')]('handleUpdateSettingsRequest:\x20');try{this[a18_0x18c7('0x9')]['updateSettings']();}catch(_0x5ccd29){console[a18_0x18c7('0x10')](_0x5ccd29);}}}['sendStateUpdate'](){console[a18_0x18c7('0x10')](a18_0x18c7('0x5a'),this[a18_0x18c7('0x5b')]);this[a18_0x18c7('0x37')][a18_0x18c7('0x5c')](a18_0x18c7('0x5d'),this[a18_0x18c7('0x9')][a18_0x18c7('0x50')]+'-'+this[a18_0x18c7('0x5b')]);}['handleOpenRequest'](_0x32da6e){if(this[a18_0x18c7('0x5b')]!=='open'&&this[a18_0x18c7('0x5b')]!==a18_0x18c7('0x5e')){console[a18_0x18c7('0x10')]('opening\x20player\x20door');this[a18_0x18c7('0x5b')]='opening';this[a18_0x18c7('0x5f')]();setTimeout(()=>{this[a18_0x18c7('0x5b')]=a18_0x18c7('0x60');this[a18_0x18c7('0x5f')]();},0x1388);}}[a18_0x18c7('0x49')](_0x50e7ef){if(this[a18_0x18c7('0x5b')]!==a18_0x18c7('0xa')&&this[a18_0x18c7('0x5b')]!==a18_0x18c7('0x61')){this[a18_0x18c7('0x5b')]=a18_0x18c7('0x61');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x18c7('0x5b')]=a18_0x18c7('0xa');this[a18_0x18c7('0x5f')]();},0x1388);}}[a18_0x18c7('0x3b')](_0x44c797,_0x5d16de){if(_0x5d16de){console[a18_0x18c7('0x10')](_0x5d16de['stack']);}this[a18_0x18c7('0x37')][a18_0x18c7('0x5c')](a18_0x18c7('0x62'),a18_0x18c7('0x63'));}[a18_0x18c7('0x1c')](_0x2834e7,_0x22bf97,_0xb0caf5){const _0x1dd905={'iat':Math[a18_0x18c7('0x1d')](Date[a18_0x18c7('0x1e')]()/0x3e8),'exp':Math[a18_0x18c7('0x1d')](Date[a18_0x18c7('0x1e')]()/0x3e8)+0x14*0x3c,'aud':_0x2834e7};const _0x11f3f4=fs[a18_0x18c7('0x64')](_0x22bf97);return jwt[a18_0x18c7('0x65')](_0x1dd905,_0x11f3f4,{'algorithm':_0xb0caf5});}}exports['MqttService']=MqttService;