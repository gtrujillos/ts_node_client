var a18_0x27e8=['handleLoadPlaylistRequest','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','sendStateUpdate','publish','player/state','opening\x20player\x20door','opening','open','closing','handleAppExit','stack','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','string-template','uuid/v4','state','closed','HttpClientService','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','exit','SIGINT','uncaughtException','subscribe','player/close','player/reboot','player/update','player/ifconfig','mqttClient_message','player/open','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','player/load_playlist','handleUpdateRequest','handleIfconfigRequest','player/register','handleRegisterRequest','syncPlaylistsService','playerId','all','simple-git','Git\x20updating','pull','Error\x20git\x20updated','changes','shutdown','now'];(function(_0x774d69,_0x927eec){var _0x6b003d=function(_0x51e95b){while(--_0x51e95b){_0x774d69['push'](_0x774d69['shift']());}};_0x6b003d(++_0x927eec);}(a18_0x27e8,0x1a8));var a18_0x2730=function(_0x30fc6c,_0x1a23db){_0x30fc6c=_0x30fc6c-0x0;var _0x19cc54=a18_0x27e8[_0x30fc6c];return _0x19cc54;};'use strict';Object[a18_0x2730('0x0')](exports,a18_0x2730('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2730('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2730('0x3'));const request=require(a18_0x2730('0x4'));const progress=require(a18_0x2730('0x5'));const spawn=require(a18_0x2730('0x6'))[a18_0x2730('0x7')];const isImage=require('is-image');const format=require(a18_0x2730('0x8'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x2730('0x9'));class MqttService{constructor(_0x2c7d71){this['syncPlaylistsService']=_0x2c7d71;this[a18_0x2730('0xa')]=a18_0x2730('0xb');this['httpClientService']=new HttpClientService_1[(a18_0x2730('0xc'))]();}['init'](){this[a18_0x2730('0xd')]();}[a18_0x2730('0xd')](){console[a18_0x2730('0xe')]('mqttInit');this[a18_0x2730('0xf')]=uuidv4();console['log']('this.clientId');console['log'](this[a18_0x2730('0xf')]);const _0x415835={'clientId':this[a18_0x2730('0xf')],'username':a18_0x2730('0x10'),'password':a18_0x2730('0x11'),'clean':!![]};this[a18_0x2730('0x12')]=mqtt[a18_0x2730('0x13')](a18_0x2730('0x14'),_0x415835);this[a18_0x2730('0x12')]['on']('connect',this[a18_0x2730('0x15')][a18_0x2730('0x16')](this));this['mqttClient']['on']('message',this['mqttClient_message'][a18_0x2730('0x16')](this));process['on'](a18_0x2730('0x17'),this['handleAppExit'][a18_0x2730('0x16')](this));process['on'](a18_0x2730('0x18'),this['handleAppExit'][a18_0x2730('0x16')](this));process['on'](a18_0x2730('0x19'),this['handleAppExit']['bind'](this));}[a18_0x2730('0x15')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x2730('0xf')]);this['mqttClient'][a18_0x2730('0x1a')]('player/open');this[a18_0x2730('0x12')][a18_0x2730('0x1a')](a18_0x2730('0x1b'));this[a18_0x2730('0x12')][a18_0x2730('0x1a')](a18_0x2730('0x1c'),{'qos':0x2});this[a18_0x2730('0x12')][a18_0x2730('0x1a')]('player/load_playlist',{'qos':0x2});this[a18_0x2730('0x12')][a18_0x2730('0x1a')]('player/reload_playlist',{'qos':0x2});this[a18_0x2730('0x12')][a18_0x2730('0x1a')](a18_0x2730('0x1d'),{'qos':0x2});this[a18_0x2730('0x12')][a18_0x2730('0x1a')](a18_0x2730('0x1e'),{'qos':0x2});this[a18_0x2730('0x12')]['subscribe']('player/register',{'qos':0x2});}['reportStatus'](){}[a18_0x2730('0x1f')](_0x657b,_0x5b60c3){console[a18_0x2730('0xe')]('received\x20message\x20%s\x20%s',_0x657b,_0x5b60c3);switch(_0x657b){case a18_0x2730('0x20'):return this[a18_0x2730('0x21')](_0x5b60c3);case a18_0x2730('0x1b'):return this[a18_0x2730('0x22')](_0x5b60c3);case a18_0x2730('0x1c'):return this[a18_0x2730('0x23')](_0x5b60c3);case a18_0x2730('0x24'):return this['handleReloadPlaylistRequest'](_0x5b60c3);case a18_0x2730('0x25'):return this['handleLoadPlaylistRequest'](_0x5b60c3);case'player/update':return this[a18_0x2730('0x26')](_0x5b60c3);case'player/ifconfig':return this[a18_0x2730('0x27')](_0x5b60c3);case a18_0x2730('0x28'):return this['handleRegisterRequest'](_0x5b60c3);}}[a18_0x2730('0x29')](_0x5e1829){if(_0x5e1829=='all'||_0x5e1829==String(this[a18_0x2730('0x2a')][a18_0x2730('0x2b')])){this['syncPlaylistsService']['registerClient']();}}['handleIfconfigRequest'](_0x51e091){if(_0x51e091==a18_0x2730('0x2c')||_0x51e091==String(this[a18_0x2730('0x2a')][a18_0x2730('0x2b')])){}}[a18_0x2730('0x26')](_0x4f15f5){console['log']('handleUpdateRequest:\x20'+_0x4f15f5);if(_0x4f15f5==a18_0x2730('0x2c')||_0x4f15f5==String(this[a18_0x2730('0x2a')][a18_0x2730('0x2b')])){const _0x5746da=__dirname;const _0x3572f4=require(a18_0x2730('0x2d'))(_0x5746da);console['log'](a18_0x2730('0x2e'));_0x3572f4[a18_0x2730('0x2f')]((_0x4e7d81,_0x4d1421)=>{if(_0x4e7d81){console[a18_0x2730('0xe')](a18_0x2730('0x30'));this[a18_0x2730('0x26')](_0x4f15f5);return;}else{}console[a18_0x2730('0xe')]('Git\x20updated');console['log'](_0x4d1421);if(_0x4d1421&&_0x4d1421['summary'][a18_0x2730('0x31')]){const _0x8e7b67=spawn(a18_0x2730('0x32'),['-r',a18_0x2730('0x33')]);}else{}});}}[a18_0x2730('0x34')](_0x24a776){if(_0x24a776==a18_0x2730('0x2c')||_0x24a776==String(this['syncPlaylistsService'][a18_0x2730('0x2b')])){this[a18_0x2730('0x2a')][a18_0x2730('0x35')]();}}[a18_0x2730('0x36')](_0x4d2cd5){if(String(_0x4d2cd5)=='all'||String(_0x4d2cd5)==String(this[a18_0x2730('0x2a')][a18_0x2730('0x2b')])){this[a18_0x2730('0x2a')][a18_0x2730('0x37')]();}}[a18_0x2730('0x23')](_0x2817f3){if(_0x2817f3==a18_0x2730('0x2c')||_0x2817f3==String(this[a18_0x2730('0x2a')][a18_0x2730('0x2b')])){const _0x1305b2=spawn('shutdown',['-r',a18_0x2730('0x33')]);}}[a18_0x2730('0x38')](){console[a18_0x2730('0xe')]('sending\x20state\x20%s',this[a18_0x2730('0xa')]);this[a18_0x2730('0x12')][a18_0x2730('0x39')](a18_0x2730('0x3a'),this[a18_0x2730('0x2a')][a18_0x2730('0x2b')]+'-'+this['state']);}[a18_0x2730('0x21')](_0x2d1ba9){if(this[a18_0x2730('0xa')]!=='open'&&this[a18_0x2730('0xa')]!=='opening'){console[a18_0x2730('0xe')](a18_0x2730('0x3b'));this['state']=a18_0x2730('0x3c');this[a18_0x2730('0x38')]();setTimeout(()=>{this[a18_0x2730('0xa')]=a18_0x2730('0x3d');this[a18_0x2730('0x38')]();},0x1388);}}[a18_0x2730('0x22')](_0x4d4c07){if(this[a18_0x2730('0xa')]!==a18_0x2730('0xb')&&this[a18_0x2730('0xa')]!==a18_0x2730('0x3e')){this[a18_0x2730('0xa')]=a18_0x2730('0x3e');this[a18_0x2730('0x38')]();setTimeout(()=>{this[a18_0x2730('0xa')]=a18_0x2730('0xb');this[a18_0x2730('0x38')]();},0x1388);}}[a18_0x2730('0x3f')](_0x32ab66,_0x35722d){if(_0x35722d){console[a18_0x2730('0xe')](_0x35722d[a18_0x2730('0x40')]);}this[a18_0x2730('0x12')][a18_0x2730('0x39')](a18_0x2730('0x41'),a18_0x2730('0x42'));}}exports[a18_0x2730('0x43')]=MqttService;