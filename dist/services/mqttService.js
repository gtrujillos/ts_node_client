var a18_0xa86e=['player/reload_playlist','player/update','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleRebootRequest','handleLoadPlaylistRequest','handleUpdateRequest','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','all','handleReloadPlaylistRequest','playerId','reloadMediaList','sending\x20state\x20%s','publish','player/state','open','opening','sendStateUpdate','player/connected','defineProperty','__esModule','request','spawn','is-image','string-template','syncPlaylistsService','state','closed','httpClientService','mqttInit','log','clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/reboot','subscribe','player/load_playlist'];(function(_0x32b64d,_0xf5abd8){var _0x4b3759=function(_0x26b6ef){while(--_0x26b6ef){_0x32b64d['push'](_0x32b64d['shift']());}};_0x4b3759(++_0xf5abd8);}(a18_0xa86e,0x90));var a18_0x3474=function(_0x19c59c,_0x59dccd){_0x19c59c=_0x19c59c-0x0;var _0x4b2150=a18_0xa86e[_0x19c59c];return _0x4b2150;};'use strict';Object[a18_0x3474('0x0')](exports,a18_0x3474('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x3474('0x2'));const progress=require('request-progress');const spawn=require('child_process')[a18_0x3474('0x3')];const isImage=require(a18_0x3474('0x4'));const format=require(a18_0x3474('0x5'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');class MqttService{constructor(_0x1f1d17){this[a18_0x3474('0x6')]=_0x1f1d17;this[a18_0x3474('0x7')]=a18_0x3474('0x8');this[a18_0x3474('0x9')]=new HttpClientService_1['HttpClientService']();}['init'](){this[a18_0x3474('0xa')]();}[a18_0x3474('0xa')](){console[a18_0x3474('0xb')]('mqttInit');this['clientId']=uuidv4();console[a18_0x3474('0xb')]('this.clientId');console[a18_0x3474('0xb')](this['clientId']);const _0x3bdc29={'clientId':this[a18_0x3474('0xc')],'username':a18_0x3474('0xd'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x3474('0xe')]=mqtt[a18_0x3474('0xf')](a18_0x3474('0x10'),_0x3bdc29);this[a18_0x3474('0xe')]['on'](a18_0x3474('0xf'),this[a18_0x3474('0x11')][a18_0x3474('0x12')](this));this[a18_0x3474('0xe')]['on'](a18_0x3474('0x13'),this[a18_0x3474('0x14')][a18_0x3474('0x12')](this));process['on'](a18_0x3474('0x15'),this[a18_0x3474('0x16')][a18_0x3474('0x12')](this));process['on'](a18_0x3474('0x17'),this[a18_0x3474('0x16')]['bind'](this));process['on'](a18_0x3474('0x18'),this[a18_0x3474('0x16')][a18_0x3474('0x12')](this));}['mqttClient_connect'](){console['log'](a18_0x3474('0x19')+this[a18_0x3474('0xc')]);this[a18_0x3474('0xe')]['subscribe'](a18_0x3474('0x1a'));this[a18_0x3474('0xe')]['subscribe']('player/close');this[a18_0x3474('0xe')]['subscribe'](a18_0x3474('0x1b'),{'qos':0x2});this[a18_0x3474('0xe')][a18_0x3474('0x1c')](a18_0x3474('0x1d'),{'qos':0x2});this[a18_0x3474('0xe')][a18_0x3474('0x1c')](a18_0x3474('0x1e'),{'qos':0x2});this[a18_0x3474('0xe')]['subscribe'](a18_0x3474('0x1f'),{'qos':0x2});}['reportStatus'](){}[a18_0x3474('0x14')](_0x16530c,_0x502947){console[a18_0x3474('0xb')](a18_0x3474('0x20'),_0x16530c,_0x502947);switch(_0x16530c){case a18_0x3474('0x1a'):return this[a18_0x3474('0x21')](_0x502947);case a18_0x3474('0x22'):return this['handleCloseRequest'](_0x502947);case a18_0x3474('0x1b'):return this[a18_0x3474('0x23')](_0x502947);case a18_0x3474('0x1e'):return this['handleReloadPlaylistRequest'](_0x502947);case a18_0x3474('0x1d'):return this[a18_0x3474('0x24')](_0x502947);case a18_0x3474('0x1f'):return this[a18_0x3474('0x25')](_0x502947);}}['handleUpdateRequest'](_0x109e1d){if(_0x109e1d=='all'||_0x109e1d==String(this[a18_0x3474('0x6')]['playerId'])){const _0x811f0d=__dirname;const _0x12acbd=require(a18_0x3474('0x26'))(_0x811f0d);console[a18_0x3474('0xb')](a18_0x3474('0x27'));_0x12acbd[a18_0x3474('0x28')]((_0x131722,_0x4c2693)=>{if(_0x131722){console['log'](a18_0x3474('0x29'));this['handleUpdateRequest'](_0x109e1d);return;}else{}console[a18_0x3474('0xb')](a18_0x3474('0x2a'));console['log'](_0x4c2693);if(_0x4c2693&&_0x4c2693[a18_0x3474('0x2b')][a18_0x3474('0x2c')]){const _0x2b568f=spawn(a18_0x3474('0x2d'),['-r',a18_0x3474('0x2e')]);}else{}});}}[a18_0x3474('0x24')](_0x2c62fe){if(_0x2c62fe==a18_0x3474('0x2f')||_0x2c62fe==String(this[a18_0x3474('0x6')]['playerId'])){this[a18_0x3474('0x6')]['loadMediaList']();}}[a18_0x3474('0x30')](_0x2d027e){if(String(_0x2d027e)==a18_0x3474('0x2f')||String(_0x2d027e)==String(this[a18_0x3474('0x6')][a18_0x3474('0x31')])){this[a18_0x3474('0x6')][a18_0x3474('0x32')]();}}['handleRebootRequest'](_0x78510a){if(_0x78510a==a18_0x3474('0x2f')||_0x78510a==String(this[a18_0x3474('0x6')]['playerId'])){const _0x1e74ca=spawn(a18_0x3474('0x2d'),['-r',a18_0x3474('0x2e')]);}}['sendStateUpdate'](){console[a18_0x3474('0xb')](a18_0x3474('0x33'),this[a18_0x3474('0x7')]);this['mqttClient'][a18_0x3474('0x34')](a18_0x3474('0x35'),this['syncPlaylistsService']['playerId']+'-'+this[a18_0x3474('0x7')]);}[a18_0x3474('0x21')](_0x4fc60c){if(this[a18_0x3474('0x7')]!==a18_0x3474('0x36')&&this[a18_0x3474('0x7')]!==a18_0x3474('0x37')){console[a18_0x3474('0xb')]('opening\x20player\x20door');this[a18_0x3474('0x7')]='opening';this[a18_0x3474('0x38')]();setTimeout(()=>{this[a18_0x3474('0x7')]=a18_0x3474('0x36');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x452580){if(this['state']!==a18_0x3474('0x8')&&this['state']!=='closing'){this['state']='closing';this[a18_0x3474('0x38')]();setTimeout(()=>{this['state']=a18_0x3474('0x8');this[a18_0x3474('0x38')]();},0x1388);}}['handleAppExit'](_0xe8fa6e,_0x4a8415){if(_0x4a8415){console[a18_0x3474('0xb')](_0x4a8415['stack']);}this[a18_0x3474('0xe')][a18_0x3474('0x34')](a18_0x3474('0x39'),'false');}}exports['MqttService']=MqttService;