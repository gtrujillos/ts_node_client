var a17_0x5a5b=['MqttService','__esModule','request-progress','child_process','is-image','string-template','mqtt','uuid/v4','state','closed','syncPlaylistsService','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/update','registerClient','playerId','stringify','networkInterfaces','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleUpdateRequest','all','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','shutdown','now','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','open','opening','closing','stack','player/connected','false'];(function(_0x442e74,_0xf5e0b){var _0x57e6b1=function(_0x45fbbe){while(--_0x45fbbe){_0x442e74['push'](_0x442e74['shift']());}};_0x57e6b1(++_0xf5e0b);}(a17_0x5a5b,0x7b));var a17_0x5ae2=function(_0x325ddb,_0x1a1c29){_0x325ddb=_0x325ddb-0x0;var _0x53be44=a17_0x5a5b[_0x325ddb];return _0x53be44;};'use strict';Object['defineProperty'](exports,a17_0x5ae2('0x0'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a17_0x5ae2('0x1'));const spawn=require(a17_0x5ae2('0x2'))['spawn'];const isImage=require(a17_0x5ae2('0x3'));const format=require(a17_0x5ae2('0x4'));const os=require('os');const mqtt=require(a17_0x5ae2('0x5'));const uuidv4=require(a17_0x5ae2('0x6'));class MqttService{constructor(_0x3627ba){this[a17_0x5ae2('0x7')]=a17_0x5ae2('0x8');this[a17_0x5ae2('0x9')]=_0x3627ba;}['init'](){this[a17_0x5ae2('0xa')]();}[a17_0x5ae2('0xa')](){console[a17_0x5ae2('0xb')](a17_0x5ae2('0xa'));this[a17_0x5ae2('0xc')]=uuidv4();const _0x3d73c5={'clientId':this[a17_0x5ae2('0xc')],'username':a17_0x5ae2('0xd'),'password':a17_0x5ae2('0xe'),'clean':!![]};this[a17_0x5ae2('0xf')]=mqtt[a17_0x5ae2('0x10')]('mqtt://lulo.run',_0x3d73c5);this['mqttClient']['on']('connect',this[a17_0x5ae2('0x11')][a17_0x5ae2('0x12')](this));this['mqttClient']['on']('message',this[a17_0x5ae2('0x13')][a17_0x5ae2('0x12')](this));process['on'](a17_0x5ae2('0x14'),this[a17_0x5ae2('0x15')][a17_0x5ae2('0x12')](this));process['on']('SIGINT',this[a17_0x5ae2('0x15')][a17_0x5ae2('0x12')](this));process['on'](a17_0x5ae2('0x16'),this[a17_0x5ae2('0x15')][a17_0x5ae2('0x12')](this));}[a17_0x5ae2('0x11')](){console[a17_0x5ae2('0xb')](a17_0x5ae2('0x17')+this[a17_0x5ae2('0xc')]);this[a17_0x5ae2('0xf')][a17_0x5ae2('0x18')](a17_0x5ae2('0x19'));this[a17_0x5ae2('0xf')][a17_0x5ae2('0x18')](a17_0x5ae2('0x1a'));this['mqttClient'][a17_0x5ae2('0x18')](a17_0x5ae2('0x1b'),{'qos':0x2});this[a17_0x5ae2('0xf')][a17_0x5ae2('0x18')](a17_0x5ae2('0x1c'),{'qos':0x2});this[a17_0x5ae2('0xf')][a17_0x5ae2('0x18')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a17_0x5ae2('0x18')](a17_0x5ae2('0x1d'),{'qos':0x2});this[a17_0x5ae2('0x1e')]();}[a17_0x5ae2('0x1e')](){const _0x74a113={'playerId':this[a17_0x5ae2('0x9')][a17_0x5ae2('0x1f')],'clientId':this[a17_0x5ae2('0xc')],'connected':!![],'network':JSON[a17_0x5ae2('0x20')](os[a17_0x5ae2('0x21')]())};console[a17_0x5ae2('0xb')](_0x74a113);}['reportStatus'](){}[a17_0x5ae2('0x13')](_0x20007e,_0x5bed38){console[a17_0x5ae2('0xb')]('received\x20message\x20%s\x20%s',_0x20007e,_0x5bed38);switch(_0x20007e){case a17_0x5ae2('0x19'):return this[a17_0x5ae2('0x22')](_0x5bed38);case a17_0x5ae2('0x1a'):return this[a17_0x5ae2('0x23')](_0x5bed38);case'player/reboot':return this[a17_0x5ae2('0x24')](_0x5bed38);case a17_0x5ae2('0x25'):return this['handleReloadPlaylistRequest'](_0x5bed38);case a17_0x5ae2('0x1c'):return this['handleLoadPlaylistRequest'](_0x5bed38);case a17_0x5ae2('0x1d'):return this[a17_0x5ae2('0x26')](_0x5bed38);}}[a17_0x5ae2('0x26')](_0xdaa27d){if(_0xdaa27d==a17_0x5ae2('0x27')||_0xdaa27d==String(this[a17_0x5ae2('0x9')]['playerId'])){const _0x114b38=__dirname;const _0x5dabd9=require('simple-git')(_0x114b38);console[a17_0x5ae2('0xb')](a17_0x5ae2('0x28'));_0x5dabd9[a17_0x5ae2('0x29')]((_0x15a0b6,_0x25d560)=>{if(_0x15a0b6){console[a17_0x5ae2('0xb')](a17_0x5ae2('0x2a'));this['handleUpdateRequest'](_0xdaa27d);return;}else{}console[a17_0x5ae2('0xb')]('Git\x20updated');console[a17_0x5ae2('0xb')](_0x25d560);if(_0x25d560&&_0x25d560[a17_0x5ae2('0x2b')][a17_0x5ae2('0x2c')]){const _0x523668=spawn(a17_0x5ae2('0x2d'),['-r',a17_0x5ae2('0x2e')]);}else{}});}}['handleLoadPlaylistRequest'](_0x37514e){if(_0x37514e==a17_0x5ae2('0x27')||_0x37514e==String(this[a17_0x5ae2('0x9')][a17_0x5ae2('0x1f')])){this[a17_0x5ae2('0x9')][a17_0x5ae2('0x2f')]();}}[a17_0x5ae2('0x30')](_0x26c23c){if(_0x26c23c=='all'||_0x26c23c==String(this['syncPlaylistsService'][a17_0x5ae2('0x1f')])){this['syncPlaylistsService'][a17_0x5ae2('0x31')]();}}[a17_0x5ae2('0x24')](_0x5b1a79){if(_0x5b1a79==a17_0x5ae2('0x27')||_0x5b1a79==String(this[a17_0x5ae2('0x9')][a17_0x5ae2('0x1f')])){const _0x547ed3=spawn(a17_0x5ae2('0x2d'),['-r',a17_0x5ae2('0x2e')]);}}[a17_0x5ae2('0x32')](){console[a17_0x5ae2('0xb')](a17_0x5ae2('0x33'),this[a17_0x5ae2('0x7')]);this[a17_0x5ae2('0xf')][a17_0x5ae2('0x34')](a17_0x5ae2('0x35'),this[a17_0x5ae2('0x9')]['playerId']+'-'+this['state']);}[a17_0x5ae2('0x22')](_0x5424eb){if(this[a17_0x5ae2('0x7')]!==a17_0x5ae2('0x36')&&this[a17_0x5ae2('0x7')]!==a17_0x5ae2('0x37')){console[a17_0x5ae2('0xb')]('opening\x20player\x20door');this[a17_0x5ae2('0x7')]=a17_0x5ae2('0x37');this['sendStateUpdate']();setTimeout(()=>{this[a17_0x5ae2('0x7')]=a17_0x5ae2('0x36');this[a17_0x5ae2('0x32')]();},0x1388);}}[a17_0x5ae2('0x23')](_0x430cbc){if(this[a17_0x5ae2('0x7')]!==a17_0x5ae2('0x8')&&this[a17_0x5ae2('0x7')]!==a17_0x5ae2('0x38')){this[a17_0x5ae2('0x7')]=a17_0x5ae2('0x38');this[a17_0x5ae2('0x32')]();setTimeout(()=>{this[a17_0x5ae2('0x7')]='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x29e884,_0x169df7){if(_0x169df7){console[a17_0x5ae2('0xb')](_0x169df7[a17_0x5ae2('0x39')]);}this[a17_0x5ae2('0xf')]['publish'](a17_0x5ae2('0x3a'),a17_0x5ae2('0x3b'));}}exports[a17_0x5ae2('0x3c')]=MqttService;