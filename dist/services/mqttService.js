var a20_0x2397=['player/register','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','syncPlaylistsService','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','sendStateUpdate','player/state','open','opening','closed','closing','stack','readFileSync','sign','MqttService','__esModule','./../infrastructure/HttpClientService','request','request-progress','spawn','child_process','exec','mqtt','state','httpClientService','HttpClientService','init','mqttInit_google','mqttInit','velvety-glazing-252020','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','events','projects/','/registries/','/devices/','unused','createJwt','mqtts','round','now','subscribe','/config','/state','/commands/#','connect','log','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','message','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','toString','ascii','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_message','exit','handleAppExit','bind','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/update_settings','player/turn_off_tv','player/turn_on_tv','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest'];(function(_0x55b0ef,_0x4aa18c){var _0x3a7474=function(_0x1c9328){while(--_0x1c9328){_0x55b0ef['push'](_0x55b0ef['shift']());}};_0x3a7474(++_0x4aa18c);}(a20_0x2397,0xf7));var a20_0x21f2=function(_0x334816,_0x4b737c){_0x334816=_0x334816-0x0;var _0x246ce2=a20_0x2397[_0x334816];return _0x246ce2;};'use strict';Object['defineProperty'](exports,a20_0x21f2('0x0'),{'value':!![]});const HttpClientService_1=require(a20_0x21f2('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0x21f2('0x2'));const progress=require(a20_0x21f2('0x3'));const spawn=require('child_process')[a20_0x21f2('0x4')];const exec=require(a20_0x21f2('0x5'))[a20_0x21f2('0x6')];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require(a20_0x21f2('0x7'));const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x504230){this['syncPlaylistsService']=_0x504230;this[a20_0x21f2('0x8')]='closed';this[a20_0x21f2('0x9')]=new HttpClientService_1[(a20_0x21f2('0xa'))]();}[a20_0x21f2('0xb')](){this['mqttInit_mosquitto']();}[a20_0x21f2('0xc')](){console['log'](a20_0x21f2('0xd'));const _0x3b7053=a20_0x21f2('0xe');const _0x5bd214='my-node-device';const _0x77ea70=a20_0x21f2('0xf');const _0x4601b2=a20_0x21f2('0x10');const _0xde7555=a20_0x21f2('0x11');const _0x18c4f6=a20_0x21f2('0x12');const _0xcd556c='mqtt.googleapis.com';const _0x1670f5=0x1bb;const _0x32267e=a20_0x21f2('0x13');const _0x51ddbd=0x5;const _0x4026b8=a20_0x21f2('0x14')+_0x3b7053+'/locations/'+_0x4601b2+a20_0x21f2('0x15')+_0x77ea70+a20_0x21f2('0x16')+_0x5bd214;const _0xf126e9={'host':_0xcd556c,'port':_0x1670f5,'clientId':_0x4026b8,'username':a20_0x21f2('0x17'),'password':this[a20_0x21f2('0x18')](_0x3b7053,_0x18c4f6,_0xde7555),'protocol':a20_0x21f2('0x19'),'secureProtocol':'TLSv1_2_method'};const _0x49e8dc=Math[a20_0x21f2('0x1a')](Date[a20_0x21f2('0x1b')]()/0x3e8);const _0x3e27a4=mqtt['connect'](_0xf126e9);_0x3e27a4[a20_0x21f2('0x1c')](a20_0x21f2('0x16')+_0x5bd214+a20_0x21f2('0x1d'),{'qos':0x1});_0x3e27a4[a20_0x21f2('0x1c')](a20_0x21f2('0x16')+_0x5bd214+a20_0x21f2('0x1e'),{'qos':0x1});_0x3e27a4[a20_0x21f2('0x1c')](a20_0x21f2('0x16')+_0x5bd214+a20_0x21f2('0x1f'),{'qos':0x0});const _0xb6553b=a20_0x21f2('0x16')+_0x5bd214+'/'+_0x32267e;_0x3e27a4['on'](a20_0x21f2('0x20'),_0x429133=>{console[a20_0x21f2('0x21')]('connect');if(!_0x429133){console[a20_0x21f2('0x21')](a20_0x21f2('0x22'));}else{const _0xb6553b='/projects/velvety-glazing-252020/topics/my-topic';const _0x691360=_0x77ea70+'/'+_0x5bd214+a20_0x21f2('0x23');_0x3e27a4[a20_0x21f2('0x24')](_0xb6553b,_0x691360,{'qos':0x1},_0x31a956=>{console[a20_0x21f2('0x21')](a20_0x21f2('0x25'));console[a20_0x21f2('0x21')](_0x31a956);if(!_0x31a956){}});}});_0x3e27a4['on'](a20_0x21f2('0x26'),()=>{console[a20_0x21f2('0x21')]('close');});_0x3e27a4['on'](a20_0x21f2('0x27'),_0x18b1d5=>{console[a20_0x21f2('0x21')](a20_0x21f2('0x27'),_0x18b1d5);});_0x3e27a4['on'](a20_0x21f2('0x28'),(_0x112c00,_0x5ed536)=>{let _0x44a8cf='Message\x20received:\x20';console[a20_0x21f2('0x21')](_0x112c00);console['log'](_0x5ed536+'');if(_0x112c00==='/devices/'+_0x5bd214+a20_0x21f2('0x1d')){_0x44a8cf=a20_0x21f2('0x29');}else if(_0x112c00[a20_0x21f2('0x2a')]('/devices/'+_0x5bd214+a20_0x21f2('0x2b'))){_0x44a8cf=a20_0x21f2('0x2c');}_0x44a8cf+=Buffer['from'](_0x5ed536,'base64')[a20_0x21f2('0x2d')](a20_0x21f2('0x2e'));console[a20_0x21f2('0x21')](_0x44a8cf);});_0x3e27a4['on']('packetsend',()=>{});console[a20_0x21f2('0x21')](_0xf126e9);}['mqttInit_mosquitto'](){console['log'](a20_0x21f2('0xd'));this['clientId']=uuidv4();console[a20_0x21f2('0x21')](a20_0x21f2('0x2f'));console['log'](this[a20_0x21f2('0x30')]);const _0x161d5b={'clientId':this[a20_0x21f2('0x30')],'username':a20_0x21f2('0x31'),'password':a20_0x21f2('0x32'),'clean':!![]};this['mqttClient']=mqtt['connect'](a20_0x21f2('0x33'),_0x161d5b);this[a20_0x21f2('0x34')]['on'](a20_0x21f2('0x20'),this['mqttClient_connect']['bind'](this));this[a20_0x21f2('0x34')]['on'](a20_0x21f2('0x28'),this[a20_0x21f2('0x35')]['bind'](this));this['mqttClient']['on'](a20_0x21f2('0x26'),()=>{console['log'](a20_0x21f2('0x26'));});process['on'](a20_0x21f2('0x36'),this[a20_0x21f2('0x37')][a20_0x21f2('0x38')](this));process['on'](a20_0x21f2('0x39'),this['handleAppExit'][a20_0x21f2('0x38')](this));process['on'](a20_0x21f2('0x3a'),this['handleAppExit']['bind'](this));}[a20_0x21f2('0x3b')](){console['log'](a20_0x21f2('0x3c')+this[a20_0x21f2('0x30')]);this['mqttClient'][a20_0x21f2('0x1c')](a20_0x21f2('0x3d'));this['mqttClient']['subscribe']('player/close');this[a20_0x21f2('0x34')]['subscribe'](a20_0x21f2('0x3e'),{'qos':0x2});this['mqttClient'][a20_0x21f2('0x1c')](a20_0x21f2('0x3f'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x21f2('0x40'),{'qos':0x2});this['mqttClient'][a20_0x21f2('0x1c')]('player/update',{'qos':0x2});this[a20_0x21f2('0x34')][a20_0x21f2('0x1c')](a20_0x21f2('0x41'),{'qos':0x2});this[a20_0x21f2('0x34')][a20_0x21f2('0x1c')]('player/register',{'qos':0x2});this[a20_0x21f2('0x34')][a20_0x21f2('0x1c')](a20_0x21f2('0x42'),{'qos':0x2});this[a20_0x21f2('0x34')][a20_0x21f2('0x1c')](a20_0x21f2('0x43'),{'qos':0x2});this[a20_0x21f2('0x34')][a20_0x21f2('0x1c')](a20_0x21f2('0x44'),{'qos':0x2});}['reportStatus'](){}[a20_0x21f2('0x35')](_0x2440eb,_0x33e7d2){console['log'](a20_0x21f2('0x45'),_0x2440eb,_0x33e7d2);switch(_0x2440eb){case a20_0x21f2('0x3d'):return this[a20_0x21f2('0x46')](_0x33e7d2);case a20_0x21f2('0x47'):return this[a20_0x21f2('0x48')](_0x33e7d2);case a20_0x21f2('0x3e'):return this['handleRebootRequest'](_0x33e7d2);case a20_0x21f2('0x40'):return this[a20_0x21f2('0x49')](_0x33e7d2);case a20_0x21f2('0x3f'):return this[a20_0x21f2('0x4a')](_0x33e7d2);case'player/update':return this[a20_0x21f2('0x4b')](_0x33e7d2);case a20_0x21f2('0x41'):return this[a20_0x21f2('0x4c')](_0x33e7d2);case a20_0x21f2('0x4d'):return this['handleRegisterRequest'](_0x33e7d2);case a20_0x21f2('0x42'):return this[a20_0x21f2('0x4e')](_0x33e7d2);case'player/turn_off_tv':return this[a20_0x21f2('0x4f')](_0x33e7d2);case a20_0x21f2('0x44'):return this[a20_0x21f2('0x50')](_0x33e7d2);}}['handleRegisterRequest'](_0x503be1){if(_0x503be1==a20_0x21f2('0x51')||_0x503be1==String(this[a20_0x21f2('0x52')][a20_0x21f2('0x53')])){this[a20_0x21f2('0x52')]['registerClient']();}}[a20_0x21f2('0x4c')](_0x263d30){if(_0x263d30=='all'||_0x263d30==String(this[a20_0x21f2('0x52')][a20_0x21f2('0x53')])){}}[a20_0x21f2('0x4b')](_0x9a11ef){console[a20_0x21f2('0x21')](a20_0x21f2('0x54')+_0x9a11ef);if(_0x9a11ef==a20_0x21f2('0x51')||_0x9a11ef==String(this[a20_0x21f2('0x52')]['playerId'])){const _0x2db837=__dirname;const _0x27ab50=require(a20_0x21f2('0x55'))(_0x2db837);console[a20_0x21f2('0x21')](a20_0x21f2('0x56'));_0x27ab50[a20_0x21f2('0x57')]((_0x3385c5,_0x3ec60a)=>{if(_0x3385c5){console['log'](a20_0x21f2('0x58'));this[a20_0x21f2('0x4b')](_0x9a11ef);return;}else{}console[a20_0x21f2('0x21')](a20_0x21f2('0x59'));console[a20_0x21f2('0x21')](_0x3ec60a);if(_0x3ec60a&&_0x3ec60a[a20_0x21f2('0x5a')][a20_0x21f2('0x5b')]){this['syncPlaylistsService'][a20_0x21f2('0x5c')]();}else{}});}}[a20_0x21f2('0x4a')](_0x4cdb54){if(_0x4cdb54=='all'||_0x4cdb54==String(this[a20_0x21f2('0x52')]['playerId'])){this[a20_0x21f2('0x52')]['loadMediaList']();}}[a20_0x21f2('0x49')](_0x279a6b){if(String(_0x279a6b)==a20_0x21f2('0x51')||String(_0x279a6b)==String(this[a20_0x21f2('0x52')]['playerId'])){this[a20_0x21f2('0x52')]['reloadMediaList']();}}['handleRebootRequest'](_0x42a8ef){if(_0x42a8ef==a20_0x21f2('0x51')||_0x42a8ef==String(this[a20_0x21f2('0x52')][a20_0x21f2('0x53')])){console[a20_0x21f2('0x21')](a20_0x21f2('0x5d'));try{this[a20_0x21f2('0x52')][a20_0x21f2('0x5c')]();}catch(_0x1597aa){console[a20_0x21f2('0x21')](_0x1597aa);}}}[a20_0x21f2('0x4e')](_0x2c6795){if(_0x2c6795==a20_0x21f2('0x51')||_0x2c6795==String(this[a20_0x21f2('0x52')][a20_0x21f2('0x53')])){console['log']('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a20_0x21f2('0x5e')]();}catch(_0x3ffa41){console[a20_0x21f2('0x21')](_0x3ffa41);}}}['handleTurnOnTVRequest'](_0x45dd9c){if(_0x45dd9c=='all'||_0x45dd9c==String(this[a20_0x21f2('0x52')][a20_0x21f2('0x53')])){console[a20_0x21f2('0x21')](a20_0x21f2('0x5f'));try{this[a20_0x21f2('0x52')][a20_0x21f2('0x60')]();}catch(_0x36e0c8){console[a20_0x21f2('0x21')](_0x36e0c8);}}}[a20_0x21f2('0x4f')](_0x40d9d1){if(_0x40d9d1=='all'||_0x40d9d1==String(this['syncPlaylistsService']['playerId'])){console['log'](a20_0x21f2('0x61'));try{this['syncPlaylistsService']['turnOffTV']();}catch(_0x2a94ff){console[a20_0x21f2('0x21')](_0x2a94ff);}}}[a20_0x21f2('0x62')](){console['log']('sending\x20state\x20%s',this[a20_0x21f2('0x8')]);this[a20_0x21f2('0x34')][a20_0x21f2('0x24')](a20_0x21f2('0x63'),this['syncPlaylistsService']['playerId']+'-'+this[a20_0x21f2('0x8')]);}[a20_0x21f2('0x46')](_0x5a220f){if(this[a20_0x21f2('0x8')]!==a20_0x21f2('0x64')&&this[a20_0x21f2('0x8')]!=='opening'){console['log']('opening\x20player\x20door');this[a20_0x21f2('0x8')]=a20_0x21f2('0x65');this[a20_0x21f2('0x62')]();setTimeout(()=>{this['state']=a20_0x21f2('0x64');this[a20_0x21f2('0x62')]();},0x1388);}}[a20_0x21f2('0x48')](_0x248d9a){if(this[a20_0x21f2('0x8')]!==a20_0x21f2('0x66')&&this[a20_0x21f2('0x8')]!==a20_0x21f2('0x67')){this[a20_0x21f2('0x8')]=a20_0x21f2('0x67');this[a20_0x21f2('0x62')]();setTimeout(()=>{this[a20_0x21f2('0x8')]=a20_0x21f2('0x66');this[a20_0x21f2('0x62')]();},0x1388);}}[a20_0x21f2('0x37')](_0x57eb5d,_0x21b737){if(_0x21b737){console[a20_0x21f2('0x21')](_0x21b737[a20_0x21f2('0x68')]);}this[a20_0x21f2('0x34')][a20_0x21f2('0x24')]('player/connected','false');}[a20_0x21f2('0x18')](_0xe83d6d,_0x44133d,_0x5f08d9){const _0x3b9450={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math['round'](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0xe83d6d};const _0x50c8b5=fs[a20_0x21f2('0x69')](_0x44133d);return jwt[a20_0x21f2('0x6a')](_0x3b9450,_0x50c8b5,{'algorithm':_0x5f08d9});}}exports[a20_0x21f2('0x6b')]=MqttService;