var a18_0x3e74=['bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','player/reboot','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleUpdateSettingsRequest','handleRegisterRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','pull','Git\x20updated','summary','changes','reboot','loadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','sendStateUpdate','sending\x20state\x20%s','player/state','opening','opening\x20player\x20door','open','closing','stack','false','createJwt','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','child_process','exec','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','mqtts','TLSv1_2_method','round','subscribe','/config','/devices/','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','from','ascii','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run'];(function(_0x7c8e08,_0x293d5f){var _0x532914=function(_0x647ffc){while(--_0x647ffc){_0x7c8e08['push'](_0x7c8e08['shift']());}};_0x532914(++_0x293d5f);}(a18_0x3e74,0xa5));var a18_0x5338=function(_0x16d8de,_0x303431){_0x16d8de=_0x16d8de-0x0;var _0x5ca263=a18_0x3e74[_0x16d8de];return _0x5ca263;};'use strict';Object[a18_0x5338('0x0')](exports,a18_0x5338('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5338('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require('request-progress');const spawn=require(a18_0x5338('0x3'))['spawn'];const exec=require('child_process')[a18_0x5338('0x4')];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require(a18_0x5338('0x5'));const uuidv4=require(a18_0x5338('0x6'));const jwt=require(a18_0x5338('0x7'));class MqttService{constructor(_0x4523f4){this[a18_0x5338('0x8')]=_0x4523f4;this[a18_0x5338('0x9')]=a18_0x5338('0xa');this['httpClientService']=new HttpClientService_1[(a18_0x5338('0xb'))]();}['init'](){this[a18_0x5338('0xc')]();}[a18_0x5338('0xd')](){console[a18_0x5338('0xe')](a18_0x5338('0xf'));const _0xade896='velvety-glazing-252020';const _0x65150a=a18_0x5338('0x10');const _0x5b0d28=a18_0x5338('0x11');const _0x1105bd=a18_0x5338('0x12');const _0x19a651=a18_0x5338('0x13');const _0x360a96=a18_0x5338('0x14');const _0x4a7174=a18_0x5338('0x15');const _0x5a66c8=0x1bb;const _0x47a752=a18_0x5338('0x16');const _0x2251be=0x5;const _0xd88f93=a18_0x5338('0x17')+_0xade896+a18_0x5338('0x18')+_0x1105bd+a18_0x5338('0x19')+_0x5b0d28+'/devices/'+_0x65150a;const _0x3c2ee4={'host':_0x4a7174,'port':_0x5a66c8,'clientId':_0xd88f93,'username':a18_0x5338('0x1a'),'password':this['createJwt'](_0xade896,_0x360a96,_0x19a651),'protocol':a18_0x5338('0x1b'),'secureProtocol':a18_0x5338('0x1c')};const _0x1d2d56=Math[a18_0x5338('0x1d')](Date['now']()/0x3e8);const _0x482ea7=mqtt['connect'](_0x3c2ee4);_0x482ea7[a18_0x5338('0x1e')]('/devices/'+_0x65150a+a18_0x5338('0x1f'),{'qos':0x1});_0x482ea7['subscribe'](a18_0x5338('0x20')+_0x65150a+'/state',{'qos':0x1});_0x482ea7[a18_0x5338('0x1e')](a18_0x5338('0x20')+_0x65150a+a18_0x5338('0x21'),{'qos':0x0});const _0x4758de=a18_0x5338('0x20')+_0x65150a+'/'+_0x47a752;_0x482ea7['on'](a18_0x5338('0x22'),_0x3aa6a8=>{console[a18_0x5338('0xe')]('connect');if(!_0x3aa6a8){console[a18_0x5338('0xe')](a18_0x5338('0x23'));}else{const _0x4758de=a18_0x5338('0x24');const _0x5a4a8b=_0x5b0d28+'/'+_0x65150a+a18_0x5338('0x25');_0x482ea7[a18_0x5338('0x26')](_0x4758de,_0x5a4a8b,{'qos':0x1},_0x5f0b1d=>{console['log'](a18_0x5338('0x27'));console['log'](_0x5f0b1d);if(!_0x5f0b1d){}});}});_0x482ea7['on'](a18_0x5338('0x28'),()=>{console['log']('close');});_0x482ea7['on'](a18_0x5338('0x29'),_0x5a4fe8=>{console['log']('error',_0x5a4fe8);});_0x482ea7['on'](a18_0x5338('0x2a'),(_0x586d90,_0x25bc1b)=>{let _0x540dc0=a18_0x5338('0x2b');console[a18_0x5338('0xe')](_0x586d90);console[a18_0x5338('0xe')](_0x25bc1b+'');if(_0x586d90===a18_0x5338('0x20')+_0x65150a+a18_0x5338('0x1f')){_0x540dc0=a18_0x5338('0x2c');}else if(_0x586d90[a18_0x5338('0x2d')](a18_0x5338('0x20')+_0x65150a+a18_0x5338('0x2e'))){_0x540dc0='Command\x20message\x20received:\x20';}_0x540dc0+=Buffer[a18_0x5338('0x2f')](_0x25bc1b,'base64')['toString'](a18_0x5338('0x30'));console['log'](_0x540dc0);});_0x482ea7['on']('packetsend',()=>{});console['log'](_0x3c2ee4);}[a18_0x5338('0xc')](){console[a18_0x5338('0xe')](a18_0x5338('0xf'));this[a18_0x5338('0x31')]=uuidv4();console[a18_0x5338('0xe')](a18_0x5338('0x32'));console['log'](this[a18_0x5338('0x31')]);const _0x1f1968={'clientId':this[a18_0x5338('0x31')],'username':a18_0x5338('0x33'),'password':a18_0x5338('0x34'),'clean':!![]};this[a18_0x5338('0x35')]=mqtt[a18_0x5338('0x22')](a18_0x5338('0x36'),_0x1f1968);this['mqttClient']['on'](a18_0x5338('0x22'),this['mqttClient_connect'][a18_0x5338('0x37')](this));this[a18_0x5338('0x35')]['on'](a18_0x5338('0x2a'),this[a18_0x5338('0x38')]['bind'](this));this[a18_0x5338('0x35')]['on'](a18_0x5338('0x28'),()=>{console['log']('close');});process['on'](a18_0x5338('0x39'),this[a18_0x5338('0x3a')]['bind'](this));process['on'](a18_0x5338('0x3b'),this[a18_0x5338('0x3a')][a18_0x5338('0x37')](this));process['on'](a18_0x5338('0x3c'),this['handleAppExit'][a18_0x5338('0x37')](this));}[a18_0x5338('0x3d')](){console[a18_0x5338('0xe')](a18_0x5338('0x3e')+this[a18_0x5338('0x31')]);this[a18_0x5338('0x35')][a18_0x5338('0x1e')](a18_0x5338('0x3f'));this[a18_0x5338('0x35')][a18_0x5338('0x1e')]('player/close');this[a18_0x5338('0x35')][a18_0x5338('0x1e')]('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x5338('0x1e')](a18_0x5338('0x40'),{'qos':0x2});this[a18_0x5338('0x35')][a18_0x5338('0x1e')](a18_0x5338('0x41'),{'qos':0x2});this[a18_0x5338('0x35')][a18_0x5338('0x1e')](a18_0x5338('0x42'),{'qos':0x2});this['mqttClient'][a18_0x5338('0x1e')](a18_0x5338('0x43'),{'qos':0x2});this[a18_0x5338('0x35')]['subscribe'](a18_0x5338('0x44'),{'qos':0x2});this[a18_0x5338('0x35')][a18_0x5338('0x1e')](a18_0x5338('0x45'),{'qos':0x2});}[a18_0x5338('0x46')](){}[a18_0x5338('0x38')](_0x574701,_0x20f5c5){console['log'](a18_0x5338('0x47'),_0x574701,_0x20f5c5);switch(_0x574701){case a18_0x5338('0x3f'):return this[a18_0x5338('0x48')](_0x20f5c5);case a18_0x5338('0x49'):return this[a18_0x5338('0x4a')](_0x20f5c5);case a18_0x5338('0x4b'):return this['handleRebootRequest'](_0x20f5c5);case'player/reload_playlist':return this[a18_0x5338('0x4c')](_0x20f5c5);case'player/load_playlist':return this[a18_0x5338('0x4d')](_0x20f5c5);case'player/update':return this[a18_0x5338('0x4e')](_0x20f5c5);case a18_0x5338('0x43'):return this[a18_0x5338('0x4f')](_0x20f5c5);case a18_0x5338('0x44'):return this['handleRegisterRequest'](_0x20f5c5);case a18_0x5338('0x45'):return this[a18_0x5338('0x50')](_0x20f5c5);}}[a18_0x5338('0x51')](_0x5f1d18){if(_0x5f1d18=='all'||_0x5f1d18==String(this[a18_0x5338('0x8')][a18_0x5338('0x52')])){this[a18_0x5338('0x8')][a18_0x5338('0x53')]();}}['handleIfconfigRequest'](_0x2ae227){if(_0x2ae227==a18_0x5338('0x54')||_0x2ae227==String(this[a18_0x5338('0x8')][a18_0x5338('0x52')])){}}['handleUpdateRequest'](_0x50084d){console[a18_0x5338('0xe')](a18_0x5338('0x55')+_0x50084d);if(_0x50084d==a18_0x5338('0x54')||_0x50084d==String(this[a18_0x5338('0x8')][a18_0x5338('0x52')])){const _0x2e3a94=__dirname;const _0x1e638e=require(a18_0x5338('0x56'))(_0x2e3a94);console[a18_0x5338('0xe')]('Git\x20updating');_0x1e638e[a18_0x5338('0x57')]((_0x1fda09,_0x42af67)=>{if(_0x1fda09){console[a18_0x5338('0xe')]('Error\x20git\x20updated');this[a18_0x5338('0x4e')](_0x50084d);return;}else{}console['log'](a18_0x5338('0x58'));console[a18_0x5338('0xe')](_0x42af67);if(_0x42af67&&_0x42af67[a18_0x5338('0x59')][a18_0x5338('0x5a')]){this[a18_0x5338('0x8')][a18_0x5338('0x5b')]();}else{}});}}[a18_0x5338('0x4d')](_0x3903c8){if(_0x3903c8==a18_0x5338('0x54')||_0x3903c8==String(this[a18_0x5338('0x8')]['playerId'])){this['syncPlaylistsService'][a18_0x5338('0x5c')]();}}[a18_0x5338('0x4c')](_0xebe2c7){if(String(_0xebe2c7)==a18_0x5338('0x54')||String(_0xebe2c7)==String(this[a18_0x5338('0x8')][a18_0x5338('0x52')])){this[a18_0x5338('0x8')]['reloadMediaList']();}}[a18_0x5338('0x5d')](_0xd65119){if(_0xd65119==a18_0x5338('0x54')||_0xd65119==String(this[a18_0x5338('0x8')][a18_0x5338('0x52')])){console[a18_0x5338('0xe')](a18_0x5338('0x5e'));try{this[a18_0x5338('0x8')][a18_0x5338('0x5b')]();}catch(_0x17cf69){console[a18_0x5338('0xe')](_0x17cf69);}}}[a18_0x5338('0x50')](_0x3abc00){if(_0x3abc00==a18_0x5338('0x54')||_0x3abc00==String(this['syncPlaylistsService'][a18_0x5338('0x52')])){console[a18_0x5338('0xe')](a18_0x5338('0x5f'));try{this['syncPlaylistsService']['updateSettings']();}catch(_0x185e4b){console[a18_0x5338('0xe')](_0x185e4b);}}}[a18_0x5338('0x60')](){console[a18_0x5338('0xe')](a18_0x5338('0x61'),this[a18_0x5338('0x9')]);this[a18_0x5338('0x35')][a18_0x5338('0x26')](a18_0x5338('0x62'),this[a18_0x5338('0x8')][a18_0x5338('0x52')]+'-'+this[a18_0x5338('0x9')]);}[a18_0x5338('0x48')](_0x13b715){if(this[a18_0x5338('0x9')]!=='open'&&this['state']!==a18_0x5338('0x63')){console[a18_0x5338('0xe')](a18_0x5338('0x64'));this[a18_0x5338('0x9')]=a18_0x5338('0x63');this[a18_0x5338('0x60')]();setTimeout(()=>{this['state']=a18_0x5338('0x65');this[a18_0x5338('0x60')]();},0x1388);}}['handleCloseRequest'](_0x3da10d){if(this[a18_0x5338('0x9')]!=='closed'&&this[a18_0x5338('0x9')]!=='closing'){this[a18_0x5338('0x9')]=a18_0x5338('0x66');this[a18_0x5338('0x60')]();setTimeout(()=>{this[a18_0x5338('0x9')]=a18_0x5338('0xa');this[a18_0x5338('0x60')]();},0x1388);}}[a18_0x5338('0x3a')](_0x3e563a,_0x16187a){if(_0x16187a){console[a18_0x5338('0xe')](_0x16187a[a18_0x5338('0x67')]);}this['mqttClient']['publish']('player/connected',a18_0x5338('0x68'));}[a18_0x5338('0x69')](_0x5f47f3,_0x1236f7,_0xf3013d){const _0x395cdc={'iat':Math[a18_0x5338('0x1d')](Date[a18_0x5338('0x6a')]()/0x3e8),'exp':Math[a18_0x5338('0x1d')](Date[a18_0x5338('0x6a')]()/0x3e8)+0x14*0x3c,'aud':_0x5f47f3};const _0x5c9e4f=fs[a18_0x5338('0x6b')](_0x1236f7);return jwt[a18_0x5338('0x6c')](_0x395cdc,_0x5c9e4f,{'algorithm':_0xf3013d});}}exports[a18_0x5338('0x6d')]=MqttService;