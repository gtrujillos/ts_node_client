var a18_0x4e1a=['false','now','readFileSync','sign','MqttService','defineProperty','__esModule','fs-extra','request','request-progress','child_process','spawn','is-image','string-template','state','closed','httpClientService','HttpClientService','init','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','connect','subscribe','/devices/','/config','/state','/commands/#','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','toString','mqttInit_mosquitto','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','player/open','player/close','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','handleOpenRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','player/turn_on_tv','handleTurnOnTVRequest','player/turn_off_tv','handleTurnOffTVRequest','all','syncPlaylistsService','registerClient','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','reset','hard','reset\x20err:','clean\x20result:','Git\x20updated','summary','Git\x20no\x20changes','loadMediaList','reloadMediaList','handleTurnOffTVRequest:\x20','handleTurnOnTVRequest:\x20','turnOnTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening\x20player\x20door','opening','closing','stack','player/connected'];(function(_0x2a4618,_0x5f25cb){var _0x4fac08=function(_0x2ca69b){while(--_0x2ca69b){_0x2a4618['push'](_0x2a4618['shift']());}};_0x4fac08(++_0x5f25cb);}(a18_0x4e1a,0x16a));var a18_0x5c55=function(_0x9f90be,_0x3f6233){_0x9f90be=_0x9f90be-0x0;var _0x43cdb1=a18_0x4e1a[_0x9f90be];return _0x43cdb1;};'use strict';Object[a18_0x5c55('0x0')](exports,a18_0x5c55('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x5c55('0x2'));const request=require(a18_0x5c55('0x3'));const progress=require(a18_0x5c55('0x4'));const spawn=require(a18_0x5c55('0x5'))[a18_0x5c55('0x6')];const exec=require(a18_0x5c55('0x5'))['exec'];const isImage=require(a18_0x5c55('0x7'));const format=require(a18_0x5c55('0x8'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1e4821){this['syncPlaylistsService']=_0x1e4821;this[a18_0x5c55('0x9')]=a18_0x5c55('0xa');this[a18_0x5c55('0xb')]=new HttpClientService_1[(a18_0x5c55('0xc'))]();}[a18_0x5c55('0xd')](){this['mqttInit_mosquitto']();}[a18_0x5c55('0xe')](){console[a18_0x5c55('0xf')](a18_0x5c55('0x10'));const _0x398250=a18_0x5c55('0x11');const _0x4fbba7=a18_0x5c55('0x12');const _0xda4eb1=a18_0x5c55('0x13');const _0x543187=a18_0x5c55('0x14');const _0x3c37f2=a18_0x5c55('0x15');const _0x236682='resources/keys/rsa_private.pem';const _0x296177=a18_0x5c55('0x16');const _0x231609=0x1bb;const _0x2e6175=a18_0x5c55('0x17');const _0x3542f9=0x5;const _0x1a4ea3=a18_0x5c55('0x18')+_0x398250+a18_0x5c55('0x19')+_0x543187+a18_0x5c55('0x1a')+_0xda4eb1+'/devices/'+_0x4fbba7;const _0x4abddc={'host':_0x296177,'port':_0x231609,'clientId':_0x1a4ea3,'username':a18_0x5c55('0x1b'),'password':this[a18_0x5c55('0x1c')](_0x398250,_0x236682,_0x3c37f2),'protocol':a18_0x5c55('0x1d'),'secureProtocol':a18_0x5c55('0x1e')};const _0x4bc8e2=Math[a18_0x5c55('0x1f')](Date['now']()/0x3e8);const _0x1eb205=mqtt[a18_0x5c55('0x20')](_0x4abddc);_0x1eb205[a18_0x5c55('0x21')](a18_0x5c55('0x22')+_0x4fbba7+a18_0x5c55('0x23'),{'qos':0x1});_0x1eb205[a18_0x5c55('0x21')](a18_0x5c55('0x22')+_0x4fbba7+a18_0x5c55('0x24'),{'qos':0x1});_0x1eb205[a18_0x5c55('0x21')](a18_0x5c55('0x22')+_0x4fbba7+a18_0x5c55('0x25'),{'qos':0x0});const _0x1100d6=a18_0x5c55('0x22')+_0x4fbba7+'/'+_0x2e6175;_0x1eb205['on'](a18_0x5c55('0x20'),_0x19e31a=>{console[a18_0x5c55('0xf')](a18_0x5c55('0x20'));if(!_0x19e31a){console[a18_0x5c55('0xf')]('Client\x20not\x20connected...');}else{const _0x1100d6=a18_0x5c55('0x26');const _0x10bff3=_0xda4eb1+'/'+_0x4fbba7+a18_0x5c55('0x27');_0x1eb205[a18_0x5c55('0x28')](_0x1100d6,_0x10bff3,{'qos':0x1},_0x46330e=>{console[a18_0x5c55('0xf')]('publish\x20result:');console[a18_0x5c55('0xf')](_0x46330e);if(!_0x46330e){}});}});_0x1eb205['on']('close',()=>{console[a18_0x5c55('0xf')](a18_0x5c55('0x29'));});_0x1eb205['on'](a18_0x5c55('0x2a'),_0x5d815a=>{console['log'](a18_0x5c55('0x2a'),_0x5d815a);});_0x1eb205['on']('message',(_0x2fec09,_0xd6185a)=>{let _0x4924cd=a18_0x5c55('0x2b');console[a18_0x5c55('0xf')](_0x2fec09);console[a18_0x5c55('0xf')](_0xd6185a+'');if(_0x2fec09===a18_0x5c55('0x22')+_0x4fbba7+'/config'){_0x4924cd=a18_0x5c55('0x2c');}else if(_0x2fec09[a18_0x5c55('0x2d')](a18_0x5c55('0x22')+_0x4fbba7+a18_0x5c55('0x2e'))){_0x4924cd=a18_0x5c55('0x2f');}_0x4924cd+=Buffer[a18_0x5c55('0x30')](_0xd6185a,'base64')[a18_0x5c55('0x31')]('ascii');console[a18_0x5c55('0xf')](_0x4924cd);});_0x1eb205['on']('packetsend',()=>{});console[a18_0x5c55('0xf')](_0x4abddc);}[a18_0x5c55('0x32')](){console[a18_0x5c55('0xf')](a18_0x5c55('0x10'));this[a18_0x5c55('0x33')]=uuidv4();console['log'](a18_0x5c55('0x34'));console[a18_0x5c55('0xf')](this['clientId']);const _0x3eee55={'clientId':this[a18_0x5c55('0x33')],'username':a18_0x5c55('0x35'),'password':a18_0x5c55('0x36'),'clean':!![]};this[a18_0x5c55('0x37')]=mqtt[a18_0x5c55('0x20')](a18_0x5c55('0x38'),_0x3eee55);this[a18_0x5c55('0x37')]['on']('connect',this[a18_0x5c55('0x39')][a18_0x5c55('0x3a')](this));this[a18_0x5c55('0x37')]['on'](a18_0x5c55('0x3b'),this[a18_0x5c55('0x3c')]['bind'](this));this['mqttClient']['on'](a18_0x5c55('0x29'),()=>{console[a18_0x5c55('0xf')](a18_0x5c55('0x29'));});process['on'](a18_0x5c55('0x3d'),this['handleAppExit'][a18_0x5c55('0x3a')](this));process['on'](a18_0x5c55('0x3e'),this[a18_0x5c55('0x3f')]['bind'](this));process['on'](a18_0x5c55('0x40'),this[a18_0x5c55('0x3f')][a18_0x5c55('0x3a')](this));}[a18_0x5c55('0x39')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x5c55('0x33')]);this[a18_0x5c55('0x37')][a18_0x5c55('0x21')](a18_0x5c55('0x41'));this[a18_0x5c55('0x37')]['subscribe'](a18_0x5c55('0x42'));this[a18_0x5c55('0x37')][a18_0x5c55('0x21')]('player/reboot',{'qos':0x2});this[a18_0x5c55('0x37')][a18_0x5c55('0x21')]('player/load_playlist',{'qos':0x2});this['mqttClient']['subscribe'](a18_0x5c55('0x43'),{'qos':0x2});this[a18_0x5c55('0x37')][a18_0x5c55('0x21')](a18_0x5c55('0x44'),{'qos':0x2});this[a18_0x5c55('0x37')][a18_0x5c55('0x21')](a18_0x5c55('0x45'),{'qos':0x2});this[a18_0x5c55('0x37')]['subscribe'](a18_0x5c55('0x46'),{'qos':0x2});this[a18_0x5c55('0x37')][a18_0x5c55('0x21')](a18_0x5c55('0x47'),{'qos':0x2});}['reportStatus'](){}[a18_0x5c55('0x3c')](_0x46b9cf,_0x14aee4){console['log']('received\x20message\x20%s\x20%s',_0x46b9cf,_0x14aee4);switch(_0x46b9cf){case a18_0x5c55('0x41'):return this[a18_0x5c55('0x48')](_0x14aee4);case'player/close':return this['handleCloseRequest'](_0x14aee4);case a18_0x5c55('0x49'):return this[a18_0x5c55('0x4a')](_0x14aee4);case a18_0x5c55('0x43'):return this[a18_0x5c55('0x4b')](_0x14aee4);case a18_0x5c55('0x4c'):return this[a18_0x5c55('0x4d')](_0x14aee4);case a18_0x5c55('0x44'):return this[a18_0x5c55('0x4e')](_0x14aee4);case'player/ifconfig':return this[a18_0x5c55('0x4f')](_0x14aee4);case'player/register':return this[a18_0x5c55('0x50')](_0x14aee4);case a18_0x5c55('0x47'):return this[a18_0x5c55('0x51')](_0x14aee4);case a18_0x5c55('0x52'):return this[a18_0x5c55('0x53')](_0x14aee4);case a18_0x5c55('0x54'):return this[a18_0x5c55('0x55')](_0x14aee4);}}[a18_0x5c55('0x50')](_0x53747f){if(_0x53747f==a18_0x5c55('0x56')||_0x53747f==String(this[a18_0x5c55('0x57')]['playerId'])){this['syncPlaylistsService'][a18_0x5c55('0x58')]();}}[a18_0x5c55('0x4f')](_0x23be14){if(_0x23be14==a18_0x5c55('0x56')||_0x23be14==String(this[a18_0x5c55('0x57')][a18_0x5c55('0x59')])){}}[a18_0x5c55('0x4e')](_0x3fb98b){console[a18_0x5c55('0xf')](a18_0x5c55('0x5a')+_0x3fb98b);if(_0x3fb98b==a18_0x5c55('0x56')||_0x3fb98b==String(this['syncPlaylistsService'][a18_0x5c55('0x59')])){const _0x2f209b=__dirname;const _0x3588fa=require(a18_0x5c55('0x5b'))(_0x2f209b);console[a18_0x5c55('0xf')](a18_0x5c55('0x5c'));_0x3588fa[a18_0x5c55('0x5d')](a18_0x5c55('0x5e'),(_0x1aa8ec,_0x263d0d)=>{console[a18_0x5c55('0xf')](a18_0x5c55('0x5f')+_0x1aa8ec);_0x3588fa['clean']('f',(_0x1aa8ec,_0x263d0d)=>{console[a18_0x5c55('0xf')](a18_0x5c55('0x60')+_0x1aa8ec);_0x3588fa['pull']((_0x1aa8ec,_0x241130)=>{if(_0x1aa8ec){console[a18_0x5c55('0xf')]('Error\x20git\x20updated');this[a18_0x5c55('0x4e')](_0x3fb98b);return;}else{}console['log'](a18_0x5c55('0x61'));console[a18_0x5c55('0xf')](_0x241130);if(_0x241130&&_0x241130[a18_0x5c55('0x62')]['changes']){this[a18_0x5c55('0x57')]['reboot']();}else{console[a18_0x5c55('0xf')](a18_0x5c55('0x63'));}});});});}}[a18_0x5c55('0x4d')](_0x42a821){if(_0x42a821==a18_0x5c55('0x56')||_0x42a821==String(this['syncPlaylistsService']['playerId'])){this[a18_0x5c55('0x57')][a18_0x5c55('0x64')]();}}[a18_0x5c55('0x4b')](_0x39509c){if(String(_0x39509c)==a18_0x5c55('0x56')||String(_0x39509c)==String(this[a18_0x5c55('0x57')][a18_0x5c55('0x59')])){this[a18_0x5c55('0x57')][a18_0x5c55('0x65')]();}}['handleRebootRequest'](_0x56b754){if(_0x56b754==a18_0x5c55('0x56')||_0x56b754==String(this[a18_0x5c55('0x57')][a18_0x5c55('0x59')])){console[a18_0x5c55('0xf')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a18_0x5c55('0x57')]['reboot']();}catch(_0x2b08f3){console['log'](_0x2b08f3);}}}[a18_0x5c55('0x51')](_0x4a96c5){if(_0x4a96c5==a18_0x5c55('0x56')||_0x4a96c5==String(this['syncPlaylistsService']['playerId'])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a18_0x5c55('0x57')]['updateSettings']();}catch(_0xe3b929){console['log'](_0xe3b929);}}}[a18_0x5c55('0x55')](_0x21714f){if(_0x21714f==a18_0x5c55('0x56')||_0x21714f==String(this[a18_0x5c55('0x57')][a18_0x5c55('0x59')])){console['log'](a18_0x5c55('0x66'));try{this[a18_0x5c55('0x57')]['turnOffTV']();}catch(_0x447612){console[a18_0x5c55('0xf')](_0x447612);}}}[a18_0x5c55('0x53')](_0x201de9){if(_0x201de9==a18_0x5c55('0x56')||_0x201de9==String(this['syncPlaylistsService'][a18_0x5c55('0x59')])){console[a18_0x5c55('0xf')](a18_0x5c55('0x67'));try{this[a18_0x5c55('0x57')][a18_0x5c55('0x68')]();}catch(_0x135d45){console['log'](_0x135d45);}}}[a18_0x5c55('0x69')](){console[a18_0x5c55('0xf')](a18_0x5c55('0x6a'),this[a18_0x5c55('0x9')]);this[a18_0x5c55('0x37')][a18_0x5c55('0x28')](a18_0x5c55('0x6b'),this[a18_0x5c55('0x57')][a18_0x5c55('0x59')]+'-'+this[a18_0x5c55('0x9')]);}['handleOpenRequest'](_0x51f016){if(this['state']!==a18_0x5c55('0x6c')&&this[a18_0x5c55('0x9')]!=='opening'){console[a18_0x5c55('0xf')](a18_0x5c55('0x6d'));this[a18_0x5c55('0x9')]=a18_0x5c55('0x6e');this[a18_0x5c55('0x69')]();setTimeout(()=>{this[a18_0x5c55('0x9')]=a18_0x5c55('0x6c');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x3a6791){if(this['state']!=='closed'&&this[a18_0x5c55('0x9')]!==a18_0x5c55('0x6f')){this[a18_0x5c55('0x9')]=a18_0x5c55('0x6f');this[a18_0x5c55('0x69')]();setTimeout(()=>{this[a18_0x5c55('0x9')]='closed';this['sendStateUpdate']();},0x1388);}}[a18_0x5c55('0x3f')](_0xb03a38,_0x58e65f){if(_0x58e65f){console[a18_0x5c55('0xf')](_0x58e65f[a18_0x5c55('0x70')]);}this[a18_0x5c55('0x37')]['publish'](a18_0x5c55('0x71'),a18_0x5c55('0x72'));}[a18_0x5c55('0x1c')](_0x3505aa,_0xcf3c73,_0x367676){const _0x5c2c31={'iat':Math[a18_0x5c55('0x1f')](Date['now']()/0x3e8),'exp':Math['round'](Date[a18_0x5c55('0x73')]()/0x3e8)+0x14*0x3c,'aud':_0x3505aa};const _0x160380=fs[a18_0x5c55('0x74')](_0xcf3c73);return jwt[a18_0x5c55('0x75')](_0x5c2c31,_0x160380,{'algorithm':_0x367676});}}exports[a18_0x5c55('0x76')]=MqttService;