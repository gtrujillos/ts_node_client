var a18_0x24f3=['mqttInit','clientId','log','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','handleAppExit','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/reboot','player/load_playlist','player/update','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','playerId','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','all','loadMediaList','sendStateUpdate','state','publish','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','string-template','mqtt','syncPlaylistsService','closed','httpClientService','HttpClientService'];(function(_0x2f1508,_0x2aef15){var _0x2a6b75=function(_0x599afe){while(--_0x599afe){_0x2f1508['push'](_0x2f1508['shift']());}};_0x2a6b75(++_0x2aef15);}(a18_0x24f3,0x1a6));var a18_0x3ecb=function(_0x263f60,_0x577f4a){_0x263f60=_0x263f60-0x0;var _0x44eb17=a18_0x24f3[_0x263f60];return _0x44eb17;};'use strict';Object[a18_0x3ecb('0x0')](exports,a18_0x3ecb('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x3ecb('0x2'));const fs=require('fs');const fsExtra=require(a18_0x3ecb('0x3'));const request=require(a18_0x3ecb('0x4'));const progress=require('request-progress');const spawn=require(a18_0x3ecb('0x5'))['spawn'];const isImage=require('is-image');const format=require(a18_0x3ecb('0x6'));const os=require('os');const mqtt=require(a18_0x3ecb('0x7'));const uuidv4=require('uuid/v4');class MqttService{constructor(_0x46bbf6){this[a18_0x3ecb('0x8')]=_0x46bbf6;this['state']=a18_0x3ecb('0x9');this[a18_0x3ecb('0xa')]=new HttpClientService_1[(a18_0x3ecb('0xb'))]();}['init'](){this[a18_0x3ecb('0xc')]();}[a18_0x3ecb('0xc')](){console['log'](a18_0x3ecb('0xc'));this[a18_0x3ecb('0xd')]=uuidv4();console[a18_0x3ecb('0xe')](a18_0x3ecb('0xf'));console[a18_0x3ecb('0xe')](this[a18_0x3ecb('0xd')]);const _0x437ea0={'clientId':this[a18_0x3ecb('0xd')],'username':a18_0x3ecb('0x10'),'password':a18_0x3ecb('0x11'),'clean':!![]};this[a18_0x3ecb('0x12')]=mqtt['connect'](a18_0x3ecb('0x13'),_0x437ea0);this[a18_0x3ecb('0x12')]['on']('connect',this[a18_0x3ecb('0x14')][a18_0x3ecb('0x15')](this));this[a18_0x3ecb('0x12')]['on'](a18_0x3ecb('0x16'),this[a18_0x3ecb('0x17')][a18_0x3ecb('0x15')](this));process['on']('exit',this[a18_0x3ecb('0x18')]['bind'](this));process['on']('SIGINT',this[a18_0x3ecb('0x18')][a18_0x3ecb('0x15')](this));process['on']('uncaughtException',this['handleAppExit'][a18_0x3ecb('0x15')](this));}[a18_0x3ecb('0x14')](){console[a18_0x3ecb('0xe')](a18_0x3ecb('0x19')+this['clientId']);this[a18_0x3ecb('0x12')][a18_0x3ecb('0x1a')](a18_0x3ecb('0x1b'));this[a18_0x3ecb('0x12')][a18_0x3ecb('0x1a')]('player/close');this[a18_0x3ecb('0x12')][a18_0x3ecb('0x1a')](a18_0x3ecb('0x1c'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x3ecb('0x1d'),{'qos':0x2});this[a18_0x3ecb('0x12')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x3ecb('0x12')][a18_0x3ecb('0x1a')](a18_0x3ecb('0x1e'),{'qos':0x2});}[a18_0x3ecb('0x1f')](){}[a18_0x3ecb('0x17')](_0x312d6f,_0x3b5fa4){console[a18_0x3ecb('0xe')](a18_0x3ecb('0x20'),_0x312d6f,_0x3b5fa4);switch(_0x312d6f){case a18_0x3ecb('0x1b'):return this[a18_0x3ecb('0x21')](_0x3b5fa4);case'player/close':return this[a18_0x3ecb('0x22')](_0x3b5fa4);case a18_0x3ecb('0x1c'):return this[a18_0x3ecb('0x23')](_0x3b5fa4);case a18_0x3ecb('0x24'):return this[a18_0x3ecb('0x25')](_0x3b5fa4);case a18_0x3ecb('0x1d'):return this[a18_0x3ecb('0x26')](_0x3b5fa4);case a18_0x3ecb('0x1e'):return this[a18_0x3ecb('0x27')](_0x3b5fa4);}}['handleUpdateRequest'](_0x314570){if(_0x314570=='all'||_0x314570==String(this['syncPlaylistsService'][a18_0x3ecb('0x28')])){const _0x2a5271=__dirname;const _0x21135f=require(a18_0x3ecb('0x29'))(_0x2a5271);console[a18_0x3ecb('0xe')](a18_0x3ecb('0x2a'));_0x21135f[a18_0x3ecb('0x2b')]((_0x4dab6a,_0x45d789)=>{if(_0x4dab6a){console[a18_0x3ecb('0xe')](a18_0x3ecb('0x2c'));this[a18_0x3ecb('0x27')](_0x314570);return;}else{}console[a18_0x3ecb('0xe')](a18_0x3ecb('0x2d'));console['log'](_0x45d789);if(_0x45d789&&_0x45d789[a18_0x3ecb('0x2e')][a18_0x3ecb('0x2f')]){const _0x2d1afe=spawn(a18_0x3ecb('0x30'),['-r',a18_0x3ecb('0x31')]);}else{}});}}[a18_0x3ecb('0x26')](_0x147da3){if(_0x147da3==a18_0x3ecb('0x32')||_0x147da3==String(this[a18_0x3ecb('0x8')][a18_0x3ecb('0x28')])){this[a18_0x3ecb('0x8')][a18_0x3ecb('0x33')]();}}[a18_0x3ecb('0x25')](_0x5ed8dc){if(String(_0x5ed8dc)==a18_0x3ecb('0x32')||String(_0x5ed8dc)==String(this[a18_0x3ecb('0x8')][a18_0x3ecb('0x28')])){this[a18_0x3ecb('0x8')]['reloadMediaList']();}}[a18_0x3ecb('0x23')](_0x3e2eca){if(_0x3e2eca=='all'||_0x3e2eca==String(this[a18_0x3ecb('0x8')][a18_0x3ecb('0x28')])){const _0x4839e0=spawn(a18_0x3ecb('0x30'),['-r',a18_0x3ecb('0x31')]);}}[a18_0x3ecb('0x34')](){console['log']('sending\x20state\x20%s',this[a18_0x3ecb('0x35')]);this[a18_0x3ecb('0x12')][a18_0x3ecb('0x36')](a18_0x3ecb('0x37'),this[a18_0x3ecb('0x8')][a18_0x3ecb('0x28')]+'-'+this[a18_0x3ecb('0x35')]);}[a18_0x3ecb('0x21')](_0x527a2f){if(this[a18_0x3ecb('0x35')]!==a18_0x3ecb('0x38')&&this[a18_0x3ecb('0x35')]!==a18_0x3ecb('0x39')){console[a18_0x3ecb('0xe')](a18_0x3ecb('0x3a'));this[a18_0x3ecb('0x35')]='opening';this[a18_0x3ecb('0x34')]();setTimeout(()=>{this[a18_0x3ecb('0x35')]='open';this[a18_0x3ecb('0x34')]();},0x1388);}}[a18_0x3ecb('0x22')](_0x12ccf8){if(this[a18_0x3ecb('0x35')]!=='closed'&&this[a18_0x3ecb('0x35')]!==a18_0x3ecb('0x3b')){this[a18_0x3ecb('0x35')]=a18_0x3ecb('0x3b');this[a18_0x3ecb('0x34')]();setTimeout(()=>{this[a18_0x3ecb('0x35')]=a18_0x3ecb('0x9');this[a18_0x3ecb('0x34')]();},0x1388);}}['handleAppExit'](_0x232e6f,_0x40aa87){if(_0x40aa87){console[a18_0x3ecb('0xe')](_0x40aa87[a18_0x3ecb('0x3c')]);}this[a18_0x3ecb('0x12')]['publish'](a18_0x3ecb('0x3d'),'false');}}exports['MqttService']=MqttService;