var a18_0x37d2=['resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish\x20result:','close','Message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','base64','ascii','mqttInit_mosquitto','clientId','lulo_mqtt','mqttClient','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/reboot','player/load_playlist','player/ifconfig','player/register','player/update_settings','reportStatus','received\x20message\x20%s\x20%s','player/open','handleCloseRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','all','playerId','Git\x20updating','Error\x20git\x20updated','Git\x20updated','changes','reboot','handleLoadPlaylistRequest','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','sending\x20state\x20%s','state','handleOpenRequest','open','opening','sendStateUpdate','closing','stack','publish','player/connected','readFileSync','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','closed','HttpClientService','mqttInit','velvety-glazing-252020','us-central1','RS256'];(function(_0x55326c,_0x53efc9){var _0x477bf2=function(_0x57df90){while(--_0x57df90){_0x55326c['push'](_0x55326c['shift']());}};_0x477bf2(++_0x53efc9);}(a18_0x37d2,0xb3));var a18_0x5bcc=function(_0x192d6c,_0x25eca6){_0x192d6c=_0x192d6c-0x0;var _0x4e0b46=a18_0x37d2[_0x192d6c];return _0x4e0b46;};'use strict';Object[a18_0x5bcc('0x0')](exports,a18_0x5bcc('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5bcc('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x5bcc('0x3'));const progress=require(a18_0x5bcc('0x4'));const spawn=require(a18_0x5bcc('0x5'))[a18_0x5bcc('0x6')];const exec=require(a18_0x5bcc('0x5'))['exec'];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require(a18_0x5bcc('0x7'));const uuidv4=require(a18_0x5bcc('0x8'));const jwt=require(a18_0x5bcc('0x9'));class MqttService{constructor(_0x3bac1e){this[a18_0x5bcc('0xa')]=_0x3bac1e;this['state']=a18_0x5bcc('0xb');this['httpClientService']=new HttpClientService_1[(a18_0x5bcc('0xc'))]();}['init'](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console['log'](a18_0x5bcc('0xd'));const _0x323347=a18_0x5bcc('0xe');const _0x57808b='my-node-device';const _0x3cf19f='my-registry';const _0x596bed=a18_0x5bcc('0xf');const _0x4b099b=a18_0x5bcc('0x10');const _0xea03ec=a18_0x5bcc('0x11');const _0x18380d=a18_0x5bcc('0x12');const _0x5c2171=0x1bb;const _0x596acb=a18_0x5bcc('0x13');const _0x44bc0c=0x5;const _0xeec402=a18_0x5bcc('0x14')+_0x323347+'/locations/'+_0x596bed+'/registries/'+_0x3cf19f+a18_0x5bcc('0x15')+_0x57808b;const _0x973fc2={'host':_0x18380d,'port':_0x5c2171,'clientId':_0xeec402,'username':a18_0x5bcc('0x16'),'password':this[a18_0x5bcc('0x17')](_0x323347,_0xea03ec,_0x4b099b),'protocol':a18_0x5bcc('0x18'),'secureProtocol':a18_0x5bcc('0x19')};const _0x262de7=Math[a18_0x5bcc('0x1a')](Date[a18_0x5bcc('0x1b')]()/0x3e8);const _0x4fd057=mqtt[a18_0x5bcc('0x1c')](_0x973fc2);_0x4fd057[a18_0x5bcc('0x1d')](a18_0x5bcc('0x15')+_0x57808b+a18_0x5bcc('0x1e'),{'qos':0x1});_0x4fd057[a18_0x5bcc('0x1d')]('/devices/'+_0x57808b+a18_0x5bcc('0x1f'),{'qos':0x1});_0x4fd057[a18_0x5bcc('0x1d')](a18_0x5bcc('0x15')+_0x57808b+a18_0x5bcc('0x20'),{'qos':0x0});const _0x3de1e6=a18_0x5bcc('0x15')+_0x57808b+'/'+_0x596acb;_0x4fd057['on']('connect',_0x6889ca=>{console[a18_0x5bcc('0x21')](a18_0x5bcc('0x1c'));if(!_0x6889ca){console[a18_0x5bcc('0x21')](a18_0x5bcc('0x22'));}else{const _0x3de1e6=a18_0x5bcc('0x23');const _0x5232d5=_0x3cf19f+'/'+_0x57808b+a18_0x5bcc('0x24');_0x4fd057['publish'](_0x3de1e6,_0x5232d5,{'qos':0x1},_0x5aa994=>{console[a18_0x5bcc('0x21')](a18_0x5bcc('0x25'));console['log'](_0x5aa994);if(!_0x5aa994){}});}});_0x4fd057['on'](a18_0x5bcc('0x26'),()=>{console[a18_0x5bcc('0x21')](a18_0x5bcc('0x26'));});_0x4fd057['on']('error',_0x412505=>{console[a18_0x5bcc('0x21')]('error',_0x412505);});_0x4fd057['on']('message',(_0x5a7bc1,_0x3869d6)=>{let _0x4eb3fb=a18_0x5bcc('0x27');console[a18_0x5bcc('0x21')](_0x5a7bc1);console['log'](_0x3869d6+'');if(_0x5a7bc1==='/devices/'+_0x57808b+a18_0x5bcc('0x1e')){_0x4eb3fb='Config\x20message\x20received:\x20';}else if(_0x5a7bc1[a18_0x5bcc('0x28')](a18_0x5bcc('0x15')+_0x57808b+'/commands')){_0x4eb3fb=a18_0x5bcc('0x29');}_0x4eb3fb+=Buffer[a18_0x5bcc('0x2a')](_0x3869d6,a18_0x5bcc('0x2b'))['toString'](a18_0x5bcc('0x2c'));console[a18_0x5bcc('0x21')](_0x4eb3fb);});_0x4fd057['on']('packetsend',()=>{});console[a18_0x5bcc('0x21')](_0x973fc2);}[a18_0x5bcc('0x2d')](){console['log'](a18_0x5bcc('0xd'));this[a18_0x5bcc('0x2e')]=uuidv4();console[a18_0x5bcc('0x21')]('this.clientId');console[a18_0x5bcc('0x21')](this[a18_0x5bcc('0x2e')]);const _0x12aa8d={'clientId':this[a18_0x5bcc('0x2e')],'username':a18_0x5bcc('0x2f'),'password':'run.lulo_2018#.','clean':!![]};this['mqttClient']=mqtt[a18_0x5bcc('0x1c')]('mqtt://lulo.run',_0x12aa8d);this[a18_0x5bcc('0x30')]['on'](a18_0x5bcc('0x1c'),this['mqttClient_connect'][a18_0x5bcc('0x31')](this));this['mqttClient']['on'](a18_0x5bcc('0x32'),this[a18_0x5bcc('0x33')][a18_0x5bcc('0x31')](this));this[a18_0x5bcc('0x30')]['on'](a18_0x5bcc('0x26'),()=>{console['log'](a18_0x5bcc('0x26'));});process['on'](a18_0x5bcc('0x34'),this[a18_0x5bcc('0x35')]['bind'](this));process['on'](a18_0x5bcc('0x36'),this[a18_0x5bcc('0x35')][a18_0x5bcc('0x31')](this));process['on'](a18_0x5bcc('0x37'),this[a18_0x5bcc('0x35')]['bind'](this));}[a18_0x5bcc('0x38')](){console[a18_0x5bcc('0x21')](a18_0x5bcc('0x39')+this[a18_0x5bcc('0x2e')]);this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')]('player/open');this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')]('player/close');this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')](a18_0x5bcc('0x3a'),{'qos':0x2});this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')](a18_0x5bcc('0x3b'),{'qos':0x2});this['mqttClient'][a18_0x5bcc('0x1d')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x5bcc('0x1d')]('player/update',{'qos':0x2});this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')](a18_0x5bcc('0x3c'),{'qos':0x2});this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')](a18_0x5bcc('0x3d'),{'qos':0x2});this[a18_0x5bcc('0x30')][a18_0x5bcc('0x1d')](a18_0x5bcc('0x3e'),{'qos':0x2});}[a18_0x5bcc('0x3f')](){}['mqttClient_message'](_0x4105a1,_0x3024c2){console['log'](a18_0x5bcc('0x40'),_0x4105a1,_0x3024c2);switch(_0x4105a1){case a18_0x5bcc('0x41'):return this['handleOpenRequest'](_0x3024c2);case'player/close':return this[a18_0x5bcc('0x42')](_0x3024c2);case a18_0x5bcc('0x3a'):return this['handleRebootRequest'](_0x3024c2);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x3024c2);case a18_0x5bcc('0x3b'):return this['handleLoadPlaylistRequest'](_0x3024c2);case a18_0x5bcc('0x43'):return this[a18_0x5bcc('0x44')](_0x3024c2);case'player/ifconfig':return this[a18_0x5bcc('0x45')](_0x3024c2);case a18_0x5bcc('0x3d'):return this[a18_0x5bcc('0x46')](_0x3024c2);case a18_0x5bcc('0x3e'):return this[a18_0x5bcc('0x47')](_0x3024c2);}}[a18_0x5bcc('0x46')](_0x3c2fb4){if(_0x3c2fb4==a18_0x5bcc('0x48')||_0x3c2fb4==String(this['syncPlaylistsService'][a18_0x5bcc('0x49')])){this[a18_0x5bcc('0xa')]['registerClient']();}}[a18_0x5bcc('0x45')](_0x1f9475){if(_0x1f9475=='all'||_0x1f9475==String(this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')])){}}['handleUpdateRequest'](_0x178e39){console[a18_0x5bcc('0x21')]('handleUpdateRequest:\x20'+_0x178e39);if(_0x178e39==a18_0x5bcc('0x48')||_0x178e39==String(this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')])){const _0x2aca83=__dirname;const _0x4e0d38=require('simple-git')(_0x2aca83);console['log'](a18_0x5bcc('0x4a'));_0x4e0d38['pull']((_0x4ae37b,_0x137711)=>{if(_0x4ae37b){console[a18_0x5bcc('0x21')](a18_0x5bcc('0x4b'));this['handleUpdateRequest'](_0x178e39);return;}else{}console[a18_0x5bcc('0x21')](a18_0x5bcc('0x4c'));console[a18_0x5bcc('0x21')](_0x137711);if(_0x137711&&_0x137711['summary'][a18_0x5bcc('0x4d')]){this[a18_0x5bcc('0xa')][a18_0x5bcc('0x4e')]();}else{}});}}[a18_0x5bcc('0x4f')](_0x3b959){if(_0x3b959==a18_0x5bcc('0x48')||_0x3b959==String(this['syncPlaylistsService']['playerId'])){this[a18_0x5bcc('0xa')][a18_0x5bcc('0x50')]();}}[a18_0x5bcc('0x51')](_0x5c718a){if(String(_0x5c718a)==a18_0x5bcc('0x48')||String(_0x5c718a)==String(this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')])){this[a18_0x5bcc('0xa')][a18_0x5bcc('0x52')]();}}[a18_0x5bcc('0x53')](_0x4e10a4){if(_0x4e10a4==a18_0x5bcc('0x48')||_0x4e10a4==String(this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')])){console[a18_0x5bcc('0x21')](a18_0x5bcc('0x54'));try{this[a18_0x5bcc('0xa')][a18_0x5bcc('0x4e')]();}catch(_0x31256d){console[a18_0x5bcc('0x21')](_0x31256d);}}}[a18_0x5bcc('0x47')](_0x577435){if(_0x577435==a18_0x5bcc('0x48')||_0x577435==String(this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')])){console['log'](a18_0x5bcc('0x55'));try{this[a18_0x5bcc('0xa')]['updateSettings']();}catch(_0x53ddf8){console[a18_0x5bcc('0x21')](_0x53ddf8);}}}['sendStateUpdate'](){console[a18_0x5bcc('0x21')](a18_0x5bcc('0x56'),this[a18_0x5bcc('0x57')]);this[a18_0x5bcc('0x30')]['publish']('player/state',this[a18_0x5bcc('0xa')][a18_0x5bcc('0x49')]+'-'+this[a18_0x5bcc('0x57')]);}[a18_0x5bcc('0x58')](_0x340acb){if(this[a18_0x5bcc('0x57')]!==a18_0x5bcc('0x59')&&this[a18_0x5bcc('0x57')]!==a18_0x5bcc('0x5a')){console[a18_0x5bcc('0x21')]('opening\x20player\x20door');this['state']=a18_0x5bcc('0x5a');this[a18_0x5bcc('0x5b')]();setTimeout(()=>{this[a18_0x5bcc('0x57')]='open';this[a18_0x5bcc('0x5b')]();},0x1388);}}[a18_0x5bcc('0x42')](_0x2ab7f3){if(this[a18_0x5bcc('0x57')]!==a18_0x5bcc('0xb')&&this['state']!=='closing'){this[a18_0x5bcc('0x57')]=a18_0x5bcc('0x5c');this[a18_0x5bcc('0x5b')]();setTimeout(()=>{this[a18_0x5bcc('0x57')]=a18_0x5bcc('0xb');this[a18_0x5bcc('0x5b')]();},0x1388);}}[a18_0x5bcc('0x35')](_0x1f7a86,_0x11017f){if(_0x11017f){console[a18_0x5bcc('0x21')](_0x11017f[a18_0x5bcc('0x5d')]);}this[a18_0x5bcc('0x30')][a18_0x5bcc('0x5e')](a18_0x5bcc('0x5f'),'false');}[a18_0x5bcc('0x17')](_0x3a92b9,_0x5aa00e,_0x141089){const _0x4f03cd={'iat':Math[a18_0x5bcc('0x1a')](Date['now']()/0x3e8),'exp':Math[a18_0x5bcc('0x1a')](Date[a18_0x5bcc('0x1b')]()/0x3e8)+0x14*0x3c,'aud':_0x3a92b9};const _0x2da14a=fs[a18_0x5bcc('0x60')](_0x5aa00e);return jwt['sign'](_0x4f03cd,_0x2da14a,{'algorithm':_0x141089});}}exports[a18_0x5bcc('0x61')]=MqttService;