var a18_0x1dc6=['player/reboot','handleRebootRequest','handleReloadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','syncPlaylistsService','playerId','registerClient','all','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','shutdown','loadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','sudo\x20/sbin/shutdown\x20-r\x20now','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','__esModule','fs-extra','request','child_process','exec','is-image','string-template','mqtt','jsonwebtoken','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','round','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','ascii','mqttInit','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest'];(function(_0x168f22,_0xa66cc7){var _0x5300dd=function(_0x50c3f0){while(--_0x50c3f0){_0x168f22['push'](_0x168f22['shift']());}};_0x5300dd(++_0xa66cc7);}(a18_0x1dc6,0x8f));var a18_0x527c=function(_0x3ef728,_0x3e1811){_0x3ef728=_0x3ef728-0x0;var _0x2097fc=a18_0x1dc6[_0x3ef728];return _0x2097fc;};'use strict';Object[a18_0x527c('0x0')](exports,a18_0x527c('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x527c('0x2'));const request=require(a18_0x527c('0x3'));const progress=require('request-progress');const spawn=require(a18_0x527c('0x4'))['spawn'];const exec=require(a18_0x527c('0x4'))[a18_0x527c('0x5')];const isImage=require(a18_0x527c('0x6'));const format=require(a18_0x527c('0x7'));const os=require('os');const mqtt=require(a18_0x527c('0x8'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x527c('0x9'));class MqttService{constructor(_0x829bb6){this['syncPlaylistsService']=_0x829bb6;this[a18_0x527c('0xa')]=a18_0x527c('0xb');this[a18_0x527c('0xc')]=new HttpClientService_1['HttpClientService']();}[a18_0x527c('0xd')](){this[a18_0x527c('0xe')]();}[a18_0x527c('0xf')](){console[a18_0x527c('0x10')]('mqttInit');const _0x8d31b6=a18_0x527c('0x11');const _0x55a730=a18_0x527c('0x12');const _0x21073f=a18_0x527c('0x13');const _0x524d03=a18_0x527c('0x14');const _0x2fca16=a18_0x527c('0x15');const _0x8f1da4=a18_0x527c('0x16');const _0x14fbb5=a18_0x527c('0x17');const _0x2c37aa=0x1bb;const _0x472178=a18_0x527c('0x18');const _0x1a8d31=0x5;const _0x1a13cf=a18_0x527c('0x19')+_0x8d31b6+a18_0x527c('0x1a')+_0x524d03+a18_0x527c('0x1b')+_0x21073f+a18_0x527c('0x1c')+_0x55a730;const _0x211ce5={'host':_0x14fbb5,'port':_0x2c37aa,'clientId':_0x1a13cf,'username':a18_0x527c('0x1d'),'password':this[a18_0x527c('0x1e')](_0x8d31b6,_0x8f1da4,_0x2fca16),'protocol':a18_0x527c('0x1f'),'secureProtocol':'TLSv1_2_method'};const _0x403a9a=Math[a18_0x527c('0x20')](Date[a18_0x527c('0x21')]()/0x3e8);const _0x1639e4=mqtt[a18_0x527c('0x22')](_0x211ce5);_0x1639e4[a18_0x527c('0x23')](a18_0x527c('0x1c')+_0x55a730+a18_0x527c('0x24'),{'qos':0x1});_0x1639e4[a18_0x527c('0x23')](a18_0x527c('0x1c')+_0x55a730+a18_0x527c('0x25'),{'qos':0x1});_0x1639e4[a18_0x527c('0x23')](a18_0x527c('0x1c')+_0x55a730+a18_0x527c('0x26'),{'qos':0x0});const _0x428808=a18_0x527c('0x1c')+_0x55a730+'/'+_0x472178;_0x1639e4['on'](a18_0x527c('0x22'),_0x1b0cd8=>{console[a18_0x527c('0x10')](a18_0x527c('0x22'));if(!_0x1b0cd8){console[a18_0x527c('0x10')](a18_0x527c('0x27'));}else{const _0x428808=a18_0x527c('0x28');const _0x5ce2b1=_0x21073f+'/'+_0x55a730+a18_0x527c('0x29');_0x1639e4[a18_0x527c('0x2a')](_0x428808,_0x5ce2b1,{'qos':0x1},_0x449ca0=>{console[a18_0x527c('0x10')](a18_0x527c('0x2b'));console['log'](_0x449ca0);if(!_0x449ca0){}});}});_0x1639e4['on'](a18_0x527c('0x2c'),()=>{console[a18_0x527c('0x10')](a18_0x527c('0x2c'));});_0x1639e4['on'](a18_0x527c('0x2d'),_0x5566d5=>{console[a18_0x527c('0x10')](a18_0x527c('0x2d'),_0x5566d5);});_0x1639e4['on'](a18_0x527c('0x2e'),(_0x3ed11a,_0x5f03f1)=>{let _0x20638f=a18_0x527c('0x2f');console['log'](_0x3ed11a);console[a18_0x527c('0x10')](_0x5f03f1+'');if(_0x3ed11a===a18_0x527c('0x1c')+_0x55a730+a18_0x527c('0x24')){_0x20638f=a18_0x527c('0x30');}else if(_0x3ed11a[a18_0x527c('0x31')](a18_0x527c('0x1c')+_0x55a730+a18_0x527c('0x32'))){_0x20638f=a18_0x527c('0x33');}_0x20638f+=Buffer[a18_0x527c('0x34')](_0x5f03f1,a18_0x527c('0x35'))['toString'](a18_0x527c('0x36'));console['log'](_0x20638f);});_0x1639e4['on']('packetsend',()=>{});console[a18_0x527c('0x10')](_0x211ce5);}[a18_0x527c('0xe')](){console[a18_0x527c('0x10')](a18_0x527c('0x37'));this['clientId']=uuidv4();console['log'](a18_0x527c('0x38'));console['log'](this[a18_0x527c('0x39')]);const _0x12ff28={'clientId':this[a18_0x527c('0x39')],'username':a18_0x527c('0x3a'),'password':a18_0x527c('0x3b'),'clean':!![]};this['mqttClient']=mqtt[a18_0x527c('0x22')](a18_0x527c('0x3c'),_0x12ff28);this[a18_0x527c('0x3d')]['on']('connect',this[a18_0x527c('0x3e')][a18_0x527c('0x3f')](this));this['mqttClient']['on'](a18_0x527c('0x2e'),this[a18_0x527c('0x40')][a18_0x527c('0x3f')](this));this[a18_0x527c('0x3d')]['on'](a18_0x527c('0x2c'),()=>{console[a18_0x527c('0x10')](a18_0x527c('0x2c'));});process['on'](a18_0x527c('0x41'),this[a18_0x527c('0x42')][a18_0x527c('0x3f')](this));process['on'](a18_0x527c('0x43'),this[a18_0x527c('0x42')][a18_0x527c('0x3f')](this));process['on'](a18_0x527c('0x44'),this[a18_0x527c('0x42')]['bind'](this));}['mqttClient_connect'](){console['log'](a18_0x527c('0x45')+this[a18_0x527c('0x39')]);this[a18_0x527c('0x3d')][a18_0x527c('0x23')](a18_0x527c('0x46'));this[a18_0x527c('0x3d')]['subscribe'](a18_0x527c('0x47'));this[a18_0x527c('0x3d')][a18_0x527c('0x23')]('player/reboot',{'qos':0x2});this[a18_0x527c('0x3d')][a18_0x527c('0x23')](a18_0x527c('0x48'),{'qos':0x2});this[a18_0x527c('0x3d')][a18_0x527c('0x23')](a18_0x527c('0x49'),{'qos':0x2});this['mqttClient'][a18_0x527c('0x23')]('player/update',{'qos':0x2});this[a18_0x527c('0x3d')][a18_0x527c('0x23')](a18_0x527c('0x4a'),{'qos':0x2});this[a18_0x527c('0x3d')][a18_0x527c('0x23')](a18_0x527c('0x4b'),{'qos':0x2});}['reportStatus'](){}[a18_0x527c('0x40')](_0x2c8ca9,_0x3f87c7){console[a18_0x527c('0x10')](a18_0x527c('0x4c'),_0x2c8ca9,_0x3f87c7);switch(_0x2c8ca9){case'player/open':return this[a18_0x527c('0x4d')](_0x3f87c7);case a18_0x527c('0x47'):return this[a18_0x527c('0x4e')](_0x3f87c7);case a18_0x527c('0x4f'):return this[a18_0x527c('0x50')](_0x3f87c7);case a18_0x527c('0x49'):return this[a18_0x527c('0x51')](_0x3f87c7);case a18_0x527c('0x48'):return this['handleLoadPlaylistRequest'](_0x3f87c7);case a18_0x527c('0x52'):return this[a18_0x527c('0x53')](_0x3f87c7);case a18_0x527c('0x4a'):return this[a18_0x527c('0x54')](_0x3f87c7);case a18_0x527c('0x4b'):return this[a18_0x527c('0x55')](_0x3f87c7);}}[a18_0x527c('0x55')](_0xff3722){if(_0xff3722=='all'||_0xff3722==String(this[a18_0x527c('0x56')][a18_0x527c('0x57')])){this[a18_0x527c('0x56')][a18_0x527c('0x58')]();}}[a18_0x527c('0x54')](_0x46f265){if(_0x46f265==a18_0x527c('0x59')||_0x46f265==String(this[a18_0x527c('0x56')][a18_0x527c('0x57')])){}}[a18_0x527c('0x53')](_0x41e0eb){console['log'](a18_0x527c('0x5a')+_0x41e0eb);if(_0x41e0eb=='all'||_0x41e0eb==String(this[a18_0x527c('0x56')][a18_0x527c('0x57')])){const _0x2f36d6=__dirname;const _0x3ff7d6=require('simple-git')(_0x2f36d6);console['log'](a18_0x527c('0x5b'));_0x3ff7d6[a18_0x527c('0x5c')]((_0x4ce55d,_0x480ffa)=>{if(_0x4ce55d){console[a18_0x527c('0x10')](a18_0x527c('0x5d'));this[a18_0x527c('0x53')](_0x41e0eb);return;}else{}console[a18_0x527c('0x10')](a18_0x527c('0x5e'));console[a18_0x527c('0x10')](_0x480ffa);if(_0x480ffa&&_0x480ffa[a18_0x527c('0x5f')]['changes']){const _0x475535=spawn(a18_0x527c('0x60'),['-r',a18_0x527c('0x21')]);}else{}});}}['handleLoadPlaylistRequest'](_0x2956dd){if(_0x2956dd==a18_0x527c('0x59')||_0x2956dd==String(this[a18_0x527c('0x56')][a18_0x527c('0x57')])){this['syncPlaylistsService'][a18_0x527c('0x61')]();}}['handleReloadPlaylistRequest'](_0x42ecad){if(String(_0x42ecad)==a18_0x527c('0x59')||String(_0x42ecad)==String(this[a18_0x527c('0x56')][a18_0x527c('0x57')])){this[a18_0x527c('0x56')]['reloadMediaList']();}}[a18_0x527c('0x50')](_0x5a6f9f){if(_0x5a6f9f=='all'||_0x5a6f9f==String(this['syncPlaylistsService'][a18_0x527c('0x57')])){console[a18_0x527c('0x10')](a18_0x527c('0x62'));try{exec(a18_0x527c('0x63'),function(_0x83c6d6){console['log'](_0x83c6d6);});}catch(_0x10dff1){console[a18_0x527c('0x10')](_0x10dff1);}}}[a18_0x527c('0x64')](){console[a18_0x527c('0x10')](a18_0x527c('0x65'),this[a18_0x527c('0xa')]);this[a18_0x527c('0x3d')]['publish'](a18_0x527c('0x66'),this[a18_0x527c('0x56')][a18_0x527c('0x57')]+'-'+this[a18_0x527c('0xa')]);}[a18_0x527c('0x4d')](_0xc6683f){if(this[a18_0x527c('0xa')]!==a18_0x527c('0x67')&&this[a18_0x527c('0xa')]!==a18_0x527c('0x68')){console[a18_0x527c('0x10')]('opening\x20player\x20door');this[a18_0x527c('0xa')]=a18_0x527c('0x68');this[a18_0x527c('0x64')]();setTimeout(()=>{this['state']=a18_0x527c('0x67');this[a18_0x527c('0x64')]();},0x1388);}}['handleCloseRequest'](_0xeb423f){if(this[a18_0x527c('0xa')]!==a18_0x527c('0xb')&&this[a18_0x527c('0xa')]!=='closing'){this[a18_0x527c('0xa')]='closing';this[a18_0x527c('0x64')]();setTimeout(()=>{this[a18_0x527c('0xa')]=a18_0x527c('0xb');this[a18_0x527c('0x64')]();},0x1388);}}[a18_0x527c('0x42')](_0x48c560,_0x57431f){if(_0x57431f){console['log'](_0x57431f[a18_0x527c('0x69')]);}this[a18_0x527c('0x3d')][a18_0x527c('0x2a')](a18_0x527c('0x6a'),a18_0x527c('0x6b'));}[a18_0x527c('0x1e')](_0x2a0998,_0x25acf0,_0x498f1a){const _0x2ab73f={'iat':Math[a18_0x527c('0x20')](Date[a18_0x527c('0x21')]()/0x3e8),'exp':Math[a18_0x527c('0x20')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x2a0998};const _0x26cebe=fs[a18_0x527c('0x6c')](_0x25acf0);return jwt[a18_0x527c('0x6d')](_0x2ab73f,_0x26cebe,{'algorithm':_0x498f1a});}}exports[a18_0x527c('0x6e')]=MqttService;