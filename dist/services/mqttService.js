var a18_0x5418=['handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','registerClient','all','playerId','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','shutdown','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','state','publish','player/state','open','opening','opening\x20player\x20door','closing','player/connected','false','createJwt','readFileSync','sign','MqttService','defineProperty','fs-extra','child_process','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','/locations/','/registries/','mqtts','TLSv1_2_method','round','now','connect','subscribe','/devices/','/state','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','from','base64','toString','clientId','this.clientId','lulo_mqtt','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','mqttClient_message'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a18_0x5418,0xf6));var a18_0x1196=function(_0x3a9d97,_0x4c5e89){_0x3a9d97=_0x3a9d97-0x0;var _0x1a2536=a18_0x5418[_0x3a9d97];return _0x1a2536;};'use strict';Object[a18_0x1196('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x1196('0x1'));const request=require('request');const progress=require('request-progress');const spawn=require(a18_0x1196('0x2'))['spawn'];const isImage=require(a18_0x1196('0x3'));const format=require(a18_0x1196('0x4'));const os=require('os');const mqtt=require(a18_0x1196('0x5'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x1196('0x6'));class MqttService{constructor(_0x4fe42d){this[a18_0x1196('0x7')]=_0x4fe42d;this['state']=a18_0x1196('0x8');this[a18_0x1196('0x9')]=new HttpClientService_1[(a18_0x1196('0xa'))]();}[a18_0x1196('0xb')](){this[a18_0x1196('0xc')]();}[a18_0x1196('0xd')](){console[a18_0x1196('0xe')](a18_0x1196('0xf'));const _0x506d8d='velvety-glazing-252020';const _0x30374a=a18_0x1196('0x10');const _0x56dd79=a18_0x1196('0x11');const _0x1cea08='us-central1';const _0x5863e9=a18_0x1196('0x12');const _0x48506f=a18_0x1196('0x13');const _0x1da885=a18_0x1196('0x14');const _0x20eda5=0x1bb;const _0x10287f='events';const _0x5c8328=0x5;const _0x483e97='projects/'+_0x506d8d+a18_0x1196('0x15')+_0x1cea08+a18_0x1196('0x16')+_0x56dd79+'/devices/'+_0x30374a;const _0x17533e={'host':_0x1da885,'port':_0x20eda5,'clientId':_0x483e97,'username':'unused','password':this['createJwt'](_0x506d8d,_0x48506f,_0x5863e9),'protocol':a18_0x1196('0x17'),'secureProtocol':a18_0x1196('0x18')};const _0x30f5e0=Math[a18_0x1196('0x19')](Date[a18_0x1196('0x1a')]()/0x3e8);const _0x1a3b00=mqtt[a18_0x1196('0x1b')](_0x17533e);_0x1a3b00[a18_0x1196('0x1c')](a18_0x1196('0x1d')+_0x30374a+'/config',{'qos':0x1});_0x1a3b00['subscribe']('/devices/'+_0x30374a+a18_0x1196('0x1e'),{'qos':0x1});_0x1a3b00[a18_0x1196('0x1c')](a18_0x1196('0x1d')+_0x30374a+'/commands/#',{'qos':0x0});const _0x220637=a18_0x1196('0x1d')+_0x30374a+'/'+_0x10287f;_0x1a3b00['on'](a18_0x1196('0x1b'),_0x2c70fe=>{console[a18_0x1196('0xe')](a18_0x1196('0x1b'));if(!_0x2c70fe){console[a18_0x1196('0xe')](a18_0x1196('0x1f'));}else{const _0x220637=a18_0x1196('0x20');const _0x1fa687=_0x56dd79+'/'+_0x30374a+'-payload-0';_0x1a3b00['publish'](_0x220637,_0x1fa687,{'qos':0x1},_0x15b4e8=>{console['log'](a18_0x1196('0x21'));console['log'](_0x15b4e8);if(!_0x15b4e8){}});}});_0x1a3b00['on']('close',()=>{console['log'](a18_0x1196('0x22'));});_0x1a3b00['on']('error',_0x1eb5dd=>{console[a18_0x1196('0xe')]('error',_0x1eb5dd);});_0x1a3b00['on']('message',(_0x2e7cc9,_0x6f0bd)=>{let _0x2ddf55=a18_0x1196('0x23');console[a18_0x1196('0xe')](_0x2e7cc9);console[a18_0x1196('0xe')](_0x6f0bd+'');if(_0x2e7cc9==='/devices/'+_0x30374a+a18_0x1196('0x24')){_0x2ddf55=a18_0x1196('0x25');}else if(_0x2e7cc9[a18_0x1196('0x26')](a18_0x1196('0x1d')+_0x30374a+a18_0x1196('0x27'))){_0x2ddf55='Command\x20message\x20received:\x20';}_0x2ddf55+=Buffer[a18_0x1196('0x28')](_0x6f0bd,a18_0x1196('0x29'))[a18_0x1196('0x2a')]('ascii');console[a18_0x1196('0xe')](_0x2ddf55);});_0x1a3b00['on']('packetsend',()=>{});console[a18_0x1196('0xe')](_0x17533e);}[a18_0x1196('0xc')](){console[a18_0x1196('0xe')](a18_0x1196('0xf'));this[a18_0x1196('0x2b')]=uuidv4();console['log'](a18_0x1196('0x2c'));console[a18_0x1196('0xe')](this[a18_0x1196('0x2b')]);const _0x4aa468={'clientId':this[a18_0x1196('0x2b')],'username':a18_0x1196('0x2d'),'password':'run.lulo_2018#.','clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x1196('0x2e'),_0x4aa468);this[a18_0x1196('0x2f')]['on'](a18_0x1196('0x1b'),this[a18_0x1196('0x30')][a18_0x1196('0x31')](this));this[a18_0x1196('0x2f')]['on']('message',this[a18_0x1196('0x32')][a18_0x1196('0x31')](this));this[a18_0x1196('0x2f')]['on'](a18_0x1196('0x22'),()=>{console[a18_0x1196('0xe')]('close');});process['on']('exit',this[a18_0x1196('0x33')][a18_0x1196('0x31')](this));process['on'](a18_0x1196('0x34'),this[a18_0x1196('0x33')][a18_0x1196('0x31')](this));process['on'](a18_0x1196('0x35'),this[a18_0x1196('0x33')]['bind'](this));}['mqttClient_connect'](){console[a18_0x1196('0xe')](a18_0x1196('0x36')+this[a18_0x1196('0x2b')]);this[a18_0x1196('0x2f')][a18_0x1196('0x1c')](a18_0x1196('0x37'));this[a18_0x1196('0x2f')][a18_0x1196('0x1c')](a18_0x1196('0x38'));this[a18_0x1196('0x2f')][a18_0x1196('0x1c')](a18_0x1196('0x39'),{'qos':0x2});this[a18_0x1196('0x2f')][a18_0x1196('0x1c')](a18_0x1196('0x3a'),{'qos':0x2});this[a18_0x1196('0x2f')]['subscribe'](a18_0x1196('0x3b'),{'qos':0x2});this[a18_0x1196('0x2f')]['subscribe'](a18_0x1196('0x3c'),{'qos':0x2});this['mqttClient'][a18_0x1196('0x1c')](a18_0x1196('0x3d'),{'qos':0x2});this[a18_0x1196('0x2f')][a18_0x1196('0x1c')](a18_0x1196('0x3e'),{'qos':0x2});}[a18_0x1196('0x3f')](){}[a18_0x1196('0x32')](_0x22eb0c,_0x3d7ca3){console[a18_0x1196('0xe')](a18_0x1196('0x40'),_0x22eb0c,_0x3d7ca3);switch(_0x22eb0c){case a18_0x1196('0x37'):return this[a18_0x1196('0x41')](_0x3d7ca3);case a18_0x1196('0x38'):return this[a18_0x1196('0x42')](_0x3d7ca3);case a18_0x1196('0x39'):return this[a18_0x1196('0x43')](_0x3d7ca3);case'player/reload_playlist':return this[a18_0x1196('0x44')](_0x3d7ca3);case a18_0x1196('0x3a'):return this[a18_0x1196('0x45')](_0x3d7ca3);case a18_0x1196('0x3c'):return this['handleUpdateRequest'](_0x3d7ca3);case a18_0x1196('0x3d'):return this[a18_0x1196('0x46')](_0x3d7ca3);case a18_0x1196('0x3e'):return this['handleRegisterRequest'](_0x3d7ca3);}}['handleRegisterRequest'](_0x129b5d){if(_0x129b5d=='all'||_0x129b5d==String(this[a18_0x1196('0x7')]['playerId'])){this[a18_0x1196('0x7')][a18_0x1196('0x47')]();}}['handleIfconfigRequest'](_0x3b8fb0){if(_0x3b8fb0==a18_0x1196('0x48')||_0x3b8fb0==String(this[a18_0x1196('0x7')][a18_0x1196('0x49')])){}}[a18_0x1196('0x4a')](_0x489781){console[a18_0x1196('0xe')](a18_0x1196('0x4b')+_0x489781);if(_0x489781=='all'||_0x489781==String(this[a18_0x1196('0x7')][a18_0x1196('0x49')])){const _0x2e54f3=__dirname;const _0x74f9cb=require(a18_0x1196('0x4c'))(_0x2e54f3);console[a18_0x1196('0xe')](a18_0x1196('0x4d'));_0x74f9cb[a18_0x1196('0x4e')]((_0x1f15dd,_0x246592)=>{if(_0x1f15dd){console[a18_0x1196('0xe')](a18_0x1196('0x4f'));this['handleUpdateRequest'](_0x489781);return;}else{}console[a18_0x1196('0xe')]('Git\x20updated');console[a18_0x1196('0xe')](_0x246592);if(_0x246592&&_0x246592[a18_0x1196('0x50')][a18_0x1196('0x51')]){const _0x329728=spawn(a18_0x1196('0x52'),['-r','now']);}else{}});}}[a18_0x1196('0x45')](_0x5b11ed){if(_0x5b11ed==a18_0x1196('0x48')||_0x5b11ed==String(this[a18_0x1196('0x7')]['playerId'])){this['syncPlaylistsService']['loadMediaList']();}}[a18_0x1196('0x44')](_0x26980f){if(String(_0x26980f)==a18_0x1196('0x48')||String(_0x26980f)==String(this[a18_0x1196('0x7')][a18_0x1196('0x49')])){this[a18_0x1196('0x7')][a18_0x1196('0x53')]();}}[a18_0x1196('0x43')](_0x4defd5){if(_0x4defd5=='all'||_0x4defd5==String(this[a18_0x1196('0x7')][a18_0x1196('0x49')])){const _0x41c036=spawn(a18_0x1196('0x52'),['-r',a18_0x1196('0x1a')]);}}[a18_0x1196('0x54')](){console[a18_0x1196('0xe')](a18_0x1196('0x55'),this[a18_0x1196('0x56')]);this['mqttClient'][a18_0x1196('0x57')](a18_0x1196('0x58'),this['syncPlaylistsService'][a18_0x1196('0x49')]+'-'+this[a18_0x1196('0x56')]);}[a18_0x1196('0x41')](_0x5d2cbe){if(this[a18_0x1196('0x56')]!==a18_0x1196('0x59')&&this[a18_0x1196('0x56')]!==a18_0x1196('0x5a')){console['log'](a18_0x1196('0x5b'));this[a18_0x1196('0x56')]=a18_0x1196('0x5a');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1196('0x56')]=a18_0x1196('0x59');this[a18_0x1196('0x54')]();},0x1388);}}[a18_0x1196('0x42')](_0xc7f078){if(this['state']!=='closed'&&this[a18_0x1196('0x56')]!=='closing'){this['state']=a18_0x1196('0x5c');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1196('0x56')]='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x3e603d,_0x250095){if(_0x250095){console[a18_0x1196('0xe')](_0x250095['stack']);}this[a18_0x1196('0x2f')][a18_0x1196('0x57')](a18_0x1196('0x5d'),a18_0x1196('0x5e'));}[a18_0x1196('0x5f')](_0x14fe11,_0x326775,_0x380bec){const _0x2d0fad={'iat':Math[a18_0x1196('0x19')](Date[a18_0x1196('0x1a')]()/0x3e8),'exp':Math[a18_0x1196('0x19')](Date[a18_0x1196('0x1a')]()/0x3e8)+0x14*0x3c,'aud':_0x14fe11};const _0x1e71fd=fs[a18_0x1196('0x60')](_0x326775);return jwt[a18_0x1196('0x61')](_0x2d0fad,_0x1e71fd,{'algorithm':_0x380bec});}}exports[a18_0x1196('0x62')]=MqttService;