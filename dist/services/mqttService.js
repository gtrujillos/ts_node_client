var a18_0x4dcf=['mqttClient_connect','bind','message','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/load_playlist','player/update','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','player/reboot','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','playerId','pull','Error\x20git\x20updated','Git\x20updated','shutdown','now','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','opening','handleCloseRequest','closing','stack','player/connected','defineProperty','__esModule','fs-extra','request','request-progress','spawn','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run'];(function(_0x392f18,_0x10d8bf){var _0x579fe5=function(_0x3042f9){while(--_0x3042f9){_0x392f18['push'](_0x392f18['shift']());}};_0x579fe5(++_0x10d8bf);}(a18_0x4dcf,0x1c9));var a18_0x5a16=function(_0x1d2e05,_0xa452){_0x1d2e05=_0x1d2e05-0x0;var _0x5a17ed=a18_0x4dcf[_0x1d2e05];return _0x5a17ed;};'use strict';Object[a18_0x5a16('0x0')](exports,a18_0x5a16('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x5a16('0x2'));const request=require(a18_0x5a16('0x3'));const progress=require(a18_0x5a16('0x4'));const spawn=require('child_process')[a18_0x5a16('0x5')];const isImage=require('is-image');const format=require(a18_0x5a16('0x6'));const os=require('os');const mqtt=require(a18_0x5a16('0x7'));const uuidv4=require(a18_0x5a16('0x8'));class MqttService{constructor(_0x395a20){this[a18_0x5a16('0x9')]=_0x395a20;this[a18_0x5a16('0xa')]=a18_0x5a16('0xb');this[a18_0x5a16('0xc')]=new HttpClientService_1[(a18_0x5a16('0xd'))]();}[a18_0x5a16('0xe')](){this['mqttInit']();}[a18_0x5a16('0xf')](){console[a18_0x5a16('0x10')](a18_0x5a16('0xf'));this[a18_0x5a16('0x11')]=uuidv4();console[a18_0x5a16('0x10')]('this.clientId');console[a18_0x5a16('0x10')](this['clientId']);const _0xfa8c50={'clientId':this['clientId'],'username':a18_0x5a16('0x12'),'password':a18_0x5a16('0x13'),'clean':!![]};this[a18_0x5a16('0x14')]=mqtt[a18_0x5a16('0x15')](a18_0x5a16('0x16'),_0xfa8c50);this[a18_0x5a16('0x14')]['on'](a18_0x5a16('0x15'),this[a18_0x5a16('0x17')][a18_0x5a16('0x18')](this));this['mqttClient']['on'](a18_0x5a16('0x19'),this['mqttClient_message'][a18_0x5a16('0x18')](this));process['on']('exit',this[a18_0x5a16('0x1a')][a18_0x5a16('0x18')](this));process['on'](a18_0x5a16('0x1b'),this['handleAppExit']['bind'](this));process['on']('uncaughtException',this[a18_0x5a16('0x1a')][a18_0x5a16('0x18')](this));}[a18_0x5a16('0x17')](){console[a18_0x5a16('0x10')](a18_0x5a16('0x1c')+this[a18_0x5a16('0x11')]);this['mqttClient'][a18_0x5a16('0x1d')]('player/open');this[a18_0x5a16('0x14')]['subscribe'](a18_0x5a16('0x1e'));this['mqttClient'][a18_0x5a16('0x1d')]('player/reboot',{'qos':0x2});this[a18_0x5a16('0x14')][a18_0x5a16('0x1d')](a18_0x5a16('0x1f'),{'qos':0x2});this['mqttClient'][a18_0x5a16('0x1d')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x5a16('0x1d')](a18_0x5a16('0x20'),{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x12bc0f,_0x26449a){console[a18_0x5a16('0x10')](a18_0x5a16('0x21'),_0x12bc0f,_0x26449a);switch(_0x12bc0f){case a18_0x5a16('0x22'):return this[a18_0x5a16('0x23')](_0x26449a);case a18_0x5a16('0x1e'):return this['handleCloseRequest'](_0x26449a);case a18_0x5a16('0x24'):return this[a18_0x5a16('0x25')](_0x26449a);case a18_0x5a16('0x26'):return this[a18_0x5a16('0x27')](_0x26449a);case a18_0x5a16('0x1f'):return this[a18_0x5a16('0x28')](_0x26449a);case'player/update':return this[a18_0x5a16('0x29')](_0x26449a);}}[a18_0x5a16('0x29')](_0x85d383){if(_0x85d383==a18_0x5a16('0x2a')||_0x85d383==String(this[a18_0x5a16('0x9')][a18_0x5a16('0x2b')])){const _0x5b7719=__dirname;const _0x20bde0=require('simple-git')(_0x5b7719);console['log']('Git\x20updating');_0x20bde0[a18_0x5a16('0x2c')]((_0x1f4d86,_0x420b25)=>{if(_0x1f4d86){console[a18_0x5a16('0x10')](a18_0x5a16('0x2d'));this[a18_0x5a16('0x29')](_0x85d383);return;}else{}console[a18_0x5a16('0x10')](a18_0x5a16('0x2e'));console[a18_0x5a16('0x10')](_0x420b25);if(_0x420b25&&_0x420b25['summary']['changes']){const _0x47f1ed=spawn(a18_0x5a16('0x2f'),['-r',a18_0x5a16('0x30')]);}else{}});}}[a18_0x5a16('0x28')](_0x27f3ca){if(_0x27f3ca==a18_0x5a16('0x2a')||_0x27f3ca==String(this[a18_0x5a16('0x9')][a18_0x5a16('0x2b')])){this[a18_0x5a16('0x9')][a18_0x5a16('0x31')]();}}[a18_0x5a16('0x27')](_0x44c5d2){if(String(_0x44c5d2)==a18_0x5a16('0x2a')||String(_0x44c5d2)==String(this['syncPlaylistsService'][a18_0x5a16('0x2b')])){this[a18_0x5a16('0x9')][a18_0x5a16('0x32')]();}}[a18_0x5a16('0x25')](_0x2aa99e){if(_0x2aa99e=='all'||_0x2aa99e==String(this['syncPlaylistsService'][a18_0x5a16('0x2b')])){const _0x1e2fd4=spawn(a18_0x5a16('0x2f'),['-r','now']);}}[a18_0x5a16('0x33')](){console[a18_0x5a16('0x10')](a18_0x5a16('0x34'),this[a18_0x5a16('0xa')]);this[a18_0x5a16('0x14')][a18_0x5a16('0x35')](a18_0x5a16('0x36'),this[a18_0x5a16('0x9')]['playerId']+'-'+this[a18_0x5a16('0xa')]);}['handleOpenRequest'](_0x573eb3){if(this[a18_0x5a16('0xa')]!=='open'&&this[a18_0x5a16('0xa')]!=='opening'){console[a18_0x5a16('0x10')]('opening\x20player\x20door');this[a18_0x5a16('0xa')]=a18_0x5a16('0x37');this[a18_0x5a16('0x33')]();setTimeout(()=>{this['state']='open';this['sendStateUpdate']();},0x1388);}}[a18_0x5a16('0x38')](_0x429c32){if(this['state']!==a18_0x5a16('0xb')&&this[a18_0x5a16('0xa')]!==a18_0x5a16('0x39')){this[a18_0x5a16('0xa')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5a16('0xa')]=a18_0x5a16('0xb');this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x168f92,_0x372a90){if(_0x372a90){console[a18_0x5a16('0x10')](_0x372a90[a18_0x5a16('0x3a')]);}this['mqttClient'][a18_0x5a16('0x35')](a18_0x5a16('0x3b'),'false');}}exports['MqttService']=MqttService;