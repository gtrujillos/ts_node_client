var a17_0x3f45=['false','MqttService','defineProperty','fs-extra','request','request-progress','child_process','spawn','is-image','state','closed','syncPlaylistsService','init','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqttClient_connect','message','mqttClient_message','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','subscribe','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','registerClient','stringify','networkInterfaces','reportStatus','received\x20message\x20%s\x20%s','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','all','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','handleLoadPlaylistRequest','loadMediaList','playerId','reloadMediaList','shutdown','now','publish','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','player/connected'];(function(_0x515d47,_0x4dd07d){var _0x20a2a2=function(_0x24111a){while(--_0x24111a){_0x515d47['push'](_0x515d47['shift']());}};_0x20a2a2(++_0x4dd07d);}(a17_0x3f45,0x86));var a17_0x3b75=function(_0x2f2b45,_0x21dd29){_0x2f2b45=_0x2f2b45-0x0;var _0x20a41b=a17_0x3f45[_0x2f2b45];return _0x20a41b;};'use strict';Object[a17_0x3b75('0x0')](exports,'__esModule',{'value':!![]});const fs=require('fs');const fsExtra=require(a17_0x3b75('0x1'));const request=require(a17_0x3b75('0x2'));const progress=require(a17_0x3b75('0x3'));const spawn=require(a17_0x3b75('0x4'))[a17_0x3b75('0x5')];const isImage=require(a17_0x3b75('0x6'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');class MqttService{constructor(_0x337923){this[a17_0x3b75('0x7')]=a17_0x3b75('0x8');this[a17_0x3b75('0x9')]=_0x337923;}[a17_0x3b75('0xa')](){this[a17_0x3b75('0xb')]();}[a17_0x3b75('0xb')](){console[a17_0x3b75('0xc')](a17_0x3b75('0xb'));this[a17_0x3b75('0xd')]=uuidv4();const _0x1ae6e6={'clientId':this[a17_0x3b75('0xd')],'username':a17_0x3b75('0xe'),'password':a17_0x3b75('0xf'),'clean':!![]};this[a17_0x3b75('0x10')]=mqtt[a17_0x3b75('0x11')]('mqtt://lulo.run',_0x1ae6e6);this['mqttClient']['on']('connect',this[a17_0x3b75('0x12')]['bind'](this));this[a17_0x3b75('0x10')]['on'](a17_0x3b75('0x13'),this[a17_0x3b75('0x14')][a17_0x3b75('0x15')](this));process['on'](a17_0x3b75('0x16'),this[a17_0x3b75('0x17')][a17_0x3b75('0x15')](this));process['on'](a17_0x3b75('0x18'),this[a17_0x3b75('0x17')][a17_0x3b75('0x15')](this));process['on'](a17_0x3b75('0x19'),this[a17_0x3b75('0x17')][a17_0x3b75('0x15')](this));}[a17_0x3b75('0x12')](){console[a17_0x3b75('0xc')](a17_0x3b75('0x1a')+this[a17_0x3b75('0xd')]);this[a17_0x3b75('0x10')]['subscribe'](a17_0x3b75('0x1b'));this['mqttClient'][a17_0x3b75('0x1c')](a17_0x3b75('0x1d'));this[a17_0x3b75('0x10')][a17_0x3b75('0x1c')](a17_0x3b75('0x1e'),{'qos':0x2});this['mqttClient'][a17_0x3b75('0x1c')](a17_0x3b75('0x1f'),{'qos':0x2});this[a17_0x3b75('0x10')]['subscribe'](a17_0x3b75('0x20'),{'qos':0x2});this[a17_0x3b75('0x10')][a17_0x3b75('0x1c')](a17_0x3b75('0x21'),{'qos':0x2});this['registerClient']();}[a17_0x3b75('0x22')](){const _0x3b0d9e={'playerId':this['syncPlaylistsService']['playerId'],'clientId':this[a17_0x3b75('0xd')],'connected':!![],'network':JSON[a17_0x3b75('0x23')](os[a17_0x3b75('0x24')]())};console['log'](_0x3b0d9e);}[a17_0x3b75('0x25')](){}[a17_0x3b75('0x14')](_0x35d6d4,_0x7ebcea){console[a17_0x3b75('0xc')](a17_0x3b75('0x26'),_0x35d6d4,_0x7ebcea);switch(_0x35d6d4){case a17_0x3b75('0x1b'):return this['handleOpenRequest'](_0x7ebcea);case'player/close':return this['handleCloseRequest'](_0x7ebcea);case a17_0x3b75('0x1e'):return this[a17_0x3b75('0x27')](_0x7ebcea);case a17_0x3b75('0x20'):return this[a17_0x3b75('0x28')](_0x7ebcea);case a17_0x3b75('0x1f'):return this['handleLoadPlaylistRequest'](_0x7ebcea);case'player/update':return this[a17_0x3b75('0x29')](_0x7ebcea);}}[a17_0x3b75('0x29')](_0x5410a2){if(_0x5410a2==a17_0x3b75('0x2a')||_0x5410a2==String(this[a17_0x3b75('0x9')]['playerId'])){const _0x4932b9=__dirname;const _0x396089=require(a17_0x3b75('0x2b'))(_0x4932b9);console['log'](a17_0x3b75('0x2c'));_0x396089[a17_0x3b75('0x2d')]((_0x15ac44,_0x5a880e)=>{if(_0x15ac44){console[a17_0x3b75('0xc')]('Error\x20git\x20updated');this['handleUpdateRequest'](_0x5410a2);return;}else{}console[a17_0x3b75('0xc')](a17_0x3b75('0x2e'));console['log'](_0x5a880e);if(_0x5a880e&&_0x5a880e[a17_0x3b75('0x2f')][a17_0x3b75('0x30')]){const _0x5081aa=spawn('shutdown',['-r','now']);}else{}});}}[a17_0x3b75('0x31')](_0x6423f){if(_0x6423f=='all'||_0x6423f==String(this[a17_0x3b75('0x9')]['playerId'])){this['syncPlaylistsService'][a17_0x3b75('0x32')]();}}[a17_0x3b75('0x28')](_0x26b6e9){if(_0x26b6e9==a17_0x3b75('0x2a')||_0x26b6e9==String(this[a17_0x3b75('0x9')][a17_0x3b75('0x33')])){this['syncPlaylistsService'][a17_0x3b75('0x34')]();}}['handleRebootRequest'](_0x1b10b9){if(_0x1b10b9==a17_0x3b75('0x2a')||_0x1b10b9==String(this['syncPlaylistsService'][a17_0x3b75('0x33')])){const _0x36b6a1=spawn(a17_0x3b75('0x35'),['-r',a17_0x3b75('0x36')]);}}['sendStateUpdate'](){console[a17_0x3b75('0xc')]('sending\x20state\x20%s',this['state']);this['mqttClient'][a17_0x3b75('0x37')](a17_0x3b75('0x38'),this[a17_0x3b75('0x9')][a17_0x3b75('0x33')]+'-'+this[a17_0x3b75('0x7')]);}['handleOpenRequest'](_0x10fe3e){if(this['state']!==a17_0x3b75('0x39')&&this['state']!==a17_0x3b75('0x3a')){console[a17_0x3b75('0xc')](a17_0x3b75('0x3b'));this[a17_0x3b75('0x7')]='opening';this[a17_0x3b75('0x3c')]();setTimeout(()=>{this[a17_0x3b75('0x7')]='open';this[a17_0x3b75('0x3c')]();},0x1388);}}[a17_0x3b75('0x3d')](_0x3f60bf){if(this[a17_0x3b75('0x7')]!==a17_0x3b75('0x8')&&this[a17_0x3b75('0x7')]!==a17_0x3b75('0x3e')){this['state']=a17_0x3b75('0x3e');this['sendStateUpdate']();setTimeout(()=>{this[a17_0x3b75('0x7')]='closed';this[a17_0x3b75('0x3c')]();},0x1388);}}[a17_0x3b75('0x17')](_0x1251b1,_0x39bbea){if(_0x39bbea){console[a17_0x3b75('0xc')](_0x39bbea['stack']);}this['mqttClient'][a17_0x3b75('0x37')](a17_0x3b75('0x3f'),a17_0x3b75('0x40'));}}exports[a17_0x3b75('0x41')]=MqttService;