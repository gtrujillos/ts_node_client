var a17_0x2e02=['player/open','player/reboot','player/load_playlist','player/update','registerClient','playerId','networkInterfaces','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','all','Git\x20updating','handleUpdateRequest','Git\x20updated','summary','changes','shutdown','now','loadMediaList','reloadMediaList','sendStateUpdate','publish','open','opening','closing','player/connected','false','MqttService','defineProperty','fs-extra','request','child_process','spawn','is-image','uuid/v4','state','closed','syncPlaylistsService','init','mqttInit','log','clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe'];(function(_0x1de4ea,_0x2900a3){var _0x385dfd=function(_0x13ddef){while(--_0x13ddef){_0x1de4ea['push'](_0x1de4ea['shift']());}};_0x385dfd(++_0x2900a3);}(a17_0x2e02,0x9c));var a17_0x4075=function(_0x36707e,_0x592983){_0x36707e=_0x36707e-0x0;var _0x174fc6=a17_0x2e02[_0x36707e];return _0x174fc6;};'use strict';Object[a17_0x4075('0x0')](exports,'__esModule',{'value':!![]});const fs=require('fs');const fsExtra=require(a17_0x4075('0x1'));const request=require(a17_0x4075('0x2'));const progress=require('request-progress');const spawn=require(a17_0x4075('0x3'))[a17_0x4075('0x4')];const isImage=require(a17_0x4075('0x5'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a17_0x4075('0x6'));class MqttService{constructor(_0x33f34c){this[a17_0x4075('0x7')]=a17_0x4075('0x8');this[a17_0x4075('0x9')]=_0x33f34c;}[a17_0x4075('0xa')](){this[a17_0x4075('0xb')]();}['mqttInit'](){console[a17_0x4075('0xc')](a17_0x4075('0xb'));this[a17_0x4075('0xd')]=uuidv4();const _0x4b2d75={'clientId':this[a17_0x4075('0xd')],'username':a17_0x4075('0xe'),'password':'run.lulo_2018#.','clean':!![]};this[a17_0x4075('0xf')]=mqtt[a17_0x4075('0x10')](a17_0x4075('0x11'),_0x4b2d75);this['mqttClient']['on'](a17_0x4075('0x10'),this[a17_0x4075('0x12')][a17_0x4075('0x13')](this));this['mqttClient']['on'](a17_0x4075('0x14'),this[a17_0x4075('0x15')][a17_0x4075('0x13')](this));process['on']('exit',this[a17_0x4075('0x16')][a17_0x4075('0x13')](this));process['on'](a17_0x4075('0x17'),this[a17_0x4075('0x16')][a17_0x4075('0x13')](this));process['on'](a17_0x4075('0x18'),this['handleAppExit']['bind'](this));}[a17_0x4075('0x12')](){console['log'](a17_0x4075('0x19')+this[a17_0x4075('0xd')]);this[a17_0x4075('0xf')][a17_0x4075('0x1a')](a17_0x4075('0x1b'));this[a17_0x4075('0xf')][a17_0x4075('0x1a')]('player/close');this['mqttClient'][a17_0x4075('0x1a')](a17_0x4075('0x1c'),{'qos':0x2});this[a17_0x4075('0xf')][a17_0x4075('0x1a')](a17_0x4075('0x1d'),{'qos':0x2});this[a17_0x4075('0xf')][a17_0x4075('0x1a')]('player/reload_playlist',{'qos':0x2});this[a17_0x4075('0xf')][a17_0x4075('0x1a')](a17_0x4075('0x1e'),{'qos':0x2});this[a17_0x4075('0x1f')]();}[a17_0x4075('0x1f')](){const _0x54e0a5={'playerId':this[a17_0x4075('0x9')][a17_0x4075('0x20')],'clientId':this[a17_0x4075('0xd')],'connected':!![],'network':JSON['stringify'](os[a17_0x4075('0x21')]())};console[a17_0x4075('0xc')](_0x54e0a5);}[a17_0x4075('0x22')](){}[a17_0x4075('0x15')](_0x48dbf8,_0x1c8427){console['log'](a17_0x4075('0x23'),_0x48dbf8,_0x1c8427);switch(_0x48dbf8){case a17_0x4075('0x1b'):return this[a17_0x4075('0x24')](_0x1c8427);case a17_0x4075('0x25'):return this[a17_0x4075('0x26')](_0x1c8427);case a17_0x4075('0x1c'):return this[a17_0x4075('0x27')](_0x1c8427);case a17_0x4075('0x28'):return this[a17_0x4075('0x29')](_0x1c8427);case a17_0x4075('0x1d'):return this[a17_0x4075('0x2a')](_0x1c8427);case a17_0x4075('0x1e'):return this['handleUpdateRequest'](_0x1c8427);}}['handleUpdateRequest'](_0x2f7309){if(_0x2f7309==a17_0x4075('0x2b')||_0x2f7309==String(this['syncPlaylistsService'][a17_0x4075('0x20')])){const _0x3a2c50=__dirname;const _0x100411=require('simple-git')(_0x3a2c50);console[a17_0x4075('0xc')](a17_0x4075('0x2c'));_0x100411['pull']((_0x406ed0,_0x8ce066)=>{if(_0x406ed0){console[a17_0x4075('0xc')]('Error\x20git\x20updated');this[a17_0x4075('0x2d')](_0x2f7309);return;}else{}console[a17_0x4075('0xc')](a17_0x4075('0x2e'));console[a17_0x4075('0xc')](_0x8ce066);if(_0x8ce066&&_0x8ce066[a17_0x4075('0x2f')][a17_0x4075('0x30')]){const _0x41a8d2=spawn(a17_0x4075('0x31'),['-r',a17_0x4075('0x32')]);}else{}});}}[a17_0x4075('0x2a')](_0x441119){if(_0x441119==a17_0x4075('0x2b')||_0x441119==String(this[a17_0x4075('0x9')][a17_0x4075('0x20')])){this['syncPlaylistsService'][a17_0x4075('0x33')]();}}[a17_0x4075('0x29')](_0x32deb7){if(_0x32deb7==a17_0x4075('0x2b')||_0x32deb7==String(this['syncPlaylistsService']['playerId'])){this['syncPlaylistsService'][a17_0x4075('0x34')]();}}[a17_0x4075('0x27')](_0x1eb355){if(_0x1eb355==a17_0x4075('0x2b')||_0x1eb355==String(this[a17_0x4075('0x9')][a17_0x4075('0x20')])){const _0x1615ff=spawn('shutdown',['-r',a17_0x4075('0x32')]);}}[a17_0x4075('0x35')](){console[a17_0x4075('0xc')]('sending\x20state\x20%s',this[a17_0x4075('0x7')]);this[a17_0x4075('0xf')][a17_0x4075('0x36')]('player/state',this[a17_0x4075('0x9')][a17_0x4075('0x20')]+'-'+this[a17_0x4075('0x7')]);}[a17_0x4075('0x24')](_0x4af6b9){if(this[a17_0x4075('0x7')]!==a17_0x4075('0x37')&&this[a17_0x4075('0x7')]!==a17_0x4075('0x38')){console[a17_0x4075('0xc')]('opening\x20player\x20door');this[a17_0x4075('0x7')]=a17_0x4075('0x38');this[a17_0x4075('0x35')]();setTimeout(()=>{this[a17_0x4075('0x7')]=a17_0x4075('0x37');this[a17_0x4075('0x35')]();},0x1388);}}['handleCloseRequest'](_0x13b552){if(this[a17_0x4075('0x7')]!==a17_0x4075('0x8')&&this['state']!==a17_0x4075('0x39')){this[a17_0x4075('0x7')]=a17_0x4075('0x39');this[a17_0x4075('0x35')]();setTimeout(()=>{this[a17_0x4075('0x7')]=a17_0x4075('0x8');this[a17_0x4075('0x35')]();},0x1388);}}[a17_0x4075('0x16')](_0x2e1768,_0x4c00f0){if(_0x4c00f0){console[a17_0x4075('0xc')](_0x4c00f0['stack']);}this['mqttClient'][a17_0x4075('0x36')](a17_0x4075('0x3a'),a17_0x4075('0x3b'));}}exports[a17_0x4075('0x3c')]=MqttService;