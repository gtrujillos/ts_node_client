var a18_0x15e6=['clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','close','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','syncPlaylistsService','registerClient','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','loadMediaList','reloadMediaList','reboot','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening\x20player\x20door','closing','stack','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','child_process','spawn','exec','mqtt','jsonwebtoken','state','closed','httpClientService','init','mqttInit_mosquitto','log','velvety-glazing-252020','my-node-device','my-registry','us-central1','resources/keys/rsa_private.pem','events','projects/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','/config','subscribe','/devices/','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','error','message','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','base64','toString','ascii','packetsend','mqttInit'];(function(_0x5142df,_0x1e7b4c){var _0x574ee5=function(_0x3827be){while(--_0x3827be){_0x5142df['push'](_0x5142df['shift']());}};_0x574ee5(++_0x1e7b4c);}(a18_0x15e6,0x121));var a18_0x4f21=function(_0x5304f1,_0xc19635){_0x5304f1=_0x5304f1-0x0;var _0x23f97e=a18_0x15e6[_0x5304f1];return _0x23f97e;};'use strict';Object[a18_0x4f21('0x0')](exports,a18_0x4f21('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x4f21('0x2'));const fs=require('fs');const fsExtra=require(a18_0x4f21('0x3'));const request=require('request');const progress=require('request-progress');const spawn=require(a18_0x4f21('0x4'))[a18_0x4f21('0x5')];const exec=require('child_process')[a18_0x4f21('0x6')];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require(a18_0x4f21('0x7'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x4f21('0x8'));class MqttService{constructor(_0x48866d){this['syncPlaylistsService']=_0x48866d;this[a18_0x4f21('0x9')]=a18_0x4f21('0xa');this[a18_0x4f21('0xb')]=new HttpClientService_1['HttpClientService']();}[a18_0x4f21('0xc')](){this[a18_0x4f21('0xd')]();}['mqttInit_google'](){console[a18_0x4f21('0xe')]('mqttInit');const _0x11bead=a18_0x4f21('0xf');const _0x4b0be0=a18_0x4f21('0x10');const _0xc11c9d=a18_0x4f21('0x11');const _0x11755b=a18_0x4f21('0x12');const _0x57c9db='RS256';const _0x5f0a54=a18_0x4f21('0x13');const _0x3ca03e='mqtt.googleapis.com';const _0x51eb6c=0x1bb;const _0x2414bd=a18_0x4f21('0x14');const _0x1cc530=0x5;const _0x452e75=a18_0x4f21('0x15')+_0x11bead+'/locations/'+_0x11755b+a18_0x4f21('0x16')+_0xc11c9d+'/devices/'+_0x4b0be0;const _0x3a6106={'host':_0x3ca03e,'port':_0x51eb6c,'clientId':_0x452e75,'username':a18_0x4f21('0x17'),'password':this[a18_0x4f21('0x18')](_0x11bead,_0x5f0a54,_0x57c9db),'protocol':a18_0x4f21('0x19'),'secureProtocol':a18_0x4f21('0x1a')};const _0x414f3a=Math[a18_0x4f21('0x1b')](Date[a18_0x4f21('0x1c')]()/0x3e8);const _0x28ddfa=mqtt[a18_0x4f21('0x1d')](_0x3a6106);_0x28ddfa['subscribe']('/devices/'+_0x4b0be0+a18_0x4f21('0x1e'),{'qos':0x1});_0x28ddfa[a18_0x4f21('0x1f')]('/devices/'+_0x4b0be0+'/state',{'qos':0x1});_0x28ddfa[a18_0x4f21('0x1f')](a18_0x4f21('0x20')+_0x4b0be0+'/commands/#',{'qos':0x0});const _0x3b1864=a18_0x4f21('0x20')+_0x4b0be0+'/'+_0x2414bd;_0x28ddfa['on']('connect',_0x26a136=>{console['log']('connect');if(!_0x26a136){console[a18_0x4f21('0xe')](a18_0x4f21('0x21'));}else{const _0x3b1864=a18_0x4f21('0x22');const _0x15b5b2=_0xc11c9d+'/'+_0x4b0be0+'-payload-0';_0x28ddfa[a18_0x4f21('0x23')](_0x3b1864,_0x15b5b2,{'qos':0x1},_0x188af3=>{console[a18_0x4f21('0xe')](a18_0x4f21('0x24'));console[a18_0x4f21('0xe')](_0x188af3);if(!_0x188af3){}});}});_0x28ddfa['on']('close',()=>{console[a18_0x4f21('0xe')]('close');});_0x28ddfa['on'](a18_0x4f21('0x25'),_0x30588e=>{console[a18_0x4f21('0xe')](a18_0x4f21('0x25'),_0x30588e);});_0x28ddfa['on'](a18_0x4f21('0x26'),(_0x567db1,_0xfe001a)=>{let _0xdc63c1='Message\x20received:\x20';console[a18_0x4f21('0xe')](_0x567db1);console[a18_0x4f21('0xe')](_0xfe001a+'');if(_0x567db1===a18_0x4f21('0x20')+_0x4b0be0+a18_0x4f21('0x1e')){_0xdc63c1=a18_0x4f21('0x27');}else if(_0x567db1[a18_0x4f21('0x28')]('/devices/'+_0x4b0be0+'/commands')){_0xdc63c1=a18_0x4f21('0x29');}_0xdc63c1+=Buffer['from'](_0xfe001a,a18_0x4f21('0x2a'))[a18_0x4f21('0x2b')](a18_0x4f21('0x2c'));console[a18_0x4f21('0xe')](_0xdc63c1);});_0x28ddfa['on'](a18_0x4f21('0x2d'),()=>{});console[a18_0x4f21('0xe')](_0x3a6106);}['mqttInit_mosquitto'](){console['log'](a18_0x4f21('0x2e'));this[a18_0x4f21('0x2f')]=uuidv4();console[a18_0x4f21('0xe')](a18_0x4f21('0x30'));console[a18_0x4f21('0xe')](this[a18_0x4f21('0x2f')]);const _0x505757={'clientId':this['clientId'],'username':a18_0x4f21('0x31'),'password':a18_0x4f21('0x32'),'clean':!![]};this[a18_0x4f21('0x33')]=mqtt[a18_0x4f21('0x1d')](a18_0x4f21('0x34'),_0x505757);this[a18_0x4f21('0x33')]['on']('connect',this[a18_0x4f21('0x35')][a18_0x4f21('0x36')](this));this[a18_0x4f21('0x33')]['on'](a18_0x4f21('0x26'),this['mqttClient_message'][a18_0x4f21('0x36')](this));this['mqttClient']['on'](a18_0x4f21('0x37'),()=>{console[a18_0x4f21('0xe')]('close');});process['on']('exit',this[a18_0x4f21('0x38')][a18_0x4f21('0x36')](this));process['on']('SIGINT',this[a18_0x4f21('0x38')][a18_0x4f21('0x36')](this));process['on'](a18_0x4f21('0x39'),this[a18_0x4f21('0x38')]['bind'](this));}[a18_0x4f21('0x35')](){console[a18_0x4f21('0xe')](a18_0x4f21('0x3a')+this['clientId']);this['mqttClient'][a18_0x4f21('0x1f')](a18_0x4f21('0x3b'));this['mqttClient'][a18_0x4f21('0x1f')](a18_0x4f21('0x3c'));this[a18_0x4f21('0x33')][a18_0x4f21('0x1f')]('player/reboot',{'qos':0x2});this[a18_0x4f21('0x33')]['subscribe'](a18_0x4f21('0x3d'),{'qos':0x2});this[a18_0x4f21('0x33')]['subscribe'](a18_0x4f21('0x3e'),{'qos':0x2});this['mqttClient'][a18_0x4f21('0x1f')](a18_0x4f21('0x3f'),{'qos':0x2});this[a18_0x4f21('0x33')][a18_0x4f21('0x1f')](a18_0x4f21('0x40'),{'qos':0x2});this[a18_0x4f21('0x33')][a18_0x4f21('0x1f')](a18_0x4f21('0x41'),{'qos':0x2});this[a18_0x4f21('0x33')][a18_0x4f21('0x1f')](a18_0x4f21('0x42'),{'qos':0x2});this[a18_0x4f21('0x33')][a18_0x4f21('0x1f')](a18_0x4f21('0x43'),{'qos':0x2});this[a18_0x4f21('0x33')]['subscribe'](a18_0x4f21('0x44'),{'qos':0x2});}[a18_0x4f21('0x45')](){}[a18_0x4f21('0x46')](_0x40c7eb,_0x4e79fb){console[a18_0x4f21('0xe')]('received\x20message\x20%s\x20%s',_0x40c7eb,_0x4e79fb);switch(_0x40c7eb){case'player/open':return this[a18_0x4f21('0x47')](_0x4e79fb);case a18_0x4f21('0x3c'):return this[a18_0x4f21('0x48')](_0x4e79fb);case'player/reboot':return this[a18_0x4f21('0x49')](_0x4e79fb);case a18_0x4f21('0x3e'):return this[a18_0x4f21('0x4a')](_0x4e79fb);case a18_0x4f21('0x3d'):return this[a18_0x4f21('0x4b')](_0x4e79fb);case a18_0x4f21('0x3f'):return this[a18_0x4f21('0x4c')](_0x4e79fb);case'player/ifconfig':return this[a18_0x4f21('0x4d')](_0x4e79fb);case a18_0x4f21('0x41'):return this[a18_0x4f21('0x4e')](_0x4e79fb);case a18_0x4f21('0x42'):return this[a18_0x4f21('0x4f')](_0x4e79fb);case'player/turn_off_tv':return this[a18_0x4f21('0x50')](_0x4e79fb);case'player/turn_on_tv':return this[a18_0x4f21('0x51')](_0x4e79fb);}}['handleRegisterRequest'](_0x537258){if(_0x537258==a18_0x4f21('0x52')||_0x537258==String(this['syncPlaylistsService'][a18_0x4f21('0x53')])){this[a18_0x4f21('0x54')][a18_0x4f21('0x55')]();}}[a18_0x4f21('0x4d')](_0x235534){if(_0x235534=='all'||_0x235534==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){}}['handleUpdateRequest'](_0xcfd2de){console[a18_0x4f21('0xe')](a18_0x4f21('0x56')+_0xcfd2de);if(_0xcfd2de==a18_0x4f21('0x52')||_0xcfd2de==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){const _0x9be5d7=__dirname;const _0x393bc6=require(a18_0x4f21('0x57'))(_0x9be5d7);console[a18_0x4f21('0xe')]('Git\x20updating');_0x393bc6[a18_0x4f21('0x58')]((_0x3fc913,_0x3a859c)=>{if(_0x3fc913){console['log'](a18_0x4f21('0x59'));this[a18_0x4f21('0x4c')](_0xcfd2de);return;}else{}console['log'](a18_0x4f21('0x5a'));console['log'](_0x3a859c);if(_0x3a859c&&_0x3a859c[a18_0x4f21('0x5b')][a18_0x4f21('0x5c')]){this[a18_0x4f21('0x54')]['reboot']();}else{}});}}[a18_0x4f21('0x4b')](_0x4b770c){if(_0x4b770c==a18_0x4f21('0x52')||_0x4b770c==String(this[a18_0x4f21('0x54')]['playerId'])){this['syncPlaylistsService'][a18_0x4f21('0x5d')]();}}[a18_0x4f21('0x4a')](_0x978588){if(String(_0x978588)==a18_0x4f21('0x52')||String(_0x978588)==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){this[a18_0x4f21('0x54')][a18_0x4f21('0x5e')]();}}['handleRebootRequest'](_0x138374){if(_0x138374==a18_0x4f21('0x52')||_0x138374==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){console[a18_0x4f21('0xe')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this['syncPlaylistsService'][a18_0x4f21('0x5f')]();}catch(_0x2a5b0c){console[a18_0x4f21('0xe')](_0x2a5b0c);}}}[a18_0x4f21('0x4f')](_0x14d3f9){if(_0x14d3f9==a18_0x4f21('0x52')||_0x14d3f9==String(this[a18_0x4f21('0x54')]['playerId'])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a18_0x4f21('0x54')][a18_0x4f21('0x60')]();}catch(_0x17bf8a){console[a18_0x4f21('0xe')](_0x17bf8a);}}}[a18_0x4f21('0x51')](_0x217f58){if(_0x217f58==a18_0x4f21('0x52')||_0x217f58==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){console[a18_0x4f21('0xe')](a18_0x4f21('0x61'));try{this[a18_0x4f21('0x54')][a18_0x4f21('0x62')]();}catch(_0x22ded3){console[a18_0x4f21('0xe')](_0x22ded3);}}}['handleTurnOffTVRequest'](_0x448202){if(_0x448202==a18_0x4f21('0x52')||_0x448202==String(this[a18_0x4f21('0x54')][a18_0x4f21('0x53')])){console[a18_0x4f21('0xe')](a18_0x4f21('0x63'));try{this[a18_0x4f21('0x54')][a18_0x4f21('0x64')]();}catch(_0x2da320){console[a18_0x4f21('0xe')](_0x2da320);}}}[a18_0x4f21('0x65')](){console[a18_0x4f21('0xe')](a18_0x4f21('0x66'),this[a18_0x4f21('0x9')]);this[a18_0x4f21('0x33')][a18_0x4f21('0x23')](a18_0x4f21('0x67'),this[a18_0x4f21('0x54')][a18_0x4f21('0x53')]+'-'+this['state']);}['handleOpenRequest'](_0x206ea2){if(this[a18_0x4f21('0x9')]!==a18_0x4f21('0x68')&&this[a18_0x4f21('0x9')]!=='opening'){console['log'](a18_0x4f21('0x69'));this[a18_0x4f21('0x9')]='opening';this[a18_0x4f21('0x65')]();setTimeout(()=>{this['state']=a18_0x4f21('0x68');this[a18_0x4f21('0x65')]();},0x1388);}}[a18_0x4f21('0x48')](_0xaee451){if(this['state']!==a18_0x4f21('0xa')&&this[a18_0x4f21('0x9')]!==a18_0x4f21('0x6a')){this['state']=a18_0x4f21('0x6a');this[a18_0x4f21('0x65')]();setTimeout(()=>{this['state']='closed';this[a18_0x4f21('0x65')]();},0x1388);}}[a18_0x4f21('0x38')](_0x26d86f,_0x381f2c){if(_0x381f2c){console[a18_0x4f21('0xe')](_0x381f2c[a18_0x4f21('0x6b')]);}this[a18_0x4f21('0x33')][a18_0x4f21('0x23')]('player/connected',a18_0x4f21('0x6c'));}['createJwt'](_0x2a6efb,_0x26f22a,_0xcdb889){const _0x1de403={'iat':Math[a18_0x4f21('0x1b')](Date[a18_0x4f21('0x1c')]()/0x3e8),'exp':Math[a18_0x4f21('0x1b')](Date[a18_0x4f21('0x1c')]()/0x3e8)+0x14*0x3c,'aud':_0x2a6efb};const _0x4e8f9a=fs[a18_0x4f21('0x6d')](_0x26f22a);return jwt[a18_0x4f21('0x6e')](_0x1de403,_0x4e8f9a,{'algorithm':_0xcdb889});}}exports[a18_0x4f21('0x6f')]=MqttService;