var a18_0x5931=['turnOnTV','handleTurnOffTVRequest','handleTurnOffTVRequest:\x20','turnOffTV','sending\x20state\x20%s','state','publish','opening','opening\x20player\x20door','sendStateUpdate','closing','stack','player/connected','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','string-template','mqtt','jsonwebtoken','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','round','now','connect','/config','subscribe','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','error','message','Config\x20message\x20received:\x20','startsWith','from','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleTurnOnTVRequest','all','playerId','handleUpdateRequest:\x20','pull','Git\x20updated','summary','changes','handleLoadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest:\x20'];(function(_0x44d977,_0x58c16b){var _0x39a98e=function(_0x19cc71){while(--_0x19cc71){_0x44d977['push'](_0x44d977['shift']());}};_0x39a98e(++_0x58c16b);}(a18_0x5931,0x163));var a18_0x4cd2=function(_0x410025,_0x21308b){_0x410025=_0x410025-0x0;var _0x2bab6d=a18_0x5931[_0x410025];return _0x2bab6d;};'use strict';Object[a18_0x4cd2('0x0')](exports,a18_0x4cd2('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x4cd2('0x2'));const fs=require('fs');const fsExtra=require(a18_0x4cd2('0x3'));const request=require(a18_0x4cd2('0x4'));const progress=require('request-progress');const spawn=require(a18_0x4cd2('0x5'))['spawn'];const exec=require(a18_0x4cd2('0x5'))['exec'];const isImage=require('is-image');const format=require(a18_0x4cd2('0x6'));const os=require('os');const mqtt=require(a18_0x4cd2('0x7'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x4cd2('0x8'));class MqttService{constructor(_0x3c9e11){this[a18_0x4cd2('0x9')]=_0x3c9e11;this['state']=a18_0x4cd2('0xa');this[a18_0x4cd2('0xb')]=new HttpClientService_1[(a18_0x4cd2('0xc'))]();}[a18_0x4cd2('0xd')](){this[a18_0x4cd2('0xe')]();}[a18_0x4cd2('0xf')](){console['log'](a18_0x4cd2('0x10'));const _0x317d3f='velvety-glazing-252020';const _0xffae6a=a18_0x4cd2('0x11');const _0x3192a7=a18_0x4cd2('0x12');const _0x1aaab5=a18_0x4cd2('0x13');const _0x4f6d75=a18_0x4cd2('0x14');const _0x49fe76=a18_0x4cd2('0x15');const _0xdf7888=a18_0x4cd2('0x16');const _0x34aadd=0x1bb;const _0x38b372=a18_0x4cd2('0x17');const _0x517c38=0x5;const _0x20e1ac=a18_0x4cd2('0x18')+_0x317d3f+'/locations/'+_0x1aaab5+a18_0x4cd2('0x19')+_0x3192a7+a18_0x4cd2('0x1a')+_0xffae6a;const _0x49c2f5={'host':_0xdf7888,'port':_0x34aadd,'clientId':_0x20e1ac,'username':a18_0x4cd2('0x1b'),'password':this[a18_0x4cd2('0x1c')](_0x317d3f,_0x49fe76,_0x4f6d75),'protocol':'mqtts','secureProtocol':a18_0x4cd2('0x1d')};const _0x1f754c=Math[a18_0x4cd2('0x1e')](Date[a18_0x4cd2('0x1f')]()/0x3e8);const _0x4339c5=mqtt[a18_0x4cd2('0x20')](_0x49c2f5);_0x4339c5['subscribe'](a18_0x4cd2('0x1a')+_0xffae6a+a18_0x4cd2('0x21'),{'qos':0x1});_0x4339c5[a18_0x4cd2('0x22')](a18_0x4cd2('0x1a')+_0xffae6a+a18_0x4cd2('0x23'),{'qos':0x1});_0x4339c5[a18_0x4cd2('0x22')]('/devices/'+_0xffae6a+a18_0x4cd2('0x24'),{'qos':0x0});const _0x54ebb7=a18_0x4cd2('0x1a')+_0xffae6a+'/'+_0x38b372;_0x4339c5['on'](a18_0x4cd2('0x20'),_0x685cae=>{console[a18_0x4cd2('0x25')](a18_0x4cd2('0x20'));if(!_0x685cae){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x26'));}else{const _0x54ebb7=a18_0x4cd2('0x27');const _0x34e3e4=_0x3192a7+'/'+_0xffae6a+'-payload-0';_0x4339c5['publish'](_0x54ebb7,_0x34e3e4,{'qos':0x1},_0x2ef6c3=>{console[a18_0x4cd2('0x25')](a18_0x4cd2('0x28'));console[a18_0x4cd2('0x25')](_0x2ef6c3);if(!_0x2ef6c3){}});}});_0x4339c5['on'](a18_0x4cd2('0x29'),()=>{console[a18_0x4cd2('0x25')]('close');});_0x4339c5['on'](a18_0x4cd2('0x2a'),_0x3fb0bb=>{console['log'](a18_0x4cd2('0x2a'),_0x3fb0bb);});_0x4339c5['on'](a18_0x4cd2('0x2b'),(_0x445b16,_0x281040)=>{let _0x2115d6='Message\x20received:\x20';console[a18_0x4cd2('0x25')](_0x445b16);console['log'](_0x281040+'');if(_0x445b16===a18_0x4cd2('0x1a')+_0xffae6a+'/config'){_0x2115d6=a18_0x4cd2('0x2c');}else if(_0x445b16[a18_0x4cd2('0x2d')](a18_0x4cd2('0x1a')+_0xffae6a+'/commands')){_0x2115d6='Command\x20message\x20received:\x20';}_0x2115d6+=Buffer[a18_0x4cd2('0x2e')](_0x281040,'base64')[a18_0x4cd2('0x2f')](a18_0x4cd2('0x30'));console[a18_0x4cd2('0x25')](_0x2115d6);});_0x4339c5['on'](a18_0x4cd2('0x31'),()=>{});console[a18_0x4cd2('0x25')](_0x49c2f5);}['mqttInit_mosquitto'](){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x10'));this[a18_0x4cd2('0x32')]=uuidv4();console[a18_0x4cd2('0x25')](a18_0x4cd2('0x33'));console[a18_0x4cd2('0x25')](this[a18_0x4cd2('0x32')]);const _0xeed3f6={'clientId':this[a18_0x4cd2('0x32')],'username':a18_0x4cd2('0x34'),'password':a18_0x4cd2('0x35'),'clean':!![]};this[a18_0x4cd2('0x36')]=mqtt[a18_0x4cd2('0x20')]('mqtt://lulo.run',_0xeed3f6);this['mqttClient']['on'](a18_0x4cd2('0x20'),this[a18_0x4cd2('0x37')][a18_0x4cd2('0x38')](this));this[a18_0x4cd2('0x36')]['on'](a18_0x4cd2('0x2b'),this[a18_0x4cd2('0x39')][a18_0x4cd2('0x38')](this));this['mqttClient']['on'](a18_0x4cd2('0x29'),()=>{console[a18_0x4cd2('0x25')](a18_0x4cd2('0x29'));});process['on'](a18_0x4cd2('0x3a'),this[a18_0x4cd2('0x3b')]['bind'](this));process['on']('SIGINT',this[a18_0x4cd2('0x3b')][a18_0x4cd2('0x38')](this));process['on'](a18_0x4cd2('0x3c'),this['handleAppExit'][a18_0x4cd2('0x38')](this));}[a18_0x4cd2('0x37')](){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x3d')+this['clientId']);this[a18_0x4cd2('0x36')]['subscribe'](a18_0x4cd2('0x3e'));this[a18_0x4cd2('0x36')][a18_0x4cd2('0x22')]('player/close');this['mqttClient'][a18_0x4cd2('0x22')]('player/reboot',{'qos':0x2});this[a18_0x4cd2('0x36')][a18_0x4cd2('0x22')](a18_0x4cd2('0x3f'),{'qos':0x2});this['mqttClient'][a18_0x4cd2('0x22')](a18_0x4cd2('0x40'),{'qos':0x2});this[a18_0x4cd2('0x36')]['subscribe'](a18_0x4cd2('0x41'),{'qos':0x2});this[a18_0x4cd2('0x36')][a18_0x4cd2('0x22')](a18_0x4cd2('0x42'),{'qos':0x2});this[a18_0x4cd2('0x36')][a18_0x4cd2('0x22')](a18_0x4cd2('0x43'),{'qos':0x2});this['mqttClient'][a18_0x4cd2('0x22')](a18_0x4cd2('0x44'),{'qos':0x2});this[a18_0x4cd2('0x36')][a18_0x4cd2('0x22')](a18_0x4cd2('0x45'),{'qos':0x2});this['mqttClient'][a18_0x4cd2('0x22')](a18_0x4cd2('0x46'),{'qos':0x2});}[a18_0x4cd2('0x47')](){}[a18_0x4cd2('0x39')](_0x1b8a89,_0x34e552){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x48'),_0x1b8a89,_0x34e552);switch(_0x1b8a89){case a18_0x4cd2('0x3e'):return this[a18_0x4cd2('0x49')](_0x34e552);case a18_0x4cd2('0x4a'):return this[a18_0x4cd2('0x4b')](_0x34e552);case a18_0x4cd2('0x4c'):return this[a18_0x4cd2('0x4d')](_0x34e552);case'player/reload_playlist':return this[a18_0x4cd2('0x4e')](_0x34e552);case a18_0x4cd2('0x3f'):return this['handleLoadPlaylistRequest'](_0x34e552);case'player/update':return this[a18_0x4cd2('0x4f')](_0x34e552);case a18_0x4cd2('0x42'):return this[a18_0x4cd2('0x50')](_0x34e552);case a18_0x4cd2('0x43'):return this[a18_0x4cd2('0x51')](_0x34e552);case a18_0x4cd2('0x44'):return this['handleUpdateSettingsRequest'](_0x34e552);case a18_0x4cd2('0x45'):return this['handleTurnOffTVRequest'](_0x34e552);case a18_0x4cd2('0x46'):return this[a18_0x4cd2('0x52')](_0x34e552);}}[a18_0x4cd2('0x51')](_0x1aa740){if(_0x1aa740==a18_0x4cd2('0x53')||_0x1aa740==String(this[a18_0x4cd2('0x9')]['playerId'])){this['syncPlaylistsService']['registerClient']();}}[a18_0x4cd2('0x50')](_0x5df609){if(_0x5df609==a18_0x4cd2('0x53')||_0x5df609==String(this[a18_0x4cd2('0x9')][a18_0x4cd2('0x54')])){}}['handleUpdateRequest'](_0x2f8952){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x55')+_0x2f8952);if(_0x2f8952=='all'||_0x2f8952==String(this['syncPlaylistsService']['playerId'])){const _0x1d134f=__dirname;const _0x2e8b3a=require('simple-git')(_0x1d134f);console[a18_0x4cd2('0x25')]('Git\x20updating');_0x2e8b3a[a18_0x4cd2('0x56')]((_0x2df139,_0x2e571e)=>{if(_0x2df139){console['log']('Error\x20git\x20updated');this['handleUpdateRequest'](_0x2f8952);return;}else{}console[a18_0x4cd2('0x25')](a18_0x4cd2('0x57'));console[a18_0x4cd2('0x25')](_0x2e571e);if(_0x2e571e&&_0x2e571e[a18_0x4cd2('0x58')][a18_0x4cd2('0x59')]){this['syncPlaylistsService']['reboot']();}else{}});}}[a18_0x4cd2('0x5a')](_0x13314e){if(_0x13314e==a18_0x4cd2('0x53')||_0x13314e==String(this['syncPlaylistsService']['playerId'])){this[a18_0x4cd2('0x9')]['loadMediaList']();}}['handleReloadPlaylistRequest'](_0x18dbd7){if(String(_0x18dbd7)=='all'||String(_0x18dbd7)==String(this[a18_0x4cd2('0x9')][a18_0x4cd2('0x54')])){this[a18_0x4cd2('0x9')][a18_0x4cd2('0x5b')]();}}[a18_0x4cd2('0x4d')](_0x10edd0){if(_0x10edd0==a18_0x4cd2('0x53')||_0x10edd0==String(this['syncPlaylistsService'][a18_0x4cd2('0x54')])){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x5c'));try{this[a18_0x4cd2('0x9')][a18_0x4cd2('0x5d')]();}catch(_0x4bd2c7){console[a18_0x4cd2('0x25')](_0x4bd2c7);}}}[a18_0x4cd2('0x5e')](_0x128029){if(_0x128029==a18_0x4cd2('0x53')||_0x128029==String(this['syncPlaylistsService']['playerId'])){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x5f'));try{this['syncPlaylistsService']['updateSettings']();}catch(_0x1e7b1a){console['log'](_0x1e7b1a);}}}[a18_0x4cd2('0x52')](_0x327d5d){if(_0x327d5d==a18_0x4cd2('0x53')||_0x327d5d==String(this[a18_0x4cd2('0x9')][a18_0x4cd2('0x54')])){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x60'));try{this[a18_0x4cd2('0x9')][a18_0x4cd2('0x61')]();}catch(_0xef6b9a){console['log'](_0xef6b9a);}}}[a18_0x4cd2('0x62')](_0x26737f){if(_0x26737f==a18_0x4cd2('0x53')||_0x26737f==String(this[a18_0x4cd2('0x9')]['playerId'])){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x63'));try{this[a18_0x4cd2('0x9')][a18_0x4cd2('0x64')]();}catch(_0x23b4ee){console[a18_0x4cd2('0x25')](_0x23b4ee);}}}['sendStateUpdate'](){console[a18_0x4cd2('0x25')](a18_0x4cd2('0x65'),this[a18_0x4cd2('0x66')]);this['mqttClient'][a18_0x4cd2('0x67')]('player/state',this[a18_0x4cd2('0x9')]['playerId']+'-'+this[a18_0x4cd2('0x66')]);}['handleOpenRequest'](_0x4dc3bc){if(this['state']!=='open'&&this[a18_0x4cd2('0x66')]!==a18_0x4cd2('0x68')){console['log'](a18_0x4cd2('0x69'));this[a18_0x4cd2('0x66')]=a18_0x4cd2('0x68');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x4cd2('0x66')]='open';this[a18_0x4cd2('0x6a')]();},0x1388);}}[a18_0x4cd2('0x4b')](_0x1a0192){if(this[a18_0x4cd2('0x66')]!=='closed'&&this['state']!==a18_0x4cd2('0x6b')){this[a18_0x4cd2('0x66')]=a18_0x4cd2('0x6b');this[a18_0x4cd2('0x6a')]();setTimeout(()=>{this[a18_0x4cd2('0x66')]='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x2019e2,_0x3ca272){if(_0x3ca272){console[a18_0x4cd2('0x25')](_0x3ca272[a18_0x4cd2('0x6c')]);}this[a18_0x4cd2('0x36')][a18_0x4cd2('0x67')](a18_0x4cd2('0x6d'),a18_0x4cd2('0x6e'));}[a18_0x4cd2('0x1c')](_0x26dd97,_0x454086,_0x16093d){const _0x4182d7={'iat':Math['round'](Date[a18_0x4cd2('0x1f')]()/0x3e8),'exp':Math[a18_0x4cd2('0x1e')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x26dd97};const _0x2a92b9=fs[a18_0x4cd2('0x6f')](_0x454086);return jwt[a18_0x4cd2('0x70')](_0x4182d7,_0x2a92b9,{'algorithm':_0x16093d});}}exports['MqttService']=MqttService;