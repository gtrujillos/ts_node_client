var a18_0x61b3=['clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist','player/update','player/register','player/update_settings','received\x20message\x20%s\x20%s','handleOpenRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/ifconfig','handleRegisterRequest','handleUpdateSettingsRequest','all','registerClient','handleIfconfigRequest','playerId','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','handleCloseRequest','closed','closing','stack','false','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','httpClientService','init','mqttInit_mosquitto','mqttInit_google','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','projects/','/locations/','/registries/','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/devices/','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','toString','ascii','packetsend'];(function(_0x569df0,_0x4c638b){var _0x27ac36=function(_0x327702){while(--_0x327702){_0x569df0['push'](_0x569df0['shift']());}};_0x27ac36(++_0x4c638b);}(a18_0x61b3,0x1f4));var a18_0x1e86=function(_0x2e2bbe,_0x1445a2){_0x2e2bbe=_0x2e2bbe-0x0;var _0x1c81b8=a18_0x61b3[_0x2e2bbe];return _0x1c81b8;};'use strict';Object[a18_0x1e86('0x0')](exports,a18_0x1e86('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x1e86('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x1e86('0x3'));const progress=require(a18_0x1e86('0x4'));const spawn=require(a18_0x1e86('0x5'))[a18_0x1e86('0x6')];const exec=require(a18_0x1e86('0x5'))['exec'];const isImage=require(a18_0x1e86('0x7'));const format=require(a18_0x1e86('0x8'));const os=require('os');const mqtt=require(a18_0x1e86('0x9'));const uuidv4=require(a18_0x1e86('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x44df75){this[a18_0x1e86('0xb')]=_0x44df75;this[a18_0x1e86('0xc')]='closed';this[a18_0x1e86('0xd')]=new HttpClientService_1['HttpClientService']();}[a18_0x1e86('0xe')](){this[a18_0x1e86('0xf')]();}[a18_0x1e86('0x10')](){console['log']('mqttInit');const _0x3b518a=a18_0x1e86('0x11');const _0x3b0e8d=a18_0x1e86('0x12');const _0x4f5ba7=a18_0x1e86('0x13');const _0x4e663a=a18_0x1e86('0x14');const _0xe6a3c8=a18_0x1e86('0x15');const _0x1e0576=a18_0x1e86('0x16');const _0x10b4d8='mqtt.googleapis.com';const _0x5c80eb=0x1bb;const _0x5e4727='events';const _0x53b0e7=0x5;const _0x49540c=a18_0x1e86('0x17')+_0x3b518a+a18_0x1e86('0x18')+_0x4e663a+a18_0x1e86('0x19')+_0x4f5ba7+'/devices/'+_0x3b0e8d;const _0x55c017={'host':_0x10b4d8,'port':_0x5c80eb,'clientId':_0x49540c,'username':'unused','password':this[a18_0x1e86('0x1a')](_0x3b518a,_0x1e0576,_0xe6a3c8),'protocol':a18_0x1e86('0x1b'),'secureProtocol':a18_0x1e86('0x1c')};const _0x32f3ef=Math[a18_0x1e86('0x1d')](Date[a18_0x1e86('0x1e')]()/0x3e8);const _0x66f492=mqtt[a18_0x1e86('0x1f')](_0x55c017);_0x66f492[a18_0x1e86('0x20')]('/devices/'+_0x3b0e8d+a18_0x1e86('0x21'),{'qos':0x1});_0x66f492['subscribe'](a18_0x1e86('0x22')+_0x3b0e8d+a18_0x1e86('0x23'),{'qos':0x1});_0x66f492['subscribe'](a18_0x1e86('0x22')+_0x3b0e8d+a18_0x1e86('0x24'),{'qos':0x0});const _0x31b204=a18_0x1e86('0x22')+_0x3b0e8d+'/'+_0x5e4727;_0x66f492['on'](a18_0x1e86('0x1f'),_0x228273=>{console[a18_0x1e86('0x25')]('connect');if(!_0x228273){console[a18_0x1e86('0x25')](a18_0x1e86('0x26'));}else{const _0x31b204=a18_0x1e86('0x27');const _0x5d4d0d=_0x4f5ba7+'/'+_0x3b0e8d+a18_0x1e86('0x28');_0x66f492[a18_0x1e86('0x29')](_0x31b204,_0x5d4d0d,{'qos':0x1},_0x419faf=>{console[a18_0x1e86('0x25')](a18_0x1e86('0x2a'));console['log'](_0x419faf);if(!_0x419faf){}});}});_0x66f492['on'](a18_0x1e86('0x2b'),()=>{console[a18_0x1e86('0x25')](a18_0x1e86('0x2b'));});_0x66f492['on'](a18_0x1e86('0x2c'),_0x5cbfc4=>{console[a18_0x1e86('0x25')]('error',_0x5cbfc4);});_0x66f492['on'](a18_0x1e86('0x2d'),(_0x41289d,_0x3651c1)=>{let _0x93392a=a18_0x1e86('0x2e');console[a18_0x1e86('0x25')](_0x41289d);console[a18_0x1e86('0x25')](_0x3651c1+'');if(_0x41289d==='/devices/'+_0x3b0e8d+a18_0x1e86('0x21')){_0x93392a=a18_0x1e86('0x2f');}else if(_0x41289d[a18_0x1e86('0x30')](a18_0x1e86('0x22')+_0x3b0e8d+a18_0x1e86('0x31'))){_0x93392a=a18_0x1e86('0x32');}_0x93392a+=Buffer['from'](_0x3651c1,a18_0x1e86('0x33'))[a18_0x1e86('0x34')](a18_0x1e86('0x35'));console[a18_0x1e86('0x25')](_0x93392a);});_0x66f492['on'](a18_0x1e86('0x36'),()=>{});console[a18_0x1e86('0x25')](_0x55c017);}['mqttInit_mosquitto'](){console[a18_0x1e86('0x25')]('mqttInit');this[a18_0x1e86('0x37')]=uuidv4();console[a18_0x1e86('0x25')](a18_0x1e86('0x38'));console['log'](this['clientId']);const _0x32680c={'clientId':this[a18_0x1e86('0x37')],'username':a18_0x1e86('0x39'),'password':a18_0x1e86('0x3a'),'clean':!![]};this[a18_0x1e86('0x3b')]=mqtt[a18_0x1e86('0x1f')]('mqtt://lulo.run',_0x32680c);this[a18_0x1e86('0x3b')]['on'](a18_0x1e86('0x1f'),this[a18_0x1e86('0x3c')][a18_0x1e86('0x3d')](this));this[a18_0x1e86('0x3b')]['on'](a18_0x1e86('0x2d'),this['mqttClient_message'][a18_0x1e86('0x3d')](this));this['mqttClient']['on'](a18_0x1e86('0x2b'),()=>{console[a18_0x1e86('0x25')](a18_0x1e86('0x2b'));});process['on'](a18_0x1e86('0x3e'),this[a18_0x1e86('0x3f')]['bind'](this));process['on'](a18_0x1e86('0x40'),this[a18_0x1e86('0x3f')][a18_0x1e86('0x3d')](this));process['on'](a18_0x1e86('0x41'),this[a18_0x1e86('0x3f')]['bind'](this));}[a18_0x1e86('0x3c')](){console['log'](a18_0x1e86('0x42')+this[a18_0x1e86('0x37')]);this['mqttClient'][a18_0x1e86('0x20')]('player/open');this['mqttClient']['subscribe'](a18_0x1e86('0x43'));this[a18_0x1e86('0x3b')][a18_0x1e86('0x20')]('player/reboot',{'qos':0x2});this[a18_0x1e86('0x3b')][a18_0x1e86('0x20')](a18_0x1e86('0x44'),{'qos':0x2});this[a18_0x1e86('0x3b')][a18_0x1e86('0x20')](a18_0x1e86('0x45'),{'qos':0x2});this[a18_0x1e86('0x3b')][a18_0x1e86('0x20')](a18_0x1e86('0x46'),{'qos':0x2});this[a18_0x1e86('0x3b')]['subscribe']('player/ifconfig',{'qos':0x2});this[a18_0x1e86('0x3b')]['subscribe'](a18_0x1e86('0x47'),{'qos':0x2});this[a18_0x1e86('0x3b')][a18_0x1e86('0x20')](a18_0x1e86('0x48'),{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x6f5a7d,_0x2539b7){console['log'](a18_0x1e86('0x49'),_0x6f5a7d,_0x2539b7);switch(_0x6f5a7d){case'player/open':return this[a18_0x1e86('0x4a')](_0x2539b7);case a18_0x1e86('0x43'):return this['handleCloseRequest'](_0x2539b7);case a18_0x1e86('0x4b'):return this[a18_0x1e86('0x4c')](_0x2539b7);case'player/reload_playlist':return this[a18_0x1e86('0x4d')](_0x2539b7);case a18_0x1e86('0x44'):return this[a18_0x1e86('0x4e')](_0x2539b7);case a18_0x1e86('0x46'):return this['handleUpdateRequest'](_0x2539b7);case a18_0x1e86('0x4f'):return this['handleIfconfigRequest'](_0x2539b7);case a18_0x1e86('0x47'):return this[a18_0x1e86('0x50')](_0x2539b7);case'player/update_settings':return this[a18_0x1e86('0x51')](_0x2539b7);}}[a18_0x1e86('0x50')](_0x4b12c9){if(_0x4b12c9==a18_0x1e86('0x52')||_0x4b12c9==String(this[a18_0x1e86('0xb')]['playerId'])){this[a18_0x1e86('0xb')][a18_0x1e86('0x53')]();}}[a18_0x1e86('0x54')](_0x5df2b3){if(_0x5df2b3==a18_0x1e86('0x52')||_0x5df2b3==String(this[a18_0x1e86('0xb')][a18_0x1e86('0x55')])){}}[a18_0x1e86('0x56')](_0x5c7e92){console[a18_0x1e86('0x25')](a18_0x1e86('0x57')+_0x5c7e92);if(_0x5c7e92==a18_0x1e86('0x52')||_0x5c7e92==String(this['syncPlaylistsService']['playerId'])){const _0x365437=__dirname;const _0x10ae13=require(a18_0x1e86('0x58'))(_0x365437);console[a18_0x1e86('0x25')]('Git\x20updating');_0x10ae13[a18_0x1e86('0x59')]((_0x24852e,_0x13565a)=>{if(_0x24852e){console[a18_0x1e86('0x25')](a18_0x1e86('0x5a'));this[a18_0x1e86('0x56')](_0x5c7e92);return;}else{}console[a18_0x1e86('0x25')]('Git\x20updated');console['log'](_0x13565a);if(_0x13565a&&_0x13565a[a18_0x1e86('0x5b')][a18_0x1e86('0x5c')]){this[a18_0x1e86('0xb')][a18_0x1e86('0x5d')]();}else{}});}}[a18_0x1e86('0x4e')](_0x86b568){if(_0x86b568==a18_0x1e86('0x52')||_0x86b568==String(this[a18_0x1e86('0xb')][a18_0x1e86('0x55')])){this[a18_0x1e86('0xb')][a18_0x1e86('0x5e')]();}}['handleReloadPlaylistRequest'](_0x5d9bb0){if(String(_0x5d9bb0)==a18_0x1e86('0x52')||String(_0x5d9bb0)==String(this[a18_0x1e86('0xb')][a18_0x1e86('0x55')])){this['syncPlaylistsService'][a18_0x1e86('0x5f')]();}}['handleRebootRequest'](_0x5d825e){if(_0x5d825e==a18_0x1e86('0x52')||_0x5d825e==String(this['syncPlaylistsService'][a18_0x1e86('0x55')])){console[a18_0x1e86('0x25')](a18_0x1e86('0x60'));try{this['syncPlaylistsService']['reboot']();}catch(_0x24e465){console['log'](_0x24e465);}}}[a18_0x1e86('0x51')](_0x8f7494){if(_0x8f7494=='all'||_0x8f7494==String(this[a18_0x1e86('0xb')][a18_0x1e86('0x55')])){console[a18_0x1e86('0x25')]('handleUpdateSettingsRequest:\x20');try{this[a18_0x1e86('0xb')][a18_0x1e86('0x61')]();}catch(_0x45e888){console['log'](_0x45e888);}}}[a18_0x1e86('0x62')](){console[a18_0x1e86('0x25')](a18_0x1e86('0x63'),this[a18_0x1e86('0xc')]);this[a18_0x1e86('0x3b')][a18_0x1e86('0x29')](a18_0x1e86('0x64'),this[a18_0x1e86('0xb')][a18_0x1e86('0x55')]+'-'+this['state']);}[a18_0x1e86('0x4a')](_0x4f3c97){if(this[a18_0x1e86('0xc')]!==a18_0x1e86('0x65')&&this['state']!==a18_0x1e86('0x66')){console[a18_0x1e86('0x25')](a18_0x1e86('0x67'));this['state']=a18_0x1e86('0x66');this[a18_0x1e86('0x62')]();setTimeout(()=>{this[a18_0x1e86('0xc')]=a18_0x1e86('0x65');this['sendStateUpdate']();},0x1388);}}[a18_0x1e86('0x68')](_0x2ab650){if(this['state']!==a18_0x1e86('0x69')&&this[a18_0x1e86('0xc')]!==a18_0x1e86('0x6a')){this[a18_0x1e86('0xc')]=a18_0x1e86('0x6a');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1e86('0xc')]=a18_0x1e86('0x69');this[a18_0x1e86('0x62')]();},0x1388);}}[a18_0x1e86('0x3f')](_0x54daaa,_0x1c7f6f){if(_0x1c7f6f){console['log'](_0x1c7f6f[a18_0x1e86('0x6b')]);}this['mqttClient']['publish']('player/connected',a18_0x1e86('0x6c'));}[a18_0x1e86('0x1a')](_0x21a714,_0x570c84,_0x1011e6){const _0x5bae50={'iat':Math[a18_0x1e86('0x1d')](Date['now']()/0x3e8),'exp':Math[a18_0x1e86('0x1d')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x21a714};const _0x5819fc=fs['readFileSync'](_0x570c84);return jwt[a18_0x1e86('0x6d')](_0x5bae50,_0x5819fc,{'algorithm':_0x1011e6});}}exports[a18_0x1e86('0x6e')]=MqttService;