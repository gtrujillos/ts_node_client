var a18_0x40c4=['./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','uncaughtException','player/open','player/close','player/reboot','subscribe','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','reportStatus','handleOpenRequest','handleRebootRequest','handleLoadPlaylistRequest','player/update','handleRegisterRequest','all','playerId','registerClient','handleIfconfigRequest','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','changes','now','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','sendStateUpdate','publish','player/state','opening\x20player\x20door','opening','open','closing','stack','MqttService','__esModule'];(function(_0x390ef0,_0x1bbc01){var _0x1a6f76=function(_0x327ea6){while(--_0x327ea6){_0x390ef0['push'](_0x390ef0['shift']());}};_0x1a6f76(++_0x1bbc01);}(a18_0x40c4,0x1e9));var a18_0x2c70=function(_0x507537,_0x21b0dc){_0x507537=_0x507537-0x0;var _0x3a4b03=a18_0x40c4[_0x507537];return _0x3a4b03;};'use strict';Object['defineProperty'](exports,a18_0x2c70('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x2c70('0x1'));const fs=require('fs');const fsExtra=require(a18_0x2c70('0x2'));const request=require('request');const progress=require(a18_0x2c70('0x3'));const spawn=require(a18_0x2c70('0x4'))[a18_0x2c70('0x5')];const isImage=require(a18_0x2c70('0x6'));const format=require(a18_0x2c70('0x7'));const os=require('os');const mqtt=require(a18_0x2c70('0x8'));const uuidv4=require(a18_0x2c70('0x9'));class MqttService{constructor(_0x43d70f){this[a18_0x2c70('0xa')]=_0x43d70f;this[a18_0x2c70('0xb')]=a18_0x2c70('0xc');this[a18_0x2c70('0xd')]=new HttpClientService_1[(a18_0x2c70('0xe'))]();}['init'](){this[a18_0x2c70('0xf')]();}[a18_0x2c70('0xf')](){console[a18_0x2c70('0x10')](a18_0x2c70('0xf'));this[a18_0x2c70('0x11')]=uuidv4();console[a18_0x2c70('0x10')](a18_0x2c70('0x12'));console[a18_0x2c70('0x10')](this[a18_0x2c70('0x11')]);const _0x11d2a9={'clientId':this[a18_0x2c70('0x11')],'username':a18_0x2c70('0x13'),'password':a18_0x2c70('0x14'),'clean':!![]};this[a18_0x2c70('0x15')]=mqtt[a18_0x2c70('0x16')](a18_0x2c70('0x17'),_0x11d2a9);this['mqttClient']['on'](a18_0x2c70('0x16'),this[a18_0x2c70('0x18')][a18_0x2c70('0x19')](this));this[a18_0x2c70('0x15')]['on'](a18_0x2c70('0x1a'),this[a18_0x2c70('0x1b')]['bind'](this));process['on'](a18_0x2c70('0x1c'),this['handleAppExit'][a18_0x2c70('0x19')](this));process['on']('SIGINT',this[a18_0x2c70('0x1d')][a18_0x2c70('0x19')](this));process['on'](a18_0x2c70('0x1e'),this['handleAppExit']['bind'](this));}[a18_0x2c70('0x18')](){console[a18_0x2c70('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x2c70('0x11')]);this['mqttClient']['subscribe'](a18_0x2c70('0x1f'));this['mqttClient']['subscribe'](a18_0x2c70('0x20'));this[a18_0x2c70('0x15')]['subscribe'](a18_0x2c70('0x21'),{'qos':0x2});this['mqttClient'][a18_0x2c70('0x22')](a18_0x2c70('0x23'),{'qos':0x2});this[a18_0x2c70('0x15')]['subscribe'](a18_0x2c70('0x24'),{'qos':0x2});this[a18_0x2c70('0x15')][a18_0x2c70('0x22')]('player/update',{'qos':0x2});this[a18_0x2c70('0x15')][a18_0x2c70('0x22')](a18_0x2c70('0x25'),{'qos':0x2});this[a18_0x2c70('0x15')][a18_0x2c70('0x22')](a18_0x2c70('0x26'),{'qos':0x2});}[a18_0x2c70('0x27')](){}['mqttClient_message'](_0x4ebc9d,_0x4c9ee9){console[a18_0x2c70('0x10')]('received\x20message\x20%s\x20%s',_0x4ebc9d,_0x4c9ee9);switch(_0x4ebc9d){case'player/open':return this[a18_0x2c70('0x28')](_0x4c9ee9);case'player/close':return this['handleCloseRequest'](_0x4c9ee9);case a18_0x2c70('0x21'):return this[a18_0x2c70('0x29')](_0x4c9ee9);case a18_0x2c70('0x24'):return this['handleReloadPlaylistRequest'](_0x4c9ee9);case'player/load_playlist':return this[a18_0x2c70('0x2a')](_0x4c9ee9);case a18_0x2c70('0x2b'):return this['handleUpdateRequest'](_0x4c9ee9);case a18_0x2c70('0x25'):return this['handleIfconfigRequest'](_0x4c9ee9);case a18_0x2c70('0x26'):return this[a18_0x2c70('0x2c')](_0x4c9ee9);}}[a18_0x2c70('0x2c')](_0x45079d){if(_0x45079d==a18_0x2c70('0x2d')||_0x45079d==String(this[a18_0x2c70('0xa')][a18_0x2c70('0x2e')])){this[a18_0x2c70('0xa')][a18_0x2c70('0x2f')]();}}[a18_0x2c70('0x30')](_0x1db0a1){if(_0x1db0a1=='all'||_0x1db0a1==String(this['syncPlaylistsService'][a18_0x2c70('0x2e')])){}}[a18_0x2c70('0x31')](_0x327bf1){console[a18_0x2c70('0x10')](a18_0x2c70('0x32')+_0x327bf1);if(_0x327bf1==a18_0x2c70('0x2d')||_0x327bf1==String(this[a18_0x2c70('0xa')]['playerId'])){const _0x18db2f=__dirname;const _0x471cda=require(a18_0x2c70('0x33'))(_0x18db2f);console[a18_0x2c70('0x10')](a18_0x2c70('0x34'));_0x471cda['pull']((_0x26f26e,_0x1c4c7d)=>{if(_0x26f26e){console['log'](a18_0x2c70('0x35'));this['handleUpdateRequest'](_0x327bf1);return;}else{}console[a18_0x2c70('0x10')](a18_0x2c70('0x36'));console[a18_0x2c70('0x10')](_0x1c4c7d);if(_0x1c4c7d&&_0x1c4c7d[a18_0x2c70('0x37')][a18_0x2c70('0x38')]){const _0x325e8c=spawn('shutdown',['-r',a18_0x2c70('0x39')]);}else{}});}}[a18_0x2c70('0x2a')](_0x4cd1f1){if(_0x4cd1f1==a18_0x2c70('0x2d')||_0x4cd1f1==String(this['syncPlaylistsService'][a18_0x2c70('0x2e')])){this[a18_0x2c70('0xa')][a18_0x2c70('0x3a')]();}}[a18_0x2c70('0x3b')](_0x2db2ca){if(String(_0x2db2ca)==a18_0x2c70('0x2d')||String(_0x2db2ca)==String(this['syncPlaylistsService'][a18_0x2c70('0x2e')])){this['syncPlaylistsService'][a18_0x2c70('0x3c')]();}}[a18_0x2c70('0x29')](_0x430231){if(_0x430231==a18_0x2c70('0x2d')||_0x430231==String(this['syncPlaylistsService'][a18_0x2c70('0x2e')])){const _0x267c44=spawn('shutdown',['-r',a18_0x2c70('0x39')]);}}[a18_0x2c70('0x3d')](){console['log']('sending\x20state\x20%s',this[a18_0x2c70('0xb')]);this[a18_0x2c70('0x15')][a18_0x2c70('0x3e')](a18_0x2c70('0x3f'),this[a18_0x2c70('0xa')][a18_0x2c70('0x2e')]+'-'+this[a18_0x2c70('0xb')]);}[a18_0x2c70('0x28')](_0x1fb259){if(this[a18_0x2c70('0xb')]!=='open'&&this[a18_0x2c70('0xb')]!=='opening'){console[a18_0x2c70('0x10')](a18_0x2c70('0x40'));this['state']=a18_0x2c70('0x41');this['sendStateUpdate']();setTimeout(()=>{this['state']=a18_0x2c70('0x42');this[a18_0x2c70('0x3d')]();},0x1388);}}['handleCloseRequest'](_0x589cf7){if(this[a18_0x2c70('0xb')]!==a18_0x2c70('0xc')&&this['state']!==a18_0x2c70('0x43')){this['state']='closing';this[a18_0x2c70('0x3d')]();setTimeout(()=>{this['state']=a18_0x2c70('0xc');this[a18_0x2c70('0x3d')]();},0x1388);}}['handleAppExit'](_0xa2906a,_0x58a17f){if(_0x58a17f){console[a18_0x2c70('0x10')](_0x58a17f[a18_0x2c70('0x44')]);}this[a18_0x2c70('0x15')][a18_0x2c70('0x3e')]('player/connected','false');}}exports[a18_0x2c70('0x45')]=MqttService;