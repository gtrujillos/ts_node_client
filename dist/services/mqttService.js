var a18_0x2496=['handleRegisterRequest','player/update_settings','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','updateSettings','handleTurnOnTVRequest:\x20','handleTurnOffTVRequest:\x20','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','player/connected','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','exec','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','events','projects/','/locations/','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','round','connect','subscribe','/commands/#','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','from','base64','toString','ascii','mqttInit','clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest'];(function(_0x430ef9,_0x388138){var _0xa0fb5f=function(_0x3db78a){while(--_0x3db78a){_0x430ef9['push'](_0x430ef9['shift']());}};_0xa0fb5f(++_0x388138);}(a18_0x2496,0x91));var a18_0x3bb2=function(_0x4cbe00,_0x35d2c7){_0x4cbe00=_0x4cbe00-0x0;var _0x46f629=a18_0x2496[_0x4cbe00];return _0x46f629;};'use strict';Object[a18_0x3bb2('0x0')](exports,a18_0x3bb2('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x3bb2('0x2'));const fs=require('fs');const fsExtra=require(a18_0x3bb2('0x3'));const request=require(a18_0x3bb2('0x4'));const progress=require(a18_0x3bb2('0x5'));const spawn=require(a18_0x3bb2('0x6'))[a18_0x3bb2('0x7')];const exec=require(a18_0x3bb2('0x6'))[a18_0x3bb2('0x8')];const isImage=require('is-image');const format=require(a18_0x3bb2('0x9'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x3bb2('0xa'));const jwt=require(a18_0x3bb2('0xb'));class MqttService{constructor(_0x419f77){this[a18_0x3bb2('0xc')]=_0x419f77;this[a18_0x3bb2('0xd')]=a18_0x3bb2('0xe');this[a18_0x3bb2('0xf')]=new HttpClientService_1['HttpClientService']();}[a18_0x3bb2('0x10')](){this[a18_0x3bb2('0x11')]();}[a18_0x3bb2('0x12')](){console[a18_0x3bb2('0x13')]('mqttInit');const _0x48e1a0=a18_0x3bb2('0x14');const _0xd883a4=a18_0x3bb2('0x15');const _0x329759='my-registry';const _0x1c106f=a18_0x3bb2('0x16');const _0x8b52cc=a18_0x3bb2('0x17');const _0x4188af=a18_0x3bb2('0x18');const _0x2d454b='mqtt.googleapis.com';const _0x2cb6f1=0x1bb;const _0x26cc5a=a18_0x3bb2('0x19');const _0xf623c0=0x5;const _0x1bd833=a18_0x3bb2('0x1a')+_0x48e1a0+a18_0x3bb2('0x1b')+_0x1c106f+a18_0x3bb2('0x1c')+_0x329759+a18_0x3bb2('0x1d')+_0xd883a4;const _0x24d2be={'host':_0x2d454b,'port':_0x2cb6f1,'clientId':_0x1bd833,'username':'unused','password':this[a18_0x3bb2('0x1e')](_0x48e1a0,_0x4188af,_0x8b52cc),'protocol':a18_0x3bb2('0x1f'),'secureProtocol':a18_0x3bb2('0x20')};const _0x4cdebb=Math[a18_0x3bb2('0x21')](Date['now']()/0x3e8);const _0x1b38e3=mqtt[a18_0x3bb2('0x22')](_0x24d2be);_0x1b38e3[a18_0x3bb2('0x23')](a18_0x3bb2('0x1d')+_0xd883a4+'/config',{'qos':0x1});_0x1b38e3[a18_0x3bb2('0x23')](a18_0x3bb2('0x1d')+_0xd883a4+'/state',{'qos':0x1});_0x1b38e3[a18_0x3bb2('0x23')](a18_0x3bb2('0x1d')+_0xd883a4+a18_0x3bb2('0x24'),{'qos':0x0});const _0x265139=a18_0x3bb2('0x1d')+_0xd883a4+'/'+_0x26cc5a;_0x1b38e3['on'](a18_0x3bb2('0x22'),_0xac480c=>{console[a18_0x3bb2('0x13')]('connect');if(!_0xac480c){console['log']('Client\x20not\x20connected...');}else{const _0x265139='/projects/velvety-glazing-252020/topics/my-topic';const _0x49e528=_0x329759+'/'+_0xd883a4+a18_0x3bb2('0x25');_0x1b38e3[a18_0x3bb2('0x26')](_0x265139,_0x49e528,{'qos':0x1},_0x3050a0=>{console['log'](a18_0x3bb2('0x27'));console['log'](_0x3050a0);if(!_0x3050a0){}});}});_0x1b38e3['on'](a18_0x3bb2('0x28'),()=>{console['log'](a18_0x3bb2('0x28'));});_0x1b38e3['on'](a18_0x3bb2('0x29'),_0x5d089f=>{console[a18_0x3bb2('0x13')](a18_0x3bb2('0x29'),_0x5d089f);});_0x1b38e3['on'](a18_0x3bb2('0x2a'),(_0x2bf588,_0x3fe07b)=>{let _0x274d89=a18_0x3bb2('0x2b');console[a18_0x3bb2('0x13')](_0x2bf588);console['log'](_0x3fe07b+'');if(_0x2bf588===a18_0x3bb2('0x1d')+_0xd883a4+a18_0x3bb2('0x2c')){_0x274d89=a18_0x3bb2('0x2d');}else if(_0x2bf588[a18_0x3bb2('0x2e')]('/devices/'+_0xd883a4+'/commands')){_0x274d89='Command\x20message\x20received:\x20';}_0x274d89+=Buffer[a18_0x3bb2('0x2f')](_0x3fe07b,a18_0x3bb2('0x30'))[a18_0x3bb2('0x31')](a18_0x3bb2('0x32'));console[a18_0x3bb2('0x13')](_0x274d89);});_0x1b38e3['on']('packetsend',()=>{});console[a18_0x3bb2('0x13')](_0x24d2be);}[a18_0x3bb2('0x11')](){console[a18_0x3bb2('0x13')](a18_0x3bb2('0x33'));this[a18_0x3bb2('0x34')]=uuidv4();console['log']('this.clientId');console[a18_0x3bb2('0x13')](this[a18_0x3bb2('0x34')]);const _0x287651={'clientId':this[a18_0x3bb2('0x34')],'username':a18_0x3bb2('0x35'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x3bb2('0x36')]=mqtt[a18_0x3bb2('0x22')](a18_0x3bb2('0x37'),_0x287651);this['mqttClient']['on'](a18_0x3bb2('0x22'),this[a18_0x3bb2('0x38')][a18_0x3bb2('0x39')](this));this[a18_0x3bb2('0x36')]['on']('message',this[a18_0x3bb2('0x3a')][a18_0x3bb2('0x39')](this));this[a18_0x3bb2('0x36')]['on'](a18_0x3bb2('0x28'),()=>{console[a18_0x3bb2('0x13')](a18_0x3bb2('0x28'));});process['on'](a18_0x3bb2('0x3b'),this[a18_0x3bb2('0x3c')]['bind'](this));process['on'](a18_0x3bb2('0x3d'),this['handleAppExit'][a18_0x3bb2('0x39')](this));process['on'](a18_0x3bb2('0x3e'),this[a18_0x3bb2('0x3c')][a18_0x3bb2('0x39')](this));}[a18_0x3bb2('0x38')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x3bb2('0x34')]);this['mqttClient'][a18_0x3bb2('0x23')](a18_0x3bb2('0x3f'));this[a18_0x3bb2('0x36')][a18_0x3bb2('0x23')]('player/close');this[a18_0x3bb2('0x36')][a18_0x3bb2('0x23')](a18_0x3bb2('0x40'),{'qos':0x2});this[a18_0x3bb2('0x36')][a18_0x3bb2('0x23')](a18_0x3bb2('0x41'),{'qos':0x2});this[a18_0x3bb2('0x36')][a18_0x3bb2('0x23')](a18_0x3bb2('0x42'),{'qos':0x2});this[a18_0x3bb2('0x36')]['subscribe'](a18_0x3bb2('0x43'),{'qos':0x2});this['mqttClient'][a18_0x3bb2('0x23')](a18_0x3bb2('0x44'),{'qos':0x2});this['mqttClient'][a18_0x3bb2('0x23')](a18_0x3bb2('0x45'),{'qos':0x2});this['mqttClient'][a18_0x3bb2('0x23')]('player/update_settings',{'qos':0x2});this[a18_0x3bb2('0x36')][a18_0x3bb2('0x23')](a18_0x3bb2('0x46'),{'qos':0x2});this[a18_0x3bb2('0x36')]['subscribe'](a18_0x3bb2('0x47'),{'qos':0x2});}[a18_0x3bb2('0x48')](){}[a18_0x3bb2('0x3a')](_0x1dec57,_0x231659){console['log'](a18_0x3bb2('0x49'),_0x1dec57,_0x231659);switch(_0x1dec57){case a18_0x3bb2('0x3f'):return this[a18_0x3bb2('0x4a')](_0x231659);case a18_0x3bb2('0x4b'):return this[a18_0x3bb2('0x4c')](_0x231659);case a18_0x3bb2('0x40'):return this[a18_0x3bb2('0x4d')](_0x231659);case a18_0x3bb2('0x42'):return this[a18_0x3bb2('0x4e')](_0x231659);case a18_0x3bb2('0x41'):return this['handleLoadPlaylistRequest'](_0x231659);case a18_0x3bb2('0x43'):return this[a18_0x3bb2('0x4f')](_0x231659);case a18_0x3bb2('0x44'):return this[a18_0x3bb2('0x50')](_0x231659);case a18_0x3bb2('0x45'):return this[a18_0x3bb2('0x51')](_0x231659);case a18_0x3bb2('0x52'):return this[a18_0x3bb2('0x53')](_0x231659);case'player/turn_off_tv':return this[a18_0x3bb2('0x54')](_0x231659);case a18_0x3bb2('0x47'):return this[a18_0x3bb2('0x55')](_0x231659);}}['handleRegisterRequest'](_0x38165b){if(_0x38165b==a18_0x3bb2('0x56')||_0x38165b==String(this[a18_0x3bb2('0xc')][a18_0x3bb2('0x57')])){this[a18_0x3bb2('0xc')][a18_0x3bb2('0x58')]();}}[a18_0x3bb2('0x50')](_0x3cf97c){if(_0x3cf97c==a18_0x3bb2('0x56')||_0x3cf97c==String(this['syncPlaylistsService']['playerId'])){}}['handleUpdateRequest'](_0x4ffcc5){console['log'](a18_0x3bb2('0x59')+_0x4ffcc5);if(_0x4ffcc5==a18_0x3bb2('0x56')||_0x4ffcc5==String(this[a18_0x3bb2('0xc')][a18_0x3bb2('0x57')])){const _0x2d1779=__dirname;const _0x228f18=require(a18_0x3bb2('0x5a'))(_0x2d1779);console[a18_0x3bb2('0x13')](a18_0x3bb2('0x5b'));_0x228f18[a18_0x3bb2('0x5c')]((_0x261907,_0x12017c)=>{if(_0x261907){console[a18_0x3bb2('0x13')]('Error\x20git\x20updated');this[a18_0x3bb2('0x4f')](_0x4ffcc5);return;}else{}console[a18_0x3bb2('0x13')](a18_0x3bb2('0x5d'));console[a18_0x3bb2('0x13')](_0x12017c);if(_0x12017c&&_0x12017c[a18_0x3bb2('0x5e')][a18_0x3bb2('0x5f')]){this[a18_0x3bb2('0xc')][a18_0x3bb2('0x60')]();}else{}});}}[a18_0x3bb2('0x61')](_0x3ad108){if(_0x3ad108==a18_0x3bb2('0x56')||_0x3ad108==String(this[a18_0x3bb2('0xc')][a18_0x3bb2('0x57')])){this['syncPlaylistsService']['loadMediaList']();}}[a18_0x3bb2('0x4e')](_0x1a158b){if(String(_0x1a158b)==a18_0x3bb2('0x56')||String(_0x1a158b)==String(this[a18_0x3bb2('0xc')][a18_0x3bb2('0x57')])){this[a18_0x3bb2('0xc')]['reloadMediaList']();}}['handleRebootRequest'](_0x1782ca){if(_0x1782ca==a18_0x3bb2('0x56')||_0x1782ca==String(this['syncPlaylistsService'][a18_0x3bb2('0x57')])){console['log']('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a18_0x3bb2('0xc')][a18_0x3bb2('0x60')]();}catch(_0x19721d){console['log'](_0x19721d);}}}[a18_0x3bb2('0x53')](_0x3593cb){if(_0x3593cb=='all'||_0x3593cb==String(this['syncPlaylistsService'][a18_0x3bb2('0x57')])){console[a18_0x3bb2('0x13')]('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a18_0x3bb2('0x62')]();}catch(_0x92eb45){console[a18_0x3bb2('0x13')](_0x92eb45);}}}[a18_0x3bb2('0x55')](_0xe0e854){if(_0xe0e854==a18_0x3bb2('0x56')||_0xe0e854==String(this['syncPlaylistsService'][a18_0x3bb2('0x57')])){console[a18_0x3bb2('0x13')](a18_0x3bb2('0x63'));try{this[a18_0x3bb2('0xc')]['turnOnTV']();}catch(_0x17ed0a){console[a18_0x3bb2('0x13')](_0x17ed0a);}}}[a18_0x3bb2('0x54')](_0x7e17cb){if(_0x7e17cb=='all'||_0x7e17cb==String(this['syncPlaylistsService'][a18_0x3bb2('0x57')])){console[a18_0x3bb2('0x13')](a18_0x3bb2('0x64'));try{this['syncPlaylistsService']['turnOffTV']();}catch(_0x46245b){console['log'](_0x46245b);}}}[a18_0x3bb2('0x65')](){console[a18_0x3bb2('0x13')](a18_0x3bb2('0x66'),this[a18_0x3bb2('0xd')]);this[a18_0x3bb2('0x36')]['publish'](a18_0x3bb2('0x67'),this[a18_0x3bb2('0xc')][a18_0x3bb2('0x57')]+'-'+this[a18_0x3bb2('0xd')]);}[a18_0x3bb2('0x4a')](_0x4d1933){if(this[a18_0x3bb2('0xd')]!==a18_0x3bb2('0x68')&&this[a18_0x3bb2('0xd')]!==a18_0x3bb2('0x69')){console['log'](a18_0x3bb2('0x6a'));this['state']=a18_0x3bb2('0x69');this[a18_0x3bb2('0x65')]();setTimeout(()=>{this['state']=a18_0x3bb2('0x68');this[a18_0x3bb2('0x65')]();},0x1388);}}[a18_0x3bb2('0x4c')](_0x3e2566){if(this[a18_0x3bb2('0xd')]!==a18_0x3bb2('0xe')&&this[a18_0x3bb2('0xd')]!==a18_0x3bb2('0x6b')){this[a18_0x3bb2('0xd')]=a18_0x3bb2('0x6b');this[a18_0x3bb2('0x65')]();setTimeout(()=>{this[a18_0x3bb2('0xd')]=a18_0x3bb2('0xe');this[a18_0x3bb2('0x65')]();},0x1388);}}[a18_0x3bb2('0x3c')](_0x7953b2,_0x1e37af){if(_0x1e37af){console[a18_0x3bb2('0x13')](_0x1e37af['stack']);}this[a18_0x3bb2('0x36')]['publish'](a18_0x3bb2('0x6c'),'false');}['createJwt'](_0x28e5f5,_0x495b39,_0xcf5170){const _0x108e45={'iat':Math[a18_0x3bb2('0x21')](Date[a18_0x3bb2('0x6d')]()/0x3e8),'exp':Math[a18_0x3bb2('0x21')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x28e5f5};const _0xba807a=fs[a18_0x3bb2('0x6e')](_0x495b39);return jwt[a18_0x3bb2('0x6f')](_0x108e45,_0xba807a,{'algorithm':_0xcf5170});}}exports[a18_0x3bb2('0x70')]=MqttService;