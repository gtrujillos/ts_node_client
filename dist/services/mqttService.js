var a18_0x3cb7=['mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','player/reload_playlist','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','summary','changes','reboot','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closed','closing','handleAppExit','stack','player/connected','readFileSync','MqttService','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','exec','is-image','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','init','mqttInit_mosquitto','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/devices/','unused','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/state','/commands/#','log','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','toString','ascii','mqttInit','clientId','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','bind','exit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus'];(function(_0x3ce6e4,_0x3ec82d){var _0x43114c=function(_0x369916){while(--_0x369916){_0x3ce6e4['push'](_0x3ce6e4['shift']());}};_0x43114c(++_0x3ec82d);}(a18_0x3cb7,0x177));var a18_0x5f38=function(_0x54f1e5,_0x90b0dc){_0x54f1e5=_0x54f1e5-0x0;var _0x5023fc=a18_0x3cb7[_0x54f1e5];return _0x5023fc;};'use strict';Object['defineProperty'](exports,a18_0x5f38('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x5f38('0x1'));const fs=require('fs');const fsExtra=require(a18_0x5f38('0x2'));const request=require(a18_0x5f38('0x3'));const progress=require('request-progress');const spawn=require('child_process')['spawn'];const exec=require(a18_0x5f38('0x4'))[a18_0x5f38('0x5')];const isImage=require(a18_0x5f38('0x6'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x5f38('0x7'));const uuidv4=require(a18_0x5f38('0x8'));const jwt=require(a18_0x5f38('0x9'));class MqttService{constructor(_0x43b621){this[a18_0x5f38('0xa')]=_0x43b621;this[a18_0x5f38('0xb')]='closed';this[a18_0x5f38('0xc')]=new HttpClientService_1[(a18_0x5f38('0xd'))]();}[a18_0x5f38('0xe')](){this[a18_0x5f38('0xf')]();}['mqttInit_google'](){console['log']('mqttInit');const _0x4c1704=a18_0x5f38('0x10');const _0x5db063=a18_0x5f38('0x11');const _0x11dd5f=a18_0x5f38('0x12');const _0x3220df=a18_0x5f38('0x13');const _0x350c84=a18_0x5f38('0x14');const _0x166e68=a18_0x5f38('0x15');const _0x5b9251=a18_0x5f38('0x16');const _0x1cec62=0x1bb;const _0x144d87=a18_0x5f38('0x17');const _0x2c844b=0x5;const _0x21af90=a18_0x5f38('0x18')+_0x4c1704+a18_0x5f38('0x19')+_0x3220df+'/registries/'+_0x11dd5f+a18_0x5f38('0x1a')+_0x5db063;const _0x2454a0={'host':_0x5b9251,'port':_0x1cec62,'clientId':_0x21af90,'username':a18_0x5f38('0x1b'),'password':this['createJwt'](_0x4c1704,_0x166e68,_0x350c84),'protocol':a18_0x5f38('0x1c'),'secureProtocol':a18_0x5f38('0x1d')};const _0x17b393=Math[a18_0x5f38('0x1e')](Date[a18_0x5f38('0x1f')]()/0x3e8);const _0x247391=mqtt[a18_0x5f38('0x20')](_0x2454a0);_0x247391[a18_0x5f38('0x21')](a18_0x5f38('0x1a')+_0x5db063+a18_0x5f38('0x22'),{'qos':0x1});_0x247391[a18_0x5f38('0x21')](a18_0x5f38('0x1a')+_0x5db063+a18_0x5f38('0x23'),{'qos':0x1});_0x247391['subscribe'](a18_0x5f38('0x1a')+_0x5db063+a18_0x5f38('0x24'),{'qos':0x0});const _0x262b64='/devices/'+_0x5db063+'/'+_0x144d87;_0x247391['on'](a18_0x5f38('0x20'),_0x413609=>{console[a18_0x5f38('0x25')](a18_0x5f38('0x20'));if(!_0x413609){console[a18_0x5f38('0x25')]('Client\x20not\x20connected...');}else{const _0x262b64=a18_0x5f38('0x26');const _0x58666e=_0x11dd5f+'/'+_0x5db063+a18_0x5f38('0x27');_0x247391[a18_0x5f38('0x28')](_0x262b64,_0x58666e,{'qos':0x1},_0x50e9e5=>{console[a18_0x5f38('0x25')](a18_0x5f38('0x29'));console[a18_0x5f38('0x25')](_0x50e9e5);if(!_0x50e9e5){}});}});_0x247391['on']('close',()=>{console[a18_0x5f38('0x25')](a18_0x5f38('0x2a'));});_0x247391['on']('error',_0x185690=>{console[a18_0x5f38('0x25')](a18_0x5f38('0x2b'),_0x185690);});_0x247391['on'](a18_0x5f38('0x2c'),(_0x22f922,_0x28d13d)=>{let _0x923284=a18_0x5f38('0x2d');console['log'](_0x22f922);console[a18_0x5f38('0x25')](_0x28d13d+'');if(_0x22f922===a18_0x5f38('0x1a')+_0x5db063+a18_0x5f38('0x22')){_0x923284=a18_0x5f38('0x2e');}else if(_0x22f922[a18_0x5f38('0x2f')](a18_0x5f38('0x1a')+_0x5db063+a18_0x5f38('0x30'))){_0x923284=a18_0x5f38('0x31');}_0x923284+=Buffer['from'](_0x28d13d,a18_0x5f38('0x32'))[a18_0x5f38('0x33')](a18_0x5f38('0x34'));console[a18_0x5f38('0x25')](_0x923284);});_0x247391['on']('packetsend',()=>{});console[a18_0x5f38('0x25')](_0x2454a0);}[a18_0x5f38('0xf')](){console['log'](a18_0x5f38('0x35'));this[a18_0x5f38('0x36')]=uuidv4();console[a18_0x5f38('0x25')](a18_0x5f38('0x37'));console[a18_0x5f38('0x25')](this[a18_0x5f38('0x36')]);const _0x376187={'clientId':this[a18_0x5f38('0x36')],'username':a18_0x5f38('0x38'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x5f38('0x39')]=mqtt[a18_0x5f38('0x20')](a18_0x5f38('0x3a'),_0x376187);this[a18_0x5f38('0x39')]['on'](a18_0x5f38('0x20'),this['mqttClient_connect'][a18_0x5f38('0x3b')](this));this[a18_0x5f38('0x39')]['on']('message',this['mqttClient_message'][a18_0x5f38('0x3b')](this));this[a18_0x5f38('0x39')]['on'](a18_0x5f38('0x2a'),()=>{console[a18_0x5f38('0x25')]('close');});process['on'](a18_0x5f38('0x3c'),this['handleAppExit'][a18_0x5f38('0x3b')](this));process['on'](a18_0x5f38('0x3d'),this['handleAppExit'][a18_0x5f38('0x3b')](this));process['on'](a18_0x5f38('0x3e'),this['handleAppExit'][a18_0x5f38('0x3b')](this));}[a18_0x5f38('0x3f')](){console[a18_0x5f38('0x25')](a18_0x5f38('0x40')+this[a18_0x5f38('0x36')]);this[a18_0x5f38('0x39')][a18_0x5f38('0x21')](a18_0x5f38('0x41'));this[a18_0x5f38('0x39')][a18_0x5f38('0x21')]('player/close');this['mqttClient']['subscribe']('player/reboot',{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')](a18_0x5f38('0x42'),{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')]('player/reload_playlist',{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')]('player/update',{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')](a18_0x5f38('0x43'),{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')](a18_0x5f38('0x44'),{'qos':0x2});this['mqttClient'][a18_0x5f38('0x21')](a18_0x5f38('0x45'),{'qos':0x2});this['mqttClient'][a18_0x5f38('0x21')](a18_0x5f38('0x46'),{'qos':0x2});this[a18_0x5f38('0x39')][a18_0x5f38('0x21')](a18_0x5f38('0x47'),{'qos':0x2});}[a18_0x5f38('0x48')](){}[a18_0x5f38('0x49')](_0x2c6254,_0x1d9b60){console[a18_0x5f38('0x25')](a18_0x5f38('0x4a'),_0x2c6254,_0x1d9b60);switch(_0x2c6254){case a18_0x5f38('0x41'):return this[a18_0x5f38('0x4b')](_0x1d9b60);case'player/close':return this['handleCloseRequest'](_0x1d9b60);case'player/reboot':return this['handleRebootRequest'](_0x1d9b60);case a18_0x5f38('0x4c'):return this['handleReloadPlaylistRequest'](_0x1d9b60);case'player/load_playlist':return this[a18_0x5f38('0x4d')](_0x1d9b60);case a18_0x5f38('0x4e'):return this[a18_0x5f38('0x4f')](_0x1d9b60);case'player/ifconfig':return this[a18_0x5f38('0x50')](_0x1d9b60);case a18_0x5f38('0x44'):return this[a18_0x5f38('0x51')](_0x1d9b60);case a18_0x5f38('0x45'):return this[a18_0x5f38('0x52')](_0x1d9b60);case a18_0x5f38('0x46'):return this[a18_0x5f38('0x53')](_0x1d9b60);case a18_0x5f38('0x47'):return this[a18_0x5f38('0x54')](_0x1d9b60);}}[a18_0x5f38('0x51')](_0x5b3760){if(_0x5b3760==a18_0x5f38('0x55')||_0x5b3760==String(this[a18_0x5f38('0xa')]['playerId'])){this[a18_0x5f38('0xa')]['registerClient']();}}[a18_0x5f38('0x50')](_0x21959f){if(_0x21959f=='all'||_0x21959f==String(this['syncPlaylistsService'][a18_0x5f38('0x56')])){}}[a18_0x5f38('0x4f')](_0x198c34){console[a18_0x5f38('0x25')](a18_0x5f38('0x57')+_0x198c34);if(_0x198c34==a18_0x5f38('0x55')||_0x198c34==String(this[a18_0x5f38('0xa')]['playerId'])){const _0x6609f2=__dirname;const _0x57bb33=require(a18_0x5f38('0x58'))(_0x6609f2);console[a18_0x5f38('0x25')](a18_0x5f38('0x59'));_0x57bb33[a18_0x5f38('0x5a')]((_0x27eabc,_0xbe8466)=>{if(_0x27eabc){console['log']('Error\x20git\x20updated');this[a18_0x5f38('0x4f')](_0x198c34);return;}else{}console['log']('Git\x20updated');console['log'](_0xbe8466);if(_0xbe8466&&_0xbe8466[a18_0x5f38('0x5b')][a18_0x5f38('0x5c')]){this['syncPlaylistsService'][a18_0x5f38('0x5d')]();}else{}});}}[a18_0x5f38('0x4d')](_0x16d2e9){if(_0x16d2e9==a18_0x5f38('0x55')||_0x16d2e9==String(this['syncPlaylistsService'][a18_0x5f38('0x56')])){this[a18_0x5f38('0xa')]['loadMediaList']();}}['handleReloadPlaylistRequest'](_0x4304ac){if(String(_0x4304ac)=='all'||String(_0x4304ac)==String(this['syncPlaylistsService']['playerId'])){this[a18_0x5f38('0xa')]['reloadMediaList']();}}['handleRebootRequest'](_0x1cff62){if(_0x1cff62==a18_0x5f38('0x55')||_0x1cff62==String(this['syncPlaylistsService'][a18_0x5f38('0x56')])){console[a18_0x5f38('0x25')](a18_0x5f38('0x5e'));try{this[a18_0x5f38('0xa')][a18_0x5f38('0x5d')]();}catch(_0x45f1b1){console[a18_0x5f38('0x25')](_0x45f1b1);}}}[a18_0x5f38('0x52')](_0x11fc30){if(_0x11fc30=='all'||_0x11fc30==String(this[a18_0x5f38('0xa')]['playerId'])){console[a18_0x5f38('0x25')](a18_0x5f38('0x5f'));try{this[a18_0x5f38('0xa')][a18_0x5f38('0x60')]();}catch(_0x5d12d7){console[a18_0x5f38('0x25')](_0x5d12d7);}}}[a18_0x5f38('0x54')](_0xe034b7){if(_0xe034b7==a18_0x5f38('0x55')||_0xe034b7==String(this[a18_0x5f38('0xa')][a18_0x5f38('0x56')])){console['log'](a18_0x5f38('0x61'));try{this[a18_0x5f38('0xa')]['turnOnTV']();}catch(_0xea0103){console['log'](_0xea0103);}}}[a18_0x5f38('0x53')](_0xc0c7fa){if(_0xc0c7fa==a18_0x5f38('0x55')||_0xc0c7fa==String(this[a18_0x5f38('0xa')][a18_0x5f38('0x56')])){console[a18_0x5f38('0x25')]('handleTurnOffTVRequest:\x20');try{this[a18_0x5f38('0xa')][a18_0x5f38('0x62')]();}catch(_0x38629a){console[a18_0x5f38('0x25')](_0x38629a);}}}[a18_0x5f38('0x63')](){console['log'](a18_0x5f38('0x64'),this[a18_0x5f38('0xb')]);this['mqttClient'][a18_0x5f38('0x28')](a18_0x5f38('0x65'),this[a18_0x5f38('0xa')]['playerId']+'-'+this[a18_0x5f38('0xb')]);}[a18_0x5f38('0x4b')](_0x56af94){if(this[a18_0x5f38('0xb')]!==a18_0x5f38('0x66')&&this[a18_0x5f38('0xb')]!==a18_0x5f38('0x67')){console[a18_0x5f38('0x25')](a18_0x5f38('0x68'));this['state']='opening';this[a18_0x5f38('0x63')]();setTimeout(()=>{this[a18_0x5f38('0xb')]=a18_0x5f38('0x66');this[a18_0x5f38('0x63')]();},0x1388);}}['handleCloseRequest'](_0x2b7306){if(this[a18_0x5f38('0xb')]!==a18_0x5f38('0x69')&&this['state']!=='closing'){this[a18_0x5f38('0xb')]=a18_0x5f38('0x6a');this[a18_0x5f38('0x63')]();setTimeout(()=>{this[a18_0x5f38('0xb')]=a18_0x5f38('0x69');this['sendStateUpdate']();},0x1388);}}[a18_0x5f38('0x6b')](_0x2b73ca,_0x210ecd){if(_0x210ecd){console[a18_0x5f38('0x25')](_0x210ecd[a18_0x5f38('0x6c')]);}this['mqttClient']['publish'](a18_0x5f38('0x6d'),'false');}['createJwt'](_0x34585d,_0x236250,_0x1e10f1){const _0x5e6b93={'iat':Math[a18_0x5f38('0x1e')](Date[a18_0x5f38('0x1f')]()/0x3e8),'exp':Math[a18_0x5f38('0x1e')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x34585d};const _0x3a949f=fs[a18_0x5f38('0x6e')](_0x236250);return jwt['sign'](_0x5e6b93,_0x3a949f,{'algorithm':_0x1e10f1});}}exports[a18_0x5f38('0x6f')]=MqttService;