var a18_0x1eca=['mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','loadMediaList','reloadMediaList','reboot','sendStateUpdate','sending\x20state\x20%s','publish','open','opening','opening\x20player\x20door','closed','closing','stack','player/connected','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','subscribe','/state','connect','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish\x20result:','close','error','message','/config','startsWith','/commands','from','base64','ascii','packetsend','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','handleAppExit','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register'];(function(_0x345098,_0x3999b8){var _0x95f1f1=function(_0x8cadd2){while(--_0x8cadd2){_0x345098['push'](_0x345098['shift']());}};_0x95f1f1(++_0x3999b8);}(a18_0x1eca,0xed));var a18_0x2e87=function(_0x378584,_0x158b43){_0x378584=_0x378584-0x0;var _0x106d7e=a18_0x1eca[_0x378584];return _0x106d7e;};'use strict';Object[a18_0x2e87('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x2e87('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a18_0x2e87('0x2'));const spawn=require(a18_0x2e87('0x3'))[a18_0x2e87('0x4')];const isImage=require(a18_0x2e87('0x5'));const format=require(a18_0x2e87('0x6'));const os=require('os');const mqtt=require(a18_0x2e87('0x7'));const uuidv4=require(a18_0x2e87('0x8'));const jwt=require(a18_0x2e87('0x9'));class MqttService{constructor(_0x37dbf5){this[a18_0x2e87('0xa')]=_0x37dbf5;this[a18_0x2e87('0xb')]='closed';this[a18_0x2e87('0xc')]=new HttpClientService_1[(a18_0x2e87('0xd'))]();}['init'](){this[a18_0x2e87('0xe')]();}[a18_0x2e87('0xf')](){console[a18_0x2e87('0x10')](a18_0x2e87('0x11'));const _0x1f6731=a18_0x2e87('0x12');const _0x4d6c50='my-node-device';const _0x5ed9cd=a18_0x2e87('0x13');const _0x51a7e9='us-central1';const _0x23076c=a18_0x2e87('0x14');const _0x119ba5=a18_0x2e87('0x15');const _0x5eba76=a18_0x2e87('0x16');const _0x42e2bc=0x1bb;const _0x3d2e2c=a18_0x2e87('0x17');const _0x1eb10d=0x5;const _0x4868eb=a18_0x2e87('0x18')+_0x1f6731+a18_0x2e87('0x19')+_0x51a7e9+a18_0x2e87('0x1a')+_0x5ed9cd+a18_0x2e87('0x1b')+_0x4d6c50;const _0x3543e1={'host':_0x5eba76,'port':_0x42e2bc,'clientId':_0x4868eb,'username':a18_0x2e87('0x1c'),'password':this[a18_0x2e87('0x1d')](_0x1f6731,_0x119ba5,_0x23076c),'protocol':a18_0x2e87('0x1e'),'secureProtocol':a18_0x2e87('0x1f')};const _0x7393af=Math[a18_0x2e87('0x20')](Date[a18_0x2e87('0x21')]()/0x3e8);const _0x225590=mqtt['connect'](_0x3543e1);_0x225590[a18_0x2e87('0x22')](a18_0x2e87('0x1b')+_0x4d6c50+'/config',{'qos':0x1});_0x225590[a18_0x2e87('0x22')]('/devices/'+_0x4d6c50+a18_0x2e87('0x23'),{'qos':0x1});_0x225590[a18_0x2e87('0x22')](a18_0x2e87('0x1b')+_0x4d6c50+'/commands/#',{'qos':0x0});const _0x1dd985='/devices/'+_0x4d6c50+'/'+_0x3d2e2c;_0x225590['on']('connect',_0x921cd7=>{console[a18_0x2e87('0x10')](a18_0x2e87('0x24'));if(!_0x921cd7){console[a18_0x2e87('0x10')]('Client\x20not\x20connected...');}else{const _0x1dd985=a18_0x2e87('0x25');const _0xdedca2=_0x5ed9cd+'/'+_0x4d6c50+a18_0x2e87('0x26');_0x225590['publish'](_0x1dd985,_0xdedca2,{'qos':0x1},_0x124e7b=>{console[a18_0x2e87('0x10')](a18_0x2e87('0x27'));console[a18_0x2e87('0x10')](_0x124e7b);if(!_0x124e7b){}});}});_0x225590['on'](a18_0x2e87('0x28'),()=>{console[a18_0x2e87('0x10')](a18_0x2e87('0x28'));});_0x225590['on'](a18_0x2e87('0x29'),_0x3e4a7c=>{console[a18_0x2e87('0x10')]('error',_0x3e4a7c);});_0x225590['on'](a18_0x2e87('0x2a'),(_0x41b020,_0x1ecad2)=>{let _0x4db62c='Message\x20received:\x20';console['log'](_0x41b020);console['log'](_0x1ecad2+'');if(_0x41b020===a18_0x2e87('0x1b')+_0x4d6c50+a18_0x2e87('0x2b')){_0x4db62c='Config\x20message\x20received:\x20';}else if(_0x41b020[a18_0x2e87('0x2c')](a18_0x2e87('0x1b')+_0x4d6c50+a18_0x2e87('0x2d'))){_0x4db62c='Command\x20message\x20received:\x20';}_0x4db62c+=Buffer[a18_0x2e87('0x2e')](_0x1ecad2,a18_0x2e87('0x2f'))['toString'](a18_0x2e87('0x30'));console[a18_0x2e87('0x10')](_0x4db62c);});_0x225590['on'](a18_0x2e87('0x31'),()=>{});console[a18_0x2e87('0x10')](_0x3543e1);}[a18_0x2e87('0xe')](){console[a18_0x2e87('0x10')]('mqttInit');this[a18_0x2e87('0x32')]=uuidv4();console[a18_0x2e87('0x10')]('this.clientId');console['log'](this[a18_0x2e87('0x32')]);const _0x31cf7d={'clientId':this[a18_0x2e87('0x32')],'username':'lulo_mqtt','password':a18_0x2e87('0x33'),'clean':!![]};this[a18_0x2e87('0x34')]=mqtt[a18_0x2e87('0x24')](a18_0x2e87('0x35'),_0x31cf7d);this[a18_0x2e87('0x34')]['on']('connect',this[a18_0x2e87('0x36')][a18_0x2e87('0x37')](this));this[a18_0x2e87('0x34')]['on']('message',this['mqttClient_message'][a18_0x2e87('0x37')](this));this['mqttClient']['on'](a18_0x2e87('0x28'),()=>{console[a18_0x2e87('0x10')](a18_0x2e87('0x28'));});process['on']('exit',this[a18_0x2e87('0x38')][a18_0x2e87('0x37')](this));process['on']('SIGINT',this['handleAppExit'][a18_0x2e87('0x37')](this));process['on'](a18_0x2e87('0x39'),this['handleAppExit'][a18_0x2e87('0x37')](this));}[a18_0x2e87('0x36')](){console[a18_0x2e87('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x2e87('0x32')]);this[a18_0x2e87('0x34')][a18_0x2e87('0x22')](a18_0x2e87('0x3a'));this['mqttClient'][a18_0x2e87('0x22')](a18_0x2e87('0x3b'));this[a18_0x2e87('0x34')][a18_0x2e87('0x22')](a18_0x2e87('0x3c'),{'qos':0x2});this['mqttClient'][a18_0x2e87('0x22')](a18_0x2e87('0x3d'),{'qos':0x2});this[a18_0x2e87('0x34')]['subscribe'](a18_0x2e87('0x3e'),{'qos':0x2});this['mqttClient'][a18_0x2e87('0x22')](a18_0x2e87('0x3f'),{'qos':0x2});this['mqttClient'][a18_0x2e87('0x22')](a18_0x2e87('0x40'),{'qos':0x2});this[a18_0x2e87('0x34')][a18_0x2e87('0x22')](a18_0x2e87('0x41'),{'qos':0x2});}['reportStatus'](){}[a18_0x2e87('0x42')](_0x4ee5b7,_0x285896){console['log'](a18_0x2e87('0x43'),_0x4ee5b7,_0x285896);switch(_0x4ee5b7){case a18_0x2e87('0x3a'):return this[a18_0x2e87('0x44')](_0x285896);case'player/close':return this[a18_0x2e87('0x45')](_0x285896);case a18_0x2e87('0x3c'):return this[a18_0x2e87('0x46')](_0x285896);case a18_0x2e87('0x3e'):return this[a18_0x2e87('0x47')](_0x285896);case a18_0x2e87('0x3d'):return this[a18_0x2e87('0x48')](_0x285896);case a18_0x2e87('0x3f'):return this[a18_0x2e87('0x49')](_0x285896);case a18_0x2e87('0x40'):return this[a18_0x2e87('0x4a')](_0x285896);case'player/register':return this['handleRegisterRequest'](_0x285896);}}['handleRegisterRequest'](_0xa9e6d9){if(_0xa9e6d9=='all'||_0xa9e6d9==String(this['syncPlaylistsService'][a18_0x2e87('0x4b')])){this[a18_0x2e87('0xa')][a18_0x2e87('0x4c')]();}}['handleIfconfigRequest'](_0x52707e){if(_0x52707e==a18_0x2e87('0x4d')||_0x52707e==String(this[a18_0x2e87('0xa')][a18_0x2e87('0x4b')])){}}['handleUpdateRequest'](_0x7c7bc2){console['log'](a18_0x2e87('0x4e')+_0x7c7bc2);if(_0x7c7bc2==a18_0x2e87('0x4d')||_0x7c7bc2==String(this[a18_0x2e87('0xa')][a18_0x2e87('0x4b')])){const _0xc07c52=__dirname;const _0x359fbd=require(a18_0x2e87('0x4f'))(_0xc07c52);console[a18_0x2e87('0x10')](a18_0x2e87('0x50'));_0x359fbd[a18_0x2e87('0x51')]((_0x1b27ed,_0x3796e0)=>{if(_0x1b27ed){console[a18_0x2e87('0x10')]('Error\x20git\x20updated');this[a18_0x2e87('0x49')](_0x7c7bc2);return;}else{}console[a18_0x2e87('0x10')](a18_0x2e87('0x52'));console[a18_0x2e87('0x10')](_0x3796e0);if(_0x3796e0&&_0x3796e0[a18_0x2e87('0x53')][a18_0x2e87('0x54')]){const _0x8b56f9=spawn('shutdown',['-r',a18_0x2e87('0x21')]);}else{}});}}[a18_0x2e87('0x48')](_0x3ef64d){if(_0x3ef64d=='all'||_0x3ef64d==String(this[a18_0x2e87('0xa')][a18_0x2e87('0x4b')])){this['syncPlaylistsService'][a18_0x2e87('0x55')]();}}['handleReloadPlaylistRequest'](_0x2be988){if(String(_0x2be988)=='all'||String(_0x2be988)==String(this[a18_0x2e87('0xa')]['playerId'])){this[a18_0x2e87('0xa')][a18_0x2e87('0x56')]();}}[a18_0x2e87('0x46')](_0x1ec07b){if(_0x1ec07b==a18_0x2e87('0x4d')||_0x1ec07b==String(this[a18_0x2e87('0xa')]['playerId'])){console[a18_0x2e87('0x10')](a18_0x2e87('0x46'));try{require(a18_0x2e87('0x57'))[a18_0x2e87('0x57')]();}catch(_0x2160b0){console[a18_0x2e87('0x10')](_0x2160b0);}}}[a18_0x2e87('0x58')](){console['log'](a18_0x2e87('0x59'),this['state']);this['mqttClient'][a18_0x2e87('0x5a')]('player/state',this['syncPlaylistsService'][a18_0x2e87('0x4b')]+'-'+this['state']);}[a18_0x2e87('0x44')](_0x2075c4){if(this[a18_0x2e87('0xb')]!==a18_0x2e87('0x5b')&&this[a18_0x2e87('0xb')]!==a18_0x2e87('0x5c')){console['log'](a18_0x2e87('0x5d'));this[a18_0x2e87('0xb')]='opening';this[a18_0x2e87('0x58')]();setTimeout(()=>{this[a18_0x2e87('0xb')]='open';this[a18_0x2e87('0x58')]();},0x1388);}}['handleCloseRequest'](_0x436067){if(this[a18_0x2e87('0xb')]!==a18_0x2e87('0x5e')&&this['state']!==a18_0x2e87('0x5f')){this['state']=a18_0x2e87('0x5f');this[a18_0x2e87('0x58')]();setTimeout(()=>{this[a18_0x2e87('0xb')]='closed';this[a18_0x2e87('0x58')]();},0x1388);}}['handleAppExit'](_0x3cc761,_0x45bc76){if(_0x45bc76){console['log'](_0x45bc76[a18_0x2e87('0x60')]);}this['mqttClient'][a18_0x2e87('0x5a')](a18_0x2e87('0x61'),'false');}[a18_0x2e87('0x1d')](_0x37d6a3,_0xa8b47a,_0x5cc843){const _0x1d5e93={'iat':Math[a18_0x2e87('0x20')](Date['now']()/0x3e8),'exp':Math[a18_0x2e87('0x20')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x37d6a3};const _0x4209ab=fs[a18_0x2e87('0x62')](_0xa8b47a);return jwt[a18_0x2e87('0x63')](_0x1d5e93,_0x4209ab,{'algorithm':_0x5cc843});}}exports[a18_0x2e87('0x64')]=MqttService;