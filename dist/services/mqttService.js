var a18_0x44f7=['run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','message','mqttClient_message','bind','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','shutdown','loadMediaList','reloadMediaList','handleRebootRequest','sendStateUpdate','sending\x20state\x20%s','open','opening','opening\x20player\x20door','closed','closing','stack','publish','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','httpClientService','HttpClientService','init','mqttInit','log','clientId','lulo_mqtt'];(function(_0x4607a0,_0x4ff15d){var _0x5a7f11=function(_0x25fb27){while(--_0x25fb27){_0x4607a0['push'](_0x4607a0['shift']());}};_0x5a7f11(++_0x4ff15d);}(a18_0x44f7,0x1e5));var a18_0x1ed8=function(_0x106765,_0x1277b7){_0x106765=_0x106765-0x0;var _0x19f13e=a18_0x44f7[_0x106765];return _0x19f13e;};'use strict';Object[a18_0x1ed8('0x0')](exports,a18_0x1ed8('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x1ed8('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x1ed8('0x3'));const progress=require(a18_0x1ed8('0x4'));const spawn=require('child_process')[a18_0x1ed8('0x5')];const isImage=require(a18_0x1ed8('0x6'));const format=require(a18_0x1ed8('0x7'));const os=require('os');const mqtt=require(a18_0x1ed8('0x8'));const uuidv4=require(a18_0x1ed8('0x9'));class MqttService{constructor(_0x4e7cd2){this[a18_0x1ed8('0xa')]=_0x4e7cd2;this[a18_0x1ed8('0xb')]='closed';this[a18_0x1ed8('0xc')]=new HttpClientService_1[(a18_0x1ed8('0xd'))]();}[a18_0x1ed8('0xe')](){this[a18_0x1ed8('0xf')]();}[a18_0x1ed8('0xf')](){console[a18_0x1ed8('0x10')](a18_0x1ed8('0xf'));this['clientId']=uuidv4();console[a18_0x1ed8('0x10')]('this.clientId');console[a18_0x1ed8('0x10')](this[a18_0x1ed8('0x11')]);const _0x4fb9f7={'clientId':this[a18_0x1ed8('0x11')],'username':a18_0x1ed8('0x12'),'password':a18_0x1ed8('0x13'),'clean':!![]};this[a18_0x1ed8('0x14')]=mqtt[a18_0x1ed8('0x15')](a18_0x1ed8('0x16'),_0x4fb9f7);this['mqttClient']['on'](a18_0x1ed8('0x15'),this[a18_0x1ed8('0x17')]['bind'](this));this['mqttClient']['on'](a18_0x1ed8('0x18'),this[a18_0x1ed8('0x19')][a18_0x1ed8('0x1a')](this));process['on']('exit',this[a18_0x1ed8('0x1b')][a18_0x1ed8('0x1a')](this));process['on'](a18_0x1ed8('0x1c'),this[a18_0x1ed8('0x1b')]['bind'](this));process['on'](a18_0x1ed8('0x1d'),this[a18_0x1ed8('0x1b')][a18_0x1ed8('0x1a')](this));}['mqttClient_connect'](){console[a18_0x1ed8('0x10')](a18_0x1ed8('0x1e')+this['clientId']);this['mqttClient'][a18_0x1ed8('0x1f')](a18_0x1ed8('0x20'));this[a18_0x1ed8('0x14')][a18_0x1ed8('0x1f')](a18_0x1ed8('0x21'));this['mqttClient']['subscribe']('player/reboot',{'qos':0x2});this[a18_0x1ed8('0x14')]['subscribe'](a18_0x1ed8('0x22'),{'qos':0x2});this['mqttClient'][a18_0x1ed8('0x1f')](a18_0x1ed8('0x23'),{'qos':0x2});this[a18_0x1ed8('0x14')]['subscribe'](a18_0x1ed8('0x24'),{'qos':0x2});this[a18_0x1ed8('0x14')][a18_0x1ed8('0x1f')](a18_0x1ed8('0x25'),{'qos':0x2});this[a18_0x1ed8('0x14')][a18_0x1ed8('0x1f')](a18_0x1ed8('0x26'),{'qos':0x2});}[a18_0x1ed8('0x27')](){}[a18_0x1ed8('0x19')](_0x52afc3,_0x4a2eeb){console['log'](a18_0x1ed8('0x28'),_0x52afc3,_0x4a2eeb);switch(_0x52afc3){case'player/open':return this[a18_0x1ed8('0x29')](_0x4a2eeb);case'player/close':return this[a18_0x1ed8('0x2a')](_0x4a2eeb);case'player/reboot':return this['handleRebootRequest'](_0x4a2eeb);case'player/reload_playlist':return this[a18_0x1ed8('0x2b')](_0x4a2eeb);case a18_0x1ed8('0x22'):return this[a18_0x1ed8('0x2c')](_0x4a2eeb);case a18_0x1ed8('0x24'):return this['handleUpdateRequest'](_0x4a2eeb);case a18_0x1ed8('0x25'):return this[a18_0x1ed8('0x2d')](_0x4a2eeb);case a18_0x1ed8('0x26'):return this[a18_0x1ed8('0x2e')](_0x4a2eeb);}}[a18_0x1ed8('0x2e')](_0x14aaca){if(_0x14aaca==a18_0x1ed8('0x2f')||_0x14aaca==String(this[a18_0x1ed8('0xa')][a18_0x1ed8('0x30')])){this[a18_0x1ed8('0xa')]['registerClient']();}}[a18_0x1ed8('0x2d')](_0x1b9054){if(_0x1b9054==a18_0x1ed8('0x2f')||_0x1b9054==String(this[a18_0x1ed8('0xa')][a18_0x1ed8('0x30')])){}}[a18_0x1ed8('0x31')](_0x38b10d){console[a18_0x1ed8('0x10')](a18_0x1ed8('0x32')+_0x38b10d);if(_0x38b10d=='all'||_0x38b10d==String(this['syncPlaylistsService']['playerId'])){const _0x118f77=__dirname;const _0x5b7bd4=require(a18_0x1ed8('0x33'))(_0x118f77);console['log'](a18_0x1ed8('0x34'));_0x5b7bd4['pull']((_0x68f7ac,_0xa0ab8c)=>{if(_0x68f7ac){console[a18_0x1ed8('0x10')](a18_0x1ed8('0x35'));this[a18_0x1ed8('0x31')](_0x38b10d);return;}else{}console['log'](a18_0x1ed8('0x36'));console['log'](_0xa0ab8c);if(_0xa0ab8c&&_0xa0ab8c[a18_0x1ed8('0x37')]['changes']){const _0x299736=spawn(a18_0x1ed8('0x38'),['-r','now']);}else{}});}}[a18_0x1ed8('0x2c')](_0x97826c){if(_0x97826c==a18_0x1ed8('0x2f')||_0x97826c==String(this['syncPlaylistsService'][a18_0x1ed8('0x30')])){this[a18_0x1ed8('0xa')][a18_0x1ed8('0x39')]();}}[a18_0x1ed8('0x2b')](_0x3377af){if(String(_0x3377af)=='all'||String(_0x3377af)==String(this[a18_0x1ed8('0xa')][a18_0x1ed8('0x30')])){this[a18_0x1ed8('0xa')][a18_0x1ed8('0x3a')]();}}[a18_0x1ed8('0x3b')](_0x336412){if(_0x336412=='all'||_0x336412==String(this[a18_0x1ed8('0xa')][a18_0x1ed8('0x30')])){const _0x32ecc1=spawn('shutdown',['-r','now']);}}[a18_0x1ed8('0x3c')](){console[a18_0x1ed8('0x10')](a18_0x1ed8('0x3d'),this[a18_0x1ed8('0xb')]);this[a18_0x1ed8('0x14')]['publish']('player/state',this[a18_0x1ed8('0xa')][a18_0x1ed8('0x30')]+'-'+this['state']);}[a18_0x1ed8('0x29')](_0x4e15be){if(this[a18_0x1ed8('0xb')]!==a18_0x1ed8('0x3e')&&this['state']!==a18_0x1ed8('0x3f')){console[a18_0x1ed8('0x10')](a18_0x1ed8('0x40'));this['state']=a18_0x1ed8('0x3f');this[a18_0x1ed8('0x3c')]();setTimeout(()=>{this[a18_0x1ed8('0xb')]=a18_0x1ed8('0x3e');this[a18_0x1ed8('0x3c')]();},0x1388);}}[a18_0x1ed8('0x2a')](_0x114a69){if(this[a18_0x1ed8('0xb')]!==a18_0x1ed8('0x41')&&this[a18_0x1ed8('0xb')]!==a18_0x1ed8('0x42')){this[a18_0x1ed8('0xb')]=a18_0x1ed8('0x42');this[a18_0x1ed8('0x3c')]();setTimeout(()=>{this[a18_0x1ed8('0xb')]=a18_0x1ed8('0x41');this[a18_0x1ed8('0x3c')]();},0x1388);}}[a18_0x1ed8('0x1b')](_0xf02211,_0x21b5d1){if(_0x21b5d1){console[a18_0x1ed8('0x10')](_0x21b5d1[a18_0x1ed8('0x43')]);}this[a18_0x1ed8('0x14')][a18_0x1ed8('0x44')](a18_0x1ed8('0x45'),a18_0x1ed8('0x46'));}}exports[a18_0x1ed8('0x47')]=MqttService;