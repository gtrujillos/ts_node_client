var a20_0x2053=['player/reload_playlist','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','handleOpenRequest','player/close','handleCloseRequest','player/reboot','handleRebootRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','summary','reboot','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','round','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','child_process','exec','is-image','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','createJwt','TLSv1_2_method','now','/config','subscribe','/commands/#','connect','log','-payload-0','publish','publish\x20result:','close','error','message','startsWith','/commands','Command\x20message\x20received:\x20','from','toString','ascii','mqttInit_mosquitto','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/load_playlist'];(function(_0x535c6f,_0x24efae){var _0x497cb1=function(_0x8b4b81){while(--_0x8b4b81){_0x535c6f['push'](_0x535c6f['shift']());}};_0x497cb1(++_0x24efae);}(a20_0x2053,0x186));var a20_0x63cf=function(_0x45459d,_0x314507){_0x45459d=_0x45459d-0x0;var _0xc76a30=a20_0x2053[_0x45459d];return _0xc76a30;};'use strict';Object[a20_0x63cf('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x63cf('0x1'));const fs=require('fs');const fsExtra=require(a20_0x63cf('0x2'));const request=require(a20_0x63cf('0x3'));const progress=require(a20_0x63cf('0x4'));const spawn=require('child_process')[a20_0x63cf('0x5')];const exec=require(a20_0x63cf('0x6'))[a20_0x63cf('0x7')];const isImage=require(a20_0x63cf('0x8'));const format=require(a20_0x63cf('0x9'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a20_0x63cf('0xa'));const jwt=require(a20_0x63cf('0xb'));class MqttService{constructor(_0x2bfd82){this[a20_0x63cf('0xc')]=_0x2bfd82;this[a20_0x63cf('0xd')]=a20_0x63cf('0xe');this[a20_0x63cf('0xf')]=new HttpClientService_1[(a20_0x63cf('0x10'))]();}[a20_0x63cf('0x11')](){this['mqttInit_mosquitto']();}[a20_0x63cf('0x12')](){console['log'](a20_0x63cf('0x13'));const _0x162e72=a20_0x63cf('0x14');const _0x2a659c=a20_0x63cf('0x15');const _0xa3ccec=a20_0x63cf('0x16');const _0x41f80b=a20_0x63cf('0x17');const _0xc3fb5e=a20_0x63cf('0x18');const _0x50036f=a20_0x63cf('0x19');const _0x34f30b=a20_0x63cf('0x1a');const _0x48b86f=0x1bb;const _0x1a3dbb=a20_0x63cf('0x1b');const _0x764f74=0x5;const _0x32b29c=a20_0x63cf('0x1c')+_0x162e72+a20_0x63cf('0x1d')+_0x41f80b+a20_0x63cf('0x1e')+_0xa3ccec+a20_0x63cf('0x1f')+_0x2a659c;const _0xa0ead0={'host':_0x34f30b,'port':_0x48b86f,'clientId':_0x32b29c,'username':'unused','password':this[a20_0x63cf('0x20')](_0x162e72,_0x50036f,_0xc3fb5e),'protocol':'mqtts','secureProtocol':a20_0x63cf('0x21')};const _0x13b9dc=Math['round'](Date[a20_0x63cf('0x22')]()/0x3e8);const _0x2ddd99=mqtt['connect'](_0xa0ead0);_0x2ddd99['subscribe'](a20_0x63cf('0x1f')+_0x2a659c+a20_0x63cf('0x23'),{'qos':0x1});_0x2ddd99[a20_0x63cf('0x24')](a20_0x63cf('0x1f')+_0x2a659c+'/state',{'qos':0x1});_0x2ddd99[a20_0x63cf('0x24')](a20_0x63cf('0x1f')+_0x2a659c+a20_0x63cf('0x25'),{'qos':0x0});const _0x2b0a11='/devices/'+_0x2a659c+'/'+_0x1a3dbb;_0x2ddd99['on'](a20_0x63cf('0x26'),_0x3cc01d=>{console[a20_0x63cf('0x27')]('connect');if(!_0x3cc01d){console['log']('Client\x20not\x20connected...');}else{const _0x2b0a11='/projects/velvety-glazing-252020/topics/my-topic';const _0x2142e8=_0xa3ccec+'/'+_0x2a659c+a20_0x63cf('0x28');_0x2ddd99[a20_0x63cf('0x29')](_0x2b0a11,_0x2142e8,{'qos':0x1},_0x1724fb=>{console[a20_0x63cf('0x27')](a20_0x63cf('0x2a'));console[a20_0x63cf('0x27')](_0x1724fb);if(!_0x1724fb){}});}});_0x2ddd99['on'](a20_0x63cf('0x2b'),()=>{console[a20_0x63cf('0x27')](a20_0x63cf('0x2b'));});_0x2ddd99['on'](a20_0x63cf('0x2c'),_0x387514=>{console[a20_0x63cf('0x27')](a20_0x63cf('0x2c'),_0x387514);});_0x2ddd99['on'](a20_0x63cf('0x2d'),(_0x343a79,_0x59face)=>{let _0x1ff1fa='Message\x20received:\x20';console[a20_0x63cf('0x27')](_0x343a79);console[a20_0x63cf('0x27')](_0x59face+'');if(_0x343a79===a20_0x63cf('0x1f')+_0x2a659c+'/config'){_0x1ff1fa='Config\x20message\x20received:\x20';}else if(_0x343a79[a20_0x63cf('0x2e')](a20_0x63cf('0x1f')+_0x2a659c+a20_0x63cf('0x2f'))){_0x1ff1fa=a20_0x63cf('0x30');}_0x1ff1fa+=Buffer[a20_0x63cf('0x31')](_0x59face,'base64')[a20_0x63cf('0x32')](a20_0x63cf('0x33'));console[a20_0x63cf('0x27')](_0x1ff1fa);});_0x2ddd99['on']('packetsend',()=>{});console[a20_0x63cf('0x27')](_0xa0ead0);}[a20_0x63cf('0x34')](){console[a20_0x63cf('0x27')](a20_0x63cf('0x13'));this[a20_0x63cf('0x35')]=uuidv4();console[a20_0x63cf('0x27')]('this.clientId');console[a20_0x63cf('0x27')](this[a20_0x63cf('0x35')]);const _0x11afea={'clientId':this['clientId'],'username':a20_0x63cf('0x36'),'password':a20_0x63cf('0x37'),'clean':!![]};this[a20_0x63cf('0x38')]=mqtt[a20_0x63cf('0x26')](a20_0x63cf('0x39'),_0x11afea);this['mqttClient']['on'](a20_0x63cf('0x26'),this['mqttClient_connect'][a20_0x63cf('0x3a')](this));this[a20_0x63cf('0x38')]['on'](a20_0x63cf('0x2d'),this['mqttClient_message'][a20_0x63cf('0x3a')](this));this['mqttClient']['on'](a20_0x63cf('0x2b'),()=>{console[a20_0x63cf('0x27')](a20_0x63cf('0x2b'));});process['on'](a20_0x63cf('0x3b'),this[a20_0x63cf('0x3c')][a20_0x63cf('0x3a')](this));process['on'](a20_0x63cf('0x3d'),this[a20_0x63cf('0x3c')][a20_0x63cf('0x3a')](this));process['on'](a20_0x63cf('0x3e'),this[a20_0x63cf('0x3c')]['bind'](this));}[a20_0x63cf('0x3f')](){console['log'](a20_0x63cf('0x40')+this[a20_0x63cf('0x35')]);this['mqttClient'][a20_0x63cf('0x24')]('player/open');this[a20_0x63cf('0x38')][a20_0x63cf('0x24')]('player/close');this[a20_0x63cf('0x38')]['subscribe']('player/reboot',{'qos':0x2});this[a20_0x63cf('0x38')]['subscribe'](a20_0x63cf('0x41'),{'qos':0x2});this[a20_0x63cf('0x38')]['subscribe'](a20_0x63cf('0x42'),{'qos':0x2});this[a20_0x63cf('0x38')][a20_0x63cf('0x24')]('player/update',{'qos':0x2});this[a20_0x63cf('0x38')]['subscribe'](a20_0x63cf('0x43'),{'qos':0x2});this[a20_0x63cf('0x38')]['subscribe'](a20_0x63cf('0x44'),{'qos':0x2});this['mqttClient'][a20_0x63cf('0x24')](a20_0x63cf('0x45'),{'qos':0x2});this[a20_0x63cf('0x38')][a20_0x63cf('0x24')](a20_0x63cf('0x46'),{'qos':0x2});this[a20_0x63cf('0x38')][a20_0x63cf('0x24')](a20_0x63cf('0x47'),{'qos':0x2});}[a20_0x63cf('0x48')](){}['mqttClient_message'](_0x477047,_0xf8876c){console[a20_0x63cf('0x27')]('received\x20message\x20%s\x20%s',_0x477047,_0xf8876c);switch(_0x477047){case'player/open':return this[a20_0x63cf('0x49')](_0xf8876c);case a20_0x63cf('0x4a'):return this[a20_0x63cf('0x4b')](_0xf8876c);case a20_0x63cf('0x4c'):return this[a20_0x63cf('0x4d')](_0xf8876c);case a20_0x63cf('0x42'):return this['handleReloadPlaylistRequest'](_0xf8876c);case'player/load_playlist':return this[a20_0x63cf('0x4e')](_0xf8876c);case a20_0x63cf('0x4f'):return this[a20_0x63cf('0x50')](_0xf8876c);case a20_0x63cf('0x43'):return this[a20_0x63cf('0x51')](_0xf8876c);case a20_0x63cf('0x44'):return this[a20_0x63cf('0x52')](_0xf8876c);case'player/update_settings':return this['handleUpdateSettingsRequest'](_0xf8876c);case a20_0x63cf('0x46'):return this[a20_0x63cf('0x53')](_0xf8876c);case a20_0x63cf('0x47'):return this[a20_0x63cf('0x54')](_0xf8876c);}}[a20_0x63cf('0x52')](_0x3bb5bd){if(_0x3bb5bd==a20_0x63cf('0x55')||_0x3bb5bd==String(this[a20_0x63cf('0xc')][a20_0x63cf('0x56')])){this[a20_0x63cf('0xc')][a20_0x63cf('0x57')]();}}[a20_0x63cf('0x51')](_0x11e839){if(_0x11e839=='all'||_0x11e839==String(this['syncPlaylistsService'][a20_0x63cf('0x56')])){}}[a20_0x63cf('0x50')](_0x2db840){console[a20_0x63cf('0x27')](a20_0x63cf('0x58')+_0x2db840);if(_0x2db840==a20_0x63cf('0x55')||_0x2db840==String(this['syncPlaylistsService'][a20_0x63cf('0x56')])){const _0x16dc5a=__dirname;const _0x1f9939=require(a20_0x63cf('0x59'))(_0x16dc5a);console[a20_0x63cf('0x27')](a20_0x63cf('0x5a'));_0x1f9939['pull']((_0x25d3be,_0x5af6fc)=>{if(_0x25d3be){console[a20_0x63cf('0x27')]('Error\x20git\x20updated');this[a20_0x63cf('0x50')](_0x2db840);return;}else{}console[a20_0x63cf('0x27')]('Git\x20updated');console['log'](_0x5af6fc);if(_0x5af6fc&&_0x5af6fc[a20_0x63cf('0x5b')]['changes']){this[a20_0x63cf('0xc')][a20_0x63cf('0x5c')]();}else{}});}}['handleLoadPlaylistRequest'](_0x2e1a6b){if(_0x2e1a6b==a20_0x63cf('0x55')||_0x2e1a6b==String(this['syncPlaylistsService']['playerId'])){this[a20_0x63cf('0xc')][a20_0x63cf('0x5d')]();}}[a20_0x63cf('0x5e')](_0x48431e){if(String(_0x48431e)==a20_0x63cf('0x55')||String(_0x48431e)==String(this['syncPlaylistsService'][a20_0x63cf('0x56')])){this[a20_0x63cf('0xc')][a20_0x63cf('0x5f')]();}}['handleRebootRequest'](_0x1d297b){if(_0x1d297b=='all'||_0x1d297b==String(this[a20_0x63cf('0xc')][a20_0x63cf('0x56')])){console[a20_0x63cf('0x27')](a20_0x63cf('0x60'));try{this[a20_0x63cf('0xc')]['reboot']();}catch(_0x5773a2){console[a20_0x63cf('0x27')](_0x5773a2);}}}[a20_0x63cf('0x61')](_0x373921){if(_0x373921=='all'||_0x373921==String(this[a20_0x63cf('0xc')]['playerId'])){console['log']('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService']['updateSettings']();}catch(_0x4f5be5){console[a20_0x63cf('0x27')](_0x4f5be5);}}}['handleTurnOnTVRequest'](_0x248e5e){if(_0x248e5e==a20_0x63cf('0x55')||_0x248e5e==String(this[a20_0x63cf('0xc')][a20_0x63cf('0x56')])){console[a20_0x63cf('0x27')](a20_0x63cf('0x62'));try{this[a20_0x63cf('0xc')][a20_0x63cf('0x63')]();}catch(_0x460892){console['log'](_0x460892);}}}[a20_0x63cf('0x53')](_0x575c7e){if(_0x575c7e=='all'||_0x575c7e==String(this[a20_0x63cf('0xc')][a20_0x63cf('0x56')])){console[a20_0x63cf('0x27')](a20_0x63cf('0x64'));try{this[a20_0x63cf('0xc')]['turnOffTV']();}catch(_0x3ceb79){console['log'](_0x3ceb79);}}}[a20_0x63cf('0x65')](){console[a20_0x63cf('0x27')](a20_0x63cf('0x66'),this['state']);this['mqttClient'][a20_0x63cf('0x29')](a20_0x63cf('0x67'),this[a20_0x63cf('0xc')]['playerId']+'-'+this[a20_0x63cf('0xd')]);}['handleOpenRequest'](_0x526141){if(this[a20_0x63cf('0xd')]!==a20_0x63cf('0x68')&&this['state']!==a20_0x63cf('0x69')){console[a20_0x63cf('0x27')](a20_0x63cf('0x6a'));this[a20_0x63cf('0xd')]=a20_0x63cf('0x69');this[a20_0x63cf('0x65')]();setTimeout(()=>{this['state']=a20_0x63cf('0x68');this[a20_0x63cf('0x65')]();},0x1388);}}[a20_0x63cf('0x4b')](_0x2222ba){if(this[a20_0x63cf('0xd')]!=='closed'&&this['state']!==a20_0x63cf('0x6b')){this[a20_0x63cf('0xd')]=a20_0x63cf('0x6b');this[a20_0x63cf('0x65')]();setTimeout(()=>{this[a20_0x63cf('0xd')]=a20_0x63cf('0xe');this[a20_0x63cf('0x65')]();},0x1388);}}[a20_0x63cf('0x3c')](_0x114edd,_0x2cd34b){if(_0x2cd34b){console[a20_0x63cf('0x27')](_0x2cd34b[a20_0x63cf('0x6c')]);}this['mqttClient']['publish'](a20_0x63cf('0x6d'),a20_0x63cf('0x6e'));}[a20_0x63cf('0x20')](_0x3d3fb5,_0x8478c7,_0x32a9da){const _0x3f2b45={'iat':Math[a20_0x63cf('0x6f')](Date[a20_0x63cf('0x22')]()/0x3e8),'exp':Math[a20_0x63cf('0x6f')](Date[a20_0x63cf('0x22')]()/0x3e8)+0x14*0x3c,'aud':_0x3d3fb5};const _0x2c4a22=fs['readFileSync'](_0x8478c7);return jwt[a20_0x63cf('0x70')](_0x3f2b45,_0x2c4a22,{'algorithm':_0x32a9da});}}exports[a20_0x63cf('0x71')]=MqttService;