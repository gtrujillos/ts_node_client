var a20_0x2fda=['received\x20message\x20%s\x20%s','handleRebootRequest','handleReloadPlaylistRequest','handleIfconfigRequest','player/register','handleRegisterRequest','player/update_settings','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','all','simple-git','Git\x20updating','Error\x20git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','open','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','closed','stack','player/connected','false','now','readFileSync','sign','MqttService','./../infrastructure/HttpClientService','request','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','my-node-device','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','unused','createJwt','mqtts','subscribe','/devices/','/config','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','packetsend','clientId','this.clientId','run.lulo_2018#.','connect','mqttClient','mqttClient_connect','bind','mqttClient_message','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/turn_off_tv','player/turn_on_tv','reportStatus'];(function(_0x1d8f0c,_0x5647f5){var _0x532007=function(_0x51a8a2){while(--_0x51a8a2){_0x1d8f0c['push'](_0x1d8f0c['shift']());}};_0x532007(++_0x5647f5);}(a20_0x2fda,0x1e8));var a20_0xe26a=function(_0x17dc7d,_0x5c037d){_0x17dc7d=_0x17dc7d-0x0;var _0x11e7eb=a20_0x2fda[_0x17dc7d];return _0x11e7eb;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0xe26a('0x0'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0xe26a('0x1'));const progress=require('request-progress');const spawn=require(a20_0xe26a('0x2'))['spawn'];const exec=require(a20_0xe26a('0x2'))[a20_0xe26a('0x3')];const isImage=require(a20_0xe26a('0x4'));const format=require(a20_0xe26a('0x5'));const os=require('os');const mqtt=require(a20_0xe26a('0x6'));const uuidv4=require(a20_0xe26a('0x7'));const jwt=require(a20_0xe26a('0x8'));class MqttService{constructor(_0x5c3974){this[a20_0xe26a('0x9')]=_0x5c3974;this[a20_0xe26a('0xa')]='closed';this[a20_0xe26a('0xb')]=new HttpClientService_1[(a20_0xe26a('0xc'))]();}['init'](){this[a20_0xe26a('0xd')]();}[a20_0xe26a('0xe')](){console['log']('mqttInit');const _0x4e20b1='velvety-glazing-252020';const _0x14cab3=a20_0xe26a('0xf');const _0x34cbd3=a20_0xe26a('0x10');const _0x58495e=a20_0xe26a('0x11');const _0x461e45='RS256';const _0x3680e4=a20_0xe26a('0x12');const _0x17c2bf=a20_0xe26a('0x13');const _0x1c7267=0x1bb;const _0x584fa3=a20_0xe26a('0x14');const _0x7e3ccb=0x5;const _0x4c8418=a20_0xe26a('0x15')+_0x4e20b1+a20_0xe26a('0x16')+_0x58495e+'/registries/'+_0x34cbd3+'/devices/'+_0x14cab3;const _0x2a7178={'host':_0x17c2bf,'port':_0x1c7267,'clientId':_0x4c8418,'username':a20_0xe26a('0x17'),'password':this[a20_0xe26a('0x18')](_0x4e20b1,_0x3680e4,_0x461e45),'protocol':a20_0xe26a('0x19'),'secureProtocol':'TLSv1_2_method'};const _0x58613e=Math['round'](Date['now']()/0x3e8);const _0x1f31c5=mqtt['connect'](_0x2a7178);_0x1f31c5[a20_0xe26a('0x1a')](a20_0xe26a('0x1b')+_0x14cab3+a20_0xe26a('0x1c'),{'qos':0x1});_0x1f31c5[a20_0xe26a('0x1a')](a20_0xe26a('0x1b')+_0x14cab3+a20_0xe26a('0x1d'),{'qos':0x1});_0x1f31c5[a20_0xe26a('0x1a')](a20_0xe26a('0x1b')+_0x14cab3+a20_0xe26a('0x1e'),{'qos':0x0});const _0x441e6c=a20_0xe26a('0x1b')+_0x14cab3+'/'+_0x584fa3;_0x1f31c5['on']('connect',_0x227036=>{console['log']('connect');if(!_0x227036){console[a20_0xe26a('0x1f')](a20_0xe26a('0x20'));}else{const _0x441e6c=a20_0xe26a('0x21');const _0x9011f9=_0x34cbd3+'/'+_0x14cab3+a20_0xe26a('0x22');_0x1f31c5[a20_0xe26a('0x23')](_0x441e6c,_0x9011f9,{'qos':0x1},_0x29e427=>{console[a20_0xe26a('0x1f')](a20_0xe26a('0x24'));console['log'](_0x29e427);if(!_0x29e427){}});}});_0x1f31c5['on'](a20_0xe26a('0x25'),()=>{console[a20_0xe26a('0x1f')](a20_0xe26a('0x25'));});_0x1f31c5['on'](a20_0xe26a('0x26'),_0x449da1=>{console[a20_0xe26a('0x1f')](a20_0xe26a('0x26'),_0x449da1);});_0x1f31c5['on'](a20_0xe26a('0x27'),(_0x7fba70,_0xa70bcf)=>{let _0xf71219=a20_0xe26a('0x28');console[a20_0xe26a('0x1f')](_0x7fba70);console[a20_0xe26a('0x1f')](_0xa70bcf+'');if(_0x7fba70===a20_0xe26a('0x1b')+_0x14cab3+a20_0xe26a('0x1c')){_0xf71219='Config\x20message\x20received:\x20';}else if(_0x7fba70[a20_0xe26a('0x29')](a20_0xe26a('0x1b')+_0x14cab3+a20_0xe26a('0x2a'))){_0xf71219=a20_0xe26a('0x2b');}_0xf71219+=Buffer[a20_0xe26a('0x2c')](_0xa70bcf,'base64')['toString']('ascii');console[a20_0xe26a('0x1f')](_0xf71219);});_0x1f31c5['on'](a20_0xe26a('0x2d'),()=>{});console['log'](_0x2a7178);}[a20_0xe26a('0xd')](){console[a20_0xe26a('0x1f')]('mqttInit');this[a20_0xe26a('0x2e')]=uuidv4();console['log'](a20_0xe26a('0x2f'));console[a20_0xe26a('0x1f')](this[a20_0xe26a('0x2e')]);const _0x1024c6={'clientId':this[a20_0xe26a('0x2e')],'username':'lulo_mqtt','password':a20_0xe26a('0x30'),'clean':!![]};this['mqttClient']=mqtt[a20_0xe26a('0x31')]('mqtt://lulo.run',_0x1024c6);this[a20_0xe26a('0x32')]['on'](a20_0xe26a('0x31'),this[a20_0xe26a('0x33')][a20_0xe26a('0x34')](this));this[a20_0xe26a('0x32')]['on']('message',this[a20_0xe26a('0x35')][a20_0xe26a('0x34')](this));this[a20_0xe26a('0x32')]['on']('close',()=>{console[a20_0xe26a('0x1f')]('close');});process['on']('exit',this['handleAppExit'][a20_0xe26a('0x34')](this));process['on']('SIGINT',this[a20_0xe26a('0x36')][a20_0xe26a('0x34')](this));process['on'](a20_0xe26a('0x37'),this[a20_0xe26a('0x36')][a20_0xe26a('0x34')](this));}['mqttClient_connect'](){console[a20_0xe26a('0x1f')](a20_0xe26a('0x38')+this[a20_0xe26a('0x2e')]);this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x39'));this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x3a'));this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x3b'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0xe26a('0x3c'),{'qos':0x2});this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x3d'),{'qos':0x2});this[a20_0xe26a('0x32')]['subscribe'](a20_0xe26a('0x3e'),{'qos':0x2});this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x3f'),{'qos':0x2});this[a20_0xe26a('0x32')]['subscribe']('player/register',{'qos':0x2});this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')]('player/update_settings',{'qos':0x2});this[a20_0xe26a('0x32')][a20_0xe26a('0x1a')](a20_0xe26a('0x40'),{'qos':0x2});this['mqttClient'][a20_0xe26a('0x1a')](a20_0xe26a('0x41'),{'qos':0x2});}[a20_0xe26a('0x42')](){}[a20_0xe26a('0x35')](_0x2d9de6,_0x34ccc9){console['log'](a20_0xe26a('0x43'),_0x2d9de6,_0x34ccc9);switch(_0x2d9de6){case a20_0xe26a('0x39'):return this['handleOpenRequest'](_0x34ccc9);case a20_0xe26a('0x3a'):return this['handleCloseRequest'](_0x34ccc9);case a20_0xe26a('0x3b'):return this[a20_0xe26a('0x44')](_0x34ccc9);case a20_0xe26a('0x3d'):return this[a20_0xe26a('0x45')](_0x34ccc9);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0x34ccc9);case'player/update':return this['handleUpdateRequest'](_0x34ccc9);case a20_0xe26a('0x3f'):return this[a20_0xe26a('0x46')](_0x34ccc9);case a20_0xe26a('0x47'):return this[a20_0xe26a('0x48')](_0x34ccc9);case a20_0xe26a('0x49'):return this[a20_0xe26a('0x4a')](_0x34ccc9);case a20_0xe26a('0x40'):return this[a20_0xe26a('0x4b')](_0x34ccc9);case'player/turn_on_tv':return this[a20_0xe26a('0x4c')](_0x34ccc9);}}[a20_0xe26a('0x48')](_0x4cc3f5){if(_0x4cc3f5=='all'||_0x4cc3f5==String(this['syncPlaylistsService'][a20_0xe26a('0x4d')])){this['syncPlaylistsService'][a20_0xe26a('0x4e')]();}}[a20_0xe26a('0x46')](_0x21bdc9){if(_0x21bdc9=='all'||_0x21bdc9==String(this['syncPlaylistsService'][a20_0xe26a('0x4d')])){}}[a20_0xe26a('0x4f')](_0x3efc59){console[a20_0xe26a('0x1f')](a20_0xe26a('0x50')+_0x3efc59);if(_0x3efc59==a20_0xe26a('0x51')||_0x3efc59==String(this[a20_0xe26a('0x9')][a20_0xe26a('0x4d')])){const _0xc592a9=__dirname;const _0x6f129e=require(a20_0xe26a('0x52'))(_0xc592a9);console[a20_0xe26a('0x1f')](a20_0xe26a('0x53'));_0x6f129e['pull']((_0xb4145c,_0x2ed0e0)=>{if(_0xb4145c){console['log'](a20_0xe26a('0x54'));this['handleUpdateRequest'](_0x3efc59);return;}else{}console[a20_0xe26a('0x1f')]('Git\x20updated');console[a20_0xe26a('0x1f')](_0x2ed0e0);if(_0x2ed0e0&&_0x2ed0e0[a20_0xe26a('0x55')][a20_0xe26a('0x56')]){this[a20_0xe26a('0x9')][a20_0xe26a('0x57')]();}else{}});}}[a20_0xe26a('0x58')](_0x137699){if(_0x137699=='all'||_0x137699==String(this['syncPlaylistsService']['playerId'])){this[a20_0xe26a('0x9')][a20_0xe26a('0x59')]();}}[a20_0xe26a('0x45')](_0x16a997){if(String(_0x16a997)=='all'||String(_0x16a997)==String(this['syncPlaylistsService'][a20_0xe26a('0x4d')])){this['syncPlaylistsService'][a20_0xe26a('0x5a')]();}}['handleRebootRequest'](_0x1af437){if(_0x1af437==a20_0xe26a('0x51')||_0x1af437==String(this['syncPlaylistsService'][a20_0xe26a('0x4d')])){console[a20_0xe26a('0x1f')](a20_0xe26a('0x5b'));try{this['syncPlaylistsService'][a20_0xe26a('0x57')]();}catch(_0x2eacc4){console[a20_0xe26a('0x1f')](_0x2eacc4);}}}['handleUpdateSettingsRequest'](_0x1ba53a){if(_0x1ba53a==a20_0xe26a('0x51')||_0x1ba53a==String(this[a20_0xe26a('0x9')][a20_0xe26a('0x4d')])){console[a20_0xe26a('0x1f')](a20_0xe26a('0x5c'));try{this['syncPlaylistsService'][a20_0xe26a('0x5d')]();}catch(_0xceb090){console['log'](_0xceb090);}}}[a20_0xe26a('0x4c')](_0x1d424e){if(_0x1d424e=='all'||_0x1d424e==String(this['syncPlaylistsService']['playerId'])){console[a20_0xe26a('0x1f')](a20_0xe26a('0x5e'));try{this['syncPlaylistsService'][a20_0xe26a('0x5f')]();}catch(_0x55a573){console[a20_0xe26a('0x1f')](_0x55a573);}}}[a20_0xe26a('0x4b')](_0x521371){if(_0x521371==a20_0xe26a('0x51')||_0x521371==String(this[a20_0xe26a('0x9')][a20_0xe26a('0x4d')])){console[a20_0xe26a('0x1f')](a20_0xe26a('0x60'));try{this[a20_0xe26a('0x9')][a20_0xe26a('0x61')]();}catch(_0x947a5c){console['log'](_0x947a5c);}}}['sendStateUpdate'](){console['log']('sending\x20state\x20%s',this['state']);this[a20_0xe26a('0x32')][a20_0xe26a('0x23')]('player/state',this[a20_0xe26a('0x9')][a20_0xe26a('0x4d')]+'-'+this[a20_0xe26a('0xa')]);}['handleOpenRequest'](_0x15c050){if(this[a20_0xe26a('0xa')]!==a20_0xe26a('0x62')&&this['state']!=='opening'){console[a20_0xe26a('0x1f')](a20_0xe26a('0x63'));this[a20_0xe26a('0xa')]='opening';this[a20_0xe26a('0x64')]();setTimeout(()=>{this[a20_0xe26a('0xa')]=a20_0xe26a('0x62');this['sendStateUpdate']();},0x1388);}}[a20_0xe26a('0x65')](_0x23683d){if(this['state']!=='closed'&&this[a20_0xe26a('0xa')]!==a20_0xe26a('0x66')){this[a20_0xe26a('0xa')]=a20_0xe26a('0x66');this[a20_0xe26a('0x64')]();setTimeout(()=>{this[a20_0xe26a('0xa')]=a20_0xe26a('0x67');this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x45a2e4,_0x1e95e5){if(_0x1e95e5){console[a20_0xe26a('0x1f')](_0x1e95e5[a20_0xe26a('0x68')]);}this[a20_0xe26a('0x32')][a20_0xe26a('0x23')](a20_0xe26a('0x69'),a20_0xe26a('0x6a'));}['createJwt'](_0x8c6913,_0x15c27a,_0x4db9e0){const _0x333d35={'iat':Math['round'](Date[a20_0xe26a('0x6b')]()/0x3e8),'exp':Math['round'](Date[a20_0xe26a('0x6b')]()/0x3e8)+0x14*0x3c,'aud':_0x8c6913};const _0x199471=fs[a20_0xe26a('0x6c')](_0x15c27a);return jwt[a20_0xe26a('0x6d')](_0x333d35,_0x199471,{'algorithm':_0x4db9e0});}}exports[a20_0xe26a('0x6e')]=MqttService;