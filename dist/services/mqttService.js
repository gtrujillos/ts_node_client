var a17_0x4c36=['closing','stack','player/connected','false','__esModule','request-progress','child_process','is-image','state','syncPlaylistsService','init','mqttInit','log','clientId','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/close','subscribe','player/reboot','player/load_playlist','player/reload_playlist','player/update','registerClient','playerId','stringify','networkInterfaces','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','now','loadMediaList','shutdown','sendStateUpdate','sending\x20state\x20%s','publish','open','opening\x20player\x20door','opening','closed'];(function(_0x54a9c3,_0x4959b0){var _0x4f4e1d=function(_0x1a1c96){while(--_0x1a1c96){_0x54a9c3['push'](_0x54a9c3['shift']());}};_0x4f4e1d(++_0x4959b0);}(a17_0x4c36,0xf0));var a17_0x27ad=function(_0x156a07,_0x2bf99d){_0x156a07=_0x156a07-0x0;var _0x462c44=a17_0x4c36[_0x156a07];return _0x462c44;};'use strict';Object['defineProperty'](exports,a17_0x27ad('0x0'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a17_0x27ad('0x1'));const spawn=require(a17_0x27ad('0x2'))['spawn'];const isImage=require(a17_0x27ad('0x3'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');class MqttService{constructor(_0x5da814){this[a17_0x27ad('0x4')]='closed';this[a17_0x27ad('0x5')]=_0x5da814;}[a17_0x27ad('0x6')](){this[a17_0x27ad('0x7')]();}[a17_0x27ad('0x7')](){console[a17_0x27ad('0x8')](a17_0x27ad('0x7'));this[a17_0x27ad('0x9')]=uuidv4();const _0xc83253={'clientId':this[a17_0x27ad('0x9')],'username':'lulo_mqtt','password':a17_0x27ad('0xa'),'clean':!![]};this[a17_0x27ad('0xb')]=mqtt[a17_0x27ad('0xc')](a17_0x27ad('0xd'),_0xc83253);this[a17_0x27ad('0xb')]['on']('connect',this[a17_0x27ad('0xe')][a17_0x27ad('0xf')](this));this['mqttClient']['on']('message',this[a17_0x27ad('0x10')][a17_0x27ad('0xf')](this));process['on'](a17_0x27ad('0x11'),this[a17_0x27ad('0x12')][a17_0x27ad('0xf')](this));process['on'](a17_0x27ad('0x13'),this[a17_0x27ad('0x12')][a17_0x27ad('0xf')](this));process['on']('uncaughtException',this[a17_0x27ad('0x12')]['bind'](this));}[a17_0x27ad('0xe')](){console['log'](a17_0x27ad('0x14')+this[a17_0x27ad('0x9')]);this[a17_0x27ad('0xb')]['subscribe']('player/open');this[a17_0x27ad('0xb')]['subscribe'](a17_0x27ad('0x15'));this[a17_0x27ad('0xb')][a17_0x27ad('0x16')](a17_0x27ad('0x17'),{'qos':0x2});this[a17_0x27ad('0xb')][a17_0x27ad('0x16')](a17_0x27ad('0x18'),{'qos':0x2});this[a17_0x27ad('0xb')]['subscribe'](a17_0x27ad('0x19'),{'qos':0x2});this[a17_0x27ad('0xb')][a17_0x27ad('0x16')](a17_0x27ad('0x1a'),{'qos':0x2});this[a17_0x27ad('0x1b')]();}[a17_0x27ad('0x1b')](){const _0x5ba2eb={'playerId':this['syncPlaylistsService'][a17_0x27ad('0x1c')],'clientId':this[a17_0x27ad('0x9')],'connected':!![],'network':JSON[a17_0x27ad('0x1d')](os[a17_0x27ad('0x1e')]())};console[a17_0x27ad('0x8')](_0x5ba2eb);}[a17_0x27ad('0x1f')](){}[a17_0x27ad('0x10')](_0x3de639,_0x3b87a2){console[a17_0x27ad('0x8')](a17_0x27ad('0x20'),_0x3de639,_0x3b87a2);switch(_0x3de639){case'player/open':return this[a17_0x27ad('0x21')](_0x3b87a2);case a17_0x27ad('0x15'):return this[a17_0x27ad('0x22')](_0x3b87a2);case a17_0x27ad('0x17'):return this[a17_0x27ad('0x23')](_0x3b87a2);case a17_0x27ad('0x19'):return this[a17_0x27ad('0x24')](_0x3b87a2);case a17_0x27ad('0x18'):return this[a17_0x27ad('0x25')](_0x3b87a2);case'player/update':return this[a17_0x27ad('0x26')](_0x3b87a2);}}[a17_0x27ad('0x26')](_0x56134e){if(_0x56134e==a17_0x27ad('0x27')||_0x56134e==String(this[a17_0x27ad('0x5')][a17_0x27ad('0x1c')])){const _0x59e007=__dirname;const _0xded80d=require(a17_0x27ad('0x28'))(_0x59e007);console[a17_0x27ad('0x8')](a17_0x27ad('0x29'));_0xded80d['pull']((_0x4be235,_0x287810)=>{if(_0x4be235){console[a17_0x27ad('0x8')](a17_0x27ad('0x2a'));this[a17_0x27ad('0x26')](_0x56134e);return;}else{}console['log'](a17_0x27ad('0x2b'));console[a17_0x27ad('0x8')](_0x287810);if(_0x287810&&_0x287810[a17_0x27ad('0x2c')]['changes']){const _0x9ad0e3=spawn('shutdown',['-r',a17_0x27ad('0x2d')]);}else{}});}}[a17_0x27ad('0x25')](_0x28e057){if(_0x28e057=='all'||_0x28e057==String(this[a17_0x27ad('0x5')][a17_0x27ad('0x1c')])){this[a17_0x27ad('0x5')][a17_0x27ad('0x2e')]();}}[a17_0x27ad('0x24')](_0x9436e3){if(_0x9436e3=='all'||_0x9436e3==String(this['syncPlaylistsService'][a17_0x27ad('0x1c')])){this[a17_0x27ad('0x5')]['reloadMediaList']();}}[a17_0x27ad('0x23')](_0x50e0bd){if(_0x50e0bd=='all'||_0x50e0bd==String(this['syncPlaylistsService'][a17_0x27ad('0x1c')])){const _0x5c82d7=spawn(a17_0x27ad('0x2f'),['-r',a17_0x27ad('0x2d')]);}}[a17_0x27ad('0x30')](){console[a17_0x27ad('0x8')](a17_0x27ad('0x31'),this[a17_0x27ad('0x4')]);this[a17_0x27ad('0xb')][a17_0x27ad('0x32')]('player/state',this[a17_0x27ad('0x5')][a17_0x27ad('0x1c')]+'-'+this[a17_0x27ad('0x4')]);}['handleOpenRequest'](_0x2a6749){if(this[a17_0x27ad('0x4')]!==a17_0x27ad('0x33')&&this[a17_0x27ad('0x4')]!=='opening'){console['log'](a17_0x27ad('0x34'));this[a17_0x27ad('0x4')]=a17_0x27ad('0x35');this[a17_0x27ad('0x30')]();setTimeout(()=>{this[a17_0x27ad('0x4')]='open';this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x596c2a){if(this[a17_0x27ad('0x4')]!==a17_0x27ad('0x36')&&this['state']!=='closing'){this[a17_0x27ad('0x4')]=a17_0x27ad('0x37');this[a17_0x27ad('0x30')]();setTimeout(()=>{this[a17_0x27ad('0x4')]=a17_0x27ad('0x36');this[a17_0x27ad('0x30')]();},0x1388);}}[a17_0x27ad('0x12')](_0x4f5664,_0x53f408){if(_0x53f408){console[a17_0x27ad('0x8')](_0x53f408[a17_0x27ad('0x38')]);}this[a17_0x27ad('0xb')][a17_0x27ad('0x32')](a17_0x27ad('0x39'),a17_0x27ad('0x3a'));}}exports['MqttService']=MqttService;