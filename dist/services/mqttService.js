var a17_0x47fd=['is-image','string-template','mqtt','uuid/v4','state','closed','init','mqttInit','clientId','lulo_mqtt','mqttClient','connect','mqttClient_connect','mqttClient_message','bind','exit','handleAppExit','SIGINT','uncaughtException','log','subscribe','player/open','player/close','player/reboot','player/reload_playlist','player/update','registerClient','syncPlaylistsService','stringify','handleOpenRequest','player/load_playlist','handleLoadPlaylistRequest','handleUpdateRequest','pull','Error\x20git\x20updated','Git\x20updated','shutdown','all','playerId','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest','now','sending\x20state\x20%s','player/state','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','fs-extra','request','request-progress','child_process'];(function(_0x44a169,_0x2c7fd7){var _0x47b30d=function(_0x162a6e){while(--_0x162a6e){_0x44a169['push'](_0x44a169['shift']());}};_0x47b30d(++_0x2c7fd7);}(a17_0x47fd,0x1a5));var a17_0x430d=function(_0x1d19b6,_0x798630){_0x1d19b6=_0x1d19b6-0x0;var _0x1a3c53=a17_0x47fd[_0x1d19b6];return _0x1a3c53;};'use strict';Object[a17_0x430d('0x0')](exports,a17_0x430d('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require(a17_0x430d('0x2'));const request=require(a17_0x430d('0x3'));const progress=require(a17_0x430d('0x4'));const spawn=require(a17_0x430d('0x5'))['spawn'];const isImage=require(a17_0x430d('0x6'));const format=require(a17_0x430d('0x7'));const os=require('os');const mqtt=require(a17_0x430d('0x8'));const uuidv4=require(a17_0x430d('0x9'));class MqttService{constructor(_0x1418c4){this[a17_0x430d('0xa')]=a17_0x430d('0xb');this['syncPlaylistsService']=_0x1418c4;}[a17_0x430d('0xc')](){this[a17_0x430d('0xd')]();}['mqttInit'](){console['log'](a17_0x430d('0xd'));this[a17_0x430d('0xe')]=uuidv4();const _0x143999={'clientId':this[a17_0x430d('0xe')],'username':a17_0x430d('0xf'),'password':'run.lulo_2018#.','clean':!![]};this[a17_0x430d('0x10')]=mqtt['connect']('mqtt://lulo.run',_0x143999);this[a17_0x430d('0x10')]['on'](a17_0x430d('0x11'),this[a17_0x430d('0x12')]['bind'](this));this[a17_0x430d('0x10')]['on']('message',this[a17_0x430d('0x13')][a17_0x430d('0x14')](this));process['on'](a17_0x430d('0x15'),this[a17_0x430d('0x16')][a17_0x430d('0x14')](this));process['on'](a17_0x430d('0x17'),this[a17_0x430d('0x16')][a17_0x430d('0x14')](this));process['on'](a17_0x430d('0x18'),this[a17_0x430d('0x16')][a17_0x430d('0x14')](this));}['mqttClient_connect'](){console[a17_0x430d('0x19')]('Connected\x20to\x20broker\x20client:'+this['clientId']);this[a17_0x430d('0x10')][a17_0x430d('0x1a')](a17_0x430d('0x1b'));this[a17_0x430d('0x10')]['subscribe'](a17_0x430d('0x1c'));this[a17_0x430d('0x10')][a17_0x430d('0x1a')](a17_0x430d('0x1d'),{'qos':0x2});this[a17_0x430d('0x10')][a17_0x430d('0x1a')]('player/load_playlist',{'qos':0x2});this[a17_0x430d('0x10')][a17_0x430d('0x1a')](a17_0x430d('0x1e'),{'qos':0x2});this[a17_0x430d('0x10')]['subscribe'](a17_0x430d('0x1f'),{'qos':0x2});this[a17_0x430d('0x20')]();}[a17_0x430d('0x20')](){const _0x599c2e={'playerId':this[a17_0x430d('0x21')]['playerId'],'clientId':this['clientId'],'connected':!![],'network':JSON[a17_0x430d('0x22')](os['networkInterfaces']())};console[a17_0x430d('0x19')](_0x599c2e);}['reportStatus'](){}[a17_0x430d('0x13')](_0x17d0ae,_0x55054e){console['log']('received\x20message\x20%s\x20%s',_0x17d0ae,_0x55054e);switch(_0x17d0ae){case a17_0x430d('0x1b'):return this[a17_0x430d('0x23')](_0x55054e);case a17_0x430d('0x1c'):return this['handleCloseRequest'](_0x55054e);case a17_0x430d('0x1d'):return this['handleRebootRequest'](_0x55054e);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x55054e);case a17_0x430d('0x24'):return this[a17_0x430d('0x25')](_0x55054e);case a17_0x430d('0x1f'):return this['handleUpdateRequest'](_0x55054e);}}[a17_0x430d('0x26')](_0x360b42){if(_0x360b42=='all'||_0x360b42==String(this[a17_0x430d('0x21')]['playerId'])){const _0x493d29=__dirname;const _0xb15319=require('simple-git')(_0x493d29);console[a17_0x430d('0x19')]('Git\x20updating');_0xb15319[a17_0x430d('0x27')]((_0x3f312f,_0x45ee45)=>{if(_0x3f312f){console[a17_0x430d('0x19')](a17_0x430d('0x28'));this[a17_0x430d('0x26')](_0x360b42);return;}else{}console[a17_0x430d('0x19')](a17_0x430d('0x29'));console['log'](_0x45ee45);if(_0x45ee45&&_0x45ee45['summary']['changes']){const _0x38912b=spawn(a17_0x430d('0x2a'),['-r','now']);}else{}});}}[a17_0x430d('0x25')](_0x374149){if(_0x374149==a17_0x430d('0x2b')||_0x374149==String(this[a17_0x430d('0x21')][a17_0x430d('0x2c')])){this['syncPlaylistsService'][a17_0x430d('0x2d')]();}}[a17_0x430d('0x2e')](_0x546513){if(_0x546513=='all'||_0x546513==String(this[a17_0x430d('0x21')][a17_0x430d('0x2c')])){this['syncPlaylistsService'][a17_0x430d('0x2f')]();}}[a17_0x430d('0x30')](_0xd5c0f0){if(_0xd5c0f0==a17_0x430d('0x2b')||_0xd5c0f0==String(this[a17_0x430d('0x21')]['playerId'])){const _0x37fe88=spawn(a17_0x430d('0x2a'),['-r',a17_0x430d('0x31')]);}}['sendStateUpdate'](){console['log'](a17_0x430d('0x32'),this['state']);this['mqttClient']['publish'](a17_0x430d('0x33'),this[a17_0x430d('0x21')][a17_0x430d('0x2c')]+'-'+this[a17_0x430d('0xa')]);}['handleOpenRequest'](_0x37b7b3){if(this[a17_0x430d('0xa')]!=='open'&&this[a17_0x430d('0xa')]!==a17_0x430d('0x34')){console[a17_0x430d('0x19')](a17_0x430d('0x35'));this[a17_0x430d('0xa')]='opening';this[a17_0x430d('0x36')]();setTimeout(()=>{this[a17_0x430d('0xa')]='open';this[a17_0x430d('0x36')]();},0x1388);}}[a17_0x430d('0x37')](_0x239932){if(this[a17_0x430d('0xa')]!==a17_0x430d('0xb')&&this[a17_0x430d('0xa')]!==a17_0x430d('0x38')){this[a17_0x430d('0xa')]='closing';this[a17_0x430d('0x36')]();setTimeout(()=>{this[a17_0x430d('0xa')]=a17_0x430d('0xb');this[a17_0x430d('0x36')]();},0x1388);}}[a17_0x430d('0x16')](_0x57852b,_0xeacac0){if(_0xeacac0){console['log'](_0xeacac0[a17_0x430d('0x39')]);}this[a17_0x430d('0x10')]['publish'](a17_0x430d('0x3a'),a17_0x430d('0x3b'));}}exports[a17_0x430d('0x3c')]=MqttService;