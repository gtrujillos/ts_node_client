var a20_0x14ae=['request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','state','httpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','subscribe','/config','/commands/#','connect','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','packetsend','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','reportStatus','received\x20message\x20%s\x20%s','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','player/turn_on_tv','handleTurnOnTVRequest','all','playerId','syncPlaylistsService','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleUpdateSettingsRequest:\x20','updateSettings','turnOnTV','handleTurnOffTVRequest:\x20','sending\x20state\x20%s','player/state','handleOpenRequest','open','opening','sendStateUpdate','closed','closing','player/connected','false','sign','defineProperty','fs-extra','request'];(function(_0x54dba0,_0x369c0f){var _0x3ed341=function(_0x674d05){while(--_0x674d05){_0x54dba0['push'](_0x54dba0['shift']());}};_0x3ed341(++_0x369c0f);}(a20_0x14ae,0xdf));var a20_0x51dd=function(_0x4e54be,_0x4bffa8){_0x4e54be=_0x4e54be-0x0;var _0x2d171e=a20_0x14ae[_0x4e54be];return _0x2d171e;};'use strict';Object[a20_0x51dd('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a20_0x51dd('0x1'));const request=require(a20_0x51dd('0x2'));const progress=require(a20_0x51dd('0x3'));const spawn=require(a20_0x51dd('0x4'))[a20_0x51dd('0x5')];const exec=require(a20_0x51dd('0x4'))[a20_0x51dd('0x6')];const isImage=require(a20_0x51dd('0x7'));const format=require(a20_0x51dd('0x8'));const os=require('os');const mqtt=require(a20_0x51dd('0x9'));const uuidv4=require(a20_0x51dd('0xa'));const jwt=require(a20_0x51dd('0xb'));class MqttService{constructor(_0x496ef1){this['syncPlaylistsService']=_0x496ef1;this[a20_0x51dd('0xc')]='closed';this[a20_0x51dd('0xd')]=new HttpClientService_1['HttpClientService']();}[a20_0x51dd('0xe')](){this[a20_0x51dd('0xf')]();}[a20_0x51dd('0x10')](){console[a20_0x51dd('0x11')](a20_0x51dd('0x12'));const _0x267431=a20_0x51dd('0x13');const _0x5e5ec6=a20_0x51dd('0x14');const _0x62f95e='my-registry';const _0x1f853e='us-central1';const _0x337d98=a20_0x51dd('0x15');const _0x34d5ad=a20_0x51dd('0x16');const _0x4230db=a20_0x51dd('0x17');const _0x4ea113=0x1bb;const _0x6fe7ff='events';const _0x5d7270=0x5;const _0x502e16='projects/'+_0x267431+a20_0x51dd('0x18')+_0x1f853e+a20_0x51dd('0x19')+_0x62f95e+a20_0x51dd('0x1a')+_0x5e5ec6;const _0x56e297={'host':_0x4230db,'port':_0x4ea113,'clientId':_0x502e16,'username':a20_0x51dd('0x1b'),'password':this[a20_0x51dd('0x1c')](_0x267431,_0x34d5ad,_0x337d98),'protocol':a20_0x51dd('0x1d'),'secureProtocol':a20_0x51dd('0x1e')};const _0xada67d=Math[a20_0x51dd('0x1f')](Date[a20_0x51dd('0x20')]()/0x3e8);const _0x439507=mqtt['connect'](_0x56e297);_0x439507[a20_0x51dd('0x21')]('/devices/'+_0x5e5ec6+a20_0x51dd('0x22'),{'qos':0x1});_0x439507['subscribe'](a20_0x51dd('0x1a')+_0x5e5ec6+'/state',{'qos':0x1});_0x439507[a20_0x51dd('0x21')](a20_0x51dd('0x1a')+_0x5e5ec6+a20_0x51dd('0x23'),{'qos':0x0});const _0x2f286b='/devices/'+_0x5e5ec6+'/'+_0x6fe7ff;_0x439507['on'](a20_0x51dd('0x24'),_0x3a5747=>{console['log'](a20_0x51dd('0x24'));if(!_0x3a5747){console['log'](a20_0x51dd('0x25'));}else{const _0x2f286b='/projects/velvety-glazing-252020/topics/my-topic';const _0x27ee73=_0x62f95e+'/'+_0x5e5ec6+a20_0x51dd('0x26');_0x439507[a20_0x51dd('0x27')](_0x2f286b,_0x27ee73,{'qos':0x1},_0x13b016=>{console[a20_0x51dd('0x11')](a20_0x51dd('0x28'));console[a20_0x51dd('0x11')](_0x13b016);if(!_0x13b016){}});}});_0x439507['on']('close',()=>{console[a20_0x51dd('0x11')](a20_0x51dd('0x29'));});_0x439507['on']('error',_0x1dcf13=>{console[a20_0x51dd('0x11')](a20_0x51dd('0x2a'),_0x1dcf13);});_0x439507['on'](a20_0x51dd('0x2b'),(_0x165d70,_0x4b57e3)=>{let _0x5ec95a=a20_0x51dd('0x2c');console[a20_0x51dd('0x11')](_0x165d70);console[a20_0x51dd('0x11')](_0x4b57e3+'');if(_0x165d70==='/devices/'+_0x5e5ec6+a20_0x51dd('0x22')){_0x5ec95a=a20_0x51dd('0x2d');}else if(_0x165d70[a20_0x51dd('0x2e')](a20_0x51dd('0x1a')+_0x5e5ec6+'/commands')){_0x5ec95a=a20_0x51dd('0x2f');}_0x5ec95a+=Buffer[a20_0x51dd('0x30')](_0x4b57e3,'base64')['toString']('ascii');console[a20_0x51dd('0x11')](_0x5ec95a);});_0x439507['on'](a20_0x51dd('0x31'),()=>{});console['log'](_0x56e297);}['mqttInit_mosquitto'](){console[a20_0x51dd('0x11')](a20_0x51dd('0x12'));this['clientId']=uuidv4();console[a20_0x51dd('0x11')]('this.clientId');console['log'](this[a20_0x51dd('0x32')]);const _0xd2031b={'clientId':this[a20_0x51dd('0x32')],'username':'lulo_mqtt','password':a20_0x51dd('0x33'),'clean':!![]};this[a20_0x51dd('0x34')]=mqtt['connect'](a20_0x51dd('0x35'),_0xd2031b);this['mqttClient']['on'](a20_0x51dd('0x24'),this[a20_0x51dd('0x36')][a20_0x51dd('0x37')](this));this[a20_0x51dd('0x34')]['on']('message',this[a20_0x51dd('0x38')][a20_0x51dd('0x37')](this));this['mqttClient']['on'](a20_0x51dd('0x29'),()=>{console[a20_0x51dd('0x11')](a20_0x51dd('0x29'));});process['on'](a20_0x51dd('0x39'),this['handleAppExit']['bind'](this));process['on']('SIGINT',this[a20_0x51dd('0x3a')][a20_0x51dd('0x37')](this));process['on'](a20_0x51dd('0x3b'),this[a20_0x51dd('0x3a')][a20_0x51dd('0x37')](this));}['mqttClient_connect'](){console[a20_0x51dd('0x11')]('Connected\x20to\x20broker\x20client:'+this['clientId']);this['mqttClient']['subscribe'](a20_0x51dd('0x3c'));this[a20_0x51dd('0x34')]['subscribe'](a20_0x51dd('0x3d'));this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x3e'),{'qos':0x2});this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x3f'),{'qos':0x2});this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x40'),{'qos':0x2});this[a20_0x51dd('0x34')]['subscribe'](a20_0x51dd('0x41'),{'qos':0x2});this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x42'),{'qos':0x2});this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x43'),{'qos':0x2});this[a20_0x51dd('0x34')]['subscribe'](a20_0x51dd('0x44'),{'qos':0x2});this[a20_0x51dd('0x34')][a20_0x51dd('0x21')](a20_0x51dd('0x45'),{'qos':0x2});this['mqttClient']['subscribe']('player/turn_on_tv',{'qos':0x2});}[a20_0x51dd('0x46')](){}['mqttClient_message'](_0x56c1d3,_0x51e0e4){console[a20_0x51dd('0x11')](a20_0x51dd('0x47'),_0x56c1d3,_0x51e0e4);switch(_0x56c1d3){case a20_0x51dd('0x3c'):return this['handleOpenRequest'](_0x51e0e4);case a20_0x51dd('0x3d'):return this[a20_0x51dd('0x48')](_0x51e0e4);case a20_0x51dd('0x3e'):return this[a20_0x51dd('0x49')](_0x51e0e4);case a20_0x51dd('0x40'):return this[a20_0x51dd('0x4a')](_0x51e0e4);case a20_0x51dd('0x3f'):return this[a20_0x51dd('0x4b')](_0x51e0e4);case a20_0x51dd('0x41'):return this['handleUpdateRequest'](_0x51e0e4);case a20_0x51dd('0x42'):return this[a20_0x51dd('0x4c')](_0x51e0e4);case a20_0x51dd('0x43'):return this[a20_0x51dd('0x4d')](_0x51e0e4);case a20_0x51dd('0x44'):return this[a20_0x51dd('0x4e')](_0x51e0e4);case a20_0x51dd('0x45'):return this[a20_0x51dd('0x4f')](_0x51e0e4);case a20_0x51dd('0x50'):return this[a20_0x51dd('0x51')](_0x51e0e4);}}[a20_0x51dd('0x4d')](_0x2fec78){if(_0x2fec78==a20_0x51dd('0x52')||_0x2fec78==String(this['syncPlaylistsService'][a20_0x51dd('0x53')])){this[a20_0x51dd('0x54')][a20_0x51dd('0x55')]();}}[a20_0x51dd('0x4c')](_0x30d01a){if(_0x30d01a=='all'||_0x30d01a==String(this['syncPlaylistsService'][a20_0x51dd('0x53')])){}}[a20_0x51dd('0x56')](_0x11ce08){console[a20_0x51dd('0x11')](a20_0x51dd('0x57')+_0x11ce08);if(_0x11ce08==a20_0x51dd('0x52')||_0x11ce08==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){const _0x2925e7=__dirname;const _0x53b137=require(a20_0x51dd('0x58'))(_0x2925e7);console['log'](a20_0x51dd('0x59'));_0x53b137[a20_0x51dd('0x5a')]((_0x2f1db3,_0x5c6de4)=>{if(_0x2f1db3){console[a20_0x51dd('0x11')](a20_0x51dd('0x5b'));this['handleUpdateRequest'](_0x11ce08);return;}else{}console[a20_0x51dd('0x11')](a20_0x51dd('0x5c'));console[a20_0x51dd('0x11')](_0x5c6de4);if(_0x5c6de4&&_0x5c6de4[a20_0x51dd('0x5d')][a20_0x51dd('0x5e')]){this[a20_0x51dd('0x54')][a20_0x51dd('0x5f')]();}else{}});}}[a20_0x51dd('0x4b')](_0x585155){if(_0x585155==a20_0x51dd('0x52')||_0x585155==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){this['syncPlaylistsService'][a20_0x51dd('0x60')]();}}[a20_0x51dd('0x4a')](_0x4530d4){if(String(_0x4530d4)==a20_0x51dd('0x52')||String(_0x4530d4)==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){this[a20_0x51dd('0x54')][a20_0x51dd('0x61')]();}}[a20_0x51dd('0x49')](_0x527e8f){if(_0x527e8f==a20_0x51dd('0x52')||_0x527e8f==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){console['log']('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a20_0x51dd('0x54')][a20_0x51dd('0x5f')]();}catch(_0x1d6115){console['log'](_0x1d6115);}}}['handleUpdateSettingsRequest'](_0x106a8f){if(_0x106a8f==a20_0x51dd('0x52')||_0x106a8f==String(this[a20_0x51dd('0x54')]['playerId'])){console[a20_0x51dd('0x11')](a20_0x51dd('0x62'));try{this[a20_0x51dd('0x54')][a20_0x51dd('0x63')]();}catch(_0x48bf89){console[a20_0x51dd('0x11')](_0x48bf89);}}}[a20_0x51dd('0x51')](_0x3e61ac){if(_0x3e61ac==a20_0x51dd('0x52')||_0x3e61ac==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){console[a20_0x51dd('0x11')]('handleTurnOnTVRequest:\x20');try{this[a20_0x51dd('0x54')][a20_0x51dd('0x64')]();}catch(_0x5216cd){console[a20_0x51dd('0x11')](_0x5216cd);}}}[a20_0x51dd('0x4f')](_0x2e94ee){if(_0x2e94ee==a20_0x51dd('0x52')||_0x2e94ee==String(this[a20_0x51dd('0x54')][a20_0x51dd('0x53')])){console['log'](a20_0x51dd('0x65'));try{this[a20_0x51dd('0x54')]['turnOffTV']();}catch(_0x5b0ce0){console[a20_0x51dd('0x11')](_0x5b0ce0);}}}['sendStateUpdate'](){console[a20_0x51dd('0x11')](a20_0x51dd('0x66'),this[a20_0x51dd('0xc')]);this[a20_0x51dd('0x34')]['publish'](a20_0x51dd('0x67'),this['syncPlaylistsService'][a20_0x51dd('0x53')]+'-'+this['state']);}[a20_0x51dd('0x68')](_0x432262){if(this['state']!==a20_0x51dd('0x69')&&this[a20_0x51dd('0xc')]!=='opening'){console['log']('opening\x20player\x20door');this[a20_0x51dd('0xc')]=a20_0x51dd('0x6a');this[a20_0x51dd('0x6b')]();setTimeout(()=>{this[a20_0x51dd('0xc')]=a20_0x51dd('0x69');this[a20_0x51dd('0x6b')]();},0x1388);}}[a20_0x51dd('0x48')](_0x6aac16){if(this[a20_0x51dd('0xc')]!==a20_0x51dd('0x6c')&&this[a20_0x51dd('0xc')]!==a20_0x51dd('0x6d')){this[a20_0x51dd('0xc')]='closing';this[a20_0x51dd('0x6b')]();setTimeout(()=>{this['state']=a20_0x51dd('0x6c');this[a20_0x51dd('0x6b')]();},0x1388);}}[a20_0x51dd('0x3a')](_0x249adb,_0x4f4427){if(_0x4f4427){console['log'](_0x4f4427['stack']);}this[a20_0x51dd('0x34')][a20_0x51dd('0x27')](a20_0x51dd('0x6e'),a20_0x51dd('0x6f'));}[a20_0x51dd('0x1c')](_0x2d6fdd,_0x257ff1,_0x5db7a0){const _0x589ca0={'iat':Math[a20_0x51dd('0x1f')](Date['now']()/0x3e8),'exp':Math[a20_0x51dd('0x1f')](Date[a20_0x51dd('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x2d6fdd};const _0x2e7c49=fs['readFileSync'](_0x257ff1);return jwt[a20_0x51dd('0x70')](_0x589ca0,_0x2e7c49,{'algorithm':_0x5db7a0});}}exports['MqttService']=MqttService;