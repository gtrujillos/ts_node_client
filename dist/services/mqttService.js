var a20_0x3b2d=['close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','mqttInit','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','message','mqttClient_message','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reboot','player/reload_playlist','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest','handleUpdateRequest','handleUpdateSettingsRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleIfconfigRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','loadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','updateSettings','handleTurnOnTVRequest:\x20','handleTurnOffTVRequest:\x20','turnOffTV','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','closing','closed','stack','false','readFileSync','sign','MqttService','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','velvety-glazing-252020','my-node-device','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','round','now','connect','subscribe','/state','log','Client\x20not\x20connected...','publish','publish\x20result:'];(function(_0xd90698,_0x42be54){var _0x5a8297=function(_0xe4ef5e){while(--_0xe4ef5e){_0xd90698['push'](_0xd90698['shift']());}};_0x5a8297(++_0x42be54);}(a20_0x3b2d,0xc6));var a20_0x3e33=function(_0x40f084,_0x26cb3d){_0x40f084=_0x40f084-0x0;var _0x3a12ef=a20_0x3b2d[_0x40f084];return _0x3a12ef;};'use strict';Object['defineProperty'](exports,a20_0x3e33('0x0'),{'value':!![]});const HttpClientService_1=require(a20_0x3e33('0x1'));const fs=require('fs');const fsExtra=require(a20_0x3e33('0x2'));const request=require(a20_0x3e33('0x3'));const progress=require(a20_0x3e33('0x4'));const spawn=require(a20_0x3e33('0x5'))[a20_0x3e33('0x6')];const exec=require('child_process')[a20_0x3e33('0x7')];const isImage=require(a20_0x3e33('0x8'));const format=require(a20_0x3e33('0x9'));const os=require('os');const mqtt=require(a20_0x3e33('0xa'));const uuidv4=require(a20_0x3e33('0xb'));const jwt=require(a20_0x3e33('0xc'));class MqttService{constructor(_0x240da2){this[a20_0x3e33('0xd')]=_0x240da2;this[a20_0x3e33('0xe')]='closed';this[a20_0x3e33('0xf')]=new HttpClientService_1[(a20_0x3e33('0x10'))]();}['init'](){this[a20_0x3e33('0x11')]();}[a20_0x3e33('0x12')](){console['log']('mqttInit');const _0x3d5d18=a20_0x3e33('0x13');const _0x25721a=a20_0x3e33('0x14');const _0x3e0a1c='my-registry';const _0x550573='us-central1';const _0x3d3747=a20_0x3e33('0x15');const _0x438057=a20_0x3e33('0x16');const _0x5d0e59=a20_0x3e33('0x17');const _0x1699a0=0x1bb;const _0x37c607=a20_0x3e33('0x18');const _0x3878cb=0x5;const _0x378b21=a20_0x3e33('0x19')+_0x3d5d18+'/locations/'+_0x550573+a20_0x3e33('0x1a')+_0x3e0a1c+a20_0x3e33('0x1b')+_0x25721a;const _0x359de8={'host':_0x5d0e59,'port':_0x1699a0,'clientId':_0x378b21,'username':a20_0x3e33('0x1c'),'password':this[a20_0x3e33('0x1d')](_0x3d5d18,_0x438057,_0x3d3747),'protocol':'mqtts','secureProtocol':a20_0x3e33('0x1e')};const _0xc187db=Math[a20_0x3e33('0x1f')](Date[a20_0x3e33('0x20')]()/0x3e8);const _0x53dcb1=mqtt[a20_0x3e33('0x21')](_0x359de8);_0x53dcb1['subscribe'](a20_0x3e33('0x1b')+_0x25721a+'/config',{'qos':0x1});_0x53dcb1[a20_0x3e33('0x22')](a20_0x3e33('0x1b')+_0x25721a+a20_0x3e33('0x23'),{'qos':0x1});_0x53dcb1['subscribe'](a20_0x3e33('0x1b')+_0x25721a+'/commands/#',{'qos':0x0});const _0x8d9d49=a20_0x3e33('0x1b')+_0x25721a+'/'+_0x37c607;_0x53dcb1['on'](a20_0x3e33('0x21'),_0x21b891=>{console[a20_0x3e33('0x24')](a20_0x3e33('0x21'));if(!_0x21b891){console[a20_0x3e33('0x24')](a20_0x3e33('0x25'));}else{const _0x8d9d49='/projects/velvety-glazing-252020/topics/my-topic';const _0x4eec53=_0x3e0a1c+'/'+_0x25721a+'-payload-0';_0x53dcb1[a20_0x3e33('0x26')](_0x8d9d49,_0x4eec53,{'qos':0x1},_0x4c643e=>{console[a20_0x3e33('0x24')](a20_0x3e33('0x27'));console[a20_0x3e33('0x24')](_0x4c643e);if(!_0x4c643e){}});}});_0x53dcb1['on'](a20_0x3e33('0x28'),()=>{console[a20_0x3e33('0x24')](a20_0x3e33('0x28'));});_0x53dcb1['on'](a20_0x3e33('0x29'),_0x3cde40=>{console[a20_0x3e33('0x24')](a20_0x3e33('0x29'),_0x3cde40);});_0x53dcb1['on']('message',(_0x3ddded,_0x178bdc)=>{let _0x33851e=a20_0x3e33('0x2a');console[a20_0x3e33('0x24')](_0x3ddded);console['log'](_0x178bdc+'');if(_0x3ddded==='/devices/'+_0x25721a+'/config'){_0x33851e=a20_0x3e33('0x2b');}else if(_0x3ddded[a20_0x3e33('0x2c')](a20_0x3e33('0x1b')+_0x25721a+'/commands')){_0x33851e=a20_0x3e33('0x2d');}_0x33851e+=Buffer[a20_0x3e33('0x2e')](_0x178bdc,a20_0x3e33('0x2f'))[a20_0x3e33('0x30')](a20_0x3e33('0x31'));console['log'](_0x33851e);});_0x53dcb1['on'](a20_0x3e33('0x32'),()=>{});console['log'](_0x359de8);}[a20_0x3e33('0x11')](){console[a20_0x3e33('0x24')](a20_0x3e33('0x33'));this[a20_0x3e33('0x34')]=uuidv4();console[a20_0x3e33('0x24')](a20_0x3e33('0x35'));console['log'](this[a20_0x3e33('0x34')]);const _0x5d82d8={'clientId':this[a20_0x3e33('0x34')],'username':a20_0x3e33('0x36'),'password':a20_0x3e33('0x37'),'clean':!![]};this[a20_0x3e33('0x38')]=mqtt['connect'](a20_0x3e33('0x39'),_0x5d82d8);this['mqttClient']['on'](a20_0x3e33('0x21'),this[a20_0x3e33('0x3a')]['bind'](this));this[a20_0x3e33('0x38')]['on'](a20_0x3e33('0x3b'),this[a20_0x3e33('0x3c')][a20_0x3e33('0x3d')](this));this[a20_0x3e33('0x38')]['on'](a20_0x3e33('0x28'),()=>{console[a20_0x3e33('0x24')](a20_0x3e33('0x28'));});process['on'](a20_0x3e33('0x3e'),this[a20_0x3e33('0x3f')][a20_0x3e33('0x3d')](this));process['on'](a20_0x3e33('0x40'),this[a20_0x3e33('0x3f')][a20_0x3e33('0x3d')](this));process['on'](a20_0x3e33('0x41'),this[a20_0x3e33('0x3f')][a20_0x3e33('0x3d')](this));}['mqttClient_connect'](){console[a20_0x3e33('0x24')](a20_0x3e33('0x42')+this[a20_0x3e33('0x34')]);this[a20_0x3e33('0x38')]['subscribe'](a20_0x3e33('0x43'));this[a20_0x3e33('0x38')]['subscribe'](a20_0x3e33('0x44'));this[a20_0x3e33('0x38')][a20_0x3e33('0x22')]('player/reboot',{'qos':0x2});this[a20_0x3e33('0x38')][a20_0x3e33('0x22')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a20_0x3e33('0x22')]('player/reload_playlist',{'qos':0x2});this[a20_0x3e33('0x38')][a20_0x3e33('0x22')](a20_0x3e33('0x45'),{'qos':0x2});this['mqttClient'][a20_0x3e33('0x22')](a20_0x3e33('0x46'),{'qos':0x2});this[a20_0x3e33('0x38')][a20_0x3e33('0x22')](a20_0x3e33('0x47'),{'qos':0x2});this[a20_0x3e33('0x38')][a20_0x3e33('0x22')](a20_0x3e33('0x48'),{'qos':0x2});this['mqttClient'][a20_0x3e33('0x22')](a20_0x3e33('0x49'),{'qos':0x2});this[a20_0x3e33('0x38')][a20_0x3e33('0x22')](a20_0x3e33('0x4a'),{'qos':0x2});}[a20_0x3e33('0x4b')](){}[a20_0x3e33('0x3c')](_0x2d2355,_0x37c7a2){console[a20_0x3e33('0x24')](a20_0x3e33('0x4c'),_0x2d2355,_0x37c7a2);switch(_0x2d2355){case a20_0x3e33('0x43'):return this[a20_0x3e33('0x4d')](_0x37c7a2);case a20_0x3e33('0x44'):return this[a20_0x3e33('0x4e')](_0x37c7a2);case a20_0x3e33('0x4f'):return this['handleRebootRequest'](_0x37c7a2);case a20_0x3e33('0x50'):return this[a20_0x3e33('0x51')](_0x37c7a2);case a20_0x3e33('0x52'):return this[a20_0x3e33('0x53')](_0x37c7a2);case a20_0x3e33('0x45'):return this[a20_0x3e33('0x54')](_0x37c7a2);case a20_0x3e33('0x46'):return this['handleIfconfigRequest'](_0x37c7a2);case'player/register':return this['handleRegisterRequest'](_0x37c7a2);case'player/update_settings':return this[a20_0x3e33('0x55')](_0x37c7a2);case'player/turn_off_tv':return this['handleTurnOffTVRequest'](_0x37c7a2);case a20_0x3e33('0x4a'):return this[a20_0x3e33('0x56')](_0x37c7a2);}}['handleRegisterRequest'](_0x2f5f3e){if(_0x2f5f3e==a20_0x3e33('0x57')||_0x2f5f3e==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){this[a20_0x3e33('0xd')][a20_0x3e33('0x59')]();}}[a20_0x3e33('0x5a')](_0x1b5d7d){if(_0x1b5d7d==a20_0x3e33('0x57')||_0x1b5d7d==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){}}[a20_0x3e33('0x54')](_0x5c8044){console[a20_0x3e33('0x24')](a20_0x3e33('0x5b')+_0x5c8044);if(_0x5c8044==a20_0x3e33('0x57')||_0x5c8044==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){const _0x57baa5=__dirname;const _0x1756e2=require(a20_0x3e33('0x5c'))(_0x57baa5);console[a20_0x3e33('0x24')](a20_0x3e33('0x5d'));_0x1756e2[a20_0x3e33('0x5e')]((_0x11558d,_0x3a124e)=>{if(_0x11558d){console['log'](a20_0x3e33('0x5f'));this['handleUpdateRequest'](_0x5c8044);return;}else{}console['log'](a20_0x3e33('0x60'));console[a20_0x3e33('0x24')](_0x3a124e);if(_0x3a124e&&_0x3a124e[a20_0x3e33('0x61')]['changes']){this[a20_0x3e33('0xd')]['reboot']();}else{}});}}[a20_0x3e33('0x53')](_0x53b283){if(_0x53b283==a20_0x3e33('0x57')||_0x53b283==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){this[a20_0x3e33('0xd')][a20_0x3e33('0x62')]();}}['handleReloadPlaylistRequest'](_0x2dfa62){if(String(_0x2dfa62)==a20_0x3e33('0x57')||String(_0x2dfa62)==String(this['syncPlaylistsService'][a20_0x3e33('0x58')])){this[a20_0x3e33('0xd')]['reloadMediaList']();}}[a20_0x3e33('0x63')](_0x2c04ee){if(_0x2c04ee==a20_0x3e33('0x57')||_0x2c04ee==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){console['log'](a20_0x3e33('0x64'));try{this['syncPlaylistsService'][a20_0x3e33('0x65')]();}catch(_0x5b86f1){console['log'](_0x5b86f1);}}}[a20_0x3e33('0x55')](_0x1b9e10){if(_0x1b9e10==a20_0x3e33('0x57')||_0x1b9e10==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a20_0x3e33('0xd')][a20_0x3e33('0x66')]();}catch(_0x110d58){console['log'](_0x110d58);}}}[a20_0x3e33('0x56')](_0x4f00fe){if(_0x4f00fe==a20_0x3e33('0x57')||_0x4f00fe==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){console['log'](a20_0x3e33('0x67'));try{this['syncPlaylistsService']['turnOnTV']();}catch(_0x1c1357){console[a20_0x3e33('0x24')](_0x1c1357);}}}['handleTurnOffTVRequest'](_0x319b14){if(_0x319b14==a20_0x3e33('0x57')||_0x319b14==String(this[a20_0x3e33('0xd')][a20_0x3e33('0x58')])){console['log'](a20_0x3e33('0x68'));try{this[a20_0x3e33('0xd')][a20_0x3e33('0x69')]();}catch(_0x3276d7){console[a20_0x3e33('0x24')](_0x3276d7);}}}['sendStateUpdate'](){console[a20_0x3e33('0x24')](a20_0x3e33('0x6a'),this[a20_0x3e33('0xe')]);this[a20_0x3e33('0x38')][a20_0x3e33('0x26')](a20_0x3e33('0x6b'),this[a20_0x3e33('0xd')]['playerId']+'-'+this['state']);}[a20_0x3e33('0x4d')](_0x2dbacd){if(this['state']!==a20_0x3e33('0x6c')&&this[a20_0x3e33('0xe')]!==a20_0x3e33('0x6d')){console['log'](a20_0x3e33('0x6e'));this[a20_0x3e33('0xe')]=a20_0x3e33('0x6d');this[a20_0x3e33('0x6f')]();setTimeout(()=>{this['state']=a20_0x3e33('0x6c');this[a20_0x3e33('0x6f')]();},0x1388);}}['handleCloseRequest'](_0x4105e1){if(this[a20_0x3e33('0xe')]!=='closed'&&this['state']!==a20_0x3e33('0x70')){this['state']=a20_0x3e33('0x70');this[a20_0x3e33('0x6f')]();setTimeout(()=>{this[a20_0x3e33('0xe')]=a20_0x3e33('0x71');this[a20_0x3e33('0x6f')]();},0x1388);}}[a20_0x3e33('0x3f')](_0x20c2cd,_0x24abaa){if(_0x24abaa){console['log'](_0x24abaa[a20_0x3e33('0x72')]);}this[a20_0x3e33('0x38')][a20_0x3e33('0x26')]('player/connected',a20_0x3e33('0x73'));}['createJwt'](_0x56fb34,_0x34d28d,_0x93a9fb){const _0x29e45b={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a20_0x3e33('0x1f')](Date[a20_0x3e33('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x56fb34};const _0x322f81=fs[a20_0x3e33('0x74')](_0x34d28d);return jwt[a20_0x3e33('0x75')](_0x29e45b,_0x322f81,{'algorithm':_0x93a9fb});}}exports[a20_0x3e33('0x76')]=MqttService;