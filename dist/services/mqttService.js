var a18_0x57dd=['mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','subscribe','player/close','player/reboot','player/reload_playlist','player/update','player/ifconfig','reportStatus','handleCloseRequest','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest','handleIfconfigRequest','player/register','handleRegisterRequest','registerClient','all','playerId','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','changes','now','handleRebootRequest','shutdown','sendStateUpdate','sending\x20state\x20%s','publish','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','request','child_process','is-image','string-template'];(function(_0x36599c,_0xfc8e08){var _0x2b6d4f=function(_0x4d13d5){while(--_0x4d13d5){_0x36599c['push'](_0x36599c['shift']());}};_0x2b6d4f(++_0xfc8e08);}(a18_0x57dd,0x19e));var a18_0x21ed=function(_0x4f84c9,_0x2d13e6){_0x4f84c9=_0x4f84c9-0x0;var _0x1e112f=a18_0x57dd[_0x4f84c9];return _0x1e112f;};'use strict';Object[a18_0x21ed('0x0')](exports,a18_0x21ed('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x21ed('0x2'));const progress=require('request-progress');const spawn=require(a18_0x21ed('0x3'))['spawn'];const isImage=require(a18_0x21ed('0x4'));const format=require(a18_0x21ed('0x5'));const os=require('os');const mqtt=require(a18_0x21ed('0x6'));const uuidv4=require(a18_0x21ed('0x7'));class MqttService{constructor(_0x446f22){this[a18_0x21ed('0x8')]=_0x446f22;this[a18_0x21ed('0x9')]=a18_0x21ed('0xa');this[a18_0x21ed('0xb')]=new HttpClientService_1['HttpClientService']();}[a18_0x21ed('0xc')](){this[a18_0x21ed('0xd')]();}[a18_0x21ed('0xd')](){console[a18_0x21ed('0xe')](a18_0x21ed('0xd'));this[a18_0x21ed('0xf')]=uuidv4();console[a18_0x21ed('0xe')](a18_0x21ed('0x10'));console[a18_0x21ed('0xe')](this[a18_0x21ed('0xf')]);const _0x18a08e={'clientId':this[a18_0x21ed('0xf')],'username':a18_0x21ed('0x11'),'password':a18_0x21ed('0x12'),'clean':!![]};this[a18_0x21ed('0x13')]=mqtt[a18_0x21ed('0x14')](a18_0x21ed('0x15'),_0x18a08e);this['mqttClient']['on'](a18_0x21ed('0x14'),this[a18_0x21ed('0x16')][a18_0x21ed('0x17')](this));this[a18_0x21ed('0x13')]['on'](a18_0x21ed('0x18'),this[a18_0x21ed('0x19')]['bind'](this));process['on']('exit',this['handleAppExit']['bind'](this));process['on'](a18_0x21ed('0x1a'),this[a18_0x21ed('0x1b')][a18_0x21ed('0x17')](this));process['on'](a18_0x21ed('0x1c'),this[a18_0x21ed('0x1b')][a18_0x21ed('0x17')](this));}['mqttClient_connect'](){console[a18_0x21ed('0xe')](a18_0x21ed('0x1d')+this[a18_0x21ed('0xf')]);this[a18_0x21ed('0x13')]['subscribe'](a18_0x21ed('0x1e'));this['mqttClient'][a18_0x21ed('0x1f')](a18_0x21ed('0x20'));this['mqttClient'][a18_0x21ed('0x1f')](a18_0x21ed('0x21'),{'qos':0x2});this[a18_0x21ed('0x13')][a18_0x21ed('0x1f')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a18_0x21ed('0x1f')](a18_0x21ed('0x22'),{'qos':0x2});this['mqttClient'][a18_0x21ed('0x1f')](a18_0x21ed('0x23'),{'qos':0x2});this[a18_0x21ed('0x13')]['subscribe'](a18_0x21ed('0x24'),{'qos':0x2});this[a18_0x21ed('0x13')]['subscribe']('player/register',{'qos':0x2});}[a18_0x21ed('0x25')](){}[a18_0x21ed('0x19')](_0x13b98e,_0x5d91b8){console['log']('received\x20message\x20%s\x20%s',_0x13b98e,_0x5d91b8);switch(_0x13b98e){case a18_0x21ed('0x1e'):return this['handleOpenRequest'](_0x5d91b8);case a18_0x21ed('0x20'):return this[a18_0x21ed('0x26')](_0x5d91b8);case a18_0x21ed('0x21'):return this['handleRebootRequest'](_0x5d91b8);case'player/reload_playlist':return this[a18_0x21ed('0x27')](_0x5d91b8);case a18_0x21ed('0x28'):return this[a18_0x21ed('0x29')](_0x5d91b8);case a18_0x21ed('0x23'):return this['handleUpdateRequest'](_0x5d91b8);case a18_0x21ed('0x24'):return this[a18_0x21ed('0x2a')](_0x5d91b8);case a18_0x21ed('0x2b'):return this['handleRegisterRequest'](_0x5d91b8);}}[a18_0x21ed('0x2c')](_0x5cfba9){if(_0x5cfba9=='all'||_0x5cfba9==String(this['syncPlaylistsService']['playerId'])){this[a18_0x21ed('0x8')][a18_0x21ed('0x2d')]();}}['handleIfconfigRequest'](_0x301bd2){if(_0x301bd2==a18_0x21ed('0x2e')||_0x301bd2==String(this[a18_0x21ed('0x8')][a18_0x21ed('0x2f')])){}}[a18_0x21ed('0x30')](_0x1b57b3){console[a18_0x21ed('0xe')](a18_0x21ed('0x31')+_0x1b57b3);if(_0x1b57b3==a18_0x21ed('0x2e')||_0x1b57b3==String(this[a18_0x21ed('0x8')][a18_0x21ed('0x2f')])){const _0x2a23ed=__dirname;const _0x38f848=require(a18_0x21ed('0x32'))(_0x2a23ed);console[a18_0x21ed('0xe')](a18_0x21ed('0x33'));_0x38f848[a18_0x21ed('0x34')]((_0x5ade53,_0xf910a0)=>{if(_0x5ade53){console[a18_0x21ed('0xe')](a18_0x21ed('0x35'));this[a18_0x21ed('0x30')](_0x1b57b3);return;}else{}console[a18_0x21ed('0xe')]('Git\x20updated');console[a18_0x21ed('0xe')](_0xf910a0);if(_0xf910a0&&_0xf910a0['summary'][a18_0x21ed('0x36')]){const _0x25b828=spawn('shutdown',['-r',a18_0x21ed('0x37')]);}else{}});}}['handleLoadPlaylistRequest'](_0x1ca0c6){if(_0x1ca0c6==a18_0x21ed('0x2e')||_0x1ca0c6==String(this[a18_0x21ed('0x8')][a18_0x21ed('0x2f')])){this[a18_0x21ed('0x8')]['loadMediaList']();}}[a18_0x21ed('0x27')](_0x50250a){if(String(_0x50250a)==a18_0x21ed('0x2e')||String(_0x50250a)==String(this[a18_0x21ed('0x8')][a18_0x21ed('0x2f')])){this[a18_0x21ed('0x8')]['reloadMediaList']();}}[a18_0x21ed('0x38')](_0x51f996){if(_0x51f996==a18_0x21ed('0x2e')||_0x51f996==String(this['syncPlaylistsService'][a18_0x21ed('0x2f')])){const _0x5d8e26=spawn(a18_0x21ed('0x39'),['-r',a18_0x21ed('0x37')]);}}[a18_0x21ed('0x3a')](){console[a18_0x21ed('0xe')](a18_0x21ed('0x3b'),this['state']);this[a18_0x21ed('0x13')][a18_0x21ed('0x3c')]('player/state',this['syncPlaylistsService']['playerId']+'-'+this['state']);}[a18_0x21ed('0x3d')](_0x5aff7d){if(this[a18_0x21ed('0x9')]!==a18_0x21ed('0x3e')&&this[a18_0x21ed('0x9')]!==a18_0x21ed('0x3f')){console['log'](a18_0x21ed('0x40'));this[a18_0x21ed('0x9')]=a18_0x21ed('0x3f');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x21ed('0x9')]=a18_0x21ed('0x3e');this[a18_0x21ed('0x3a')]();},0x1388);}}[a18_0x21ed('0x26')](_0x215546){if(this[a18_0x21ed('0x9')]!==a18_0x21ed('0xa')&&this['state']!=='closing'){this[a18_0x21ed('0x9')]=a18_0x21ed('0x41');this[a18_0x21ed('0x3a')]();setTimeout(()=>{this[a18_0x21ed('0x9')]='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x5454e1,_0x2abc7f){if(_0x2abc7f){console['log'](_0x2abc7f[a18_0x21ed('0x42')]);}this['mqttClient'][a18_0x21ed('0x3c')](a18_0x21ed('0x43'),a18_0x21ed('0x44'));}}exports[a18_0x21ed('0x45')]=MqttService;