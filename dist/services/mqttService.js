var a23_0x4aeb=['handleTurnOnTVRequest','playerId','registerClient','all','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reloadMediaList','reboot','handleUpdateSettingsRequest:\x20','updateSettings','turnOnTV','turnOffTV','sending\x20state\x20%s','state','handleOpenRequest','open','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closed','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','spawn','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','httpClientService','HttpClientService','init','mqttInit_google','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','round','now','/devices/','/state','subscribe','/commands/#','connect','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','toString','mqttInit_mosquitto','mqttInit','clientId','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/update_settings','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','player/register','handleRegisterRequest','handleUpdateSettingsRequest','player/turn_off_tv','handleTurnOffTVRequest'];(function(_0x52d369,_0x3950b0){var _0x33e57d=function(_0x3765d7){while(--_0x3765d7){_0x52d369['push'](_0x52d369['shift']());}};_0x33e57d(++_0x3950b0);}(a23_0x4aeb,0x10c));var a23_0x4615=function(_0x1a483b,_0x501ac3){_0x1a483b=_0x1a483b-0x0;var _0x104bc6=a23_0x4aeb[_0x1a483b];return _0x104bc6;};'use strict';Object[a23_0x4615('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a23_0x4615('0x1'));const fs=require('fs');const fsExtra=require(a23_0x4615('0x2'));const request=require(a23_0x4615('0x3'));const progress=require('request-progress');const spawn=require('child_process')[a23_0x4615('0x4')];const exec=require('child_process')['exec'];const isImage=require(a23_0x4615('0x5'));const format=require(a23_0x4615('0x6'));const os=require('os');const mqtt=require(a23_0x4615('0x7'));const uuidv4=require(a23_0x4615('0x8'));const jwt=require(a23_0x4615('0x9'));class MqttService{constructor(_0x1afcad){this[a23_0x4615('0xa')]=_0x1afcad;this['state']='closed';this[a23_0x4615('0xb')]=new HttpClientService_1[(a23_0x4615('0xc'))]();}[a23_0x4615('0xd')](){this['mqttInit_mosquitto']();}[a23_0x4615('0xe')](){console['log']('mqttInit');const _0x222523='velvety-glazing-252020';const _0x40c608=a23_0x4615('0xf');const _0xe24cd7='my-registry';const _0x29ecfd=a23_0x4615('0x10');const _0x1287e1=a23_0x4615('0x11');const _0x5e5ccf=a23_0x4615('0x12');const _0x1a319a=a23_0x4615('0x13');const _0x53405a=0x1bb;const _0x455157=a23_0x4615('0x14');const _0xe675c6=0x5;const _0xb0e2ad=a23_0x4615('0x15')+_0x222523+a23_0x4615('0x16')+_0x29ecfd+a23_0x4615('0x17')+_0xe24cd7+'/devices/'+_0x40c608;const _0x4b834c={'host':_0x1a319a,'port':_0x53405a,'clientId':_0xb0e2ad,'username':a23_0x4615('0x18'),'password':this[a23_0x4615('0x19')](_0x222523,_0x5e5ccf,_0x1287e1),'protocol':a23_0x4615('0x1a'),'secureProtocol':'TLSv1_2_method'};const _0x282027=Math[a23_0x4615('0x1b')](Date[a23_0x4615('0x1c')]()/0x3e8);const _0x287de7=mqtt['connect'](_0x4b834c);_0x287de7['subscribe']('/devices/'+_0x40c608+'/config',{'qos':0x1});_0x287de7['subscribe'](a23_0x4615('0x1d')+_0x40c608+a23_0x4615('0x1e'),{'qos':0x1});_0x287de7[a23_0x4615('0x1f')](a23_0x4615('0x1d')+_0x40c608+a23_0x4615('0x20'),{'qos':0x0});const _0x45481c='/devices/'+_0x40c608+'/'+_0x455157;_0x287de7['on'](a23_0x4615('0x21'),_0x38029c=>{console[a23_0x4615('0x22')](a23_0x4615('0x21'));if(!_0x38029c){console[a23_0x4615('0x22')](a23_0x4615('0x23'));}else{const _0x45481c=a23_0x4615('0x24');const _0xd365fb=_0xe24cd7+'/'+_0x40c608+a23_0x4615('0x25');_0x287de7[a23_0x4615('0x26')](_0x45481c,_0xd365fb,{'qos':0x1},_0x5a3a73=>{console[a23_0x4615('0x22')](a23_0x4615('0x27'));console[a23_0x4615('0x22')](_0x5a3a73);if(!_0x5a3a73){}});}});_0x287de7['on'](a23_0x4615('0x28'),()=>{console['log']('close');});_0x287de7['on'](a23_0x4615('0x29'),_0x5a4b8c=>{console[a23_0x4615('0x22')](a23_0x4615('0x29'),_0x5a4b8c);});_0x287de7['on']('message',(_0x19e4f1,_0x2ba55a)=>{let _0x265a77=a23_0x4615('0x2a');console['log'](_0x19e4f1);console[a23_0x4615('0x22')](_0x2ba55a+'');if(_0x19e4f1===a23_0x4615('0x1d')+_0x40c608+a23_0x4615('0x2b')){_0x265a77=a23_0x4615('0x2c');}else if(_0x19e4f1[a23_0x4615('0x2d')]('/devices/'+_0x40c608+'/commands')){_0x265a77=a23_0x4615('0x2e');}_0x265a77+=Buffer['from'](_0x2ba55a,'base64')[a23_0x4615('0x2f')]('ascii');console[a23_0x4615('0x22')](_0x265a77);});_0x287de7['on']('packetsend',()=>{});console[a23_0x4615('0x22')](_0x4b834c);}[a23_0x4615('0x30')](){console[a23_0x4615('0x22')](a23_0x4615('0x31'));this[a23_0x4615('0x32')]=uuidv4();console['log'](a23_0x4615('0x33'));console[a23_0x4615('0x22')](this['clientId']);const _0x4abaac={'clientId':this[a23_0x4615('0x32')],'username':a23_0x4615('0x34'),'password':'run.lulo_2018#.','clean':!![]};this[a23_0x4615('0x35')]=mqtt['connect'](a23_0x4615('0x36'),_0x4abaac);this['mqttClient']['on'](a23_0x4615('0x21'),this[a23_0x4615('0x37')][a23_0x4615('0x38')](this));this['mqttClient']['on']('message',this['mqttClient_message'][a23_0x4615('0x38')](this));this['mqttClient']['on'](a23_0x4615('0x28'),()=>{console['log'](a23_0x4615('0x28'));});process['on'](a23_0x4615('0x39'),this[a23_0x4615('0x3a')][a23_0x4615('0x38')](this));process['on'](a23_0x4615('0x3b'),this['handleAppExit']['bind'](this));process['on'](a23_0x4615('0x3c'),this[a23_0x4615('0x3a')][a23_0x4615('0x38')](this));}['mqttClient_connect'](){console['log'](a23_0x4615('0x3d')+this[a23_0x4615('0x32')]);this['mqttClient'][a23_0x4615('0x1f')](a23_0x4615('0x3e'));this[a23_0x4615('0x35')][a23_0x4615('0x1f')](a23_0x4615('0x3f'));this['mqttClient'][a23_0x4615('0x1f')](a23_0x4615('0x40'),{'qos':0x2});this['mqttClient']['subscribe'](a23_0x4615('0x41'),{'qos':0x2});this['mqttClient'][a23_0x4615('0x1f')](a23_0x4615('0x42'),{'qos':0x2});this['mqttClient'][a23_0x4615('0x1f')](a23_0x4615('0x43'),{'qos':0x2});this['mqttClient'][a23_0x4615('0x1f')](a23_0x4615('0x44'),{'qos':0x2});this[a23_0x4615('0x35')][a23_0x4615('0x1f')]('player/register',{'qos':0x2});this[a23_0x4615('0x35')][a23_0x4615('0x1f')](a23_0x4615('0x45'),{'qos':0x2});this[a23_0x4615('0x35')]['subscribe']('player/turn_off_tv',{'qos':0x2});this[a23_0x4615('0x35')][a23_0x4615('0x1f')](a23_0x4615('0x46'),{'qos':0x2});}[a23_0x4615('0x47')](){}[a23_0x4615('0x48')](_0x124a14,_0x212f84){console[a23_0x4615('0x22')](a23_0x4615('0x49'),_0x124a14,_0x212f84);switch(_0x124a14){case'player/open':return this['handleOpenRequest'](_0x212f84);case a23_0x4615('0x3f'):return this['handleCloseRequest'](_0x212f84);case a23_0x4615('0x40'):return this[a23_0x4615('0x4a')](_0x212f84);case'player/reload_playlist':return this[a23_0x4615('0x4b')](_0x212f84);case'player/load_playlist':return this[a23_0x4615('0x4c')](_0x212f84);case a23_0x4615('0x43'):return this['handleUpdateRequest'](_0x212f84);case a23_0x4615('0x44'):return this[a23_0x4615('0x4d')](_0x212f84);case a23_0x4615('0x4e'):return this[a23_0x4615('0x4f')](_0x212f84);case a23_0x4615('0x45'):return this[a23_0x4615('0x50')](_0x212f84);case a23_0x4615('0x51'):return this[a23_0x4615('0x52')](_0x212f84);case a23_0x4615('0x46'):return this[a23_0x4615('0x53')](_0x212f84);}}['handleRegisterRequest'](_0xc2028f){if(_0xc2028f=='all'||_0xc2028f==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){this['syncPlaylistsService'][a23_0x4615('0x55')]();}}[a23_0x4615('0x4d')](_0x411f22){if(_0x411f22==a23_0x4615('0x56')||_0x411f22==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){}}[a23_0x4615('0x57')](_0x5643a7){console['log'](a23_0x4615('0x58')+_0x5643a7);if(_0x5643a7==a23_0x4615('0x56')||_0x5643a7==String(this['syncPlaylistsService'][a23_0x4615('0x54')])){const _0x5c4d14=__dirname;const _0x4aaea4=require(a23_0x4615('0x59'))(_0x5c4d14);console[a23_0x4615('0x22')](a23_0x4615('0x5a'));_0x4aaea4[a23_0x4615('0x5b')]((_0x39b448,_0x19f418)=>{if(_0x39b448){console[a23_0x4615('0x22')](a23_0x4615('0x5c'));this['handleUpdateRequest'](_0x5643a7);return;}else{}console['log'](a23_0x4615('0x5d'));console[a23_0x4615('0x22')](_0x19f418);if(_0x19f418&&_0x19f418[a23_0x4615('0x5e')][a23_0x4615('0x5f')]){this[a23_0x4615('0xa')]['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x527aaa){if(_0x527aaa=='all'||_0x527aaa==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){this[a23_0x4615('0xa')]['loadMediaList']();}}[a23_0x4615('0x4b')](_0x3501e2){if(String(_0x3501e2)==a23_0x4615('0x56')||String(_0x3501e2)==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){this[a23_0x4615('0xa')][a23_0x4615('0x60')]();}}[a23_0x4615('0x4a')](_0xbbc727){if(_0xbbc727==a23_0x4615('0x56')||_0xbbc727==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){console[a23_0x4615('0x22')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a23_0x4615('0xa')][a23_0x4615('0x61')]();}catch(_0xb515d5){console['log'](_0xb515d5);}}}[a23_0x4615('0x50')](_0x1259f2){if(_0x1259f2=='all'||_0x1259f2==String(this['syncPlaylistsService'][a23_0x4615('0x54')])){console[a23_0x4615('0x22')](a23_0x4615('0x62'));try{this[a23_0x4615('0xa')][a23_0x4615('0x63')]();}catch(_0x445733){console[a23_0x4615('0x22')](_0x445733);}}}[a23_0x4615('0x53')](_0x458729){if(_0x458729==a23_0x4615('0x56')||_0x458729==String(this['syncPlaylistsService']['playerId'])){console['log']('handleTurnOnTVRequest:\x20');try{this['syncPlaylistsService'][a23_0x4615('0x64')]();}catch(_0x8009ab){console[a23_0x4615('0x22')](_0x8009ab);}}}[a23_0x4615('0x52')](_0x551bb0){if(_0x551bb0==a23_0x4615('0x56')||_0x551bb0==String(this[a23_0x4615('0xa')][a23_0x4615('0x54')])){console[a23_0x4615('0x22')]('handleTurnOffTVRequest:\x20');try{this[a23_0x4615('0xa')][a23_0x4615('0x65')]();}catch(_0x3ad3e7){console[a23_0x4615('0x22')](_0x3ad3e7);}}}['sendStateUpdate'](){console[a23_0x4615('0x22')](a23_0x4615('0x66'),this[a23_0x4615('0x67')]);this[a23_0x4615('0x35')][a23_0x4615('0x26')]('player/state',this[a23_0x4615('0xa')]['playerId']+'-'+this[a23_0x4615('0x67')]);}[a23_0x4615('0x68')](_0xb55d56){if(this[a23_0x4615('0x67')]!==a23_0x4615('0x69')&&this[a23_0x4615('0x67')]!=='opening'){console['log'](a23_0x4615('0x6a'));this[a23_0x4615('0x67')]='opening';this[a23_0x4615('0x6b')]();setTimeout(()=>{this[a23_0x4615('0x67')]=a23_0x4615('0x69');this[a23_0x4615('0x6b')]();},0x1388);}}[a23_0x4615('0x6c')](_0x31bed4){if(this[a23_0x4615('0x67')]!==a23_0x4615('0x6d')&&this[a23_0x4615('0x67')]!=='closing'){this[a23_0x4615('0x67')]=a23_0x4615('0x6e');this[a23_0x4615('0x6b')]();setTimeout(()=>{this['state']=a23_0x4615('0x6d');this[a23_0x4615('0x6b')]();},0x1388);}}['handleAppExit'](_0x2402a0,_0x541fdf){if(_0x541fdf){console[a23_0x4615('0x22')](_0x541fdf[a23_0x4615('0x6f')]);}this[a23_0x4615('0x35')][a23_0x4615('0x26')](a23_0x4615('0x70'),a23_0x4615('0x71'));}[a23_0x4615('0x19')](_0xd56e07,_0x13100b,_0x2dc9fb){const _0x13c974={'iat':Math[a23_0x4615('0x1b')](Date[a23_0x4615('0x1c')]()/0x3e8),'exp':Math[a23_0x4615('0x1b')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0xd56e07};const _0x4e712c=fs[a23_0x4615('0x72')](_0x13100b);return jwt[a23_0x4615('0x73')](_0x13c974,_0x4e712c,{'algorithm':_0x2dc9fb});}}exports[a23_0x4615('0x74')]=MqttService;