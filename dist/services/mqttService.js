var a18_0x490b=['startsWith','from','packetsend','mqttInit','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','SIGINT','uncaughtException','handleAppExit','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleCloseRequest','handleRebootRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','playerId','registerClient','all','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','readFileSync','sign','defineProperty','./../infrastructure/HttpClientService','request','child_process','spawn','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','projects/','/locations/','/registries/','createJwt','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/state','/commands/#','log','Client\x20not\x20connected...','close','error','message','Message\x20received:\x20'];(function(_0x1acd15,_0x38dffa){var _0x471c06=function(_0x38962c){while(--_0x38962c){_0x1acd15['push'](_0x1acd15['shift']());}};_0x471c06(++_0x38dffa);}(a18_0x490b,0x99));var a18_0x94d6=function(_0x121513,_0x4bb134){_0x121513=_0x121513-0x0;var _0x4d2cf4=a18_0x490b[_0x121513];return _0x4d2cf4;};'use strict';Object[a18_0x94d6('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x94d6('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x94d6('0x2'));const progress=require('request-progress');const spawn=require(a18_0x94d6('0x3'))[a18_0x94d6('0x4')];const isImage=require(a18_0x94d6('0x5'));const format=require(a18_0x94d6('0x6'));const os=require('os');const mqtt=require(a18_0x94d6('0x7'));const uuidv4=require(a18_0x94d6('0x8'));const jwt=require(a18_0x94d6('0x9'));class MqttService{constructor(_0x974bb1){this[a18_0x94d6('0xa')]=_0x974bb1;this[a18_0x94d6('0xb')]=a18_0x94d6('0xc');this[a18_0x94d6('0xd')]=new HttpClientService_1['HttpClientService']();}[a18_0x94d6('0xe')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console['log']('mqttInit');const _0x3fef90=a18_0x94d6('0xf');const _0x5a6e59=a18_0x94d6('0x10');const _0x5d32b1=a18_0x94d6('0x11');const _0x55e90b='us-central1';const _0x4aeed8=a18_0x94d6('0x12');const _0x525b6f=a18_0x94d6('0x13');const _0x20be17='mqtt.googleapis.com';const _0xeae126=0x1bb;const _0x3f88e2='events';const _0x1e8e46=0x5;const _0x58e7d7=a18_0x94d6('0x14')+_0x3fef90+a18_0x94d6('0x15')+_0x55e90b+a18_0x94d6('0x16')+_0x5d32b1+'/devices/'+_0x5a6e59;const _0x3b6b4a={'host':_0x20be17,'port':_0xeae126,'clientId':_0x58e7d7,'username':'unused','password':this[a18_0x94d6('0x17')](_0x3fef90,_0x525b6f,_0x4aeed8),'protocol':'mqtts','secureProtocol':a18_0x94d6('0x18')};const _0x67320d=Math[a18_0x94d6('0x19')](Date[a18_0x94d6('0x1a')]()/0x3e8);const _0xaf2506=mqtt[a18_0x94d6('0x1b')](_0x3b6b4a);_0xaf2506[a18_0x94d6('0x1c')](a18_0x94d6('0x1d')+_0x5a6e59+a18_0x94d6('0x1e'),{'qos':0x1});_0xaf2506[a18_0x94d6('0x1c')](a18_0x94d6('0x1d')+_0x5a6e59+a18_0x94d6('0x1f'),{'qos':0x1});_0xaf2506[a18_0x94d6('0x1c')](a18_0x94d6('0x1d')+_0x5a6e59+a18_0x94d6('0x20'),{'qos':0x0});const _0x5a16c3=a18_0x94d6('0x1d')+_0x5a6e59+'/'+_0x3f88e2;_0xaf2506['on'](a18_0x94d6('0x1b'),_0x21a080=>{console['log'](a18_0x94d6('0x1b'));if(!_0x21a080){console[a18_0x94d6('0x21')](a18_0x94d6('0x22'));}else{const _0x5a16c3='/projects/velvety-glazing-252020/topics/my-topic';const _0x24b05f=_0x5d32b1+'/'+_0x5a6e59+'-payload-0';_0xaf2506['publish'](_0x5a16c3,_0x24b05f,{'qos':0x1},_0x48c0fa=>{console[a18_0x94d6('0x21')]('publish\x20result:');console[a18_0x94d6('0x21')](_0x48c0fa);if(!_0x48c0fa){}});}});_0xaf2506['on'](a18_0x94d6('0x23'),()=>{console[a18_0x94d6('0x21')]('close');});_0xaf2506['on'](a18_0x94d6('0x24'),_0xe6a9cf=>{console['log'](a18_0x94d6('0x24'),_0xe6a9cf);});_0xaf2506['on'](a18_0x94d6('0x25'),(_0x5612e8,_0x288cdc)=>{let _0x568765=a18_0x94d6('0x26');console[a18_0x94d6('0x21')](_0x5612e8);console['log'](_0x288cdc+'');if(_0x5612e8===a18_0x94d6('0x1d')+_0x5a6e59+a18_0x94d6('0x1e')){_0x568765='Config\x20message\x20received:\x20';}else if(_0x5612e8[a18_0x94d6('0x27')]('/devices/'+_0x5a6e59+'/commands')){_0x568765='Command\x20message\x20received:\x20';}_0x568765+=Buffer[a18_0x94d6('0x28')](_0x288cdc,'base64')['toString']('ascii');console[a18_0x94d6('0x21')](_0x568765);});_0xaf2506['on'](a18_0x94d6('0x29'),()=>{});console['log'](_0x3b6b4a);}['mqttInit_mosquitto'](){console['log'](a18_0x94d6('0x2a'));this[a18_0x94d6('0x2b')]=uuidv4();console[a18_0x94d6('0x21')]('this.clientId');console[a18_0x94d6('0x21')](this['clientId']);const _0x52b301={'clientId':this[a18_0x94d6('0x2b')],'username':'lulo_mqtt','password':a18_0x94d6('0x2c'),'clean':!![]};this[a18_0x94d6('0x2d')]=mqtt[a18_0x94d6('0x1b')](a18_0x94d6('0x2e'),_0x52b301);this[a18_0x94d6('0x2d')]['on'](a18_0x94d6('0x1b'),this['mqttClient_connect'][a18_0x94d6('0x2f')](this));this[a18_0x94d6('0x2d')]['on']('message',this[a18_0x94d6('0x30')][a18_0x94d6('0x2f')](this));this[a18_0x94d6('0x2d')]['on'](a18_0x94d6('0x23'),()=>{console[a18_0x94d6('0x21')]('close');});process['on'](a18_0x94d6('0x31'),this['handleAppExit'][a18_0x94d6('0x2f')](this));process['on'](a18_0x94d6('0x32'),this['handleAppExit'][a18_0x94d6('0x2f')](this));process['on'](a18_0x94d6('0x33'),this[a18_0x94d6('0x34')]['bind'](this));}[a18_0x94d6('0x35')](){console[a18_0x94d6('0x21')](a18_0x94d6('0x36')+this[a18_0x94d6('0x2b')]);this[a18_0x94d6('0x2d')]['subscribe'](a18_0x94d6('0x37'));this[a18_0x94d6('0x2d')]['subscribe'](a18_0x94d6('0x38'));this[a18_0x94d6('0x2d')]['subscribe'](a18_0x94d6('0x39'),{'qos':0x2});this['mqttClient'][a18_0x94d6('0x1c')](a18_0x94d6('0x3a'),{'qos':0x2});this[a18_0x94d6('0x2d')][a18_0x94d6('0x1c')](a18_0x94d6('0x3b'),{'qos':0x2});this[a18_0x94d6('0x2d')][a18_0x94d6('0x1c')]('player/update',{'qos':0x2});this[a18_0x94d6('0x2d')]['subscribe'](a18_0x94d6('0x3c'),{'qos':0x2});this[a18_0x94d6('0x2d')][a18_0x94d6('0x1c')](a18_0x94d6('0x3d'),{'qos':0x2});}[a18_0x94d6('0x3e')](){}[a18_0x94d6('0x30')](_0x301a08,_0x80bf7d){console[a18_0x94d6('0x21')](a18_0x94d6('0x3f'),_0x301a08,_0x80bf7d);switch(_0x301a08){case a18_0x94d6('0x37'):return this['handleOpenRequest'](_0x80bf7d);case'player/close':return this[a18_0x94d6('0x40')](_0x80bf7d);case a18_0x94d6('0x39'):return this[a18_0x94d6('0x41')](_0x80bf7d);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x80bf7d);case a18_0x94d6('0x3a'):return this['handleLoadPlaylistRequest'](_0x80bf7d);case a18_0x94d6('0x42'):return this[a18_0x94d6('0x43')](_0x80bf7d);case'player/ifconfig':return this[a18_0x94d6('0x44')](_0x80bf7d);case a18_0x94d6('0x3d'):return this[a18_0x94d6('0x45')](_0x80bf7d);}}['handleRegisterRequest'](_0x11afd5){if(_0x11afd5=='all'||_0x11afd5==String(this['syncPlaylistsService'][a18_0x94d6('0x46')])){this[a18_0x94d6('0xa')][a18_0x94d6('0x47')]();}}[a18_0x94d6('0x44')](_0x1b36a2){if(_0x1b36a2==a18_0x94d6('0x48')||_0x1b36a2==String(this[a18_0x94d6('0xa')][a18_0x94d6('0x46')])){}}[a18_0x94d6('0x43')](_0x18713a){console['log']('handleUpdateRequest:\x20'+_0x18713a);if(_0x18713a==a18_0x94d6('0x48')||_0x18713a==String(this[a18_0x94d6('0xa')][a18_0x94d6('0x46')])){const _0x4611ea=__dirname;const _0x58394d=require(a18_0x94d6('0x49'))(_0x4611ea);console[a18_0x94d6('0x21')]('Git\x20updating');_0x58394d[a18_0x94d6('0x4a')]((_0x20c87e,_0x234dae)=>{if(_0x20c87e){console['log'](a18_0x94d6('0x4b'));this['handleUpdateRequest'](_0x18713a);return;}else{}console[a18_0x94d6('0x21')](a18_0x94d6('0x4c'));console['log'](_0x234dae);if(_0x234dae&&_0x234dae[a18_0x94d6('0x4d')][a18_0x94d6('0x4e')]){const _0x31e727=spawn(a18_0x94d6('0x4f'),['-r','now']);}else{}});}}['handleLoadPlaylistRequest'](_0x742d95){if(_0x742d95==a18_0x94d6('0x48')||_0x742d95==String(this[a18_0x94d6('0xa')][a18_0x94d6('0x46')])){this[a18_0x94d6('0xa')][a18_0x94d6('0x50')]();}}['handleReloadPlaylistRequest'](_0x324eaa){if(String(_0x324eaa)==a18_0x94d6('0x48')||String(_0x324eaa)==String(this[a18_0x94d6('0xa')][a18_0x94d6('0x46')])){this['syncPlaylistsService'][a18_0x94d6('0x51')]();}}['handleRebootRequest'](_0x47d7d2){if(_0x47d7d2==a18_0x94d6('0x48')||_0x47d7d2==String(this[a18_0x94d6('0xa')][a18_0x94d6('0x46')])){const _0x27f1ea=spawn('shutdown',['-r',a18_0x94d6('0x1a')]);}}[a18_0x94d6('0x52')](){console[a18_0x94d6('0x21')](a18_0x94d6('0x53'),this[a18_0x94d6('0xb')]);this['mqttClient'][a18_0x94d6('0x54')](a18_0x94d6('0x55'),this['syncPlaylistsService']['playerId']+'-'+this['state']);}[a18_0x94d6('0x56')](_0x35e829){if(this[a18_0x94d6('0xb')]!==a18_0x94d6('0x57')&&this[a18_0x94d6('0xb')]!==a18_0x94d6('0x58')){console[a18_0x94d6('0x21')](a18_0x94d6('0x59'));this[a18_0x94d6('0xb')]=a18_0x94d6('0x58');this[a18_0x94d6('0x52')]();setTimeout(()=>{this[a18_0x94d6('0xb')]=a18_0x94d6('0x57');this[a18_0x94d6('0x52')]();},0x1388);}}['handleCloseRequest'](_0x3e2667){if(this[a18_0x94d6('0xb')]!==a18_0x94d6('0xc')&&this[a18_0x94d6('0xb')]!==a18_0x94d6('0x5a')){this[a18_0x94d6('0xb')]=a18_0x94d6('0x5a');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x94d6('0xb')]='closed';this[a18_0x94d6('0x52')]();},0x1388);}}[a18_0x94d6('0x34')](_0x30d53a,_0x246b4e){if(_0x246b4e){console[a18_0x94d6('0x21')](_0x246b4e[a18_0x94d6('0x5b')]);}this['mqttClient'][a18_0x94d6('0x54')](a18_0x94d6('0x5c'),a18_0x94d6('0x5d'));}[a18_0x94d6('0x17')](_0x16f9d9,_0x5434ac,_0x2fc598){const _0x11a401={'iat':Math['round'](Date[a18_0x94d6('0x1a')]()/0x3e8),'exp':Math[a18_0x94d6('0x19')](Date[a18_0x94d6('0x1a')]()/0x3e8)+0x14*0x3c,'aud':_0x16f9d9};const _0x15d20e=fs[a18_0x94d6('0x5e')](_0x5434ac);return jwt[a18_0x94d6('0x5f')](_0x11a401,_0x15d20e,{'algorithm':_0x2fc598});}}exports['MqttService']=MqttService;