var a18_0x3750=['Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','handleLoadPlaylistRequest','handleReloadPlaylistRequest','reloadMediaList','sending\x20state\x20%s','publish','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','closing','player/connected','false','MqttService','defineProperty','request','request-progress','child_process','spawn','is-image','uuid/v4','syncPlaylistsService','state','closed','httpClientService','mqttInit','log','clientId','this.clientId','mqttClient','connect','mqtt://lulo.run','bind','message','mqttClient_message','exit','handleAppExit','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/update','reportStatus','handleOpenRequest','player/close','handleRebootRequest','handleUpdateRequest','all','playerId'];(function(_0x444df6,_0x52ac1b){var _0xc21637=function(_0x1276e6){while(--_0x1276e6){_0x444df6['push'](_0x444df6['shift']());}};_0xc21637(++_0x52ac1b);}(a18_0x3750,0x184));var a18_0x1c1a=function(_0x1d7e82,_0x483860){_0x1d7e82=_0x1d7e82-0x0;var _0x5d969a=a18_0x3750[_0x1d7e82];return _0x5d969a;};'use strict';Object[a18_0x1c1a('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x1c1a('0x1'));const progress=require(a18_0x1c1a('0x2'));const spawn=require(a18_0x1c1a('0x3'))[a18_0x1c1a('0x4')];const isImage=require(a18_0x1c1a('0x5'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x1c1a('0x6'));class MqttService{constructor(_0xa1bea8){this[a18_0x1c1a('0x7')]=_0xa1bea8;this[a18_0x1c1a('0x8')]=a18_0x1c1a('0x9');this[a18_0x1c1a('0xa')]=new HttpClientService_1['HttpClientService']();}['init'](){this[a18_0x1c1a('0xb')]();}[a18_0x1c1a('0xb')](){console[a18_0x1c1a('0xc')]('mqttInit');this[a18_0x1c1a('0xd')]=uuidv4();console[a18_0x1c1a('0xc')](a18_0x1c1a('0xe'));console['log'](this['clientId']);const _0x1d07ae={'clientId':this['clientId'],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this[a18_0x1c1a('0xf')]=mqtt[a18_0x1c1a('0x10')](a18_0x1c1a('0x11'),_0x1d07ae);this[a18_0x1c1a('0xf')]['on'](a18_0x1c1a('0x10'),this['mqttClient_connect'][a18_0x1c1a('0x12')](this));this[a18_0x1c1a('0xf')]['on'](a18_0x1c1a('0x13'),this[a18_0x1c1a('0x14')][a18_0x1c1a('0x12')](this));process['on'](a18_0x1c1a('0x15'),this[a18_0x1c1a('0x16')][a18_0x1c1a('0x12')](this));process['on']('SIGINT',this[a18_0x1c1a('0x16')]['bind'](this));process['on'](a18_0x1c1a('0x17'),this[a18_0x1c1a('0x16')][a18_0x1c1a('0x12')](this));}[a18_0x1c1a('0x18')](){console[a18_0x1c1a('0xc')](a18_0x1c1a('0x19')+this[a18_0x1c1a('0xd')]);this['mqttClient'][a18_0x1c1a('0x1a')](a18_0x1c1a('0x1b'));this[a18_0x1c1a('0xf')][a18_0x1c1a('0x1a')]('player/close');this[a18_0x1c1a('0xf')][a18_0x1c1a('0x1a')](a18_0x1c1a('0x1c'),{'qos':0x2});this['mqttClient'][a18_0x1c1a('0x1a')](a18_0x1c1a('0x1d'),{'qos':0x2});this[a18_0x1c1a('0xf')][a18_0x1c1a('0x1a')](a18_0x1c1a('0x1e'),{'qos':0x2});this['mqttClient'][a18_0x1c1a('0x1a')](a18_0x1c1a('0x1f'),{'qos':0x2});}[a18_0x1c1a('0x20')](){}[a18_0x1c1a('0x14')](_0x4e01aa,_0x2f55b9){console['log']('received\x20message\x20%s\x20%s',_0x4e01aa,_0x2f55b9);switch(_0x4e01aa){case a18_0x1c1a('0x1b'):return this[a18_0x1c1a('0x21')](_0x2f55b9);case a18_0x1c1a('0x22'):return this['handleCloseRequest'](_0x2f55b9);case'player/reboot':return this[a18_0x1c1a('0x23')](_0x2f55b9);case a18_0x1c1a('0x1e'):return this['handleReloadPlaylistRequest'](_0x2f55b9);case a18_0x1c1a('0x1d'):return this['handleLoadPlaylistRequest'](_0x2f55b9);case a18_0x1c1a('0x1f'):return this[a18_0x1c1a('0x24')](_0x2f55b9);}}[a18_0x1c1a('0x24')](_0x1fecdb){if(_0x1fecdb==a18_0x1c1a('0x25')||_0x1fecdb==String(this[a18_0x1c1a('0x7')][a18_0x1c1a('0x26')])){const _0x539d4c=__dirname;const _0x35e20f=require('simple-git')(_0x539d4c);console[a18_0x1c1a('0xc')](a18_0x1c1a('0x27'));_0x35e20f[a18_0x1c1a('0x28')]((_0x282099,_0x5415c4)=>{if(_0x282099){console['log'](a18_0x1c1a('0x29'));this['handleUpdateRequest'](_0x1fecdb);return;}else{}console['log'](a18_0x1c1a('0x2a'));console[a18_0x1c1a('0xc')](_0x5415c4);if(_0x5415c4&&_0x5415c4[a18_0x1c1a('0x2b')][a18_0x1c1a('0x2c')]){const _0x265ab8=spawn(a18_0x1c1a('0x2d'),['-r',a18_0x1c1a('0x2e')]);}else{}});}}[a18_0x1c1a('0x2f')](_0xd82899){if(_0xd82899==a18_0x1c1a('0x25')||_0xd82899==String(this[a18_0x1c1a('0x7')]['playerId'])){this[a18_0x1c1a('0x7')]['loadMediaList']();}}[a18_0x1c1a('0x30')](_0x2abc60){if(_0x2abc60=='all'||_0x2abc60==String(this['syncPlaylistsService'][a18_0x1c1a('0x26')])){this[a18_0x1c1a('0x7')][a18_0x1c1a('0x31')]();}}['handleRebootRequest'](_0x5337ef){if(_0x5337ef==a18_0x1c1a('0x25')||_0x5337ef==String(this['syncPlaylistsService'][a18_0x1c1a('0x26')])){const _0xbb1ffa=spawn(a18_0x1c1a('0x2d'),['-r',a18_0x1c1a('0x2e')]);}}['sendStateUpdate'](){console[a18_0x1c1a('0xc')](a18_0x1c1a('0x32'),this[a18_0x1c1a('0x8')]);this['mqttClient'][a18_0x1c1a('0x33')](a18_0x1c1a('0x34'),this[a18_0x1c1a('0x7')]['playerId']+'-'+this[a18_0x1c1a('0x8')]);}[a18_0x1c1a('0x21')](_0x3fd08b){if(this[a18_0x1c1a('0x8')]!==a18_0x1c1a('0x35')&&this[a18_0x1c1a('0x8')]!==a18_0x1c1a('0x36')){console[a18_0x1c1a('0xc')](a18_0x1c1a('0x37'));this[a18_0x1c1a('0x8')]=a18_0x1c1a('0x36');this[a18_0x1c1a('0x38')]();setTimeout(()=>{this[a18_0x1c1a('0x8')]=a18_0x1c1a('0x35');this[a18_0x1c1a('0x38')]();},0x1388);}}['handleCloseRequest'](_0x42e243){if(this[a18_0x1c1a('0x8')]!=='closed'&&this[a18_0x1c1a('0x8')]!==a18_0x1c1a('0x39')){this[a18_0x1c1a('0x8')]=a18_0x1c1a('0x39');this[a18_0x1c1a('0x38')]();setTimeout(()=>{this[a18_0x1c1a('0x8')]=a18_0x1c1a('0x9');this[a18_0x1c1a('0x38')]();},0x1388);}}[a18_0x1c1a('0x16')](_0x185ff4,_0x173987){if(_0x173987){console[a18_0x1c1a('0xc')](_0x173987['stack']);}this[a18_0x1c1a('0xf')]['publish'](a18_0x1c1a('0x3a'),a18_0x1c1a('0x3b'));}}exports[a18_0x1c1a('0x3c')]=MqttService;