var a17_0x3205=['handleCloseRequest','player/reboot','handleReloadPlaylistRequest','handleUpdateRequest','all','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','changes','shutdown','now','handleLoadPlaylistRequest','reloadMediaList','handleRebootRequest','sending\x20state\x20%s','publish','player/state','open','opening','sendStateUpdate','closing','stack','player/connected','false','defineProperty','__esModule','request','request-progress','child_process','is-image','mqtt','uuid/v4','state','closed','init','mqttInit','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','connect','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','subscribe','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','registerClient','syncPlaylistsService','playerId','networkInterfaces','reportStatus','log','handleOpenRequest'];(function(_0x2538c9,_0xab1909){var _0x4cd961=function(_0x4a94e1){while(--_0x4a94e1){_0x2538c9['push'](_0x2538c9['shift']());}};_0x4cd961(++_0xab1909);}(a17_0x3205,0xd7));var a17_0x28cb=function(_0x1151a2,_0x39964e){_0x1151a2=_0x1151a2-0x0;var _0x506f7e=a17_0x3205[_0x1151a2];return _0x506f7e;};'use strict';Object[a17_0x28cb('0x0')](exports,a17_0x28cb('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a17_0x28cb('0x2'));const progress=require(a17_0x28cb('0x3'));const spawn=require(a17_0x28cb('0x4'))['spawn'];const isImage=require(a17_0x28cb('0x5'));const format=require('string-template');const os=require('os');const mqtt=require(a17_0x28cb('0x6'));const uuidv4=require(a17_0x28cb('0x7'));class MqttService{constructor(_0x492c13){this[a17_0x28cb('0x8')]=a17_0x28cb('0x9');this['syncPlaylistsService']=_0x492c13;}[a17_0x28cb('0xa')](){this[a17_0x28cb('0xb')]();}['mqttInit'](){console['log']('mqttInit');this[a17_0x28cb('0xc')]=uuidv4();const _0x4e90e7={'clientId':this[a17_0x28cb('0xc')],'username':a17_0x28cb('0xd'),'password':a17_0x28cb('0xe'),'clean':!![]};this[a17_0x28cb('0xf')]=mqtt['connect'](a17_0x28cb('0x10'),_0x4e90e7);this[a17_0x28cb('0xf')]['on'](a17_0x28cb('0x11'),this[a17_0x28cb('0x12')][a17_0x28cb('0x13')](this));this[a17_0x28cb('0xf')]['on']('message',this[a17_0x28cb('0x14')][a17_0x28cb('0x13')](this));process['on'](a17_0x28cb('0x15'),this[a17_0x28cb('0x16')][a17_0x28cb('0x13')](this));process['on'](a17_0x28cb('0x17'),this[a17_0x28cb('0x16')][a17_0x28cb('0x13')](this));process['on']('uncaughtException',this['handleAppExit'][a17_0x28cb('0x13')](this));}[a17_0x28cb('0x12')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a17_0x28cb('0xc')]);this[a17_0x28cb('0xf')][a17_0x28cb('0x18')](a17_0x28cb('0x19'));this['mqttClient'][a17_0x28cb('0x18')](a17_0x28cb('0x1a'));this[a17_0x28cb('0xf')]['subscribe']('player/reboot',{'qos':0x2});this[a17_0x28cb('0xf')][a17_0x28cb('0x18')](a17_0x28cb('0x1b'),{'qos':0x2});this[a17_0x28cb('0xf')][a17_0x28cb('0x18')](a17_0x28cb('0x1c'),{'qos':0x2});this['mqttClient']['subscribe'](a17_0x28cb('0x1d'),{'qos':0x2});this[a17_0x28cb('0x1e')]();}[a17_0x28cb('0x1e')](){const _0x45ce11={'playerId':this[a17_0x28cb('0x1f')][a17_0x28cb('0x20')],'clientId':this[a17_0x28cb('0xc')],'connected':!![],'network':JSON['stringify'](os[a17_0x28cb('0x21')]())};console['log'](_0x45ce11);}[a17_0x28cb('0x22')](){}[a17_0x28cb('0x14')](_0xd263d,_0x20f835){console[a17_0x28cb('0x23')]('received\x20message\x20%s\x20%s',_0xd263d,_0x20f835);switch(_0xd263d){case a17_0x28cb('0x19'):return this[a17_0x28cb('0x24')](_0x20f835);case'player/close':return this[a17_0x28cb('0x25')](_0x20f835);case a17_0x28cb('0x26'):return this['handleRebootRequest'](_0x20f835);case a17_0x28cb('0x1c'):return this[a17_0x28cb('0x27')](_0x20f835);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0x20f835);case'player/update':return this[a17_0x28cb('0x28')](_0x20f835);}}[a17_0x28cb('0x28')](_0x124402){if(_0x124402==a17_0x28cb('0x29')||_0x124402==String(this[a17_0x28cb('0x1f')][a17_0x28cb('0x20')])){const _0x53d848=__dirname;const _0x3a6442=require(a17_0x28cb('0x2a'))(_0x53d848);console['log'](a17_0x28cb('0x2b'));_0x3a6442[a17_0x28cb('0x2c')]((_0x3a14ca,_0x2af330)=>{if(_0x3a14ca){console['log'](a17_0x28cb('0x2d'));this['handleUpdateRequest'](_0x124402);return;}else{}console[a17_0x28cb('0x23')](a17_0x28cb('0x2e'));console[a17_0x28cb('0x23')](_0x2af330);if(_0x2af330&&_0x2af330['summary'][a17_0x28cb('0x2f')]){const _0x126c99=spawn(a17_0x28cb('0x30'),['-r',a17_0x28cb('0x31')]);}else{}});}}[a17_0x28cb('0x32')](_0x18aa31){if(_0x18aa31==a17_0x28cb('0x29')||_0x18aa31==String(this['syncPlaylistsService'][a17_0x28cb('0x20')])){this[a17_0x28cb('0x1f')]['loadMediaList']();}}['handleReloadPlaylistRequest'](_0x329b9c){if(_0x329b9c==a17_0x28cb('0x29')||_0x329b9c==String(this[a17_0x28cb('0x1f')]['playerId'])){this['syncPlaylistsService'][a17_0x28cb('0x33')]();}}[a17_0x28cb('0x34')](_0x5c2e04){if(_0x5c2e04==a17_0x28cb('0x29')||_0x5c2e04==String(this[a17_0x28cb('0x1f')][a17_0x28cb('0x20')])){const _0x40e09d=spawn('shutdown',['-r',a17_0x28cb('0x31')]);}}['sendStateUpdate'](){console[a17_0x28cb('0x23')](a17_0x28cb('0x35'),this[a17_0x28cb('0x8')]);this['mqttClient'][a17_0x28cb('0x36')](a17_0x28cb('0x37'),this['syncPlaylistsService'][a17_0x28cb('0x20')]+'-'+this[a17_0x28cb('0x8')]);}[a17_0x28cb('0x24')](_0x1a7ba4){if(this['state']!==a17_0x28cb('0x38')&&this[a17_0x28cb('0x8')]!==a17_0x28cb('0x39')){console[a17_0x28cb('0x23')]('opening\x20player\x20door');this[a17_0x28cb('0x8')]=a17_0x28cb('0x39');this[a17_0x28cb('0x3a')]();setTimeout(()=>{this['state']='open';this['sendStateUpdate']();},0x1388);}}[a17_0x28cb('0x25')](_0x1cf0c4){if(this[a17_0x28cb('0x8')]!==a17_0x28cb('0x9')&&this[a17_0x28cb('0x8')]!==a17_0x28cb('0x3b')){this[a17_0x28cb('0x8')]=a17_0x28cb('0x3b');this[a17_0x28cb('0x3a')]();setTimeout(()=>{this[a17_0x28cb('0x8')]='closed';this[a17_0x28cb('0x3a')]();},0x1388);}}[a17_0x28cb('0x16')](_0x2379cf,_0x2bf413){if(_0x2bf413){console['log'](_0x2bf413[a17_0x28cb('0x3c')]);}this[a17_0x28cb('0xf')][a17_0x28cb('0x36')](a17_0x28cb('0x3d'),a17_0x28cb('0x3e'));}}exports['MqttService']=MqttService;