var a18_0x35b8=['shutdown','now','loadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','sudo\x20/sbin/shutdown\x20-r\x20now','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','exec','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','player/open','player/close','player/reboot','player/reload_playlist','player/ifconfig','player/register','reportStatus','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/load_playlist','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','registerClient','playerId','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','changes'];(function(_0x87add6,_0x4e956a){var _0x57c882=function(_0x373a88){while(--_0x373a88){_0x87add6['push'](_0x87add6['shift']());}};_0x57c882(++_0x4e956a);}(a18_0x35b8,0x7a));var a18_0x4b17=function(_0x41355a,_0x1f379b){_0x41355a=_0x41355a-0x0;var _0xe97942=a18_0x35b8[_0x41355a];return _0xe97942;};'use strict';Object[a18_0x4b17('0x0')](exports,a18_0x4b17('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x4b17('0x2'));const fs=require('fs');const fsExtra=require(a18_0x4b17('0x3'));const request=require(a18_0x4b17('0x4'));const progress=require('request-progress');const {spawn}=require(a18_0x4b17('0x5'));const exec=require(a18_0x4b17('0x5'))[a18_0x4b17('0x6')];const isImage=require('is-image');const format=require(a18_0x4b17('0x7'));const os=require('os');const mqtt=require(a18_0x4b17('0x8'));const uuidv4=require(a18_0x4b17('0x9'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x4a1993){this[a18_0x4b17('0xa')]=_0x4a1993;this[a18_0x4b17('0xb')]=a18_0x4b17('0xc');this[a18_0x4b17('0xd')]=new HttpClientService_1[(a18_0x4b17('0xe'))]();}[a18_0x4b17('0xf')](){this[a18_0x4b17('0x10')]();}[a18_0x4b17('0x11')](){console[a18_0x4b17('0x12')](a18_0x4b17('0x13'));const _0x1107d8=a18_0x4b17('0x14');const _0x39677c='my-node-device';const _0x57f769='my-registry';const _0x297643=a18_0x4b17('0x15');const _0x5ccc5c=a18_0x4b17('0x16');const _0x3a67fd=a18_0x4b17('0x17');const _0x51e58f=a18_0x4b17('0x18');const _0x64c33c=0x1bb;const _0x3d744b=a18_0x4b17('0x19');const _0xd4d3c6=0x5;const _0x44878b='projects/'+_0x1107d8+a18_0x4b17('0x1a')+_0x297643+a18_0x4b17('0x1b')+_0x57f769+a18_0x4b17('0x1c')+_0x39677c;const _0x47aae2={'host':_0x51e58f,'port':_0x64c33c,'clientId':_0x44878b,'username':a18_0x4b17('0x1d'),'password':this[a18_0x4b17('0x1e')](_0x1107d8,_0x3a67fd,_0x5ccc5c),'protocol':a18_0x4b17('0x1f'),'secureProtocol':a18_0x4b17('0x20')};const _0x18a3c0=Math['round'](Date['now']()/0x3e8);const _0x1e2518=mqtt[a18_0x4b17('0x21')](_0x47aae2);_0x1e2518[a18_0x4b17('0x22')]('/devices/'+_0x39677c+a18_0x4b17('0x23'),{'qos':0x1});_0x1e2518[a18_0x4b17('0x22')](a18_0x4b17('0x1c')+_0x39677c+a18_0x4b17('0x24'),{'qos':0x1});_0x1e2518[a18_0x4b17('0x22')](a18_0x4b17('0x1c')+_0x39677c+a18_0x4b17('0x25'),{'qos':0x0});const _0x2f85d8='/devices/'+_0x39677c+'/'+_0x3d744b;_0x1e2518['on']('connect',_0x5d4d12=>{console[a18_0x4b17('0x12')]('connect');if(!_0x5d4d12){console[a18_0x4b17('0x12')](a18_0x4b17('0x26'));}else{const _0x2f85d8='/projects/velvety-glazing-252020/topics/my-topic';const _0x21a005=_0x57f769+'/'+_0x39677c+a18_0x4b17('0x27');_0x1e2518[a18_0x4b17('0x28')](_0x2f85d8,_0x21a005,{'qos':0x1},_0x135e27=>{console['log'](a18_0x4b17('0x29'));console['log'](_0x135e27);if(!_0x135e27){}});}});_0x1e2518['on'](a18_0x4b17('0x2a'),()=>{console[a18_0x4b17('0x12')](a18_0x4b17('0x2a'));});_0x1e2518['on'](a18_0x4b17('0x2b'),_0x291841=>{console[a18_0x4b17('0x12')]('error',_0x291841);});_0x1e2518['on'](a18_0x4b17('0x2c'),(_0x4773c2,_0x5efa1a)=>{let _0x2e38c0=a18_0x4b17('0x2d');console['log'](_0x4773c2);console['log'](_0x5efa1a+'');if(_0x4773c2==='/devices/'+_0x39677c+a18_0x4b17('0x23')){_0x2e38c0=a18_0x4b17('0x2e');}else if(_0x4773c2['startsWith']('/devices/'+_0x39677c+'/commands')){_0x2e38c0=a18_0x4b17('0x2f');}_0x2e38c0+=Buffer[a18_0x4b17('0x30')](_0x5efa1a,a18_0x4b17('0x31'))[a18_0x4b17('0x32')](a18_0x4b17('0x33'));console['log'](_0x2e38c0);});_0x1e2518['on'](a18_0x4b17('0x34'),()=>{});console[a18_0x4b17('0x12')](_0x47aae2);}['mqttInit_mosquitto'](){console[a18_0x4b17('0x12')]('mqttInit');this[a18_0x4b17('0x35')]=uuidv4();console['log']('this.clientId');console[a18_0x4b17('0x12')](this[a18_0x4b17('0x35')]);const _0x4f41e3={'clientId':this[a18_0x4b17('0x35')],'username':'lulo_mqtt','password':a18_0x4b17('0x36'),'clean':!![]};this[a18_0x4b17('0x37')]=mqtt[a18_0x4b17('0x21')](a18_0x4b17('0x38'),_0x4f41e3);this[a18_0x4b17('0x37')]['on'](a18_0x4b17('0x21'),this['mqttClient_connect'][a18_0x4b17('0x39')](this));this[a18_0x4b17('0x37')]['on'](a18_0x4b17('0x2c'),this[a18_0x4b17('0x3a')][a18_0x4b17('0x39')](this));this[a18_0x4b17('0x37')]['on'](a18_0x4b17('0x2a'),()=>{console['log'](a18_0x4b17('0x2a'));});process['on'](a18_0x4b17('0x3b'),this[a18_0x4b17('0x3c')][a18_0x4b17('0x39')](this));process['on'](a18_0x4b17('0x3d'),this['handleAppExit'][a18_0x4b17('0x39')](this));process['on'](a18_0x4b17('0x3e'),this['handleAppExit'][a18_0x4b17('0x39')](this));}[a18_0x4b17('0x3f')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x4b17('0x35')]);this[a18_0x4b17('0x37')]['subscribe'](a18_0x4b17('0x40'));this[a18_0x4b17('0x37')][a18_0x4b17('0x22')](a18_0x4b17('0x41'));this[a18_0x4b17('0x37')][a18_0x4b17('0x22')](a18_0x4b17('0x42'),{'qos':0x2});this['mqttClient'][a18_0x4b17('0x22')]('player/load_playlist',{'qos':0x2});this['mqttClient']['subscribe'](a18_0x4b17('0x43'),{'qos':0x2});this['mqttClient']['subscribe']('player/update',{'qos':0x2});this[a18_0x4b17('0x37')][a18_0x4b17('0x22')](a18_0x4b17('0x44'),{'qos':0x2});this[a18_0x4b17('0x37')]['subscribe'](a18_0x4b17('0x45'),{'qos':0x2});}[a18_0x4b17('0x46')](){}[a18_0x4b17('0x3a')](_0x282ab4,_0x1323fe){console['log']('received\x20message\x20%s\x20%s',_0x282ab4,_0x1323fe);switch(_0x282ab4){case a18_0x4b17('0x40'):return this[a18_0x4b17('0x47')](_0x1323fe);case a18_0x4b17('0x41'):return this[a18_0x4b17('0x48')](_0x1323fe);case a18_0x4b17('0x42'):return this[a18_0x4b17('0x49')](_0x1323fe);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x1323fe);case a18_0x4b17('0x4a'):return this[a18_0x4b17('0x4b')](_0x1323fe);case a18_0x4b17('0x4c'):return this[a18_0x4b17('0x4d')](_0x1323fe);case a18_0x4b17('0x44'):return this[a18_0x4b17('0x4e')](_0x1323fe);case'player/register':return this[a18_0x4b17('0x4f')](_0x1323fe);}}[a18_0x4b17('0x4f')](_0x413702){if(_0x413702==a18_0x4b17('0x50')||_0x413702==String(this[a18_0x4b17('0xa')]['playerId'])){this['syncPlaylistsService'][a18_0x4b17('0x51')]();}}[a18_0x4b17('0x4e')](_0x238d95){if(_0x238d95=='all'||_0x238d95==String(this['syncPlaylistsService'][a18_0x4b17('0x52')])){}}[a18_0x4b17('0x4d')](_0x1535f3){console[a18_0x4b17('0x12')](a18_0x4b17('0x53')+_0x1535f3);if(_0x1535f3==a18_0x4b17('0x50')||_0x1535f3==String(this[a18_0x4b17('0xa')]['playerId'])){const _0x3c9eea=__dirname;const _0x4994e6=require(a18_0x4b17('0x54'))(_0x3c9eea);console['log'](a18_0x4b17('0x55'));_0x4994e6[a18_0x4b17('0x56')]((_0x4b29fc,_0x30ae5e)=>{if(_0x4b29fc){console[a18_0x4b17('0x12')](a18_0x4b17('0x57'));this['handleUpdateRequest'](_0x1535f3);return;}else{}console[a18_0x4b17('0x12')](a18_0x4b17('0x58'));console[a18_0x4b17('0x12')](_0x30ae5e);if(_0x30ae5e&&_0x30ae5e['summary'][a18_0x4b17('0x59')]){const _0x3aad1f=spawn(a18_0x4b17('0x5a'),['-r',a18_0x4b17('0x5b')]);}else{}});}}[a18_0x4b17('0x4b')](_0x50fcf1){if(_0x50fcf1==a18_0x4b17('0x50')||_0x50fcf1==String(this[a18_0x4b17('0xa')]['playerId'])){this[a18_0x4b17('0xa')][a18_0x4b17('0x5c')]();}}['handleReloadPlaylistRequest'](_0x4ca3ee){if(String(_0x4ca3ee)==a18_0x4b17('0x50')||String(_0x4ca3ee)==String(this[a18_0x4b17('0xa')]['playerId'])){this[a18_0x4b17('0xa')]['reloadMediaList']();}}[a18_0x4b17('0x49')](_0x1eef05){if(_0x1eef05==a18_0x4b17('0x50')||_0x1eef05==String(this[a18_0x4b17('0xa')][a18_0x4b17('0x52')])){console[a18_0x4b17('0x12')](a18_0x4b17('0x5d'));try{require('child_process')[a18_0x4b17('0x6')](a18_0x4b17('0x5e'),function(_0x47cdfb){console['log'](_0x47cdfb);});}catch(_0x5bc021){console['log'](_0x5bc021);}}}[a18_0x4b17('0x5f')](){console[a18_0x4b17('0x12')](a18_0x4b17('0x60'),this[a18_0x4b17('0xb')]);this['mqttClient'][a18_0x4b17('0x28')](a18_0x4b17('0x61'),this[a18_0x4b17('0xa')][a18_0x4b17('0x52')]+'-'+this[a18_0x4b17('0xb')]);}[a18_0x4b17('0x47')](_0x382c7b){if(this[a18_0x4b17('0xb')]!==a18_0x4b17('0x62')&&this[a18_0x4b17('0xb')]!==a18_0x4b17('0x63')){console['log'](a18_0x4b17('0x64'));this['state']=a18_0x4b17('0x63');this[a18_0x4b17('0x5f')]();setTimeout(()=>{this[a18_0x4b17('0xb')]='open';this['sendStateUpdate']();},0x1388);}}[a18_0x4b17('0x48')](_0x5385f3){if(this[a18_0x4b17('0xb')]!==a18_0x4b17('0xc')&&this[a18_0x4b17('0xb')]!==a18_0x4b17('0x65')){this[a18_0x4b17('0xb')]=a18_0x4b17('0x65');this[a18_0x4b17('0x5f')]();setTimeout(()=>{this[a18_0x4b17('0xb')]=a18_0x4b17('0xc');this[a18_0x4b17('0x5f')]();},0x1388);}}[a18_0x4b17('0x3c')](_0xbac87d,_0x644767){if(_0x644767){console[a18_0x4b17('0x12')](_0x644767[a18_0x4b17('0x66')]);}this[a18_0x4b17('0x37')][a18_0x4b17('0x28')](a18_0x4b17('0x67'),'false');}['createJwt'](_0x53ca6f,_0x174bd2,_0x5a827f){const _0x4059c0={'iat':Math['round'](Date[a18_0x4b17('0x5b')]()/0x3e8),'exp':Math['round'](Date[a18_0x4b17('0x5b')]()/0x3e8)+0x14*0x3c,'aud':_0x53ca6f};const _0xdc9cba=fs['readFileSync'](_0x174bd2);return jwt[a18_0x4b17('0x68')](_0x4059c0,_0xdc9cba,{'algorithm':_0x5a827f});}}exports[a18_0x4b17('0x69')]=MqttService;