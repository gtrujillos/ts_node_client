var a18_0x194a=['opening','opening\x20player\x20door','closing','stack','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit','log','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','connect','mqttClient','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/load_playlist','player/reload_playlist','player/update','player/register','player/open','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','playerId','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','now','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','state','handleOpenRequest','open'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a18_0x194a,0x118));var a18_0xac6d=function(_0x3aaab6,_0x1cda16){_0x3aaab6=_0x3aaab6-0x0;var _0x1f26c6=a18_0x194a[_0x3aaab6];return _0x1f26c6;};'use strict';Object[a18_0xac6d('0x0')](exports,a18_0xac6d('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0xac6d('0x2'));const fs=require('fs');const fsExtra=require(a18_0xac6d('0x3'));const request=require(a18_0xac6d('0x4'));const progress=require(a18_0xac6d('0x5'));const spawn=require('child_process')['spawn'];const isImage=require(a18_0xac6d('0x6'));const format=require(a18_0xac6d('0x7'));const os=require('os');const mqtt=require(a18_0xac6d('0x8'));const uuidv4=require(a18_0xac6d('0x9'));class MqttService{constructor(_0x6bcba4){this[a18_0xac6d('0xa')]=_0x6bcba4;this['state']=a18_0xac6d('0xb');this[a18_0xac6d('0xc')]=new HttpClientService_1[(a18_0xac6d('0xd'))]();}[a18_0xac6d('0xe')](){this[a18_0xac6d('0xf')]();}[a18_0xac6d('0xf')](){console[a18_0xac6d('0x10')](a18_0xac6d('0xf'));this['clientId']=uuidv4();console[a18_0xac6d('0x10')](a18_0xac6d('0x11'));console[a18_0xac6d('0x10')](this[a18_0xac6d('0x12')]);const _0x372433={'clientId':this[a18_0xac6d('0x12')],'username':a18_0xac6d('0x13'),'password':a18_0xac6d('0x14'),'clean':!![]};this['mqttClient']=mqtt[a18_0xac6d('0x15')]('mqtt://lulo.run',_0x372433);this[a18_0xac6d('0x16')]['on']('connect',this[a18_0xac6d('0x17')][a18_0xac6d('0x18')](this));this[a18_0xac6d('0x16')]['on'](a18_0xac6d('0x19'),this[a18_0xac6d('0x1a')][a18_0xac6d('0x18')](this));process['on'](a18_0xac6d('0x1b'),this[a18_0xac6d('0x1c')][a18_0xac6d('0x18')](this));process['on']('SIGINT',this[a18_0xac6d('0x1c')][a18_0xac6d('0x18')](this));process['on'](a18_0xac6d('0x1d'),this['handleAppExit']['bind'](this));}[a18_0xac6d('0x17')](){console[a18_0xac6d('0x10')](a18_0xac6d('0x1e')+this['clientId']);this[a18_0xac6d('0x16')][a18_0xac6d('0x1f')]('player/open');this[a18_0xac6d('0x16')]['subscribe'](a18_0xac6d('0x20'));this[a18_0xac6d('0x16')][a18_0xac6d('0x1f')]('player/reboot',{'qos':0x2});this['mqttClient'][a18_0xac6d('0x1f')](a18_0xac6d('0x21'),{'qos':0x2});this[a18_0xac6d('0x16')][a18_0xac6d('0x1f')](a18_0xac6d('0x22'),{'qos':0x2});this[a18_0xac6d('0x16')][a18_0xac6d('0x1f')](a18_0xac6d('0x23'),{'qos':0x2});this[a18_0xac6d('0x16')][a18_0xac6d('0x1f')]('player/ifconfig',{'qos':0x2});this['mqttClient']['subscribe'](a18_0xac6d('0x24'),{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x20cc65,_0x437332){console[a18_0xac6d('0x10')]('received\x20message\x20%s\x20%s',_0x20cc65,_0x437332);switch(_0x20cc65){case a18_0xac6d('0x25'):return this['handleOpenRequest'](_0x437332);case'player/close':return this[a18_0xac6d('0x26')](_0x437332);case a18_0xac6d('0x27'):return this[a18_0xac6d('0x28')](_0x437332);case a18_0xac6d('0x22'):return this[a18_0xac6d('0x29')](_0x437332);case a18_0xac6d('0x21'):return this[a18_0xac6d('0x2a')](_0x437332);case a18_0xac6d('0x23'):return this[a18_0xac6d('0x2b')](_0x437332);case a18_0xac6d('0x2c'):return this[a18_0xac6d('0x2d')](_0x437332);case'player/register':return this[a18_0xac6d('0x2e')](_0x437332);}}[a18_0xac6d('0x2e')](_0x1f83fe){if(_0x1f83fe==a18_0xac6d('0x2f')||_0x1f83fe==String(this[a18_0xac6d('0xa')][a18_0xac6d('0x30')])){this[a18_0xac6d('0xa')]['registerClient']();}}['handleIfconfigRequest'](_0x399286){if(_0x399286==a18_0xac6d('0x2f')||_0x399286==String(this[a18_0xac6d('0xa')]['playerId'])){}}[a18_0xac6d('0x2b')](_0x418439){console[a18_0xac6d('0x10')](a18_0xac6d('0x31')+_0x418439);if(_0x418439==a18_0xac6d('0x2f')||_0x418439==String(this['syncPlaylistsService'][a18_0xac6d('0x30')])){const _0xf21389=__dirname;const _0x43219c=require('simple-git')(_0xf21389);console[a18_0xac6d('0x10')](a18_0xac6d('0x32'));_0x43219c[a18_0xac6d('0x33')]((_0x250779,_0x5ba74c)=>{if(_0x250779){console['log'](a18_0xac6d('0x34'));this[a18_0xac6d('0x2b')](_0x418439);return;}else{}console[a18_0xac6d('0x10')]('Git\x20updated');console[a18_0xac6d('0x10')](_0x5ba74c);if(_0x5ba74c&&_0x5ba74c[a18_0xac6d('0x35')][a18_0xac6d('0x36')]){const _0x340f4d=spawn('shutdown',['-r',a18_0xac6d('0x37')]);}else{}});}}['handleLoadPlaylistRequest'](_0x13a384){if(_0x13a384==a18_0xac6d('0x2f')||_0x13a384==String(this[a18_0xac6d('0xa')][a18_0xac6d('0x30')])){this['syncPlaylistsService'][a18_0xac6d('0x38')]();}}[a18_0xac6d('0x29')](_0x1c4c65){if(String(_0x1c4c65)==a18_0xac6d('0x2f')||String(_0x1c4c65)==String(this[a18_0xac6d('0xa')]['playerId'])){this[a18_0xac6d('0xa')][a18_0xac6d('0x39')]();}}['handleRebootRequest'](_0x3e429b){if(_0x3e429b==a18_0xac6d('0x2f')||_0x3e429b==String(this[a18_0xac6d('0xa')]['playerId'])){const _0x1ae1df=spawn('shutdown',['-r',a18_0xac6d('0x37')]);}}[a18_0xac6d('0x3a')](){console['log'](a18_0xac6d('0x3b'),this['state']);this[a18_0xac6d('0x16')][a18_0xac6d('0x3c')](a18_0xac6d('0x3d'),this['syncPlaylistsService'][a18_0xac6d('0x30')]+'-'+this[a18_0xac6d('0x3e')]);}[a18_0xac6d('0x3f')](_0x212dcd){if(this[a18_0xac6d('0x3e')]!==a18_0xac6d('0x40')&&this[a18_0xac6d('0x3e')]!==a18_0xac6d('0x41')){console['log'](a18_0xac6d('0x42'));this[a18_0xac6d('0x3e')]=a18_0xac6d('0x41');this[a18_0xac6d('0x3a')]();setTimeout(()=>{this[a18_0xac6d('0x3e')]=a18_0xac6d('0x40');this[a18_0xac6d('0x3a')]();},0x1388);}}['handleCloseRequest'](_0x2661aa){if(this[a18_0xac6d('0x3e')]!==a18_0xac6d('0xb')&&this[a18_0xac6d('0x3e')]!=='closing'){this[a18_0xac6d('0x3e')]=a18_0xac6d('0x43');this[a18_0xac6d('0x3a')]();setTimeout(()=>{this['state']=a18_0xac6d('0xb');this[a18_0xac6d('0x3a')]();},0x1388);}}[a18_0xac6d('0x1c')](_0x5427e8,_0x1e5091){if(_0x1e5091){console[a18_0xac6d('0x10')](_0x1e5091[a18_0xac6d('0x44')]);}this[a18_0xac6d('0x16')][a18_0xac6d('0x3c')]('player/connected','false');}}exports['MqttService']=MqttService;