var a20_0x4606=['syncPlaylistsService','state','httpClientService','HttpClientService','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','createJwt','TLSv1_2_method','round','connect','subscribe','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish\x20result:','error','message','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','toString','ascii','packetsend','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','close','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','player/update_settings','handleUpdateSettingsRequest','player/turn_off_tv','handleTurnOffTVRequest','handleTurnOnTVRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','sendStateUpdate','publish','player/state','open','opening','opening\x20player\x20door','closed','closing','stack','player/connected','false','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken'];(function(_0x172ba0,_0x47a250){var _0x18c49a=function(_0x5111d9){while(--_0x5111d9){_0x172ba0['push'](_0x172ba0['shift']());}};_0x18c49a(++_0x47a250);}(a20_0x4606,0x1cb));var a20_0x2c69=function(_0x23b760,_0x1ab96f){_0x23b760=_0x23b760-0x0;var _0x576205=a20_0x4606[_0x23b760];return _0x576205;};'use strict';Object[a20_0x2c69('0x0')](exports,a20_0x2c69('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x2c69('0x2'));const fs=require('fs');const fsExtra=require(a20_0x2c69('0x3'));const request=require(a20_0x2c69('0x4'));const progress=require(a20_0x2c69('0x5'));const spawn=require(a20_0x2c69('0x6'))['spawn'];const exec=require(a20_0x2c69('0x6'))[a20_0x2c69('0x7')];const isImage=require(a20_0x2c69('0x8'));const format=require(a20_0x2c69('0x9'));const os=require('os');const mqtt=require(a20_0x2c69('0xa'));const uuidv4=require(a20_0x2c69('0xb'));const jwt=require(a20_0x2c69('0xc'));class MqttService{constructor(_0x7512d3){this[a20_0x2c69('0xd')]=_0x7512d3;this[a20_0x2c69('0xe')]='closed';this[a20_0x2c69('0xf')]=new HttpClientService_1[(a20_0x2c69('0x10'))]();}['init'](){this[a20_0x2c69('0x11')]();}['mqttInit_google'](){console[a20_0x2c69('0x12')](a20_0x2c69('0x13'));const _0x21f2bb=a20_0x2c69('0x14');const _0x536e34=a20_0x2c69('0x15');const _0x156a6f=a20_0x2c69('0x16');const _0x5d5975=a20_0x2c69('0x17');const _0x2b5a02=a20_0x2c69('0x18');const _0x3adbf9='resources/keys/rsa_private.pem';const _0x425a31=a20_0x2c69('0x19');const _0x50480a=0x1bb;const _0x4b358e=a20_0x2c69('0x1a');const _0x2b750f=0x5;const _0x36cf27=a20_0x2c69('0x1b')+_0x21f2bb+a20_0x2c69('0x1c')+_0x5d5975+a20_0x2c69('0x1d')+_0x156a6f+a20_0x2c69('0x1e')+_0x536e34;const _0x20efd8={'host':_0x425a31,'port':_0x50480a,'clientId':_0x36cf27,'username':'unused','password':this[a20_0x2c69('0x1f')](_0x21f2bb,_0x3adbf9,_0x2b5a02),'protocol':'mqtts','secureProtocol':a20_0x2c69('0x20')};const _0x312cf9=Math[a20_0x2c69('0x21')](Date['now']()/0x3e8);const _0x2d59b8=mqtt[a20_0x2c69('0x22')](_0x20efd8);_0x2d59b8['subscribe'](a20_0x2c69('0x1e')+_0x536e34+'/config',{'qos':0x1});_0x2d59b8['subscribe']('/devices/'+_0x536e34+'/state',{'qos':0x1});_0x2d59b8[a20_0x2c69('0x23')]('/devices/'+_0x536e34+a20_0x2c69('0x24'),{'qos':0x0});const _0xe42736=a20_0x2c69('0x1e')+_0x536e34+'/'+_0x4b358e;_0x2d59b8['on'](a20_0x2c69('0x22'),_0x2816a3=>{console[a20_0x2c69('0x12')](a20_0x2c69('0x22'));if(!_0x2816a3){console[a20_0x2c69('0x12')](a20_0x2c69('0x25'));}else{const _0xe42736=a20_0x2c69('0x26');const _0x56d3b4=_0x156a6f+'/'+_0x536e34+a20_0x2c69('0x27');_0x2d59b8['publish'](_0xe42736,_0x56d3b4,{'qos':0x1},_0x3db270=>{console[a20_0x2c69('0x12')](a20_0x2c69('0x28'));console[a20_0x2c69('0x12')](_0x3db270);if(!_0x3db270){}});}});_0x2d59b8['on']('close',()=>{console[a20_0x2c69('0x12')]('close');});_0x2d59b8['on'](a20_0x2c69('0x29'),_0x313787=>{console[a20_0x2c69('0x12')](a20_0x2c69('0x29'),_0x313787);});_0x2d59b8['on'](a20_0x2c69('0x2a'),(_0x33b4af,_0x3b96e2)=>{let _0x41516e='Message\x20received:\x20';console[a20_0x2c69('0x12')](_0x33b4af);console[a20_0x2c69('0x12')](_0x3b96e2+'');if(_0x33b4af===a20_0x2c69('0x1e')+_0x536e34+'/config'){_0x41516e=a20_0x2c69('0x2b');}else if(_0x33b4af[a20_0x2c69('0x2c')](a20_0x2c69('0x1e')+_0x536e34+a20_0x2c69('0x2d'))){_0x41516e=a20_0x2c69('0x2e');}_0x41516e+=Buffer['from'](_0x3b96e2,'base64')[a20_0x2c69('0x2f')](a20_0x2c69('0x30'));console[a20_0x2c69('0x12')](_0x41516e);});_0x2d59b8['on'](a20_0x2c69('0x31'),()=>{});console[a20_0x2c69('0x12')](_0x20efd8);}[a20_0x2c69('0x11')](){console[a20_0x2c69('0x12')]('mqttInit');this[a20_0x2c69('0x32')]=uuidv4();console['log']('this.clientId');console[a20_0x2c69('0x12')](this[a20_0x2c69('0x32')]);const _0x1b168a={'clientId':this[a20_0x2c69('0x32')],'username':'lulo_mqtt','password':a20_0x2c69('0x33'),'clean':!![]};this[a20_0x2c69('0x34')]=mqtt[a20_0x2c69('0x22')](a20_0x2c69('0x35'),_0x1b168a);this[a20_0x2c69('0x34')]['on']('connect',this[a20_0x2c69('0x36')][a20_0x2c69('0x37')](this));this['mqttClient']['on'](a20_0x2c69('0x2a'),this[a20_0x2c69('0x38')][a20_0x2c69('0x37')](this));this['mqttClient']['on']('close',()=>{console['log'](a20_0x2c69('0x39'));});process['on'](a20_0x2c69('0x3a'),this[a20_0x2c69('0x3b')]['bind'](this));process['on'](a20_0x2c69('0x3c'),this['handleAppExit']['bind'](this));process['on'](a20_0x2c69('0x3d'),this['handleAppExit'][a20_0x2c69('0x37')](this));}[a20_0x2c69('0x36')](){console['log'](a20_0x2c69('0x3e')+this[a20_0x2c69('0x32')]);this[a20_0x2c69('0x34')][a20_0x2c69('0x23')]('player/open');this[a20_0x2c69('0x34')][a20_0x2c69('0x23')](a20_0x2c69('0x3f'));this[a20_0x2c69('0x34')][a20_0x2c69('0x23')](a20_0x2c69('0x40'),{'qos':0x2});this[a20_0x2c69('0x34')][a20_0x2c69('0x23')](a20_0x2c69('0x41'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x2c69('0x42'),{'qos':0x2});this[a20_0x2c69('0x34')][a20_0x2c69('0x23')]('player/update',{'qos':0x2});this[a20_0x2c69('0x34')][a20_0x2c69('0x23')](a20_0x2c69('0x43'),{'qos':0x2});this[a20_0x2c69('0x34')]['subscribe'](a20_0x2c69('0x44'),{'qos':0x2});this[a20_0x2c69('0x34')]['subscribe']('player/update_settings',{'qos':0x2});this['mqttClient'][a20_0x2c69('0x23')]('player/turn_off_tv',{'qos':0x2});this[a20_0x2c69('0x34')]['subscribe']('player/turn_on_tv',{'qos':0x2});}['reportStatus'](){}[a20_0x2c69('0x38')](_0xb02624,_0x544855){console['log'](a20_0x2c69('0x45'),_0xb02624,_0x544855);switch(_0xb02624){case a20_0x2c69('0x46'):return this[a20_0x2c69('0x47')](_0x544855);case a20_0x2c69('0x3f'):return this[a20_0x2c69('0x48')](_0x544855);case a20_0x2c69('0x40'):return this[a20_0x2c69('0x49')](_0x544855);case a20_0x2c69('0x42'):return this[a20_0x2c69('0x4a')](_0x544855);case a20_0x2c69('0x41'):return this[a20_0x2c69('0x4b')](_0x544855);case a20_0x2c69('0x4c'):return this[a20_0x2c69('0x4d')](_0x544855);case a20_0x2c69('0x43'):return this[a20_0x2c69('0x4e')](_0x544855);case a20_0x2c69('0x44'):return this['handleRegisterRequest'](_0x544855);case a20_0x2c69('0x4f'):return this[a20_0x2c69('0x50')](_0x544855);case a20_0x2c69('0x51'):return this[a20_0x2c69('0x52')](_0x544855);case'player/turn_on_tv':return this[a20_0x2c69('0x53')](_0x544855);}}[a20_0x2c69('0x54')](_0x5223ed){if(_0x5223ed==a20_0x2c69('0x55')||_0x5223ed==String(this[a20_0x2c69('0xd')][a20_0x2c69('0x56')])){this[a20_0x2c69('0xd')][a20_0x2c69('0x57')]();}}[a20_0x2c69('0x4e')](_0x16577a){if(_0x16577a=='all'||_0x16577a==String(this['syncPlaylistsService'][a20_0x2c69('0x56')])){}}['handleUpdateRequest'](_0x315f38){console[a20_0x2c69('0x12')](a20_0x2c69('0x58')+_0x315f38);if(_0x315f38=='all'||_0x315f38==String(this[a20_0x2c69('0xd')]['playerId'])){const _0x1e6f13=__dirname;const _0x5ec30a=require(a20_0x2c69('0x59'))(_0x1e6f13);console['log']('Git\x20updating');_0x5ec30a[a20_0x2c69('0x5a')]((_0x39fa32,_0x3e42db)=>{if(_0x39fa32){console[a20_0x2c69('0x12')](a20_0x2c69('0x5b'));this[a20_0x2c69('0x4d')](_0x315f38);return;}else{}console[a20_0x2c69('0x12')]('Git\x20updated');console[a20_0x2c69('0x12')](_0x3e42db);if(_0x3e42db&&_0x3e42db[a20_0x2c69('0x5c')][a20_0x2c69('0x5d')]){this[a20_0x2c69('0xd')][a20_0x2c69('0x5e')]();}else{}});}}[a20_0x2c69('0x4b')](_0x331aea){if(_0x331aea==a20_0x2c69('0x55')||_0x331aea==String(this[a20_0x2c69('0xd')][a20_0x2c69('0x56')])){this[a20_0x2c69('0xd')][a20_0x2c69('0x5f')]();}}['handleReloadPlaylistRequest'](_0x5d8760){if(String(_0x5d8760)==a20_0x2c69('0x55')||String(_0x5d8760)==String(this[a20_0x2c69('0xd')][a20_0x2c69('0x56')])){this['syncPlaylistsService'][a20_0x2c69('0x60')]();}}['handleRebootRequest'](_0x32b623){if(_0x32b623=='all'||_0x32b623==String(this['syncPlaylistsService'][a20_0x2c69('0x56')])){console[a20_0x2c69('0x12')](a20_0x2c69('0x61'));try{this[a20_0x2c69('0xd')]['reboot']();}catch(_0x13085f){console[a20_0x2c69('0x12')](_0x13085f);}}}[a20_0x2c69('0x50')](_0x289429){if(_0x289429=='all'||_0x289429==String(this[a20_0x2c69('0xd')][a20_0x2c69('0x56')])){console[a20_0x2c69('0x12')](a20_0x2c69('0x62'));try{this[a20_0x2c69('0xd')][a20_0x2c69('0x63')]();}catch(_0x3160e){console[a20_0x2c69('0x12')](_0x3160e);}}}[a20_0x2c69('0x53')](_0x168937){if(_0x168937==a20_0x2c69('0x55')||_0x168937==String(this['syncPlaylistsService']['playerId'])){console[a20_0x2c69('0x12')](a20_0x2c69('0x64'));try{this[a20_0x2c69('0xd')][a20_0x2c69('0x65')]();}catch(_0x10cbe5){console[a20_0x2c69('0x12')](_0x10cbe5);}}}[a20_0x2c69('0x52')](_0x30dee3){if(_0x30dee3=='all'||_0x30dee3==String(this['syncPlaylistsService'][a20_0x2c69('0x56')])){console[a20_0x2c69('0x12')](a20_0x2c69('0x66'));try{this[a20_0x2c69('0xd')]['turnOffTV']();}catch(_0x3252f9){console[a20_0x2c69('0x12')](_0x3252f9);}}}[a20_0x2c69('0x67')](){console[a20_0x2c69('0x12')]('sending\x20state\x20%s',this['state']);this[a20_0x2c69('0x34')][a20_0x2c69('0x68')](a20_0x2c69('0x69'),this[a20_0x2c69('0xd')][a20_0x2c69('0x56')]+'-'+this['state']);}['handleOpenRequest'](_0x57d5ee){if(this[a20_0x2c69('0xe')]!==a20_0x2c69('0x6a')&&this[a20_0x2c69('0xe')]!==a20_0x2c69('0x6b')){console[a20_0x2c69('0x12')](a20_0x2c69('0x6c'));this[a20_0x2c69('0xe')]=a20_0x2c69('0x6b');this[a20_0x2c69('0x67')]();setTimeout(()=>{this[a20_0x2c69('0xe')]='open';this[a20_0x2c69('0x67')]();},0x1388);}}['handleCloseRequest'](_0x5d779d){if(this['state']!==a20_0x2c69('0x6d')&&this[a20_0x2c69('0xe')]!==a20_0x2c69('0x6e')){this[a20_0x2c69('0xe')]=a20_0x2c69('0x6e');this['sendStateUpdate']();setTimeout(()=>{this['state']=a20_0x2c69('0x6d');this[a20_0x2c69('0x67')]();},0x1388);}}[a20_0x2c69('0x3b')](_0xe72ceb,_0x3a1d8f){if(_0x3a1d8f){console['log'](_0x3a1d8f[a20_0x2c69('0x6f')]);}this[a20_0x2c69('0x34')]['publish'](a20_0x2c69('0x70'),a20_0x2c69('0x71'));}[a20_0x2c69('0x1f')](_0x2070f8,_0x4282b6,_0x11ea1d){const _0x2feb20={'iat':Math[a20_0x2c69('0x21')](Date[a20_0x2c69('0x72')]()/0x3e8),'exp':Math[a20_0x2c69('0x21')](Date[a20_0x2c69('0x72')]()/0x3e8)+0x14*0x3c,'aud':_0x2070f8};const _0x3b6d4d=fs[a20_0x2c69('0x73')](_0x4282b6);return jwt[a20_0x2c69('0x74')](_0x2feb20,_0x3b6d4d,{'algorithm':_0x11ea1d});}}exports[a20_0x2c69('0x75')]=MqttService;