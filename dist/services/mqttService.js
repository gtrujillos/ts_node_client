var a20_0x1b06=['player/update_settings','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest','handleTurnOnTVRequest:\x20','turnOffTV','sendStateUpdate','publish','player/state','open','opening','handleCloseRequest','stack','player/connected','false','round','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','init','mqttInit_mosquitto','mqttInit_google','log','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','projects/','/locations/','/registries/','/devices/','mqtts','now','connect','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','/commands','base64','toString','ascii','packetsend','mqttInit','clientId','this.clientId','mqttClient','mqtt://lulo.run','message','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register'];(function(_0x485be8,_0x3fea56){var _0x52c93e=function(_0x3823bb){while(--_0x3823bb){_0x485be8['push'](_0x485be8['shift']());}};_0x52c93e(++_0x3fea56);}(a20_0x1b06,0x98));var a20_0x3eb0=function(_0x47f1ed,_0x214413){_0x47f1ed=_0x47f1ed-0x0;var _0x1d20f0=a20_0x1b06[_0x47f1ed];return _0x1d20f0;};'use strict';Object[a20_0x3eb0('0x0')](exports,a20_0x3eb0('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x3eb0('0x2'));const fs=require('fs');const fsExtra=require(a20_0x3eb0('0x3'));const request=require(a20_0x3eb0('0x4'));const progress=require('request-progress');const spawn=require(a20_0x3eb0('0x5'))[a20_0x3eb0('0x6')];const exec=require(a20_0x3eb0('0x5'))[a20_0x3eb0('0x7')];const isImage=require(a20_0x3eb0('0x8'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a20_0x3eb0('0x9'));const jwt=require(a20_0x3eb0('0xa'));class MqttService{constructor(_0x19ede4){this[a20_0x3eb0('0xb')]=_0x19ede4;this[a20_0x3eb0('0xc')]=a20_0x3eb0('0xd');this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a20_0x3eb0('0xe')](){this[a20_0x3eb0('0xf')]();}[a20_0x3eb0('0x10')](){console[a20_0x3eb0('0x11')]('mqttInit');const _0x41d237='velvety-glazing-252020';const _0x29c1f8=a20_0x3eb0('0x12');const _0x461f01=a20_0x3eb0('0x13');const _0x377c2e=a20_0x3eb0('0x14');const _0x2ed56b=a20_0x3eb0('0x15');const _0x3f145c=a20_0x3eb0('0x16');const _0x36e3b5=a20_0x3eb0('0x17');const _0x29c8d8=0x1bb;const _0x46abbb='events';const _0x2bbad5=0x5;const _0x12ebef=a20_0x3eb0('0x18')+_0x41d237+a20_0x3eb0('0x19')+_0x377c2e+a20_0x3eb0('0x1a')+_0x461f01+a20_0x3eb0('0x1b')+_0x29c1f8;const _0xe3fa1f={'host':_0x36e3b5,'port':_0x29c8d8,'clientId':_0x12ebef,'username':'unused','password':this['createJwt'](_0x41d237,_0x3f145c,_0x2ed56b),'protocol':a20_0x3eb0('0x1c'),'secureProtocol':'TLSv1_2_method'};const _0x2d7d66=Math['round'](Date[a20_0x3eb0('0x1d')]()/0x3e8);const _0x231dd0=mqtt[a20_0x3eb0('0x1e')](_0xe3fa1f);_0x231dd0[a20_0x3eb0('0x1f')](a20_0x3eb0('0x1b')+_0x29c1f8+'/config',{'qos':0x1});_0x231dd0[a20_0x3eb0('0x1f')](a20_0x3eb0('0x1b')+_0x29c1f8+a20_0x3eb0('0x20'),{'qos':0x1});_0x231dd0[a20_0x3eb0('0x1f')](a20_0x3eb0('0x1b')+_0x29c1f8+a20_0x3eb0('0x21'),{'qos':0x0});const _0x360ea3=a20_0x3eb0('0x1b')+_0x29c1f8+'/'+_0x46abbb;_0x231dd0['on']('connect',_0x59a8f6=>{console[a20_0x3eb0('0x11')](a20_0x3eb0('0x1e'));if(!_0x59a8f6){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x22'));}else{const _0x360ea3=a20_0x3eb0('0x23');const _0x2473b0=_0x461f01+'/'+_0x29c1f8+'-payload-0';_0x231dd0['publish'](_0x360ea3,_0x2473b0,{'qos':0x1},_0x10cbd1=>{console['log']('publish\x20result:');console['log'](_0x10cbd1);if(!_0x10cbd1){}});}});_0x231dd0['on'](a20_0x3eb0('0x24'),()=>{console[a20_0x3eb0('0x11')]('close');});_0x231dd0['on']('error',_0x5d6f6d=>{console[a20_0x3eb0('0x11')](a20_0x3eb0('0x25'),_0x5d6f6d);});_0x231dd0['on']('message',(_0x4cf307,_0x7dc13f)=>{let _0x4f065b=a20_0x3eb0('0x26');console['log'](_0x4cf307);console[a20_0x3eb0('0x11')](_0x7dc13f+'');if(_0x4cf307==='/devices/'+_0x29c1f8+a20_0x3eb0('0x27')){_0x4f065b=a20_0x3eb0('0x28');}else if(_0x4cf307['startsWith'](a20_0x3eb0('0x1b')+_0x29c1f8+a20_0x3eb0('0x29'))){_0x4f065b='Command\x20message\x20received:\x20';}_0x4f065b+=Buffer['from'](_0x7dc13f,a20_0x3eb0('0x2a'))[a20_0x3eb0('0x2b')](a20_0x3eb0('0x2c'));console[a20_0x3eb0('0x11')](_0x4f065b);});_0x231dd0['on'](a20_0x3eb0('0x2d'),()=>{});console['log'](_0xe3fa1f);}[a20_0x3eb0('0xf')](){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x2e'));this[a20_0x3eb0('0x2f')]=uuidv4();console[a20_0x3eb0('0x11')](a20_0x3eb0('0x30'));console['log'](this['clientId']);const _0x3f7b3a={'clientId':this[a20_0x3eb0('0x2f')],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this[a20_0x3eb0('0x31')]=mqtt[a20_0x3eb0('0x1e')](a20_0x3eb0('0x32'),_0x3f7b3a);this[a20_0x3eb0('0x31')]['on']('connect',this['mqttClient_connect']['bind'](this));this['mqttClient']['on'](a20_0x3eb0('0x33'),this[a20_0x3eb0('0x34')]['bind'](this));this['mqttClient']['on'](a20_0x3eb0('0x24'),()=>{console[a20_0x3eb0('0x11')](a20_0x3eb0('0x24'));});process['on'](a20_0x3eb0('0x35'),this[a20_0x3eb0('0x36')]['bind'](this));process['on'](a20_0x3eb0('0x37'),this['handleAppExit']['bind'](this));process['on']('uncaughtException',this[a20_0x3eb0('0x36')]['bind'](this));}['mqttClient_connect'](){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x38')+this['clientId']);this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x39'));this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x3a'));this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x3b'),{'qos':0x2});this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x3c'),{'qos':0x2});this[a20_0x3eb0('0x31')]['subscribe'](a20_0x3eb0('0x3d'),{'qos':0x2});this[a20_0x3eb0('0x31')]['subscribe']('player/update',{'qos':0x2});this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x3e'),{'qos':0x2});this[a20_0x3eb0('0x31')]['subscribe'](a20_0x3eb0('0x3f'),{'qos':0x2});this[a20_0x3eb0('0x31')][a20_0x3eb0('0x1f')](a20_0x3eb0('0x40'),{'qos':0x2});this[a20_0x3eb0('0x31')]['subscribe']('player/turn_off_tv',{'qos':0x2});this[a20_0x3eb0('0x31')]['subscribe'](a20_0x3eb0('0x41'),{'qos':0x2});}[a20_0x3eb0('0x42')](){}['mqttClient_message'](_0xebc339,_0x54b834){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x43'),_0xebc339,_0x54b834);switch(_0xebc339){case a20_0x3eb0('0x39'):return this[a20_0x3eb0('0x44')](_0x54b834);case a20_0x3eb0('0x3a'):return this['handleCloseRequest'](_0x54b834);case'player/reboot':return this['handleRebootRequest'](_0x54b834);case a20_0x3eb0('0x3d'):return this[a20_0x3eb0('0x45')](_0x54b834);case'player/load_playlist':return this[a20_0x3eb0('0x46')](_0x54b834);case a20_0x3eb0('0x47'):return this['handleUpdateRequest'](_0x54b834);case'player/ifconfig':return this[a20_0x3eb0('0x48')](_0x54b834);case a20_0x3eb0('0x3f'):return this[a20_0x3eb0('0x49')](_0x54b834);case'player/update_settings':return this[a20_0x3eb0('0x4a')](_0x54b834);case'player/turn_off_tv':return this[a20_0x3eb0('0x4b')](_0x54b834);case a20_0x3eb0('0x41'):return this['handleTurnOnTVRequest'](_0x54b834);}}[a20_0x3eb0('0x49')](_0x411e64){if(_0x411e64==a20_0x3eb0('0x4c')||_0x411e64==String(this['syncPlaylistsService'][a20_0x3eb0('0x4d')])){this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4e')]();}}[a20_0x3eb0('0x48')](_0xc7c384){if(_0xc7c384==a20_0x3eb0('0x4c')||_0xc7c384==String(this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4d')])){}}[a20_0x3eb0('0x4f')](_0x174843){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x50')+_0x174843);if(_0x174843==a20_0x3eb0('0x4c')||_0x174843==String(this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4d')])){const _0x4c6063=__dirname;const _0x2c831d=require(a20_0x3eb0('0x51'))(_0x4c6063);console[a20_0x3eb0('0x11')](a20_0x3eb0('0x52'));_0x2c831d[a20_0x3eb0('0x53')]((_0x1081e8,_0xce1252)=>{if(_0x1081e8){console[a20_0x3eb0('0x11')]('Error\x20git\x20updated');this['handleUpdateRequest'](_0x174843);return;}else{}console[a20_0x3eb0('0x11')](a20_0x3eb0('0x54'));console[a20_0x3eb0('0x11')](_0xce1252);if(_0xce1252&&_0xce1252[a20_0x3eb0('0x55')][a20_0x3eb0('0x56')]){this[a20_0x3eb0('0xb')]['reboot']();}else{}});}}[a20_0x3eb0('0x46')](_0x149e65){if(_0x149e65=='all'||_0x149e65==String(this[a20_0x3eb0('0xb')]['playerId'])){this[a20_0x3eb0('0xb')][a20_0x3eb0('0x57')]();}}['handleReloadPlaylistRequest'](_0x18353c){if(String(_0x18353c)==a20_0x3eb0('0x4c')||String(_0x18353c)==String(this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4d')])){this['syncPlaylistsService'][a20_0x3eb0('0x58')]();}}[a20_0x3eb0('0x59')](_0x47b1da){if(_0x47b1da==a20_0x3eb0('0x4c')||_0x47b1da==String(this['syncPlaylistsService'][a20_0x3eb0('0x4d')])){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x5a'));try{this[a20_0x3eb0('0xb')][a20_0x3eb0('0x5b')]();}catch(_0x1833ab){console[a20_0x3eb0('0x11')](_0x1833ab);}}}['handleUpdateSettingsRequest'](_0x275066){if(_0x275066=='all'||_0x275066==String(this[a20_0x3eb0('0xb')]['playerId'])){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x5c'));try{this[a20_0x3eb0('0xb')]['updateSettings']();}catch(_0x46aced){console[a20_0x3eb0('0x11')](_0x46aced);}}}[a20_0x3eb0('0x5d')](_0x172bfe){if(_0x172bfe==a20_0x3eb0('0x4c')||_0x172bfe==String(this[a20_0x3eb0('0xb')]['playerId'])){console[a20_0x3eb0('0x11')](a20_0x3eb0('0x5e'));try{this[a20_0x3eb0('0xb')]['turnOnTV']();}catch(_0x33975c){console[a20_0x3eb0('0x11')](_0x33975c);}}}['handleTurnOffTVRequest'](_0x4fbebc){if(_0x4fbebc==a20_0x3eb0('0x4c')||_0x4fbebc==String(this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4d')])){console[a20_0x3eb0('0x11')]('handleTurnOffTVRequest:\x20');try{this[a20_0x3eb0('0xb')][a20_0x3eb0('0x5f')]();}catch(_0x4e19ea){console['log'](_0x4e19ea);}}}[a20_0x3eb0('0x60')](){console[a20_0x3eb0('0x11')]('sending\x20state\x20%s',this[a20_0x3eb0('0xc')]);this[a20_0x3eb0('0x31')][a20_0x3eb0('0x61')](a20_0x3eb0('0x62'),this[a20_0x3eb0('0xb')][a20_0x3eb0('0x4d')]+'-'+this[a20_0x3eb0('0xc')]);}[a20_0x3eb0('0x44')](_0xcf408){if(this[a20_0x3eb0('0xc')]!==a20_0x3eb0('0x63')&&this['state']!==a20_0x3eb0('0x64')){console['log']('opening\x20player\x20door');this['state']=a20_0x3eb0('0x64');this[a20_0x3eb0('0x60')]();setTimeout(()=>{this[a20_0x3eb0('0xc')]=a20_0x3eb0('0x63');this[a20_0x3eb0('0x60')]();},0x1388);}}[a20_0x3eb0('0x65')](_0x268f59){if(this[a20_0x3eb0('0xc')]!=='closed'&&this[a20_0x3eb0('0xc')]!=='closing'){this[a20_0x3eb0('0xc')]='closing';this['sendStateUpdate']();setTimeout(()=>{this['state']=a20_0x3eb0('0xd');this[a20_0x3eb0('0x60')]();},0x1388);}}['handleAppExit'](_0x4b3c79,_0x5a190d){if(_0x5a190d){console['log'](_0x5a190d[a20_0x3eb0('0x66')]);}this[a20_0x3eb0('0x31')][a20_0x3eb0('0x61')](a20_0x3eb0('0x67'),a20_0x3eb0('0x68'));}['createJwt'](_0x396223,_0x1854e9,_0x12ebec){const _0x3377e5={'iat':Math[a20_0x3eb0('0x69')](Date['now']()/0x3e8),'exp':Math[a20_0x3eb0('0x69')](Date[a20_0x3eb0('0x1d')]()/0x3e8)+0x14*0x3c,'aud':_0x396223};const _0x35a0c9=fs[a20_0x3eb0('0x6a')](_0x1854e9);return jwt[a20_0x3eb0('0x6b')](_0x3377e5,_0x35a0c9,{'algorithm':_0x12ebec});}}exports['MqttService']=MqttService;