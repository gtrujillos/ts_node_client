var a20_0x7e96=['player/open','player/reload_playlist','player/update','player/ifconfig','player/register','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleCloseRequest','player/reboot','handleRebootRequest','player/load_playlist','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','reboot','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','handleOpenRequest','opening\x20player\x20door','closing','stack','player/connected','false','now','readFileSync','sign','MqttService','defineProperty','__esModule','fs-extra','spawn','child_process','exec','is-image','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','init','mqttInit_google','log','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','events','/locations/','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','round','/config','subscribe','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','mqttInit_mosquitto','mqttInit','clientId','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','exit','handleAppExit','SIGINT'];(function(_0x13f615,_0x302d88){var _0x2003c2=function(_0xe569e2){while(--_0xe569e2){_0x13f615['push'](_0x13f615['shift']());}};_0x2003c2(++_0x302d88);}(a20_0x7e96,0x110));var a20_0xb24a=function(_0x31fb93,_0x7ef7e3){_0x31fb93=_0x31fb93-0x0;var _0x22d68f=a20_0x7e96[_0x31fb93];return _0x22d68f;};'use strict';Object[a20_0xb24a('0x0')](exports,a20_0xb24a('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a20_0xb24a('0x2'));const request=require('request');const progress=require('request-progress');const spawn=require('child_process')[a20_0xb24a('0x3')];const exec=require(a20_0xb24a('0x4'))[a20_0xb24a('0x5')];const isImage=require(a20_0xb24a('0x6'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');const jwt=require(a20_0xb24a('0x7'));class MqttService{constructor(_0x50a798){this[a20_0xb24a('0x8')]=_0x50a798;this[a20_0xb24a('0x9')]=a20_0xb24a('0xa');this['httpClientService']=new HttpClientService_1[(a20_0xb24a('0xb'))]();}[a20_0xb24a('0xc')](){this['mqttInit_mosquitto']();}[a20_0xb24a('0xd')](){console[a20_0xb24a('0xe')]('mqttInit');const _0x5d89b6=a20_0xb24a('0xf');const _0x4f2c61=a20_0xb24a('0x10');const _0x3b4deb=a20_0xb24a('0x11');const _0x2aef03='us-central1';const _0x5380c5=a20_0xb24a('0x12');const _0x57e4ce=a20_0xb24a('0x13');const _0x19f100='mqtt.googleapis.com';const _0x135291=0x1bb;const _0x2c6cd9=a20_0xb24a('0x14');const _0x4d2261=0x5;const _0x1341a9='projects/'+_0x5d89b6+a20_0xb24a('0x15')+_0x2aef03+a20_0xb24a('0x16')+_0x3b4deb+a20_0xb24a('0x17')+_0x4f2c61;const _0x250509={'host':_0x19f100,'port':_0x135291,'clientId':_0x1341a9,'username':'unused','password':this[a20_0xb24a('0x18')](_0x5d89b6,_0x57e4ce,_0x5380c5),'protocol':a20_0xb24a('0x19'),'secureProtocol':a20_0xb24a('0x1a')};const _0x2fea8a=Math[a20_0xb24a('0x1b')](Date['now']()/0x3e8);const _0x2d7a1c=mqtt['connect'](_0x250509);_0x2d7a1c['subscribe'](a20_0xb24a('0x17')+_0x4f2c61+a20_0xb24a('0x1c'),{'qos':0x1});_0x2d7a1c[a20_0xb24a('0x1d')]('/devices/'+_0x4f2c61+'/state',{'qos':0x1});_0x2d7a1c[a20_0xb24a('0x1d')]('/devices/'+_0x4f2c61+a20_0xb24a('0x1e'),{'qos':0x0});const _0x370ae9=a20_0xb24a('0x17')+_0x4f2c61+'/'+_0x2c6cd9;_0x2d7a1c['on']('connect',_0x12d6bf=>{console[a20_0xb24a('0xe')](a20_0xb24a('0x1f'));if(!_0x12d6bf){console[a20_0xb24a('0xe')](a20_0xb24a('0x20'));}else{const _0x370ae9=a20_0xb24a('0x21');const _0x28ba28=_0x3b4deb+'/'+_0x4f2c61+'-payload-0';_0x2d7a1c[a20_0xb24a('0x22')](_0x370ae9,_0x28ba28,{'qos':0x1},_0x13c2c0=>{console['log'](a20_0xb24a('0x23'));console[a20_0xb24a('0xe')](_0x13c2c0);if(!_0x13c2c0){}});}});_0x2d7a1c['on'](a20_0xb24a('0x24'),()=>{console['log']('close');});_0x2d7a1c['on'](a20_0xb24a('0x25'),_0x1e45f5=>{console[a20_0xb24a('0xe')](a20_0xb24a('0x25'),_0x1e45f5);});_0x2d7a1c['on'](a20_0xb24a('0x26'),(_0x83e3f3,_0x457ffc)=>{let _0x2a3462=a20_0xb24a('0x27');console['log'](_0x83e3f3);console['log'](_0x457ffc+'');if(_0x83e3f3==='/devices/'+_0x4f2c61+a20_0xb24a('0x1c')){_0x2a3462=a20_0xb24a('0x28');}else if(_0x83e3f3[a20_0xb24a('0x29')]('/devices/'+_0x4f2c61+a20_0xb24a('0x2a'))){_0x2a3462=a20_0xb24a('0x2b');}_0x2a3462+=Buffer[a20_0xb24a('0x2c')](_0x457ffc,a20_0xb24a('0x2d'))[a20_0xb24a('0x2e')](a20_0xb24a('0x2f'));console[a20_0xb24a('0xe')](_0x2a3462);});_0x2d7a1c['on'](a20_0xb24a('0x30'),()=>{});console[a20_0xb24a('0xe')](_0x250509);}[a20_0xb24a('0x31')](){console['log'](a20_0xb24a('0x32'));this[a20_0xb24a('0x33')]=uuidv4();console['log'](a20_0xb24a('0x34'));console[a20_0xb24a('0xe')](this[a20_0xb24a('0x33')]);const _0x3848ae={'clientId':this[a20_0xb24a('0x33')],'username':'lulo_mqtt','password':a20_0xb24a('0x35'),'clean':!![]};this[a20_0xb24a('0x36')]=mqtt['connect'](a20_0xb24a('0x37'),_0x3848ae);this[a20_0xb24a('0x36')]['on'](a20_0xb24a('0x1f'),this[a20_0xb24a('0x38')]['bind'](this));this['mqttClient']['on'](a20_0xb24a('0x26'),this['mqttClient_message'][a20_0xb24a('0x39')](this));this[a20_0xb24a('0x36')]['on'](a20_0xb24a('0x24'),()=>{console[a20_0xb24a('0xe')](a20_0xb24a('0x24'));});process['on'](a20_0xb24a('0x3a'),this[a20_0xb24a('0x3b')]['bind'](this));process['on'](a20_0xb24a('0x3c'),this[a20_0xb24a('0x3b')][a20_0xb24a('0x39')](this));process['on']('uncaughtException',this[a20_0xb24a('0x3b')][a20_0xb24a('0x39')](this));}[a20_0xb24a('0x38')](){console[a20_0xb24a('0xe')]('Connected\x20to\x20broker\x20client:'+this[a20_0xb24a('0x33')]);this[a20_0xb24a('0x36')]['subscribe'](a20_0xb24a('0x3d'));this['mqttClient']['subscribe']('player/close');this[a20_0xb24a('0x36')]['subscribe']('player/reboot',{'qos':0x2});this['mqttClient']['subscribe']('player/load_playlist',{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')](a20_0xb24a('0x3e'),{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')](a20_0xb24a('0x3f'),{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')](a20_0xb24a('0x40'),{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')](a20_0xb24a('0x41'),{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')]('player/update_settings',{'qos':0x2});this[a20_0xb24a('0x36')][a20_0xb24a('0x1d')](a20_0xb24a('0x42'),{'qos':0x2});this[a20_0xb24a('0x36')]['subscribe'](a20_0xb24a('0x43'),{'qos':0x2});}[a20_0xb24a('0x44')](){}[a20_0xb24a('0x45')](_0x2a3596,_0x2132b1){console[a20_0xb24a('0xe')](a20_0xb24a('0x46'),_0x2a3596,_0x2132b1);switch(_0x2a3596){case a20_0xb24a('0x3d'):return this['handleOpenRequest'](_0x2132b1);case'player/close':return this[a20_0xb24a('0x47')](_0x2132b1);case a20_0xb24a('0x48'):return this[a20_0xb24a('0x49')](_0x2132b1);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x2132b1);case a20_0xb24a('0x4a'):return this['handleLoadPlaylistRequest'](_0x2132b1);case'player/update':return this['handleUpdateRequest'](_0x2132b1);case a20_0xb24a('0x40'):return this[a20_0xb24a('0x4b')](_0x2132b1);case a20_0xb24a('0x41'):return this[a20_0xb24a('0x4c')](_0x2132b1);case'player/update_settings':return this[a20_0xb24a('0x4d')](_0x2132b1);case a20_0xb24a('0x42'):return this['handleTurnOffTVRequest'](_0x2132b1);case'player/turn_on_tv':return this['handleTurnOnTVRequest'](_0x2132b1);}}[a20_0xb24a('0x4c')](_0x3d727f){if(_0x3d727f==a20_0xb24a('0x4e')||_0x3d727f==String(this[a20_0xb24a('0x8')][a20_0xb24a('0x4f')])){this[a20_0xb24a('0x8')][a20_0xb24a('0x50')]();}}[a20_0xb24a('0x4b')](_0x1960ff){if(_0x1960ff==a20_0xb24a('0x4e')||_0x1960ff==String(this[a20_0xb24a('0x8')][a20_0xb24a('0x4f')])){}}[a20_0xb24a('0x51')](_0x5426dd){console[a20_0xb24a('0xe')](a20_0xb24a('0x52')+_0x5426dd);if(_0x5426dd==a20_0xb24a('0x4e')||_0x5426dd==String(this[a20_0xb24a('0x8')][a20_0xb24a('0x4f')])){const _0x4d2739=__dirname;const _0x2ffb27=require(a20_0xb24a('0x53'))(_0x4d2739);console[a20_0xb24a('0xe')](a20_0xb24a('0x54'));_0x2ffb27[a20_0xb24a('0x55')]((_0x4839f4,_0x2822ac)=>{if(_0x4839f4){console[a20_0xb24a('0xe')]('Error\x20git\x20updated');this[a20_0xb24a('0x51')](_0x5426dd);return;}else{}console[a20_0xb24a('0xe')](a20_0xb24a('0x56'));console[a20_0xb24a('0xe')](_0x2822ac);if(_0x2822ac&&_0x2822ac['summary']['changes']){this[a20_0xb24a('0x8')]['reboot']();}else{}});}}[a20_0xb24a('0x57')](_0x1cb74b){if(_0x1cb74b==a20_0xb24a('0x4e')||_0x1cb74b==String(this[a20_0xb24a('0x8')][a20_0xb24a('0x4f')])){this[a20_0xb24a('0x8')][a20_0xb24a('0x58')]();}}['handleReloadPlaylistRequest'](_0x3d1a92){if(String(_0x3d1a92)==a20_0xb24a('0x4e')||String(_0x3d1a92)==String(this[a20_0xb24a('0x8')]['playerId'])){this[a20_0xb24a('0x8')][a20_0xb24a('0x59')]();}}[a20_0xb24a('0x49')](_0x36b3d9){if(_0x36b3d9==a20_0xb24a('0x4e')||_0x36b3d9==String(this[a20_0xb24a('0x8')]['playerId'])){console[a20_0xb24a('0xe')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this['syncPlaylistsService'][a20_0xb24a('0x5a')]();}catch(_0x5450c7){console[a20_0xb24a('0xe')](_0x5450c7);}}}[a20_0xb24a('0x4d')](_0x5b7000){if(_0x5b7000=='all'||_0x5b7000==String(this['syncPlaylistsService'][a20_0xb24a('0x4f')])){console['log'](a20_0xb24a('0x5b'));try{this[a20_0xb24a('0x8')][a20_0xb24a('0x5c')]();}catch(_0x2f7946){console['log'](_0x2f7946);}}}[a20_0xb24a('0x5d')](_0x54503f){if(_0x54503f==a20_0xb24a('0x4e')||_0x54503f==String(this[a20_0xb24a('0x8')]['playerId'])){console[a20_0xb24a('0xe')](a20_0xb24a('0x5e'));try{this['syncPlaylistsService'][a20_0xb24a('0x5f')]();}catch(_0x329011){console['log'](_0x329011);}}}['handleTurnOffTVRequest'](_0x8ff14f){if(_0x8ff14f=='all'||_0x8ff14f==String(this[a20_0xb24a('0x8')][a20_0xb24a('0x4f')])){console[a20_0xb24a('0xe')](a20_0xb24a('0x60'));try{this['syncPlaylistsService'][a20_0xb24a('0x61')]();}catch(_0x227ba4){console[a20_0xb24a('0xe')](_0x227ba4);}}}[a20_0xb24a('0x62')](){console[a20_0xb24a('0xe')](a20_0xb24a('0x63'),this[a20_0xb24a('0x9')]);this['mqttClient'][a20_0xb24a('0x22')](a20_0xb24a('0x64'),this['syncPlaylistsService'][a20_0xb24a('0x4f')]+'-'+this['state']);}[a20_0xb24a('0x65')](_0x1bfbd8){if(this[a20_0xb24a('0x9')]!=='open'&&this['state']!=='opening'){console['log'](a20_0xb24a('0x66'));this['state']='opening';this[a20_0xb24a('0x62')]();setTimeout(()=>{this[a20_0xb24a('0x9')]='open';this['sendStateUpdate']();},0x1388);}}[a20_0xb24a('0x47')](_0xd90ee){if(this['state']!==a20_0xb24a('0xa')&&this[a20_0xb24a('0x9')]!=='closing'){this['state']=a20_0xb24a('0x67');this['sendStateUpdate']();setTimeout(()=>{this[a20_0xb24a('0x9')]=a20_0xb24a('0xa');this[a20_0xb24a('0x62')]();},0x1388);}}[a20_0xb24a('0x3b')](_0x44ec7b,_0x2332ad){if(_0x2332ad){console['log'](_0x2332ad[a20_0xb24a('0x68')]);}this['mqttClient'][a20_0xb24a('0x22')](a20_0xb24a('0x69'),a20_0xb24a('0x6a'));}[a20_0xb24a('0x18')](_0x31d096,_0xb512a2,_0x205da1){const _0x3a4ddc={'iat':Math[a20_0xb24a('0x1b')](Date[a20_0xb24a('0x6b')]()/0x3e8),'exp':Math[a20_0xb24a('0x1b')](Date[a20_0xb24a('0x6b')]()/0x3e8)+0x14*0x3c,'aud':_0x31d096};const _0x3372e9=fs[a20_0xb24a('0x6c')](_0xb512a2);return jwt[a20_0xb24a('0x6d')](_0x3a4ddc,_0x3372e9,{'algorithm':_0x205da1});}}exports[a20_0xb24a('0x6e')]=MqttService;