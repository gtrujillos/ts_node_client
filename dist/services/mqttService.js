var a18_0x1e78=['handleRegisterRequest','all','playerId','simple-git','Git\x20updating','Git\x20updated','summary','loadMediaList','handleReloadPlaylistRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','sendStateUpdate','sending\x20state\x20%s','publish','player/state','opening','open','closing','stack','player/connected','false','createJwt','readFileSync','sign','MqttService','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','exec','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','mqtts','TLSv1_2_method','round','now','connect','subscribe','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','toString','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','message','mqttClient_message','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/update','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reload_playlist','handleUpdateRequest','player/ifconfig','handleIfconfigRequest'];(function(_0x22094d,_0xee02f3){var _0x3b1db3=function(_0x3780d4){while(--_0x3780d4){_0x22094d['push'](_0x22094d['shift']());}};_0x3b1db3(++_0xee02f3);}(a18_0x1e78,0x7e));var a18_0x5f47=function(_0x2272d3,_0x40f21e){_0x2272d3=_0x2272d3-0x0;var _0x2a90d6=a18_0x1e78[_0x2272d3];return _0x2a90d6;};'use strict';Object['defineProperty'](exports,a18_0x5f47('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x5f47('0x1'));const fs=require('fs');const fsExtra=require(a18_0x5f47('0x2'));const request=require(a18_0x5f47('0x3'));const progress=require('request-progress');const {spawn}=require(a18_0x5f47('0x4'));const exec=require('child_process')[a18_0x5f47('0x5')];const isImage=require('is-image');const format=require(a18_0x5f47('0x6'));const os=require('os');const mqtt=require(a18_0x5f47('0x7'));const uuidv4=require(a18_0x5f47('0x8'));const jwt=require(a18_0x5f47('0x9'));class MqttService{constructor(_0x1db259){this[a18_0x5f47('0xa')]=_0x1db259;this[a18_0x5f47('0xb')]=a18_0x5f47('0xc');this[a18_0x5f47('0xd')]=new HttpClientService_1[(a18_0x5f47('0xe'))]();}['init'](){this[a18_0x5f47('0xf')]();}[a18_0x5f47('0x10')](){console[a18_0x5f47('0x11')](a18_0x5f47('0x12'));const _0x3e2283='velvety-glazing-252020';const _0x89243e=a18_0x5f47('0x13');const _0x2aefdf='my-registry';const _0xfa72f8=a18_0x5f47('0x14');const _0x214870=a18_0x5f47('0x15');const _0x29e34e=a18_0x5f47('0x16');const _0x1441f3=a18_0x5f47('0x17');const _0x5cfe4a=0x1bb;const _0x9f5545=a18_0x5f47('0x18');const _0x4912b6=0x5;const _0x12f2d4=a18_0x5f47('0x19')+_0x3e2283+a18_0x5f47('0x1a')+_0xfa72f8+a18_0x5f47('0x1b')+_0x2aefdf+a18_0x5f47('0x1c')+_0x89243e;const _0x1477f0={'host':_0x1441f3,'port':_0x5cfe4a,'clientId':_0x12f2d4,'username':a18_0x5f47('0x1d'),'password':this['createJwt'](_0x3e2283,_0x29e34e,_0x214870),'protocol':a18_0x5f47('0x1e'),'secureProtocol':a18_0x5f47('0x1f')};const _0x5bcf90=Math[a18_0x5f47('0x20')](Date[a18_0x5f47('0x21')]()/0x3e8);const _0x10326d=mqtt[a18_0x5f47('0x22')](_0x1477f0);_0x10326d[a18_0x5f47('0x23')](a18_0x5f47('0x1c')+_0x89243e+'/config',{'qos':0x1});_0x10326d[a18_0x5f47('0x23')](a18_0x5f47('0x1c')+_0x89243e+'/state',{'qos':0x1});_0x10326d[a18_0x5f47('0x23')](a18_0x5f47('0x1c')+_0x89243e+a18_0x5f47('0x24'),{'qos':0x0});const _0x446904=a18_0x5f47('0x1c')+_0x89243e+'/'+_0x9f5545;_0x10326d['on'](a18_0x5f47('0x22'),_0x2ccb2c=>{console[a18_0x5f47('0x11')](a18_0x5f47('0x22'));if(!_0x2ccb2c){console[a18_0x5f47('0x11')](a18_0x5f47('0x25'));}else{const _0x446904=a18_0x5f47('0x26');const _0x255891=_0x2aefdf+'/'+_0x89243e+a18_0x5f47('0x27');_0x10326d['publish'](_0x446904,_0x255891,{'qos':0x1},_0x376ad5=>{console[a18_0x5f47('0x11')]('publish\x20result:');console['log'](_0x376ad5);if(!_0x376ad5){}});}});_0x10326d['on']('close',()=>{console['log'](a18_0x5f47('0x28'));});_0x10326d['on']('error',_0x38ed83=>{console[a18_0x5f47('0x11')](a18_0x5f47('0x29'),_0x38ed83);});_0x10326d['on']('message',(_0x309eae,_0x2d5fe2)=>{let _0x5d7fcb=a18_0x5f47('0x2a');console[a18_0x5f47('0x11')](_0x309eae);console['log'](_0x2d5fe2+'');if(_0x309eae===a18_0x5f47('0x1c')+_0x89243e+a18_0x5f47('0x2b')){_0x5d7fcb=a18_0x5f47('0x2c');}else if(_0x309eae[a18_0x5f47('0x2d')](a18_0x5f47('0x1c')+_0x89243e+a18_0x5f47('0x2e'))){_0x5d7fcb=a18_0x5f47('0x2f');}_0x5d7fcb+=Buffer['from'](_0x2d5fe2,'base64')[a18_0x5f47('0x30')]('ascii');console[a18_0x5f47('0x11')](_0x5d7fcb);});_0x10326d['on'](a18_0x5f47('0x31'),()=>{});console[a18_0x5f47('0x11')](_0x1477f0);}[a18_0x5f47('0xf')](){console['log'](a18_0x5f47('0x12'));this[a18_0x5f47('0x32')]=uuidv4();console[a18_0x5f47('0x11')](a18_0x5f47('0x33'));console[a18_0x5f47('0x11')](this[a18_0x5f47('0x32')]);const _0x3589b3={'clientId':this['clientId'],'username':a18_0x5f47('0x34'),'password':a18_0x5f47('0x35'),'clean':!![]};this[a18_0x5f47('0x36')]=mqtt[a18_0x5f47('0x22')](a18_0x5f47('0x37'),_0x3589b3);this[a18_0x5f47('0x36')]['on'](a18_0x5f47('0x22'),this['mqttClient_connect'][a18_0x5f47('0x38')](this));this['mqttClient']['on'](a18_0x5f47('0x39'),this[a18_0x5f47('0x3a')]['bind'](this));this['mqttClient']['on']('close',()=>{console['log'](a18_0x5f47('0x28'));});process['on']('exit',this[a18_0x5f47('0x3b')][a18_0x5f47('0x38')](this));process['on']('SIGINT',this[a18_0x5f47('0x3b')][a18_0x5f47('0x38')](this));process['on'](a18_0x5f47('0x3c'),this[a18_0x5f47('0x3b')]['bind'](this));}['mqttClient_connect'](){console[a18_0x5f47('0x11')](a18_0x5f47('0x3d')+this[a18_0x5f47('0x32')]);this[a18_0x5f47('0x36')][a18_0x5f47('0x23')](a18_0x5f47('0x3e'));this[a18_0x5f47('0x36')][a18_0x5f47('0x23')](a18_0x5f47('0x3f'));this['mqttClient'][a18_0x5f47('0x23')](a18_0x5f47('0x40'),{'qos':0x2});this[a18_0x5f47('0x36')][a18_0x5f47('0x23')](a18_0x5f47('0x41'),{'qos':0x2});this[a18_0x5f47('0x36')][a18_0x5f47('0x23')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x5f47('0x23')](a18_0x5f47('0x42'),{'qos':0x2});this['mqttClient'][a18_0x5f47('0x23')]('player/ifconfig',{'qos':0x2});this[a18_0x5f47('0x36')][a18_0x5f47('0x23')](a18_0x5f47('0x43'),{'qos':0x2});}[a18_0x5f47('0x44')](){}['mqttClient_message'](_0x1e7057,_0x5d44c7){console[a18_0x5f47('0x11')](a18_0x5f47('0x45'),_0x1e7057,_0x5d44c7);switch(_0x1e7057){case'player/open':return this[a18_0x5f47('0x46')](_0x5d44c7);case'player/close':return this[a18_0x5f47('0x47')](_0x5d44c7);case a18_0x5f47('0x40'):return this['handleRebootRequest'](_0x5d44c7);case a18_0x5f47('0x48'):return this['handleReloadPlaylistRequest'](_0x5d44c7);case a18_0x5f47('0x41'):return this['handleLoadPlaylistRequest'](_0x5d44c7);case a18_0x5f47('0x42'):return this[a18_0x5f47('0x49')](_0x5d44c7);case a18_0x5f47('0x4a'):return this[a18_0x5f47('0x4b')](_0x5d44c7);case a18_0x5f47('0x43'):return this[a18_0x5f47('0x4c')](_0x5d44c7);}}[a18_0x5f47('0x4c')](_0xb3fc70){if(_0xb3fc70==a18_0x5f47('0x4d')||_0xb3fc70==String(this[a18_0x5f47('0xa')][a18_0x5f47('0x4e')])){this[a18_0x5f47('0xa')]['registerClient']();}}[a18_0x5f47('0x4b')](_0x461f1a){if(_0x461f1a==a18_0x5f47('0x4d')||_0x461f1a==String(this['syncPlaylistsService'][a18_0x5f47('0x4e')])){}}['handleUpdateRequest'](_0x4a26e8){console[a18_0x5f47('0x11')]('handleUpdateRequest:\x20'+_0x4a26e8);if(_0x4a26e8==a18_0x5f47('0x4d')||_0x4a26e8==String(this[a18_0x5f47('0xa')][a18_0x5f47('0x4e')])){const _0x474caf=__dirname;const _0x44044f=require(a18_0x5f47('0x4f'))(_0x474caf);console['log'](a18_0x5f47('0x50'));_0x44044f['pull']((_0xe3997c,_0x4d447f)=>{if(_0xe3997c){console['log']('Error\x20git\x20updated');this[a18_0x5f47('0x49')](_0x4a26e8);return;}else{}console['log'](a18_0x5f47('0x51'));console[a18_0x5f47('0x11')](_0x4d447f);if(_0x4d447f&&_0x4d447f[a18_0x5f47('0x52')]['changes']){const _0x4e6f4f=spawn('shutdown',['-r',a18_0x5f47('0x21')]);}else{}});}}['handleLoadPlaylistRequest'](_0x54a24b){if(_0x54a24b==a18_0x5f47('0x4d')||_0x54a24b==String(this['syncPlaylistsService']['playerId'])){this[a18_0x5f47('0xa')][a18_0x5f47('0x53')]();}}[a18_0x5f47('0x54')](_0x5b2e1e){if(String(_0x5b2e1e)==a18_0x5f47('0x4d')||String(_0x5b2e1e)==String(this[a18_0x5f47('0xa')]['playerId'])){this['syncPlaylistsService']['reloadMediaList']();}}['handleRebootRequest'](_0x12fa5c){if(_0x12fa5c==a18_0x5f47('0x4d')||_0x12fa5c==String(this[a18_0x5f47('0xa')]['playerId'])){console[a18_0x5f47('0x11')](a18_0x5f47('0x55'));try{require(a18_0x5f47('0x56'))[a18_0x5f47('0x56')]();}catch(_0x322da7){console[a18_0x5f47('0x11')](_0x322da7);}}}[a18_0x5f47('0x57')](){console['log'](a18_0x5f47('0x58'),this[a18_0x5f47('0xb')]);this[a18_0x5f47('0x36')][a18_0x5f47('0x59')](a18_0x5f47('0x5a'),this[a18_0x5f47('0xa')][a18_0x5f47('0x4e')]+'-'+this[a18_0x5f47('0xb')]);}['handleOpenRequest'](_0x46de6a){if(this['state']!=='open'&&this[a18_0x5f47('0xb')]!==a18_0x5f47('0x5b')){console[a18_0x5f47('0x11')]('opening\x20player\x20door');this[a18_0x5f47('0xb')]=a18_0x5f47('0x5b');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5f47('0xb')]=a18_0x5f47('0x5c');this[a18_0x5f47('0x57')]();},0x1388);}}[a18_0x5f47('0x47')](_0x34b5cc){if(this[a18_0x5f47('0xb')]!=='closed'&&this['state']!==a18_0x5f47('0x5d')){this[a18_0x5f47('0xb')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5f47('0xb')]='closed';this['sendStateUpdate']();},0x1388);}}[a18_0x5f47('0x3b')](_0x15b4c1,_0x4c9574){if(_0x4c9574){console[a18_0x5f47('0x11')](_0x4c9574[a18_0x5f47('0x5e')]);}this[a18_0x5f47('0x36')][a18_0x5f47('0x59')](a18_0x5f47('0x5f'),a18_0x5f47('0x60'));}[a18_0x5f47('0x61')](_0xcd6f7e,_0x2503ed,_0x579409){const _0x272803={'iat':Math[a18_0x5f47('0x20')](Date[a18_0x5f47('0x21')]()/0x3e8),'exp':Math[a18_0x5f47('0x20')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0xcd6f7e};const _0x51ced0=fs[a18_0x5f47('0x62')](_0x2503ed);return jwt[a18_0x5f47('0x63')](_0x272803,_0x51ced0,{'algorithm':_0x579409});}}exports[a18_0x5f47('0x64')]=MqttService;