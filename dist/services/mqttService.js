var a20_0x4aea=['resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/devices/','createJwt','mqtts','TLSv1_2_method','round','now','subscribe','/config','/state','/commands/#','connect','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','/commands','from','base64','toString','ascii','packetsend','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','all','playerId','registerClient','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256'];(function(_0x48c148,_0x5269e7){var _0xe57478=function(_0x2a1fed){while(--_0x2a1fed){_0x48c148['push'](_0x48c148['shift']());}};_0xe57478(++_0x5269e7);}(a20_0x4aea,0x1c6));var a20_0x1748=function(_0x13dfe7,_0x1ed73c){_0x13dfe7=_0x13dfe7-0x0;var _0x570b26=a20_0x4aea[_0x13dfe7];return _0x570b26;};'use strict';Object[a20_0x1748('0x0')](exports,a20_0x1748('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x1748('0x2'));const fs=require('fs');const fsExtra=require(a20_0x1748('0x3'));const request=require('request');const progress=require(a20_0x1748('0x4'));const spawn=require(a20_0x1748('0x5'))['spawn'];const exec=require('child_process')[a20_0x1748('0x6')];const isImage=require(a20_0x1748('0x7'));const format=require(a20_0x1748('0x8'));const os=require('os');const mqtt=require(a20_0x1748('0x9'));const uuidv4=require(a20_0x1748('0xa'));const jwt=require(a20_0x1748('0xb'));class MqttService{constructor(_0x2a1f20){this[a20_0x1748('0xc')]=_0x2a1f20;this[a20_0x1748('0xd')]=a20_0x1748('0xe');this[a20_0x1748('0xf')]=new HttpClientService_1[(a20_0x1748('0x10'))]();}[a20_0x1748('0x11')](){this['mqttInit_mosquitto']();}[a20_0x1748('0x12')](){console[a20_0x1748('0x13')](a20_0x1748('0x14'));const _0x246767=a20_0x1748('0x15');const _0x23bf8c=a20_0x1748('0x16');const _0x35eda1=a20_0x1748('0x17');const _0x2e5f30=a20_0x1748('0x18');const _0x4a702e=a20_0x1748('0x19');const _0x39f729=a20_0x1748('0x1a');const _0x18b763=a20_0x1748('0x1b');const _0xd099d6=0x1bb;const _0x20bb34=a20_0x1748('0x1c');const _0x322b4f=0x5;const _0x17bc00='projects/'+_0x246767+'/locations/'+_0x2e5f30+'/registries/'+_0x35eda1+a20_0x1748('0x1d')+_0x23bf8c;const _0x27926d={'host':_0x18b763,'port':_0xd099d6,'clientId':_0x17bc00,'username':'unused','password':this[a20_0x1748('0x1e')](_0x246767,_0x39f729,_0x4a702e),'protocol':a20_0x1748('0x1f'),'secureProtocol':a20_0x1748('0x20')};const _0x3166c7=Math[a20_0x1748('0x21')](Date[a20_0x1748('0x22')]()/0x3e8);const _0x413fc8=mqtt['connect'](_0x27926d);_0x413fc8[a20_0x1748('0x23')]('/devices/'+_0x23bf8c+a20_0x1748('0x24'),{'qos':0x1});_0x413fc8[a20_0x1748('0x23')](a20_0x1748('0x1d')+_0x23bf8c+a20_0x1748('0x25'),{'qos':0x1});_0x413fc8[a20_0x1748('0x23')](a20_0x1748('0x1d')+_0x23bf8c+a20_0x1748('0x26'),{'qos':0x0});const _0x4da867=a20_0x1748('0x1d')+_0x23bf8c+'/'+_0x20bb34;_0x413fc8['on'](a20_0x1748('0x27'),_0x39d29e=>{console[a20_0x1748('0x13')](a20_0x1748('0x27'));if(!_0x39d29e){console['log']('Client\x20not\x20connected...');}else{const _0x4da867=a20_0x1748('0x28');const _0x51e256=_0x35eda1+'/'+_0x23bf8c+a20_0x1748('0x29');_0x413fc8[a20_0x1748('0x2a')](_0x4da867,_0x51e256,{'qos':0x1},_0xba6325=>{console[a20_0x1748('0x13')](a20_0x1748('0x2b'));console[a20_0x1748('0x13')](_0xba6325);if(!_0xba6325){}});}});_0x413fc8['on'](a20_0x1748('0x2c'),()=>{console[a20_0x1748('0x13')](a20_0x1748('0x2c'));});_0x413fc8['on']('error',_0x1e6509=>{console[a20_0x1748('0x13')](a20_0x1748('0x2d'),_0x1e6509);});_0x413fc8['on'](a20_0x1748('0x2e'),(_0x35da4d,_0x2f47a8)=>{let _0x219cfa='Message\x20received:\x20';console[a20_0x1748('0x13')](_0x35da4d);console[a20_0x1748('0x13')](_0x2f47a8+'');if(_0x35da4d==='/devices/'+_0x23bf8c+a20_0x1748('0x24')){_0x219cfa='Config\x20message\x20received:\x20';}else if(_0x35da4d['startsWith'](a20_0x1748('0x1d')+_0x23bf8c+a20_0x1748('0x2f'))){_0x219cfa='Command\x20message\x20received:\x20';}_0x219cfa+=Buffer[a20_0x1748('0x30')](_0x2f47a8,a20_0x1748('0x31'))[a20_0x1748('0x32')](a20_0x1748('0x33'));console['log'](_0x219cfa);});_0x413fc8['on'](a20_0x1748('0x34'),()=>{});console[a20_0x1748('0x13')](_0x27926d);}['mqttInit_mosquitto'](){console[a20_0x1748('0x13')](a20_0x1748('0x14'));this[a20_0x1748('0x35')]=uuidv4();console[a20_0x1748('0x13')]('this.clientId');console[a20_0x1748('0x13')](this['clientId']);const _0x5f5c2f={'clientId':this[a20_0x1748('0x35')],'username':a20_0x1748('0x36'),'password':a20_0x1748('0x37'),'clean':!![]};this[a20_0x1748('0x38')]=mqtt[a20_0x1748('0x27')](a20_0x1748('0x39'),_0x5f5c2f);this['mqttClient']['on'](a20_0x1748('0x27'),this[a20_0x1748('0x3a')][a20_0x1748('0x3b')](this));this[a20_0x1748('0x38')]['on'](a20_0x1748('0x2e'),this[a20_0x1748('0x3c')][a20_0x1748('0x3b')](this));this['mqttClient']['on'](a20_0x1748('0x2c'),()=>{console[a20_0x1748('0x13')]('close');});process['on'](a20_0x1748('0x3d'),this['handleAppExit'][a20_0x1748('0x3b')](this));process['on'](a20_0x1748('0x3e'),this[a20_0x1748('0x3f')]['bind'](this));process['on'](a20_0x1748('0x40'),this['handleAppExit'][a20_0x1748('0x3b')](this));}[a20_0x1748('0x3a')](){console[a20_0x1748('0x13')](a20_0x1748('0x41')+this[a20_0x1748('0x35')]);this[a20_0x1748('0x38')]['subscribe'](a20_0x1748('0x42'));this['mqttClient'][a20_0x1748('0x23')](a20_0x1748('0x43'));this[a20_0x1748('0x38')][a20_0x1748('0x23')]('player/reboot',{'qos':0x2});this[a20_0x1748('0x38')][a20_0x1748('0x23')](a20_0x1748('0x44'),{'qos':0x2});this[a20_0x1748('0x38')][a20_0x1748('0x23')](a20_0x1748('0x45'),{'qos':0x2});this[a20_0x1748('0x38')]['subscribe'](a20_0x1748('0x46'),{'qos':0x2});this['mqttClient'][a20_0x1748('0x23')](a20_0x1748('0x47'),{'qos':0x2});this['mqttClient'][a20_0x1748('0x23')](a20_0x1748('0x48'),{'qos':0x2});this[a20_0x1748('0x38')][a20_0x1748('0x23')](a20_0x1748('0x49'),{'qos':0x2});this[a20_0x1748('0x38')][a20_0x1748('0x23')](a20_0x1748('0x4a'),{'qos':0x2});this[a20_0x1748('0x38')][a20_0x1748('0x23')](a20_0x1748('0x4b'),{'qos':0x2});}[a20_0x1748('0x4c')](){}[a20_0x1748('0x3c')](_0x196574,_0x173ded){console[a20_0x1748('0x13')](a20_0x1748('0x4d'),_0x196574,_0x173ded);switch(_0x196574){case a20_0x1748('0x42'):return this[a20_0x1748('0x4e')](_0x173ded);case a20_0x1748('0x43'):return this[a20_0x1748('0x4f')](_0x173ded);case a20_0x1748('0x50'):return this[a20_0x1748('0x51')](_0x173ded);case a20_0x1748('0x45'):return this[a20_0x1748('0x52')](_0x173ded);case a20_0x1748('0x44'):return this['handleLoadPlaylistRequest'](_0x173ded);case a20_0x1748('0x46'):return this[a20_0x1748('0x53')](_0x173ded);case a20_0x1748('0x47'):return this[a20_0x1748('0x54')](_0x173ded);case a20_0x1748('0x48'):return this[a20_0x1748('0x55')](_0x173ded);case a20_0x1748('0x49'):return this[a20_0x1748('0x56')](_0x173ded);case a20_0x1748('0x4a'):return this[a20_0x1748('0x57')](_0x173ded);case a20_0x1748('0x4b'):return this['handleTurnOnTVRequest'](_0x173ded);}}[a20_0x1748('0x55')](_0x1067af){if(_0x1067af==a20_0x1748('0x58')||_0x1067af==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){this[a20_0x1748('0xc')][a20_0x1748('0x5a')]();}}[a20_0x1748('0x54')](_0x1ff266){if(_0x1ff266=='all'||_0x1ff266==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){}}[a20_0x1748('0x53')](_0xd7dcb5){console[a20_0x1748('0x13')]('handleUpdateRequest:\x20'+_0xd7dcb5);if(_0xd7dcb5=='all'||_0xd7dcb5==String(this['syncPlaylistsService'][a20_0x1748('0x59')])){const _0x30c0d5=__dirname;const _0x20af61=require('simple-git')(_0x30c0d5);console[a20_0x1748('0x13')](a20_0x1748('0x5b'));_0x20af61[a20_0x1748('0x5c')]((_0x42a546,_0x309b5e)=>{if(_0x42a546){console[a20_0x1748('0x13')](a20_0x1748('0x5d'));this[a20_0x1748('0x53')](_0xd7dcb5);return;}else{}console['log'](a20_0x1748('0x5e'));console[a20_0x1748('0x13')](_0x309b5e);if(_0x309b5e&&_0x309b5e[a20_0x1748('0x5f')][a20_0x1748('0x60')]){this[a20_0x1748('0xc')][a20_0x1748('0x61')]();}else{}});}}[a20_0x1748('0x62')](_0x5c1dca){if(_0x5c1dca==a20_0x1748('0x58')||_0x5c1dca==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){this[a20_0x1748('0xc')][a20_0x1748('0x63')]();}}['handleReloadPlaylistRequest'](_0x2fae73){if(String(_0x2fae73)=='all'||String(_0x2fae73)==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){this['syncPlaylistsService'][a20_0x1748('0x64')]();}}['handleRebootRequest'](_0x289415){if(_0x289415==a20_0x1748('0x58')||_0x289415==String(this['syncPlaylistsService'][a20_0x1748('0x59')])){console[a20_0x1748('0x13')](a20_0x1748('0x65'));try{this[a20_0x1748('0xc')][a20_0x1748('0x61')]();}catch(_0x1628b1){console['log'](_0x1628b1);}}}[a20_0x1748('0x56')](_0x20ae20){if(_0x20ae20==a20_0x1748('0x58')||_0x20ae20==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){console['log']('handleUpdateSettingsRequest:\x20');try{this[a20_0x1748('0xc')][a20_0x1748('0x66')]();}catch(_0xcd188d){console[a20_0x1748('0x13')](_0xcd188d);}}}[a20_0x1748('0x67')](_0x38ef5f){if(_0x38ef5f==a20_0x1748('0x58')||_0x38ef5f==String(this[a20_0x1748('0xc')]['playerId'])){console[a20_0x1748('0x13')](a20_0x1748('0x68'));try{this[a20_0x1748('0xc')][a20_0x1748('0x69')]();}catch(_0xfbcdfd){console[a20_0x1748('0x13')](_0xfbcdfd);}}}[a20_0x1748('0x57')](_0x228dce){if(_0x228dce==a20_0x1748('0x58')||_0x228dce==String(this[a20_0x1748('0xc')][a20_0x1748('0x59')])){console['log'](a20_0x1748('0x6a'));try{this[a20_0x1748('0xc')][a20_0x1748('0x6b')]();}catch(_0x5863a4){console['log'](_0x5863a4);}}}[a20_0x1748('0x6c')](){console['log'](a20_0x1748('0x6d'),this[a20_0x1748('0xd')]);this[a20_0x1748('0x38')][a20_0x1748('0x2a')](a20_0x1748('0x6e'),this[a20_0x1748('0xc')]['playerId']+'-'+this['state']);}[a20_0x1748('0x4e')](_0x4260f8){if(this['state']!==a20_0x1748('0x6f')&&this[a20_0x1748('0xd')]!==a20_0x1748('0x70')){console[a20_0x1748('0x13')](a20_0x1748('0x71'));this['state']=a20_0x1748('0x70');this[a20_0x1748('0x6c')]();setTimeout(()=>{this['state']=a20_0x1748('0x6f');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x4dfbf6){if(this[a20_0x1748('0xd')]!=='closed'&&this[a20_0x1748('0xd')]!=='closing'){this[a20_0x1748('0xd')]=a20_0x1748('0x72');this[a20_0x1748('0x6c')]();setTimeout(()=>{this[a20_0x1748('0xd')]=a20_0x1748('0xe');this[a20_0x1748('0x6c')]();},0x1388);}}[a20_0x1748('0x3f')](_0x17dfa1,_0xd15dfe){if(_0xd15dfe){console[a20_0x1748('0x13')](_0xd15dfe[a20_0x1748('0x73')]);}this[a20_0x1748('0x38')][a20_0x1748('0x2a')](a20_0x1748('0x74'),'false');}[a20_0x1748('0x1e')](_0x16bab8,_0x3b7ef9,_0x448f91){const _0x4456ef={'iat':Math[a20_0x1748('0x21')](Date[a20_0x1748('0x22')]()/0x3e8),'exp':Math[a20_0x1748('0x21')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x16bab8};const _0x1d3e34=fs[a20_0x1748('0x75')](_0x3b7ef9);return jwt[a20_0x1748('0x76')](_0x4456ef,_0x1d3e34,{'algorithm':_0x448f91});}}exports[a20_0x1748('0x77')]=MqttService;