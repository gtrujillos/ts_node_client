var a18_0x3d92=['state','player/state','opening','opening\x20player\x20door','closing','closed','stack','false','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','httpClientService','HttpClientService','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','connect','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','message','/config','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','mqttClient_message','bind','exit','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/update','player/ifconfig','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','handleRegisterRequest','all','playerId','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','sendStateUpdate','sending\x20state\x20%s'];(function(_0x49bc92,_0x43d8d8){var _0x5aa71d=function(_0x1a5201){while(--_0x1a5201){_0x49bc92['push'](_0x49bc92['shift']());}};_0x5aa71d(++_0x43d8d8);}(a18_0x3d92,0x14f));var a18_0x5c1f=function(_0x244ada,_0x504979){_0x244ada=_0x244ada-0x0;var _0x127726=a18_0x3d92[_0x244ada];return _0x127726;};'use strict';Object[a18_0x5c1f('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x5c1f('0x1'));const fs=require('fs');const fsExtra=require(a18_0x5c1f('0x2'));const request=require(a18_0x5c1f('0x3'));const progress=require('request-progress');const spawn=require(a18_0x5c1f('0x4'))[a18_0x5c1f('0x5')];const exec=require(a18_0x5c1f('0x4'))[a18_0x5c1f('0x6')];const isImage=require(a18_0x5c1f('0x7'));const format=require(a18_0x5c1f('0x8'));const os=require('os');const mqtt=require(a18_0x5c1f('0x9'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x5c1f('0xa'));class MqttService{constructor(_0x91fc2b){this[a18_0x5c1f('0xb')]=_0x91fc2b;this['state']='closed';this[a18_0x5c1f('0xc')]=new HttpClientService_1[(a18_0x5c1f('0xd'))]();}['init'](){this[a18_0x5c1f('0xe')]();}['mqttInit_google'](){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x10'));const _0x467281=a18_0x5c1f('0x11');const _0x2a7d9f=a18_0x5c1f('0x12');const _0x3ba027='my-registry';const _0x575142=a18_0x5c1f('0x13');const _0x175a7f='RS256';const _0x5a280d=a18_0x5c1f('0x14');const _0x462ce3=a18_0x5c1f('0x15');const _0x53bffd=0x1bb;const _0xfda46e=a18_0x5c1f('0x16');const _0x205f40=0x5;const _0x53a52f=a18_0x5c1f('0x17')+_0x467281+a18_0x5c1f('0x18')+_0x575142+a18_0x5c1f('0x19')+_0x3ba027+a18_0x5c1f('0x1a')+_0x2a7d9f;const _0x2a7124={'host':_0x462ce3,'port':_0x53bffd,'clientId':_0x53a52f,'username':a18_0x5c1f('0x1b'),'password':this[a18_0x5c1f('0x1c')](_0x467281,_0x5a280d,_0x175a7f),'protocol':a18_0x5c1f('0x1d'),'secureProtocol':a18_0x5c1f('0x1e')};const _0x21b2a2=Math[a18_0x5c1f('0x1f')](Date['now']()/0x3e8);const _0x72c2c0=mqtt[a18_0x5c1f('0x20')](_0x2a7124);_0x72c2c0[a18_0x5c1f('0x21')](a18_0x5c1f('0x1a')+_0x2a7d9f+'/config',{'qos':0x1});_0x72c2c0[a18_0x5c1f('0x21')]('/devices/'+_0x2a7d9f+a18_0x5c1f('0x22'),{'qos':0x1});_0x72c2c0['subscribe'](a18_0x5c1f('0x1a')+_0x2a7d9f+a18_0x5c1f('0x23'),{'qos':0x0});const _0x20efee=a18_0x5c1f('0x1a')+_0x2a7d9f+'/'+_0xfda46e;_0x72c2c0['on'](a18_0x5c1f('0x20'),_0x540356=>{console[a18_0x5c1f('0xf')]('connect');if(!_0x540356){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x24'));}else{const _0x20efee=a18_0x5c1f('0x25');const _0xc438a4=_0x3ba027+'/'+_0x2a7d9f+a18_0x5c1f('0x26');_0x72c2c0[a18_0x5c1f('0x27')](_0x20efee,_0xc438a4,{'qos':0x1},_0x45f1ae=>{console[a18_0x5c1f('0xf')]('publish\x20result:');console['log'](_0x45f1ae);if(!_0x45f1ae){}});}});_0x72c2c0['on']('close',()=>{console[a18_0x5c1f('0xf')](a18_0x5c1f('0x28'));});_0x72c2c0['on'](a18_0x5c1f('0x29'),_0x111708=>{console[a18_0x5c1f('0xf')]('error',_0x111708);});_0x72c2c0['on'](a18_0x5c1f('0x2a'),(_0x1b963c,_0x4731cb)=>{let _0x55f059='Message\x20received:\x20';console[a18_0x5c1f('0xf')](_0x1b963c);console['log'](_0x4731cb+'');if(_0x1b963c===a18_0x5c1f('0x1a')+_0x2a7d9f+a18_0x5c1f('0x2b')){_0x55f059=a18_0x5c1f('0x2c');}else if(_0x1b963c['startsWith']('/devices/'+_0x2a7d9f+a18_0x5c1f('0x2d'))){_0x55f059=a18_0x5c1f('0x2e');}_0x55f059+=Buffer[a18_0x5c1f('0x2f')](_0x4731cb,a18_0x5c1f('0x30'))['toString'](a18_0x5c1f('0x31'));console['log'](_0x55f059);});_0x72c2c0['on'](a18_0x5c1f('0x32'),()=>{});console[a18_0x5c1f('0xf')](_0x2a7124);}[a18_0x5c1f('0xe')](){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x10'));this[a18_0x5c1f('0x33')]=uuidv4();console['log'](a18_0x5c1f('0x34'));console[a18_0x5c1f('0xf')](this[a18_0x5c1f('0x33')]);const _0x10e553={'clientId':this['clientId'],'username':a18_0x5c1f('0x35'),'password':a18_0x5c1f('0x36'),'clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x5c1f('0x37'),_0x10e553);this[a18_0x5c1f('0x38')]['on']('connect',this[a18_0x5c1f('0x39')]['bind'](this));this[a18_0x5c1f('0x38')]['on'](a18_0x5c1f('0x2a'),this[a18_0x5c1f('0x3a')][a18_0x5c1f('0x3b')](this));this[a18_0x5c1f('0x38')]['on'](a18_0x5c1f('0x28'),()=>{console[a18_0x5c1f('0xf')](a18_0x5c1f('0x28'));});process['on'](a18_0x5c1f('0x3c'),this['handleAppExit']['bind'](this));process['on'](a18_0x5c1f('0x3d'),this[a18_0x5c1f('0x3e')][a18_0x5c1f('0x3b')](this));process['on'](a18_0x5c1f('0x3f'),this['handleAppExit'][a18_0x5c1f('0x3b')](this));}[a18_0x5c1f('0x39')](){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x40')+this[a18_0x5c1f('0x33')]);this['mqttClient'][a18_0x5c1f('0x21')](a18_0x5c1f('0x41'));this[a18_0x5c1f('0x38')][a18_0x5c1f('0x21')](a18_0x5c1f('0x42'));this['mqttClient']['subscribe'](a18_0x5c1f('0x43'),{'qos':0x2});this[a18_0x5c1f('0x38')][a18_0x5c1f('0x21')](a18_0x5c1f('0x44'),{'qos':0x2});this[a18_0x5c1f('0x38')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x5c1f('0x38')][a18_0x5c1f('0x21')](a18_0x5c1f('0x45'),{'qos':0x2});this[a18_0x5c1f('0x38')]['subscribe'](a18_0x5c1f('0x46'),{'qos':0x2});this[a18_0x5c1f('0x38')][a18_0x5c1f('0x21')]('player/register',{'qos':0x2});}['reportStatus'](){}[a18_0x5c1f('0x3a')](_0x522a3b,_0x4944ec){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x47'),_0x522a3b,_0x4944ec);switch(_0x522a3b){case a18_0x5c1f('0x41'):return this[a18_0x5c1f('0x48')](_0x4944ec);case a18_0x5c1f('0x42'):return this[a18_0x5c1f('0x49')](_0x4944ec);case'player/reboot':return this[a18_0x5c1f('0x4a')](_0x4944ec);case a18_0x5c1f('0x4b'):return this[a18_0x5c1f('0x4c')](_0x4944ec);case a18_0x5c1f('0x44'):return this[a18_0x5c1f('0x4d')](_0x4944ec);case a18_0x5c1f('0x45'):return this[a18_0x5c1f('0x4e')](_0x4944ec);case'player/ifconfig':return this[a18_0x5c1f('0x4f')](_0x4944ec);case a18_0x5c1f('0x50'):return this[a18_0x5c1f('0x51')](_0x4944ec);}}[a18_0x5c1f('0x51')](_0x4c4690){if(_0x4c4690==a18_0x5c1f('0x52')||_0x4c4690==String(this['syncPlaylistsService'][a18_0x5c1f('0x53')])){this[a18_0x5c1f('0xb')]['registerClient']();}}['handleIfconfigRequest'](_0x1c6635){if(_0x1c6635=='all'||_0x1c6635==String(this['syncPlaylistsService'][a18_0x5c1f('0x53')])){}}[a18_0x5c1f('0x4e')](_0x17d752){console['log']('handleUpdateRequest:\x20'+_0x17d752);if(_0x17d752=='all'||_0x17d752==String(this[a18_0x5c1f('0xb')][a18_0x5c1f('0x53')])){const _0x856309=__dirname;const _0x25ed6a=require(a18_0x5c1f('0x54'))(_0x856309);console[a18_0x5c1f('0xf')](a18_0x5c1f('0x55'));_0x25ed6a[a18_0x5c1f('0x56')]((_0x11bcff,_0x99749)=>{if(_0x11bcff){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x57'));this[a18_0x5c1f('0x4e')](_0x17d752);return;}else{}console['log'](a18_0x5c1f('0x58'));console['log'](_0x99749);if(_0x99749&&_0x99749[a18_0x5c1f('0x59')][a18_0x5c1f('0x5a')]){const _0x41a05b=spawn(a18_0x5c1f('0x5b'),['-r',a18_0x5c1f('0x5c')]);}else{}});}}['handleLoadPlaylistRequest'](_0x47af5d){if(_0x47af5d==a18_0x5c1f('0x52')||_0x47af5d==String(this['syncPlaylistsService']['playerId'])){this[a18_0x5c1f('0xb')]['loadMediaList']();}}[a18_0x5c1f('0x4c')](_0x2fd627){if(String(_0x2fd627)==a18_0x5c1f('0x52')||String(_0x2fd627)==String(this[a18_0x5c1f('0xb')]['playerId'])){this['syncPlaylistsService'][a18_0x5c1f('0x5d')]();}}['handleRebootRequest'](_0x16df66){if(_0x16df66==a18_0x5c1f('0x52')||_0x16df66==String(this[a18_0x5c1f('0xb')][a18_0x5c1f('0x53')])){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x5e'));try{exec('sudo\x20/sbin/shutdown\x20-r\x20now',function(_0x49ed1e){console[a18_0x5c1f('0xf')](_0x49ed1e);});}catch(_0x2f7078){console[a18_0x5c1f('0xf')](_0x2f7078);}}}[a18_0x5c1f('0x5f')](){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x60'),this[a18_0x5c1f('0x61')]);this[a18_0x5c1f('0x38')][a18_0x5c1f('0x27')](a18_0x5c1f('0x62'),this[a18_0x5c1f('0xb')]['playerId']+'-'+this[a18_0x5c1f('0x61')]);}[a18_0x5c1f('0x48')](_0x508feb){if(this['state']!=='open'&&this['state']!==a18_0x5c1f('0x63')){console[a18_0x5c1f('0xf')](a18_0x5c1f('0x64'));this[a18_0x5c1f('0x61')]=a18_0x5c1f('0x63');this['sendStateUpdate']();setTimeout(()=>{this['state']='open';this[a18_0x5c1f('0x5f')]();},0x1388);}}[a18_0x5c1f('0x49')](_0x1b7619){if(this[a18_0x5c1f('0x61')]!=='closed'&&this[a18_0x5c1f('0x61')]!==a18_0x5c1f('0x65')){this[a18_0x5c1f('0x61')]=a18_0x5c1f('0x65');this[a18_0x5c1f('0x5f')]();setTimeout(()=>{this[a18_0x5c1f('0x61')]=a18_0x5c1f('0x66');this[a18_0x5c1f('0x5f')]();},0x1388);}}[a18_0x5c1f('0x3e')](_0xbc289a,_0x2831d0){if(_0x2831d0){console[a18_0x5c1f('0xf')](_0x2831d0[a18_0x5c1f('0x67')]);}this['mqttClient'][a18_0x5c1f('0x27')]('player/connected',a18_0x5c1f('0x68'));}[a18_0x5c1f('0x1c')](_0x136be3,_0x244b26,_0x4772f6){const _0x542961={'iat':Math[a18_0x5c1f('0x1f')](Date['now']()/0x3e8),'exp':Math['round'](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x136be3};const _0x510a84=fs[a18_0x5c1f('0x69')](_0x244b26);return jwt[a18_0x5c1f('0x6a')](_0x542961,_0x510a84,{'algorithm':_0x4772f6});}}exports[a18_0x5c1f('0x6b')]=MqttService;