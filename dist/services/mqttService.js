var a18_0x138f=['opening\x20player\x20door','closed','closing','player/connected','false','now','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','mqtt','uuid/v4','jsonwebtoken','state','httpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','us-central1','events','projects/','/locations/','/devices/','createJwt','mqtts','round','connect','subscribe','/config','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','clientId','run.lulo_2018#.','mqttClient_connect','bind','mqttClient','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','syncPlaylistsService','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest:\x20','handleTurnOffTVRequest:\x20','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening'];(function(_0xe7193b,_0x430c4a){var _0x36920a=function(_0x4213d2){while(--_0x4213d2){_0xe7193b['push'](_0xe7193b['shift']());}};_0x36920a(++_0x430c4a);}(a18_0x138f,0x1c8));var a18_0x5f1f=function(_0x5e199e,_0x387557){_0x5e199e=_0x5e199e-0x0;var _0x2f8363=a18_0x138f[_0x5e199e];return _0x2f8363;};'use strict';Object[a18_0x5f1f('0x0')](exports,a18_0x5f1f('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5f1f('0x2'));const fs=require('fs');const fsExtra=require(a18_0x5f1f('0x3'));const request=require(a18_0x5f1f('0x4'));const progress=require('request-progress');const spawn=require(a18_0x5f1f('0x5'))[a18_0x5f1f('0x6')];const exec=require(a18_0x5f1f('0x5'))[a18_0x5f1f('0x7')];const isImage=require(a18_0x5f1f('0x8'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x5f1f('0x9'));const uuidv4=require(a18_0x5f1f('0xa'));const jwt=require(a18_0x5f1f('0xb'));class MqttService{constructor(_0x11f8c5){this['syncPlaylistsService']=_0x11f8c5;this[a18_0x5f1f('0xc')]='closed';this[a18_0x5f1f('0xd')]=new HttpClientService_1['HttpClientService']();}[a18_0x5f1f('0xe')](){this[a18_0x5f1f('0xf')]();}[a18_0x5f1f('0x10')](){console['log'](a18_0x5f1f('0x11'));const _0x121bed=a18_0x5f1f('0x12');const _0xd62b58=a18_0x5f1f('0x13');const _0x54b547='my-registry';const _0x214f73=a18_0x5f1f('0x14');const _0x2954c='RS256';const _0x306e1e='resources/keys/rsa_private.pem';const _0x4e5806='mqtt.googleapis.com';const _0x179bd7=0x1bb;const _0x50f99f=a18_0x5f1f('0x15');const _0x2f33d1=0x5;const _0x292267=a18_0x5f1f('0x16')+_0x121bed+a18_0x5f1f('0x17')+_0x214f73+'/registries/'+_0x54b547+a18_0x5f1f('0x18')+_0xd62b58;const _0x250ab7={'host':_0x4e5806,'port':_0x179bd7,'clientId':_0x292267,'username':'unused','password':this[a18_0x5f1f('0x19')](_0x121bed,_0x306e1e,_0x2954c),'protocol':a18_0x5f1f('0x1a'),'secureProtocol':'TLSv1_2_method'};const _0x2d988d=Math[a18_0x5f1f('0x1b')](Date['now']()/0x3e8);const _0x598505=mqtt[a18_0x5f1f('0x1c')](_0x250ab7);_0x598505[a18_0x5f1f('0x1d')](a18_0x5f1f('0x18')+_0xd62b58+a18_0x5f1f('0x1e'),{'qos':0x1});_0x598505[a18_0x5f1f('0x1d')]('/devices/'+_0xd62b58+a18_0x5f1f('0x1f'),{'qos':0x1});_0x598505[a18_0x5f1f('0x1d')](a18_0x5f1f('0x18')+_0xd62b58+a18_0x5f1f('0x20'),{'qos':0x0});const _0x3f3da3=a18_0x5f1f('0x18')+_0xd62b58+'/'+_0x50f99f;_0x598505['on'](a18_0x5f1f('0x1c'),_0x5a764d=>{console[a18_0x5f1f('0x21')](a18_0x5f1f('0x1c'));if(!_0x5a764d){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x22'));}else{const _0x3f3da3=a18_0x5f1f('0x23');const _0x1e2cf5=_0x54b547+'/'+_0xd62b58+a18_0x5f1f('0x24');_0x598505[a18_0x5f1f('0x25')](_0x3f3da3,_0x1e2cf5,{'qos':0x1},_0x546e41=>{console[a18_0x5f1f('0x21')](a18_0x5f1f('0x26'));console[a18_0x5f1f('0x21')](_0x546e41);if(!_0x546e41){}});}});_0x598505['on'](a18_0x5f1f('0x27'),()=>{console[a18_0x5f1f('0x21')](a18_0x5f1f('0x27'));});_0x598505['on']('error',_0x53725d=>{console[a18_0x5f1f('0x21')]('error',_0x53725d);});_0x598505['on'](a18_0x5f1f('0x28'),(_0x1d6891,_0x34b16b)=>{let _0x2201af=a18_0x5f1f('0x29');console[a18_0x5f1f('0x21')](_0x1d6891);console[a18_0x5f1f('0x21')](_0x34b16b+'');if(_0x1d6891===a18_0x5f1f('0x18')+_0xd62b58+'/config'){_0x2201af=a18_0x5f1f('0x2a');}else if(_0x1d6891[a18_0x5f1f('0x2b')]('/devices/'+_0xd62b58+a18_0x5f1f('0x2c'))){_0x2201af=a18_0x5f1f('0x2d');}_0x2201af+=Buffer[a18_0x5f1f('0x2e')](_0x34b16b,a18_0x5f1f('0x2f'))[a18_0x5f1f('0x30')](a18_0x5f1f('0x31'));console[a18_0x5f1f('0x21')](_0x2201af);});_0x598505['on']('packetsend',()=>{});console[a18_0x5f1f('0x21')](_0x250ab7);}[a18_0x5f1f('0xf')](){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x11'));this[a18_0x5f1f('0x32')]=uuidv4();console[a18_0x5f1f('0x21')]('this.clientId');console[a18_0x5f1f('0x21')](this[a18_0x5f1f('0x32')]);const _0x1f67f0={'clientId':this[a18_0x5f1f('0x32')],'username':'lulo_mqtt','password':a18_0x5f1f('0x33'),'clean':!![]};this['mqttClient']=mqtt['connect']('mqtt://lulo.run',_0x1f67f0);this['mqttClient']['on'](a18_0x5f1f('0x1c'),this[a18_0x5f1f('0x34')][a18_0x5f1f('0x35')](this));this[a18_0x5f1f('0x36')]['on']('message',this['mqttClient_message'][a18_0x5f1f('0x35')](this));this[a18_0x5f1f('0x36')]['on'](a18_0x5f1f('0x27'),()=>{console['log'](a18_0x5f1f('0x27'));});process['on'](a18_0x5f1f('0x37'),this[a18_0x5f1f('0x38')][a18_0x5f1f('0x35')](this));process['on']('SIGINT',this[a18_0x5f1f('0x38')][a18_0x5f1f('0x35')](this));process['on'](a18_0x5f1f('0x39'),this[a18_0x5f1f('0x38')]['bind'](this));}['mqttClient_connect'](){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x3a')+this[a18_0x5f1f('0x32')]);this['mqttClient'][a18_0x5f1f('0x1d')](a18_0x5f1f('0x3b'));this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x3c'));this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x3d'),{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x3e'),{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x3f'),{'qos':0x2});this['mqttClient'][a18_0x5f1f('0x1d')](a18_0x5f1f('0x40'),{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')]('player/ifconfig',{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')]('player/register',{'qos':0x2});this['mqttClient'][a18_0x5f1f('0x1d')]('player/update_settings',{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x41'),{'qos':0x2});this[a18_0x5f1f('0x36')][a18_0x5f1f('0x1d')](a18_0x5f1f('0x42'),{'qos':0x2});}[a18_0x5f1f('0x43')](){}[a18_0x5f1f('0x44')](_0x126062,_0x58fdac){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x45'),_0x126062,_0x58fdac);switch(_0x126062){case'player/open':return this[a18_0x5f1f('0x46')](_0x58fdac);case a18_0x5f1f('0x3c'):return this[a18_0x5f1f('0x47')](_0x58fdac);case a18_0x5f1f('0x3d'):return this[a18_0x5f1f('0x48')](_0x58fdac);case a18_0x5f1f('0x3f'):return this[a18_0x5f1f('0x49')](_0x58fdac);case a18_0x5f1f('0x3e'):return this['handleLoadPlaylistRequest'](_0x58fdac);case a18_0x5f1f('0x40'):return this['handleUpdateRequest'](_0x58fdac);case'player/ifconfig':return this[a18_0x5f1f('0x4a')](_0x58fdac);case'player/register':return this[a18_0x5f1f('0x4b')](_0x58fdac);case'player/update_settings':return this[a18_0x5f1f('0x4c')](_0x58fdac);case'player/turn_off_tv':return this[a18_0x5f1f('0x4d')](_0x58fdac);case a18_0x5f1f('0x42'):return this[a18_0x5f1f('0x4e')](_0x58fdac);}}[a18_0x5f1f('0x4b')](_0x49e3e1){if(_0x49e3e1==a18_0x5f1f('0x4f')||_0x49e3e1==String(this['syncPlaylistsService'][a18_0x5f1f('0x50')])){this[a18_0x5f1f('0x51')][a18_0x5f1f('0x52')]();}}[a18_0x5f1f('0x4a')](_0x234643){if(_0x234643==a18_0x5f1f('0x4f')||_0x234643==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){}}[a18_0x5f1f('0x53')](_0x3802a7){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x54')+_0x3802a7);if(_0x3802a7==a18_0x5f1f('0x4f')||_0x3802a7==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){const _0x364d27=__dirname;const _0xafe90c=require(a18_0x5f1f('0x55'))(_0x364d27);console[a18_0x5f1f('0x21')]('Git\x20updating');_0xafe90c[a18_0x5f1f('0x56')]((_0x25431f,_0x1df351)=>{if(_0x25431f){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x57'));this['handleUpdateRequest'](_0x3802a7);return;}else{}console[a18_0x5f1f('0x21')](a18_0x5f1f('0x58'));console[a18_0x5f1f('0x21')](_0x1df351);if(_0x1df351&&_0x1df351[a18_0x5f1f('0x59')][a18_0x5f1f('0x5a')]){this[a18_0x5f1f('0x51')][a18_0x5f1f('0x5b')]();}else{}});}}[a18_0x5f1f('0x5c')](_0x4a6598){if(_0x4a6598==a18_0x5f1f('0x4f')||_0x4a6598==String(this[a18_0x5f1f('0x51')]['playerId'])){this[a18_0x5f1f('0x51')][a18_0x5f1f('0x5d')]();}}[a18_0x5f1f('0x49')](_0x1523a3){if(String(_0x1523a3)==a18_0x5f1f('0x4f')||String(_0x1523a3)==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){this[a18_0x5f1f('0x51')][a18_0x5f1f('0x5e')]();}}['handleRebootRequest'](_0x21127f){if(_0x21127f=='all'||_0x21127f==String(this['syncPlaylistsService']['playerId'])){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x5f'));try{this[a18_0x5f1f('0x51')]['reboot']();}catch(_0x3cc88b){console[a18_0x5f1f('0x21')](_0x3cc88b);}}}[a18_0x5f1f('0x4c')](_0xb144be){if(_0xb144be==a18_0x5f1f('0x4f')||_0xb144be==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){console[a18_0x5f1f('0x21')]('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a18_0x5f1f('0x60')]();}catch(_0x32f5c5){console[a18_0x5f1f('0x21')](_0x32f5c5);}}}['handleTurnOnTVRequest'](_0x5b2a38){if(_0x5b2a38==a18_0x5f1f('0x4f')||_0x5b2a38==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x61'));try{this['syncPlaylistsService']['turnOnTV']();}catch(_0x3b181e){console['log'](_0x3b181e);}}}[a18_0x5f1f('0x4d')](_0x15cfe8){if(_0x15cfe8==a18_0x5f1f('0x4f')||_0x15cfe8==String(this[a18_0x5f1f('0x51')][a18_0x5f1f('0x50')])){console['log'](a18_0x5f1f('0x62'));try{this[a18_0x5f1f('0x51')]['turnOffTV']();}catch(_0x21c051){console['log'](_0x21c051);}}}[a18_0x5f1f('0x63')](){console['log'](a18_0x5f1f('0x64'),this[a18_0x5f1f('0xc')]);this['mqttClient'][a18_0x5f1f('0x25')](a18_0x5f1f('0x65'),this['syncPlaylistsService'][a18_0x5f1f('0x50')]+'-'+this['state']);}[a18_0x5f1f('0x46')](_0xe588d){if(this[a18_0x5f1f('0xc')]!==a18_0x5f1f('0x66')&&this[a18_0x5f1f('0xc')]!==a18_0x5f1f('0x67')){console[a18_0x5f1f('0x21')](a18_0x5f1f('0x68'));this['state']=a18_0x5f1f('0x67');this[a18_0x5f1f('0x63')]();setTimeout(()=>{this['state']='open';this['sendStateUpdate']();},0x1388);}}[a18_0x5f1f('0x47')](_0x577629){if(this['state']!==a18_0x5f1f('0x69')&&this[a18_0x5f1f('0xc')]!==a18_0x5f1f('0x6a')){this[a18_0x5f1f('0xc')]=a18_0x5f1f('0x6a');this[a18_0x5f1f('0x63')]();setTimeout(()=>{this[a18_0x5f1f('0xc')]=a18_0x5f1f('0x69');this[a18_0x5f1f('0x63')]();},0x1388);}}['handleAppExit'](_0x4c8d6d,_0x34a1f0){if(_0x34a1f0){console[a18_0x5f1f('0x21')](_0x34a1f0['stack']);}this[a18_0x5f1f('0x36')][a18_0x5f1f('0x25')](a18_0x5f1f('0x6b'),a18_0x5f1f('0x6c'));}[a18_0x5f1f('0x19')](_0x27cd77,_0x3dfbf6,_0x10b02a){const _0x2810d0={'iat':Math[a18_0x5f1f('0x1b')](Date[a18_0x5f1f('0x6d')]()/0x3e8),'exp':Math[a18_0x5f1f('0x1b')](Date[a18_0x5f1f('0x6d')]()/0x3e8)+0x14*0x3c,'aud':_0x27cd77};const _0x494d8a=fs[a18_0x5f1f('0x6e')](_0x3dfbf6);return jwt[a18_0x5f1f('0x6f')](_0x2810d0,_0x494d8a,{'algorithm':_0x10b02a});}}exports['MqttService']=MqttService;