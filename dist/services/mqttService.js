var a20_0x56ed=['publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','mqttInit_mosquitto','clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','player/turn_on_tv','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','round','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/locations/','/registries/','/devices/','createJwt','TLSv1_2_method','now','connect','/config','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish'];(function(_0x5c94be,_0x2b4c72){var _0x2f680a=function(_0x4cbae8){while(--_0x4cbae8){_0x5c94be['push'](_0x5c94be['shift']());}};_0x2f680a(++_0x2b4c72);}(a20_0x56ed,0x142));var a20_0x570c=function(_0xbf0ba8,_0x26a256){_0xbf0ba8=_0xbf0ba8-0x0;var _0x54de09=a20_0x56ed[_0xbf0ba8];return _0x54de09;};'use strict';Object[a20_0x570c('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x570c('0x1'));const fs=require('fs');const fsExtra=require(a20_0x570c('0x2'));const request=require(a20_0x570c('0x3'));const progress=require(a20_0x570c('0x4'));const spawn=require(a20_0x570c('0x5'))['spawn'];const exec=require(a20_0x570c('0x5'))[a20_0x570c('0x6')];const isImage=require(a20_0x570c('0x7'));const format=require(a20_0x570c('0x8'));const os=require('os');const mqtt=require(a20_0x570c('0x9'));const uuidv4=require(a20_0x570c('0xa'));const jwt=require(a20_0x570c('0xb'));class MqttService{constructor(_0x741a94){this[a20_0x570c('0xc')]=_0x741a94;this[a20_0x570c('0xd')]=a20_0x570c('0xe');this[a20_0x570c('0xf')]=new HttpClientService_1['HttpClientService']();}[a20_0x570c('0x10')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console[a20_0x570c('0x11')](a20_0x570c('0x12'));const _0xe4c857=a20_0x570c('0x13');const _0x163b5a=a20_0x570c('0x14');const _0x2dbce4=a20_0x570c('0x15');const _0x10e37e='us-central1';const _0x19e3a0=a20_0x570c('0x16');const _0x300f06=a20_0x570c('0x17');const _0x1cfc94=a20_0x570c('0x18');const _0x43184a=0x1bb;const _0x4db5e8=a20_0x570c('0x19');const _0x2a7c79=0x5;const _0x2b51bd='projects/'+_0xe4c857+a20_0x570c('0x1a')+_0x10e37e+a20_0x570c('0x1b')+_0x2dbce4+a20_0x570c('0x1c')+_0x163b5a;const _0x1b6999={'host':_0x1cfc94,'port':_0x43184a,'clientId':_0x2b51bd,'username':'unused','password':this[a20_0x570c('0x1d')](_0xe4c857,_0x300f06,_0x19e3a0),'protocol':'mqtts','secureProtocol':a20_0x570c('0x1e')};const _0x2e1d87=Math['round'](Date[a20_0x570c('0x1f')]()/0x3e8);const _0x5a55d6=mqtt[a20_0x570c('0x20')](_0x1b6999);_0x5a55d6['subscribe']('/devices/'+_0x163b5a+a20_0x570c('0x21'),{'qos':0x1});_0x5a55d6[a20_0x570c('0x22')](a20_0x570c('0x1c')+_0x163b5a+a20_0x570c('0x23'),{'qos':0x1});_0x5a55d6['subscribe'](a20_0x570c('0x1c')+_0x163b5a+a20_0x570c('0x24'),{'qos':0x0});const _0x48f4ad='/devices/'+_0x163b5a+'/'+_0x4db5e8;_0x5a55d6['on'](a20_0x570c('0x20'),_0x246bc9=>{console[a20_0x570c('0x11')](a20_0x570c('0x20'));if(!_0x246bc9){console[a20_0x570c('0x11')](a20_0x570c('0x25'));}else{const _0x48f4ad=a20_0x570c('0x26');const _0xebb43d=_0x2dbce4+'/'+_0x163b5a+a20_0x570c('0x27');_0x5a55d6[a20_0x570c('0x28')](_0x48f4ad,_0xebb43d,{'qos':0x1},_0x2b95cd=>{console[a20_0x570c('0x11')](a20_0x570c('0x29'));console['log'](_0x2b95cd);if(!_0x2b95cd){}});}});_0x5a55d6['on'](a20_0x570c('0x2a'),()=>{console[a20_0x570c('0x11')](a20_0x570c('0x2a'));});_0x5a55d6['on'](a20_0x570c('0x2b'),_0x3b805a=>{console['log'](a20_0x570c('0x2b'),_0x3b805a);});_0x5a55d6['on'](a20_0x570c('0x2c'),(_0x375f5e,_0x8aa7b)=>{let _0x856117=a20_0x570c('0x2d');console[a20_0x570c('0x11')](_0x375f5e);console['log'](_0x8aa7b+'');if(_0x375f5e==='/devices/'+_0x163b5a+'/config'){_0x856117=a20_0x570c('0x2e');}else if(_0x375f5e['startsWith'](a20_0x570c('0x1c')+_0x163b5a+a20_0x570c('0x2f'))){_0x856117=a20_0x570c('0x30');}_0x856117+=Buffer[a20_0x570c('0x31')](_0x8aa7b,a20_0x570c('0x32'))['toString'](a20_0x570c('0x33'));console[a20_0x570c('0x11')](_0x856117);});_0x5a55d6['on'](a20_0x570c('0x34'),()=>{});console[a20_0x570c('0x11')](_0x1b6999);}[a20_0x570c('0x35')](){console[a20_0x570c('0x11')]('mqttInit');this[a20_0x570c('0x36')]=uuidv4();console[a20_0x570c('0x11')]('this.clientId');console[a20_0x570c('0x11')](this[a20_0x570c('0x36')]);const _0x32975e={'clientId':this[a20_0x570c('0x36')],'username':a20_0x570c('0x37'),'password':a20_0x570c('0x38'),'clean':!![]};this['mqttClient']=mqtt[a20_0x570c('0x20')](a20_0x570c('0x39'),_0x32975e);this[a20_0x570c('0x3a')]['on'](a20_0x570c('0x20'),this[a20_0x570c('0x3b')][a20_0x570c('0x3c')](this));this[a20_0x570c('0x3a')]['on'](a20_0x570c('0x2c'),this[a20_0x570c('0x3d')][a20_0x570c('0x3c')](this));this[a20_0x570c('0x3a')]['on'](a20_0x570c('0x2a'),()=>{console[a20_0x570c('0x11')](a20_0x570c('0x2a'));});process['on'](a20_0x570c('0x3e'),this[a20_0x570c('0x3f')][a20_0x570c('0x3c')](this));process['on'](a20_0x570c('0x40'),this[a20_0x570c('0x3f')][a20_0x570c('0x3c')](this));process['on'](a20_0x570c('0x41'),this[a20_0x570c('0x3f')]['bind'](this));}[a20_0x570c('0x3b')](){console[a20_0x570c('0x11')](a20_0x570c('0x42')+this[a20_0x570c('0x36')]);this[a20_0x570c('0x3a')][a20_0x570c('0x22')](a20_0x570c('0x43'));this[a20_0x570c('0x3a')]['subscribe'](a20_0x570c('0x44'));this['mqttClient'][a20_0x570c('0x22')](a20_0x570c('0x45'),{'qos':0x2});this[a20_0x570c('0x3a')]['subscribe']('player/load_playlist',{'qos':0x2});this[a20_0x570c('0x3a')][a20_0x570c('0x22')](a20_0x570c('0x46'),{'qos':0x2});this[a20_0x570c('0x3a')]['subscribe'](a20_0x570c('0x47'),{'qos':0x2});this[a20_0x570c('0x3a')][a20_0x570c('0x22')](a20_0x570c('0x48'),{'qos':0x2});this['mqttClient'][a20_0x570c('0x22')](a20_0x570c('0x49'),{'qos':0x2});this[a20_0x570c('0x3a')]['subscribe'](a20_0x570c('0x4a'),{'qos':0x2});this[a20_0x570c('0x3a')][a20_0x570c('0x22')](a20_0x570c('0x4b'),{'qos':0x2});this['mqttClient'][a20_0x570c('0x22')]('player/turn_on_tv',{'qos':0x2});}[a20_0x570c('0x4c')](){}[a20_0x570c('0x3d')](_0xc9dfd3,_0x34ef04){console[a20_0x570c('0x11')](a20_0x570c('0x4d'),_0xc9dfd3,_0x34ef04);switch(_0xc9dfd3){case'player/open':return this[a20_0x570c('0x4e')](_0x34ef04);case a20_0x570c('0x44'):return this[a20_0x570c('0x4f')](_0x34ef04);case a20_0x570c('0x45'):return this['handleRebootRequest'](_0x34ef04);case'player/reload_playlist':return this[a20_0x570c('0x50')](_0x34ef04);case'player/load_playlist':return this[a20_0x570c('0x51')](_0x34ef04);case a20_0x570c('0x47'):return this['handleUpdateRequest'](_0x34ef04);case a20_0x570c('0x48'):return this[a20_0x570c('0x52')](_0x34ef04);case'player/register':return this[a20_0x570c('0x53')](_0x34ef04);case a20_0x570c('0x4a'):return this[a20_0x570c('0x54')](_0x34ef04);case a20_0x570c('0x4b'):return this[a20_0x570c('0x55')](_0x34ef04);case a20_0x570c('0x56'):return this[a20_0x570c('0x57')](_0x34ef04);}}[a20_0x570c('0x53')](_0x1864b6){if(_0x1864b6==a20_0x570c('0x58')||_0x1864b6==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){this[a20_0x570c('0xc')][a20_0x570c('0x5a')]();}}[a20_0x570c('0x52')](_0x1e7626){if(_0x1e7626==a20_0x570c('0x58')||_0x1e7626==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){}}[a20_0x570c('0x5b')](_0x55a5a8){console[a20_0x570c('0x11')](a20_0x570c('0x5c')+_0x55a5a8);if(_0x55a5a8==a20_0x570c('0x58')||_0x55a5a8==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){const _0x27fdfa=__dirname;const _0xaeca2e=require(a20_0x570c('0x5d'))(_0x27fdfa);console[a20_0x570c('0x11')](a20_0x570c('0x5e'));_0xaeca2e[a20_0x570c('0x5f')]((_0x4dd342,_0xe25502)=>{if(_0x4dd342){console[a20_0x570c('0x11')](a20_0x570c('0x60'));this['handleUpdateRequest'](_0x55a5a8);return;}else{}console[a20_0x570c('0x11')](a20_0x570c('0x61'));console[a20_0x570c('0x11')](_0xe25502);if(_0xe25502&&_0xe25502[a20_0x570c('0x62')][a20_0x570c('0x63')]){this['syncPlaylistsService']['reboot']();}else{}});}}[a20_0x570c('0x51')](_0x58cfdf){if(_0x58cfdf==a20_0x570c('0x58')||_0x58cfdf==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){this[a20_0x570c('0xc')]['loadMediaList']();}}[a20_0x570c('0x50')](_0x44eac5){if(String(_0x44eac5)==a20_0x570c('0x58')||String(_0x44eac5)==String(this[a20_0x570c('0xc')]['playerId'])){this[a20_0x570c('0xc')][a20_0x570c('0x64')]();}}[a20_0x570c('0x65')](_0x53a644){if(_0x53a644=='all'||_0x53a644==String(this[a20_0x570c('0xc')]['playerId'])){console[a20_0x570c('0x11')](a20_0x570c('0x66'));try{this[a20_0x570c('0xc')][a20_0x570c('0x67')]();}catch(_0xea8d2e){console[a20_0x570c('0x11')](_0xea8d2e);}}}[a20_0x570c('0x54')](_0x1979fc){if(_0x1979fc=='all'||_0x1979fc==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){console[a20_0x570c('0x11')]('handleUpdateSettingsRequest:\x20');try{this[a20_0x570c('0xc')][a20_0x570c('0x68')]();}catch(_0x21def8){console[a20_0x570c('0x11')](_0x21def8);}}}[a20_0x570c('0x57')](_0x5399b2){if(_0x5399b2=='all'||_0x5399b2==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){console[a20_0x570c('0x11')](a20_0x570c('0x69'));try{this[a20_0x570c('0xc')][a20_0x570c('0x6a')]();}catch(_0x3f922c){console[a20_0x570c('0x11')](_0x3f922c);}}}[a20_0x570c('0x55')](_0x1fc953){if(_0x1fc953=='all'||_0x1fc953==String(this[a20_0x570c('0xc')][a20_0x570c('0x59')])){console[a20_0x570c('0x11')](a20_0x570c('0x6b'));try{this[a20_0x570c('0xc')][a20_0x570c('0x6c')]();}catch(_0x1f2c48){console[a20_0x570c('0x11')](_0x1f2c48);}}}[a20_0x570c('0x6d')](){console[a20_0x570c('0x11')](a20_0x570c('0x6e'),this['state']);this[a20_0x570c('0x3a')][a20_0x570c('0x28')]('player/state',this[a20_0x570c('0xc')][a20_0x570c('0x59')]+'-'+this[a20_0x570c('0xd')]);}[a20_0x570c('0x4e')](_0x543b27){if(this[a20_0x570c('0xd')]!==a20_0x570c('0x6f')&&this[a20_0x570c('0xd')]!==a20_0x570c('0x70')){console[a20_0x570c('0x11')](a20_0x570c('0x71'));this['state']=a20_0x570c('0x70');this[a20_0x570c('0x6d')]();setTimeout(()=>{this[a20_0x570c('0xd')]=a20_0x570c('0x6f');this[a20_0x570c('0x6d')]();},0x1388);}}[a20_0x570c('0x4f')](_0x296e8c){if(this['state']!=='closed'&&this[a20_0x570c('0xd')]!=='closing'){this[a20_0x570c('0xd')]=a20_0x570c('0x72');this[a20_0x570c('0x6d')]();setTimeout(()=>{this[a20_0x570c('0xd')]='closed';this['sendStateUpdate']();},0x1388);}}[a20_0x570c('0x3f')](_0x11844c,_0x40342e){if(_0x40342e){console[a20_0x570c('0x11')](_0x40342e[a20_0x570c('0x73')]);}this[a20_0x570c('0x3a')][a20_0x570c('0x28')](a20_0x570c('0x74'),a20_0x570c('0x75'));}[a20_0x570c('0x1d')](_0x247577,_0x446259,_0x3551e7){const _0x2467af={'iat':Math['round'](Date[a20_0x570c('0x1f')]()/0x3e8),'exp':Math[a20_0x570c('0x76')](Date[a20_0x570c('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x247577};const _0x22b312=fs['readFileSync'](_0x446259);return jwt[a20_0x570c('0x77')](_0x2467af,_0x22b312,{'algorithm':_0x3551e7});}}exports[a20_0x570c('0x78')]=MqttService;