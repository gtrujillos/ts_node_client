var a20_0xf3cb=['handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening\x20player\x20door','opening','closing','publish','player/connected','false','round','readFileSync','sign','MqttService','__esModule','request','request-progress','child_process','spawn','exec','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','events','projects/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','now','subscribe','/config','/state','connect','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','from','toString','ascii','packetsend','mqttInit_mosquitto','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','bind','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','handleLoadPlaylistRequest','handleReloadPlaylistRequest','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings'];(function(_0x22aaf3,_0x3250c6){var _0x1636da=function(_0x1ccc28){while(--_0x1ccc28){_0x22aaf3['push'](_0x22aaf3['shift']());}};_0x1636da(++_0x3250c6);}(a20_0xf3cb,0x17d));var a20_0x41fe=function(_0x7e15f,_0x1f5b49){_0x7e15f=_0x7e15f-0x0;var _0x289248=a20_0xf3cb[_0x7e15f];return _0x289248;};'use strict';Object['defineProperty'](exports,a20_0x41fe('0x0'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0x41fe('0x1'));const progress=require(a20_0x41fe('0x2'));const spawn=require(a20_0x41fe('0x3'))[a20_0x41fe('0x4')];const exec=require(a20_0x41fe('0x3'))[a20_0x41fe('0x5')];const isImage=require('is-image');const format=require(a20_0x41fe('0x6'));const os=require('os');const mqtt=require(a20_0x41fe('0x7'));const uuidv4=require(a20_0x41fe('0x8'));const jwt=require(a20_0x41fe('0x9'));class MqttService{constructor(_0x5615de){this[a20_0x41fe('0xa')]=_0x5615de;this[a20_0x41fe('0xb')]=a20_0x41fe('0xc');this[a20_0x41fe('0xd')]=new HttpClientService_1[(a20_0x41fe('0xe'))]();}[a20_0x41fe('0xf')](){this['mqttInit_mosquitto']();}[a20_0x41fe('0x10')](){console['log'](a20_0x41fe('0x11'));const _0x68416a=a20_0x41fe('0x12');const _0x1a688d=a20_0x41fe('0x13');const _0x5e7c61='my-registry';const _0xeabe51=a20_0x41fe('0x14');const _0x470a6d=a20_0x41fe('0x15');const _0x4867f1=a20_0x41fe('0x16');const _0x2ee9e2='mqtt.googleapis.com';const _0x4545d9=0x1bb;const _0x56ba5c=a20_0x41fe('0x17');const _0x3c31c7=0x5;const _0x8652e4=a20_0x41fe('0x18')+_0x68416a+'/locations/'+_0xeabe51+a20_0x41fe('0x19')+_0x5e7c61+a20_0x41fe('0x1a')+_0x1a688d;const _0x14ab77={'host':_0x2ee9e2,'port':_0x4545d9,'clientId':_0x8652e4,'username':a20_0x41fe('0x1b'),'password':this[a20_0x41fe('0x1c')](_0x68416a,_0x4867f1,_0x470a6d),'protocol':a20_0x41fe('0x1d'),'secureProtocol':a20_0x41fe('0x1e')};const _0x4f055=Math['round'](Date[a20_0x41fe('0x1f')]()/0x3e8);const _0x5e9e3c=mqtt['connect'](_0x14ab77);_0x5e9e3c[a20_0x41fe('0x20')](a20_0x41fe('0x1a')+_0x1a688d+a20_0x41fe('0x21'),{'qos':0x1});_0x5e9e3c[a20_0x41fe('0x20')](a20_0x41fe('0x1a')+_0x1a688d+a20_0x41fe('0x22'),{'qos':0x1});_0x5e9e3c[a20_0x41fe('0x20')](a20_0x41fe('0x1a')+_0x1a688d+'/commands/#',{'qos':0x0});const _0x911bfa='/devices/'+_0x1a688d+'/'+_0x56ba5c;_0x5e9e3c['on'](a20_0x41fe('0x23'),_0x1e08f8=>{console[a20_0x41fe('0x24')]('connect');if(!_0x1e08f8){console[a20_0x41fe('0x24')](a20_0x41fe('0x25'));}else{const _0x911bfa=a20_0x41fe('0x26');const _0x264b85=_0x5e7c61+'/'+_0x1a688d+a20_0x41fe('0x27');_0x5e9e3c['publish'](_0x911bfa,_0x264b85,{'qos':0x1},_0x44ba94=>{console[a20_0x41fe('0x24')]('publish\x20result:');console['log'](_0x44ba94);if(!_0x44ba94){}});}});_0x5e9e3c['on'](a20_0x41fe('0x28'),()=>{console[a20_0x41fe('0x24')](a20_0x41fe('0x28'));});_0x5e9e3c['on'](a20_0x41fe('0x29'),_0x249978=>{console[a20_0x41fe('0x24')]('error',_0x249978);});_0x5e9e3c['on'](a20_0x41fe('0x2a'),(_0x34e865,_0x1e316d)=>{let _0x5cb61e=a20_0x41fe('0x2b');console[a20_0x41fe('0x24')](_0x34e865);console[a20_0x41fe('0x24')](_0x1e316d+'');if(_0x34e865===a20_0x41fe('0x1a')+_0x1a688d+a20_0x41fe('0x21')){_0x5cb61e=a20_0x41fe('0x2c');}else if(_0x34e865[a20_0x41fe('0x2d')]('/devices/'+_0x1a688d+a20_0x41fe('0x2e'))){_0x5cb61e='Command\x20message\x20received:\x20';}_0x5cb61e+=Buffer[a20_0x41fe('0x2f')](_0x1e316d,'base64')[a20_0x41fe('0x30')](a20_0x41fe('0x31'));console[a20_0x41fe('0x24')](_0x5cb61e);});_0x5e9e3c['on'](a20_0x41fe('0x32'),()=>{});console[a20_0x41fe('0x24')](_0x14ab77);}[a20_0x41fe('0x33')](){console[a20_0x41fe('0x24')](a20_0x41fe('0x11'));this['clientId']=uuidv4();console[a20_0x41fe('0x24')](a20_0x41fe('0x34'));console[a20_0x41fe('0x24')](this['clientId']);const _0x5d207d={'clientId':this[a20_0x41fe('0x35')],'username':a20_0x41fe('0x36'),'password':a20_0x41fe('0x37'),'clean':!![]};this[a20_0x41fe('0x38')]=mqtt[a20_0x41fe('0x23')]('mqtt://lulo.run',_0x5d207d);this[a20_0x41fe('0x38')]['on'](a20_0x41fe('0x23'),this['mqttClient_connect'][a20_0x41fe('0x39')](this));this[a20_0x41fe('0x38')]['on'](a20_0x41fe('0x2a'),this['mqttClient_message']['bind'](this));this['mqttClient']['on'](a20_0x41fe('0x28'),()=>{console[a20_0x41fe('0x24')](a20_0x41fe('0x28'));});process['on'](a20_0x41fe('0x3a'),this[a20_0x41fe('0x3b')][a20_0x41fe('0x39')](this));process['on'](a20_0x41fe('0x3c'),this['handleAppExit'][a20_0x41fe('0x39')](this));process['on'](a20_0x41fe('0x3d'),this['handleAppExit'][a20_0x41fe('0x39')](this));}[a20_0x41fe('0x3e')](){console[a20_0x41fe('0x24')](a20_0x41fe('0x3f')+this[a20_0x41fe('0x35')]);this[a20_0x41fe('0x38')][a20_0x41fe('0x20')](a20_0x41fe('0x40'));this[a20_0x41fe('0x38')][a20_0x41fe('0x20')](a20_0x41fe('0x41'));this[a20_0x41fe('0x38')][a20_0x41fe('0x20')](a20_0x41fe('0x42'),{'qos':0x2});this[a20_0x41fe('0x38')][a20_0x41fe('0x20')](a20_0x41fe('0x43'),{'qos':0x2});this[a20_0x41fe('0x38')]['subscribe'](a20_0x41fe('0x44'),{'qos':0x2});this[a20_0x41fe('0x38')]['subscribe'](a20_0x41fe('0x45'),{'qos':0x2});this['mqttClient'][a20_0x41fe('0x20')](a20_0x41fe('0x46'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x41fe('0x47'),{'qos':0x2});this['mqttClient'][a20_0x41fe('0x20')](a20_0x41fe('0x48'),{'qos':0x2});this['mqttClient'][a20_0x41fe('0x20')](a20_0x41fe('0x49'),{'qos':0x2});this[a20_0x41fe('0x38')][a20_0x41fe('0x20')](a20_0x41fe('0x4a'),{'qos':0x2});}[a20_0x41fe('0x4b')](){}[a20_0x41fe('0x4c')](_0x34fb8f,_0x413bfd){console[a20_0x41fe('0x24')](a20_0x41fe('0x4d'),_0x34fb8f,_0x413bfd);switch(_0x34fb8f){case'player/open':return this[a20_0x41fe('0x4e')](_0x413bfd);case'player/close':return this[a20_0x41fe('0x4f')](_0x413bfd);case a20_0x41fe('0x42'):return this['handleRebootRequest'](_0x413bfd);case a20_0x41fe('0x44'):return this['handleReloadPlaylistRequest'](_0x413bfd);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0x413bfd);case a20_0x41fe('0x45'):return this[a20_0x41fe('0x50')](_0x413bfd);case a20_0x41fe('0x46'):return this[a20_0x41fe('0x51')](_0x413bfd);case a20_0x41fe('0x47'):return this[a20_0x41fe('0x52')](_0x413bfd);case a20_0x41fe('0x48'):return this[a20_0x41fe('0x53')](_0x413bfd);case a20_0x41fe('0x49'):return this[a20_0x41fe('0x54')](_0x413bfd);case'player/turn_on_tv':return this[a20_0x41fe('0x55')](_0x413bfd);}}['handleRegisterRequest'](_0x1b0a99){if(_0x1b0a99==a20_0x41fe('0x56')||_0x1b0a99==String(this['syncPlaylistsService'][a20_0x41fe('0x57')])){this[a20_0x41fe('0xa')][a20_0x41fe('0x58')]();}}[a20_0x41fe('0x51')](_0x57b912){if(_0x57b912==a20_0x41fe('0x56')||_0x57b912==String(this[a20_0x41fe('0xa')]['playerId'])){}}['handleUpdateRequest'](_0x4226af){console[a20_0x41fe('0x24')](a20_0x41fe('0x59')+_0x4226af);if(_0x4226af==a20_0x41fe('0x56')||_0x4226af==String(this[a20_0x41fe('0xa')][a20_0x41fe('0x57')])){const _0x3ae731=__dirname;const _0x240cf5=require('simple-git')(_0x3ae731);console[a20_0x41fe('0x24')](a20_0x41fe('0x5a'));_0x240cf5[a20_0x41fe('0x5b')]((_0x2e7881,_0x3c6cab)=>{if(_0x2e7881){console[a20_0x41fe('0x24')](a20_0x41fe('0x5c'));this[a20_0x41fe('0x50')](_0x4226af);return;}else{}console['log'](a20_0x41fe('0x5d'));console['log'](_0x3c6cab);if(_0x3c6cab&&_0x3c6cab[a20_0x41fe('0x5e')][a20_0x41fe('0x5f')]){this[a20_0x41fe('0xa')][a20_0x41fe('0x60')]();}else{}});}}[a20_0x41fe('0x61')](_0x4d6177){if(_0x4d6177==a20_0x41fe('0x56')||_0x4d6177==String(this[a20_0x41fe('0xa')]['playerId'])){this[a20_0x41fe('0xa')]['loadMediaList']();}}[a20_0x41fe('0x62')](_0x30f7aa){if(String(_0x30f7aa)==a20_0x41fe('0x56')||String(_0x30f7aa)==String(this['syncPlaylistsService'][a20_0x41fe('0x57')])){this[a20_0x41fe('0xa')]['reloadMediaList']();}}[a20_0x41fe('0x63')](_0x2bf9cb){if(_0x2bf9cb=='all'||_0x2bf9cb==String(this[a20_0x41fe('0xa')]['playerId'])){console[a20_0x41fe('0x24')](a20_0x41fe('0x64'));try{this[a20_0x41fe('0xa')][a20_0x41fe('0x60')]();}catch(_0x12886e){console['log'](_0x12886e);}}}[a20_0x41fe('0x53')](_0x202561){if(_0x202561==a20_0x41fe('0x56')||_0x202561==String(this[a20_0x41fe('0xa')]['playerId'])){console['log'](a20_0x41fe('0x65'));try{this[a20_0x41fe('0xa')][a20_0x41fe('0x66')]();}catch(_0x1fce00){console[a20_0x41fe('0x24')](_0x1fce00);}}}['handleTurnOnTVRequest'](_0x3eaf1e){if(_0x3eaf1e==a20_0x41fe('0x56')||_0x3eaf1e==String(this[a20_0x41fe('0xa')][a20_0x41fe('0x57')])){console[a20_0x41fe('0x24')](a20_0x41fe('0x67'));try{this[a20_0x41fe('0xa')][a20_0x41fe('0x68')]();}catch(_0x53fdca){console[a20_0x41fe('0x24')](_0x53fdca);}}}[a20_0x41fe('0x54')](_0x2bdb13){if(_0x2bdb13==a20_0x41fe('0x56')||_0x2bdb13==String(this['syncPlaylistsService'][a20_0x41fe('0x57')])){console[a20_0x41fe('0x24')](a20_0x41fe('0x69'));try{this[a20_0x41fe('0xa')][a20_0x41fe('0x6a')]();}catch(_0x2ba4b0){console[a20_0x41fe('0x24')](_0x2ba4b0);}}}[a20_0x41fe('0x6b')](){console[a20_0x41fe('0x24')](a20_0x41fe('0x6c'),this[a20_0x41fe('0xb')]);this[a20_0x41fe('0x38')]['publish'](a20_0x41fe('0x6d'),this[a20_0x41fe('0xa')][a20_0x41fe('0x57')]+'-'+this['state']);}[a20_0x41fe('0x4e')](_0x5ecc64){if(this[a20_0x41fe('0xb')]!==a20_0x41fe('0x6e')&&this[a20_0x41fe('0xb')]!=='opening'){console[a20_0x41fe('0x24')](a20_0x41fe('0x6f'));this[a20_0x41fe('0xb')]=a20_0x41fe('0x70');this[a20_0x41fe('0x6b')]();setTimeout(()=>{this['state']=a20_0x41fe('0x6e');this[a20_0x41fe('0x6b')]();},0x1388);}}[a20_0x41fe('0x4f')](_0x2d5af1){if(this['state']!==a20_0x41fe('0xc')&&this[a20_0x41fe('0xb')]!==a20_0x41fe('0x71')){this[a20_0x41fe('0xb')]=a20_0x41fe('0x71');this[a20_0x41fe('0x6b')]();setTimeout(()=>{this['state']=a20_0x41fe('0xc');this[a20_0x41fe('0x6b')]();},0x1388);}}[a20_0x41fe('0x3b')](_0x283142,_0x5bce69){if(_0x5bce69){console['log'](_0x5bce69['stack']);}this[a20_0x41fe('0x38')][a20_0x41fe('0x72')](a20_0x41fe('0x73'),a20_0x41fe('0x74'));}['createJwt'](_0x484c3c,_0x1dd622,_0x3ab4d9){const _0x17fc71={'iat':Math[a20_0x41fe('0x75')](Date[a20_0x41fe('0x1f')]()/0x3e8),'exp':Math[a20_0x41fe('0x75')](Date[a20_0x41fe('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x484c3c};const _0x1d57ac=fs[a20_0x41fe('0x76')](_0x1dd622);return jwt[a20_0x41fe('0x77')](_0x17fc71,_0x1d57ac,{'algorithm':_0x3ab4d9});}}exports[a20_0x41fe('0x78')]=MqttService;