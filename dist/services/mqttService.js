var a18_0x3925=['changes','shutdown','now','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','open','opening\x20player\x20door','opening','closing','stack','MqttService','defineProperty','./../infrastructure/HttpClientService','child_process','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','log','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','connect','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/load_playlist','player/update','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','playerId','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated'];(function(_0x44e1a5,_0x467029){var _0x33de82=function(_0x2eca09){while(--_0x2eca09){_0x44e1a5['push'](_0x44e1a5['shift']());}};_0x33de82(++_0x467029);}(a18_0x3925,0x107));var a18_0x31b0=function(_0x3e8a4d,_0x2c7bef){_0x3e8a4d=_0x3e8a4d-0x0;var _0x573c97=a18_0x3925[_0x3e8a4d];return _0x573c97;};'use strict';Object[a18_0x31b0('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x31b0('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require('request-progress');const spawn=require(a18_0x31b0('0x2'))['spawn'];const isImage=require(a18_0x31b0('0x3'));const format=require(a18_0x31b0('0x4'));const os=require('os');const mqtt=require(a18_0x31b0('0x5'));const uuidv4=require(a18_0x31b0('0x6'));class MqttService{constructor(_0x586c74){this[a18_0x31b0('0x7')]=_0x586c74;this[a18_0x31b0('0x8')]=a18_0x31b0('0x9');this[a18_0x31b0('0xa')]=new HttpClientService_1[(a18_0x31b0('0xb'))]();}[a18_0x31b0('0xc')](){this[a18_0x31b0('0xd')]();}['mqttInit'](){console[a18_0x31b0('0xe')]('mqttInit');this['clientId']=uuidv4();console['log'](a18_0x31b0('0xf'));console[a18_0x31b0('0xe')](this[a18_0x31b0('0x10')]);const _0x59ff6f={'clientId':this[a18_0x31b0('0x10')],'username':a18_0x31b0('0x11'),'password':a18_0x31b0('0x12'),'clean':!![]};this['mqttClient']=mqtt[a18_0x31b0('0x13')](a18_0x31b0('0x14'),_0x59ff6f);this[a18_0x31b0('0x15')]['on'](a18_0x31b0('0x13'),this[a18_0x31b0('0x16')][a18_0x31b0('0x17')](this));this['mqttClient']['on']('message',this['mqttClient_message'][a18_0x31b0('0x17')](this));process['on']('exit',this[a18_0x31b0('0x18')][a18_0x31b0('0x17')](this));process['on']('SIGINT',this[a18_0x31b0('0x18')][a18_0x31b0('0x17')](this));process['on'](a18_0x31b0('0x19'),this[a18_0x31b0('0x18')][a18_0x31b0('0x17')](this));}['mqttClient_connect'](){console[a18_0x31b0('0xe')](a18_0x31b0('0x1a')+this[a18_0x31b0('0x10')]);this[a18_0x31b0('0x15')]['subscribe']('player/open');this['mqttClient'][a18_0x31b0('0x1b')](a18_0x31b0('0x1c'));this[a18_0x31b0('0x15')][a18_0x31b0('0x1b')]('player/reboot',{'qos':0x2});this[a18_0x31b0('0x15')][a18_0x31b0('0x1b')](a18_0x31b0('0x1d'),{'qos':0x2});this['mqttClient'][a18_0x31b0('0x1b')]('player/reload_playlist',{'qos':0x2});this[a18_0x31b0('0x15')][a18_0x31b0('0x1b')](a18_0x31b0('0x1e'),{'qos':0x2});}[a18_0x31b0('0x1f')](){}[a18_0x31b0('0x20')](_0x2caec5,_0x35c0b0){console[a18_0x31b0('0xe')](a18_0x31b0('0x21'),_0x2caec5,_0x35c0b0);switch(_0x2caec5){case a18_0x31b0('0x22'):return this[a18_0x31b0('0x23')](_0x35c0b0);case a18_0x31b0('0x1c'):return this[a18_0x31b0('0x24')](_0x35c0b0);case'player/reboot':return this[a18_0x31b0('0x25')](_0x35c0b0);case'player/reload_playlist':return this[a18_0x31b0('0x26')](_0x35c0b0);case a18_0x31b0('0x1d'):return this[a18_0x31b0('0x27')](_0x35c0b0);case a18_0x31b0('0x1e'):return this[a18_0x31b0('0x28')](_0x35c0b0);}}[a18_0x31b0('0x28')](_0x300718){if(_0x300718==a18_0x31b0('0x29')||_0x300718==String(this[a18_0x31b0('0x7')][a18_0x31b0('0x2a')])){const _0x25c91e=__dirname;const _0x27df03=require(a18_0x31b0('0x2b'))(_0x25c91e);console[a18_0x31b0('0xe')](a18_0x31b0('0x2c'));_0x27df03['pull']((_0x1e1440,_0x5e0bd1)=>{if(_0x1e1440){console['log'](a18_0x31b0('0x2d'));this[a18_0x31b0('0x28')](_0x300718);return;}else{}console[a18_0x31b0('0xe')](a18_0x31b0('0x2e'));console[a18_0x31b0('0xe')](_0x5e0bd1);if(_0x5e0bd1&&_0x5e0bd1['summary'][a18_0x31b0('0x2f')]){const _0x463ac8=spawn(a18_0x31b0('0x30'),['-r',a18_0x31b0('0x31')]);}else{}});}}[a18_0x31b0('0x27')](_0x2ce847){if(_0x2ce847==a18_0x31b0('0x29')||_0x2ce847==String(this[a18_0x31b0('0x7')][a18_0x31b0('0x2a')])){this[a18_0x31b0('0x7')][a18_0x31b0('0x32')]();}}[a18_0x31b0('0x26')](_0x3cd4b4){if(String(_0x3cd4b4)=='all'||String(_0x3cd4b4)==String(this[a18_0x31b0('0x7')][a18_0x31b0('0x2a')])){this[a18_0x31b0('0x7')][a18_0x31b0('0x33')]();}}[a18_0x31b0('0x25')](_0x2ce133){if(_0x2ce133=='all'||_0x2ce133==String(this[a18_0x31b0('0x7')][a18_0x31b0('0x2a')])){const _0x3899dd=spawn(a18_0x31b0('0x30'),['-r','now']);}}[a18_0x31b0('0x34')](){console[a18_0x31b0('0xe')](a18_0x31b0('0x35'),this[a18_0x31b0('0x8')]);this[a18_0x31b0('0x15')][a18_0x31b0('0x36')](a18_0x31b0('0x37'),this[a18_0x31b0('0x7')][a18_0x31b0('0x2a')]+'-'+this['state']);}['handleOpenRequest'](_0x188c39){if(this[a18_0x31b0('0x8')]!==a18_0x31b0('0x38')&&this[a18_0x31b0('0x8')]!=='opening'){console[a18_0x31b0('0xe')](a18_0x31b0('0x39'));this[a18_0x31b0('0x8')]=a18_0x31b0('0x3a');this[a18_0x31b0('0x34')]();setTimeout(()=>{this['state']=a18_0x31b0('0x38');this[a18_0x31b0('0x34')]();},0x1388);}}['handleCloseRequest'](_0x21dd42){if(this['state']!==a18_0x31b0('0x9')&&this[a18_0x31b0('0x8')]!=='closing'){this[a18_0x31b0('0x8')]=a18_0x31b0('0x3b');this[a18_0x31b0('0x34')]();setTimeout(()=>{this['state']='closed';this[a18_0x31b0('0x34')]();},0x1388);}}[a18_0x31b0('0x18')](_0x41d66c,_0x3715cf){if(_0x3715cf){console['log'](_0x3715cf[a18_0x31b0('0x3c')]);}this['mqttClient']['publish']('player/connected','false');}}exports[a18_0x31b0('0x3d')]=MqttService;