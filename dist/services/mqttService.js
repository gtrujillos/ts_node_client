var a17_0x13ba=['handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','shutdown','now','loadMediaList','reloadMediaList','sending\x20state\x20%s','publish','open','opening','opening\x20player\x20door','sendStateUpdate','closed','closing','stack','player/connected','false','MqttService','defineProperty','fs-extra','request','request-progress','spawn','is-image','string-template','uuid/v4','state','syncPlaylistsService','init','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','connect','bind','message','exit','handleAppExit','SIGINT','mqttClient_connect','subscribe','player/open','mqttClient','player/load_playlist','player/reload_playlist','player/update','registerClient','playerId','stringify','networkInterfaces','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','player/reboot'];(function(_0x2aeba8,_0x3b2582){var _0x585cdf=function(_0xd569c3){while(--_0xd569c3){_0x2aeba8['push'](_0x2aeba8['shift']());}};_0x585cdf(++_0x3b2582);}(a17_0x13ba,0xe0));var a17_0x377e=function(_0x3527ca,_0x2e4a29){_0x3527ca=_0x3527ca-0x0;var _0xca9db5=a17_0x13ba[_0x3527ca];return _0xca9db5;};'use strict';Object[a17_0x377e('0x0')](exports,'__esModule',{'value':!![]});const fs=require('fs');const fsExtra=require(a17_0x377e('0x1'));const request=require(a17_0x377e('0x2'));const progress=require(a17_0x377e('0x3'));const spawn=require('child_process')[a17_0x377e('0x4')];const isImage=require(a17_0x377e('0x5'));const format=require(a17_0x377e('0x6'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a17_0x377e('0x7'));class MqttService{constructor(_0x226e74){this[a17_0x377e('0x8')]='closed';this[a17_0x377e('0x9')]=_0x226e74;}[a17_0x377e('0xa')](){this[a17_0x377e('0xb')]();}[a17_0x377e('0xb')](){console[a17_0x377e('0xc')](a17_0x377e('0xb'));this[a17_0x377e('0xd')]=uuidv4();const _0x35ed7d={'clientId':this[a17_0x377e('0xd')],'username':a17_0x377e('0xe'),'password':a17_0x377e('0xf'),'clean':!![]};this['mqttClient']=mqtt['connect'](a17_0x377e('0x10'),_0x35ed7d);this['mqttClient']['on'](a17_0x377e('0x11'),this['mqttClient_connect'][a17_0x377e('0x12')](this));this['mqttClient']['on'](a17_0x377e('0x13'),this['mqttClient_message'][a17_0x377e('0x12')](this));process['on'](a17_0x377e('0x14'),this[a17_0x377e('0x15')]['bind'](this));process['on'](a17_0x377e('0x16'),this[a17_0x377e('0x15')]['bind'](this));process['on']('uncaughtException',this[a17_0x377e('0x15')][a17_0x377e('0x12')](this));}[a17_0x377e('0x17')](){console[a17_0x377e('0xc')]('Connected\x20to\x20broker\x20client:'+this[a17_0x377e('0xd')]);this['mqttClient'][a17_0x377e('0x18')](a17_0x377e('0x19'));this[a17_0x377e('0x1a')][a17_0x377e('0x18')]('player/close');this[a17_0x377e('0x1a')][a17_0x377e('0x18')]('player/reboot',{'qos':0x2});this['mqttClient']['subscribe'](a17_0x377e('0x1b'),{'qos':0x2});this[a17_0x377e('0x1a')][a17_0x377e('0x18')](a17_0x377e('0x1c'),{'qos':0x2});this['mqttClient'][a17_0x377e('0x18')](a17_0x377e('0x1d'),{'qos':0x2});this[a17_0x377e('0x1e')]();}[a17_0x377e('0x1e')](){const _0xfab13e={'playerId':this['syncPlaylistsService'][a17_0x377e('0x1f')],'clientId':this[a17_0x377e('0xd')],'connected':!![],'network':JSON[a17_0x377e('0x20')](os[a17_0x377e('0x21')]())};console[a17_0x377e('0xc')](_0xfab13e);}[a17_0x377e('0x22')](){}['mqttClient_message'](_0x3f5d70,_0x446971){console['log'](a17_0x377e('0x23'),_0x3f5d70,_0x446971);switch(_0x3f5d70){case'player/open':return this[a17_0x377e('0x24')](_0x446971);case a17_0x377e('0x25'):return this[a17_0x377e('0x26')](_0x446971);case a17_0x377e('0x27'):return this[a17_0x377e('0x28')](_0x446971);case a17_0x377e('0x1c'):return this[a17_0x377e('0x29')](_0x446971);case a17_0x377e('0x1b'):return this[a17_0x377e('0x2a')](_0x446971);case a17_0x377e('0x1d'):return this['handleUpdateRequest'](_0x446971);}}[a17_0x377e('0x2b')](_0x1dca29){if(_0x1dca29==a17_0x377e('0x2c')||_0x1dca29==String(this[a17_0x377e('0x9')][a17_0x377e('0x1f')])){const _0x49c2f1=__dirname;const _0x3c68f9=require(a17_0x377e('0x2d'))(_0x49c2f1);console[a17_0x377e('0xc')](a17_0x377e('0x2e'));_0x3c68f9[a17_0x377e('0x2f')]((_0xa9e4d6,_0x443507)=>{if(_0xa9e4d6){console[a17_0x377e('0xc')](a17_0x377e('0x30'));this[a17_0x377e('0x2b')](_0x1dca29);return;}else{}console['log']('Git\x20updated');console['log'](_0x443507);if(_0x443507&&_0x443507[a17_0x377e('0x31')]['changes']){const _0x3fa094=spawn(a17_0x377e('0x32'),['-r',a17_0x377e('0x33')]);}else{}});}}[a17_0x377e('0x2a')](_0x26b222){if(_0x26b222==a17_0x377e('0x2c')||_0x26b222==String(this[a17_0x377e('0x9')][a17_0x377e('0x1f')])){this[a17_0x377e('0x9')][a17_0x377e('0x34')]();}}['handleReloadPlaylistRequest'](_0x190ff7){if(_0x190ff7=='all'||_0x190ff7==String(this[a17_0x377e('0x9')][a17_0x377e('0x1f')])){this['syncPlaylistsService'][a17_0x377e('0x35')]();}}['handleRebootRequest'](_0x5b54ba){if(_0x5b54ba=='all'||_0x5b54ba==String(this[a17_0x377e('0x9')][a17_0x377e('0x1f')])){const _0x2f803c=spawn(a17_0x377e('0x32'),['-r',a17_0x377e('0x33')]);}}['sendStateUpdate'](){console[a17_0x377e('0xc')](a17_0x377e('0x36'),this[a17_0x377e('0x8')]);this['mqttClient'][a17_0x377e('0x37')]('player/state',this[a17_0x377e('0x9')]['playerId']+'-'+this[a17_0x377e('0x8')]);}['handleOpenRequest'](_0x11ebf4){if(this[a17_0x377e('0x8')]!==a17_0x377e('0x38')&&this[a17_0x377e('0x8')]!==a17_0x377e('0x39')){console[a17_0x377e('0xc')](a17_0x377e('0x3a'));this[a17_0x377e('0x8')]=a17_0x377e('0x39');this[a17_0x377e('0x3b')]();setTimeout(()=>{this[a17_0x377e('0x8')]=a17_0x377e('0x38');this[a17_0x377e('0x3b')]();},0x1388);}}['handleCloseRequest'](_0x30e290){if(this[a17_0x377e('0x8')]!==a17_0x377e('0x3c')&&this[a17_0x377e('0x8')]!=='closing'){this[a17_0x377e('0x8')]=a17_0x377e('0x3d');this[a17_0x377e('0x3b')]();setTimeout(()=>{this['state']=a17_0x377e('0x3c');this[a17_0x377e('0x3b')]();},0x1388);}}['handleAppExit'](_0x319c26,_0x3ecbe6){if(_0x3ecbe6){console['log'](_0x3ecbe6[a17_0x377e('0x3e')]);}this[a17_0x377e('0x1a')][a17_0x377e('0x37')](a17_0x377e('0x3f'),a17_0x377e('0x40'));}}exports[a17_0x377e('0x41')]=MqttService;