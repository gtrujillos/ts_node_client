var a18_0x343d=['changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','player/connected','createJwt','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','is-image','string-template','uuid/v4','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','mqtts','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','message','Message\x20received:\x20','/commands','from','base64','toString','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','mqttClient_message','received\x20message\x20%s\x20%s','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','syncPlaylistsService','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary'];(function(_0x3d910e,_0x3e322f){var _0xac9e76=function(_0x10ab0c){while(--_0x10ab0c){_0x3d910e['push'](_0x3d910e['shift']());}};_0xac9e76(++_0x3e322f);}(a18_0x343d,0x17d));var a18_0x1e7d=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=a18_0x343d[_0xb67384];return _0x156d7c;};'use strict';Object[a18_0x1e7d('0x0')](exports,a18_0x1e7d('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x1e7d('0x2'));const fs=require('fs');const fsExtra=require(a18_0x1e7d('0x3'));const request=require(a18_0x1e7d('0x4'));const progress=require('request-progress');const spawn=require(a18_0x1e7d('0x5'))['spawn'];const exec=require(a18_0x1e7d('0x5'))['exec'];const isImage=require(a18_0x1e7d('0x6'));const format=require(a18_0x1e7d('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x1e7d('0x8'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x25992e){this['syncPlaylistsService']=_0x25992e;this[a18_0x1e7d('0x9')]=a18_0x1e7d('0xa');this[a18_0x1e7d('0xb')]=new HttpClientService_1[(a18_0x1e7d('0xc'))]();}[a18_0x1e7d('0xd')](){this[a18_0x1e7d('0xe')]();}[a18_0x1e7d('0xf')](){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x11'));const _0x56259c=a18_0x1e7d('0x12');const _0x7ad100=a18_0x1e7d('0x13');const _0x12a604=a18_0x1e7d('0x14');const _0x4c3cd0=a18_0x1e7d('0x15');const _0x4567c3=a18_0x1e7d('0x16');const _0x483cf3=a18_0x1e7d('0x17');const _0xbc916f=a18_0x1e7d('0x18');const _0x5ee259=0x1bb;const _0x46adb6=a18_0x1e7d('0x19');const _0x259469=0x5;const _0x54daa0=a18_0x1e7d('0x1a')+_0x56259c+a18_0x1e7d('0x1b')+_0x4c3cd0+'/registries/'+_0x12a604+'/devices/'+_0x7ad100;const _0xd4c8bd={'host':_0xbc916f,'port':_0x5ee259,'clientId':_0x54daa0,'username':'unused','password':this['createJwt'](_0x56259c,_0x483cf3,_0x4567c3),'protocol':a18_0x1e7d('0x1c'),'secureProtocol':a18_0x1e7d('0x1d')};const _0x35250e=Math[a18_0x1e7d('0x1e')](Date[a18_0x1e7d('0x1f')]()/0x3e8);const _0x2c6992=mqtt[a18_0x1e7d('0x20')](_0xd4c8bd);_0x2c6992[a18_0x1e7d('0x21')](a18_0x1e7d('0x22')+_0x7ad100+a18_0x1e7d('0x23'),{'qos':0x1});_0x2c6992['subscribe'](a18_0x1e7d('0x22')+_0x7ad100+'/state',{'qos':0x1});_0x2c6992[a18_0x1e7d('0x21')](a18_0x1e7d('0x22')+_0x7ad100+a18_0x1e7d('0x24'),{'qos':0x0});const _0x118f68=a18_0x1e7d('0x22')+_0x7ad100+'/'+_0x46adb6;_0x2c6992['on'](a18_0x1e7d('0x20'),_0x497f34=>{console[a18_0x1e7d('0x10')](a18_0x1e7d('0x20'));if(!_0x497f34){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x25'));}else{const _0x118f68=a18_0x1e7d('0x26');const _0x3d5929=_0x12a604+'/'+_0x7ad100+a18_0x1e7d('0x27');_0x2c6992[a18_0x1e7d('0x28')](_0x118f68,_0x3d5929,{'qos':0x1},_0x21aab6=>{console['log'](a18_0x1e7d('0x29'));console['log'](_0x21aab6);if(!_0x21aab6){}});}});_0x2c6992['on'](a18_0x1e7d('0x2a'),()=>{console[a18_0x1e7d('0x10')](a18_0x1e7d('0x2a'));});_0x2c6992['on']('error',_0x3885c2=>{console[a18_0x1e7d('0x10')]('error',_0x3885c2);});_0x2c6992['on'](a18_0x1e7d('0x2b'),(_0xefd90a,_0x52e271)=>{let _0xc945fb=a18_0x1e7d('0x2c');console[a18_0x1e7d('0x10')](_0xefd90a);console[a18_0x1e7d('0x10')](_0x52e271+'');if(_0xefd90a===a18_0x1e7d('0x22')+_0x7ad100+a18_0x1e7d('0x23')){_0xc945fb='Config\x20message\x20received:\x20';}else if(_0xefd90a['startsWith']('/devices/'+_0x7ad100+a18_0x1e7d('0x2d'))){_0xc945fb='Command\x20message\x20received:\x20';}_0xc945fb+=Buffer[a18_0x1e7d('0x2e')](_0x52e271,a18_0x1e7d('0x2f'))[a18_0x1e7d('0x30')]('ascii');console[a18_0x1e7d('0x10')](_0xc945fb);});_0x2c6992['on'](a18_0x1e7d('0x31'),()=>{});console[a18_0x1e7d('0x10')](_0xd4c8bd);}[a18_0x1e7d('0xe')](){console['log']('mqttInit');this[a18_0x1e7d('0x32')]=uuidv4();console[a18_0x1e7d('0x10')](a18_0x1e7d('0x33'));console[a18_0x1e7d('0x10')](this[a18_0x1e7d('0x32')]);const _0x2066eb={'clientId':this[a18_0x1e7d('0x32')],'username':a18_0x1e7d('0x34'),'password':a18_0x1e7d('0x35'),'clean':!![]};this[a18_0x1e7d('0x36')]=mqtt[a18_0x1e7d('0x20')](a18_0x1e7d('0x37'),_0x2066eb);this[a18_0x1e7d('0x36')]['on']('connect',this[a18_0x1e7d('0x38')][a18_0x1e7d('0x39')](this));this[a18_0x1e7d('0x36')]['on'](a18_0x1e7d('0x2b'),this['mqttClient_message'][a18_0x1e7d('0x39')](this));this[a18_0x1e7d('0x36')]['on'](a18_0x1e7d('0x2a'),()=>{console[a18_0x1e7d('0x10')](a18_0x1e7d('0x2a'));});process['on'](a18_0x1e7d('0x3a'),this[a18_0x1e7d('0x3b')][a18_0x1e7d('0x39')](this));process['on'](a18_0x1e7d('0x3c'),this['handleAppExit'][a18_0x1e7d('0x39')](this));process['on'](a18_0x1e7d('0x3d'),this['handleAppExit'][a18_0x1e7d('0x39')](this));}[a18_0x1e7d('0x38')](){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x3e')+this['clientId']);this['mqttClient'][a18_0x1e7d('0x21')](a18_0x1e7d('0x3f'));this[a18_0x1e7d('0x36')][a18_0x1e7d('0x21')](a18_0x1e7d('0x40'));this[a18_0x1e7d('0x36')]['subscribe'](a18_0x1e7d('0x41'),{'qos':0x2});this[a18_0x1e7d('0x36')][a18_0x1e7d('0x21')](a18_0x1e7d('0x42'),{'qos':0x2});this[a18_0x1e7d('0x36')][a18_0x1e7d('0x21')](a18_0x1e7d('0x43'),{'qos':0x2});this[a18_0x1e7d('0x36')]['subscribe'](a18_0x1e7d('0x44'),{'qos':0x2});this[a18_0x1e7d('0x36')]['subscribe']('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x1e7d('0x21')](a18_0x1e7d('0x45'),{'qos':0x2});this[a18_0x1e7d('0x36')][a18_0x1e7d('0x21')](a18_0x1e7d('0x46'),{'qos':0x2});this[a18_0x1e7d('0x36')]['subscribe'](a18_0x1e7d('0x47'),{'qos':0x2});this['mqttClient'][a18_0x1e7d('0x21')](a18_0x1e7d('0x48'),{'qos':0x2});}['reportStatus'](){}[a18_0x1e7d('0x49')](_0x159f01,_0xf2707){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x4a'),_0x159f01,_0xf2707);switch(_0x159f01){case a18_0x1e7d('0x3f'):return this['handleOpenRequest'](_0xf2707);case a18_0x1e7d('0x40'):return this[a18_0x1e7d('0x4b')](_0xf2707);case a18_0x1e7d('0x41'):return this[a18_0x1e7d('0x4c')](_0xf2707);case'player/reload_playlist':return this[a18_0x1e7d('0x4d')](_0xf2707);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0xf2707);case a18_0x1e7d('0x44'):return this[a18_0x1e7d('0x4e')](_0xf2707);case a18_0x1e7d('0x4f'):return this[a18_0x1e7d('0x50')](_0xf2707);case a18_0x1e7d('0x45'):return this[a18_0x1e7d('0x51')](_0xf2707);case a18_0x1e7d('0x46'):return this['handleUpdateSettingsRequest'](_0xf2707);case'player/turn_off_tv':return this[a18_0x1e7d('0x52')](_0xf2707);case'player/turn_on_tv':return this[a18_0x1e7d('0x53')](_0xf2707);}}[a18_0x1e7d('0x51')](_0x13ec61){if(_0x13ec61=='all'||_0x13ec61==String(this[a18_0x1e7d('0x54')][a18_0x1e7d('0x55')])){this[a18_0x1e7d('0x54')][a18_0x1e7d('0x56')]();}}[a18_0x1e7d('0x50')](_0xa54638){if(_0xa54638==a18_0x1e7d('0x57')||_0xa54638==String(this[a18_0x1e7d('0x54')]['playerId'])){}}['handleUpdateRequest'](_0x57c4c0){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x58')+_0x57c4c0);if(_0x57c4c0=='all'||_0x57c4c0==String(this['syncPlaylistsService'][a18_0x1e7d('0x55')])){const _0x51c656=__dirname;const _0x5fa33e=require(a18_0x1e7d('0x59'))(_0x51c656);console[a18_0x1e7d('0x10')](a18_0x1e7d('0x5a'));_0x5fa33e[a18_0x1e7d('0x5b')]((_0x16862d,_0x978669)=>{if(_0x16862d){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x5c'));this['handleUpdateRequest'](_0x57c4c0);return;}else{}console[a18_0x1e7d('0x10')](a18_0x1e7d('0x5d'));console['log'](_0x978669);if(_0x978669&&_0x978669[a18_0x1e7d('0x5e')][a18_0x1e7d('0x5f')]){this['syncPlaylistsService'][a18_0x1e7d('0x60')]();}else{}});}}['handleLoadPlaylistRequest'](_0x28698d){if(_0x28698d=='all'||_0x28698d==String(this[a18_0x1e7d('0x54')][a18_0x1e7d('0x55')])){this[a18_0x1e7d('0x54')][a18_0x1e7d('0x61')]();}}[a18_0x1e7d('0x4d')](_0x212dec){if(String(_0x212dec)=='all'||String(_0x212dec)==String(this[a18_0x1e7d('0x54')][a18_0x1e7d('0x55')])){this['syncPlaylistsService'][a18_0x1e7d('0x62')]();}}[a18_0x1e7d('0x4c')](_0x2b761e){if(_0x2b761e=='all'||_0x2b761e==String(this['syncPlaylistsService'][a18_0x1e7d('0x55')])){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x63'));try{this[a18_0x1e7d('0x54')][a18_0x1e7d('0x60')]();}catch(_0x1a7e31){console['log'](_0x1a7e31);}}}[a18_0x1e7d('0x64')](_0x2070ce){if(_0x2070ce==a18_0x1e7d('0x57')||_0x2070ce==String(this['syncPlaylistsService'][a18_0x1e7d('0x55')])){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x65'));try{this['syncPlaylistsService'][a18_0x1e7d('0x66')]();}catch(_0x16c14e){console[a18_0x1e7d('0x10')](_0x16c14e);}}}[a18_0x1e7d('0x53')](_0x4cd003){if(_0x4cd003==a18_0x1e7d('0x57')||_0x4cd003==String(this[a18_0x1e7d('0x54')][a18_0x1e7d('0x55')])){console[a18_0x1e7d('0x10')](a18_0x1e7d('0x67'));try{this[a18_0x1e7d('0x54')][a18_0x1e7d('0x68')]();}catch(_0x55e934){console[a18_0x1e7d('0x10')](_0x55e934);}}}['handleTurnOffTVRequest'](_0x46a1fd){if(_0x46a1fd==a18_0x1e7d('0x57')||_0x46a1fd==String(this[a18_0x1e7d('0x54')][a18_0x1e7d('0x55')])){console[a18_0x1e7d('0x10')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a18_0x1e7d('0x69')]();}catch(_0xe000af){console[a18_0x1e7d('0x10')](_0xe000af);}}}[a18_0x1e7d('0x6a')](){console['log'](a18_0x1e7d('0x6b'),this[a18_0x1e7d('0x9')]);this['mqttClient'][a18_0x1e7d('0x28')](a18_0x1e7d('0x6c'),this['syncPlaylistsService'][a18_0x1e7d('0x55')]+'-'+this[a18_0x1e7d('0x9')]);}[a18_0x1e7d('0x6d')](_0x3bd995){if(this[a18_0x1e7d('0x9')]!==a18_0x1e7d('0x6e')&&this[a18_0x1e7d('0x9')]!==a18_0x1e7d('0x6f')){console['log'](a18_0x1e7d('0x70'));this[a18_0x1e7d('0x9')]='opening';this[a18_0x1e7d('0x6a')]();setTimeout(()=>{this[a18_0x1e7d('0x9')]='open';this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x2c5891){if(this['state']!==a18_0x1e7d('0xa')&&this[a18_0x1e7d('0x9')]!==a18_0x1e7d('0x71')){this[a18_0x1e7d('0x9')]='closing';this[a18_0x1e7d('0x6a')]();setTimeout(()=>{this[a18_0x1e7d('0x9')]=a18_0x1e7d('0xa');this[a18_0x1e7d('0x6a')]();},0x1388);}}[a18_0x1e7d('0x3b')](_0x703c1f,_0x3fce6d){if(_0x3fce6d){console[a18_0x1e7d('0x10')](_0x3fce6d[a18_0x1e7d('0x72')]);}this[a18_0x1e7d('0x36')][a18_0x1e7d('0x28')](a18_0x1e7d('0x73'),'false');}[a18_0x1e7d('0x74')](_0x16b97b,_0x3c931b,_0x38195f){const _0x26c8b3={'iat':Math[a18_0x1e7d('0x1e')](Date[a18_0x1e7d('0x1f')]()/0x3e8),'exp':Math['round'](Date[a18_0x1e7d('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x16b97b};const _0x26f634=fs[a18_0x1e7d('0x75')](_0x3c931b);return jwt[a18_0x1e7d('0x76')](_0x26c8b3,_0x26f634,{'algorithm':_0x38195f});}}exports['MqttService']=MqttService;