var a18_0x4ce5=['Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','changes','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','shutdown\x20-r\x20now','sendStateUpdate','sending\x20state\x20%s','publish','opening\x20player\x20door','opening','open','closing','stack','player/connected','false','createJwt','readFileSync','sign','MqttService','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','unused','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','error','message','Message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','handleAppExit','SIGINT','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/update','player/ifconfig','player/register','reportStatus','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','simple-git'];(function(_0x37b118,_0x512a50){var _0x163dc1=function(_0x16c793){while(--_0x16c793){_0x37b118['push'](_0x37b118['shift']());}};_0x163dc1(++_0x512a50);}(a18_0x4ce5,0x14d));var a18_0x2312=function(_0x850a16,_0x5918c2){_0x850a16=_0x850a16-0x0;var _0x508fd1=a18_0x4ce5[_0x850a16];return _0x508fd1;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x2312('0x0'));const fs=require('fs');const fsExtra=require(a18_0x2312('0x1'));const request=require(a18_0x2312('0x2'));const progress=require(a18_0x2312('0x3'));const {spawn}=require(a18_0x2312('0x4'));const exec=require(a18_0x2312('0x4'))[a18_0x2312('0x5')];const isImage=require(a18_0x2312('0x6'));const format=require(a18_0x2312('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x2312('0x8'));const jwt=require(a18_0x2312('0x9'));class MqttService{constructor(_0x453987){this[a18_0x2312('0xa')]=_0x453987;this[a18_0x2312('0xb')]=a18_0x2312('0xc');this['httpClientService']=new HttpClientService_1[(a18_0x2312('0xd'))]();}['init'](){this[a18_0x2312('0xe')]();}[a18_0x2312('0xf')](){console['log'](a18_0x2312('0x10'));const _0x58edb2=a18_0x2312('0x11');const _0x5e94a1='my-node-device';const _0x4d3ffd='my-registry';const _0x3f4c25=a18_0x2312('0x12');const _0x243bb1=a18_0x2312('0x13');const _0x8aa98b=a18_0x2312('0x14');const _0x3fd40f=a18_0x2312('0x15');const _0x26373e=0x1bb;const _0x31df78=a18_0x2312('0x16');const _0x59d2b8=0x5;const _0x472154=a18_0x2312('0x17')+_0x58edb2+'/locations/'+_0x3f4c25+a18_0x2312('0x18')+_0x4d3ffd+a18_0x2312('0x19')+_0x5e94a1;const _0x14b61d={'host':_0x3fd40f,'port':_0x26373e,'clientId':_0x472154,'username':a18_0x2312('0x1a'),'password':this['createJwt'](_0x58edb2,_0x8aa98b,_0x243bb1),'protocol':a18_0x2312('0x1b'),'secureProtocol':a18_0x2312('0x1c')};const _0x2ac2db=Math[a18_0x2312('0x1d')](Date[a18_0x2312('0x1e')]()/0x3e8);const _0x36b5de=mqtt[a18_0x2312('0x1f')](_0x14b61d);_0x36b5de[a18_0x2312('0x20')](a18_0x2312('0x19')+_0x5e94a1+a18_0x2312('0x21'),{'qos':0x1});_0x36b5de[a18_0x2312('0x20')]('/devices/'+_0x5e94a1+'/state',{'qos':0x1});_0x36b5de[a18_0x2312('0x20')](a18_0x2312('0x19')+_0x5e94a1+a18_0x2312('0x22'),{'qos':0x0});const _0x1ceeec=a18_0x2312('0x19')+_0x5e94a1+'/'+_0x31df78;_0x36b5de['on'](a18_0x2312('0x1f'),_0x30b981=>{console[a18_0x2312('0x23')]('connect');if(!_0x30b981){console[a18_0x2312('0x23')](a18_0x2312('0x24'));}else{const _0x1ceeec=a18_0x2312('0x25');const _0x3e473e=_0x4d3ffd+'/'+_0x5e94a1+'-payload-0';_0x36b5de['publish'](_0x1ceeec,_0x3e473e,{'qos':0x1},_0x278079=>{console[a18_0x2312('0x23')](a18_0x2312('0x26'));console[a18_0x2312('0x23')](_0x278079);if(!_0x278079){}});}});_0x36b5de['on'](a18_0x2312('0x27'),()=>{console['log'](a18_0x2312('0x27'));});_0x36b5de['on'](a18_0x2312('0x28'),_0x45720d=>{console[a18_0x2312('0x23')](a18_0x2312('0x28'),_0x45720d);});_0x36b5de['on'](a18_0x2312('0x29'),(_0x376d1e,_0x4f78b7)=>{let _0x199b0f=a18_0x2312('0x2a');console[a18_0x2312('0x23')](_0x376d1e);console['log'](_0x4f78b7+'');if(_0x376d1e===a18_0x2312('0x19')+_0x5e94a1+'/config'){_0x199b0f='Config\x20message\x20received:\x20';}else if(_0x376d1e[a18_0x2312('0x2b')](a18_0x2312('0x19')+_0x5e94a1+a18_0x2312('0x2c'))){_0x199b0f=a18_0x2312('0x2d');}_0x199b0f+=Buffer['from'](_0x4f78b7,a18_0x2312('0x2e'))['toString']('ascii');console[a18_0x2312('0x23')](_0x199b0f);});_0x36b5de['on']('packetsend',()=>{});console[a18_0x2312('0x23')](_0x14b61d);}[a18_0x2312('0xe')](){console[a18_0x2312('0x23')](a18_0x2312('0x10'));this['clientId']=uuidv4();console[a18_0x2312('0x23')](a18_0x2312('0x2f'));console[a18_0x2312('0x23')](this[a18_0x2312('0x30')]);const _0x204c89={'clientId':this[a18_0x2312('0x30')],'username':a18_0x2312('0x31'),'password':a18_0x2312('0x32'),'clean':!![]};this[a18_0x2312('0x33')]=mqtt['connect'](a18_0x2312('0x34'),_0x204c89);this[a18_0x2312('0x33')]['on']('connect',this['mqttClient_connect'][a18_0x2312('0x35')](this));this[a18_0x2312('0x33')]['on'](a18_0x2312('0x29'),this[a18_0x2312('0x36')][a18_0x2312('0x35')](this));this[a18_0x2312('0x33')]['on'](a18_0x2312('0x27'),()=>{console['log'](a18_0x2312('0x27'));});process['on'](a18_0x2312('0x37'),this[a18_0x2312('0x38')][a18_0x2312('0x35')](this));process['on'](a18_0x2312('0x39'),this[a18_0x2312('0x38')][a18_0x2312('0x35')](this));process['on']('uncaughtException',this['handleAppExit'][a18_0x2312('0x35')](this));}[a18_0x2312('0x3a')](){console[a18_0x2312('0x23')](a18_0x2312('0x3b')+this['clientId']);this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x3c'));this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x3d'));this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x3e'),{'qos':0x2});this['mqttClient'][a18_0x2312('0x20')](a18_0x2312('0x3f'),{'qos':0x2});this[a18_0x2312('0x33')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x40'),{'qos':0x2});this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x41'),{'qos':0x2});this[a18_0x2312('0x33')][a18_0x2312('0x20')](a18_0x2312('0x42'),{'qos':0x2});}[a18_0x2312('0x43')](){}[a18_0x2312('0x36')](_0xd17b04,_0x3538c4){console[a18_0x2312('0x23')]('received\x20message\x20%s\x20%s',_0xd17b04,_0x3538c4);switch(_0xd17b04){case a18_0x2312('0x3c'):return this[a18_0x2312('0x44')](_0x3538c4);case'player/close':return this[a18_0x2312('0x45')](_0x3538c4);case'player/reboot':return this[a18_0x2312('0x46')](_0x3538c4);case a18_0x2312('0x47'):return this[a18_0x2312('0x48')](_0x3538c4);case a18_0x2312('0x3f'):return this['handleLoadPlaylistRequest'](_0x3538c4);case a18_0x2312('0x40'):return this[a18_0x2312('0x49')](_0x3538c4);case a18_0x2312('0x41'):return this[a18_0x2312('0x4a')](_0x3538c4);case a18_0x2312('0x42'):return this[a18_0x2312('0x4b')](_0x3538c4);}}[a18_0x2312('0x4b')](_0x367fa5){if(_0x367fa5==a18_0x2312('0x4c')||_0x367fa5==String(this[a18_0x2312('0xa')]['playerId'])){this[a18_0x2312('0xa')]['registerClient']();}}[a18_0x2312('0x4a')](_0x1170a1){if(_0x1170a1==a18_0x2312('0x4c')||_0x1170a1==String(this[a18_0x2312('0xa')][a18_0x2312('0x4d')])){}}[a18_0x2312('0x49')](_0x1708c4){console[a18_0x2312('0x23')]('handleUpdateRequest:\x20'+_0x1708c4);if(_0x1708c4==a18_0x2312('0x4c')||_0x1708c4==String(this['syncPlaylistsService'][a18_0x2312('0x4d')])){const _0x30fe88=__dirname;const _0x10dac4=require(a18_0x2312('0x4e'))(_0x30fe88);console[a18_0x2312('0x23')](a18_0x2312('0x4f'));_0x10dac4[a18_0x2312('0x50')]((_0x456a3e,_0x1cb83c)=>{if(_0x456a3e){console['log'](a18_0x2312('0x51'));this[a18_0x2312('0x49')](_0x1708c4);return;}else{}console['log'](a18_0x2312('0x52'));console[a18_0x2312('0x23')](_0x1cb83c);if(_0x1cb83c&&_0x1cb83c['summary'][a18_0x2312('0x53')]){const _0x406877=spawn('shutdown',['-r',a18_0x2312('0x1e')]);}else{}});}}[a18_0x2312('0x54')](_0x24869c){if(_0x24869c==a18_0x2312('0x4c')||_0x24869c==String(this[a18_0x2312('0xa')][a18_0x2312('0x4d')])){this[a18_0x2312('0xa')][a18_0x2312('0x55')]();}}[a18_0x2312('0x48')](_0x320465){if(String(_0x320465)==a18_0x2312('0x4c')||String(_0x320465)==String(this[a18_0x2312('0xa')][a18_0x2312('0x4d')])){this[a18_0x2312('0xa')][a18_0x2312('0x56')]();}}[a18_0x2312('0x46')](_0x51f7cb){if(_0x51f7cb==a18_0x2312('0x4c')||_0x51f7cb==String(this['syncPlaylistsService'][a18_0x2312('0x4d')])){console[a18_0x2312('0x23')](a18_0x2312('0x57'));try{exec(a18_0x2312('0x58'),function(_0x340f0e,_0x21848d,_0x42d877){console[a18_0x2312('0x23')](_0x340f0e);console[a18_0x2312('0x23')](_0x21848d);console[a18_0x2312('0x23')](_0x42d877);});}catch(_0x52738c){console[a18_0x2312('0x23')](_0x52738c);}}}[a18_0x2312('0x59')](){console[a18_0x2312('0x23')](a18_0x2312('0x5a'),this[a18_0x2312('0xb')]);this[a18_0x2312('0x33')][a18_0x2312('0x5b')]('player/state',this[a18_0x2312('0xa')][a18_0x2312('0x4d')]+'-'+this[a18_0x2312('0xb')]);}[a18_0x2312('0x44')](_0x350873){if(this['state']!=='open'&&this[a18_0x2312('0xb')]!=='opening'){console[a18_0x2312('0x23')](a18_0x2312('0x5c'));this['state']=a18_0x2312('0x5d');this[a18_0x2312('0x59')]();setTimeout(()=>{this['state']=a18_0x2312('0x5e');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x426703){if(this[a18_0x2312('0xb')]!=='closed'&&this[a18_0x2312('0xb')]!==a18_0x2312('0x5f')){this[a18_0x2312('0xb')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x2312('0xb')]=a18_0x2312('0xc');this[a18_0x2312('0x59')]();},0x1388);}}[a18_0x2312('0x38')](_0x437002,_0x13f672){if(_0x13f672){console['log'](_0x13f672[a18_0x2312('0x60')]);}this[a18_0x2312('0x33')][a18_0x2312('0x5b')](a18_0x2312('0x61'),a18_0x2312('0x62'));}[a18_0x2312('0x63')](_0x38d06b,_0x353973,_0x8c2509){const _0x5e11ab={'iat':Math[a18_0x2312('0x1d')](Date['now']()/0x3e8),'exp':Math[a18_0x2312('0x1d')](Date[a18_0x2312('0x1e')]()/0x3e8)+0x14*0x3c,'aud':_0x38d06b};const _0x3441a1=fs[a18_0x2312('0x64')](_0x353973);return jwt[a18_0x2312('0x65')](_0x5e11ab,_0x3441a1,{'algorithm':_0x8c2509});}}exports[a18_0x2312('0x66')]=MqttService;