var a18_0x4294=['spawn','is-image','string-template','mqtt','uuid/v4','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','exit','SIGINT','handleAppExit','subscribe','player/open','player/reboot','player/load_playlist','player/update','player/ifconfig','player/register','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleRegisterRequest','all','playerId','syncPlaylistsService','registerClient','handleUpdateRequest','Git\x20updating','pull','Error\x20git\x20updated','changes','loadMediaList','now','sending\x20state\x20%s','player/state','opening','sendStateUpdate','open','closing','stack','publish','player/connected','MqttService','__esModule','fs-extra','request','request-progress','child_process'];(function(_0x511871,_0x593b24){var _0x58e124=function(_0x590a08){while(--_0x590a08){_0x511871['push'](_0x511871['shift']());}};_0x58e124(++_0x593b24);}(a18_0x4294,0x145));var a18_0x4bff=function(_0x24038b,_0x147bf3){_0x24038b=_0x24038b-0x0;var _0x25231b=a18_0x4294[_0x24038b];return _0x25231b;};'use strict';Object['defineProperty'](exports,a18_0x4bff('0x0'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x4bff('0x1'));const request=require(a18_0x4bff('0x2'));const progress=require(a18_0x4bff('0x3'));const spawn=require(a18_0x4bff('0x4'))[a18_0x4bff('0x5')];const isImage=require(a18_0x4bff('0x6'));const format=require(a18_0x4bff('0x7'));const os=require('os');const mqtt=require(a18_0x4bff('0x8'));const uuidv4=require(a18_0x4bff('0x9'));class MqttService{constructor(_0xa36c3e){this['syncPlaylistsService']=_0xa36c3e;this[a18_0x4bff('0xa')]=a18_0x4bff('0xb');this[a18_0x4bff('0xc')]=new HttpClientService_1[(a18_0x4bff('0xd'))]();}[a18_0x4bff('0xe')](){this[a18_0x4bff('0xf')]();}[a18_0x4bff('0xf')](){console[a18_0x4bff('0x10')](a18_0x4bff('0xf'));this[a18_0x4bff('0x11')]=uuidv4();console['log'](a18_0x4bff('0x12'));console[a18_0x4bff('0x10')](this['clientId']);const _0x2b0c29={'clientId':this[a18_0x4bff('0x11')],'username':a18_0x4bff('0x13'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x4bff('0x14')]=mqtt[a18_0x4bff('0x15')](a18_0x4bff('0x16'),_0x2b0c29);this[a18_0x4bff('0x14')]['on']('connect',this[a18_0x4bff('0x17')][a18_0x4bff('0x18')](this));this[a18_0x4bff('0x14')]['on']('message',this['mqttClient_message']['bind'](this));process['on'](a18_0x4bff('0x19'),this['handleAppExit'][a18_0x4bff('0x18')](this));process['on'](a18_0x4bff('0x1a'),this[a18_0x4bff('0x1b')][a18_0x4bff('0x18')](this));process['on']('uncaughtException',this[a18_0x4bff('0x1b')][a18_0x4bff('0x18')](this));}[a18_0x4bff('0x17')](){console[a18_0x4bff('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x4bff('0x11')]);this['mqttClient'][a18_0x4bff('0x1c')](a18_0x4bff('0x1d'));this[a18_0x4bff('0x14')][a18_0x4bff('0x1c')]('player/close');this['mqttClient'][a18_0x4bff('0x1c')](a18_0x4bff('0x1e'),{'qos':0x2});this[a18_0x4bff('0x14')][a18_0x4bff('0x1c')](a18_0x4bff('0x1f'),{'qos':0x2});this[a18_0x4bff('0x14')][a18_0x4bff('0x1c')]('player/reload_playlist',{'qos':0x2});this[a18_0x4bff('0x14')]['subscribe'](a18_0x4bff('0x20'),{'qos':0x2});this[a18_0x4bff('0x14')]['subscribe'](a18_0x4bff('0x21'),{'qos':0x2});this[a18_0x4bff('0x14')]['subscribe'](a18_0x4bff('0x22'),{'qos':0x2});}[a18_0x4bff('0x23')](){}[a18_0x4bff('0x24')](_0x455520,_0x5dc1a7){console[a18_0x4bff('0x10')](a18_0x4bff('0x25'),_0x455520,_0x5dc1a7);switch(_0x455520){case a18_0x4bff('0x1d'):return this[a18_0x4bff('0x26')](_0x5dc1a7);case a18_0x4bff('0x27'):return this[a18_0x4bff('0x28')](_0x5dc1a7);case a18_0x4bff('0x1e'):return this[a18_0x4bff('0x29')](_0x5dc1a7);case'player/reload_playlist':return this[a18_0x4bff('0x2a')](_0x5dc1a7);case a18_0x4bff('0x1f'):return this[a18_0x4bff('0x2b')](_0x5dc1a7);case a18_0x4bff('0x20'):return this['handleUpdateRequest'](_0x5dc1a7);case a18_0x4bff('0x21'):return this['handleIfconfigRequest'](_0x5dc1a7);case a18_0x4bff('0x22'):return this['handleRegisterRequest'](_0x5dc1a7);}}[a18_0x4bff('0x2c')](_0x57b7d6){if(_0x57b7d6==a18_0x4bff('0x2d')||_0x57b7d6==String(this['syncPlaylistsService'][a18_0x4bff('0x2e')])){this[a18_0x4bff('0x2f')][a18_0x4bff('0x30')]();}}['handleIfconfigRequest'](_0x4bb880){if(_0x4bb880=='all'||_0x4bb880==String(this['syncPlaylistsService'][a18_0x4bff('0x2e')])){}}[a18_0x4bff('0x31')](_0x4c4049){console['log']('handleUpdateRequest:\x20'+_0x4c4049);if(_0x4c4049==a18_0x4bff('0x2d')||_0x4c4049==String(this['syncPlaylistsService'][a18_0x4bff('0x2e')])){const _0x1f1c3b=__dirname;const _0x55b224=require('simple-git')(_0x1f1c3b);console[a18_0x4bff('0x10')](a18_0x4bff('0x32'));_0x55b224[a18_0x4bff('0x33')]((_0x543b55,_0x313692)=>{if(_0x543b55){console[a18_0x4bff('0x10')](a18_0x4bff('0x34'));this[a18_0x4bff('0x31')](_0x4c4049);return;}else{}console['log']('Git\x20updated');console[a18_0x4bff('0x10')](_0x313692);if(_0x313692&&_0x313692['summary'][a18_0x4bff('0x35')]){const _0x4ca354=spawn('shutdown',['-r','now']);}else{}});}}['handleLoadPlaylistRequest'](_0x3853af){if(_0x3853af==a18_0x4bff('0x2d')||_0x3853af==String(this[a18_0x4bff('0x2f')]['playerId'])){this[a18_0x4bff('0x2f')][a18_0x4bff('0x36')]();}}['handleReloadPlaylistRequest'](_0x1c44ee){if(String(_0x1c44ee)==a18_0x4bff('0x2d')||String(_0x1c44ee)==String(this[a18_0x4bff('0x2f')]['playerId'])){this[a18_0x4bff('0x2f')]['reloadMediaList']();}}[a18_0x4bff('0x29')](_0x4de7e3){if(_0x4de7e3==a18_0x4bff('0x2d')||_0x4de7e3==String(this['syncPlaylistsService'][a18_0x4bff('0x2e')])){const _0x43e48c=spawn('shutdown',['-r',a18_0x4bff('0x37')]);}}['sendStateUpdate'](){console[a18_0x4bff('0x10')](a18_0x4bff('0x38'),this['state']);this[a18_0x4bff('0x14')]['publish'](a18_0x4bff('0x39'),this['syncPlaylistsService']['playerId']+'-'+this[a18_0x4bff('0xa')]);}[a18_0x4bff('0x26')](_0x4a328f){if(this[a18_0x4bff('0xa')]!=='open'&&this['state']!==a18_0x4bff('0x3a')){console[a18_0x4bff('0x10')]('opening\x20player\x20door');this[a18_0x4bff('0xa')]=a18_0x4bff('0x3a');this[a18_0x4bff('0x3b')]();setTimeout(()=>{this[a18_0x4bff('0xa')]=a18_0x4bff('0x3c');this['sendStateUpdate']();},0x1388);}}[a18_0x4bff('0x28')](_0x449445){if(this[a18_0x4bff('0xa')]!==a18_0x4bff('0xb')&&this['state']!==a18_0x4bff('0x3d')){this[a18_0x4bff('0xa')]=a18_0x4bff('0x3d');this[a18_0x4bff('0x3b')]();setTimeout(()=>{this['state']=a18_0x4bff('0xb');this[a18_0x4bff('0x3b')]();},0x1388);}}['handleAppExit'](_0x8c8443,_0x21dd30){if(_0x21dd30){console[a18_0x4bff('0x10')](_0x21dd30[a18_0x4bff('0x3e')]);}this[a18_0x4bff('0x14')][a18_0x4bff('0x3f')](a18_0x4bff('0x40'),'false');}}exports[a18_0x4bff('0x41')]=MqttService;