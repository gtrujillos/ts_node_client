var a20_0x8708=['defineProperty','__esModule','./../infrastructure/HttpClientService','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','closed','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','round','connect','/devices/','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','ascii','packetsend','this.clientId','clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/turn_off_tv','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','player/update_settings','handleTurnOffTVRequest','player/turn_on_tv','handleTurnOnTVRequest','handleRegisterRequest','syncPlaylistsService','registerClient','all','playerId','simple-git','Git\x20updating','pull','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','state','opening','open','closing','player/connected','false','now','readFileSync','sign','MqttService'];(function(_0x4bed80,_0x5e3f4d){var _0x442b1c=function(_0x3963da){while(--_0x3963da){_0x4bed80['push'](_0x4bed80['shift']());}};_0x442b1c(++_0x5e3f4d);}(a20_0x8708,0xe6));var a20_0x1e2a=function(_0x427c6f,_0x517e3f){_0x427c6f=_0x427c6f-0x0;var _0x533658=a20_0x8708[_0x427c6f];return _0x533658;};'use strict';Object[a20_0x1e2a('0x0')](exports,a20_0x1e2a('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x1e2a('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a20_0x1e2a('0x3'));const spawn=require(a20_0x1e2a('0x4'))['spawn'];const exec=require(a20_0x1e2a('0x4'))[a20_0x1e2a('0x5')];const isImage=require(a20_0x1e2a('0x6'));const format=require(a20_0x1e2a('0x7'));const os=require('os');const mqtt=require(a20_0x1e2a('0x8'));const uuidv4=require(a20_0x1e2a('0x9'));const jwt=require(a20_0x1e2a('0xa'));class MqttService{constructor(_0x9896fa){this['syncPlaylistsService']=_0x9896fa;this['state']=a20_0x1e2a('0xb');this[a20_0x1e2a('0xc')]=new HttpClientService_1[(a20_0x1e2a('0xd'))]();}['init'](){this[a20_0x1e2a('0xe')]();}[a20_0x1e2a('0xf')](){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x11'));const _0x2d9eb6=a20_0x1e2a('0x12');const _0x50c121=a20_0x1e2a('0x13');const _0x21634f='my-registry';const _0x3be142=a20_0x1e2a('0x14');const _0xd16ad8=a20_0x1e2a('0x15');const _0x1d29c8=a20_0x1e2a('0x16');const _0x50da2b=a20_0x1e2a('0x17');const _0x30da77=0x1bb;const _0x2178f6=a20_0x1e2a('0x18');const _0x43e3cd=0x5;const _0x2a5351=a20_0x1e2a('0x19')+_0x2d9eb6+a20_0x1e2a('0x1a')+_0x3be142+a20_0x1e2a('0x1b')+_0x21634f+'/devices/'+_0x50c121;const _0x59b667={'host':_0x50da2b,'port':_0x30da77,'clientId':_0x2a5351,'username':a20_0x1e2a('0x1c'),'password':this[a20_0x1e2a('0x1d')](_0x2d9eb6,_0x1d29c8,_0xd16ad8),'protocol':a20_0x1e2a('0x1e'),'secureProtocol':'TLSv1_2_method'};const _0x5cb6bb=Math[a20_0x1e2a('0x1f')](Date['now']()/0x3e8);const _0x1727eb=mqtt[a20_0x1e2a('0x20')](_0x59b667);_0x1727eb['subscribe'](a20_0x1e2a('0x21')+_0x50c121+'/config',{'qos':0x1});_0x1727eb[a20_0x1e2a('0x22')](a20_0x1e2a('0x21')+_0x50c121+a20_0x1e2a('0x23'),{'qos':0x1});_0x1727eb[a20_0x1e2a('0x22')](a20_0x1e2a('0x21')+_0x50c121+a20_0x1e2a('0x24'),{'qos':0x0});const _0x34bf6b=a20_0x1e2a('0x21')+_0x50c121+'/'+_0x2178f6;_0x1727eb['on'](a20_0x1e2a('0x20'),_0x2fbb75=>{console['log']('connect');if(!_0x2fbb75){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x25'));}else{const _0x34bf6b=a20_0x1e2a('0x26');const _0x134fbd=_0x21634f+'/'+_0x50c121+'-payload-0';_0x1727eb[a20_0x1e2a('0x27')](_0x34bf6b,_0x134fbd,{'qos':0x1},_0x4dd370=>{console[a20_0x1e2a('0x10')](a20_0x1e2a('0x28'));console[a20_0x1e2a('0x10')](_0x4dd370);if(!_0x4dd370){}});}});_0x1727eb['on'](a20_0x1e2a('0x29'),()=>{console[a20_0x1e2a('0x10')](a20_0x1e2a('0x29'));});_0x1727eb['on'](a20_0x1e2a('0x2a'),_0x33a379=>{console[a20_0x1e2a('0x10')]('error',_0x33a379);});_0x1727eb['on'](a20_0x1e2a('0x2b'),(_0x19c20e,_0x370590)=>{let _0x19f8f9=a20_0x1e2a('0x2c');console[a20_0x1e2a('0x10')](_0x19c20e);console['log'](_0x370590+'');if(_0x19c20e===a20_0x1e2a('0x21')+_0x50c121+'/config'){_0x19f8f9=a20_0x1e2a('0x2d');}else if(_0x19c20e[a20_0x1e2a('0x2e')]('/devices/'+_0x50c121+a20_0x1e2a('0x2f'))){_0x19f8f9=a20_0x1e2a('0x30');}_0x19f8f9+=Buffer['from'](_0x370590,a20_0x1e2a('0x31'))['toString'](a20_0x1e2a('0x32'));console['log'](_0x19f8f9);});_0x1727eb['on'](a20_0x1e2a('0x33'),()=>{});console[a20_0x1e2a('0x10')](_0x59b667);}[a20_0x1e2a('0xe')](){console['log'](a20_0x1e2a('0x11'));this['clientId']=uuidv4();console['log'](a20_0x1e2a('0x34'));console[a20_0x1e2a('0x10')](this[a20_0x1e2a('0x35')]);const _0x2c843e={'clientId':this[a20_0x1e2a('0x35')],'username':a20_0x1e2a('0x36'),'password':'run.lulo_2018#.','clean':!![]};this[a20_0x1e2a('0x37')]=mqtt[a20_0x1e2a('0x20')](a20_0x1e2a('0x38'),_0x2c843e);this[a20_0x1e2a('0x37')]['on']('connect',this[a20_0x1e2a('0x39')][a20_0x1e2a('0x3a')](this));this['mqttClient']['on'](a20_0x1e2a('0x2b'),this[a20_0x1e2a('0x3b')]['bind'](this));this[a20_0x1e2a('0x37')]['on'](a20_0x1e2a('0x29'),()=>{console[a20_0x1e2a('0x10')](a20_0x1e2a('0x29'));});process['on'](a20_0x1e2a('0x3c'),this[a20_0x1e2a('0x3d')]['bind'](this));process['on'](a20_0x1e2a('0x3e'),this[a20_0x1e2a('0x3d')][a20_0x1e2a('0x3a')](this));process['on'](a20_0x1e2a('0x3f'),this['handleAppExit']['bind'](this));}['mqttClient_connect'](){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x40')+this[a20_0x1e2a('0x35')]);this['mqttClient']['subscribe'](a20_0x1e2a('0x41'));this[a20_0x1e2a('0x37')]['subscribe'](a20_0x1e2a('0x42'));this[a20_0x1e2a('0x37')]['subscribe'](a20_0x1e2a('0x43'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x1e2a('0x44'),{'qos':0x2});this[a20_0x1e2a('0x37')]['subscribe'](a20_0x1e2a('0x45'),{'qos':0x2});this[a20_0x1e2a('0x37')][a20_0x1e2a('0x22')](a20_0x1e2a('0x46'),{'qos':0x2});this[a20_0x1e2a('0x37')]['subscribe'](a20_0x1e2a('0x47'),{'qos':0x2});this[a20_0x1e2a('0x37')][a20_0x1e2a('0x22')]('player/register',{'qos':0x2});this[a20_0x1e2a('0x37')][a20_0x1e2a('0x22')]('player/update_settings',{'qos':0x2});this[a20_0x1e2a('0x37')]['subscribe'](a20_0x1e2a('0x48'),{'qos':0x2});this['mqttClient'][a20_0x1e2a('0x22')]('player/turn_on_tv',{'qos':0x2});}['reportStatus'](){}[a20_0x1e2a('0x3b')](_0x351e5c,_0xc2ad48){console[a20_0x1e2a('0x10')]('received\x20message\x20%s\x20%s',_0x351e5c,_0xc2ad48);switch(_0x351e5c){case a20_0x1e2a('0x41'):return this[a20_0x1e2a('0x49')](_0xc2ad48);case a20_0x1e2a('0x42'):return this[a20_0x1e2a('0x4a')](_0xc2ad48);case a20_0x1e2a('0x43'):return this['handleRebootRequest'](_0xc2ad48);case a20_0x1e2a('0x45'):return this[a20_0x1e2a('0x4b')](_0xc2ad48);case'player/load_playlist':return this[a20_0x1e2a('0x4c')](_0xc2ad48);case a20_0x1e2a('0x46'):return this[a20_0x1e2a('0x4d')](_0xc2ad48);case a20_0x1e2a('0x47'):return this[a20_0x1e2a('0x4e')](_0xc2ad48);case a20_0x1e2a('0x4f'):return this['handleRegisterRequest'](_0xc2ad48);case a20_0x1e2a('0x50'):return this['handleUpdateSettingsRequest'](_0xc2ad48);case a20_0x1e2a('0x48'):return this[a20_0x1e2a('0x51')](_0xc2ad48);case a20_0x1e2a('0x52'):return this[a20_0x1e2a('0x53')](_0xc2ad48);}}[a20_0x1e2a('0x54')](_0x50d706){if(_0x50d706=='all'||_0x50d706==String(this['syncPlaylistsService']['playerId'])){this[a20_0x1e2a('0x55')][a20_0x1e2a('0x56')]();}}[a20_0x1e2a('0x4e')](_0x44c1d5){if(_0x44c1d5==a20_0x1e2a('0x57')||_0x44c1d5==String(this[a20_0x1e2a('0x55')][a20_0x1e2a('0x58')])){}}[a20_0x1e2a('0x4d')](_0x382631){console[a20_0x1e2a('0x10')]('handleUpdateRequest:\x20'+_0x382631);if(_0x382631=='all'||_0x382631==String(this['syncPlaylistsService'][a20_0x1e2a('0x58')])){const _0x394735=__dirname;const _0x4ccf51=require(a20_0x1e2a('0x59'))(_0x394735);console['log'](a20_0x1e2a('0x5a'));_0x4ccf51[a20_0x1e2a('0x5b')]((_0x491870,_0x403ebc)=>{if(_0x491870){console[a20_0x1e2a('0x10')]('Error\x20git\x20updated');this[a20_0x1e2a('0x4d')](_0x382631);return;}else{}console[a20_0x1e2a('0x10')]('Git\x20updated');console[a20_0x1e2a('0x10')](_0x403ebc);if(_0x403ebc&&_0x403ebc['summary'][a20_0x1e2a('0x5c')]){this[a20_0x1e2a('0x55')][a20_0x1e2a('0x5d')]();}else{}});}}['handleLoadPlaylistRequest'](_0x530fcb){if(_0x530fcb==a20_0x1e2a('0x57')||_0x530fcb==String(this[a20_0x1e2a('0x55')]['playerId'])){this[a20_0x1e2a('0x55')][a20_0x1e2a('0x5e')]();}}[a20_0x1e2a('0x4b')](_0x1bf3e5){if(String(_0x1bf3e5)==a20_0x1e2a('0x57')||String(_0x1bf3e5)==String(this[a20_0x1e2a('0x55')][a20_0x1e2a('0x58')])){this[a20_0x1e2a('0x55')][a20_0x1e2a('0x5f')]();}}[a20_0x1e2a('0x60')](_0xd24682){if(_0xd24682==a20_0x1e2a('0x57')||_0xd24682==String(this[a20_0x1e2a('0x55')][a20_0x1e2a('0x58')])){console[a20_0x1e2a('0x10')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a20_0x1e2a('0x55')][a20_0x1e2a('0x5d')]();}catch(_0x19ec28){console[a20_0x1e2a('0x10')](_0x19ec28);}}}[a20_0x1e2a('0x61')](_0x25ece1){if(_0x25ece1==a20_0x1e2a('0x57')||_0x25ece1==String(this[a20_0x1e2a('0x55')][a20_0x1e2a('0x58')])){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x62'));try{this['syncPlaylistsService'][a20_0x1e2a('0x63')]();}catch(_0x1ddaf8){console[a20_0x1e2a('0x10')](_0x1ddaf8);}}}['handleTurnOnTVRequest'](_0x5c3285){if(_0x5c3285=='all'||_0x5c3285==String(this['syncPlaylistsService'][a20_0x1e2a('0x58')])){console['log']('handleTurnOnTVRequest:\x20');try{this[a20_0x1e2a('0x55')][a20_0x1e2a('0x64')]();}catch(_0x5ca86b){console[a20_0x1e2a('0x10')](_0x5ca86b);}}}[a20_0x1e2a('0x51')](_0x140c1d){if(_0x140c1d==a20_0x1e2a('0x57')||_0x140c1d==String(this['syncPlaylistsService']['playerId'])){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x65'));try{this[a20_0x1e2a('0x55')][a20_0x1e2a('0x66')]();}catch(_0x16e2b6){console['log'](_0x16e2b6);}}}[a20_0x1e2a('0x67')](){console[a20_0x1e2a('0x10')](a20_0x1e2a('0x68'),this['state']);this['mqttClient'][a20_0x1e2a('0x27')]('player/state',this[a20_0x1e2a('0x55')][a20_0x1e2a('0x58')]+'-'+this[a20_0x1e2a('0x69')]);}['handleOpenRequest'](_0x5939b5){if(this[a20_0x1e2a('0x69')]!=='open'&&this[a20_0x1e2a('0x69')]!==a20_0x1e2a('0x6a')){console[a20_0x1e2a('0x10')]('opening\x20player\x20door');this[a20_0x1e2a('0x69')]=a20_0x1e2a('0x6a');this[a20_0x1e2a('0x67')]();setTimeout(()=>{this[a20_0x1e2a('0x69')]=a20_0x1e2a('0x6b');this[a20_0x1e2a('0x67')]();},0x1388);}}[a20_0x1e2a('0x4a')](_0x496077){if(this['state']!==a20_0x1e2a('0xb')&&this['state']!==a20_0x1e2a('0x6c')){this[a20_0x1e2a('0x69')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a20_0x1e2a('0x69')]=a20_0x1e2a('0xb');this[a20_0x1e2a('0x67')]();},0x1388);}}['handleAppExit'](_0x4feed4,_0x5a695c){if(_0x5a695c){console[a20_0x1e2a('0x10')](_0x5a695c['stack']);}this['mqttClient'][a20_0x1e2a('0x27')](a20_0x1e2a('0x6d'),a20_0x1e2a('0x6e'));}[a20_0x1e2a('0x1d')](_0x5d17f2,_0x24d403,_0x277092){const _0x8996c4={'iat':Math['round'](Date[a20_0x1e2a('0x6f')]()/0x3e8),'exp':Math['round'](Date[a20_0x1e2a('0x6f')]()/0x3e8)+0x14*0x3c,'aud':_0x5d17f2};const _0x10e956=fs[a20_0x1e2a('0x70')](_0x24d403);return jwt[a20_0x1e2a('0x71')](_0x8996c4,_0x10e956,{'algorithm':_0x277092});}}exports[a20_0x1e2a('0x72')]=MqttService;