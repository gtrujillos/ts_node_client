var a18_0x4266=['connect','subscribe','/config','/state','/commands/#','publish','publish\x20result:','close','error','Message\x20received:\x20','startsWith','/commands','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','message','bind','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','reportStatus','mqttClient_message','handleOpenRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','player/ifconfig','player/register','handleRegisterRequest','all','playerId','registerClient','handleIfconfigRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','handleCloseRequest','closing','stack','player/connected','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','exec','is-image','string-template','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','us-central1','RS256','mqtt.googleapis.com','projects/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','round'];(function(_0x23fa3b,_0x4408ce){var _0x502ea1=function(_0xb2e53d){while(--_0xb2e53d){_0x23fa3b['push'](_0x23fa3b['shift']());}};_0x502ea1(++_0x4408ce);}(a18_0x4266,0x117));var a18_0x354b=function(_0x5e4f88,_0x59c844){_0x5e4f88=_0x5e4f88-0x0;var _0x3dbbd7=a18_0x4266[_0x5e4f88];return _0x3dbbd7;};'use strict';Object[a18_0x354b('0x0')](exports,a18_0x354b('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x354b('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x354b('0x3'));const progress=require(a18_0x354b('0x4'));const spawn=require(a18_0x354b('0x5'))[a18_0x354b('0x6')];const exec=require('child_process')[a18_0x354b('0x7')];const isImage=require(a18_0x354b('0x8'));const format=require(a18_0x354b('0x9'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x354b('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1d7a33){this[a18_0x354b('0xb')]=_0x1d7a33;this[a18_0x354b('0xc')]=a18_0x354b('0xd');this[a18_0x354b('0xe')]=new HttpClientService_1[(a18_0x354b('0xf'))]();}[a18_0x354b('0x10')](){this[a18_0x354b('0x11')]();}[a18_0x354b('0x12')](){console[a18_0x354b('0x13')](a18_0x354b('0x14'));const _0x4a9ad0=a18_0x354b('0x15');const _0x404412='my-node-device';const _0x4fedbc=a18_0x354b('0x16');const _0x4c7e28=a18_0x354b('0x17');const _0x349f07=a18_0x354b('0x18');const _0xcf26bd='resources/keys/rsa_private.pem';const _0x30b32e=a18_0x354b('0x19');const _0x2f5bd2=0x1bb;const _0x4c6768='events';const _0x135051=0x5;const _0x9caee5=a18_0x354b('0x1a')+_0x4a9ad0+'/locations/'+_0x4c7e28+a18_0x354b('0x1b')+_0x4fedbc+a18_0x354b('0x1c')+_0x404412;const _0x5e8904={'host':_0x30b32e,'port':_0x2f5bd2,'clientId':_0x9caee5,'username':a18_0x354b('0x1d'),'password':this[a18_0x354b('0x1e')](_0x4a9ad0,_0xcf26bd,_0x349f07),'protocol':'mqtts','secureProtocol':a18_0x354b('0x1f')};const _0x43a4d4=Math[a18_0x354b('0x20')](Date['now']()/0x3e8);const _0x7677b8=mqtt[a18_0x354b('0x21')](_0x5e8904);_0x7677b8[a18_0x354b('0x22')]('/devices/'+_0x404412+a18_0x354b('0x23'),{'qos':0x1});_0x7677b8['subscribe'](a18_0x354b('0x1c')+_0x404412+a18_0x354b('0x24'),{'qos':0x1});_0x7677b8[a18_0x354b('0x22')]('/devices/'+_0x404412+a18_0x354b('0x25'),{'qos':0x0});const _0xb65631=a18_0x354b('0x1c')+_0x404412+'/'+_0x4c6768;_0x7677b8['on'](a18_0x354b('0x21'),_0x270b71=>{console[a18_0x354b('0x13')]('connect');if(!_0x270b71){console[a18_0x354b('0x13')]('Client\x20not\x20connected...');}else{const _0xb65631='/projects/velvety-glazing-252020/topics/my-topic';const _0x1f8488=_0x4fedbc+'/'+_0x404412+'-payload-0';_0x7677b8[a18_0x354b('0x26')](_0xb65631,_0x1f8488,{'qos':0x1},_0x27a7a2=>{console['log'](a18_0x354b('0x27'));console[a18_0x354b('0x13')](_0x27a7a2);if(!_0x27a7a2){}});}});_0x7677b8['on']('close',()=>{console['log'](a18_0x354b('0x28'));});_0x7677b8['on'](a18_0x354b('0x29'),_0x18f62b=>{console[a18_0x354b('0x13')](a18_0x354b('0x29'),_0x18f62b);});_0x7677b8['on']('message',(_0x3fa9b1,_0x6489b1)=>{let _0x42d9f3=a18_0x354b('0x2a');console[a18_0x354b('0x13')](_0x3fa9b1);console['log'](_0x6489b1+'');if(_0x3fa9b1===a18_0x354b('0x1c')+_0x404412+'/config'){_0x42d9f3='Config\x20message\x20received:\x20';}else if(_0x3fa9b1[a18_0x354b('0x2b')](a18_0x354b('0x1c')+_0x404412+a18_0x354b('0x2c'))){_0x42d9f3='Command\x20message\x20received:\x20';}_0x42d9f3+=Buffer[a18_0x354b('0x2d')](_0x6489b1,a18_0x354b('0x2e'))[a18_0x354b('0x2f')](a18_0x354b('0x30'));console[a18_0x354b('0x13')](_0x42d9f3);});_0x7677b8['on'](a18_0x354b('0x31'),()=>{});console[a18_0x354b('0x13')](_0x5e8904);}[a18_0x354b('0x11')](){console['log'](a18_0x354b('0x14'));this[a18_0x354b('0x32')]=uuidv4();console[a18_0x354b('0x13')](a18_0x354b('0x33'));console[a18_0x354b('0x13')](this[a18_0x354b('0x32')]);const _0x3742d3={'clientId':this['clientId'],'username':a18_0x354b('0x34'),'password':a18_0x354b('0x35'),'clean':!![]};this[a18_0x354b('0x36')]=mqtt[a18_0x354b('0x21')]('mqtt://lulo.run',_0x3742d3);this[a18_0x354b('0x36')]['on'](a18_0x354b('0x21'),this[a18_0x354b('0x37')]['bind'](this));this[a18_0x354b('0x36')]['on'](a18_0x354b('0x38'),this['mqttClient_message'][a18_0x354b('0x39')](this));this[a18_0x354b('0x36')]['on'](a18_0x354b('0x28'),()=>{console[a18_0x354b('0x13')](a18_0x354b('0x28'));});process['on']('exit',this[a18_0x354b('0x3a')]['bind'](this));process['on'](a18_0x354b('0x3b'),this[a18_0x354b('0x3a')][a18_0x354b('0x39')](this));process['on']('uncaughtException',this[a18_0x354b('0x3a')][a18_0x354b('0x39')](this));}['mqttClient_connect'](){console[a18_0x354b('0x13')](a18_0x354b('0x3c')+this[a18_0x354b('0x32')]);this[a18_0x354b('0x36')]['subscribe'](a18_0x354b('0x3d'));this[a18_0x354b('0x36')][a18_0x354b('0x22')](a18_0x354b('0x3e'));this[a18_0x354b('0x36')]['subscribe'](a18_0x354b('0x3f'),{'qos':0x2});this[a18_0x354b('0x36')][a18_0x354b('0x22')](a18_0x354b('0x40'),{'qos':0x2});this[a18_0x354b('0x36')][a18_0x354b('0x22')](a18_0x354b('0x41'),{'qos':0x2});this[a18_0x354b('0x36')][a18_0x354b('0x22')]('player/update',{'qos':0x2});this[a18_0x354b('0x36')]['subscribe']('player/ifconfig',{'qos':0x2});this[a18_0x354b('0x36')]['subscribe']('player/register',{'qos':0x2});}[a18_0x354b('0x42')](){}[a18_0x354b('0x43')](_0x4cc2e7,_0x4f2296){console[a18_0x354b('0x13')]('received\x20message\x20%s\x20%s',_0x4cc2e7,_0x4f2296);switch(_0x4cc2e7){case a18_0x354b('0x3d'):return this[a18_0x354b('0x44')](_0x4f2296);case a18_0x354b('0x3e'):return this['handleCloseRequest'](_0x4f2296);case a18_0x354b('0x3f'):return this['handleRebootRequest'](_0x4f2296);case a18_0x354b('0x41'):return this[a18_0x354b('0x45')](_0x4f2296);case a18_0x354b('0x40'):return this[a18_0x354b('0x46')](_0x4f2296);case a18_0x354b('0x47'):return this[a18_0x354b('0x48')](_0x4f2296);case a18_0x354b('0x49'):return this['handleIfconfigRequest'](_0x4f2296);case a18_0x354b('0x4a'):return this['handleRegisterRequest'](_0x4f2296);}}[a18_0x354b('0x4b')](_0x139485){if(_0x139485==a18_0x354b('0x4c')||_0x139485==String(this[a18_0x354b('0xb')][a18_0x354b('0x4d')])){this['syncPlaylistsService'][a18_0x354b('0x4e')]();}}[a18_0x354b('0x4f')](_0x33371e){if(_0x33371e=='all'||_0x33371e==String(this['syncPlaylistsService'][a18_0x354b('0x4d')])){}}[a18_0x354b('0x48')](_0x96c2bd){console[a18_0x354b('0x13')](a18_0x354b('0x50')+_0x96c2bd);if(_0x96c2bd==a18_0x354b('0x4c')||_0x96c2bd==String(this[a18_0x354b('0xb')][a18_0x354b('0x4d')])){const _0x43a6a2=__dirname;const _0x30fb3a=require(a18_0x354b('0x51'))(_0x43a6a2);console['log'](a18_0x354b('0x52'));_0x30fb3a[a18_0x354b('0x53')]((_0x4923f1,_0x2a7781)=>{if(_0x4923f1){console[a18_0x354b('0x13')](a18_0x354b('0x54'));this[a18_0x354b('0x48')](_0x96c2bd);return;}else{}console[a18_0x354b('0x13')]('Git\x20updated');console[a18_0x354b('0x13')](_0x2a7781);if(_0x2a7781&&_0x2a7781['summary']['changes']){this['syncPlaylistsService']['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x227c47){if(_0x227c47==a18_0x354b('0x4c')||_0x227c47==String(this['syncPlaylistsService'][a18_0x354b('0x4d')])){this['syncPlaylistsService'][a18_0x354b('0x55')]();}}[a18_0x354b('0x45')](_0x53734c){if(String(_0x53734c)==a18_0x354b('0x4c')||String(_0x53734c)==String(this[a18_0x354b('0xb')][a18_0x354b('0x4d')])){this[a18_0x354b('0xb')][a18_0x354b('0x56')]();}}[a18_0x354b('0x57')](_0x487cc8){if(_0x487cc8==a18_0x354b('0x4c')||_0x487cc8==String(this[a18_0x354b('0xb')][a18_0x354b('0x4d')])){console[a18_0x354b('0x13')](a18_0x354b('0x58'));try{this[a18_0x354b('0xb')][a18_0x354b('0x59')]();}catch(_0x3d7e67){console[a18_0x354b('0x13')](_0x3d7e67);}}}[a18_0x354b('0x5a')](){console[a18_0x354b('0x13')](a18_0x354b('0x5b'),this[a18_0x354b('0xc')]);this[a18_0x354b('0x36')][a18_0x354b('0x26')](a18_0x354b('0x5c'),this[a18_0x354b('0xb')][a18_0x354b('0x4d')]+'-'+this[a18_0x354b('0xc')]);}[a18_0x354b('0x44')](_0xd60802){if(this[a18_0x354b('0xc')]!==a18_0x354b('0x5d')&&this[a18_0x354b('0xc')]!==a18_0x354b('0x5e')){console[a18_0x354b('0x13')](a18_0x354b('0x5f'));this[a18_0x354b('0xc')]='opening';this[a18_0x354b('0x5a')]();setTimeout(()=>{this['state']='open';this[a18_0x354b('0x5a')]();},0x1388);}}[a18_0x354b('0x60')](_0x467167){if(this[a18_0x354b('0xc')]!==a18_0x354b('0xd')&&this[a18_0x354b('0xc')]!=='closing'){this[a18_0x354b('0xc')]=a18_0x354b('0x61');this[a18_0x354b('0x5a')]();setTimeout(()=>{this['state']=a18_0x354b('0xd');this[a18_0x354b('0x5a')]();},0x1388);}}[a18_0x354b('0x3a')](_0xb2bdd2,_0x40940d){if(_0x40940d){console[a18_0x354b('0x13')](_0x40940d[a18_0x354b('0x62')]);}this[a18_0x354b('0x36')][a18_0x354b('0x26')](a18_0x354b('0x63'),'false');}[a18_0x354b('0x1e')](_0x56cbbc,_0x10aaf5,_0x35e3a5){const _0x3379d3={'iat':Math[a18_0x354b('0x20')](Date[a18_0x354b('0x64')]()/0x3e8),'exp':Math[a18_0x354b('0x20')](Date[a18_0x354b('0x64')]()/0x3e8)+0x14*0x3c,'aud':_0x56cbbc};const _0x36f6cc=fs[a18_0x354b('0x65')](_0x10aaf5);return jwt[a18_0x354b('0x66')](_0x3379d3,_0x36f6cc,{'algorithm':_0x35e3a5});}}exports[a18_0x354b('0x67')]=MqttService;