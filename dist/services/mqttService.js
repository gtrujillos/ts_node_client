var a18_0x2fb0=['changes','shutdown','now','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','open','opening','opening\x20player\x20door','closing','stack','false','MqttService','defineProperty','__esModule','fs-extra','request','request-progress','child_process','spawn','is-image','string-template','mqtt','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','log','clientId','this.clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','exit','handleAppExit','SIGINT','player/open','subscribe','player/close','player/reboot','player/reload_playlist','player/update','player/ifconfig','player/register','mqttClient_message','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/load_playlist','handleLoadPlaylistRequest','handleUpdateRequest','all','playerId','handleIfconfigRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary'];(function(_0x589f7e,_0x199a91){var _0x4053b2=function(_0x5c43c0){while(--_0x5c43c0){_0x589f7e['push'](_0x589f7e['shift']());}};_0x4053b2(++_0x199a91);}(a18_0x2fb0,0xe3));var a18_0x398b=function(_0x30445e,_0x35c8ef){_0x30445e=_0x30445e-0x0;var _0x52a5c4=a18_0x2fb0[_0x30445e];return _0x52a5c4;};'use strict';Object[a18_0x398b('0x0')](exports,a18_0x398b('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x398b('0x2'));const request=require(a18_0x398b('0x3'));const progress=require(a18_0x398b('0x4'));const spawn=require(a18_0x398b('0x5'))[a18_0x398b('0x6')];const isImage=require(a18_0x398b('0x7'));const format=require(a18_0x398b('0x8'));const os=require('os');const mqtt=require(a18_0x398b('0x9'));const uuidv4=require('uuid/v4');class MqttService{constructor(_0xffb3fc){this[a18_0x398b('0xa')]=_0xffb3fc;this[a18_0x398b('0xb')]=a18_0x398b('0xc');this[a18_0x398b('0xd')]=new HttpClientService_1[(a18_0x398b('0xe'))]();}[a18_0x398b('0xf')](){this['mqttInit']();}['mqttInit'](){console[a18_0x398b('0x10')]('mqttInit');this[a18_0x398b('0x11')]=uuidv4();console['log'](a18_0x398b('0x12'));console['log'](this[a18_0x398b('0x11')]);const _0x391bb2={'clientId':this[a18_0x398b('0x11')],'username':a18_0x398b('0x13'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x398b('0x14')]=mqtt[a18_0x398b('0x15')](a18_0x398b('0x16'),_0x391bb2);this[a18_0x398b('0x14')]['on'](a18_0x398b('0x15'),this[a18_0x398b('0x17')][a18_0x398b('0x18')](this));this[a18_0x398b('0x14')]['on'](a18_0x398b('0x19'),this['mqttClient_message'][a18_0x398b('0x18')](this));process['on'](a18_0x398b('0x1a'),this[a18_0x398b('0x1b')][a18_0x398b('0x18')](this));process['on'](a18_0x398b('0x1c'),this[a18_0x398b('0x1b')][a18_0x398b('0x18')](this));process['on']('uncaughtException',this[a18_0x398b('0x1b')][a18_0x398b('0x18')](this));}['mqttClient_connect'](){console[a18_0x398b('0x10')]('Connected\x20to\x20broker\x20client:'+this[a18_0x398b('0x11')]);this[a18_0x398b('0x14')]['subscribe'](a18_0x398b('0x1d'));this[a18_0x398b('0x14')][a18_0x398b('0x1e')](a18_0x398b('0x1f'));this['mqttClient'][a18_0x398b('0x1e')](a18_0x398b('0x20'),{'qos':0x2});this[a18_0x398b('0x14')]['subscribe']('player/load_playlist',{'qos':0x2});this[a18_0x398b('0x14')][a18_0x398b('0x1e')](a18_0x398b('0x21'),{'qos':0x2});this[a18_0x398b('0x14')]['subscribe'](a18_0x398b('0x22'),{'qos':0x2});this[a18_0x398b('0x14')][a18_0x398b('0x1e')](a18_0x398b('0x23'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x398b('0x24'),{'qos':0x2});}['reportStatus'](){}[a18_0x398b('0x25')](_0x5d8df2,_0x20967d){console[a18_0x398b('0x10')]('received\x20message\x20%s\x20%s',_0x5d8df2,_0x20967d);switch(_0x5d8df2){case a18_0x398b('0x1d'):return this[a18_0x398b('0x26')](_0x20967d);case a18_0x398b('0x1f'):return this[a18_0x398b('0x27')](_0x20967d);case a18_0x398b('0x20'):return this[a18_0x398b('0x28')](_0x20967d);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x20967d);case a18_0x398b('0x29'):return this[a18_0x398b('0x2a')](_0x20967d);case a18_0x398b('0x22'):return this[a18_0x398b('0x2b')](_0x20967d);case a18_0x398b('0x23'):return this['handleIfconfigRequest'](_0x20967d);case a18_0x398b('0x24'):return this['handleRegisterRequest'](_0x20967d);}}['handleRegisterRequest'](_0x8825cd){if(_0x8825cd==a18_0x398b('0x2c')||_0x8825cd==String(this['syncPlaylistsService'][a18_0x398b('0x2d')])){this[a18_0x398b('0xa')]['registerClient']();}}[a18_0x398b('0x2e')](_0x1aa279){if(_0x1aa279==a18_0x398b('0x2c')||_0x1aa279==String(this[a18_0x398b('0xa')]['playerId'])){}}[a18_0x398b('0x2b')](_0x39940f){console[a18_0x398b('0x10')](a18_0x398b('0x2f')+_0x39940f);if(_0x39940f==a18_0x398b('0x2c')||_0x39940f==String(this[a18_0x398b('0xa')][a18_0x398b('0x2d')])){const _0x58e6f1=__dirname;const _0x509e46=require(a18_0x398b('0x30'))(_0x58e6f1);console['log'](a18_0x398b('0x31'));_0x509e46['pull']((_0x4ca762,_0x3eef89)=>{if(_0x4ca762){console[a18_0x398b('0x10')](a18_0x398b('0x32'));this[a18_0x398b('0x2b')](_0x39940f);return;}else{}console[a18_0x398b('0x10')](a18_0x398b('0x33'));console[a18_0x398b('0x10')](_0x3eef89);if(_0x3eef89&&_0x3eef89[a18_0x398b('0x34')][a18_0x398b('0x35')]){const _0x7ea35c=spawn(a18_0x398b('0x36'),['-r',a18_0x398b('0x37')]);}else{}});}}[a18_0x398b('0x2a')](_0x1a7669){if(_0x1a7669=='all'||_0x1a7669==String(this[a18_0x398b('0xa')][a18_0x398b('0x2d')])){this['syncPlaylistsService'][a18_0x398b('0x38')]();}}[a18_0x398b('0x39')](_0x392509){if(String(_0x392509)==a18_0x398b('0x2c')||String(_0x392509)==String(this[a18_0x398b('0xa')][a18_0x398b('0x2d')])){this[a18_0x398b('0xa')][a18_0x398b('0x3a')]();}}[a18_0x398b('0x28')](_0x3755e4){if(_0x3755e4==a18_0x398b('0x2c')||_0x3755e4==String(this[a18_0x398b('0xa')][a18_0x398b('0x2d')])){const _0x2242d5=spawn(a18_0x398b('0x36'),['-r',a18_0x398b('0x37')]);}}[a18_0x398b('0x3b')](){console[a18_0x398b('0x10')](a18_0x398b('0x3c'),this['state']);this[a18_0x398b('0x14')][a18_0x398b('0x3d')](a18_0x398b('0x3e'),this['syncPlaylistsService']['playerId']+'-'+this[a18_0x398b('0xb')]);}[a18_0x398b('0x26')](_0x487b87){if(this[a18_0x398b('0xb')]!==a18_0x398b('0x3f')&&this[a18_0x398b('0xb')]!==a18_0x398b('0x40')){console[a18_0x398b('0x10')](a18_0x398b('0x41'));this[a18_0x398b('0xb')]=a18_0x398b('0x40');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x398b('0xb')]=a18_0x398b('0x3f');this[a18_0x398b('0x3b')]();},0x1388);}}[a18_0x398b('0x27')](_0x4bf115){if(this[a18_0x398b('0xb')]!==a18_0x398b('0xc')&&this[a18_0x398b('0xb')]!==a18_0x398b('0x42')){this['state']=a18_0x398b('0x42');this[a18_0x398b('0x3b')]();setTimeout(()=>{this[a18_0x398b('0xb')]=a18_0x398b('0xc');this[a18_0x398b('0x3b')]();},0x1388);}}[a18_0x398b('0x1b')](_0x59bac9,_0x37503d){if(_0x37503d){console[a18_0x398b('0x10')](_0x37503d[a18_0x398b('0x43')]);}this[a18_0x398b('0x14')][a18_0x398b('0x3d')]('player/connected',a18_0x398b('0x44'));}}exports[a18_0x398b('0x45')]=MqttService;