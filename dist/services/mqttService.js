var a18_0x558a=['reloadMediaList','reboot','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','closing','stack','false','readFileSync','sign','MqttService','defineProperty','__esModule','fs-extra','request','request-progress','spawn','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','mqttInit_google','log','mqttInit','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/locations/','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','round','now','subscribe','/config','/state','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Config\x20message\x20received:\x20','base64','toString','ascii','packetsend','mqttInit_mosquitto','clientId','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','loadMediaList'];(function(_0x208c99,_0x297704){var _0xfb741d=function(_0xe4153b){while(--_0xe4153b){_0x208c99['push'](_0x208c99['shift']());}};_0xfb741d(++_0x297704);}(a18_0x558a,0x14f));var a18_0x4c76=function(_0x417d16,_0x4a5f0f){_0x417d16=_0x417d16-0x0;var _0x2d056f=a18_0x558a[_0x417d16];return _0x2d056f;};'use strict';Object[a18_0x4c76('0x0')](exports,a18_0x4c76('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x4c76('0x2'));const request=require(a18_0x4c76('0x3'));const progress=require(a18_0x4c76('0x4'));const spawn=require('child_process')[a18_0x4c76('0x5')];const isImage=require(a18_0x4c76('0x6'));const format=require(a18_0x4c76('0x7'));const os=require('os');const mqtt=require(a18_0x4c76('0x8'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x4c76('0x9'));class MqttService{constructor(_0x376190){this[a18_0x4c76('0xa')]=_0x376190;this[a18_0x4c76('0xb')]=a18_0x4c76('0xc');this[a18_0x4c76('0xd')]=new HttpClientService_1[(a18_0x4c76('0xe'))]();}['init'](){this['mqttInit_mosquitto']();}[a18_0x4c76('0xf')](){console[a18_0x4c76('0x10')](a18_0x4c76('0x11'));const _0x22be29='velvety-glazing-252020';const _0x3eb1be=a18_0x4c76('0x12');const _0x2aa873='my-registry';const _0x366bda=a18_0x4c76('0x13');const _0x4df157=a18_0x4c76('0x14');const _0x311b9e=a18_0x4c76('0x15');const _0x40a21e=a18_0x4c76('0x16');const _0x5842ad=0x1bb;const _0x5255ad=a18_0x4c76('0x17');const _0xac9d51=0x5;const _0x5de5f7='projects/'+_0x22be29+a18_0x4c76('0x18')+_0x366bda+a18_0x4c76('0x19')+_0x2aa873+a18_0x4c76('0x1a')+_0x3eb1be;const _0x41ff77={'host':_0x40a21e,'port':_0x5842ad,'clientId':_0x5de5f7,'username':'unused','password':this[a18_0x4c76('0x1b')](_0x22be29,_0x311b9e,_0x4df157),'protocol':a18_0x4c76('0x1c'),'secureProtocol':a18_0x4c76('0x1d')};const _0x3f1f42=Math[a18_0x4c76('0x1e')](Date[a18_0x4c76('0x1f')]()/0x3e8);const _0x40fd5e=mqtt['connect'](_0x41ff77);_0x40fd5e[a18_0x4c76('0x20')]('/devices/'+_0x3eb1be+a18_0x4c76('0x21'),{'qos':0x1});_0x40fd5e[a18_0x4c76('0x20')](a18_0x4c76('0x1a')+_0x3eb1be+a18_0x4c76('0x22'),{'qos':0x1});_0x40fd5e[a18_0x4c76('0x20')]('/devices/'+_0x3eb1be+a18_0x4c76('0x23'),{'qos':0x0});const _0x322426='/devices/'+_0x3eb1be+'/'+_0x5255ad;_0x40fd5e['on']('connect',_0x4bc7c0=>{console[a18_0x4c76('0x10')](a18_0x4c76('0x24'));if(!_0x4bc7c0){console[a18_0x4c76('0x10')](a18_0x4c76('0x25'));}else{const _0x322426=a18_0x4c76('0x26');const _0x1735fa=_0x2aa873+'/'+_0x3eb1be+a18_0x4c76('0x27');_0x40fd5e[a18_0x4c76('0x28')](_0x322426,_0x1735fa,{'qos':0x1},_0x4d73f0=>{console['log'](a18_0x4c76('0x29'));console['log'](_0x4d73f0);if(!_0x4d73f0){}});}});_0x40fd5e['on'](a18_0x4c76('0x2a'),()=>{console[a18_0x4c76('0x10')](a18_0x4c76('0x2a'));});_0x40fd5e['on'](a18_0x4c76('0x2b'),_0x3b03a2=>{console[a18_0x4c76('0x10')](a18_0x4c76('0x2b'),_0x3b03a2);});_0x40fd5e['on'](a18_0x4c76('0x2c'),(_0x5aedd2,_0x215898)=>{let _0x5e19eb='Message\x20received:\x20';console['log'](_0x5aedd2);console[a18_0x4c76('0x10')](_0x215898+'');if(_0x5aedd2===a18_0x4c76('0x1a')+_0x3eb1be+'/config'){_0x5e19eb=a18_0x4c76('0x2d');}else if(_0x5aedd2['startsWith']('/devices/'+_0x3eb1be+'/commands')){_0x5e19eb='Command\x20message\x20received:\x20';}_0x5e19eb+=Buffer['from'](_0x215898,a18_0x4c76('0x2e'))[a18_0x4c76('0x2f')](a18_0x4c76('0x30'));console[a18_0x4c76('0x10')](_0x5e19eb);});_0x40fd5e['on'](a18_0x4c76('0x31'),()=>{});console['log'](_0x41ff77);}[a18_0x4c76('0x32')](){console[a18_0x4c76('0x10')]('mqttInit');this[a18_0x4c76('0x33')]=uuidv4();console[a18_0x4c76('0x10')](a18_0x4c76('0x34'));console[a18_0x4c76('0x10')](this[a18_0x4c76('0x33')]);const _0x56c828={'clientId':this[a18_0x4c76('0x33')],'username':'lulo_mqtt','password':a18_0x4c76('0x35'),'clean':!![]};this[a18_0x4c76('0x36')]=mqtt[a18_0x4c76('0x24')](a18_0x4c76('0x37'),_0x56c828);this[a18_0x4c76('0x36')]['on'](a18_0x4c76('0x24'),this[a18_0x4c76('0x38')][a18_0x4c76('0x39')](this));this[a18_0x4c76('0x36')]['on'](a18_0x4c76('0x2c'),this[a18_0x4c76('0x3a')][a18_0x4c76('0x39')](this));this[a18_0x4c76('0x36')]['on'](a18_0x4c76('0x2a'),()=>{console[a18_0x4c76('0x10')](a18_0x4c76('0x2a'));});process['on'](a18_0x4c76('0x3b'),this[a18_0x4c76('0x3c')][a18_0x4c76('0x39')](this));process['on'](a18_0x4c76('0x3d'),this[a18_0x4c76('0x3c')][a18_0x4c76('0x39')](this));process['on']('uncaughtException',this[a18_0x4c76('0x3c')][a18_0x4c76('0x39')](this));}['mqttClient_connect'](){console[a18_0x4c76('0x10')](a18_0x4c76('0x3e')+this['clientId']);this[a18_0x4c76('0x36')][a18_0x4c76('0x20')](a18_0x4c76('0x3f'));this['mqttClient'][a18_0x4c76('0x20')](a18_0x4c76('0x40'));this['mqttClient']['subscribe'](a18_0x4c76('0x41'),{'qos':0x2});this[a18_0x4c76('0x36')][a18_0x4c76('0x20')](a18_0x4c76('0x42'),{'qos':0x2});this[a18_0x4c76('0x36')][a18_0x4c76('0x20')](a18_0x4c76('0x43'),{'qos':0x2});this[a18_0x4c76('0x36')]['subscribe'](a18_0x4c76('0x44'),{'qos':0x2});this['mqttClient'][a18_0x4c76('0x20')](a18_0x4c76('0x45'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x4c76('0x46'),{'qos':0x2});}[a18_0x4c76('0x47')](){}[a18_0x4c76('0x3a')](_0x4d664a,_0x2fcb65){console[a18_0x4c76('0x10')](a18_0x4c76('0x48'),_0x4d664a,_0x2fcb65);switch(_0x4d664a){case a18_0x4c76('0x3f'):return this[a18_0x4c76('0x49')](_0x2fcb65);case a18_0x4c76('0x40'):return this[a18_0x4c76('0x4a')](_0x2fcb65);case a18_0x4c76('0x41'):return this[a18_0x4c76('0x4b')](_0x2fcb65);case a18_0x4c76('0x43'):return this[a18_0x4c76('0x4c')](_0x2fcb65);case a18_0x4c76('0x42'):return this[a18_0x4c76('0x4d')](_0x2fcb65);case a18_0x4c76('0x44'):return this[a18_0x4c76('0x4e')](_0x2fcb65);case a18_0x4c76('0x45'):return this[a18_0x4c76('0x4f')](_0x2fcb65);case a18_0x4c76('0x46'):return this['handleRegisterRequest'](_0x2fcb65);}}['handleRegisterRequest'](_0x523d90){if(_0x523d90=='all'||_0x523d90==String(this[a18_0x4c76('0xa')][a18_0x4c76('0x50')])){this[a18_0x4c76('0xa')][a18_0x4c76('0x51')]();}}[a18_0x4c76('0x4f')](_0x15c8b8){if(_0x15c8b8==a18_0x4c76('0x52')||_0x15c8b8==String(this[a18_0x4c76('0xa')]['playerId'])){}}[a18_0x4c76('0x4e')](_0x2e7591){console[a18_0x4c76('0x10')](a18_0x4c76('0x53')+_0x2e7591);if(_0x2e7591==a18_0x4c76('0x52')||_0x2e7591==String(this[a18_0x4c76('0xa')][a18_0x4c76('0x50')])){const _0x56ccde=__dirname;const _0x4dacb8=require(a18_0x4c76('0x54'))(_0x56ccde);console['log'](a18_0x4c76('0x55'));_0x4dacb8[a18_0x4c76('0x56')]((_0x4989c5,_0x205fae)=>{if(_0x4989c5){console[a18_0x4c76('0x10')](a18_0x4c76('0x57'));this[a18_0x4c76('0x4e')](_0x2e7591);return;}else{}console['log'](a18_0x4c76('0x58'));console[a18_0x4c76('0x10')](_0x205fae);if(_0x205fae&&_0x205fae[a18_0x4c76('0x59')][a18_0x4c76('0x5a')]){const _0x26a02a=spawn(a18_0x4c76('0x5b'),['-r','now']);}else{}});}}[a18_0x4c76('0x4d')](_0x380066){if(_0x380066==a18_0x4c76('0x52')||_0x380066==String(this[a18_0x4c76('0xa')]['playerId'])){this[a18_0x4c76('0xa')][a18_0x4c76('0x5c')]();}}['handleReloadPlaylistRequest'](_0x771923){if(String(_0x771923)==a18_0x4c76('0x52')||String(_0x771923)==String(this[a18_0x4c76('0xa')][a18_0x4c76('0x50')])){this[a18_0x4c76('0xa')][a18_0x4c76('0x5d')]();}}[a18_0x4c76('0x4b')](_0x4a70dc){if(_0x4a70dc==a18_0x4c76('0x52')||_0x4a70dc==String(this['syncPlaylistsService']['playerId'])){console[a18_0x4c76('0x10')]('handleRebootRequest');try{require(a18_0x4c76('0x5e'))[a18_0x4c76('0x5e')]();}catch(_0x2a513d){console['log'](_0x2a513d);}}}['sendStateUpdate'](){console['log'](a18_0x4c76('0x5f'),this[a18_0x4c76('0xb')]);this['mqttClient'][a18_0x4c76('0x28')](a18_0x4c76('0x60'),this['syncPlaylistsService'][a18_0x4c76('0x50')]+'-'+this[a18_0x4c76('0xb')]);}[a18_0x4c76('0x49')](_0x482907){if(this['state']!==a18_0x4c76('0x61')&&this[a18_0x4c76('0xb')]!==a18_0x4c76('0x62')){console[a18_0x4c76('0x10')](a18_0x4c76('0x63'));this[a18_0x4c76('0xb')]='opening';this['sendStateUpdate']();setTimeout(()=>{this['state']=a18_0x4c76('0x61');this[a18_0x4c76('0x64')]();},0x1388);}}[a18_0x4c76('0x4a')](_0x547222){if(this['state']!=='closed'&&this['state']!==a18_0x4c76('0x65')){this[a18_0x4c76('0xb')]=a18_0x4c76('0x65');this[a18_0x4c76('0x64')]();setTimeout(()=>{this['state']=a18_0x4c76('0xc');this[a18_0x4c76('0x64')]();},0x1388);}}['handleAppExit'](_0x117730,_0xfe3031){if(_0xfe3031){console[a18_0x4c76('0x10')](_0xfe3031[a18_0x4c76('0x66')]);}this['mqttClient'][a18_0x4c76('0x28')]('player/connected',a18_0x4c76('0x67'));}[a18_0x4c76('0x1b')](_0x50bdc3,_0x201493,_0x2f7ab7){const _0x1d43a2={'iat':Math[a18_0x4c76('0x1e')](Date['now']()/0x3e8),'exp':Math[a18_0x4c76('0x1e')](Date[a18_0x4c76('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x50bdc3};const _0x239f04=fs[a18_0x4c76('0x68')](_0x201493);return jwt[a18_0x4c76('0x69')](_0x1d43a2,_0x239f04,{'algorithm':_0x2f7ab7});}}exports[a18_0x4c76('0x6a')]=MqttService;