var a20_0x160e=['Config\x20message\x20received:\x20','startsWith','/commands','from','toString','ascii','mqttInit_mosquitto','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','mqttClient_message','SIGINT','handleAppExit','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','changes','reboot','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','stack','player/connected','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','string-template','mqtt','syncPlaylistsService','state','closed','HttpClientService','init','mqttInit_google','log','mqttInit','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/state','/commands/#','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20'];(function(_0x291edb,_0x1538cf){var _0x227752=function(_0x222b7d){while(--_0x222b7d){_0x291edb['push'](_0x291edb['shift']());}};_0x227752(++_0x1538cf);}(a20_0x160e,0x12e));var a20_0x59ec=function(_0x3472d1,_0x41581d){_0x3472d1=_0x3472d1-0x0;var _0x5b6492=a20_0x160e[_0x3472d1];return _0x5b6492;};'use strict';Object[a20_0x59ec('0x0')](exports,a20_0x59ec('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x59ec('0x2'));const fs=require('fs');const fsExtra=require(a20_0x59ec('0x3'));const request=require(a20_0x59ec('0x4'));const progress=require('request-progress');const spawn=require(a20_0x59ec('0x5'))[a20_0x59ec('0x6')];const exec=require(a20_0x59ec('0x5'))[a20_0x59ec('0x7')];const isImage=require(a20_0x59ec('0x8'));const format=require(a20_0x59ec('0x9'));const os=require('os');const mqtt=require(a20_0x59ec('0xa'));const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x32740a){this[a20_0x59ec('0xb')]=_0x32740a;this[a20_0x59ec('0xc')]=a20_0x59ec('0xd');this['httpClientService']=new HttpClientService_1[(a20_0x59ec('0xe'))]();}[a20_0x59ec('0xf')](){this['mqttInit_mosquitto']();}[a20_0x59ec('0x10')](){console[a20_0x59ec('0x11')](a20_0x59ec('0x12'));const _0x543af9='velvety-glazing-252020';const _0x3db058=a20_0x59ec('0x13');const _0x23fcb7=a20_0x59ec('0x14');const _0x352826=a20_0x59ec('0x15');const _0x89d2cc=a20_0x59ec('0x16');const _0x1d9012=a20_0x59ec('0x17');const _0x16f6f5=a20_0x59ec('0x18');const _0x4d406b=0x1bb;const _0x21137e=a20_0x59ec('0x19');const _0x424f53=0x5;const _0x4b8c5b=a20_0x59ec('0x1a')+_0x543af9+a20_0x59ec('0x1b')+_0x352826+a20_0x59ec('0x1c')+_0x23fcb7+'/devices/'+_0x3db058;const _0x4d3a91={'host':_0x16f6f5,'port':_0x4d406b,'clientId':_0x4b8c5b,'username':a20_0x59ec('0x1d'),'password':this[a20_0x59ec('0x1e')](_0x543af9,_0x1d9012,_0x89d2cc),'protocol':a20_0x59ec('0x1f'),'secureProtocol':a20_0x59ec('0x20')};const _0x238d8c=Math[a20_0x59ec('0x21')](Date[a20_0x59ec('0x22')]()/0x3e8);const _0x251ed7=mqtt[a20_0x59ec('0x23')](_0x4d3a91);_0x251ed7[a20_0x59ec('0x24')](a20_0x59ec('0x25')+_0x3db058+a20_0x59ec('0x26'),{'qos':0x1});_0x251ed7[a20_0x59ec('0x24')]('/devices/'+_0x3db058+a20_0x59ec('0x27'),{'qos':0x1});_0x251ed7[a20_0x59ec('0x24')]('/devices/'+_0x3db058+a20_0x59ec('0x28'),{'qos':0x0});const _0x5ddad8='/devices/'+_0x3db058+'/'+_0x21137e;_0x251ed7['on'](a20_0x59ec('0x23'),_0x474a7a=>{console[a20_0x59ec('0x11')](a20_0x59ec('0x23'));if(!_0x474a7a){console[a20_0x59ec('0x11')]('Client\x20not\x20connected...');}else{const _0x5ddad8=a20_0x59ec('0x29');const _0x148a00=_0x23fcb7+'/'+_0x3db058+a20_0x59ec('0x2a');_0x251ed7[a20_0x59ec('0x2b')](_0x5ddad8,_0x148a00,{'qos':0x1},_0x59824b=>{console[a20_0x59ec('0x11')](a20_0x59ec('0x2c'));console[a20_0x59ec('0x11')](_0x59824b);if(!_0x59824b){}});}});_0x251ed7['on'](a20_0x59ec('0x2d'),()=>{console[a20_0x59ec('0x11')](a20_0x59ec('0x2d'));});_0x251ed7['on']('error',_0x2bf441=>{console[a20_0x59ec('0x11')](a20_0x59ec('0x2e'),_0x2bf441);});_0x251ed7['on'](a20_0x59ec('0x2f'),(_0x46d376,_0x16fa10)=>{let _0x1ed370=a20_0x59ec('0x30');console['log'](_0x46d376);console['log'](_0x16fa10+'');if(_0x46d376===a20_0x59ec('0x25')+_0x3db058+a20_0x59ec('0x26')){_0x1ed370=a20_0x59ec('0x31');}else if(_0x46d376[a20_0x59ec('0x32')](a20_0x59ec('0x25')+_0x3db058+a20_0x59ec('0x33'))){_0x1ed370='Command\x20message\x20received:\x20';}_0x1ed370+=Buffer[a20_0x59ec('0x34')](_0x16fa10,'base64')[a20_0x59ec('0x35')](a20_0x59ec('0x36'));console['log'](_0x1ed370);});_0x251ed7['on']('packetsend',()=>{});console[a20_0x59ec('0x11')](_0x4d3a91);}[a20_0x59ec('0x37')](){console['log'](a20_0x59ec('0x12'));this[a20_0x59ec('0x38')]=uuidv4();console['log']('this.clientId');console['log'](this[a20_0x59ec('0x38')]);const _0x10fe59={'clientId':this[a20_0x59ec('0x38')],'username':a20_0x59ec('0x39'),'password':a20_0x59ec('0x3a'),'clean':!![]};this[a20_0x59ec('0x3b')]=mqtt[a20_0x59ec('0x23')](a20_0x59ec('0x3c'),_0x10fe59);this[a20_0x59ec('0x3b')]['on'](a20_0x59ec('0x23'),this['mqttClient_connect'][a20_0x59ec('0x3d')](this));this[a20_0x59ec('0x3b')]['on'](a20_0x59ec('0x2f'),this[a20_0x59ec('0x3e')][a20_0x59ec('0x3d')](this));this['mqttClient']['on'](a20_0x59ec('0x2d'),()=>{console['log'](a20_0x59ec('0x2d'));});process['on']('exit',this['handleAppExit'][a20_0x59ec('0x3d')](this));process['on'](a20_0x59ec('0x3f'),this[a20_0x59ec('0x40')][a20_0x59ec('0x3d')](this));process['on']('uncaughtException',this[a20_0x59ec('0x40')][a20_0x59ec('0x3d')](this));}[a20_0x59ec('0x41')](){console[a20_0x59ec('0x11')](a20_0x59ec('0x42')+this['clientId']);this[a20_0x59ec('0x3b')]['subscribe'](a20_0x59ec('0x43'));this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x44'));this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x45'),{'qos':0x2});this['mqttClient'][a20_0x59ec('0x24')](a20_0x59ec('0x46'),{'qos':0x2});this['mqttClient'][a20_0x59ec('0x24')](a20_0x59ec('0x47'),{'qos':0x2});this['mqttClient'][a20_0x59ec('0x24')]('player/update',{'qos':0x2});this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x48'),{'qos':0x2});this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x49'),{'qos':0x2});this['mqttClient'][a20_0x59ec('0x24')](a20_0x59ec('0x4a'),{'qos':0x2});this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x4b'),{'qos':0x2});this[a20_0x59ec('0x3b')][a20_0x59ec('0x24')](a20_0x59ec('0x4c'),{'qos':0x2});}['reportStatus'](){}[a20_0x59ec('0x3e')](_0x29ff0c,_0x44bdba){console[a20_0x59ec('0x11')](a20_0x59ec('0x4d'),_0x29ff0c,_0x44bdba);switch(_0x29ff0c){case a20_0x59ec('0x43'):return this[a20_0x59ec('0x4e')](_0x44bdba);case'player/close':return this[a20_0x59ec('0x4f')](_0x44bdba);case a20_0x59ec('0x45'):return this[a20_0x59ec('0x50')](_0x44bdba);case a20_0x59ec('0x47'):return this['handleReloadPlaylistRequest'](_0x44bdba);case a20_0x59ec('0x46'):return this[a20_0x59ec('0x51')](_0x44bdba);case a20_0x59ec('0x52'):return this[a20_0x59ec('0x53')](_0x44bdba);case a20_0x59ec('0x48'):return this[a20_0x59ec('0x54')](_0x44bdba);case a20_0x59ec('0x49'):return this['handleRegisterRequest'](_0x44bdba);case a20_0x59ec('0x4a'):return this['handleUpdateSettingsRequest'](_0x44bdba);case a20_0x59ec('0x4b'):return this[a20_0x59ec('0x55')](_0x44bdba);case a20_0x59ec('0x4c'):return this[a20_0x59ec('0x56')](_0x44bdba);}}['handleRegisterRequest'](_0x15acb2){if(_0x15acb2=='all'||_0x15acb2==String(this[a20_0x59ec('0xb')][a20_0x59ec('0x57')])){this[a20_0x59ec('0xb')][a20_0x59ec('0x58')]();}}[a20_0x59ec('0x54')](_0x57edb2){if(_0x57edb2==a20_0x59ec('0x59')||_0x57edb2==String(this[a20_0x59ec('0xb')]['playerId'])){}}[a20_0x59ec('0x53')](_0x41c72f){console['log'](a20_0x59ec('0x5a')+_0x41c72f);if(_0x41c72f=='all'||_0x41c72f==String(this['syncPlaylistsService'][a20_0x59ec('0x57')])){const _0x18bd31=__dirname;const _0x11c46d=require(a20_0x59ec('0x5b'))(_0x18bd31);console['log'](a20_0x59ec('0x5c'));_0x11c46d['pull']((_0xb8564f,_0x1c1821)=>{if(_0xb8564f){console['log'](a20_0x59ec('0x5d'));this[a20_0x59ec('0x53')](_0x41c72f);return;}else{}console[a20_0x59ec('0x11')]('Git\x20updated');console[a20_0x59ec('0x11')](_0x1c1821);if(_0x1c1821&&_0x1c1821['summary'][a20_0x59ec('0x5e')]){this['syncPlaylistsService'][a20_0x59ec('0x5f')]();}else{}});}}[a20_0x59ec('0x51')](_0x398121){if(_0x398121=='all'||_0x398121==String(this[a20_0x59ec('0xb')]['playerId'])){this[a20_0x59ec('0xb')][a20_0x59ec('0x60')]();}}[a20_0x59ec('0x61')](_0x406bb3){if(String(_0x406bb3)==a20_0x59ec('0x59')||String(_0x406bb3)==String(this['syncPlaylistsService']['playerId'])){this[a20_0x59ec('0xb')][a20_0x59ec('0x62')]();}}[a20_0x59ec('0x50')](_0x14bd5b){if(_0x14bd5b=='all'||_0x14bd5b==String(this['syncPlaylistsService'][a20_0x59ec('0x57')])){console[a20_0x59ec('0x11')](a20_0x59ec('0x63'));try{this[a20_0x59ec('0xb')]['reboot']();}catch(_0x17edd3){console[a20_0x59ec('0x11')](_0x17edd3);}}}['handleUpdateSettingsRequest'](_0x584452){if(_0x584452==a20_0x59ec('0x59')||_0x584452==String(this['syncPlaylistsService'][a20_0x59ec('0x57')])){console[a20_0x59ec('0x11')](a20_0x59ec('0x64'));try{this[a20_0x59ec('0xb')][a20_0x59ec('0x65')]();}catch(_0x439a99){console[a20_0x59ec('0x11')](_0x439a99);}}}[a20_0x59ec('0x56')](_0xda24f4){if(_0xda24f4==a20_0x59ec('0x59')||_0xda24f4==String(this[a20_0x59ec('0xb')][a20_0x59ec('0x57')])){console[a20_0x59ec('0x11')](a20_0x59ec('0x66'));try{this[a20_0x59ec('0xb')][a20_0x59ec('0x67')]();}catch(_0x8ef302){console[a20_0x59ec('0x11')](_0x8ef302);}}}[a20_0x59ec('0x55')](_0x4361fe){if(_0x4361fe==a20_0x59ec('0x59')||_0x4361fe==String(this[a20_0x59ec('0xb')][a20_0x59ec('0x57')])){console['log'](a20_0x59ec('0x68'));try{this[a20_0x59ec('0xb')][a20_0x59ec('0x69')]();}catch(_0x178eff){console[a20_0x59ec('0x11')](_0x178eff);}}}[a20_0x59ec('0x6a')](){console[a20_0x59ec('0x11')](a20_0x59ec('0x6b'),this[a20_0x59ec('0xc')]);this[a20_0x59ec('0x3b')][a20_0x59ec('0x2b')](a20_0x59ec('0x6c'),this[a20_0x59ec('0xb')]['playerId']+'-'+this[a20_0x59ec('0xc')]);}[a20_0x59ec('0x4e')](_0x224f51){if(this[a20_0x59ec('0xc')]!==a20_0x59ec('0x6d')&&this[a20_0x59ec('0xc')]!==a20_0x59ec('0x6e')){console[a20_0x59ec('0x11')](a20_0x59ec('0x6f'));this[a20_0x59ec('0xc')]=a20_0x59ec('0x6e');this[a20_0x59ec('0x6a')]();setTimeout(()=>{this[a20_0x59ec('0xc')]=a20_0x59ec('0x6d');this[a20_0x59ec('0x6a')]();},0x1388);}}[a20_0x59ec('0x4f')](_0x58d928){if(this['state']!==a20_0x59ec('0xd')&&this[a20_0x59ec('0xc')]!=='closing'){this[a20_0x59ec('0xc')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a20_0x59ec('0xc')]=a20_0x59ec('0xd');this[a20_0x59ec('0x6a')]();},0x1388);}}[a20_0x59ec('0x40')](_0x8b52e5,_0x49d9ba){if(_0x49d9ba){console[a20_0x59ec('0x11')](_0x49d9ba[a20_0x59ec('0x70')]);}this['mqttClient'][a20_0x59ec('0x2b')](a20_0x59ec('0x71'),a20_0x59ec('0x72'));}[a20_0x59ec('0x1e')](_0x3ec2ff,_0x5a0438,_0x21e467){const _0x77dffd={'iat':Math[a20_0x59ec('0x21')](Date[a20_0x59ec('0x22')]()/0x3e8),'exp':Math[a20_0x59ec('0x21')](Date[a20_0x59ec('0x22')]()/0x3e8)+0x14*0x3c,'aud':_0x3ec2ff};const _0x3c8e3e=fs[a20_0x59ec('0x73')](_0x5a0438);return jwt[a20_0x59ec('0x74')](_0x77dffd,_0x3c8e3e,{'algorithm':_0x21e467});}}exports['MqttService']=MqttService;