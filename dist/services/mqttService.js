var a18_0x318a=['/config','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','from','ascii','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','bind','message','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/ifconfig','player/register','reportStatus','handleOpenRequest','handleCloseRequest','player/reboot','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','player/update_settings','handleUpdateSettingsRequest','handleRegisterRequest','playerId','registerClient','handleIfconfigRequest','all','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','round','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','child_process','exec','is-image','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','/locations/','/registries/','/devices/','unused','createJwt','TLSv1_2_method','now','connect','subscribe'];(function(_0x491aec,_0x36fe64){var _0x3e42ba=function(_0x42d010){while(--_0x42d010){_0x491aec['push'](_0x491aec['shift']());}};_0x3e42ba(++_0x36fe64);}(a18_0x318a,0x134));var a18_0x5848=function(_0x37b0d7,_0xa316f0){_0x37b0d7=_0x37b0d7-0x0;var _0x1c0e63=a18_0x318a[_0x37b0d7];return _0x1c0e63;};'use strict';Object[a18_0x5848('0x0')](exports,a18_0x5848('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5848('0x2'));const fs=require('fs');const fsExtra=require(a18_0x5848('0x3'));const request=require(a18_0x5848('0x4'));const progress=require(a18_0x5848('0x5'));const spawn=require('child_process')[a18_0x5848('0x6')];const exec=require(a18_0x5848('0x7'))[a18_0x5848('0x8')];const isImage=require(a18_0x5848('0x9'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x5848('0xa'));const uuidv4=require(a18_0x5848('0xb'));const jwt=require(a18_0x5848('0xc'));class MqttService{constructor(_0x10095d){this[a18_0x5848('0xd')]=_0x10095d;this[a18_0x5848('0xe')]=a18_0x5848('0xf');this[a18_0x5848('0x10')]=new HttpClientService_1['HttpClientService']();}[a18_0x5848('0x11')](){this[a18_0x5848('0x12')]();}[a18_0x5848('0x13')](){console['log'](a18_0x5848('0x14'));const _0x454e19=a18_0x5848('0x15');const _0x193490=a18_0x5848('0x16');const _0x5f14da=a18_0x5848('0x17');const _0x99ee16=a18_0x5848('0x18');const _0x5ccb7c='RS256';const _0x38beb3=a18_0x5848('0x19');const _0x5276db=a18_0x5848('0x1a');const _0x279303=0x1bb;const _0x28a9e4=a18_0x5848('0x1b');const _0x2efd0f=0x5;const _0x29e2d0='projects/'+_0x454e19+a18_0x5848('0x1c')+_0x99ee16+a18_0x5848('0x1d')+_0x5f14da+a18_0x5848('0x1e')+_0x193490;const _0x1f9952={'host':_0x5276db,'port':_0x279303,'clientId':_0x29e2d0,'username':a18_0x5848('0x1f'),'password':this[a18_0x5848('0x20')](_0x454e19,_0x38beb3,_0x5ccb7c),'protocol':'mqtts','secureProtocol':a18_0x5848('0x21')};const _0x96a91=Math['round'](Date[a18_0x5848('0x22')]()/0x3e8);const _0x20f85d=mqtt[a18_0x5848('0x23')](_0x1f9952);_0x20f85d[a18_0x5848('0x24')](a18_0x5848('0x1e')+_0x193490+a18_0x5848('0x25'),{'qos':0x1});_0x20f85d[a18_0x5848('0x24')](a18_0x5848('0x1e')+_0x193490+a18_0x5848('0x26'),{'qos':0x1});_0x20f85d[a18_0x5848('0x24')]('/devices/'+_0x193490+a18_0x5848('0x27'),{'qos':0x0});const _0x4de8ed=a18_0x5848('0x1e')+_0x193490+'/'+_0x28a9e4;_0x20f85d['on'](a18_0x5848('0x23'),_0x233bd7=>{console[a18_0x5848('0x28')](a18_0x5848('0x23'));if(!_0x233bd7){console[a18_0x5848('0x28')](a18_0x5848('0x29'));}else{const _0x4de8ed=a18_0x5848('0x2a');const _0x2fca58=_0x5f14da+'/'+_0x193490+a18_0x5848('0x2b');_0x20f85d[a18_0x5848('0x2c')](_0x4de8ed,_0x2fca58,{'qos':0x1},_0x374024=>{console[a18_0x5848('0x28')](a18_0x5848('0x2d'));console['log'](_0x374024);if(!_0x374024){}});}});_0x20f85d['on'](a18_0x5848('0x2e'),()=>{console['log']('close');});_0x20f85d['on'](a18_0x5848('0x2f'),_0x322907=>{console[a18_0x5848('0x28')](a18_0x5848('0x2f'),_0x322907);});_0x20f85d['on']('message',(_0x423869,_0x5d0448)=>{let _0x119ece=a18_0x5848('0x30');console[a18_0x5848('0x28')](_0x423869);console[a18_0x5848('0x28')](_0x5d0448+'');if(_0x423869==='/devices/'+_0x193490+a18_0x5848('0x25')){_0x119ece=a18_0x5848('0x31');}else if(_0x423869[a18_0x5848('0x32')](a18_0x5848('0x1e')+_0x193490+a18_0x5848('0x33'))){_0x119ece='Command\x20message\x20received:\x20';}_0x119ece+=Buffer[a18_0x5848('0x34')](_0x5d0448,'base64')['toString'](a18_0x5848('0x35'));console[a18_0x5848('0x28')](_0x119ece);});_0x20f85d['on']('packetsend',()=>{});console['log'](_0x1f9952);}[a18_0x5848('0x12')](){console['log'](a18_0x5848('0x14'));this[a18_0x5848('0x36')]=uuidv4();console[a18_0x5848('0x28')]('this.clientId');console['log'](this['clientId']);const _0x3bf88d={'clientId':this[a18_0x5848('0x36')],'username':a18_0x5848('0x37'),'password':a18_0x5848('0x38'),'clean':!![]};this[a18_0x5848('0x39')]=mqtt['connect']('mqtt://lulo.run',_0x3bf88d);this[a18_0x5848('0x39')]['on']('connect',this['mqttClient_connect'][a18_0x5848('0x3a')](this));this['mqttClient']['on'](a18_0x5848('0x3b'),this[a18_0x5848('0x3c')][a18_0x5848('0x3a')](this));this['mqttClient']['on']('close',()=>{console['log']('close');});process['on'](a18_0x5848('0x3d'),this['handleAppExit'][a18_0x5848('0x3a')](this));process['on'](a18_0x5848('0x3e'),this[a18_0x5848('0x3f')][a18_0x5848('0x3a')](this));process['on'](a18_0x5848('0x40'),this[a18_0x5848('0x3f')][a18_0x5848('0x3a')](this));}[a18_0x5848('0x41')](){console[a18_0x5848('0x28')](a18_0x5848('0x42')+this[a18_0x5848('0x36')]);this[a18_0x5848('0x39')]['subscribe'](a18_0x5848('0x43'));this[a18_0x5848('0x39')][a18_0x5848('0x24')](a18_0x5848('0x44'));this[a18_0x5848('0x39')][a18_0x5848('0x24')]('player/reboot',{'qos':0x2});this[a18_0x5848('0x39')]['subscribe'](a18_0x5848('0x45'),{'qos':0x2});this[a18_0x5848('0x39')][a18_0x5848('0x24')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x5848('0x24')]('player/update',{'qos':0x2});this['mqttClient'][a18_0x5848('0x24')](a18_0x5848('0x46'),{'qos':0x2});this[a18_0x5848('0x39')]['subscribe'](a18_0x5848('0x47'),{'qos':0x2});this[a18_0x5848('0x39')]['subscribe']('player/update_settings',{'qos':0x2});}[a18_0x5848('0x48')](){}[a18_0x5848('0x3c')](_0x142a6d,_0xa5afa4){console[a18_0x5848('0x28')]('received\x20message\x20%s\x20%s',_0x142a6d,_0xa5afa4);switch(_0x142a6d){case a18_0x5848('0x43'):return this[a18_0x5848('0x49')](_0xa5afa4);case a18_0x5848('0x44'):return this[a18_0x5848('0x4a')](_0xa5afa4);case a18_0x5848('0x4b'):return this['handleRebootRequest'](_0xa5afa4);case a18_0x5848('0x4c'):return this[a18_0x5848('0x4d')](_0xa5afa4);case a18_0x5848('0x45'):return this[a18_0x5848('0x4e')](_0xa5afa4);case a18_0x5848('0x4f'):return this[a18_0x5848('0x50')](_0xa5afa4);case a18_0x5848('0x46'):return this['handleIfconfigRequest'](_0xa5afa4);case'player/register':return this['handleRegisterRequest'](_0xa5afa4);case a18_0x5848('0x51'):return this[a18_0x5848('0x52')](_0xa5afa4);}}[a18_0x5848('0x53')](_0x10d099){if(_0x10d099=='all'||_0x10d099==String(this[a18_0x5848('0xd')][a18_0x5848('0x54')])){this[a18_0x5848('0xd')][a18_0x5848('0x55')]();}}[a18_0x5848('0x56')](_0x4e5455){if(_0x4e5455==a18_0x5848('0x57')||_0x4e5455==String(this[a18_0x5848('0xd')][a18_0x5848('0x54')])){}}[a18_0x5848('0x50')](_0x127eee){console['log'](a18_0x5848('0x58')+_0x127eee);if(_0x127eee==a18_0x5848('0x57')||_0x127eee==String(this[a18_0x5848('0xd')][a18_0x5848('0x54')])){const _0x284492=__dirname;const _0x439096=require(a18_0x5848('0x59'))(_0x284492);console[a18_0x5848('0x28')]('Git\x20updating');_0x439096[a18_0x5848('0x5a')]((_0x1069d1,_0x16bb79)=>{if(_0x1069d1){console['log'](a18_0x5848('0x5b'));this[a18_0x5848('0x50')](_0x127eee);return;}else{}console[a18_0x5848('0x28')](a18_0x5848('0x5c'));console[a18_0x5848('0x28')](_0x16bb79);if(_0x16bb79&&_0x16bb79[a18_0x5848('0x5d')][a18_0x5848('0x5e')]){this['syncPlaylistsService'][a18_0x5848('0x5f')]();}else{}});}}[a18_0x5848('0x4e')](_0xeafdf8){if(_0xeafdf8==a18_0x5848('0x57')||_0xeafdf8==String(this[a18_0x5848('0xd')][a18_0x5848('0x54')])){this[a18_0x5848('0xd')][a18_0x5848('0x60')]();}}[a18_0x5848('0x4d')](_0x22d47b){if(String(_0x22d47b)==a18_0x5848('0x57')||String(_0x22d47b)==String(this['syncPlaylistsService'][a18_0x5848('0x54')])){this[a18_0x5848('0xd')][a18_0x5848('0x61')]();}}[a18_0x5848('0x62')](_0x24261e){if(_0x24261e=='all'||_0x24261e==String(this['syncPlaylistsService'][a18_0x5848('0x54')])){console[a18_0x5848('0x28')](a18_0x5848('0x63'));try{this[a18_0x5848('0xd')]['reboot']();}catch(_0x2d3980){console[a18_0x5848('0x28')](_0x2d3980);}}}['handleUpdateSettingsRequest'](_0x20dd16){if(_0x20dd16==a18_0x5848('0x57')||_0x20dd16==String(this['syncPlaylistsService'][a18_0x5848('0x54')])){console[a18_0x5848('0x28')](a18_0x5848('0x64'));try{this[a18_0x5848('0xd')]['updateSettings']();}catch(_0x54567a){console[a18_0x5848('0x28')](_0x54567a);}}}[a18_0x5848('0x65')](){console[a18_0x5848('0x28')](a18_0x5848('0x66'),this[a18_0x5848('0xe')]);this[a18_0x5848('0x39')][a18_0x5848('0x2c')](a18_0x5848('0x67'),this[a18_0x5848('0xd')][a18_0x5848('0x54')]+'-'+this['state']);}[a18_0x5848('0x49')](_0x32e489){if(this[a18_0x5848('0xe')]!==a18_0x5848('0x68')&&this[a18_0x5848('0xe')]!==a18_0x5848('0x69')){console[a18_0x5848('0x28')](a18_0x5848('0x6a'));this[a18_0x5848('0xe')]=a18_0x5848('0x69');this[a18_0x5848('0x65')]();setTimeout(()=>{this['state']='open';this[a18_0x5848('0x65')]();},0x1388);}}[a18_0x5848('0x4a')](_0x1eb950){if(this[a18_0x5848('0xe')]!==a18_0x5848('0xf')&&this[a18_0x5848('0xe')]!==a18_0x5848('0x6b')){this[a18_0x5848('0xe')]=a18_0x5848('0x6b');this[a18_0x5848('0x65')]();setTimeout(()=>{this[a18_0x5848('0xe')]=a18_0x5848('0xf');this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x5ccc98,_0x317819){if(_0x317819){console['log'](_0x317819[a18_0x5848('0x6c')]);}this[a18_0x5848('0x39')][a18_0x5848('0x2c')](a18_0x5848('0x6d'),a18_0x5848('0x6e'));}[a18_0x5848('0x20')](_0x2870ce,_0xfe6d77,_0x46778f){const _0x5ba5ce={'iat':Math[a18_0x5848('0x6f')](Date['now']()/0x3e8),'exp':Math['round'](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x2870ce};const _0x1d6b77=fs[a18_0x5848('0x70')](_0xfe6d77);return jwt[a18_0x5848('0x71')](_0x5ba5ce,_0x1d6b77,{'algorithm':_0x46778f});}}exports[a18_0x5848('0x72')]=MqttService;