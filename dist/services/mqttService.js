var a17_0x29ae=['registerClient','playerId','stringify','networkInterfaces','reportStatus','received\x20message\x20%s\x20%s','player/open','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest','player/update','handleUpdateRequest','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','all','sendStateUpdate','state','publish','player/state','open','opening','closing','stack','false','defineProperty','__esModule','fs-extra','request','request-progress','child_process','spawn','is-image','closed','syncPlaylistsService','init','mqttInit','log','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','connect','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/reboot','player/reload_playlist'];(function(_0x2a0e9e,_0x3c1c50){var _0x4f7fd3=function(_0x5a612f){while(--_0x5a612f){_0x2a0e9e['push'](_0x2a0e9e['shift']());}};_0x4f7fd3(++_0x3c1c50);}(a17_0x29ae,0x1d9));var a17_0x1e18=function(_0x27dee2,_0xc8fa3d){_0x27dee2=_0x27dee2-0x0;var _0xbe5857=a17_0x29ae[_0x27dee2];return _0xbe5857;};'use strict';Object[a17_0x1e18('0x0')](exports,a17_0x1e18('0x1'),{'value':!![]});const fs=require('fs');const fsExtra=require(a17_0x1e18('0x2'));const request=require(a17_0x1e18('0x3'));const progress=require(a17_0x1e18('0x4'));const spawn=require(a17_0x1e18('0x5'))[a17_0x1e18('0x6')];const isImage=require(a17_0x1e18('0x7'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');class MqttService{constructor(_0x5323eb){this['state']=a17_0x1e18('0x8');this[a17_0x1e18('0x9')]=_0x5323eb;}[a17_0x1e18('0xa')](){this[a17_0x1e18('0xb')]();}[a17_0x1e18('0xb')](){console[a17_0x1e18('0xc')](a17_0x1e18('0xb'));this[a17_0x1e18('0xd')]=uuidv4();const _0x3c80d6={'clientId':this['clientId'],'username':a17_0x1e18('0xe'),'password':a17_0x1e18('0xf'),'clean':!![]};this[a17_0x1e18('0x10')]=mqtt['connect'](a17_0x1e18('0x11'),_0x3c80d6);this[a17_0x1e18('0x10')]['on'](a17_0x1e18('0x12'),this[a17_0x1e18('0x13')][a17_0x1e18('0x14')](this));this[a17_0x1e18('0x10')]['on']('message',this[a17_0x1e18('0x15')][a17_0x1e18('0x14')](this));process['on'](a17_0x1e18('0x16'),this[a17_0x1e18('0x17')][a17_0x1e18('0x14')](this));process['on'](a17_0x1e18('0x18'),this[a17_0x1e18('0x17')][a17_0x1e18('0x14')](this));process['on'](a17_0x1e18('0x19'),this[a17_0x1e18('0x17')][a17_0x1e18('0x14')](this));}[a17_0x1e18('0x13')](){console[a17_0x1e18('0xc')](a17_0x1e18('0x1a')+this['clientId']);this[a17_0x1e18('0x10')][a17_0x1e18('0x1b')]('player/open');this[a17_0x1e18('0x10')][a17_0x1e18('0x1b')](a17_0x1e18('0x1c'));this[a17_0x1e18('0x10')][a17_0x1e18('0x1b')](a17_0x1e18('0x1d'),{'qos':0x2});this[a17_0x1e18('0x10')][a17_0x1e18('0x1b')]('player/load_playlist',{'qos':0x2});this[a17_0x1e18('0x10')][a17_0x1e18('0x1b')](a17_0x1e18('0x1e'),{'qos':0x2});this['mqttClient'][a17_0x1e18('0x1b')]('player/update',{'qos':0x2});this[a17_0x1e18('0x1f')]();}[a17_0x1e18('0x1f')](){const _0x285b2c={'playerId':this[a17_0x1e18('0x9')][a17_0x1e18('0x20')],'clientId':this['clientId'],'connected':!![],'network':JSON[a17_0x1e18('0x21')](os[a17_0x1e18('0x22')]())};console[a17_0x1e18('0xc')](_0x285b2c);}[a17_0x1e18('0x23')](){}['mqttClient_message'](_0x4acd30,_0x507c43){console[a17_0x1e18('0xc')](a17_0x1e18('0x24'),_0x4acd30,_0x507c43);switch(_0x4acd30){case a17_0x1e18('0x25'):return this['handleOpenRequest'](_0x507c43);case a17_0x1e18('0x1c'):return this[a17_0x1e18('0x26')](_0x507c43);case a17_0x1e18('0x1d'):return this[a17_0x1e18('0x27')](_0x507c43);case a17_0x1e18('0x1e'):return this[a17_0x1e18('0x28')](_0x507c43);case a17_0x1e18('0x29'):return this[a17_0x1e18('0x2a')](_0x507c43);case a17_0x1e18('0x2b'):return this[a17_0x1e18('0x2c')](_0x507c43);}}[a17_0x1e18('0x2c')](_0x37b8b9){if(_0x37b8b9=='all'||_0x37b8b9==String(this[a17_0x1e18('0x9')][a17_0x1e18('0x20')])){const _0x3636b8=__dirname;const _0x5922e9=require('simple-git')(_0x3636b8);console[a17_0x1e18('0xc')](a17_0x1e18('0x2d'));_0x5922e9[a17_0x1e18('0x2e')]((_0x15e731,_0xcbb2b1)=>{if(_0x15e731){console[a17_0x1e18('0xc')](a17_0x1e18('0x2f'));this[a17_0x1e18('0x2c')](_0x37b8b9);return;}else{}console[a17_0x1e18('0xc')](a17_0x1e18('0x30'));console[a17_0x1e18('0xc')](_0xcbb2b1);if(_0xcbb2b1&&_0xcbb2b1[a17_0x1e18('0x31')][a17_0x1e18('0x32')]){const _0x241d88=spawn(a17_0x1e18('0x33'),['-r',a17_0x1e18('0x34')]);}else{}});}}['handleLoadPlaylistRequest'](_0x150dbb){if(_0x150dbb==a17_0x1e18('0x35')||_0x150dbb==String(this[a17_0x1e18('0x9')][a17_0x1e18('0x20')])){this['syncPlaylistsService']['loadMediaList']();}}['handleReloadPlaylistRequest'](_0x221800){if(_0x221800==a17_0x1e18('0x35')||_0x221800==String(this[a17_0x1e18('0x9')][a17_0x1e18('0x20')])){this[a17_0x1e18('0x9')]['reloadMediaList']();}}[a17_0x1e18('0x27')](_0x50449c){if(_0x50449c==a17_0x1e18('0x35')||_0x50449c==String(this[a17_0x1e18('0x9')][a17_0x1e18('0x20')])){const _0xbd0201=spawn(a17_0x1e18('0x33'),['-r',a17_0x1e18('0x34')]);}}[a17_0x1e18('0x36')](){console['log']('sending\x20state\x20%s',this[a17_0x1e18('0x37')]);this[a17_0x1e18('0x10')][a17_0x1e18('0x38')](a17_0x1e18('0x39'),this[a17_0x1e18('0x9')][a17_0x1e18('0x20')]+'-'+this[a17_0x1e18('0x37')]);}['handleOpenRequest'](_0x1d6805){if(this['state']!==a17_0x1e18('0x3a')&&this[a17_0x1e18('0x37')]!==a17_0x1e18('0x3b')){console[a17_0x1e18('0xc')]('opening\x20player\x20door');this[a17_0x1e18('0x37')]='opening';this[a17_0x1e18('0x36')]();setTimeout(()=>{this[a17_0x1e18('0x37')]=a17_0x1e18('0x3a');this[a17_0x1e18('0x36')]();},0x1388);}}[a17_0x1e18('0x26')](_0x58bdcf){if(this['state']!=='closed'&&this[a17_0x1e18('0x37')]!==a17_0x1e18('0x3c')){this[a17_0x1e18('0x37')]=a17_0x1e18('0x3c');this[a17_0x1e18('0x36')]();setTimeout(()=>{this[a17_0x1e18('0x37')]='closed';this[a17_0x1e18('0x36')]();},0x1388);}}['handleAppExit'](_0x46a806,_0xe66e09){if(_0xe66e09){console['log'](_0xe66e09[a17_0x1e18('0x3d')]);}this[a17_0x1e18('0x10')][a17_0x1e18('0x38')]('player/connected',a17_0x1e18('0x3e'));}}exports['MqttService']=MqttService;