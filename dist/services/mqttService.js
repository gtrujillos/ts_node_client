var a20_0x34a9=['handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleRegisterRequest','player/update_settings','handleUpdateSettingsRequest','handleTurnOffTVRequest','playerId','registerClient','handleIfconfigRequest','all','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','reboot','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','closing','stack','player/connected','false','now','MqttService','defineProperty','request-progress','spawn','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','my-node-device','my-registry','us-central1','RS256','events','/locations/','/registries/','unused','createJwt','TLSv1_2_method','round','connect','subscribe','/devices/','/config','/state','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','base64','ascii','packetsend','mqttInit','clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','mqttClient_message','exit','handleAppExit','SIGINT','bind','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/update','player/register','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','player/reboot'];(function(_0x339dd6,_0x2de800){var _0x3d532e=function(_0x348c8d){while(--_0x348c8d){_0x339dd6['push'](_0x339dd6['shift']());}};_0x3d532e(++_0x2de800);}(a20_0x34a9,0x108));var a20_0x430e=function(_0x4b9a56,_0x3ef939){_0x4b9a56=_0x4b9a56-0x0;var _0x3ecefd=a20_0x34a9[_0x4b9a56];return _0x3ecefd;};'use strict';Object[a20_0x430e('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a20_0x430e('0x1'));const spawn=require('child_process')[a20_0x430e('0x2')];const exec=require(a20_0x430e('0x3'))[a20_0x430e('0x4')];const isImage=require(a20_0x430e('0x5'));const format=require(a20_0x430e('0x6'));const os=require('os');const mqtt=require(a20_0x430e('0x7'));const uuidv4=require(a20_0x430e('0x8'));const jwt=require(a20_0x430e('0x9'));class MqttService{constructor(_0x400453){this[a20_0x430e('0xa')]=_0x400453;this[a20_0x430e('0xb')]=a20_0x430e('0xc');this['httpClientService']=new HttpClientService_1[(a20_0x430e('0xd'))]();}['init'](){this[a20_0x430e('0xe')]();}[a20_0x430e('0xf')](){console[a20_0x430e('0x10')]('mqttInit');const _0x5e0b29='velvety-glazing-252020';const _0x12b834=a20_0x430e('0x11');const _0x447531=a20_0x430e('0x12');const _0x359bc0=a20_0x430e('0x13');const _0x23dce4=a20_0x430e('0x14');const _0x529121='resources/keys/rsa_private.pem';const _0x40a8c0='mqtt.googleapis.com';const _0x2876e9=0x1bb;const _0x14b19a=a20_0x430e('0x15');const _0x3da585=0x5;const _0xcb8260='projects/'+_0x5e0b29+a20_0x430e('0x16')+_0x359bc0+a20_0x430e('0x17')+_0x447531+'/devices/'+_0x12b834;const _0x299f46={'host':_0x40a8c0,'port':_0x2876e9,'clientId':_0xcb8260,'username':a20_0x430e('0x18'),'password':this[a20_0x430e('0x19')](_0x5e0b29,_0x529121,_0x23dce4),'protocol':'mqtts','secureProtocol':a20_0x430e('0x1a')};const _0x4531ee=Math[a20_0x430e('0x1b')](Date['now']()/0x3e8);const _0x599019=mqtt[a20_0x430e('0x1c')](_0x299f46);_0x599019[a20_0x430e('0x1d')](a20_0x430e('0x1e')+_0x12b834+a20_0x430e('0x1f'),{'qos':0x1});_0x599019[a20_0x430e('0x1d')]('/devices/'+_0x12b834+a20_0x430e('0x20'),{'qos':0x1});_0x599019[a20_0x430e('0x1d')](a20_0x430e('0x1e')+_0x12b834+'/commands/#',{'qos':0x0});const _0x56819b='/devices/'+_0x12b834+'/'+_0x14b19a;_0x599019['on']('connect',_0x54b47b=>{console['log']('connect');if(!_0x54b47b){console['log'](a20_0x430e('0x21'));}else{const _0x56819b=a20_0x430e('0x22');const _0x3223db=_0x447531+'/'+_0x12b834+a20_0x430e('0x23');_0x599019[a20_0x430e('0x24')](_0x56819b,_0x3223db,{'qos':0x1},_0x419258=>{console[a20_0x430e('0x10')](a20_0x430e('0x25'));console[a20_0x430e('0x10')](_0x419258);if(!_0x419258){}});}});_0x599019['on'](a20_0x430e('0x26'),()=>{console[a20_0x430e('0x10')](a20_0x430e('0x26'));});_0x599019['on'](a20_0x430e('0x27'),_0x417984=>{console['log']('error',_0x417984);});_0x599019['on'](a20_0x430e('0x28'),(_0x117292,_0x46b64a)=>{let _0x87639c=a20_0x430e('0x29');console['log'](_0x117292);console[a20_0x430e('0x10')](_0x46b64a+'');if(_0x117292===a20_0x430e('0x1e')+_0x12b834+a20_0x430e('0x1f')){_0x87639c=a20_0x430e('0x2a');}else if(_0x117292['startsWith']('/devices/'+_0x12b834+a20_0x430e('0x2b'))){_0x87639c=a20_0x430e('0x2c');}_0x87639c+=Buffer['from'](_0x46b64a,a20_0x430e('0x2d'))['toString'](a20_0x430e('0x2e'));console['log'](_0x87639c);});_0x599019['on'](a20_0x430e('0x2f'),()=>{});console[a20_0x430e('0x10')](_0x299f46);}[a20_0x430e('0xe')](){console[a20_0x430e('0x10')](a20_0x430e('0x30'));this[a20_0x430e('0x31')]=uuidv4();console[a20_0x430e('0x10')]('this.clientId');console[a20_0x430e('0x10')](this['clientId']);const _0x2f264e={'clientId':this[a20_0x430e('0x31')],'username':a20_0x430e('0x32'),'password':'run.lulo_2018#.','clean':!![]};this[a20_0x430e('0x33')]=mqtt[a20_0x430e('0x1c')](a20_0x430e('0x34'),_0x2f264e);this['mqttClient']['on'](a20_0x430e('0x1c'),this[a20_0x430e('0x35')]['bind'](this));this[a20_0x430e('0x33')]['on'](a20_0x430e('0x28'),this[a20_0x430e('0x36')]['bind'](this));this[a20_0x430e('0x33')]['on'](a20_0x430e('0x26'),()=>{console['log']('close');});process['on'](a20_0x430e('0x37'),this[a20_0x430e('0x38')]['bind'](this));process['on'](a20_0x430e('0x39'),this['handleAppExit'][a20_0x430e('0x3a')](this));process['on']('uncaughtException',this[a20_0x430e('0x38')][a20_0x430e('0x3a')](this));}[a20_0x430e('0x35')](){console[a20_0x430e('0x10')](a20_0x430e('0x3b')+this[a20_0x430e('0x31')]);this[a20_0x430e('0x33')]['subscribe'](a20_0x430e('0x3c'));this[a20_0x430e('0x33')][a20_0x430e('0x1d')]('player/close');this[a20_0x430e('0x33')][a20_0x430e('0x1d')]('player/reboot',{'qos':0x2});this['mqttClient'][a20_0x430e('0x1d')](a20_0x430e('0x3d'),{'qos':0x2});this[a20_0x430e('0x33')][a20_0x430e('0x1d')]('player/reload_playlist',{'qos':0x2});this[a20_0x430e('0x33')][a20_0x430e('0x1d')](a20_0x430e('0x3e'),{'qos':0x2});this['mqttClient']['subscribe']('player/ifconfig',{'qos':0x2});this[a20_0x430e('0x33')][a20_0x430e('0x1d')](a20_0x430e('0x3f'),{'qos':0x2});this[a20_0x430e('0x33')][a20_0x430e('0x1d')]('player/update_settings',{'qos':0x2});this[a20_0x430e('0x33')][a20_0x430e('0x1d')](a20_0x430e('0x40'),{'qos':0x2});this['mqttClient'][a20_0x430e('0x1d')](a20_0x430e('0x41'),{'qos':0x2});}[a20_0x430e('0x42')](){}['mqttClient_message'](_0x429b04,_0x79675c){console[a20_0x430e('0x10')](a20_0x430e('0x43'),_0x429b04,_0x79675c);switch(_0x429b04){case'player/open':return this[a20_0x430e('0x44')](_0x79675c);case a20_0x430e('0x45'):return this[a20_0x430e('0x46')](_0x79675c);case a20_0x430e('0x47'):return this[a20_0x430e('0x48')](_0x79675c);case a20_0x430e('0x49'):return this[a20_0x430e('0x4a')](_0x79675c);case a20_0x430e('0x3d'):return this[a20_0x430e('0x4b')](_0x79675c);case a20_0x430e('0x3e'):return this[a20_0x430e('0x4c')](_0x79675c);case a20_0x430e('0x4d'):return this['handleIfconfigRequest'](_0x79675c);case a20_0x430e('0x3f'):return this[a20_0x430e('0x4e')](_0x79675c);case a20_0x430e('0x4f'):return this[a20_0x430e('0x50')](_0x79675c);case'player/turn_off_tv':return this[a20_0x430e('0x51')](_0x79675c);case'player/turn_on_tv':return this['handleTurnOnTVRequest'](_0x79675c);}}[a20_0x430e('0x4e')](_0x289dad){if(_0x289dad=='all'||_0x289dad==String(this['syncPlaylistsService'][a20_0x430e('0x52')])){this[a20_0x430e('0xa')][a20_0x430e('0x53')]();}}[a20_0x430e('0x54')](_0x17c278){if(_0x17c278==a20_0x430e('0x55')||_0x17c278==String(this[a20_0x430e('0xa')]['playerId'])){}}[a20_0x430e('0x4c')](_0xd9191b){console[a20_0x430e('0x10')]('handleUpdateRequest:\x20'+_0xd9191b);if(_0xd9191b==a20_0x430e('0x55')||_0xd9191b==String(this[a20_0x430e('0xa')][a20_0x430e('0x52')])){const _0x6dd7c9=__dirname;const _0x27da2b=require(a20_0x430e('0x56'))(_0x6dd7c9);console[a20_0x430e('0x10')](a20_0x430e('0x57'));_0x27da2b[a20_0x430e('0x58')]((_0x35b8b2,_0x3af1f5)=>{if(_0x35b8b2){console[a20_0x430e('0x10')](a20_0x430e('0x59'));this[a20_0x430e('0x4c')](_0xd9191b);return;}else{}console[a20_0x430e('0x10')]('Git\x20updated');console[a20_0x430e('0x10')](_0x3af1f5);if(_0x3af1f5&&_0x3af1f5[a20_0x430e('0x5a')]['changes']){this[a20_0x430e('0xa')][a20_0x430e('0x5b')]();}else{}});}}[a20_0x430e('0x4b')](_0x43b6f7){if(_0x43b6f7==a20_0x430e('0x55')||_0x43b6f7==String(this[a20_0x430e('0xa')][a20_0x430e('0x52')])){this[a20_0x430e('0xa')]['loadMediaList']();}}[a20_0x430e('0x4a')](_0x3b5e97){if(String(_0x3b5e97)==a20_0x430e('0x55')||String(_0x3b5e97)==String(this[a20_0x430e('0xa')][a20_0x430e('0x52')])){this[a20_0x430e('0xa')][a20_0x430e('0x5c')]();}}[a20_0x430e('0x48')](_0x20913e){if(_0x20913e=='all'||_0x20913e==String(this[a20_0x430e('0xa')][a20_0x430e('0x52')])){console['log'](a20_0x430e('0x5d'));try{this[a20_0x430e('0xa')][a20_0x430e('0x5b')]();}catch(_0x4bde72){console[a20_0x430e('0x10')](_0x4bde72);}}}[a20_0x430e('0x50')](_0x12ad85){if(_0x12ad85==a20_0x430e('0x55')||_0x12ad85==String(this[a20_0x430e('0xa')]['playerId'])){console[a20_0x430e('0x10')](a20_0x430e('0x5e'));try{this[a20_0x430e('0xa')][a20_0x430e('0x5f')]();}catch(_0x41139e){console[a20_0x430e('0x10')](_0x41139e);}}}['handleTurnOnTVRequest'](_0x1cbae3){if(_0x1cbae3=='all'||_0x1cbae3==String(this[a20_0x430e('0xa')][a20_0x430e('0x52')])){console['log'](a20_0x430e('0x60'));try{this[a20_0x430e('0xa')][a20_0x430e('0x61')]();}catch(_0x7ff10c){console[a20_0x430e('0x10')](_0x7ff10c);}}}[a20_0x430e('0x51')](_0x360572){if(_0x360572==a20_0x430e('0x55')||_0x360572==String(this[a20_0x430e('0xa')]['playerId'])){console[a20_0x430e('0x10')](a20_0x430e('0x62'));try{this['syncPlaylistsService'][a20_0x430e('0x63')]();}catch(_0x37be8f){console[a20_0x430e('0x10')](_0x37be8f);}}}['sendStateUpdate'](){console['log'](a20_0x430e('0x64'),this[a20_0x430e('0xb')]);this[a20_0x430e('0x33')][a20_0x430e('0x24')](a20_0x430e('0x65'),this['syncPlaylistsService']['playerId']+'-'+this[a20_0x430e('0xb')]);}[a20_0x430e('0x44')](_0x4ae194){if(this[a20_0x430e('0xb')]!==a20_0x430e('0x66')&&this[a20_0x430e('0xb')]!==a20_0x430e('0x67')){console[a20_0x430e('0x10')](a20_0x430e('0x68'));this[a20_0x430e('0xb')]='opening';this[a20_0x430e('0x69')]();setTimeout(()=>{this[a20_0x430e('0xb')]=a20_0x430e('0x66');this[a20_0x430e('0x69')]();},0x1388);}}[a20_0x430e('0x46')](_0x4a11f5){if(this[a20_0x430e('0xb')]!==a20_0x430e('0xc')&&this['state']!=='closing'){this[a20_0x430e('0xb')]=a20_0x430e('0x6a');this[a20_0x430e('0x69')]();setTimeout(()=>{this[a20_0x430e('0xb')]='closed';this[a20_0x430e('0x69')]();},0x1388);}}[a20_0x430e('0x38')](_0x1310e7,_0x429373){if(_0x429373){console[a20_0x430e('0x10')](_0x429373[a20_0x430e('0x6b')]);}this[a20_0x430e('0x33')]['publish'](a20_0x430e('0x6c'),a20_0x430e('0x6d'));}[a20_0x430e('0x19')](_0x4260ae,_0x4cc557,_0x21a213){const _0x328282={'iat':Math['round'](Date[a20_0x430e('0x6e')]()/0x3e8),'exp':Math[a20_0x430e('0x1b')](Date[a20_0x430e('0x6e')]()/0x3e8)+0x14*0x3c,'aud':_0x4260ae};const _0x5a42b8=fs['readFileSync'](_0x4cc557);return jwt['sign'](_0x328282,_0x5a42b8,{'algorithm':_0x21a213});}}exports[a20_0x430e('0x6f')]=MqttService;