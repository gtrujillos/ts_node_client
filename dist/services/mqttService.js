var a18_0x217a=['ascii','clientId','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','mqttClient_message','bind','SIGINT','handleAppExit','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','player/ifconfig','handleIfconfigRequest','player/register','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','turnOffTV','sending\x20state\x20%s','opening','opening\x20player\x20door','open','closing','sendStateUpdate','player/connected','false','round','readFileSync','MqttService','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','init','mqttInit_mosquitto','mqttInit','my-node-device','RS256','mqtt.googleapis.com','events','/registries/','/devices/','createJwt','mqtts','TLSv1_2_method','now','connect','subscribe','/config','/state','/commands/#','log','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','startsWith','Command\x20message\x20received:\x20','from','base64','toString'];(function(_0x1bedd3,_0x119bb3){var _0x23f794=function(_0x4b44fb){while(--_0x4b44fb){_0x1bedd3['push'](_0x1bedd3['shift']());}};_0x23f794(++_0x119bb3);}(a18_0x217a,0x18a));var a18_0x5a1b=function(_0x5956c5,_0xc43d42){_0x5956c5=_0x5956c5-0x0;var _0x11c43b=a18_0x217a[_0x5956c5];return _0x11c43b;};'use strict';Object['defineProperty'](exports,a18_0x5a1b('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x5a1b('0x1'));const fs=require('fs');const fsExtra=require(a18_0x5a1b('0x2'));const request=require(a18_0x5a1b('0x3'));const progress=require('request-progress');const spawn=require(a18_0x5a1b('0x4'))[a18_0x5a1b('0x5')];const exec=require(a18_0x5a1b('0x4'))['exec'];const isImage=require(a18_0x5a1b('0x6'));const format=require(a18_0x5a1b('0x7'));const os=require('os');const mqtt=require(a18_0x5a1b('0x8'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x5a1b('0x9'));class MqttService{constructor(_0x4940ee){this[a18_0x5a1b('0xa')]=_0x4940ee;this[a18_0x5a1b('0xb')]=a18_0x5a1b('0xc');this['httpClientService']=new HttpClientService_1[(a18_0x5a1b('0xd'))]();}[a18_0x5a1b('0xe')](){this[a18_0x5a1b('0xf')]();}['mqttInit_google'](){console['log'](a18_0x5a1b('0x10'));const _0x542bc5='velvety-glazing-252020';const _0x564f3d=a18_0x5a1b('0x11');const _0x53c110='my-registry';const _0x254e13='us-central1';const _0x311141=a18_0x5a1b('0x12');const _0x41b46f='resources/keys/rsa_private.pem';const _0x389abc=a18_0x5a1b('0x13');const _0x56236a=0x1bb;const _0x627ef6=a18_0x5a1b('0x14');const _0x215051=0x5;const _0x4cdea9='projects/'+_0x542bc5+'/locations/'+_0x254e13+a18_0x5a1b('0x15')+_0x53c110+a18_0x5a1b('0x16')+_0x564f3d;const _0x437b66={'host':_0x389abc,'port':_0x56236a,'clientId':_0x4cdea9,'username':'unused','password':this[a18_0x5a1b('0x17')](_0x542bc5,_0x41b46f,_0x311141),'protocol':a18_0x5a1b('0x18'),'secureProtocol':a18_0x5a1b('0x19')};const _0x264d54=Math['round'](Date[a18_0x5a1b('0x1a')]()/0x3e8);const _0x50c0f0=mqtt[a18_0x5a1b('0x1b')](_0x437b66);_0x50c0f0[a18_0x5a1b('0x1c')](a18_0x5a1b('0x16')+_0x564f3d+a18_0x5a1b('0x1d'),{'qos':0x1});_0x50c0f0[a18_0x5a1b('0x1c')](a18_0x5a1b('0x16')+_0x564f3d+a18_0x5a1b('0x1e'),{'qos':0x1});_0x50c0f0[a18_0x5a1b('0x1c')](a18_0x5a1b('0x16')+_0x564f3d+a18_0x5a1b('0x1f'),{'qos':0x0});const _0x280f71=a18_0x5a1b('0x16')+_0x564f3d+'/'+_0x627ef6;_0x50c0f0['on'](a18_0x5a1b('0x1b'),_0xd30654=>{console['log'](a18_0x5a1b('0x1b'));if(!_0xd30654){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x21'));}else{const _0x280f71='/projects/velvety-glazing-252020/topics/my-topic';const _0x3a13c7=_0x53c110+'/'+_0x564f3d+a18_0x5a1b('0x22');_0x50c0f0[a18_0x5a1b('0x23')](_0x280f71,_0x3a13c7,{'qos':0x1},_0x13de3c=>{console['log'](a18_0x5a1b('0x24'));console[a18_0x5a1b('0x20')](_0x13de3c);if(!_0x13de3c){}});}});_0x50c0f0['on'](a18_0x5a1b('0x25'),()=>{console['log'](a18_0x5a1b('0x25'));});_0x50c0f0['on'](a18_0x5a1b('0x26'),_0x54830f=>{console[a18_0x5a1b('0x20')](a18_0x5a1b('0x26'),_0x54830f);});_0x50c0f0['on'](a18_0x5a1b('0x27'),(_0xd1dec5,_0x418a31)=>{let _0x3c19ce=a18_0x5a1b('0x28');console[a18_0x5a1b('0x20')](_0xd1dec5);console['log'](_0x418a31+'');if(_0xd1dec5==='/devices/'+_0x564f3d+a18_0x5a1b('0x1d')){_0x3c19ce='Config\x20message\x20received:\x20';}else if(_0xd1dec5[a18_0x5a1b('0x29')](a18_0x5a1b('0x16')+_0x564f3d+'/commands')){_0x3c19ce=a18_0x5a1b('0x2a');}_0x3c19ce+=Buffer[a18_0x5a1b('0x2b')](_0x418a31,a18_0x5a1b('0x2c'))[a18_0x5a1b('0x2d')](a18_0x5a1b('0x2e'));console[a18_0x5a1b('0x20')](_0x3c19ce);});_0x50c0f0['on']('packetsend',()=>{});console[a18_0x5a1b('0x20')](_0x437b66);}[a18_0x5a1b('0xf')](){console['log']('mqttInit');this[a18_0x5a1b('0x2f')]=uuidv4();console['log'](a18_0x5a1b('0x30'));console[a18_0x5a1b('0x20')](this[a18_0x5a1b('0x2f')]);const _0x1e931f={'clientId':this[a18_0x5a1b('0x2f')],'username':a18_0x5a1b('0x31'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x5a1b('0x32')]=mqtt[a18_0x5a1b('0x1b')](a18_0x5a1b('0x33'),_0x1e931f);this[a18_0x5a1b('0x32')]['on']('connect',this[a18_0x5a1b('0x34')]['bind'](this));this[a18_0x5a1b('0x32')]['on'](a18_0x5a1b('0x27'),this[a18_0x5a1b('0x35')][a18_0x5a1b('0x36')](this));this[a18_0x5a1b('0x32')]['on'](a18_0x5a1b('0x25'),()=>{console[a18_0x5a1b('0x20')]('close');});process['on']('exit',this['handleAppExit'][a18_0x5a1b('0x36')](this));process['on'](a18_0x5a1b('0x37'),this[a18_0x5a1b('0x38')]['bind'](this));process['on']('uncaughtException',this[a18_0x5a1b('0x38')][a18_0x5a1b('0x36')](this));}[a18_0x5a1b('0x34')](){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x39')+this[a18_0x5a1b('0x2f')]);this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')]('player/open');this[a18_0x5a1b('0x32')]['subscribe'](a18_0x5a1b('0x3a'));this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')](a18_0x5a1b('0x3b'),{'qos':0x2});this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')](a18_0x5a1b('0x3c'),{'qos':0x2});this['mqttClient'][a18_0x5a1b('0x1c')](a18_0x5a1b('0x3d'),{'qos':0x2});this['mqttClient'][a18_0x5a1b('0x1c')]('player/update',{'qos':0x2});this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')]('player/ifconfig',{'qos':0x2});this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')]('player/register',{'qos':0x2});this[a18_0x5a1b('0x32')]['subscribe'](a18_0x5a1b('0x3e'),{'qos':0x2});this[a18_0x5a1b('0x32')][a18_0x5a1b('0x1c')](a18_0x5a1b('0x3f'),{'qos':0x2});this[a18_0x5a1b('0x32')]['subscribe'](a18_0x5a1b('0x40'),{'qos':0x2});}[a18_0x5a1b('0x41')](){}[a18_0x5a1b('0x35')](_0x5df6b0,_0x6e26e9){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x42'),_0x5df6b0,_0x6e26e9);switch(_0x5df6b0){case'player/open':return this[a18_0x5a1b('0x43')](_0x6e26e9);case a18_0x5a1b('0x3a'):return this[a18_0x5a1b('0x44')](_0x6e26e9);case'player/reboot':return this[a18_0x5a1b('0x45')](_0x6e26e9);case a18_0x5a1b('0x3d'):return this[a18_0x5a1b('0x46')](_0x6e26e9);case'player/load_playlist':return this[a18_0x5a1b('0x47')](_0x6e26e9);case a18_0x5a1b('0x48'):return this['handleUpdateRequest'](_0x6e26e9);case a18_0x5a1b('0x49'):return this[a18_0x5a1b('0x4a')](_0x6e26e9);case a18_0x5a1b('0x4b'):return this[a18_0x5a1b('0x4c')](_0x6e26e9);case a18_0x5a1b('0x3e'):return this[a18_0x5a1b('0x4d')](_0x6e26e9);case a18_0x5a1b('0x3f'):return this[a18_0x5a1b('0x4e')](_0x6e26e9);case a18_0x5a1b('0x40'):return this[a18_0x5a1b('0x4f')](_0x6e26e9);}}[a18_0x5a1b('0x4c')](_0x22a2e2){if(_0x22a2e2==a18_0x5a1b('0x50')||_0x22a2e2==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){this['syncPlaylistsService'][a18_0x5a1b('0x52')]();}}['handleIfconfigRequest'](_0x5929f2){if(_0x5929f2==a18_0x5a1b('0x50')||_0x5929f2==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){}}[a18_0x5a1b('0x53')](_0x5ab0d7){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x54')+_0x5ab0d7);if(_0x5ab0d7==a18_0x5a1b('0x50')||_0x5ab0d7==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){const _0x20d1da=__dirname;const _0x4481b6=require(a18_0x5a1b('0x55'))(_0x20d1da);console[a18_0x5a1b('0x20')]('Git\x20updating');_0x4481b6[a18_0x5a1b('0x56')]((_0x160ebf,_0x2f2655)=>{if(_0x160ebf){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x57'));this[a18_0x5a1b('0x53')](_0x5ab0d7);return;}else{}console[a18_0x5a1b('0x20')](a18_0x5a1b('0x58'));console[a18_0x5a1b('0x20')](_0x2f2655);if(_0x2f2655&&_0x2f2655[a18_0x5a1b('0x59')]['changes']){this[a18_0x5a1b('0xa')][a18_0x5a1b('0x5a')]();}else{}});}}[a18_0x5a1b('0x47')](_0x2ad1e6){if(_0x2ad1e6=='all'||_0x2ad1e6==String(this['syncPlaylistsService'][a18_0x5a1b('0x51')])){this[a18_0x5a1b('0xa')][a18_0x5a1b('0x5b')]();}}['handleReloadPlaylistRequest'](_0x11dfef){if(String(_0x11dfef)=='all'||String(_0x11dfef)==String(this[a18_0x5a1b('0xa')]['playerId'])){this[a18_0x5a1b('0xa')][a18_0x5a1b('0x5c')]();}}['handleRebootRequest'](_0x162d5a){if(_0x162d5a==a18_0x5a1b('0x50')||_0x162d5a==String(this[a18_0x5a1b('0xa')]['playerId'])){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x5d'));try{this['syncPlaylistsService'][a18_0x5a1b('0x5a')]();}catch(_0x2cd9f6){console[a18_0x5a1b('0x20')](_0x2cd9f6);}}}['handleUpdateSettingsRequest'](_0xd750dd){if(_0xd750dd==a18_0x5a1b('0x50')||_0xd750dd==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x5e'));try{this[a18_0x5a1b('0xa')][a18_0x5a1b('0x5f')]();}catch(_0x3b68b1){console[a18_0x5a1b('0x20')](_0x3b68b1);}}}[a18_0x5a1b('0x4f')](_0x221b56){if(_0x221b56==a18_0x5a1b('0x50')||_0x221b56==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x60'));try{this[a18_0x5a1b('0xa')][a18_0x5a1b('0x61')]();}catch(_0x423f2b){console[a18_0x5a1b('0x20')](_0x423f2b);}}}[a18_0x5a1b('0x4e')](_0x32bbce){if(_0x32bbce==a18_0x5a1b('0x50')||_0x32bbce==String(this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')])){console[a18_0x5a1b('0x20')]('handleTurnOffTVRequest:\x20');try{this[a18_0x5a1b('0xa')][a18_0x5a1b('0x62')]();}catch(_0x4c0607){console[a18_0x5a1b('0x20')](_0x4c0607);}}}['sendStateUpdate'](){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x63'),this[a18_0x5a1b('0xb')]);this[a18_0x5a1b('0x32')][a18_0x5a1b('0x23')]('player/state',this[a18_0x5a1b('0xa')][a18_0x5a1b('0x51')]+'-'+this[a18_0x5a1b('0xb')]);}[a18_0x5a1b('0x43')](_0x3f338a){if(this[a18_0x5a1b('0xb')]!=='open'&&this[a18_0x5a1b('0xb')]!==a18_0x5a1b('0x64')){console[a18_0x5a1b('0x20')](a18_0x5a1b('0x65'));this[a18_0x5a1b('0xb')]=a18_0x5a1b('0x64');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5a1b('0xb')]=a18_0x5a1b('0x66');this['sendStateUpdate']();},0x1388);}}[a18_0x5a1b('0x44')](_0x5041d9){if(this[a18_0x5a1b('0xb')]!==a18_0x5a1b('0xc')&&this[a18_0x5a1b('0xb')]!==a18_0x5a1b('0x67')){this[a18_0x5a1b('0xb')]='closing';this[a18_0x5a1b('0x68')]();setTimeout(()=>{this[a18_0x5a1b('0xb')]=a18_0x5a1b('0xc');this['sendStateUpdate']();},0x1388);}}[a18_0x5a1b('0x38')](_0x173bfe,_0x156f43){if(_0x156f43){console[a18_0x5a1b('0x20')](_0x156f43['stack']);}this[a18_0x5a1b('0x32')][a18_0x5a1b('0x23')](a18_0x5a1b('0x69'),a18_0x5a1b('0x6a'));}['createJwt'](_0x20ba00,_0xe11510,_0x1497f5){const _0x58fd93={'iat':Math[a18_0x5a1b('0x6b')](Date[a18_0x5a1b('0x1a')]()/0x3e8),'exp':Math['round'](Date[a18_0x5a1b('0x1a')]()/0x3e8)+0x14*0x3c,'aud':_0x20ba00};const _0x306f29=fs[a18_0x5a1b('0x6c')](_0xe11510);return jwt['sign'](_0x58fd93,_0x306f29,{'algorithm':_0x1497f5});}}exports[a18_0x5a1b('0x6d')]=MqttService;