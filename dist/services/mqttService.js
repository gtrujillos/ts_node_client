var a20_0x2450=['close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','packetsend','mqttInit_mosquitto','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','Git\x20updating','pull','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','player/state','opening','opening\x20player\x20door','open','closing','stack','player/connected','false','readFileSync','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','log','mqttInit','velvety-glazing-252020','my-registry','resources/keys/rsa_private.pem','mqtt.googleapis.com','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:'];(function(_0x42e421,_0x158044){var _0x128053=function(_0x26952e){while(--_0x26952e){_0x42e421['push'](_0x42e421['shift']());}};_0x128053(++_0x158044);}(a20_0x2450,0x1ba));var a20_0x368a=function(_0x53e001,_0x511cea){_0x53e001=_0x53e001-0x0;var _0x5b1764=a20_0x2450[_0x53e001];return _0x5b1764;};'use strict';Object[a20_0x368a('0x0')](exports,a20_0x368a('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x368a('0x2'));const fs=require('fs');const fsExtra=require(a20_0x368a('0x3'));const request=require(a20_0x368a('0x4'));const progress=require('request-progress');const spawn=require(a20_0x368a('0x5'))[a20_0x368a('0x6')];const exec=require(a20_0x368a('0x5'))[a20_0x368a('0x7')];const isImage=require(a20_0x368a('0x8'));const format=require('string-template');const os=require('os');const mqtt=require(a20_0x368a('0x9'));const uuidv4=require(a20_0x368a('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x196613){this[a20_0x368a('0xb')]=_0x196613;this[a20_0x368a('0xc')]=a20_0x368a('0xd');this[a20_0x368a('0xe')]=new HttpClientService_1['HttpClientService']();}[a20_0x368a('0xf')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console[a20_0x368a('0x10')](a20_0x368a('0x11'));const _0x3cbe8b=a20_0x368a('0x12');const _0x3758fa='my-node-device';const _0x35bb32=a20_0x368a('0x13');const _0x46069e='us-central1';const _0x29a3fd='RS256';const _0x579011=a20_0x368a('0x14');const _0x5c8de4=a20_0x368a('0x15');const _0x6e7f7f=0x1bb;const _0x2592f9='events';const _0x171e0f=0x5;const _0x1dcedb=a20_0x368a('0x16')+_0x3cbe8b+a20_0x368a('0x17')+_0x46069e+a20_0x368a('0x18')+_0x35bb32+a20_0x368a('0x19')+_0x3758fa;const _0x4d0392={'host':_0x5c8de4,'port':_0x6e7f7f,'clientId':_0x1dcedb,'username':a20_0x368a('0x1a'),'password':this[a20_0x368a('0x1b')](_0x3cbe8b,_0x579011,_0x29a3fd),'protocol':a20_0x368a('0x1c'),'secureProtocol':a20_0x368a('0x1d')};const _0x4a28d4=Math[a20_0x368a('0x1e')](Date[a20_0x368a('0x1f')]()/0x3e8);const _0xd7a7fc=mqtt[a20_0x368a('0x20')](_0x4d0392);_0xd7a7fc[a20_0x368a('0x21')](a20_0x368a('0x19')+_0x3758fa+a20_0x368a('0x22'),{'qos':0x1});_0xd7a7fc[a20_0x368a('0x21')](a20_0x368a('0x19')+_0x3758fa+a20_0x368a('0x23'),{'qos':0x1});_0xd7a7fc[a20_0x368a('0x21')](a20_0x368a('0x19')+_0x3758fa+a20_0x368a('0x24'),{'qos':0x0});const _0x1af7a1=a20_0x368a('0x19')+_0x3758fa+'/'+_0x2592f9;_0xd7a7fc['on'](a20_0x368a('0x20'),_0x446d09=>{console[a20_0x368a('0x10')](a20_0x368a('0x20'));if(!_0x446d09){console[a20_0x368a('0x10')](a20_0x368a('0x25'));}else{const _0x1af7a1=a20_0x368a('0x26');const _0x2c94f3=_0x35bb32+'/'+_0x3758fa+a20_0x368a('0x27');_0xd7a7fc[a20_0x368a('0x28')](_0x1af7a1,_0x2c94f3,{'qos':0x1},_0x19f70c=>{console[a20_0x368a('0x10')](a20_0x368a('0x29'));console['log'](_0x19f70c);if(!_0x19f70c){}});}});_0xd7a7fc['on'](a20_0x368a('0x2a'),()=>{console[a20_0x368a('0x10')](a20_0x368a('0x2a'));});_0xd7a7fc['on']('error',_0x35e6e2=>{console['log'](a20_0x368a('0x2b'),_0x35e6e2);});_0xd7a7fc['on'](a20_0x368a('0x2c'),(_0x342c86,_0x51904f)=>{let _0x1282c7=a20_0x368a('0x2d');console[a20_0x368a('0x10')](_0x342c86);console[a20_0x368a('0x10')](_0x51904f+'');if(_0x342c86===a20_0x368a('0x19')+_0x3758fa+'/config'){_0x1282c7=a20_0x368a('0x2e');}else if(_0x342c86[a20_0x368a('0x2f')](a20_0x368a('0x19')+_0x3758fa+a20_0x368a('0x30'))){_0x1282c7=a20_0x368a('0x31');}_0x1282c7+=Buffer[a20_0x368a('0x32')](_0x51904f,a20_0x368a('0x33'))[a20_0x368a('0x34')]('ascii');console[a20_0x368a('0x10')](_0x1282c7);});_0xd7a7fc['on'](a20_0x368a('0x35'),()=>{});console[a20_0x368a('0x10')](_0x4d0392);}[a20_0x368a('0x36')](){console['log']('mqttInit');this[a20_0x368a('0x37')]=uuidv4();console[a20_0x368a('0x10')]('this.clientId');console[a20_0x368a('0x10')](this[a20_0x368a('0x37')]);const _0x50f543={'clientId':this[a20_0x368a('0x37')],'username':a20_0x368a('0x38'),'password':a20_0x368a('0x39'),'clean':!![]};this[a20_0x368a('0x3a')]=mqtt[a20_0x368a('0x20')](a20_0x368a('0x3b'),_0x50f543);this[a20_0x368a('0x3a')]['on'](a20_0x368a('0x20'),this[a20_0x368a('0x3c')][a20_0x368a('0x3d')](this));this['mqttClient']['on'](a20_0x368a('0x2c'),this[a20_0x368a('0x3e')][a20_0x368a('0x3d')](this));this[a20_0x368a('0x3a')]['on'](a20_0x368a('0x2a'),()=>{console[a20_0x368a('0x10')]('close');});process['on'](a20_0x368a('0x3f'),this[a20_0x368a('0x40')][a20_0x368a('0x3d')](this));process['on'](a20_0x368a('0x41'),this[a20_0x368a('0x40')][a20_0x368a('0x3d')](this));process['on'](a20_0x368a('0x42'),this[a20_0x368a('0x40')][a20_0x368a('0x3d')](this));}[a20_0x368a('0x3c')](){console[a20_0x368a('0x10')](a20_0x368a('0x43')+this[a20_0x368a('0x37')]);this[a20_0x368a('0x3a')][a20_0x368a('0x21')](a20_0x368a('0x44'));this[a20_0x368a('0x3a')][a20_0x368a('0x21')](a20_0x368a('0x45'));this['mqttClient'][a20_0x368a('0x21')](a20_0x368a('0x46'),{'qos':0x2});this[a20_0x368a('0x3a')]['subscribe'](a20_0x368a('0x47'),{'qos':0x2});this['mqttClient'][a20_0x368a('0x21')](a20_0x368a('0x48'),{'qos':0x2});this[a20_0x368a('0x3a')]['subscribe'](a20_0x368a('0x49'),{'qos':0x2});this[a20_0x368a('0x3a')][a20_0x368a('0x21')](a20_0x368a('0x4a'),{'qos':0x2});this[a20_0x368a('0x3a')]['subscribe'](a20_0x368a('0x4b'),{'qos':0x2});this['mqttClient'][a20_0x368a('0x21')](a20_0x368a('0x4c'),{'qos':0x2});this[a20_0x368a('0x3a')]['subscribe'](a20_0x368a('0x4d'),{'qos':0x2});this[a20_0x368a('0x3a')][a20_0x368a('0x21')](a20_0x368a('0x4e'),{'qos':0x2});}[a20_0x368a('0x4f')](){}[a20_0x368a('0x3e')](_0x3bdecc,_0x4c793f){console[a20_0x368a('0x10')]('received\x20message\x20%s\x20%s',_0x3bdecc,_0x4c793f);switch(_0x3bdecc){case a20_0x368a('0x44'):return this[a20_0x368a('0x50')](_0x4c793f);case a20_0x368a('0x45'):return this[a20_0x368a('0x51')](_0x4c793f);case'player/reboot':return this[a20_0x368a('0x52')](_0x4c793f);case a20_0x368a('0x48'):return this[a20_0x368a('0x53')](_0x4c793f);case a20_0x368a('0x47'):return this[a20_0x368a('0x54')](_0x4c793f);case a20_0x368a('0x49'):return this[a20_0x368a('0x55')](_0x4c793f);case a20_0x368a('0x4a'):return this[a20_0x368a('0x56')](_0x4c793f);case a20_0x368a('0x4b'):return this[a20_0x368a('0x57')](_0x4c793f);case a20_0x368a('0x4c'):return this['handleUpdateSettingsRequest'](_0x4c793f);case a20_0x368a('0x4d'):return this[a20_0x368a('0x58')](_0x4c793f);case a20_0x368a('0x4e'):return this[a20_0x368a('0x59')](_0x4c793f);}}['handleRegisterRequest'](_0x2828c9){if(_0x2828c9==a20_0x368a('0x5a')||_0x2828c9==String(this['syncPlaylistsService'][a20_0x368a('0x5b')])){this[a20_0x368a('0xb')][a20_0x368a('0x5c')]();}}[a20_0x368a('0x56')](_0x23780a){if(_0x23780a==a20_0x368a('0x5a')||_0x23780a==String(this['syncPlaylistsService']['playerId'])){}}[a20_0x368a('0x55')](_0x1164c5){console[a20_0x368a('0x10')](a20_0x368a('0x5d')+_0x1164c5);if(_0x1164c5=='all'||_0x1164c5==String(this[a20_0x368a('0xb')][a20_0x368a('0x5b')])){const _0x156d0c=__dirname;const _0xcd7629=require('simple-git')(_0x156d0c);console['log'](a20_0x368a('0x5e'));_0xcd7629[a20_0x368a('0x5f')]((_0x180f6d,_0x470dd1)=>{if(_0x180f6d){console[a20_0x368a('0x10')]('Error\x20git\x20updated');this[a20_0x368a('0x55')](_0x1164c5);return;}else{}console[a20_0x368a('0x10')](a20_0x368a('0x60'));console[a20_0x368a('0x10')](_0x470dd1);if(_0x470dd1&&_0x470dd1[a20_0x368a('0x61')][a20_0x368a('0x62')]){this['syncPlaylistsService'][a20_0x368a('0x63')]();}else{}});}}[a20_0x368a('0x54')](_0x48c131){if(_0x48c131==a20_0x368a('0x5a')||_0x48c131==String(this[a20_0x368a('0xb')][a20_0x368a('0x5b')])){this[a20_0x368a('0xb')][a20_0x368a('0x64')]();}}['handleReloadPlaylistRequest'](_0x5b0bfa){if(String(_0x5b0bfa)==a20_0x368a('0x5a')||String(_0x5b0bfa)==String(this[a20_0x368a('0xb')]['playerId'])){this['syncPlaylistsService'][a20_0x368a('0x65')]();}}[a20_0x368a('0x52')](_0x2c8e11){if(_0x2c8e11==a20_0x368a('0x5a')||_0x2c8e11==String(this[a20_0x368a('0xb')]['playerId'])){console['log'](a20_0x368a('0x66'));try{this[a20_0x368a('0xb')]['reboot']();}catch(_0x23ef00){console[a20_0x368a('0x10')](_0x23ef00);}}}[a20_0x368a('0x67')](_0x8513eb){if(_0x8513eb==a20_0x368a('0x5a')||_0x8513eb==String(this['syncPlaylistsService'][a20_0x368a('0x5b')])){console[a20_0x368a('0x10')](a20_0x368a('0x68'));try{this[a20_0x368a('0xb')][a20_0x368a('0x69')]();}catch(_0x4e27de){console['log'](_0x4e27de);}}}[a20_0x368a('0x59')](_0xc19cb9){if(_0xc19cb9=='all'||_0xc19cb9==String(this[a20_0x368a('0xb')][a20_0x368a('0x5b')])){console['log'](a20_0x368a('0x6a'));try{this['syncPlaylistsService'][a20_0x368a('0x6b')]();}catch(_0x1e57b0){console['log'](_0x1e57b0);}}}['handleTurnOffTVRequest'](_0x20c5e4){if(_0x20c5e4==a20_0x368a('0x5a')||_0x20c5e4==String(this[a20_0x368a('0xb')][a20_0x368a('0x5b')])){console[a20_0x368a('0x10')](a20_0x368a('0x6c'));try{this['syncPlaylistsService'][a20_0x368a('0x6d')]();}catch(_0x548724){console[a20_0x368a('0x10')](_0x548724);}}}[a20_0x368a('0x6e')](){console[a20_0x368a('0x10')]('sending\x20state\x20%s',this['state']);this[a20_0x368a('0x3a')][a20_0x368a('0x28')](a20_0x368a('0x6f'),this['syncPlaylistsService']['playerId']+'-'+this[a20_0x368a('0xc')]);}['handleOpenRequest'](_0x2213b8){if(this[a20_0x368a('0xc')]!=='open'&&this[a20_0x368a('0xc')]!==a20_0x368a('0x70')){console[a20_0x368a('0x10')](a20_0x368a('0x71'));this['state']=a20_0x368a('0x70');this[a20_0x368a('0x6e')]();setTimeout(()=>{this[a20_0x368a('0xc')]=a20_0x368a('0x72');this[a20_0x368a('0x6e')]();},0x1388);}}['handleCloseRequest'](_0x45614a){if(this[a20_0x368a('0xc')]!==a20_0x368a('0xd')&&this[a20_0x368a('0xc')]!==a20_0x368a('0x73')){this['state']=a20_0x368a('0x73');this[a20_0x368a('0x6e')]();setTimeout(()=>{this['state']=a20_0x368a('0xd');this[a20_0x368a('0x6e')]();},0x1388);}}[a20_0x368a('0x40')](_0x38edf5,_0x1ebf48){if(_0x1ebf48){console['log'](_0x1ebf48[a20_0x368a('0x74')]);}this[a20_0x368a('0x3a')][a20_0x368a('0x28')](a20_0x368a('0x75'),a20_0x368a('0x76'));}['createJwt'](_0x5f54ad,_0x4a5294,_0x1ac31b){const _0x1e93e5={'iat':Math[a20_0x368a('0x1e')](Date['now']()/0x3e8),'exp':Math[a20_0x368a('0x1e')](Date[a20_0x368a('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x5f54ad};const _0x119424=fs[a20_0x368a('0x77')](_0x4a5294);return jwt['sign'](_0x1e93e5,_0x119424,{'algorithm':_0x1ac31b});}}exports[a20_0x368a('0x78')]=MqttService;