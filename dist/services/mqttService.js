var a20_0x293e=['loadMediaList','reloadMediaList','reboot','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','turnOnTV','turnOffTV','sending\x20state\x20%s','open','opening','opening\x20player\x20door','sendStateUpdate','closing','stack','false','round','readFileSync','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','my-node-device','resources/keys/rsa_private.pem','events','/locations/','/devices/','createJwt','TLSv1_2_method','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','message','Message\x20received:\x20','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','player/open','player/reload_playlist','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','registerClient','playerId','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','changes'];(function(_0x2928f1,_0x390aa4){var _0x2add1a=function(_0x2f9533){while(--_0x2f9533){_0x2928f1['push'](_0x2928f1['shift']());}};_0x2add1a(++_0x390aa4);}(a20_0x293e,0xf3));var a20_0x4b78=function(_0x1e0f4d,_0xd657ed){_0x1e0f4d=_0x1e0f4d-0x0;var _0x380040=a20_0x293e[_0x1e0f4d];return _0x380040;};'use strict';Object[a20_0x4b78('0x0')](exports,a20_0x4b78('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x4b78('0x2'));const fs=require('fs');const fsExtra=require(a20_0x4b78('0x3'));const request=require(a20_0x4b78('0x4'));const progress=require(a20_0x4b78('0x5'));const spawn=require(a20_0x4b78('0x6'))[a20_0x4b78('0x7')];const exec=require(a20_0x4b78('0x6'))[a20_0x4b78('0x8')];const isImage=require(a20_0x4b78('0x9'));const format=require(a20_0x4b78('0xa'));const os=require('os');const mqtt=require(a20_0x4b78('0xb'));const uuidv4=require(a20_0x4b78('0xc'));const jwt=require(a20_0x4b78('0xd'));class MqttService{constructor(_0x260ba8){this[a20_0x4b78('0xe')]=_0x260ba8;this[a20_0x4b78('0xf')]=a20_0x4b78('0x10');this[a20_0x4b78('0x11')]=new HttpClientService_1['HttpClientService']();}[a20_0x4b78('0x12')](){this[a20_0x4b78('0x13')]();}[a20_0x4b78('0x14')](){console[a20_0x4b78('0x15')]('mqttInit');const _0x3532ca=a20_0x4b78('0x16');const _0x5bb65e=a20_0x4b78('0x17');const _0x262033='my-registry';const _0x39ebc8='us-central1';const _0x41ddfa='RS256';const _0x20dfec=a20_0x4b78('0x18');const _0x3b0baf='mqtt.googleapis.com';const _0x40327e=0x1bb;const _0x586588=a20_0x4b78('0x19');const _0x1befd8=0x5;const _0x29657d='projects/'+_0x3532ca+a20_0x4b78('0x1a')+_0x39ebc8+'/registries/'+_0x262033+a20_0x4b78('0x1b')+_0x5bb65e;const _0x3d5344={'host':_0x3b0baf,'port':_0x40327e,'clientId':_0x29657d,'username':'unused','password':this[a20_0x4b78('0x1c')](_0x3532ca,_0x20dfec,_0x41ddfa),'protocol':'mqtts','secureProtocol':a20_0x4b78('0x1d')};const _0xef47e=Math['round'](Date[a20_0x4b78('0x1e')]()/0x3e8);const _0x32ace7=mqtt[a20_0x4b78('0x1f')](_0x3d5344);_0x32ace7[a20_0x4b78('0x20')]('/devices/'+_0x5bb65e+a20_0x4b78('0x21'),{'qos':0x1});_0x32ace7['subscribe'](a20_0x4b78('0x1b')+_0x5bb65e+a20_0x4b78('0x22'),{'qos':0x1});_0x32ace7[a20_0x4b78('0x20')]('/devices/'+_0x5bb65e+a20_0x4b78('0x23'),{'qos':0x0});const _0x48c9d2='/devices/'+_0x5bb65e+'/'+_0x586588;_0x32ace7['on'](a20_0x4b78('0x1f'),_0x9c2f28=>{console[a20_0x4b78('0x15')]('connect');if(!_0x9c2f28){console[a20_0x4b78('0x15')](a20_0x4b78('0x24'));}else{const _0x48c9d2=a20_0x4b78('0x25');const _0x190369=_0x262033+'/'+_0x5bb65e+a20_0x4b78('0x26');_0x32ace7[a20_0x4b78('0x27')](_0x48c9d2,_0x190369,{'qos':0x1},_0x49a838=>{console[a20_0x4b78('0x15')](a20_0x4b78('0x28'));console[a20_0x4b78('0x15')](_0x49a838);if(!_0x49a838){}});}});_0x32ace7['on']('close',()=>{console[a20_0x4b78('0x15')](a20_0x4b78('0x29'));});_0x32ace7['on']('error',_0xf2f6c5=>{console[a20_0x4b78('0x15')]('error',_0xf2f6c5);});_0x32ace7['on'](a20_0x4b78('0x2a'),(_0xbdb00a,_0xefb1d4)=>{let _0x5d7d0b=a20_0x4b78('0x2b');console[a20_0x4b78('0x15')](_0xbdb00a);console[a20_0x4b78('0x15')](_0xefb1d4+'');if(_0xbdb00a===a20_0x4b78('0x1b')+_0x5bb65e+a20_0x4b78('0x21')){_0x5d7d0b=a20_0x4b78('0x2c');}else if(_0xbdb00a['startsWith']('/devices/'+_0x5bb65e+a20_0x4b78('0x2d'))){_0x5d7d0b=a20_0x4b78('0x2e');}_0x5d7d0b+=Buffer[a20_0x4b78('0x2f')](_0xefb1d4,a20_0x4b78('0x30'))['toString'](a20_0x4b78('0x31'));console[a20_0x4b78('0x15')](_0x5d7d0b);});_0x32ace7['on'](a20_0x4b78('0x32'),()=>{});console[a20_0x4b78('0x15')](_0x3d5344);}[a20_0x4b78('0x13')](){console[a20_0x4b78('0x15')]('mqttInit');this[a20_0x4b78('0x33')]=uuidv4();console[a20_0x4b78('0x15')]('this.clientId');console['log'](this[a20_0x4b78('0x33')]);const _0x356db7={'clientId':this['clientId'],'username':a20_0x4b78('0x34'),'password':a20_0x4b78('0x35'),'clean':!![]};this[a20_0x4b78('0x36')]=mqtt[a20_0x4b78('0x1f')](a20_0x4b78('0x37'),_0x356db7);this[a20_0x4b78('0x36')]['on'](a20_0x4b78('0x1f'),this[a20_0x4b78('0x38')][a20_0x4b78('0x39')](this));this[a20_0x4b78('0x36')]['on'](a20_0x4b78('0x2a'),this[a20_0x4b78('0x3a')][a20_0x4b78('0x39')](this));this['mqttClient']['on'](a20_0x4b78('0x29'),()=>{console['log'](a20_0x4b78('0x29'));});process['on'](a20_0x4b78('0x3b'),this[a20_0x4b78('0x3c')][a20_0x4b78('0x39')](this));process['on'](a20_0x4b78('0x3d'),this['handleAppExit'][a20_0x4b78('0x39')](this));process['on'](a20_0x4b78('0x3e'),this[a20_0x4b78('0x3c')][a20_0x4b78('0x39')](this));}[a20_0x4b78('0x38')](){console[a20_0x4b78('0x15')]('Connected\x20to\x20broker\x20client:'+this[a20_0x4b78('0x33')]);this[a20_0x4b78('0x36')][a20_0x4b78('0x20')](a20_0x4b78('0x3f'));this['mqttClient'][a20_0x4b78('0x20')]('player/close');this[a20_0x4b78('0x36')][a20_0x4b78('0x20')]('player/reboot',{'qos':0x2});this[a20_0x4b78('0x36')][a20_0x4b78('0x20')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a20_0x4b78('0x20')](a20_0x4b78('0x40'),{'qos':0x2});this[a20_0x4b78('0x36')]['subscribe']('player/update',{'qos':0x2});this[a20_0x4b78('0x36')][a20_0x4b78('0x20')](a20_0x4b78('0x41'),{'qos':0x2});this[a20_0x4b78('0x36')][a20_0x4b78('0x20')](a20_0x4b78('0x42'),{'qos':0x2});this[a20_0x4b78('0x36')]['subscribe'](a20_0x4b78('0x43'),{'qos':0x2});this[a20_0x4b78('0x36')][a20_0x4b78('0x20')](a20_0x4b78('0x44'),{'qos':0x2});this[a20_0x4b78('0x36')]['subscribe'](a20_0x4b78('0x45'),{'qos':0x2});}[a20_0x4b78('0x46')](){}['mqttClient_message'](_0x190e28,_0x164f0e){console[a20_0x4b78('0x15')](a20_0x4b78('0x47'),_0x190e28,_0x164f0e);switch(_0x190e28){case'player/open':return this[a20_0x4b78('0x48')](_0x164f0e);case a20_0x4b78('0x49'):return this[a20_0x4b78('0x4a')](_0x164f0e);case'player/reboot':return this[a20_0x4b78('0x4b')](_0x164f0e);case a20_0x4b78('0x40'):return this[a20_0x4b78('0x4c')](_0x164f0e);case'player/load_playlist':return this[a20_0x4b78('0x4d')](_0x164f0e);case a20_0x4b78('0x4e'):return this[a20_0x4b78('0x4f')](_0x164f0e);case a20_0x4b78('0x41'):return this[a20_0x4b78('0x50')](_0x164f0e);case'player/register':return this[a20_0x4b78('0x51')](_0x164f0e);case a20_0x4b78('0x43'):return this['handleUpdateSettingsRequest'](_0x164f0e);case a20_0x4b78('0x44'):return this[a20_0x4b78('0x52')](_0x164f0e);case a20_0x4b78('0x45'):return this[a20_0x4b78('0x53')](_0x164f0e);}}[a20_0x4b78('0x51')](_0x415d3a){if(_0x415d3a==a20_0x4b78('0x54')||_0x415d3a==String(this[a20_0x4b78('0xe')]['playerId'])){this['syncPlaylistsService'][a20_0x4b78('0x55')]();}}['handleIfconfigRequest'](_0x42c45e){if(_0x42c45e=='all'||_0x42c45e==String(this[a20_0x4b78('0xe')][a20_0x4b78('0x56')])){}}['handleUpdateRequest'](_0x1650dd){console['log'](a20_0x4b78('0x57')+_0x1650dd);if(_0x1650dd==a20_0x4b78('0x54')||_0x1650dd==String(this[a20_0x4b78('0xe')]['playerId'])){const _0x95022a=__dirname;const _0x4f50d6=require(a20_0x4b78('0x58'))(_0x95022a);console[a20_0x4b78('0x15')]('Git\x20updating');_0x4f50d6[a20_0x4b78('0x59')]((_0x29585b,_0x23c405)=>{if(_0x29585b){console[a20_0x4b78('0x15')](a20_0x4b78('0x5a'));this['handleUpdateRequest'](_0x1650dd);return;}else{}console[a20_0x4b78('0x15')](a20_0x4b78('0x5b'));console['log'](_0x23c405);if(_0x23c405&&_0x23c405['summary'][a20_0x4b78('0x5c')]){this[a20_0x4b78('0xe')]['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x28de5e){if(_0x28de5e==a20_0x4b78('0x54')||_0x28de5e==String(this[a20_0x4b78('0xe')]['playerId'])){this[a20_0x4b78('0xe')][a20_0x4b78('0x5d')]();}}[a20_0x4b78('0x4c')](_0x304c3f){if(String(_0x304c3f)==a20_0x4b78('0x54')||String(_0x304c3f)==String(this[a20_0x4b78('0xe')]['playerId'])){this[a20_0x4b78('0xe')][a20_0x4b78('0x5e')]();}}[a20_0x4b78('0x4b')](_0x36daa0){if(_0x36daa0==a20_0x4b78('0x54')||_0x36daa0==String(this['syncPlaylistsService'][a20_0x4b78('0x56')])){console['log']('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a20_0x4b78('0xe')][a20_0x4b78('0x5f')]();}catch(_0x2cff4c){console[a20_0x4b78('0x15')](_0x2cff4c);}}}[a20_0x4b78('0x60')](_0xe60fcc){if(_0xe60fcc==a20_0x4b78('0x54')||_0xe60fcc==String(this['syncPlaylistsService'][a20_0x4b78('0x56')])){console[a20_0x4b78('0x15')](a20_0x4b78('0x61'));try{this[a20_0x4b78('0xe')][a20_0x4b78('0x62')]();}catch(_0x16f218){console['log'](_0x16f218);}}}[a20_0x4b78('0x53')](_0x34c5aa){if(_0x34c5aa==a20_0x4b78('0x54')||_0x34c5aa==String(this[a20_0x4b78('0xe')][a20_0x4b78('0x56')])){console[a20_0x4b78('0x15')]('handleTurnOnTVRequest:\x20');try{this[a20_0x4b78('0xe')][a20_0x4b78('0x63')]();}catch(_0x30d702){console[a20_0x4b78('0x15')](_0x30d702);}}}['handleTurnOffTVRequest'](_0x412595){if(_0x412595==a20_0x4b78('0x54')||_0x412595==String(this[a20_0x4b78('0xe')][a20_0x4b78('0x56')])){console[a20_0x4b78('0x15')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a20_0x4b78('0x64')]();}catch(_0x15d5d0){console[a20_0x4b78('0x15')](_0x15d5d0);}}}['sendStateUpdate'](){console[a20_0x4b78('0x15')](a20_0x4b78('0x65'),this[a20_0x4b78('0xf')]);this[a20_0x4b78('0x36')]['publish']('player/state',this[a20_0x4b78('0xe')][a20_0x4b78('0x56')]+'-'+this[a20_0x4b78('0xf')]);}['handleOpenRequest'](_0x5e4e41){if(this[a20_0x4b78('0xf')]!==a20_0x4b78('0x66')&&this[a20_0x4b78('0xf')]!==a20_0x4b78('0x67')){console['log'](a20_0x4b78('0x68'));this['state']=a20_0x4b78('0x67');this[a20_0x4b78('0x69')]();setTimeout(()=>{this['state']=a20_0x4b78('0x66');this[a20_0x4b78('0x69')]();},0x1388);}}[a20_0x4b78('0x4a')](_0xf9c9a0){if(this[a20_0x4b78('0xf')]!==a20_0x4b78('0x10')&&this[a20_0x4b78('0xf')]!==a20_0x4b78('0x6a')){this[a20_0x4b78('0xf')]='closing';this['sendStateUpdate']();setTimeout(()=>{this['state']='closed';this[a20_0x4b78('0x69')]();},0x1388);}}['handleAppExit'](_0x453726,_0x49d2a8){if(_0x49d2a8){console[a20_0x4b78('0x15')](_0x49d2a8[a20_0x4b78('0x6b')]);}this[a20_0x4b78('0x36')][a20_0x4b78('0x27')]('player/connected',a20_0x4b78('0x6c'));}['createJwt'](_0x1812b5,_0x3750a2,_0x3179b7){const _0x1c4b13={'iat':Math[a20_0x4b78('0x6d')](Date[a20_0x4b78('0x1e')]()/0x3e8),'exp':Math[a20_0x4b78('0x6d')](Date[a20_0x4b78('0x1e')]()/0x3e8)+0x14*0x3c,'aud':_0x1812b5};const _0x4151d5=fs[a20_0x4b78('0x6e')](_0x3750a2);return jwt['sign'](_0x1c4b13,_0x4151d5,{'algorithm':_0x3179b7});}}exports[a20_0x4b78('0x6f')]=MqttService;