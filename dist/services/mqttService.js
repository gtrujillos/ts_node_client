var a18_0x3b93=['syncPlaylistsService','playerId','registerClient','all','pull','Error\x20git\x20updated','summary','changes','now','shutdown','sendStateUpdate','sending\x20state\x20%s','open','opening','opening\x20player\x20door','closing','closed','stack','publish','player/connected','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','is-image','string-template','uuid/v4','state','init','mqttInit','log','clientId','this.clientId','run.lulo_2018#.','mqttClient','connect','mqttClient_connect','message','mqttClient_message','bind','exit','SIGINT','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/reboot','player/load_playlist','reportStatus','player/open','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','player/register','handleRegisterRequest'];(function(_0x21e66a,_0x1cf2c5){var _0x4ad944=function(_0xb9cde1){while(--_0xb9cde1){_0x21e66a['push'](_0x21e66a['shift']());}};_0x4ad944(++_0x1cf2c5);}(a18_0x3b93,0x164));var a18_0x1858=function(_0x219c45,_0x4dc3f7){_0x219c45=_0x219c45-0x0;var _0x5c507d=a18_0x3b93[_0x219c45];return _0x5c507d;};'use strict';Object[a18_0x1858('0x0')](exports,a18_0x1858('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x1858('0x2'));const fs=require('fs');const fsExtra=require(a18_0x1858('0x3'));const request=require(a18_0x1858('0x4'));const progress=require(a18_0x1858('0x5'));const spawn=require(a18_0x1858('0x6'))[a18_0x1858('0x7')];const isImage=require(a18_0x1858('0x8'));const format=require(a18_0x1858('0x9'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x1858('0xa'));class MqttService{constructor(_0x5cfbcf){this['syncPlaylistsService']=_0x5cfbcf;this[a18_0x1858('0xb')]='closed';this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a18_0x1858('0xc')](){this[a18_0x1858('0xd')]();}[a18_0x1858('0xd')](){console[a18_0x1858('0xe')]('mqttInit');this[a18_0x1858('0xf')]=uuidv4();console[a18_0x1858('0xe')](a18_0x1858('0x10'));console['log'](this[a18_0x1858('0xf')]);const _0x31c118={'clientId':this['clientId'],'username':'lulo_mqtt','password':a18_0x1858('0x11'),'clean':!![]};this[a18_0x1858('0x12')]=mqtt[a18_0x1858('0x13')]('mqtt://lulo.run',_0x31c118);this[a18_0x1858('0x12')]['on'](a18_0x1858('0x13'),this[a18_0x1858('0x14')]['bind'](this));this['mqttClient']['on'](a18_0x1858('0x15'),this[a18_0x1858('0x16')][a18_0x1858('0x17')](this));process['on'](a18_0x1858('0x18'),this['handleAppExit'][a18_0x1858('0x17')](this));process['on'](a18_0x1858('0x19'),this[a18_0x1858('0x1a')]['bind'](this));process['on'](a18_0x1858('0x1b'),this[a18_0x1858('0x1a')][a18_0x1858('0x17')](this));}[a18_0x1858('0x14')](){console['log'](a18_0x1858('0x1c')+this['clientId']);this[a18_0x1858('0x12')][a18_0x1858('0x1d')]('player/open');this[a18_0x1858('0x12')][a18_0x1858('0x1d')](a18_0x1858('0x1e'));this[a18_0x1858('0x12')][a18_0x1858('0x1d')](a18_0x1858('0x1f'),{'qos':0x2});this[a18_0x1858('0x12')][a18_0x1858('0x1d')](a18_0x1858('0x20'),{'qos':0x2});this['mqttClient'][a18_0x1858('0x1d')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x1858('0x1d')]('player/update',{'qos':0x2});this['mqttClient']['subscribe']('player/ifconfig',{'qos':0x2});this[a18_0x1858('0x12')][a18_0x1858('0x1d')]('player/register',{'qos':0x2});}[a18_0x1858('0x21')](){}['mqttClient_message'](_0x4bb0d8,_0x41cfae){console['log']('received\x20message\x20%s\x20%s',_0x4bb0d8,_0x41cfae);switch(_0x4bb0d8){case a18_0x1858('0x22'):return this[a18_0x1858('0x23')](_0x41cfae);case'player/close':return this[a18_0x1858('0x24')](_0x41cfae);case a18_0x1858('0x1f'):return this[a18_0x1858('0x25')](_0x41cfae);case a18_0x1858('0x26'):return this[a18_0x1858('0x27')](_0x41cfae);case a18_0x1858('0x20'):return this[a18_0x1858('0x28')](_0x41cfae);case'player/update':return this[a18_0x1858('0x29')](_0x41cfae);case a18_0x1858('0x2a'):return this[a18_0x1858('0x2b')](_0x41cfae);case a18_0x1858('0x2c'):return this[a18_0x1858('0x2d')](_0x41cfae);}}[a18_0x1858('0x2d')](_0x4557c2){if(_0x4557c2=='all'||_0x4557c2==String(this[a18_0x1858('0x2e')][a18_0x1858('0x2f')])){this[a18_0x1858('0x2e')][a18_0x1858('0x30')]();}}['handleIfconfigRequest'](_0xe7cdcf){if(_0xe7cdcf==a18_0x1858('0x31')||_0xe7cdcf==String(this[a18_0x1858('0x2e')]['playerId'])){}}[a18_0x1858('0x29')](_0x4a04aa){console[a18_0x1858('0xe')]('handleUpdateRequest:\x20'+_0x4a04aa);if(_0x4a04aa=='all'||_0x4a04aa==String(this[a18_0x1858('0x2e')][a18_0x1858('0x2f')])){const _0x363615=__dirname;const _0x3e6836=require('simple-git')(_0x363615);console[a18_0x1858('0xe')]('Git\x20updating');_0x3e6836[a18_0x1858('0x32')]((_0xb3ad1f,_0x4199a7)=>{if(_0xb3ad1f){console['log'](a18_0x1858('0x33'));this[a18_0x1858('0x29')](_0x4a04aa);return;}else{}console[a18_0x1858('0xe')]('Git\x20updated');console[a18_0x1858('0xe')](_0x4199a7);if(_0x4199a7&&_0x4199a7[a18_0x1858('0x34')][a18_0x1858('0x35')]){const _0x7e3795=spawn('shutdown',['-r',a18_0x1858('0x36')]);}else{}});}}[a18_0x1858('0x28')](_0x411d69){if(_0x411d69==a18_0x1858('0x31')||_0x411d69==String(this[a18_0x1858('0x2e')]['playerId'])){this['syncPlaylistsService']['loadMediaList']();}}['handleReloadPlaylistRequest'](_0x215dc4){if(String(_0x215dc4)=='all'||String(_0x215dc4)==String(this[a18_0x1858('0x2e')][a18_0x1858('0x2f')])){this['syncPlaylistsService']['reloadMediaList']();}}[a18_0x1858('0x25')](_0x5d9dbe){if(_0x5d9dbe==a18_0x1858('0x31')||_0x5d9dbe==String(this[a18_0x1858('0x2e')]['playerId'])){const _0x357099=spawn(a18_0x1858('0x37'),['-r',a18_0x1858('0x36')]);}}[a18_0x1858('0x38')](){console['log'](a18_0x1858('0x39'),this[a18_0x1858('0xb')]);this[a18_0x1858('0x12')]['publish']('player/state',this[a18_0x1858('0x2e')]['playerId']+'-'+this['state']);}[a18_0x1858('0x23')](_0x587a0a){if(this['state']!==a18_0x1858('0x3a')&&this[a18_0x1858('0xb')]!==a18_0x1858('0x3b')){console[a18_0x1858('0xe')](a18_0x1858('0x3c'));this[a18_0x1858('0xb')]=a18_0x1858('0x3b');this[a18_0x1858('0x38')]();setTimeout(()=>{this[a18_0x1858('0xb')]='open';this[a18_0x1858('0x38')]();},0x1388);}}[a18_0x1858('0x24')](_0x9813f7){if(this[a18_0x1858('0xb')]!=='closed'&&this[a18_0x1858('0xb')]!==a18_0x1858('0x3d')){this[a18_0x1858('0xb')]=a18_0x1858('0x3d');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1858('0xb')]=a18_0x1858('0x3e');this[a18_0x1858('0x38')]();},0x1388);}}[a18_0x1858('0x1a')](_0x522b40,_0x460d38){if(_0x460d38){console[a18_0x1858('0xe')](_0x460d38[a18_0x1858('0x3f')]);}this[a18_0x1858('0x12')][a18_0x1858('0x40')](a18_0x1858('0x41'),'false');}}exports[a18_0x1858('0x42')]=MqttService;