var a18_0x46a8=['playerId','registerClient','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','handleCloseRequest','closing','player/connected','false','now','readFileSync','sign','MqttService','defineProperty','fs-extra','request','spawn','child_process','exec','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','subscribe','/devices/','/config','/state','/commands/#','connect','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','message','Message\x20received:\x20','Config\x20message\x20received:\x20','Command\x20message\x20received:\x20','base64','toString','ascii','packetsend','mqttInit_mosquitto','clientId','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/ifconfig','player/register','player/update_settings','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','all'];(function(_0x4b2a99,_0x2fdb44){var _0x52dbe5=function(_0x14b45d){while(--_0x14b45d){_0x4b2a99['push'](_0x4b2a99['shift']());}};_0x52dbe5(++_0x2fdb44);}(a18_0x46a8,0xfd));var a18_0x5f51=function(_0x136d68,_0x52053d){_0x136d68=_0x136d68-0x0;var _0x3d18a4=a18_0x46a8[_0x136d68];return _0x3d18a4;};'use strict';Object[a18_0x5f51('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x5f51('0x1'));const request=require(a18_0x5f51('0x2'));const progress=require('request-progress');const spawn=require('child_process')[a18_0x5f51('0x3')];const exec=require(a18_0x5f51('0x4'))[a18_0x5f51('0x5')];const isImage=require(a18_0x5f51('0x6'));const format=require(a18_0x5f51('0x7'));const os=require('os');const mqtt=require(a18_0x5f51('0x8'));const uuidv4=require(a18_0x5f51('0x9'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x3a3107){this[a18_0x5f51('0xa')]=_0x3a3107;this[a18_0x5f51('0xb')]=a18_0x5f51('0xc');this[a18_0x5f51('0xd')]=new HttpClientService_1[(a18_0x5f51('0xe'))]();}['init'](){this['mqttInit_mosquitto']();}[a18_0x5f51('0xf')](){console[a18_0x5f51('0x10')](a18_0x5f51('0x11'));const _0x56a1e7=a18_0x5f51('0x12');const _0xb6f825=a18_0x5f51('0x13');const _0x347fcc='my-registry';const _0x5f15ce=a18_0x5f51('0x14');const _0x1ac556=a18_0x5f51('0x15');const _0x13b8f7=a18_0x5f51('0x16');const _0x64c5ac='mqtt.googleapis.com';const _0x5d2db6=0x1bb;const _0x5556f3=a18_0x5f51('0x17');const _0x184a51=0x5;const _0x5c7cb5=a18_0x5f51('0x18')+_0x56a1e7+a18_0x5f51('0x19')+_0x5f15ce+a18_0x5f51('0x1a')+_0x347fcc+'/devices/'+_0xb6f825;const _0x380741={'host':_0x64c5ac,'port':_0x5d2db6,'clientId':_0x5c7cb5,'username':a18_0x5f51('0x1b'),'password':this[a18_0x5f51('0x1c')](_0x56a1e7,_0x13b8f7,_0x1ac556),'protocol':a18_0x5f51('0x1d'),'secureProtocol':a18_0x5f51('0x1e')};const _0x5d8566=Math[a18_0x5f51('0x1f')](Date['now']()/0x3e8);const _0x300c17=mqtt['connect'](_0x380741);_0x300c17[a18_0x5f51('0x20')](a18_0x5f51('0x21')+_0xb6f825+a18_0x5f51('0x22'),{'qos':0x1});_0x300c17[a18_0x5f51('0x20')](a18_0x5f51('0x21')+_0xb6f825+a18_0x5f51('0x23'),{'qos':0x1});_0x300c17[a18_0x5f51('0x20')]('/devices/'+_0xb6f825+a18_0x5f51('0x24'),{'qos':0x0});const _0x31f63a=a18_0x5f51('0x21')+_0xb6f825+'/'+_0x5556f3;_0x300c17['on'](a18_0x5f51('0x25'),_0x428976=>{console[a18_0x5f51('0x10')](a18_0x5f51('0x25'));if(!_0x428976){console['log'](a18_0x5f51('0x26'));}else{const _0x31f63a='/projects/velvety-glazing-252020/topics/my-topic';const _0x53afe6=_0x347fcc+'/'+_0xb6f825+a18_0x5f51('0x27');_0x300c17[a18_0x5f51('0x28')](_0x31f63a,_0x53afe6,{'qos':0x1},_0x2717b1=>{console['log'](a18_0x5f51('0x29'));console[a18_0x5f51('0x10')](_0x2717b1);if(!_0x2717b1){}});}});_0x300c17['on']('close',()=>{console[a18_0x5f51('0x10')](a18_0x5f51('0x2a'));});_0x300c17['on']('error',_0x19595c=>{console['log']('error',_0x19595c);});_0x300c17['on'](a18_0x5f51('0x2b'),(_0x11bc01,_0x46f190)=>{let _0x3252d4=a18_0x5f51('0x2c');console['log'](_0x11bc01);console[a18_0x5f51('0x10')](_0x46f190+'');if(_0x11bc01===a18_0x5f51('0x21')+_0xb6f825+a18_0x5f51('0x22')){_0x3252d4=a18_0x5f51('0x2d');}else if(_0x11bc01['startsWith'](a18_0x5f51('0x21')+_0xb6f825+'/commands')){_0x3252d4=a18_0x5f51('0x2e');}_0x3252d4+=Buffer['from'](_0x46f190,a18_0x5f51('0x2f'))[a18_0x5f51('0x30')](a18_0x5f51('0x31'));console[a18_0x5f51('0x10')](_0x3252d4);});_0x300c17['on'](a18_0x5f51('0x32'),()=>{});console[a18_0x5f51('0x10')](_0x380741);}[a18_0x5f51('0x33')](){console[a18_0x5f51('0x10')](a18_0x5f51('0x11'));this[a18_0x5f51('0x34')]=uuidv4();console[a18_0x5f51('0x10')](a18_0x5f51('0x35'));console[a18_0x5f51('0x10')](this[a18_0x5f51('0x34')]);const _0xbc9305={'clientId':this[a18_0x5f51('0x34')],'username':'lulo_mqtt','password':a18_0x5f51('0x36'),'clean':!![]};this[a18_0x5f51('0x37')]=mqtt[a18_0x5f51('0x25')](a18_0x5f51('0x38'),_0xbc9305);this['mqttClient']['on'](a18_0x5f51('0x25'),this[a18_0x5f51('0x39')][a18_0x5f51('0x3a')](this));this[a18_0x5f51('0x37')]['on'](a18_0x5f51('0x2b'),this[a18_0x5f51('0x3b')][a18_0x5f51('0x3a')](this));this['mqttClient']['on'](a18_0x5f51('0x2a'),()=>{console['log'](a18_0x5f51('0x2a'));});process['on'](a18_0x5f51('0x3c'),this[a18_0x5f51('0x3d')]['bind'](this));process['on']('SIGINT',this[a18_0x5f51('0x3d')][a18_0x5f51('0x3a')](this));process['on'](a18_0x5f51('0x3e'),this[a18_0x5f51('0x3d')][a18_0x5f51('0x3a')](this));}[a18_0x5f51('0x39')](){console[a18_0x5f51('0x10')](a18_0x5f51('0x3f')+this[a18_0x5f51('0x34')]);this[a18_0x5f51('0x37')][a18_0x5f51('0x20')](a18_0x5f51('0x40'));this[a18_0x5f51('0x37')][a18_0x5f51('0x20')](a18_0x5f51('0x41'));this[a18_0x5f51('0x37')]['subscribe'](a18_0x5f51('0x42'),{'qos':0x2});this[a18_0x5f51('0x37')][a18_0x5f51('0x20')](a18_0x5f51('0x43'),{'qos':0x2});this['mqttClient']['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x5f51('0x37')]['subscribe']('player/update',{'qos':0x2});this['mqttClient'][a18_0x5f51('0x20')](a18_0x5f51('0x44'),{'qos':0x2});this[a18_0x5f51('0x37')][a18_0x5f51('0x20')](a18_0x5f51('0x45'),{'qos':0x2});this['mqttClient'][a18_0x5f51('0x20')](a18_0x5f51('0x46'),{'qos':0x2});}[a18_0x5f51('0x47')](){}[a18_0x5f51('0x3b')](_0x39f92f,_0x5dc802){console[a18_0x5f51('0x10')](a18_0x5f51('0x48'),_0x39f92f,_0x5dc802);switch(_0x39f92f){case'player/open':return this[a18_0x5f51('0x49')](_0x5dc802);case'player/close':return this['handleCloseRequest'](_0x5dc802);case a18_0x5f51('0x42'):return this['handleRebootRequest'](_0x5dc802);case a18_0x5f51('0x4a'):return this[a18_0x5f51('0x4b')](_0x5dc802);case'player/load_playlist':return this[a18_0x5f51('0x4c')](_0x5dc802);case a18_0x5f51('0x4d'):return this[a18_0x5f51('0x4e')](_0x5dc802);case a18_0x5f51('0x44'):return this[a18_0x5f51('0x4f')](_0x5dc802);case a18_0x5f51('0x45'):return this[a18_0x5f51('0x50')](_0x5dc802);case a18_0x5f51('0x46'):return this[a18_0x5f51('0x51')](_0x5dc802);}}[a18_0x5f51('0x50')](_0x2ff03c){if(_0x2ff03c==a18_0x5f51('0x52')||_0x2ff03c==String(this['syncPlaylistsService'][a18_0x5f51('0x53')])){this[a18_0x5f51('0xa')][a18_0x5f51('0x54')]();}}['handleIfconfigRequest'](_0x124b9d){if(_0x124b9d==a18_0x5f51('0x52')||_0x124b9d==String(this[a18_0x5f51('0xa')][a18_0x5f51('0x53')])){}}['handleUpdateRequest'](_0x56693f){console[a18_0x5f51('0x10')]('handleUpdateRequest:\x20'+_0x56693f);if(_0x56693f==a18_0x5f51('0x52')||_0x56693f==String(this[a18_0x5f51('0xa')][a18_0x5f51('0x53')])){const _0x45d7a5=__dirname;const _0x28d7b4=require(a18_0x5f51('0x55'))(_0x45d7a5);console[a18_0x5f51('0x10')](a18_0x5f51('0x56'));_0x28d7b4[a18_0x5f51('0x57')]((_0x227d7c,_0x32b5e2)=>{if(_0x227d7c){console[a18_0x5f51('0x10')](a18_0x5f51('0x58'));this[a18_0x5f51('0x4e')](_0x56693f);return;}else{}console[a18_0x5f51('0x10')](a18_0x5f51('0x59'));console[a18_0x5f51('0x10')](_0x32b5e2);if(_0x32b5e2&&_0x32b5e2[a18_0x5f51('0x5a')][a18_0x5f51('0x5b')]){this[a18_0x5f51('0xa')][a18_0x5f51('0x5c')]();}else{}});}}['handleLoadPlaylistRequest'](_0x3147d7){if(_0x3147d7==a18_0x5f51('0x52')||_0x3147d7==String(this['syncPlaylistsService'][a18_0x5f51('0x53')])){this[a18_0x5f51('0xa')][a18_0x5f51('0x5d')]();}}[a18_0x5f51('0x4b')](_0x443198){if(String(_0x443198)==a18_0x5f51('0x52')||String(_0x443198)==String(this['syncPlaylistsService'][a18_0x5f51('0x53')])){this[a18_0x5f51('0xa')][a18_0x5f51('0x5e')]();}}[a18_0x5f51('0x5f')](_0x3e2237){if(_0x3e2237==a18_0x5f51('0x52')||_0x3e2237==String(this[a18_0x5f51('0xa')][a18_0x5f51('0x53')])){console[a18_0x5f51('0x10')](a18_0x5f51('0x60'));try{this[a18_0x5f51('0xa')][a18_0x5f51('0x5c')]();}catch(_0x3b49b){console[a18_0x5f51('0x10')](_0x3b49b);}}}[a18_0x5f51('0x51')](_0x9e385d){if(_0x9e385d==a18_0x5f51('0x52')||_0x9e385d==String(this[a18_0x5f51('0xa')][a18_0x5f51('0x53')])){console['log']('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a18_0x5f51('0x61')]();}catch(_0x515e5a){console[a18_0x5f51('0x10')](_0x515e5a);}}}[a18_0x5f51('0x62')](){console[a18_0x5f51('0x10')](a18_0x5f51('0x63'),this['state']);this[a18_0x5f51('0x37')][a18_0x5f51('0x28')](a18_0x5f51('0x64'),this[a18_0x5f51('0xa')]['playerId']+'-'+this[a18_0x5f51('0xb')]);}[a18_0x5f51('0x49')](_0x1ccf93){if(this[a18_0x5f51('0xb')]!==a18_0x5f51('0x65')&&this[a18_0x5f51('0xb')]!==a18_0x5f51('0x66')){console[a18_0x5f51('0x10')](a18_0x5f51('0x67'));this['state']=a18_0x5f51('0x66');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5f51('0xb')]=a18_0x5f51('0x65');this[a18_0x5f51('0x62')]();},0x1388);}}[a18_0x5f51('0x68')](_0x55db00){if(this['state']!==a18_0x5f51('0xc')&&this[a18_0x5f51('0xb')]!==a18_0x5f51('0x69')){this[a18_0x5f51('0xb')]=a18_0x5f51('0x69');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5f51('0xb')]=a18_0x5f51('0xc');this[a18_0x5f51('0x62')]();},0x1388);}}[a18_0x5f51('0x3d')](_0x22e6ee,_0x5b5497){if(_0x5b5497){console[a18_0x5f51('0x10')](_0x5b5497['stack']);}this[a18_0x5f51('0x37')]['publish'](a18_0x5f51('0x6a'),a18_0x5f51('0x6b'));}[a18_0x5f51('0x1c')](_0x41809f,_0x1c8351,_0x4d30ab){const _0x4ba60c={'iat':Math[a18_0x5f51('0x1f')](Date[a18_0x5f51('0x6c')]()/0x3e8),'exp':Math[a18_0x5f51('0x1f')](Date[a18_0x5f51('0x6c')]()/0x3e8)+0x14*0x3c,'aud':_0x41809f};const _0x2e2079=fs[a18_0x5f51('0x6d')](_0x1c8351);return jwt[a18_0x5f51('0x6e')](_0x4ba60c,_0x2e2079,{'algorithm':_0x4d30ab});}}exports[a18_0x5f51('0x6f')]=MqttService;