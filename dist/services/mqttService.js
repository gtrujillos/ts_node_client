var a18_0x11d5=['player/reload_playlist','player/register','reportStatus','received\x20message\x20%s\x20%s','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','registerClient','playerId','handleUpdateRequest','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','shutdown','now','loadMediaList','reloadMediaList','sending\x20state\x20%s','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','false','MqttService','__esModule','request','child_process','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','mqttInit','log','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','connect','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reboot','player/load_playlist'];(function(_0x4e63e7,_0x57a730){var _0x499d5b=function(_0xeb76c8){while(--_0xeb76c8){_0x4e63e7['push'](_0x4e63e7['shift']());}};_0x499d5b(++_0x57a730);}(a18_0x11d5,0xad));var a18_0xba37=function(_0x48ed33,_0x2d3ab7){_0x48ed33=_0x48ed33-0x0;var _0x32b524=a18_0x11d5[_0x48ed33];return _0x32b524;};'use strict';Object['defineProperty'](exports,a18_0xba37('0x0'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0xba37('0x1'));const progress=require('request-progress');const spawn=require(a18_0xba37('0x2'))['spawn'];const isImage=require(a18_0xba37('0x3'));const format=require(a18_0xba37('0x4'));const os=require('os');const mqtt=require(a18_0xba37('0x5'));const uuidv4=require(a18_0xba37('0x6'));class MqttService{constructor(_0x31267a){this[a18_0xba37('0x7')]=_0x31267a;this[a18_0xba37('0x8')]=a18_0xba37('0x9');this[a18_0xba37('0xa')]=new HttpClientService_1['HttpClientService']();}[a18_0xba37('0xb')](){this[a18_0xba37('0xc')]();}[a18_0xba37('0xc')](){console['log'](a18_0xba37('0xc'));this['clientId']=uuidv4();console[a18_0xba37('0xd')](a18_0xba37('0xe'));console['log'](this[a18_0xba37('0xf')]);const _0x48b1a8={'clientId':this[a18_0xba37('0xf')],'username':a18_0xba37('0x10'),'password':a18_0xba37('0x11'),'clean':!![]};this[a18_0xba37('0x12')]=mqtt['connect'](a18_0xba37('0x13'),_0x48b1a8);this['mqttClient']['on'](a18_0xba37('0x14'),this[a18_0xba37('0x15')][a18_0xba37('0x16')](this));this[a18_0xba37('0x12')]['on'](a18_0xba37('0x17'),this[a18_0xba37('0x18')]['bind'](this));process['on'](a18_0xba37('0x19'),this[a18_0xba37('0x1a')][a18_0xba37('0x16')](this));process['on'](a18_0xba37('0x1b'),this[a18_0xba37('0x1a')]['bind'](this));process['on']('uncaughtException',this[a18_0xba37('0x1a')][a18_0xba37('0x16')](this));}[a18_0xba37('0x15')](){console[a18_0xba37('0xd')](a18_0xba37('0x1c')+this[a18_0xba37('0xf')]);this[a18_0xba37('0x12')][a18_0xba37('0x1d')](a18_0xba37('0x1e'));this[a18_0xba37('0x12')][a18_0xba37('0x1d')](a18_0xba37('0x1f'));this[a18_0xba37('0x12')][a18_0xba37('0x1d')](a18_0xba37('0x20'),{'qos':0x2});this[a18_0xba37('0x12')][a18_0xba37('0x1d')](a18_0xba37('0x21'),{'qos':0x2});this['mqttClient'][a18_0xba37('0x1d')](a18_0xba37('0x22'),{'qos':0x2});this[a18_0xba37('0x12')][a18_0xba37('0x1d')]('player/update',{'qos':0x2});this[a18_0xba37('0x12')]['subscribe']('player/ifconfig',{'qos':0x2});this[a18_0xba37('0x12')]['subscribe'](a18_0xba37('0x23'),{'qos':0x2});}[a18_0xba37('0x24')](){}[a18_0xba37('0x18')](_0xc6e63f,_0x245536){console['log'](a18_0xba37('0x25'),_0xc6e63f,_0x245536);switch(_0xc6e63f){case a18_0xba37('0x1e'):return this['handleOpenRequest'](_0x245536);case a18_0xba37('0x1f'):return this['handleCloseRequest'](_0x245536);case a18_0xba37('0x20'):return this[a18_0xba37('0x26')](_0x245536);case a18_0xba37('0x22'):return this[a18_0xba37('0x27')](_0x245536);case'player/load_playlist':return this[a18_0xba37('0x28')](_0x245536);case a18_0xba37('0x29'):return this['handleUpdateRequest'](_0x245536);case a18_0xba37('0x2a'):return this[a18_0xba37('0x2b')](_0x245536);case a18_0xba37('0x23'):return this[a18_0xba37('0x2c')](_0x245536);}}[a18_0xba37('0x2c')](_0x472220){if(_0x472220==a18_0xba37('0x2d')||_0x472220==String(this[a18_0xba37('0x7')]['playerId'])){this[a18_0xba37('0x7')][a18_0xba37('0x2e')]();}}[a18_0xba37('0x2b')](_0x490ce6){if(_0x490ce6==a18_0xba37('0x2d')||_0x490ce6==String(this[a18_0xba37('0x7')][a18_0xba37('0x2f')])){}}[a18_0xba37('0x30')](_0x19fdd3){console[a18_0xba37('0xd')]('handleUpdateRequest:\x20'+_0x19fdd3);if(_0x19fdd3=='all'||_0x19fdd3==String(this['syncPlaylistsService']['playerId'])){const _0x1658fb=__dirname;const _0x23a581=require(a18_0xba37('0x31'))(_0x1658fb);console[a18_0xba37('0xd')](a18_0xba37('0x32'));_0x23a581[a18_0xba37('0x33')]((_0x5e4feb,_0x5942c3)=>{if(_0x5e4feb){console[a18_0xba37('0xd')](a18_0xba37('0x34'));this[a18_0xba37('0x30')](_0x19fdd3);return;}else{}console[a18_0xba37('0xd')]('Git\x20updated');console[a18_0xba37('0xd')](_0x5942c3);if(_0x5942c3&&_0x5942c3[a18_0xba37('0x35')]['changes']){const _0x46e7f5=spawn(a18_0xba37('0x36'),['-r',a18_0xba37('0x37')]);}else{}});}}['handleLoadPlaylistRequest'](_0x518cff){if(_0x518cff==a18_0xba37('0x2d')||_0x518cff==String(this[a18_0xba37('0x7')]['playerId'])){this['syncPlaylistsService'][a18_0xba37('0x38')]();}}[a18_0xba37('0x27')](_0xad30bb){if(String(_0xad30bb)=='all'||String(_0xad30bb)==String(this[a18_0xba37('0x7')][a18_0xba37('0x2f')])){this[a18_0xba37('0x7')][a18_0xba37('0x39')]();}}[a18_0xba37('0x26')](_0x4e52dd){if(_0x4e52dd==a18_0xba37('0x2d')||_0x4e52dd==String(this['syncPlaylistsService'][a18_0xba37('0x2f')])){const _0x40c2ff=spawn('shutdown',['-r',a18_0xba37('0x37')]);}}['sendStateUpdate'](){console['log'](a18_0xba37('0x3a'),this[a18_0xba37('0x8')]);this[a18_0xba37('0x12')]['publish'](a18_0xba37('0x3b'),this['syncPlaylistsService'][a18_0xba37('0x2f')]+'-'+this['state']);}[a18_0xba37('0x3c')](_0x13f74a){if(this['state']!==a18_0xba37('0x3d')&&this[a18_0xba37('0x8')]!==a18_0xba37('0x3e')){console[a18_0xba37('0xd')](a18_0xba37('0x3f'));this[a18_0xba37('0x8')]=a18_0xba37('0x3e');this['sendStateUpdate']();setTimeout(()=>{this['state']=a18_0xba37('0x3d');this[a18_0xba37('0x40')]();},0x1388);}}[a18_0xba37('0x41')](_0x540820){if(this[a18_0xba37('0x8')]!==a18_0xba37('0x9')&&this[a18_0xba37('0x8')]!==a18_0xba37('0x42')){this[a18_0xba37('0x8')]=a18_0xba37('0x42');this[a18_0xba37('0x40')]();setTimeout(()=>{this[a18_0xba37('0x8')]=a18_0xba37('0x9');this[a18_0xba37('0x40')]();},0x1388);}}[a18_0xba37('0x1a')](_0x17f828,_0x5c938d){if(_0x5c938d){console['log'](_0x5c938d['stack']);}this[a18_0xba37('0x12')]['publish']('player/connected',a18_0xba37('0x43'));}}exports[a18_0xba37('0x44')]=MqttService;