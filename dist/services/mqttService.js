var a18_0x3f75=['mqttClient','mqttClient_connect','exit','handleAppExit','bind','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','mqttClient_message','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','Git\x20updating','reset','Reset\x20result:','clean','clean\x20result:','pull','Git\x20updated','summary','changes','reboot','Git\x20no\x20changes','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','open','opening','opening\x20player\x20door','closing','stack','sign','defineProperty','__esModule','fs-extra','request','request-progress','spawn','exec','is-image','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','/config','subscribe','/state','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','toString','ascii','packetsend','mqttInit_mosquitto','this.clientId','clientId','mqtt://lulo.run'];(function(_0x5705c7,_0x29bf44){var _0x1bf50c=function(_0x12cd39){while(--_0x12cd39){_0x5705c7['push'](_0x5705c7['shift']());}};_0x1bf50c(++_0x29bf44);}(a18_0x3f75,0xa8));var a18_0x3a72=function(_0x2a631d,_0xfb5e00){_0x2a631d=_0x2a631d-0x0;var _0x3684f6=a18_0x3f75[_0x2a631d];return _0x3684f6;};'use strict';Object[a18_0x3a72('0x0')](exports,a18_0x3a72('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x3a72('0x2'));const request=require(a18_0x3a72('0x3'));const progress=require(a18_0x3a72('0x4'));const spawn=require('child_process')[a18_0x3a72('0x5')];const exec=require('child_process')[a18_0x3a72('0x6')];const isImage=require(a18_0x3a72('0x7'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x3a72('0x8'));const uuidv4=require(a18_0x3a72('0x9'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x2e6fda){this[a18_0x3a72('0xa')]=_0x2e6fda;this[a18_0x3a72('0xb')]=a18_0x3a72('0xc');this[a18_0x3a72('0xd')]=new HttpClientService_1[(a18_0x3a72('0xe'))]();}[a18_0x3a72('0xf')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console[a18_0x3a72('0x10')](a18_0x3a72('0x11'));const _0x2f3760=a18_0x3a72('0x12');const _0x51c93e=a18_0x3a72('0x13');const _0x2102f0=a18_0x3a72('0x14');const _0x5a071f=a18_0x3a72('0x15');const _0x253617=a18_0x3a72('0x16');const _0x32e5dc=a18_0x3a72('0x17');const _0x2f8415=a18_0x3a72('0x18');const _0x1338ce=0x1bb;const _0x335f75=a18_0x3a72('0x19');const _0x56dfda=0x5;const _0x57a1c3=a18_0x3a72('0x1a')+_0x2f3760+a18_0x3a72('0x1b')+_0x5a071f+a18_0x3a72('0x1c')+_0x2102f0+a18_0x3a72('0x1d')+_0x51c93e;const _0x5641d7={'host':_0x2f8415,'port':_0x1338ce,'clientId':_0x57a1c3,'username':a18_0x3a72('0x1e'),'password':this[a18_0x3a72('0x1f')](_0x2f3760,_0x32e5dc,_0x253617),'protocol':a18_0x3a72('0x20'),'secureProtocol':a18_0x3a72('0x21')};const _0x49e5c7=Math[a18_0x3a72('0x22')](Date[a18_0x3a72('0x23')]()/0x3e8);const _0x48ef19=mqtt['connect'](_0x5641d7);_0x48ef19['subscribe'](a18_0x3a72('0x1d')+_0x51c93e+a18_0x3a72('0x24'),{'qos':0x1});_0x48ef19[a18_0x3a72('0x25')](a18_0x3a72('0x1d')+_0x51c93e+a18_0x3a72('0x26'),{'qos':0x1});_0x48ef19[a18_0x3a72('0x25')](a18_0x3a72('0x1d')+_0x51c93e+'/commands/#',{'qos':0x0});const _0x45b1ff=a18_0x3a72('0x1d')+_0x51c93e+'/'+_0x335f75;_0x48ef19['on'](a18_0x3a72('0x27'),_0x41d2a9=>{console[a18_0x3a72('0x10')](a18_0x3a72('0x27'));if(!_0x41d2a9){console['log'](a18_0x3a72('0x28'));}else{const _0x45b1ff=a18_0x3a72('0x29');const _0x3e8d9c=_0x2102f0+'/'+_0x51c93e+a18_0x3a72('0x2a');_0x48ef19[a18_0x3a72('0x2b')](_0x45b1ff,_0x3e8d9c,{'qos':0x1},_0x3269b9=>{console[a18_0x3a72('0x10')](a18_0x3a72('0x2c'));console[a18_0x3a72('0x10')](_0x3269b9);if(!_0x3269b9){}});}});_0x48ef19['on'](a18_0x3a72('0x2d'),()=>{console[a18_0x3a72('0x10')]('close');});_0x48ef19['on'](a18_0x3a72('0x2e'),_0x55d248=>{console[a18_0x3a72('0x10')]('error',_0x55d248);});_0x48ef19['on'](a18_0x3a72('0x2f'),(_0x104bb5,_0x58b839)=>{let _0x4abf29=a18_0x3a72('0x30');console[a18_0x3a72('0x10')](_0x104bb5);console[a18_0x3a72('0x10')](_0x58b839+'');if(_0x104bb5==='/devices/'+_0x51c93e+a18_0x3a72('0x24')){_0x4abf29=a18_0x3a72('0x31');}else if(_0x104bb5[a18_0x3a72('0x32')]('/devices/'+_0x51c93e+a18_0x3a72('0x33'))){_0x4abf29=a18_0x3a72('0x34');}_0x4abf29+=Buffer['from'](_0x58b839,'base64')[a18_0x3a72('0x35')](a18_0x3a72('0x36'));console[a18_0x3a72('0x10')](_0x4abf29);});_0x48ef19['on'](a18_0x3a72('0x37'),()=>{});console[a18_0x3a72('0x10')](_0x5641d7);}[a18_0x3a72('0x38')](){console['log']('mqttInit');this['clientId']=uuidv4();console[a18_0x3a72('0x10')](a18_0x3a72('0x39'));console[a18_0x3a72('0x10')](this['clientId']);const _0x5d3d82={'clientId':this[a18_0x3a72('0x3a')],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this['mqttClient']=mqtt[a18_0x3a72('0x27')](a18_0x3a72('0x3b'),_0x5d3d82);this[a18_0x3a72('0x3c')]['on'](a18_0x3a72('0x27'),this[a18_0x3a72('0x3d')]['bind'](this));this[a18_0x3a72('0x3c')]['on'](a18_0x3a72('0x2f'),this['mqttClient_message']['bind'](this));this[a18_0x3a72('0x3c')]['on'](a18_0x3a72('0x2d'),()=>{console[a18_0x3a72('0x10')](a18_0x3a72('0x2d'));});process['on'](a18_0x3a72('0x3e'),this[a18_0x3a72('0x3f')][a18_0x3a72('0x40')](this));process['on'](a18_0x3a72('0x41'),this['handleAppExit'][a18_0x3a72('0x40')](this));process['on'](a18_0x3a72('0x42'),this[a18_0x3a72('0x3f')]['bind'](this));}[a18_0x3a72('0x3d')](){console[a18_0x3a72('0x10')](a18_0x3a72('0x43')+this[a18_0x3a72('0x3a')]);this[a18_0x3a72('0x3c')][a18_0x3a72('0x25')](a18_0x3a72('0x44'));this['mqttClient'][a18_0x3a72('0x25')](a18_0x3a72('0x45'));this[a18_0x3a72('0x3c')][a18_0x3a72('0x25')](a18_0x3a72('0x46'),{'qos':0x2});this[a18_0x3a72('0x3c')][a18_0x3a72('0x25')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a18_0x3a72('0x25')](a18_0x3a72('0x47'),{'qos':0x2});this['mqttClient'][a18_0x3a72('0x25')](a18_0x3a72('0x48'),{'qos':0x2});this[a18_0x3a72('0x3c')]['subscribe'](a18_0x3a72('0x49'),{'qos':0x2});this[a18_0x3a72('0x3c')]['subscribe'](a18_0x3a72('0x4a'),{'qos':0x2});this[a18_0x3a72('0x3c')]['subscribe'](a18_0x3a72('0x4b'),{'qos':0x2});}['reportStatus'](){}[a18_0x3a72('0x4c')](_0x526ee7,_0x11d01f){console[a18_0x3a72('0x10')]('received\x20message\x20%s\x20%s',_0x526ee7,_0x11d01f);switch(_0x526ee7){case'player/open':return this[a18_0x3a72('0x4d')](_0x11d01f);case a18_0x3a72('0x45'):return this[a18_0x3a72('0x4e')](_0x11d01f);case a18_0x3a72('0x46'):return this[a18_0x3a72('0x4f')](_0x11d01f);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x11d01f);case'player/load_playlist':return this[a18_0x3a72('0x50')](_0x11d01f);case'player/update':return this['handleUpdateRequest'](_0x11d01f);case a18_0x3a72('0x49'):return this[a18_0x3a72('0x51')](_0x11d01f);case a18_0x3a72('0x4a'):return this[a18_0x3a72('0x52')](_0x11d01f);case a18_0x3a72('0x4b'):return this['handleUpdateSettingsRequest'](_0x11d01f);}}['handleRegisterRequest'](_0x4afa9b){if(_0x4afa9b==a18_0x3a72('0x53')||_0x4afa9b==String(this[a18_0x3a72('0xa')][a18_0x3a72('0x54')])){this['syncPlaylistsService'][a18_0x3a72('0x55')]();}}[a18_0x3a72('0x51')](_0x1a2c90){if(_0x1a2c90==a18_0x3a72('0x53')||_0x1a2c90==String(this[a18_0x3a72('0xa')][a18_0x3a72('0x54')])){}}[a18_0x3a72('0x56')](_0x17feca){console['log'](a18_0x3a72('0x57')+_0x17feca);if(_0x17feca==a18_0x3a72('0x53')||_0x17feca==String(this[a18_0x3a72('0xa')][a18_0x3a72('0x54')])){const _0x6663d1=__dirname;const _0x94630a=require(a18_0x3a72('0x58'))(_0x6663d1);console[a18_0x3a72('0x10')](a18_0x3a72('0x59'));_0x94630a[a18_0x3a72('0x5a')]('hard',(_0x3d9522,_0x3de662)=>{console[a18_0x3a72('0x10')](a18_0x3a72('0x5b')+_0x3de662);_0x94630a[a18_0x3a72('0x5c')]('f',(_0x3d9522,_0x3de662)=>{console[a18_0x3a72('0x10')](a18_0x3a72('0x5d')+_0x3de662);_0x94630a[a18_0x3a72('0x5e')]((_0x3d9522,_0x3e8b98)=>{if(_0x3d9522){console['log']('Error\x20git\x20updated');this['handleUpdateRequest'](_0x17feca);return;}else{}console[a18_0x3a72('0x10')](a18_0x3a72('0x5f'));console[a18_0x3a72('0x10')](_0x3e8b98);if(_0x3e8b98&&_0x3e8b98[a18_0x3a72('0x60')][a18_0x3a72('0x61')]){this[a18_0x3a72('0xa')][a18_0x3a72('0x62')]();}else{console[a18_0x3a72('0x10')](a18_0x3a72('0x63'));}});});});}}[a18_0x3a72('0x50')](_0x210d2e){if(_0x210d2e=='all'||_0x210d2e==String(this['syncPlaylistsService'][a18_0x3a72('0x54')])){this[a18_0x3a72('0xa')][a18_0x3a72('0x64')]();}}[a18_0x3a72('0x65')](_0x1d8e5f){if(String(_0x1d8e5f)==a18_0x3a72('0x53')||String(_0x1d8e5f)==String(this['syncPlaylistsService']['playerId'])){this[a18_0x3a72('0xa')][a18_0x3a72('0x66')]();}}['handleRebootRequest'](_0x16012b){if(_0x16012b==a18_0x3a72('0x53')||_0x16012b==String(this[a18_0x3a72('0xa')][a18_0x3a72('0x54')])){console[a18_0x3a72('0x10')](a18_0x3a72('0x67'));try{this[a18_0x3a72('0xa')][a18_0x3a72('0x62')]();}catch(_0x300bbd){console[a18_0x3a72('0x10')](_0x300bbd);}}}['handleUpdateSettingsRequest'](_0x324f9c){if(_0x324f9c==a18_0x3a72('0x53')||_0x324f9c==String(this[a18_0x3a72('0xa')][a18_0x3a72('0x54')])){console['log'](a18_0x3a72('0x68'));try{this[a18_0x3a72('0xa')][a18_0x3a72('0x69')]();}catch(_0x24746d){console[a18_0x3a72('0x10')](_0x24746d);}}}[a18_0x3a72('0x6a')](){console['log'](a18_0x3a72('0x6b'),this[a18_0x3a72('0xb')]);this[a18_0x3a72('0x3c')][a18_0x3a72('0x2b')]('player/state',this[a18_0x3a72('0xa')][a18_0x3a72('0x54')]+'-'+this[a18_0x3a72('0xb')]);}['handleOpenRequest'](_0x1acd3c){if(this[a18_0x3a72('0xb')]!==a18_0x3a72('0x6c')&&this[a18_0x3a72('0xb')]!==a18_0x3a72('0x6d')){console[a18_0x3a72('0x10')](a18_0x3a72('0x6e'));this[a18_0x3a72('0xb')]=a18_0x3a72('0x6d');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x3a72('0xb')]=a18_0x3a72('0x6c');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x3b9c29){if(this[a18_0x3a72('0xb')]!==a18_0x3a72('0xc')&&this[a18_0x3a72('0xb')]!==a18_0x3a72('0x6f')){this['state']='closing';this[a18_0x3a72('0x6a')]();setTimeout(()=>{this[a18_0x3a72('0xb')]=a18_0x3a72('0xc');this[a18_0x3a72('0x6a')]();},0x1388);}}[a18_0x3a72('0x3f')](_0x5b3d5d,_0x392c0f){if(_0x392c0f){console[a18_0x3a72('0x10')](_0x392c0f[a18_0x3a72('0x70')]);}this[a18_0x3a72('0x3c')][a18_0x3a72('0x2b')]('player/connected','false');}['createJwt'](_0x14c0b4,_0x23d3f9,_0x31ee3f){const _0x23e234={'iat':Math[a18_0x3a72('0x22')](Date[a18_0x3a72('0x23')]()/0x3e8),'exp':Math[a18_0x3a72('0x22')](Date[a18_0x3a72('0x23')]()/0x3e8)+0x14*0x3c,'aud':_0x14c0b4};const _0x2108f6=fs['readFileSync'](_0x23d3f9);return jwt[a18_0x3a72('0x71')](_0x23e234,_0x2108f6,{'algorithm':_0x31ee3f});}}exports['MqttService']=MqttService;