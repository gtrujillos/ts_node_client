var a18_0x365c=['mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','this.clientId','clientId','run.lulo_2018#.','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','mqttClient','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','all','playerId','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','loadMediaList','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','readFileSync','sign','defineProperty','./../infrastructure/HttpClientService','fs-extra','request-progress','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','HttpClientService','init','mqttInit_mosquitto'];(function(_0x3ab30f,_0x76158d){var _0x179a92=function(_0x1264a8){while(--_0x1264a8){_0x3ab30f['push'](_0x3ab30f['shift']());}};_0x179a92(++_0x76158d);}(a18_0x365c,0x196));var a18_0x34fb=function(_0x5c7847,_0x1ba9a1){_0x5c7847=_0x5c7847-0x0;var _0x34d43f=a18_0x365c[_0x5c7847];return _0x34d43f;};'use strict';Object[a18_0x34fb('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x34fb('0x1'));const fs=require('fs');const fsExtra=require(a18_0x34fb('0x2'));const request=require('request');const progress=require(a18_0x34fb('0x3'));const spawn=require('child_process')['spawn'];const isImage=require(a18_0x34fb('0x4'));const format=require(a18_0x34fb('0x5'));const os=require('os');const mqtt=require(a18_0x34fb('0x6'));const uuidv4=require(a18_0x34fb('0x7'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1783c2){this[a18_0x34fb('0x8')]=_0x1783c2;this[a18_0x34fb('0x9')]=a18_0x34fb('0xa');this['httpClientService']=new HttpClientService_1[(a18_0x34fb('0xb'))]();}[a18_0x34fb('0xc')](){this[a18_0x34fb('0xd')]();}[a18_0x34fb('0xe')](){console[a18_0x34fb('0xf')](a18_0x34fb('0x10'));const _0x4c61fa=a18_0x34fb('0x11');const _0x4d9d55='my-node-device';const _0x563e99=a18_0x34fb('0x12');const _0x4e8d9c='us-central1';const _0x28a214='RS256';const _0x2656dc=a18_0x34fb('0x13');const _0x4184c4=a18_0x34fb('0x14');const _0x4e18da=0x1bb;const _0x11df37=a18_0x34fb('0x15');const _0x338890=0x5;const _0x1c4ad4=a18_0x34fb('0x16')+_0x4c61fa+a18_0x34fb('0x17')+_0x4e8d9c+a18_0x34fb('0x18')+_0x563e99+'/devices/'+_0x4d9d55;const _0x5a36a0={'host':_0x4184c4,'port':_0x4e18da,'clientId':_0x1c4ad4,'username':a18_0x34fb('0x19'),'password':this[a18_0x34fb('0x1a')](_0x4c61fa,_0x2656dc,_0x28a214),'protocol':'mqtts','secureProtocol':a18_0x34fb('0x1b')};const _0x291cb6=Math[a18_0x34fb('0x1c')](Date[a18_0x34fb('0x1d')]()/0x3e8);const _0x11914e=mqtt[a18_0x34fb('0x1e')](_0x5a36a0);_0x11914e[a18_0x34fb('0x1f')](a18_0x34fb('0x20')+_0x4d9d55+a18_0x34fb('0x21'),{'qos':0x1});_0x11914e['subscribe'](a18_0x34fb('0x20')+_0x4d9d55+a18_0x34fb('0x22'),{'qos':0x1});_0x11914e[a18_0x34fb('0x1f')](a18_0x34fb('0x20')+_0x4d9d55+a18_0x34fb('0x23'),{'qos':0x0});const _0x1c4cbd=a18_0x34fb('0x20')+_0x4d9d55+'/'+_0x11df37;_0x11914e['on']('connect',_0x27a844=>{console[a18_0x34fb('0xf')](a18_0x34fb('0x1e'));if(!_0x27a844){console[a18_0x34fb('0xf')](a18_0x34fb('0x24'));}else{const _0x1c4cbd=a18_0x34fb('0x25');const _0xb0e9ca=_0x563e99+'/'+_0x4d9d55+'-payload-0';_0x11914e[a18_0x34fb('0x26')](_0x1c4cbd,_0xb0e9ca,{'qos':0x1},_0x9dbf47=>{console[a18_0x34fb('0xf')](a18_0x34fb('0x27'));console[a18_0x34fb('0xf')](_0x9dbf47);if(!_0x9dbf47){}});}});_0x11914e['on']('close',()=>{console[a18_0x34fb('0xf')](a18_0x34fb('0x28'));});_0x11914e['on'](a18_0x34fb('0x29'),_0x4dd4bf=>{console[a18_0x34fb('0xf')](a18_0x34fb('0x29'),_0x4dd4bf);});_0x11914e['on'](a18_0x34fb('0x2a'),(_0xee80f9,_0x10fc6b)=>{let _0x13301a=a18_0x34fb('0x2b');console[a18_0x34fb('0xf')](_0xee80f9);console[a18_0x34fb('0xf')](_0x10fc6b+'');if(_0xee80f9===a18_0x34fb('0x20')+_0x4d9d55+a18_0x34fb('0x21')){_0x13301a='Config\x20message\x20received:\x20';}else if(_0xee80f9[a18_0x34fb('0x2c')](a18_0x34fb('0x20')+_0x4d9d55+a18_0x34fb('0x2d'))){_0x13301a=a18_0x34fb('0x2e');}_0x13301a+=Buffer[a18_0x34fb('0x2f')](_0x10fc6b,a18_0x34fb('0x30'))[a18_0x34fb('0x31')](a18_0x34fb('0x32'));console[a18_0x34fb('0xf')](_0x13301a);});_0x11914e['on'](a18_0x34fb('0x33'),()=>{});console[a18_0x34fb('0xf')](_0x5a36a0);}[a18_0x34fb('0xd')](){console['log'](a18_0x34fb('0x10'));this['clientId']=uuidv4();console['log'](a18_0x34fb('0x34'));console[a18_0x34fb('0xf')](this[a18_0x34fb('0x35')]);const _0x23689d={'clientId':this[a18_0x34fb('0x35')],'username':'lulo_mqtt','password':a18_0x34fb('0x36'),'clean':!![]};this['mqttClient']=mqtt[a18_0x34fb('0x1e')](a18_0x34fb('0x37'),_0x23689d);this['mqttClient']['on'](a18_0x34fb('0x1e'),this[a18_0x34fb('0x38')][a18_0x34fb('0x39')](this));this['mqttClient']['on']('message',this[a18_0x34fb('0x3a')][a18_0x34fb('0x39')](this));this[a18_0x34fb('0x3b')]['on'](a18_0x34fb('0x28'),()=>{console[a18_0x34fb('0xf')](a18_0x34fb('0x28'));});process['on'](a18_0x34fb('0x3c'),this[a18_0x34fb('0x3d')][a18_0x34fb('0x39')](this));process['on'](a18_0x34fb('0x3e'),this[a18_0x34fb('0x3d')][a18_0x34fb('0x39')](this));process['on'](a18_0x34fb('0x3f'),this[a18_0x34fb('0x3d')][a18_0x34fb('0x39')](this));}[a18_0x34fb('0x38')](){console['log'](a18_0x34fb('0x40')+this[a18_0x34fb('0x35')]);this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')]('player/open');this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')](a18_0x34fb('0x41'));this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')](a18_0x34fb('0x42'),{'qos':0x2});this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')](a18_0x34fb('0x43'),{'qos':0x2});this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')](a18_0x34fb('0x44'),{'qos':0x2});this[a18_0x34fb('0x3b')]['subscribe'](a18_0x34fb('0x45'),{'qos':0x2});this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')]('player/ifconfig',{'qos':0x2});this[a18_0x34fb('0x3b')][a18_0x34fb('0x1f')](a18_0x34fb('0x46'),{'qos':0x2});}[a18_0x34fb('0x47')](){}[a18_0x34fb('0x3a')](_0x84db74,_0x4ffdeb){console['log'](a18_0x34fb('0x48'),_0x84db74,_0x4ffdeb);switch(_0x84db74){case'player/open':return this[a18_0x34fb('0x49')](_0x4ffdeb);case a18_0x34fb('0x41'):return this[a18_0x34fb('0x4a')](_0x4ffdeb);case'player/reboot':return this[a18_0x34fb('0x4b')](_0x4ffdeb);case a18_0x34fb('0x44'):return this[a18_0x34fb('0x4c')](_0x4ffdeb);case a18_0x34fb('0x43'):return this[a18_0x34fb('0x4d')](_0x4ffdeb);case a18_0x34fb('0x45'):return this[a18_0x34fb('0x4e')](_0x4ffdeb);case a18_0x34fb('0x4f'):return this[a18_0x34fb('0x50')](_0x4ffdeb);case a18_0x34fb('0x46'):return this[a18_0x34fb('0x51')](_0x4ffdeb);}}[a18_0x34fb('0x51')](_0x507993){if(_0x507993==a18_0x34fb('0x52')||_0x507993==String(this[a18_0x34fb('0x8')]['playerId'])){this[a18_0x34fb('0x8')]['registerClient']();}}[a18_0x34fb('0x50')](_0x59e1ef){if(_0x59e1ef=='all'||_0x59e1ef==String(this[a18_0x34fb('0x8')][a18_0x34fb('0x53')])){}}['handleUpdateRequest'](_0x2dce56){console['log'](a18_0x34fb('0x54')+_0x2dce56);if(_0x2dce56==a18_0x34fb('0x52')||_0x2dce56==String(this['syncPlaylistsService'][a18_0x34fb('0x53')])){const _0x547adf=__dirname;const _0x5da268=require('simple-git')(_0x547adf);console[a18_0x34fb('0xf')](a18_0x34fb('0x55'));_0x5da268[a18_0x34fb('0x56')]((_0x3df543,_0x4c2cc0)=>{if(_0x3df543){console[a18_0x34fb('0xf')](a18_0x34fb('0x57'));this[a18_0x34fb('0x4e')](_0x2dce56);return;}else{}console[a18_0x34fb('0xf')](a18_0x34fb('0x58'));console['log'](_0x4c2cc0);if(_0x4c2cc0&&_0x4c2cc0[a18_0x34fb('0x59')][a18_0x34fb('0x5a')]){const _0x23cd5a=spawn(a18_0x34fb('0x5b'),['-r',a18_0x34fb('0x1d')]);}else{}});}}[a18_0x34fb('0x4d')](_0x1ae9db){if(_0x1ae9db=='all'||_0x1ae9db==String(this['syncPlaylistsService'][a18_0x34fb('0x53')])){this['syncPlaylistsService'][a18_0x34fb('0x5c')]();}}['handleReloadPlaylistRequest'](_0x1c181f){if(String(_0x1c181f)=='all'||String(_0x1c181f)==String(this[a18_0x34fb('0x8')][a18_0x34fb('0x53')])){this[a18_0x34fb('0x8')]['reloadMediaList']();}}['handleRebootRequest'](_0x36466b){if(_0x36466b==a18_0x34fb('0x52')||_0x36466b==String(this['syncPlaylistsService'][a18_0x34fb('0x53')])){console[a18_0x34fb('0xf')](a18_0x34fb('0x4b'));try{const _0x57f69d=spawn(a18_0x34fb('0x5b'),['-r','now']);}catch(_0x5902cb){console['log'](_0x5902cb);}}}[a18_0x34fb('0x5d')](){console[a18_0x34fb('0xf')](a18_0x34fb('0x5e'),this['state']);this[a18_0x34fb('0x3b')][a18_0x34fb('0x26')](a18_0x34fb('0x5f'),this[a18_0x34fb('0x8')]['playerId']+'-'+this[a18_0x34fb('0x9')]);}[a18_0x34fb('0x49')](_0x12fc1c){if(this['state']!==a18_0x34fb('0x60')&&this[a18_0x34fb('0x9')]!==a18_0x34fb('0x61')){console[a18_0x34fb('0xf')](a18_0x34fb('0x62'));this[a18_0x34fb('0x9')]=a18_0x34fb('0x61');this[a18_0x34fb('0x5d')]();setTimeout(()=>{this['state']=a18_0x34fb('0x60');this['sendStateUpdate']();},0x1388);}}[a18_0x34fb('0x4a')](_0x54fef8){if(this[a18_0x34fb('0x9')]!==a18_0x34fb('0xa')&&this[a18_0x34fb('0x9')]!=='closing'){this[a18_0x34fb('0x9')]=a18_0x34fb('0x63');this[a18_0x34fb('0x5d')]();setTimeout(()=>{this[a18_0x34fb('0x9')]=a18_0x34fb('0xa');this[a18_0x34fb('0x5d')]();},0x1388);}}[a18_0x34fb('0x3d')](_0x7981ab,_0x40fe26){if(_0x40fe26){console[a18_0x34fb('0xf')](_0x40fe26[a18_0x34fb('0x64')]);}this[a18_0x34fb('0x3b')]['publish'](a18_0x34fb('0x65'),a18_0x34fb('0x66'));}[a18_0x34fb('0x1a')](_0x9274f2,_0x810eee,_0x359f8a){const _0x5821c2={'iat':Math[a18_0x34fb('0x1c')](Date[a18_0x34fb('0x1d')]()/0x3e8),'exp':Math[a18_0x34fb('0x1c')](Date[a18_0x34fb('0x1d')]()/0x3e8)+0x14*0x3c,'aud':_0x9274f2};const _0xed9de2=fs[a18_0x34fb('0x67')](_0x810eee);return jwt[a18_0x34fb('0x68')](_0x5821c2,_0xed9de2,{'algorithm':_0x359f8a});}}exports['MqttService']=MqttService;