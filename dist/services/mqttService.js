var a20_0x1aff=['handleCloseRequest','closed','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','spawn','child_process','exec','is-image','mqtt','syncPlaylistsService','state','httpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','createJwt','mqtts','round','now','connect','subscribe','/config','/devices/','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','base64','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','close','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/update','player/register','player/turn_off_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','player/load_playlist','handleLoadPlaylistRequest','handleIfconfigRequest','player/update_settings','handleUpdateSettingsRequest','player/turn_on_tv','handleTurnOnTVRequest','playerId','registerClient','all','handleUpdateRequest','Git\x20updating','Error\x20git\x20updated','Git\x20updated','loadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','turnOffTV','sending\x20state\x20%s','open','opening\x20player\x20door','sendStateUpdate'];(function(_0x25c51a,_0xabb643){var _0x465aac=function(_0x483d88){while(--_0x483d88){_0x25c51a['push'](_0x25c51a['shift']());}};_0x465aac(++_0xabb643);}(a20_0x1aff,0x153));var a20_0x35ac=function(_0x549e5f,_0x568047){_0x549e5f=_0x549e5f-0x0;var _0x10fa9e=a20_0x1aff[_0x549e5f];return _0x10fa9e;};'use strict';Object[a20_0x35ac('0x0')](exports,a20_0x35ac('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x35ac('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0x35ac('0x3'));const progress=require(a20_0x35ac('0x4'));const spawn=require('child_process')[a20_0x35ac('0x5')];const exec=require(a20_0x35ac('0x6'))[a20_0x35ac('0x7')];const isImage=require(a20_0x35ac('0x8'));const format=require('string-template');const os=require('os');const mqtt=require(a20_0x35ac('0x9'));const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x293f0b){this[a20_0x35ac('0xa')]=_0x293f0b;this[a20_0x35ac('0xb')]='closed';this[a20_0x35ac('0xc')]=new HttpClientService_1['HttpClientService']();}[a20_0x35ac('0xd')](){this[a20_0x35ac('0xe')]();}[a20_0x35ac('0xf')](){console[a20_0x35ac('0x10')](a20_0x35ac('0x11'));const _0x595070='velvety-glazing-252020';const _0x495b6a=a20_0x35ac('0x12');const _0x233dea='my-registry';const _0x2dcb6b=a20_0x35ac('0x13');const _0x1c8667=a20_0x35ac('0x14');const _0x4210d7=a20_0x35ac('0x15');const _0x2b0b8c=a20_0x35ac('0x16');const _0x4d0356=0x1bb;const _0x4c9f6e=a20_0x35ac('0x17');const _0x3fe2ef=0x5;const _0xa0c978=a20_0x35ac('0x18')+_0x595070+a20_0x35ac('0x19')+_0x2dcb6b+a20_0x35ac('0x1a')+_0x233dea+'/devices/'+_0x495b6a;const _0x477220={'host':_0x2b0b8c,'port':_0x4d0356,'clientId':_0xa0c978,'username':'unused','password':this[a20_0x35ac('0x1b')](_0x595070,_0x4210d7,_0x1c8667),'protocol':a20_0x35ac('0x1c'),'secureProtocol':'TLSv1_2_method'};const _0x448b46=Math[a20_0x35ac('0x1d')](Date[a20_0x35ac('0x1e')]()/0x3e8);const _0x3e5464=mqtt[a20_0x35ac('0x1f')](_0x477220);_0x3e5464[a20_0x35ac('0x20')]('/devices/'+_0x495b6a+a20_0x35ac('0x21'),{'qos':0x1});_0x3e5464[a20_0x35ac('0x20')](a20_0x35ac('0x22')+_0x495b6a+a20_0x35ac('0x23'),{'qos':0x1});_0x3e5464['subscribe'](a20_0x35ac('0x22')+_0x495b6a+a20_0x35ac('0x24'),{'qos':0x0});const _0x4503d2='/devices/'+_0x495b6a+'/'+_0x4c9f6e;_0x3e5464['on'](a20_0x35ac('0x1f'),_0x3a3cdd=>{console[a20_0x35ac('0x10')](a20_0x35ac('0x1f'));if(!_0x3a3cdd){console['log'](a20_0x35ac('0x25'));}else{const _0x4503d2=a20_0x35ac('0x26');const _0x31cb9c=_0x233dea+'/'+_0x495b6a+'-payload-0';_0x3e5464[a20_0x35ac('0x27')](_0x4503d2,_0x31cb9c,{'qos':0x1},_0x193fb0=>{console[a20_0x35ac('0x10')](a20_0x35ac('0x28'));console[a20_0x35ac('0x10')](_0x193fb0);if(!_0x193fb0){}});}});_0x3e5464['on']('close',()=>{console[a20_0x35ac('0x10')]('close');});_0x3e5464['on']('error',_0xe5a3c=>{console[a20_0x35ac('0x10')](a20_0x35ac('0x29'),_0xe5a3c);});_0x3e5464['on'](a20_0x35ac('0x2a'),(_0x5d37a8,_0x3ad468)=>{let _0x1e38d6=a20_0x35ac('0x2b');console[a20_0x35ac('0x10')](_0x5d37a8);console[a20_0x35ac('0x10')](_0x3ad468+'');if(_0x5d37a8===a20_0x35ac('0x22')+_0x495b6a+'/config'){_0x1e38d6=a20_0x35ac('0x2c');}else if(_0x5d37a8[a20_0x35ac('0x2d')]('/devices/'+_0x495b6a+a20_0x35ac('0x2e'))){_0x1e38d6='Command\x20message\x20received:\x20';}_0x1e38d6+=Buffer['from'](_0x3ad468,a20_0x35ac('0x2f'))['toString'](a20_0x35ac('0x30'));console[a20_0x35ac('0x10')](_0x1e38d6);});_0x3e5464['on'](a20_0x35ac('0x31'),()=>{});console['log'](_0x477220);}[a20_0x35ac('0xe')](){console['log'](a20_0x35ac('0x11'));this[a20_0x35ac('0x32')]=uuidv4();console[a20_0x35ac('0x10')](a20_0x35ac('0x33'));console['log'](this['clientId']);const _0x34486={'clientId':this[a20_0x35ac('0x32')],'username':a20_0x35ac('0x34'),'password':a20_0x35ac('0x35'),'clean':!![]};this[a20_0x35ac('0x36')]=mqtt[a20_0x35ac('0x1f')](a20_0x35ac('0x37'),_0x34486);this[a20_0x35ac('0x36')]['on'](a20_0x35ac('0x1f'),this[a20_0x35ac('0x38')][a20_0x35ac('0x39')](this));this[a20_0x35ac('0x36')]['on'](a20_0x35ac('0x2a'),this[a20_0x35ac('0x3a')][a20_0x35ac('0x39')](this));this['mqttClient']['on']('close',()=>{console[a20_0x35ac('0x10')](a20_0x35ac('0x3b'));});process['on'](a20_0x35ac('0x3c'),this[a20_0x35ac('0x3d')][a20_0x35ac('0x39')](this));process['on'](a20_0x35ac('0x3e'),this[a20_0x35ac('0x3d')][a20_0x35ac('0x39')](this));process['on'](a20_0x35ac('0x3f'),this[a20_0x35ac('0x3d')]['bind'](this));}[a20_0x35ac('0x38')](){console[a20_0x35ac('0x10')](a20_0x35ac('0x40')+this[a20_0x35ac('0x32')]);this[a20_0x35ac('0x36')][a20_0x35ac('0x20')](a20_0x35ac('0x41'));this['mqttClient'][a20_0x35ac('0x20')]('player/close');this['mqttClient'][a20_0x35ac('0x20')](a20_0x35ac('0x42'),{'qos':0x2});this['mqttClient'][a20_0x35ac('0x20')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a20_0x35ac('0x20')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a20_0x35ac('0x20')](a20_0x35ac('0x43'),{'qos':0x2});this[a20_0x35ac('0x36')][a20_0x35ac('0x20')]('player/ifconfig',{'qos':0x2});this[a20_0x35ac('0x36')][a20_0x35ac('0x20')](a20_0x35ac('0x44'),{'qos':0x2});this[a20_0x35ac('0x36')]['subscribe']('player/update_settings',{'qos':0x2});this[a20_0x35ac('0x36')][a20_0x35ac('0x20')](a20_0x35ac('0x45'),{'qos':0x2});this[a20_0x35ac('0x36')][a20_0x35ac('0x20')]('player/turn_on_tv',{'qos':0x2});}[a20_0x35ac('0x46')](){}[a20_0x35ac('0x3a')](_0x5f5479,_0x3bcb51){console['log'](a20_0x35ac('0x47'),_0x5f5479,_0x3bcb51);switch(_0x5f5479){case a20_0x35ac('0x41'):return this[a20_0x35ac('0x48')](_0x3bcb51);case a20_0x35ac('0x49'):return this['handleCloseRequest'](_0x3bcb51);case a20_0x35ac('0x42'):return this[a20_0x35ac('0x4a')](_0x3bcb51);case a20_0x35ac('0x4b'):return this[a20_0x35ac('0x4c')](_0x3bcb51);case a20_0x35ac('0x4d'):return this[a20_0x35ac('0x4e')](_0x3bcb51);case a20_0x35ac('0x43'):return this['handleUpdateRequest'](_0x3bcb51);case'player/ifconfig':return this[a20_0x35ac('0x4f')](_0x3bcb51);case a20_0x35ac('0x44'):return this['handleRegisterRequest'](_0x3bcb51);case a20_0x35ac('0x50'):return this[a20_0x35ac('0x51')](_0x3bcb51);case a20_0x35ac('0x45'):return this['handleTurnOffTVRequest'](_0x3bcb51);case a20_0x35ac('0x52'):return this[a20_0x35ac('0x53')](_0x3bcb51);}}['handleRegisterRequest'](_0x3847eb){if(_0x3847eb=='all'||_0x3847eb==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){this[a20_0x35ac('0xa')][a20_0x35ac('0x55')]();}}['handleIfconfigRequest'](_0x851fa1){if(_0x851fa1==a20_0x35ac('0x56')||_0x851fa1==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){}}[a20_0x35ac('0x57')](_0x5b7378){console[a20_0x35ac('0x10')]('handleUpdateRequest:\x20'+_0x5b7378);if(_0x5b7378==a20_0x35ac('0x56')||_0x5b7378==String(this[a20_0x35ac('0xa')]['playerId'])){const _0x550501=__dirname;const _0x563afe=require('simple-git')(_0x550501);console[a20_0x35ac('0x10')](a20_0x35ac('0x58'));_0x563afe['pull']((_0x3f2b70,_0x23e9ba)=>{if(_0x3f2b70){console[a20_0x35ac('0x10')](a20_0x35ac('0x59'));this[a20_0x35ac('0x57')](_0x5b7378);return;}else{}console['log'](a20_0x35ac('0x5a'));console[a20_0x35ac('0x10')](_0x23e9ba);if(_0x23e9ba&&_0x23e9ba['summary']['changes']){this[a20_0x35ac('0xa')]['reboot']();}else{}});}}[a20_0x35ac('0x4e')](_0x5b406c){if(_0x5b406c==a20_0x35ac('0x56')||_0x5b406c==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){this['syncPlaylistsService'][a20_0x35ac('0x5b')]();}}[a20_0x35ac('0x4c')](_0x5d713d){if(String(_0x5d713d)=='all'||String(_0x5d713d)==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){this[a20_0x35ac('0xa')]['reloadMediaList']();}}[a20_0x35ac('0x4a')](_0x3135db){if(_0x3135db==a20_0x35ac('0x56')||_0x3135db==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){console[a20_0x35ac('0x10')](a20_0x35ac('0x5c'));try{this[a20_0x35ac('0xa')]['reboot']();}catch(_0x57d941){console[a20_0x35ac('0x10')](_0x57d941);}}}['handleUpdateSettingsRequest'](_0x8e6a3d){if(_0x8e6a3d==a20_0x35ac('0x56')||_0x8e6a3d==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){console[a20_0x35ac('0x10')]('handleUpdateSettingsRequest:\x20');try{this[a20_0x35ac('0xa')][a20_0x35ac('0x5d')]();}catch(_0x506312){console[a20_0x35ac('0x10')](_0x506312);}}}[a20_0x35ac('0x53')](_0x53bc20){if(_0x53bc20==a20_0x35ac('0x56')||_0x53bc20==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){console['log'](a20_0x35ac('0x5e'));try{this[a20_0x35ac('0xa')][a20_0x35ac('0x5f')]();}catch(_0x2f8afc){console['log'](_0x2f8afc);}}}['handleTurnOffTVRequest'](_0x2bd5c1){if(_0x2bd5c1==a20_0x35ac('0x56')||_0x2bd5c1==String(this[a20_0x35ac('0xa')][a20_0x35ac('0x54')])){console[a20_0x35ac('0x10')]('handleTurnOffTVRequest:\x20');try{this[a20_0x35ac('0xa')][a20_0x35ac('0x60')]();}catch(_0x2ec83c){console[a20_0x35ac('0x10')](_0x2ec83c);}}}['sendStateUpdate'](){console[a20_0x35ac('0x10')](a20_0x35ac('0x61'),this[a20_0x35ac('0xb')]);this['mqttClient']['publish']('player/state',this['syncPlaylistsService'][a20_0x35ac('0x54')]+'-'+this[a20_0x35ac('0xb')]);}['handleOpenRequest'](_0x6025c6){if(this['state']!==a20_0x35ac('0x62')&&this[a20_0x35ac('0xb')]!=='opening'){console[a20_0x35ac('0x10')](a20_0x35ac('0x63'));this[a20_0x35ac('0xb')]='opening';this[a20_0x35ac('0x64')]();setTimeout(()=>{this['state']=a20_0x35ac('0x62');this[a20_0x35ac('0x64')]();},0x1388);}}[a20_0x35ac('0x65')](_0x508cea){if(this[a20_0x35ac('0xb')]!==a20_0x35ac('0x66')&&this[a20_0x35ac('0xb')]!=='closing'){this['state']=a20_0x35ac('0x67');this['sendStateUpdate']();setTimeout(()=>{this['state']='closed';this[a20_0x35ac('0x64')]();},0x1388);}}[a20_0x35ac('0x3d')](_0xafcf28,_0x52744c){if(_0x52744c){console[a20_0x35ac('0x10')](_0x52744c[a20_0x35ac('0x68')]);}this['mqttClient'][a20_0x35ac('0x27')](a20_0x35ac('0x69'),a20_0x35ac('0x6a'));}[a20_0x35ac('0x1b')](_0x1b5274,_0x4cbd2e,_0x447ab2){const _0x536f9={'iat':Math[a20_0x35ac('0x1d')](Date[a20_0x35ac('0x1e')]()/0x3e8),'exp':Math[a20_0x35ac('0x1d')](Date[a20_0x35ac('0x1e')]()/0x3e8)+0x14*0x3c,'aud':_0x1b5274};const _0x23ccdc=fs[a20_0x35ac('0x6b')](_0x4cbd2e);return jwt[a20_0x35ac('0x6c')](_0x536f9,_0x23ccdc,{'algorithm':_0x447ab2});}}exports[a20_0x35ac('0x6d')]=MqttService;