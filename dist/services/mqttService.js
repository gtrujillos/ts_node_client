var a18_0x5d9d=['uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','handleRegisterRequest','all','playerId','handleIfconfigRequest','handleUpdateRequest','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','now','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','shutdown','sendStateUpdate','sending\x20state\x20%s','player/state','opening\x20player\x20door','opening','closing','publish','defineProperty','__esModule','./../infrastructure/HttpClientService','request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','mqttInit','clientId','log','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','connect','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit'];(function(_0x32304b,_0x18f062){var _0x125372=function(_0x300fe2){while(--_0x300fe2){_0x32304b['push'](_0x32304b['shift']());}};_0x125372(++_0x18f062);}(a18_0x5d9d,0x1f4));var a18_0x3b9c=function(_0xa0cd03,_0x139a05){_0xa0cd03=_0xa0cd03-0x0;var _0x3bc8c5=a18_0x5d9d[_0xa0cd03];return _0x3bc8c5;};'use strict';Object[a18_0x3b9c('0x0')](exports,a18_0x3b9c('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x3b9c('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require(a18_0x3b9c('0x3'));const spawn=require(a18_0x3b9c('0x4'))[a18_0x3b9c('0x5')];const isImage=require(a18_0x3b9c('0x6'));const format=require(a18_0x3b9c('0x7'));const os=require('os');const mqtt=require(a18_0x3b9c('0x8'));const uuidv4=require(a18_0x3b9c('0x9'));class MqttService{constructor(_0xc7da10){this[a18_0x3b9c('0xa')]=_0xc7da10;this[a18_0x3b9c('0xb')]=a18_0x3b9c('0xc');this[a18_0x3b9c('0xd')]=new HttpClientService_1['HttpClientService']();}[a18_0x3b9c('0xe')](){this[a18_0x3b9c('0xf')]();}[a18_0x3b9c('0xf')](){console['log'](a18_0x3b9c('0xf'));this[a18_0x3b9c('0x10')]=uuidv4();console[a18_0x3b9c('0x11')](a18_0x3b9c('0x12'));console[a18_0x3b9c('0x11')](this['clientId']);const _0x5df1ea={'clientId':this[a18_0x3b9c('0x10')],'username':a18_0x3b9c('0x13'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x3b9c('0x14')]=mqtt['connect'](a18_0x3b9c('0x15'),_0x5df1ea);this[a18_0x3b9c('0x14')]['on'](a18_0x3b9c('0x16'),this[a18_0x3b9c('0x17')][a18_0x3b9c('0x18')](this));this[a18_0x3b9c('0x14')]['on']('message',this[a18_0x3b9c('0x19')]['bind'](this));process['on'](a18_0x3b9c('0x1a'),this[a18_0x3b9c('0x1b')]['bind'](this));process['on']('SIGINT',this[a18_0x3b9c('0x1b')][a18_0x3b9c('0x18')](this));process['on'](a18_0x3b9c('0x1c'),this[a18_0x3b9c('0x1b')][a18_0x3b9c('0x18')](this));}['mqttClient_connect'](){console['log'](a18_0x3b9c('0x1d')+this['clientId']);this['mqttClient'][a18_0x3b9c('0x1e')](a18_0x3b9c('0x1f'));this[a18_0x3b9c('0x14')][a18_0x3b9c('0x1e')](a18_0x3b9c('0x20'));this[a18_0x3b9c('0x14')][a18_0x3b9c('0x1e')](a18_0x3b9c('0x21'),{'qos':0x2});this[a18_0x3b9c('0x14')]['subscribe'](a18_0x3b9c('0x22'),{'qos':0x2});this[a18_0x3b9c('0x14')][a18_0x3b9c('0x1e')](a18_0x3b9c('0x23'),{'qos':0x2});this[a18_0x3b9c('0x14')][a18_0x3b9c('0x1e')](a18_0x3b9c('0x24'),{'qos':0x2});this['mqttClient'][a18_0x3b9c('0x1e')](a18_0x3b9c('0x25'),{'qos':0x2});this['mqttClient'][a18_0x3b9c('0x1e')](a18_0x3b9c('0x26'),{'qos':0x2});}[a18_0x3b9c('0x27')](){}[a18_0x3b9c('0x19')](_0x4dfca3,_0x1fae00){console[a18_0x3b9c('0x11')](a18_0x3b9c('0x28'),_0x4dfca3,_0x1fae00);switch(_0x4dfca3){case a18_0x3b9c('0x1f'):return this[a18_0x3b9c('0x29')](_0x1fae00);case a18_0x3b9c('0x20'):return this[a18_0x3b9c('0x2a')](_0x1fae00);case'player/reboot':return this[a18_0x3b9c('0x2b')](_0x1fae00);case'player/reload_playlist':return this['handleReloadPlaylistRequest'](_0x1fae00);case a18_0x3b9c('0x22'):return this[a18_0x3b9c('0x2c')](_0x1fae00);case'player/update':return this['handleUpdateRequest'](_0x1fae00);case a18_0x3b9c('0x25'):return this['handleIfconfigRequest'](_0x1fae00);case'player/register':return this[a18_0x3b9c('0x2d')](_0x1fae00);}}[a18_0x3b9c('0x2d')](_0x56ee69){if(_0x56ee69==a18_0x3b9c('0x2e')||_0x56ee69==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){this[a18_0x3b9c('0xa')]['registerClient']();}}[a18_0x3b9c('0x30')](_0x284458){if(_0x284458==a18_0x3b9c('0x2e')||_0x284458==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){}}[a18_0x3b9c('0x31')](_0xcbd9f7){if(_0xcbd9f7==a18_0x3b9c('0x2e')||_0xcbd9f7==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){const _0x867a5a=__dirname;const _0x1d6cfb=require('simple-git')(_0x867a5a);console[a18_0x3b9c('0x11')](a18_0x3b9c('0x32'));_0x1d6cfb['pull']((_0x4dc606,_0x49ca8a)=>{if(_0x4dc606){console[a18_0x3b9c('0x11')](a18_0x3b9c('0x33'));this[a18_0x3b9c('0x31')](_0xcbd9f7);return;}else{}console[a18_0x3b9c('0x11')](a18_0x3b9c('0x34'));console[a18_0x3b9c('0x11')](_0x49ca8a);if(_0x49ca8a&&_0x49ca8a[a18_0x3b9c('0x35')]['changes']){const _0xa320ed=spawn('shutdown',['-r',a18_0x3b9c('0x36')]);}else{}});}}['handleLoadPlaylistRequest'](_0x546f4e){if(_0x546f4e==a18_0x3b9c('0x2e')||_0x546f4e==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){this[a18_0x3b9c('0xa')][a18_0x3b9c('0x37')]();}}[a18_0x3b9c('0x38')](_0x52f31c){if(String(_0x52f31c)=='all'||String(_0x52f31c)==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){this[a18_0x3b9c('0xa')][a18_0x3b9c('0x39')]();}}['handleRebootRequest'](_0x21e62c){if(_0x21e62c==a18_0x3b9c('0x2e')||_0x21e62c==String(this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')])){const _0x43c041=spawn(a18_0x3b9c('0x3a'),['-r',a18_0x3b9c('0x36')]);}}[a18_0x3b9c('0x3b')](){console['log'](a18_0x3b9c('0x3c'),this['state']);this['mqttClient']['publish'](a18_0x3b9c('0x3d'),this[a18_0x3b9c('0xa')][a18_0x3b9c('0x2f')]+'-'+this['state']);}['handleOpenRequest'](_0x5cf871){if(this['state']!=='open'&&this[a18_0x3b9c('0xb')]!=='opening'){console[a18_0x3b9c('0x11')](a18_0x3b9c('0x3e'));this[a18_0x3b9c('0xb')]=a18_0x3b9c('0x3f');this[a18_0x3b9c('0x3b')]();setTimeout(()=>{this[a18_0x3b9c('0xb')]='open';this[a18_0x3b9c('0x3b')]();},0x1388);}}[a18_0x3b9c('0x2a')](_0x25598b){if(this['state']!==a18_0x3b9c('0xc')&&this['state']!=='closing'){this[a18_0x3b9c('0xb')]=a18_0x3b9c('0x40');this[a18_0x3b9c('0x3b')]();setTimeout(()=>{this[a18_0x3b9c('0xb')]='closed';this[a18_0x3b9c('0x3b')]();},0x1388);}}[a18_0x3b9c('0x1b')](_0x50a958,_0x29b16d){if(_0x29b16d){console[a18_0x3b9c('0x11')](_0x29b16d['stack']);}this['mqttClient'][a18_0x3b9c('0x41')]('player/connected','false');}}exports['MqttService']=MqttService;