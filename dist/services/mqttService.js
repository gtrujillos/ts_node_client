var a18_0x2a1c=['velvety-glazing-252020','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','TLSv1_2_method','round','now','connect','/devices/','/config','subscribe','/state','/commands/#','Client\x20not\x20connected...','-payload-0','publish','publish\x20result:','close','error','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','message','mqttClient_message','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','reportStatus','player/open','handleOpenRequest','handleCloseRequest','player/reboot','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','syncPlaylistsService','registerClient','playerId','handleUpdateRequest:\x20','all','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','changes','reloadMediaList','handleRebootRequest','shutdown','sendStateUpdate','sending\x20state\x20%s','state','player/state','open','opening','opening\x20player\x20door','closed','closing','player/connected','false','createJwt','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit'];(function(_0xe556f4,_0x1cf0ac){var _0x342baf=function(_0x2ccc4f){while(--_0x2ccc4f){_0xe556f4['push'](_0xe556f4['shift']());}};_0x342baf(++_0x1cf0ac);}(a18_0x2a1c,0x187));var a18_0x4475=function(_0x3fd882,_0x40dbfd){_0x3fd882=_0x3fd882-0x0;var _0x3710f9=a18_0x2a1c[_0x3fd882];return _0x3710f9;};'use strict';Object[a18_0x4475('0x0')](exports,a18_0x4475('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x4475('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x4475('0x3'));const progress=require(a18_0x4475('0x4'));const spawn=require(a18_0x4475('0x5'))['spawn'];const isImage=require(a18_0x4475('0x6'));const format=require(a18_0x4475('0x7'));const os=require('os');const mqtt=require(a18_0x4475('0x8'));const uuidv4=require(a18_0x4475('0x9'));const jwt=require(a18_0x4475('0xa'));class MqttService{constructor(_0x1df990){this['syncPlaylistsService']=_0x1df990;this['state']='closed';this[a18_0x4475('0xb')]=new HttpClientService_1[(a18_0x4475('0xc'))]();}['init'](){this[a18_0x4475('0xd')]();}[a18_0x4475('0xe')](){console[a18_0x4475('0xf')](a18_0x4475('0x10'));const _0x3c97c8=a18_0x4475('0x11');const _0x36b623='my-node-device';const _0x2121fd=a18_0x4475('0x12');const _0x57e069=a18_0x4475('0x13');const _0x290d28='RS256';const _0x5849ad=a18_0x4475('0x14');const _0x20c76a=a18_0x4475('0x15');const _0x5d8e5a=0x1bb;const _0x31646d=a18_0x4475('0x16');const _0x508342=0x5;const _0x70c2de=a18_0x4475('0x17')+_0x3c97c8+a18_0x4475('0x18')+_0x57e069+'/registries/'+_0x2121fd+'/devices/'+_0x36b623;const _0x2a35be={'host':_0x20c76a,'port':_0x5d8e5a,'clientId':_0x70c2de,'username':'unused','password':this['createJwt'](_0x3c97c8,_0x5849ad,_0x290d28),'protocol':'mqtts','secureProtocol':a18_0x4475('0x19')};const _0x3930e4=Math[a18_0x4475('0x1a')](Date[a18_0x4475('0x1b')]()/0x3e8);const _0x458480=mqtt[a18_0x4475('0x1c')](_0x2a35be);_0x458480['subscribe'](a18_0x4475('0x1d')+_0x36b623+a18_0x4475('0x1e'),{'qos':0x1});_0x458480[a18_0x4475('0x1f')](a18_0x4475('0x1d')+_0x36b623+a18_0x4475('0x20'),{'qos':0x1});_0x458480[a18_0x4475('0x1f')](a18_0x4475('0x1d')+_0x36b623+a18_0x4475('0x21'),{'qos':0x0});const _0x24783b='/devices/'+_0x36b623+'/'+_0x31646d;_0x458480['on'](a18_0x4475('0x1c'),_0x104a99=>{console[a18_0x4475('0xf')](a18_0x4475('0x1c'));if(!_0x104a99){console[a18_0x4475('0xf')](a18_0x4475('0x22'));}else{const _0x24783b='/projects/velvety-glazing-252020/topics/my-topic';const _0xd643cc=_0x2121fd+'/'+_0x36b623+a18_0x4475('0x23');_0x458480[a18_0x4475('0x24')](_0x24783b,_0xd643cc,{'qos':0x1},_0x4cfe10=>{console[a18_0x4475('0xf')](a18_0x4475('0x25'));console['log'](_0x4cfe10);if(!_0x4cfe10){}});}});_0x458480['on'](a18_0x4475('0x26'),()=>{console[a18_0x4475('0xf')](a18_0x4475('0x26'));});_0x458480['on'](a18_0x4475('0x27'),_0x234372=>{console['log'](a18_0x4475('0x27'),_0x234372);});_0x458480['on']('message',(_0x5ba836,_0x59d89a)=>{let _0x19ae88='Message\x20received:\x20';console[a18_0x4475('0xf')](_0x5ba836);console[a18_0x4475('0xf')](_0x59d89a+'');if(_0x5ba836===a18_0x4475('0x1d')+_0x36b623+a18_0x4475('0x1e')){_0x19ae88=a18_0x4475('0x28');}else if(_0x5ba836[a18_0x4475('0x29')](a18_0x4475('0x1d')+_0x36b623+a18_0x4475('0x2a'))){_0x19ae88=a18_0x4475('0x2b');}_0x19ae88+=Buffer[a18_0x4475('0x2c')](_0x59d89a,a18_0x4475('0x2d'))['toString'](a18_0x4475('0x2e'));console[a18_0x4475('0xf')](_0x19ae88);});_0x458480['on'](a18_0x4475('0x2f'),()=>{});console[a18_0x4475('0xf')](_0x2a35be);}['mqttInit_mosquitto'](){console[a18_0x4475('0xf')](a18_0x4475('0x10'));this[a18_0x4475('0x30')]=uuidv4();console[a18_0x4475('0xf')](a18_0x4475('0x31'));console[a18_0x4475('0xf')](this['clientId']);const _0x23e698={'clientId':this['clientId'],'username':a18_0x4475('0x32'),'password':a18_0x4475('0x33'),'clean':!![]};this[a18_0x4475('0x34')]=mqtt[a18_0x4475('0x1c')]('mqtt://lulo.run',_0x23e698);this[a18_0x4475('0x34')]['on'](a18_0x4475('0x1c'),this[a18_0x4475('0x35')][a18_0x4475('0x36')](this));this[a18_0x4475('0x34')]['on'](a18_0x4475('0x37'),this[a18_0x4475('0x38')][a18_0x4475('0x36')](this));this[a18_0x4475('0x34')]['on'](a18_0x4475('0x26'),()=>{console[a18_0x4475('0xf')]('close');});process['on']('exit',this[a18_0x4475('0x39')][a18_0x4475('0x36')](this));process['on']('SIGINT',this[a18_0x4475('0x39')][a18_0x4475('0x36')](this));process['on'](a18_0x4475('0x3a'),this[a18_0x4475('0x39')][a18_0x4475('0x36')](this));}[a18_0x4475('0x35')](){console[a18_0x4475('0xf')](a18_0x4475('0x3b')+this[a18_0x4475('0x30')]);this['mqttClient']['subscribe']('player/open');this[a18_0x4475('0x34')][a18_0x4475('0x1f')](a18_0x4475('0x3c'));this['mqttClient'][a18_0x4475('0x1f')]('player/reboot',{'qos':0x2});this[a18_0x4475('0x34')]['subscribe'](a18_0x4475('0x3d'),{'qos':0x2});this[a18_0x4475('0x34')][a18_0x4475('0x1f')]('player/reload_playlist',{'qos':0x2});this[a18_0x4475('0x34')][a18_0x4475('0x1f')]('player/update',{'qos':0x2});this[a18_0x4475('0x34')][a18_0x4475('0x1f')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x4475('0x1f')]('player/register',{'qos':0x2});}[a18_0x4475('0x3e')](){}[a18_0x4475('0x38')](_0x5427bf,_0x542d76){console['log']('received\x20message\x20%s\x20%s',_0x5427bf,_0x542d76);switch(_0x5427bf){case a18_0x4475('0x3f'):return this[a18_0x4475('0x40')](_0x542d76);case a18_0x4475('0x3c'):return this[a18_0x4475('0x41')](_0x542d76);case a18_0x4475('0x42'):return this['handleRebootRequest'](_0x542d76);case a18_0x4475('0x43'):return this[a18_0x4475('0x44')](_0x542d76);case a18_0x4475('0x3d'):return this[a18_0x4475('0x45')](_0x542d76);case a18_0x4475('0x46'):return this[a18_0x4475('0x47')](_0x542d76);case'player/ifconfig':return this[a18_0x4475('0x48')](_0x542d76);case'player/register':return this['handleRegisterRequest'](_0x542d76);}}[a18_0x4475('0x49')](_0x1f63d8){if(_0x1f63d8=='all'||_0x1f63d8==String(this[a18_0x4475('0x4a')]['playerId'])){this['syncPlaylistsService'][a18_0x4475('0x4b')]();}}[a18_0x4475('0x48')](_0x1630ac){if(_0x1630ac=='all'||_0x1630ac==String(this[a18_0x4475('0x4a')][a18_0x4475('0x4c')])){}}['handleUpdateRequest'](_0x2ffb3c){console['log'](a18_0x4475('0x4d')+_0x2ffb3c);if(_0x2ffb3c==a18_0x4475('0x4e')||_0x2ffb3c==String(this['syncPlaylistsService'][a18_0x4475('0x4c')])){const _0x1dae70=__dirname;const _0x5d834d=require(a18_0x4475('0x4f'))(_0x1dae70);console[a18_0x4475('0xf')](a18_0x4475('0x50'));_0x5d834d['pull']((_0x334f52,_0x582901)=>{if(_0x334f52){console[a18_0x4475('0xf')](a18_0x4475('0x51'));this[a18_0x4475('0x47')](_0x2ffb3c);return;}else{}console['log'](a18_0x4475('0x52'));console[a18_0x4475('0xf')](_0x582901);if(_0x582901&&_0x582901['summary'][a18_0x4475('0x53')]){const _0x931907=spawn('shutdown',['-r',a18_0x4475('0x1b')]);}else{}});}}[a18_0x4475('0x45')](_0x52f9a7){if(_0x52f9a7==a18_0x4475('0x4e')||_0x52f9a7==String(this[a18_0x4475('0x4a')][a18_0x4475('0x4c')])){this[a18_0x4475('0x4a')]['loadMediaList']();}}[a18_0x4475('0x44')](_0x58a7ea){if(String(_0x58a7ea)==a18_0x4475('0x4e')||String(_0x58a7ea)==String(this[a18_0x4475('0x4a')][a18_0x4475('0x4c')])){this['syncPlaylistsService'][a18_0x4475('0x54')]();}}[a18_0x4475('0x55')](_0x574fe9){if(_0x574fe9==a18_0x4475('0x4e')||_0x574fe9==String(this[a18_0x4475('0x4a')][a18_0x4475('0x4c')])){console[a18_0x4475('0xf')](a18_0x4475('0x55'));const _0x1c84d9=spawn(a18_0x4475('0x56'),['-r',a18_0x4475('0x1b')]);console[a18_0x4475('0xf')](_0x1c84d9);}}[a18_0x4475('0x57')](){console['log'](a18_0x4475('0x58'),this[a18_0x4475('0x59')]);this[a18_0x4475('0x34')]['publish'](a18_0x4475('0x5a'),this[a18_0x4475('0x4a')]['playerId']+'-'+this[a18_0x4475('0x59')]);}['handleOpenRequest'](_0x2b6a0e){if(this[a18_0x4475('0x59')]!==a18_0x4475('0x5b')&&this[a18_0x4475('0x59')]!==a18_0x4475('0x5c')){console['log'](a18_0x4475('0x5d'));this[a18_0x4475('0x59')]='opening';this[a18_0x4475('0x57')]();setTimeout(()=>{this[a18_0x4475('0x59')]=a18_0x4475('0x5b');this[a18_0x4475('0x57')]();},0x1388);}}['handleCloseRequest'](_0x4def35){if(this[a18_0x4475('0x59')]!==a18_0x4475('0x5e')&&this[a18_0x4475('0x59')]!==a18_0x4475('0x5f')){this['state']=a18_0x4475('0x5f');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x4475('0x59')]=a18_0x4475('0x5e');this[a18_0x4475('0x57')]();},0x1388);}}[a18_0x4475('0x39')](_0xec640,_0x53b2f7){if(_0x53b2f7){console[a18_0x4475('0xf')](_0x53b2f7['stack']);}this[a18_0x4475('0x34')][a18_0x4475('0x24')](a18_0x4475('0x60'),a18_0x4475('0x61'));}[a18_0x4475('0x62')](_0x138c9e,_0x5d14e0,_0x53e2be){const _0x450567={'iat':Math[a18_0x4475('0x1a')](Date[a18_0x4475('0x1b')]()/0x3e8),'exp':Math[a18_0x4475('0x1a')](Date[a18_0x4475('0x1b')]()/0x3e8)+0x14*0x3c,'aud':_0x138c9e};const _0x5ba2b0=fs[a18_0x4475('0x63')](_0x5d14e0);return jwt[a18_0x4475('0x64')](_0x450567,_0x5ba2b0,{'algorithm':_0x53e2be});}}exports[a18_0x4475('0x65')]=MqttService;