var a18_0x5108=['player/reload_playlist','player/register','player/turn_off_tv','player/turn_on_tv','handleOpenRequest','handleCloseRequest','player/reboot','handleLoadPlaylistRequest','player/update','handleIfconfigRequest','handleRegisterRequest','player/update_settings','handleUpdateSettingsRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest','simple-git','pull','summary','changes','reboot','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','state','player/state','opening','open','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit_google','log','mqttInit','velvety-glazing-252020','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','/locations/','/registries/','createJwt','round','now','/devices/','/config','subscribe','/state','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','clientId','this.clientId','lulo_mqtt','mqtt://lulo.run','mqttClient','mqttClient_connect','mqttClient_message','exit','handleAppExit','bind','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist'];(function(_0x238c47,_0x192ddf){var _0x36999b=function(_0x11f9d7){while(--_0x11f9d7){_0x238c47['push'](_0x238c47['shift']());}};_0x36999b(++_0x192ddf);}(a18_0x5108,0x9a));var a18_0x3bce=function(_0x3854e3,_0x20bb01){_0x3854e3=_0x3854e3-0x0;var _0x16f6b2=a18_0x5108[_0x3854e3];return _0x16f6b2;};'use strict';Object[a18_0x3bce('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x3bce('0x1'));const fs=require('fs');const fsExtra=require(a18_0x3bce('0x2'));const request=require(a18_0x3bce('0x3'));const progress=require('request-progress');const spawn=require(a18_0x3bce('0x4'))[a18_0x3bce('0x5')];const exec=require('child_process')[a18_0x3bce('0x6')];const isImage=require(a18_0x3bce('0x7'));const format=require(a18_0x3bce('0x8'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x3bce('0x9'));const jwt=require(a18_0x3bce('0xa'));class MqttService{constructor(_0x50153c){this[a18_0x3bce('0xb')]=_0x50153c;this['state']=a18_0x3bce('0xc');this[a18_0x3bce('0xd')]=new HttpClientService_1[(a18_0x3bce('0xe'))]();}[a18_0x3bce('0xf')](){this['mqttInit_mosquitto']();}[a18_0x3bce('0x10')](){console[a18_0x3bce('0x11')](a18_0x3bce('0x12'));const _0x560805=a18_0x3bce('0x13');const _0x79100='my-node-device';const _0x554258='my-registry';const _0x1646b4=a18_0x3bce('0x14');const _0x1d295e='RS256';const _0x49faea=a18_0x3bce('0x15');const _0x3d5f9e=a18_0x3bce('0x16');const _0x55916b=0x1bb;const _0x411b5b='events';const _0xa319e7=0x5;const _0x3340e5='projects/'+_0x560805+a18_0x3bce('0x17')+_0x1646b4+a18_0x3bce('0x18')+_0x554258+'/devices/'+_0x79100;const _0x43966b={'host':_0x3d5f9e,'port':_0x55916b,'clientId':_0x3340e5,'username':'unused','password':this[a18_0x3bce('0x19')](_0x560805,_0x49faea,_0x1d295e),'protocol':'mqtts','secureProtocol':'TLSv1_2_method'};const _0x1dc6f7=Math[a18_0x3bce('0x1a')](Date[a18_0x3bce('0x1b')]()/0x3e8);const _0x58b028=mqtt['connect'](_0x43966b);_0x58b028['subscribe'](a18_0x3bce('0x1c')+_0x79100+a18_0x3bce('0x1d'),{'qos':0x1});_0x58b028[a18_0x3bce('0x1e')](a18_0x3bce('0x1c')+_0x79100+a18_0x3bce('0x1f'),{'qos':0x1});_0x58b028[a18_0x3bce('0x1e')](a18_0x3bce('0x1c')+_0x79100+'/commands/#',{'qos':0x0});const _0x1ce7fc=a18_0x3bce('0x1c')+_0x79100+'/'+_0x411b5b;_0x58b028['on'](a18_0x3bce('0x20'),_0x1d090e=>{console[a18_0x3bce('0x11')](a18_0x3bce('0x20'));if(!_0x1d090e){console[a18_0x3bce('0x11')](a18_0x3bce('0x21'));}else{const _0x1ce7fc=a18_0x3bce('0x22');const _0x3981e7=_0x554258+'/'+_0x79100+'-payload-0';_0x58b028[a18_0x3bce('0x23')](_0x1ce7fc,_0x3981e7,{'qos':0x1},_0x468cd9=>{console[a18_0x3bce('0x11')](a18_0x3bce('0x24'));console[a18_0x3bce('0x11')](_0x468cd9);if(!_0x468cd9){}});}});_0x58b028['on'](a18_0x3bce('0x25'),()=>{console[a18_0x3bce('0x11')](a18_0x3bce('0x25'));});_0x58b028['on']('error',_0x1134ee=>{console[a18_0x3bce('0x11')](a18_0x3bce('0x26'),_0x1134ee);});_0x58b028['on'](a18_0x3bce('0x27'),(_0x38b6ae,_0x59f499)=>{let _0x244fd7=a18_0x3bce('0x28');console['log'](_0x38b6ae);console[a18_0x3bce('0x11')](_0x59f499+'');if(_0x38b6ae===a18_0x3bce('0x1c')+_0x79100+'/config'){_0x244fd7=a18_0x3bce('0x29');}else if(_0x38b6ae[a18_0x3bce('0x2a')](a18_0x3bce('0x1c')+_0x79100+a18_0x3bce('0x2b'))){_0x244fd7=a18_0x3bce('0x2c');}_0x244fd7+=Buffer[a18_0x3bce('0x2d')](_0x59f499,a18_0x3bce('0x2e'))[a18_0x3bce('0x2f')](a18_0x3bce('0x30'));console['log'](_0x244fd7);});_0x58b028['on']('packetsend',()=>{});console[a18_0x3bce('0x11')](_0x43966b);}['mqttInit_mosquitto'](){console['log'](a18_0x3bce('0x12'));this[a18_0x3bce('0x31')]=uuidv4();console[a18_0x3bce('0x11')](a18_0x3bce('0x32'));console[a18_0x3bce('0x11')](this['clientId']);const _0x341e71={'clientId':this['clientId'],'username':a18_0x3bce('0x33'),'password':'run.lulo_2018#.','clean':!![]};this['mqttClient']=mqtt[a18_0x3bce('0x20')](a18_0x3bce('0x34'),_0x341e71);this[a18_0x3bce('0x35')]['on']('connect',this[a18_0x3bce('0x36')]['bind'](this));this[a18_0x3bce('0x35')]['on'](a18_0x3bce('0x27'),this[a18_0x3bce('0x37')]['bind'](this));this['mqttClient']['on'](a18_0x3bce('0x25'),()=>{console['log'](a18_0x3bce('0x25'));});process['on'](a18_0x3bce('0x38'),this[a18_0x3bce('0x39')][a18_0x3bce('0x3a')](this));process['on'](a18_0x3bce('0x3b'),this[a18_0x3bce('0x39')][a18_0x3bce('0x3a')](this));process['on']('uncaughtException',this['handleAppExit']['bind'](this));}[a18_0x3bce('0x36')](){console[a18_0x3bce('0x11')](a18_0x3bce('0x3c')+this[a18_0x3bce('0x31')]);this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')](a18_0x3bce('0x3d'));this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')](a18_0x3bce('0x3e'));this['mqttClient'][a18_0x3bce('0x1e')]('player/reboot',{'qos':0x2});this[a18_0x3bce('0x35')]['subscribe'](a18_0x3bce('0x3f'),{'qos':0x2});this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')](a18_0x3bce('0x40'),{'qos':0x2});this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')]('player/update',{'qos':0x2});this['mqttClient'][a18_0x3bce('0x1e')]('player/ifconfig',{'qos':0x2});this[a18_0x3bce('0x35')]['subscribe'](a18_0x3bce('0x41'),{'qos':0x2});this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')]('player/update_settings',{'qos':0x2});this['mqttClient'][a18_0x3bce('0x1e')](a18_0x3bce('0x42'),{'qos':0x2});this[a18_0x3bce('0x35')][a18_0x3bce('0x1e')](a18_0x3bce('0x43'),{'qos':0x2});}['reportStatus'](){}[a18_0x3bce('0x37')](_0x2b9507,_0x394942){console['log']('received\x20message\x20%s\x20%s',_0x2b9507,_0x394942);switch(_0x2b9507){case a18_0x3bce('0x3d'):return this[a18_0x3bce('0x44')](_0x394942);case a18_0x3bce('0x3e'):return this[a18_0x3bce('0x45')](_0x394942);case a18_0x3bce('0x46'):return this['handleRebootRequest'](_0x394942);case a18_0x3bce('0x40'):return this['handleReloadPlaylistRequest'](_0x394942);case a18_0x3bce('0x3f'):return this[a18_0x3bce('0x47')](_0x394942);case a18_0x3bce('0x48'):return this['handleUpdateRequest'](_0x394942);case'player/ifconfig':return this[a18_0x3bce('0x49')](_0x394942);case'player/register':return this[a18_0x3bce('0x4a')](_0x394942);case a18_0x3bce('0x4b'):return this[a18_0x3bce('0x4c')](_0x394942);case'player/turn_off_tv':return this['handleTurnOffTVRequest'](_0x394942);case a18_0x3bce('0x43'):return this[a18_0x3bce('0x4d')](_0x394942);}}[a18_0x3bce('0x4a')](_0x38b022){if(_0x38b022==a18_0x3bce('0x4e')||_0x38b022==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){this[a18_0x3bce('0xb')][a18_0x3bce('0x50')]();}}[a18_0x3bce('0x49')](_0x3b7bc4){if(_0x3b7bc4=='all'||_0x3b7bc4==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){}}[a18_0x3bce('0x51')](_0x2041c8){console[a18_0x3bce('0x11')]('handleUpdateRequest:\x20'+_0x2041c8);if(_0x2041c8==a18_0x3bce('0x4e')||_0x2041c8==String(this['syncPlaylistsService'][a18_0x3bce('0x4f')])){const _0x1a679f=__dirname;const _0x1d7d4c=require(a18_0x3bce('0x52'))(_0x1a679f);console[a18_0x3bce('0x11')]('Git\x20updating');_0x1d7d4c[a18_0x3bce('0x53')]((_0x230958,_0x216ff7)=>{if(_0x230958){console[a18_0x3bce('0x11')]('Error\x20git\x20updated');this[a18_0x3bce('0x51')](_0x2041c8);return;}else{}console['log']('Git\x20updated');console['log'](_0x216ff7);if(_0x216ff7&&_0x216ff7[a18_0x3bce('0x54')][a18_0x3bce('0x55')]){this[a18_0x3bce('0xb')][a18_0x3bce('0x56')]();}else{}});}}[a18_0x3bce('0x47')](_0x57bde1){if(_0x57bde1=='all'||_0x57bde1==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){this[a18_0x3bce('0xb')][a18_0x3bce('0x57')]();}}[a18_0x3bce('0x58')](_0x1cccf2){if(String(_0x1cccf2)==a18_0x3bce('0x4e')||String(_0x1cccf2)==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){this[a18_0x3bce('0xb')][a18_0x3bce('0x59')]();}}[a18_0x3bce('0x5a')](_0x1d6e23){if(_0x1d6e23=='all'||_0x1d6e23==String(this['syncPlaylistsService'][a18_0x3bce('0x4f')])){console[a18_0x3bce('0x11')](a18_0x3bce('0x5b'));try{this[a18_0x3bce('0xb')][a18_0x3bce('0x56')]();}catch(_0x43409d){console[a18_0x3bce('0x11')](_0x43409d);}}}[a18_0x3bce('0x4c')](_0x12a015){if(_0x12a015==a18_0x3bce('0x4e')||_0x12a015==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){console[a18_0x3bce('0x11')](a18_0x3bce('0x5c'));try{this[a18_0x3bce('0xb')]['updateSettings']();}catch(_0x41cd27){console[a18_0x3bce('0x11')](_0x41cd27);}}}[a18_0x3bce('0x4d')](_0xae6912){if(_0xae6912=='all'||_0xae6912==String(this[a18_0x3bce('0xb')]['playerId'])){console[a18_0x3bce('0x11')]('handleTurnOnTVRequest:\x20');try{this['syncPlaylistsService'][a18_0x3bce('0x5d')]();}catch(_0x4e6919){console[a18_0x3bce('0x11')](_0x4e6919);}}}['handleTurnOffTVRequest'](_0x58f162){if(_0x58f162=='all'||_0x58f162==String(this[a18_0x3bce('0xb')][a18_0x3bce('0x4f')])){console[a18_0x3bce('0x11')](a18_0x3bce('0x5e'));try{this[a18_0x3bce('0xb')][a18_0x3bce('0x5f')]();}catch(_0x2254a5){console[a18_0x3bce('0x11')](_0x2254a5);}}}[a18_0x3bce('0x60')](){console['log'](a18_0x3bce('0x61'),this[a18_0x3bce('0x62')]);this[a18_0x3bce('0x35')]['publish'](a18_0x3bce('0x63'),this['syncPlaylistsService'][a18_0x3bce('0x4f')]+'-'+this[a18_0x3bce('0x62')]);}[a18_0x3bce('0x44')](_0x3da211){if(this[a18_0x3bce('0x62')]!=='open'&&this[a18_0x3bce('0x62')]!=='opening'){console['log']('opening\x20player\x20door');this[a18_0x3bce('0x62')]=a18_0x3bce('0x64');this[a18_0x3bce('0x60')]();setTimeout(()=>{this[a18_0x3bce('0x62')]=a18_0x3bce('0x65');this[a18_0x3bce('0x60')]();},0x1388);}}[a18_0x3bce('0x45')](_0x1e817f){if(this[a18_0x3bce('0x62')]!=='closed'&&this[a18_0x3bce('0x62')]!==a18_0x3bce('0x66')){this['state']=a18_0x3bce('0x66');this[a18_0x3bce('0x60')]();setTimeout(()=>{this[a18_0x3bce('0x62')]=a18_0x3bce('0xc');this[a18_0x3bce('0x60')]();},0x1388);}}[a18_0x3bce('0x39')](_0x1064ac,_0x4dbad9){if(_0x4dbad9){console[a18_0x3bce('0x11')](_0x4dbad9[a18_0x3bce('0x67')]);}this[a18_0x3bce('0x35')][a18_0x3bce('0x23')](a18_0x3bce('0x68'),a18_0x3bce('0x69'));}[a18_0x3bce('0x19')](_0x449083,_0x32b435,_0x1af224){const _0x425819={'iat':Math['round'](Date[a18_0x3bce('0x1b')]()/0x3e8),'exp':Math[a18_0x3bce('0x1a')](Date[a18_0x3bce('0x1b')]()/0x3e8)+0x14*0x3c,'aud':_0x449083};const _0x20baf2=fs[a18_0x3bce('0x6a')](_0x32b435);return jwt[a18_0x3bce('0x6b')](_0x425819,_0x20baf2,{'algorithm':_0x1af224});}}exports[a18_0x3bce('0x6c')]=MqttService;