var a18_0x50de=['mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','all','playerId','simple-git','Error\x20git\x20updated','handleUpdateRequest','Git\x20updated','changes','shutdown','now','loadMediaList','reloadMediaList','handleRebootRequest','sendStateUpdate','state','publish','open','opening','opening\x20player\x20door','closed','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','string-template','mqtt','uuid/v4','syncPlaylistsService','init','mqttInit','log','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect'];(function(_0xf90595,_0x441bf9){var _0x333448=function(_0x1d6db8){while(--_0x1d6db8){_0xf90595['push'](_0xf90595['shift']());}};_0x333448(++_0x441bf9);}(a18_0x50de,0x1ec));var a18_0x5887=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a18_0x50de[_0x2d8f05];return _0x4d74cb;};'use strict';Object[a18_0x5887('0x0')](exports,a18_0x5887('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5887('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x5887('0x3'));const progress=require(a18_0x5887('0x4'));const spawn=require(a18_0x5887('0x5'))[a18_0x5887('0x6')];const isImage=require('is-image');const format=require(a18_0x5887('0x7'));const os=require('os');const mqtt=require(a18_0x5887('0x8'));const uuidv4=require(a18_0x5887('0x9'));class MqttService{constructor(_0x50a52c){this[a18_0x5887('0xa')]=_0x50a52c;this['state']='closed';this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a18_0x5887('0xb')](){this['mqttInit']();}[a18_0x5887('0xc')](){console[a18_0x5887('0xd')](a18_0x5887('0xc'));this['clientId']=uuidv4();console[a18_0x5887('0xd')](a18_0x5887('0xe'));console[a18_0x5887('0xd')](this[a18_0x5887('0xf')]);const _0x33013a={'clientId':this['clientId'],'username':a18_0x5887('0x10'),'password':a18_0x5887('0x11'),'clean':!![]};this[a18_0x5887('0x12')]=mqtt[a18_0x5887('0x13')](a18_0x5887('0x14'),_0x33013a);this[a18_0x5887('0x12')]['on'](a18_0x5887('0x13'),this[a18_0x5887('0x15')][a18_0x5887('0x16')](this));this[a18_0x5887('0x12')]['on']('message',this[a18_0x5887('0x17')][a18_0x5887('0x16')](this));process['on'](a18_0x5887('0x18'),this[a18_0x5887('0x19')][a18_0x5887('0x16')](this));process['on'](a18_0x5887('0x1a'),this['handleAppExit'][a18_0x5887('0x16')](this));process['on'](a18_0x5887('0x1b'),this[a18_0x5887('0x19')]['bind'](this));}['mqttClient_connect'](){console[a18_0x5887('0xd')]('Connected\x20to\x20broker\x20client:'+this[a18_0x5887('0xf')]);this[a18_0x5887('0x12')][a18_0x5887('0x1c')](a18_0x5887('0x1d'));this[a18_0x5887('0x12')]['subscribe'](a18_0x5887('0x1e'));this[a18_0x5887('0x12')][a18_0x5887('0x1c')](a18_0x5887('0x1f'),{'qos':0x2});this[a18_0x5887('0x12')][a18_0x5887('0x1c')](a18_0x5887('0x20'),{'qos':0x2});this[a18_0x5887('0x12')][a18_0x5887('0x1c')](a18_0x5887('0x21'),{'qos':0x2});this[a18_0x5887('0x12')][a18_0x5887('0x1c')](a18_0x5887('0x22'),{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x4fcbc3,_0x3daf43){console[a18_0x5887('0xd')](a18_0x5887('0x23'),_0x4fcbc3,_0x3daf43);switch(_0x4fcbc3){case a18_0x5887('0x1d'):return this[a18_0x5887('0x24')](_0x3daf43);case a18_0x5887('0x1e'):return this[a18_0x5887('0x25')](_0x3daf43);case a18_0x5887('0x1f'):return this['handleRebootRequest'](_0x3daf43);case a18_0x5887('0x21'):return this[a18_0x5887('0x26')](_0x3daf43);case a18_0x5887('0x20'):return this[a18_0x5887('0x27')](_0x3daf43);case a18_0x5887('0x22'):return this['handleUpdateRequest'](_0x3daf43);}}['handleUpdateRequest'](_0x278c81){if(_0x278c81==a18_0x5887('0x28')||_0x278c81==String(this[a18_0x5887('0xa')][a18_0x5887('0x29')])){const _0x4fc150=__dirname;const _0x25da11=require(a18_0x5887('0x2a'))(_0x4fc150);console[a18_0x5887('0xd')]('Git\x20updating');_0x25da11['pull']((_0x78b57,_0x555e60)=>{if(_0x78b57){console[a18_0x5887('0xd')](a18_0x5887('0x2b'));this[a18_0x5887('0x2c')](_0x278c81);return;}else{}console[a18_0x5887('0xd')](a18_0x5887('0x2d'));console['log'](_0x555e60);if(_0x555e60&&_0x555e60['summary'][a18_0x5887('0x2e')]){const _0x37ac3a=spawn(a18_0x5887('0x2f'),['-r',a18_0x5887('0x30')]);}else{}});}}[a18_0x5887('0x27')](_0x560b93){if(_0x560b93=='all'||_0x560b93==String(this[a18_0x5887('0xa')][a18_0x5887('0x29')])){this[a18_0x5887('0xa')][a18_0x5887('0x31')]();}}[a18_0x5887('0x26')](_0x52f2ac){if(String(_0x52f2ac)==a18_0x5887('0x28')||String(_0x52f2ac)==String(this['syncPlaylistsService'][a18_0x5887('0x29')])){this['syncPlaylistsService'][a18_0x5887('0x32')]();}}[a18_0x5887('0x33')](_0x233473){if(_0x233473==a18_0x5887('0x28')||_0x233473==String(this[a18_0x5887('0xa')]['playerId'])){const _0x2c54a0=spawn(a18_0x5887('0x2f'),['-r',a18_0x5887('0x30')]);}}[a18_0x5887('0x34')](){console[a18_0x5887('0xd')]('sending\x20state\x20%s',this[a18_0x5887('0x35')]);this['mqttClient'][a18_0x5887('0x36')]('player/state',this[a18_0x5887('0xa')][a18_0x5887('0x29')]+'-'+this[a18_0x5887('0x35')]);}[a18_0x5887('0x24')](_0xd08bf3){if(this['state']!==a18_0x5887('0x37')&&this['state']!==a18_0x5887('0x38')){console[a18_0x5887('0xd')](a18_0x5887('0x39'));this[a18_0x5887('0x35')]=a18_0x5887('0x38');this[a18_0x5887('0x34')]();setTimeout(()=>{this['state']=a18_0x5887('0x37');this[a18_0x5887('0x34')]();},0x1388);}}['handleCloseRequest'](_0x2557fc){if(this['state']!==a18_0x5887('0x3a')&&this[a18_0x5887('0x35')]!=='closing'){this[a18_0x5887('0x35')]=a18_0x5887('0x3b');this['sendStateUpdate']();setTimeout(()=>{this['state']=a18_0x5887('0x3a');this[a18_0x5887('0x34')]();},0x1388);}}[a18_0x5887('0x19')](_0x331a9e,_0x39944f){if(_0x39944f){console['log'](_0x39944f[a18_0x5887('0x3c')]);}this[a18_0x5887('0x12')][a18_0x5887('0x36')](a18_0x5887('0x3d'),a18_0x5887('0x3e'));}}exports[a18_0x5887('0x3f')]=MqttService;