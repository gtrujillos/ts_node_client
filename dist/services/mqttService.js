var a18_0x5471=['open','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closing','stack','false','round','readFileSync','sign','__esModule','./../infrastructure/HttpClientService','request','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_google','mqttInit','velvety-glazing-252020','RS256','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','now','connect','subscribe','/config','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','mqttInit_mosquitto','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','player/register','player/update_settings','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleUpdateSettingsRequest','handleRegisterRequest','all','playerId','registerClient','handleIfconfigRequest','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20'];(function(_0x46507c,_0x520a63){var _0x2924c5=function(_0x2543e4){while(--_0x2543e4){_0x46507c['push'](_0x46507c['shift']());}};_0x2924c5(++_0x520a63);}(a18_0x5471,0x1bf));var a18_0x4517=function(_0x3e9f2d,_0x3b29da){_0x3e9f2d=_0x3e9f2d-0x0;var _0x17d1bd=a18_0x5471[_0x3e9f2d];return _0x17d1bd;};'use strict';Object['defineProperty'](exports,a18_0x4517('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x4517('0x1'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x4517('0x2'));const progress=require(a18_0x4517('0x3'));const spawn=require(a18_0x4517('0x4'))[a18_0x4517('0x5')];const exec=require(a18_0x4517('0x4'))[a18_0x4517('0x6')];const isImage=require(a18_0x4517('0x7'));const format=require(a18_0x4517('0x8'));const os=require('os');const mqtt=require(a18_0x4517('0x9'));const uuidv4=require(a18_0x4517('0xa'));const jwt=require(a18_0x4517('0xb'));class MqttService{constructor(_0x4eaaa9){this[a18_0x4517('0xc')]=_0x4eaaa9;this[a18_0x4517('0xd')]=a18_0x4517('0xe');this[a18_0x4517('0xf')]=new HttpClientService_1[(a18_0x4517('0x10'))]();}[a18_0x4517('0x11')](){this['mqttInit_mosquitto']();}[a18_0x4517('0x12')](){console['log'](a18_0x4517('0x13'));const _0x142f1c=a18_0x4517('0x14');const _0x14bbfe='my-node-device';const _0x2b4f46='my-registry';const _0x56b290='us-central1';const _0x32888b=a18_0x4517('0x15');const _0x3ccd6e='resources/keys/rsa_private.pem';const _0x5599c6=a18_0x4517('0x16');const _0x4eba7a=0x1bb;const _0x5143f2=a18_0x4517('0x17');const _0xfcf569=0x5;const _0x37384b=a18_0x4517('0x18')+_0x142f1c+a18_0x4517('0x19')+_0x56b290+a18_0x4517('0x1a')+_0x2b4f46+a18_0x4517('0x1b')+_0x14bbfe;const _0x595d55={'host':_0x5599c6,'port':_0x4eba7a,'clientId':_0x37384b,'username':a18_0x4517('0x1c'),'password':this[a18_0x4517('0x1d')](_0x142f1c,_0x3ccd6e,_0x32888b),'protocol':a18_0x4517('0x1e'),'secureProtocol':'TLSv1_2_method'};const _0x595a5c=Math['round'](Date[a18_0x4517('0x1f')]()/0x3e8);const _0x16be90=mqtt[a18_0x4517('0x20')](_0x595d55);_0x16be90[a18_0x4517('0x21')](a18_0x4517('0x1b')+_0x14bbfe+a18_0x4517('0x22'),{'qos':0x1});_0x16be90[a18_0x4517('0x21')](a18_0x4517('0x1b')+_0x14bbfe+'/state',{'qos':0x1});_0x16be90[a18_0x4517('0x21')](a18_0x4517('0x1b')+_0x14bbfe+a18_0x4517('0x23'),{'qos':0x0});const _0x2a55ac=a18_0x4517('0x1b')+_0x14bbfe+'/'+_0x5143f2;_0x16be90['on'](a18_0x4517('0x20'),_0x47f701=>{console[a18_0x4517('0x24')](a18_0x4517('0x20'));if(!_0x47f701){console[a18_0x4517('0x24')](a18_0x4517('0x25'));}else{const _0x2a55ac=a18_0x4517('0x26');const _0x88cd05=_0x2b4f46+'/'+_0x14bbfe+'-payload-0';_0x16be90[a18_0x4517('0x27')](_0x2a55ac,_0x88cd05,{'qos':0x1},_0x113f75=>{console['log'](a18_0x4517('0x28'));console[a18_0x4517('0x24')](_0x113f75);if(!_0x113f75){}});}});_0x16be90['on'](a18_0x4517('0x29'),()=>{console[a18_0x4517('0x24')]('close');});_0x16be90['on'](a18_0x4517('0x2a'),_0xef255d=>{console[a18_0x4517('0x24')](a18_0x4517('0x2a'),_0xef255d);});_0x16be90['on'](a18_0x4517('0x2b'),(_0x598455,_0x36230c)=>{let _0x34a97b=a18_0x4517('0x2c');console[a18_0x4517('0x24')](_0x598455);console[a18_0x4517('0x24')](_0x36230c+'');if(_0x598455===a18_0x4517('0x1b')+_0x14bbfe+'/config'){_0x34a97b='Config\x20message\x20received:\x20';}else if(_0x598455[a18_0x4517('0x2d')](a18_0x4517('0x1b')+_0x14bbfe+a18_0x4517('0x2e'))){_0x34a97b=a18_0x4517('0x2f');}_0x34a97b+=Buffer[a18_0x4517('0x30')](_0x36230c,a18_0x4517('0x31'))[a18_0x4517('0x32')](a18_0x4517('0x33'));console[a18_0x4517('0x24')](_0x34a97b);});_0x16be90['on']('packetsend',()=>{});console['log'](_0x595d55);}[a18_0x4517('0x34')](){console[a18_0x4517('0x24')](a18_0x4517('0x13'));this['clientId']=uuidv4();console[a18_0x4517('0x24')](a18_0x4517('0x35'));console[a18_0x4517('0x24')](this[a18_0x4517('0x36')]);const _0xc9659a={'clientId':this[a18_0x4517('0x36')],'username':a18_0x4517('0x37'),'password':a18_0x4517('0x38'),'clean':!![]};this[a18_0x4517('0x39')]=mqtt[a18_0x4517('0x20')](a18_0x4517('0x3a'),_0xc9659a);this['mqttClient']['on']('connect',this[a18_0x4517('0x3b')][a18_0x4517('0x3c')](this));this[a18_0x4517('0x39')]['on'](a18_0x4517('0x2b'),this['mqttClient_message']['bind'](this));this[a18_0x4517('0x39')]['on']('close',()=>{console['log']('close');});process['on'](a18_0x4517('0x3d'),this['handleAppExit'][a18_0x4517('0x3c')](this));process['on']('SIGINT',this[a18_0x4517('0x3e')][a18_0x4517('0x3c')](this));process['on'](a18_0x4517('0x3f'),this['handleAppExit']['bind'](this));}['mqttClient_connect'](){console[a18_0x4517('0x24')](a18_0x4517('0x40')+this[a18_0x4517('0x36')]);this['mqttClient']['subscribe'](a18_0x4517('0x41'));this[a18_0x4517('0x39')][a18_0x4517('0x21')](a18_0x4517('0x42'));this[a18_0x4517('0x39')]['subscribe'](a18_0x4517('0x43'),{'qos':0x2});this[a18_0x4517('0x39')][a18_0x4517('0x21')](a18_0x4517('0x44'),{'qos':0x2});this['mqttClient'][a18_0x4517('0x21')]('player/reload_playlist',{'qos':0x2});this[a18_0x4517('0x39')][a18_0x4517('0x21')]('player/update',{'qos':0x2});this[a18_0x4517('0x39')]['subscribe']('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x4517('0x21')](a18_0x4517('0x45'),{'qos':0x2});this[a18_0x4517('0x39')][a18_0x4517('0x21')](a18_0x4517('0x46'),{'qos':0x2});}[a18_0x4517('0x47')](){}[a18_0x4517('0x48')](_0x21fcf5,_0x51991b){console[a18_0x4517('0x24')](a18_0x4517('0x49'),_0x21fcf5,_0x51991b);switch(_0x21fcf5){case a18_0x4517('0x41'):return this[a18_0x4517('0x4a')](_0x51991b);case'player/close':return this['handleCloseRequest'](_0x51991b);case'player/reboot':return this[a18_0x4517('0x4b')](_0x51991b);case a18_0x4517('0x4c'):return this[a18_0x4517('0x4d')](_0x51991b);case'player/load_playlist':return this[a18_0x4517('0x4e')](_0x51991b);case'player/update':return this[a18_0x4517('0x4f')](_0x51991b);case a18_0x4517('0x50'):return this['handleIfconfigRequest'](_0x51991b);case a18_0x4517('0x45'):return this['handleRegisterRequest'](_0x51991b);case a18_0x4517('0x46'):return this[a18_0x4517('0x51')](_0x51991b);}}[a18_0x4517('0x52')](_0x11487c){if(_0x11487c==a18_0x4517('0x53')||_0x11487c==String(this['syncPlaylistsService'][a18_0x4517('0x54')])){this[a18_0x4517('0xc')][a18_0x4517('0x55')]();}}[a18_0x4517('0x56')](_0x214e8a){if(_0x214e8a==a18_0x4517('0x53')||_0x214e8a==String(this[a18_0x4517('0xc')][a18_0x4517('0x54')])){}}[a18_0x4517('0x4f')](_0x580880){console['log']('handleUpdateRequest:\x20'+_0x580880);if(_0x580880==a18_0x4517('0x53')||_0x580880==String(this['syncPlaylistsService'][a18_0x4517('0x54')])){const _0x277303=__dirname;const _0x1e4c3c=require(a18_0x4517('0x57'))(_0x277303);console[a18_0x4517('0x24')](a18_0x4517('0x58'));_0x1e4c3c[a18_0x4517('0x59')]((_0x142413,_0x4e1b1f)=>{if(_0x142413){console[a18_0x4517('0x24')](a18_0x4517('0x5a'));this['handleUpdateRequest'](_0x580880);return;}else{}console['log'](a18_0x4517('0x5b'));console['log'](_0x4e1b1f);if(_0x4e1b1f&&_0x4e1b1f['summary'][a18_0x4517('0x5c')]){this[a18_0x4517('0xc')][a18_0x4517('0x5d')]();}else{}});}}[a18_0x4517('0x4e')](_0x17faf8){if(_0x17faf8==a18_0x4517('0x53')||_0x17faf8==String(this['syncPlaylistsService'][a18_0x4517('0x54')])){this['syncPlaylistsService'][a18_0x4517('0x5e')]();}}[a18_0x4517('0x4d')](_0x7a3d1c){if(String(_0x7a3d1c)==a18_0x4517('0x53')||String(_0x7a3d1c)==String(this[a18_0x4517('0xc')][a18_0x4517('0x54')])){this[a18_0x4517('0xc')][a18_0x4517('0x5f')]();}}['handleRebootRequest'](_0x34fc10){if(_0x34fc10=='all'||_0x34fc10==String(this[a18_0x4517('0xc')][a18_0x4517('0x54')])){console[a18_0x4517('0x24')](a18_0x4517('0x60'));try{this[a18_0x4517('0xc')][a18_0x4517('0x5d')]();}catch(_0x217dee){console[a18_0x4517('0x24')](_0x217dee);}}}[a18_0x4517('0x51')](_0x90deb6){if(_0x90deb6==a18_0x4517('0x53')||_0x90deb6==String(this[a18_0x4517('0xc')][a18_0x4517('0x54')])){console['log'](a18_0x4517('0x61'));try{this[a18_0x4517('0xc')]['updateSettings']();}catch(_0x264d5c){console['log'](_0x264d5c);}}}['sendStateUpdate'](){console[a18_0x4517('0x24')]('sending\x20state\x20%s',this[a18_0x4517('0xd')]);this[a18_0x4517('0x39')][a18_0x4517('0x27')]('player/state',this[a18_0x4517('0xc')][a18_0x4517('0x54')]+'-'+this[a18_0x4517('0xd')]);}['handleOpenRequest'](_0x40a85f){if(this[a18_0x4517('0xd')]!==a18_0x4517('0x62')&&this[a18_0x4517('0xd')]!==a18_0x4517('0x63')){console['log'](a18_0x4517('0x64'));this[a18_0x4517('0xd')]='opening';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x4517('0xd')]=a18_0x4517('0x62');this[a18_0x4517('0x65')]();},0x1388);}}[a18_0x4517('0x66')](_0x5e89b8){if(this[a18_0x4517('0xd')]!==a18_0x4517('0xe')&&this[a18_0x4517('0xd')]!=='closing'){this['state']=a18_0x4517('0x67');this[a18_0x4517('0x65')]();setTimeout(()=>{this[a18_0x4517('0xd')]=a18_0x4517('0xe');this['sendStateUpdate']();},0x1388);}}[a18_0x4517('0x3e')](_0x43e2e8,_0x59bc72){if(_0x59bc72){console[a18_0x4517('0x24')](_0x59bc72[a18_0x4517('0x68')]);}this[a18_0x4517('0x39')][a18_0x4517('0x27')]('player/connected',a18_0x4517('0x69'));}[a18_0x4517('0x1d')](_0x311374,_0x15ae49,_0x4251b1){const _0x1c409c={'iat':Math['round'](Date[a18_0x4517('0x1f')]()/0x3e8),'exp':Math[a18_0x4517('0x6a')](Date[a18_0x4517('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x311374};const _0x4bd867=fs[a18_0x4517('0x6b')](_0x15ae49);return jwt[a18_0x4517('0x6c')](_0x1c409c,_0x4bd867,{'algorithm':_0x4251b1});}}exports['MqttService']=MqttService;