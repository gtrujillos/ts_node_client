var a20_0x4ef9=['__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','init','mqttInit_mosquitto','velvety-glazing-252020','my-node-device','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','message','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','from','base64','ascii','packetsend','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','handleAppExit','SIGINT','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','received\x20message\x20%s\x20%s','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleUpdateSettingsRequest','player/turn_off_tv','player/turn_on_tv','handleTurnOnTVRequest','handleRegisterRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','reboot','handleRebootRequest','handleUpdateSettingsRequest:\x20','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest','handleTurnOffTVRequest:\x20','turnOffTV','sending\x20state\x20%s','handleOpenRequest','opening','opening\x20player\x20door','sendStateUpdate','open','handleCloseRequest','closing','stack','player/connected','false','sign','MqttService','defineProperty'];(function(_0x38319e,_0x545646){var _0x57daf8=function(_0x56f920){while(--_0x56f920){_0x38319e['push'](_0x38319e['shift']());}};_0x57daf8(++_0x545646);}(a20_0x4ef9,0xe9));var a20_0x19e1=function(_0x26e22c,_0x36c0cf){_0x26e22c=_0x26e22c-0x0;var _0x57e80e=a20_0x4ef9[_0x26e22c];return _0x57e80e;};'use strict';Object[a20_0x19e1('0x0')](exports,a20_0x19e1('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x19e1('0x2'));const fs=require('fs');const fsExtra=require(a20_0x19e1('0x3'));const request=require(a20_0x19e1('0x4'));const progress=require(a20_0x19e1('0x5'));const spawn=require('child_process')['spawn'];const exec=require(a20_0x19e1('0x6'))[a20_0x19e1('0x7')];const isImage=require(a20_0x19e1('0x8'));const format=require(a20_0x19e1('0x9'));const os=require('os');const mqtt=require(a20_0x19e1('0xa'));const uuidv4=require(a20_0x19e1('0xb'));const jwt=require(a20_0x19e1('0xc'));class MqttService{constructor(_0x202be8){this[a20_0x19e1('0xd')]=_0x202be8;this[a20_0x19e1('0xe')]=a20_0x19e1('0xf');this['httpClientService']=new HttpClientService_1['HttpClientService']();}[a20_0x19e1('0x10')](){this[a20_0x19e1('0x11')]();}['mqttInit_google'](){console['log']('mqttInit');const _0x5b2c40=a20_0x19e1('0x12');const _0x54d41b=a20_0x19e1('0x13');const _0xb5e35f='my-registry';const _0x2acadc=a20_0x19e1('0x14');const _0x1b7628='RS256';const _0x1a0508=a20_0x19e1('0x15');const _0x5227a2=a20_0x19e1('0x16');const _0x20fade=0x1bb;const _0xef7795=a20_0x19e1('0x17');const _0x2423e2=0x5;const _0x58bbf7=a20_0x19e1('0x18')+_0x5b2c40+a20_0x19e1('0x19')+_0x2acadc+a20_0x19e1('0x1a')+_0xb5e35f+a20_0x19e1('0x1b')+_0x54d41b;const _0x26b80e={'host':_0x5227a2,'port':_0x20fade,'clientId':_0x58bbf7,'username':a20_0x19e1('0x1c'),'password':this[a20_0x19e1('0x1d')](_0x5b2c40,_0x1a0508,_0x1b7628),'protocol':a20_0x19e1('0x1e'),'secureProtocol':a20_0x19e1('0x1f')};const _0x496198=Math[a20_0x19e1('0x20')](Date[a20_0x19e1('0x21')]()/0x3e8);const _0x227da8=mqtt[a20_0x19e1('0x22')](_0x26b80e);_0x227da8[a20_0x19e1('0x23')](a20_0x19e1('0x1b')+_0x54d41b+'/config',{'qos':0x1});_0x227da8['subscribe'](a20_0x19e1('0x1b')+_0x54d41b+a20_0x19e1('0x24'),{'qos':0x1});_0x227da8[a20_0x19e1('0x23')](a20_0x19e1('0x1b')+_0x54d41b+a20_0x19e1('0x25'),{'qos':0x0});const _0x3cb760=a20_0x19e1('0x1b')+_0x54d41b+'/'+_0xef7795;_0x227da8['on'](a20_0x19e1('0x22'),_0x346c0f=>{console[a20_0x19e1('0x26')](a20_0x19e1('0x22'));if(!_0x346c0f){console[a20_0x19e1('0x26')](a20_0x19e1('0x27'));}else{const _0x3cb760=a20_0x19e1('0x28');const _0x9c9b1d=_0xb5e35f+'/'+_0x54d41b+a20_0x19e1('0x29');_0x227da8[a20_0x19e1('0x2a')](_0x3cb760,_0x9c9b1d,{'qos':0x1},_0x3a3d8e=>{console[a20_0x19e1('0x26')]('publish\x20result:');console[a20_0x19e1('0x26')](_0x3a3d8e);if(!_0x3a3d8e){}});}});_0x227da8['on'](a20_0x19e1('0x2b'),()=>{console['log']('close');});_0x227da8['on'](a20_0x19e1('0x2c'),_0x294c25=>{console[a20_0x19e1('0x26')](a20_0x19e1('0x2c'),_0x294c25);});_0x227da8['on'](a20_0x19e1('0x2d'),(_0x569050,_0x4f0a5a)=>{let _0x23383a=a20_0x19e1('0x2e');console[a20_0x19e1('0x26')](_0x569050);console[a20_0x19e1('0x26')](_0x4f0a5a+'');if(_0x569050==='/devices/'+_0x54d41b+a20_0x19e1('0x2f')){_0x23383a=a20_0x19e1('0x30');}else if(_0x569050[a20_0x19e1('0x31')](a20_0x19e1('0x1b')+_0x54d41b+a20_0x19e1('0x32'))){_0x23383a='Command\x20message\x20received:\x20';}_0x23383a+=Buffer[a20_0x19e1('0x33')](_0x4f0a5a,a20_0x19e1('0x34'))['toString'](a20_0x19e1('0x35'));console[a20_0x19e1('0x26')](_0x23383a);});_0x227da8['on'](a20_0x19e1('0x36'),()=>{});console[a20_0x19e1('0x26')](_0x26b80e);}['mqttInit_mosquitto'](){console[a20_0x19e1('0x26')]('mqttInit');this['clientId']=uuidv4();console[a20_0x19e1('0x26')](a20_0x19e1('0x37'));console[a20_0x19e1('0x26')](this[a20_0x19e1('0x38')]);const _0x26bf4d={'clientId':this[a20_0x19e1('0x38')],'username':a20_0x19e1('0x39'),'password':a20_0x19e1('0x3a'),'clean':!![]};this[a20_0x19e1('0x3b')]=mqtt['connect'](a20_0x19e1('0x3c'),_0x26bf4d);this[a20_0x19e1('0x3b')]['on'](a20_0x19e1('0x22'),this[a20_0x19e1('0x3d')][a20_0x19e1('0x3e')](this));this['mqttClient']['on'](a20_0x19e1('0x2d'),this[a20_0x19e1('0x3f')][a20_0x19e1('0x3e')](this));this['mqttClient']['on'](a20_0x19e1('0x2b'),()=>{console[a20_0x19e1('0x26')](a20_0x19e1('0x2b'));});process['on']('exit',this[a20_0x19e1('0x40')]['bind'](this));process['on'](a20_0x19e1('0x41'),this[a20_0x19e1('0x40')][a20_0x19e1('0x3e')](this));process['on'](a20_0x19e1('0x42'),this[a20_0x19e1('0x40')][a20_0x19e1('0x3e')](this));}[a20_0x19e1('0x3d')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a20_0x19e1('0x38')]);this[a20_0x19e1('0x3b')][a20_0x19e1('0x23')](a20_0x19e1('0x43'));this['mqttClient'][a20_0x19e1('0x23')](a20_0x19e1('0x44'));this[a20_0x19e1('0x3b')][a20_0x19e1('0x23')](a20_0x19e1('0x45'),{'qos':0x2});this[a20_0x19e1('0x3b')][a20_0x19e1('0x23')](a20_0x19e1('0x46'),{'qos':0x2});this[a20_0x19e1('0x3b')][a20_0x19e1('0x23')](a20_0x19e1('0x47'),{'qos':0x2});this[a20_0x19e1('0x3b')][a20_0x19e1('0x23')](a20_0x19e1('0x48'),{'qos':0x2});this['mqttClient'][a20_0x19e1('0x23')](a20_0x19e1('0x49'),{'qos':0x2});this[a20_0x19e1('0x3b')]['subscribe'](a20_0x19e1('0x4a'),{'qos':0x2});this['mqttClient'][a20_0x19e1('0x23')](a20_0x19e1('0x4b'),{'qos':0x2});this[a20_0x19e1('0x3b')]['subscribe']('player/turn_off_tv',{'qos':0x2});this['mqttClient'][a20_0x19e1('0x23')]('player/turn_on_tv',{'qos':0x2});}['reportStatus'](){}[a20_0x19e1('0x3f')](_0x145d83,_0x4bc14b){console[a20_0x19e1('0x26')](a20_0x19e1('0x4c'),_0x145d83,_0x4bc14b);switch(_0x145d83){case a20_0x19e1('0x43'):return this['handleOpenRequest'](_0x4bc14b);case'player/close':return this['handleCloseRequest'](_0x4bc14b);case'player/reboot':return this['handleRebootRequest'](_0x4bc14b);case a20_0x19e1('0x47'):return this[a20_0x19e1('0x4d')](_0x4bc14b);case a20_0x19e1('0x46'):return this[a20_0x19e1('0x4e')](_0x4bc14b);case'player/update':return this[a20_0x19e1('0x4f')](_0x4bc14b);case a20_0x19e1('0x49'):return this[a20_0x19e1('0x50')](_0x4bc14b);case a20_0x19e1('0x4a'):return this['handleRegisterRequest'](_0x4bc14b);case'player/update_settings':return this[a20_0x19e1('0x51')](_0x4bc14b);case a20_0x19e1('0x52'):return this['handleTurnOffTVRequest'](_0x4bc14b);case a20_0x19e1('0x53'):return this[a20_0x19e1('0x54')](_0x4bc14b);}}[a20_0x19e1('0x55')](_0x5adb3a){if(_0x5adb3a=='all'||_0x5adb3a==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){this[a20_0x19e1('0xd')][a20_0x19e1('0x57')]();}}['handleIfconfigRequest'](_0x2d3bba){if(_0x2d3bba==a20_0x19e1('0x58')||_0x2d3bba==String(this[a20_0x19e1('0xd')]['playerId'])){}}['handleUpdateRequest'](_0x3e3792){console[a20_0x19e1('0x26')](a20_0x19e1('0x59')+_0x3e3792);if(_0x3e3792==a20_0x19e1('0x58')||_0x3e3792==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){const _0xe7f53b=__dirname;const _0x18fc81=require(a20_0x19e1('0x5a'))(_0xe7f53b);console['log'](a20_0x19e1('0x5b'));_0x18fc81[a20_0x19e1('0x5c')]((_0x279aa4,_0x3a821f)=>{if(_0x279aa4){console['log'](a20_0x19e1('0x5d'));this['handleUpdateRequest'](_0x3e3792);return;}else{}console[a20_0x19e1('0x26')]('Git\x20updated');console[a20_0x19e1('0x26')](_0x3a821f);if(_0x3a821f&&_0x3a821f[a20_0x19e1('0x5e')][a20_0x19e1('0x5f')]){this['syncPlaylistsService'][a20_0x19e1('0x60')]();}else{}});}}['handleLoadPlaylistRequest'](_0x59f475){if(_0x59f475=='all'||_0x59f475==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){this[a20_0x19e1('0xd')]['loadMediaList']();}}[a20_0x19e1('0x4d')](_0x4004e4){if(String(_0x4004e4)=='all'||String(_0x4004e4)==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){this[a20_0x19e1('0xd')]['reloadMediaList']();}}[a20_0x19e1('0x61')](_0x273909){if(_0x273909==a20_0x19e1('0x58')||_0x273909==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){console[a20_0x19e1('0x26')]('handleRebootRequest\x20shutdown\x20-r\x20now:\x20');try{this[a20_0x19e1('0xd')][a20_0x19e1('0x60')]();}catch(_0x15be59){console[a20_0x19e1('0x26')](_0x15be59);}}}[a20_0x19e1('0x51')](_0x8e6461){if(_0x8e6461==a20_0x19e1('0x58')||_0x8e6461==String(this['syncPlaylistsService'][a20_0x19e1('0x56')])){console[a20_0x19e1('0x26')](a20_0x19e1('0x62'));try{this[a20_0x19e1('0xd')]['updateSettings']();}catch(_0x25b9d8){console[a20_0x19e1('0x26')](_0x25b9d8);}}}[a20_0x19e1('0x54')](_0x14d4a9){if(_0x14d4a9==a20_0x19e1('0x58')||_0x14d4a9==String(this[a20_0x19e1('0xd')][a20_0x19e1('0x56')])){console[a20_0x19e1('0x26')](a20_0x19e1('0x63'));try{this[a20_0x19e1('0xd')][a20_0x19e1('0x64')]();}catch(_0x4b6606){console[a20_0x19e1('0x26')](_0x4b6606);}}}[a20_0x19e1('0x65')](_0x162af2){if(_0x162af2==a20_0x19e1('0x58')||_0x162af2==String(this['syncPlaylistsService']['playerId'])){console['log'](a20_0x19e1('0x66'));try{this[a20_0x19e1('0xd')][a20_0x19e1('0x67')]();}catch(_0x16fce5){console[a20_0x19e1('0x26')](_0x16fce5);}}}['sendStateUpdate'](){console['log'](a20_0x19e1('0x68'),this[a20_0x19e1('0xe')]);this[a20_0x19e1('0x3b')][a20_0x19e1('0x2a')]('player/state',this['syncPlaylistsService'][a20_0x19e1('0x56')]+'-'+this[a20_0x19e1('0xe')]);}[a20_0x19e1('0x69')](_0x530acf){if(this['state']!=='open'&&this[a20_0x19e1('0xe')]!==a20_0x19e1('0x6a')){console['log'](a20_0x19e1('0x6b'));this['state']=a20_0x19e1('0x6a');this[a20_0x19e1('0x6c')]();setTimeout(()=>{this[a20_0x19e1('0xe')]=a20_0x19e1('0x6d');this['sendStateUpdate']();},0x1388);}}[a20_0x19e1('0x6e')](_0x1e5987){if(this['state']!==a20_0x19e1('0xf')&&this[a20_0x19e1('0xe')]!==a20_0x19e1('0x6f')){this['state']=a20_0x19e1('0x6f');this[a20_0x19e1('0x6c')]();setTimeout(()=>{this[a20_0x19e1('0xe')]=a20_0x19e1('0xf');this['sendStateUpdate']();},0x1388);}}[a20_0x19e1('0x40')](_0x1e56f2,_0x12bac3){if(_0x12bac3){console[a20_0x19e1('0x26')](_0x12bac3[a20_0x19e1('0x70')]);}this[a20_0x19e1('0x3b')][a20_0x19e1('0x2a')](a20_0x19e1('0x71'),a20_0x19e1('0x72'));}[a20_0x19e1('0x1d')](_0x40c1b1,_0x929dab,_0x3a420c){const _0x558971={'iat':Math[a20_0x19e1('0x20')](Date['now']()/0x3e8),'exp':Math['round'](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x40c1b1};const _0x4ddc73=fs['readFileSync'](_0x929dab);return jwt[a20_0x19e1('0x73')](_0x558971,_0x4ddc73,{'algorithm':_0x3a420c});}}exports[a20_0x19e1('0x74')]=MqttService;