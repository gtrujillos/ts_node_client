var a18_0x4a48=['player/update','player/ifconfig','reportStatus','received\x20message\x20%s\x20%s','player/open','handleOpenRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','player/register','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','shutdown','loadMediaList','reloadMediaList','reboot','sendStateUpdate','publish','player/state','open','opening\x20player\x20door','handleCloseRequest','closed','closing','stack','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','is-image','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','state','httpClientService','HttpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','mqtt.googleapis.com','events','/registries/','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/devices/','/state','/commands/#','Client\x20not\x20connected...','-payload-0','publish\x20result:','close','error','message','startsWith','/commands','Command\x20message\x20received:\x20','base64','toString','packetsend','clientId','this.clientId','mqttClient','mqttClient_message','bind','handleAppExit','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist'];(function(_0x40210e,_0x5088e7){var _0x252399=function(_0x4d5550){while(--_0x4d5550){_0x40210e['push'](_0x40210e['shift']());}};_0x252399(++_0x5088e7);}(a18_0x4a48,0x1b9));var a18_0x1a80=function(_0xa12d74,_0x5797e7){_0xa12d74=_0xa12d74-0x0;var _0x320dd0=a18_0x4a48[_0xa12d74];return _0x320dd0;};'use strict';Object[a18_0x1a80('0x0')](exports,a18_0x1a80('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x1a80('0x2'));const fs=require('fs');const fsExtra=require(a18_0x1a80('0x3'));const request=require('request');const progress=require(a18_0x1a80('0x4'));const spawn=require('child_process')['spawn'];const isImage=require(a18_0x1a80('0x5'));const format=require(a18_0x1a80('0x6'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x1a80('0x7'));const jwt=require(a18_0x1a80('0x8'));class MqttService{constructor(_0x437daa){this[a18_0x1a80('0x9')]=_0x437daa;this[a18_0x1a80('0xa')]='closed';this[a18_0x1a80('0xb')]=new HttpClientService_1[(a18_0x1a80('0xc'))]();}[a18_0x1a80('0xd')](){this[a18_0x1a80('0xe')]();}['mqttInit_google'](){console[a18_0x1a80('0xf')](a18_0x1a80('0x10'));const _0x30cef0=a18_0x1a80('0x11');const _0xf59170=a18_0x1a80('0x12');const _0x2cb44a='my-registry';const _0x534663=a18_0x1a80('0x13');const _0x298517=a18_0x1a80('0x14');const _0x24596c='resources/keys/rsa_private.pem';const _0x272e61=a18_0x1a80('0x15');const _0x491755=0x1bb;const _0x4bb8bd=a18_0x1a80('0x16');const _0x381874=0x5;const _0x561962='projects/'+_0x30cef0+'/locations/'+_0x534663+a18_0x1a80('0x17')+_0x2cb44a+'/devices/'+_0xf59170;const _0xdf3511={'host':_0x272e61,'port':_0x491755,'clientId':_0x561962,'username':'unused','password':this[a18_0x1a80('0x18')](_0x30cef0,_0x24596c,_0x298517),'protocol':a18_0x1a80('0x19'),'secureProtocol':a18_0x1a80('0x1a')};const _0x4825d7=Math[a18_0x1a80('0x1b')](Date[a18_0x1a80('0x1c')]()/0x3e8);const _0xcaa29f=mqtt[a18_0x1a80('0x1d')](_0xdf3511);_0xcaa29f[a18_0x1a80('0x1e')]('/devices/'+_0xf59170+a18_0x1a80('0x1f'),{'qos':0x1});_0xcaa29f[a18_0x1a80('0x1e')](a18_0x1a80('0x20')+_0xf59170+a18_0x1a80('0x21'),{'qos':0x1});_0xcaa29f[a18_0x1a80('0x1e')](a18_0x1a80('0x20')+_0xf59170+a18_0x1a80('0x22'),{'qos':0x0});const _0x23ad25=a18_0x1a80('0x20')+_0xf59170+'/'+_0x4bb8bd;_0xcaa29f['on'](a18_0x1a80('0x1d'),_0x32b546=>{console[a18_0x1a80('0xf')](a18_0x1a80('0x1d'));if(!_0x32b546){console['log'](a18_0x1a80('0x23'));}else{const _0x23ad25='/projects/velvety-glazing-252020/topics/my-topic';const _0x534af9=_0x2cb44a+'/'+_0xf59170+a18_0x1a80('0x24');_0xcaa29f['publish'](_0x23ad25,_0x534af9,{'qos':0x1},_0xae84a=>{console[a18_0x1a80('0xf')](a18_0x1a80('0x25'));console[a18_0x1a80('0xf')](_0xae84a);if(!_0xae84a){}});}});_0xcaa29f['on'](a18_0x1a80('0x26'),()=>{console[a18_0x1a80('0xf')](a18_0x1a80('0x26'));});_0xcaa29f['on'](a18_0x1a80('0x27'),_0x434317=>{console[a18_0x1a80('0xf')]('error',_0x434317);});_0xcaa29f['on'](a18_0x1a80('0x28'),(_0x226b44,_0x594aea)=>{let _0x49bcf4='Message\x20received:\x20';console[a18_0x1a80('0xf')](_0x226b44);console[a18_0x1a80('0xf')](_0x594aea+'');if(_0x226b44===a18_0x1a80('0x20')+_0xf59170+a18_0x1a80('0x1f')){_0x49bcf4='Config\x20message\x20received:\x20';}else if(_0x226b44[a18_0x1a80('0x29')](a18_0x1a80('0x20')+_0xf59170+a18_0x1a80('0x2a'))){_0x49bcf4=a18_0x1a80('0x2b');}_0x49bcf4+=Buffer['from'](_0x594aea,a18_0x1a80('0x2c'))[a18_0x1a80('0x2d')]('ascii');console[a18_0x1a80('0xf')](_0x49bcf4);});_0xcaa29f['on'](a18_0x1a80('0x2e'),()=>{});console[a18_0x1a80('0xf')](_0xdf3511);}[a18_0x1a80('0xe')](){console[a18_0x1a80('0xf')]('mqttInit');this[a18_0x1a80('0x2f')]=uuidv4();console[a18_0x1a80('0xf')](a18_0x1a80('0x30'));console['log'](this['clientId']);const _0x22f0c9={'clientId':this[a18_0x1a80('0x2f')],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this[a18_0x1a80('0x31')]=mqtt[a18_0x1a80('0x1d')]('mqtt://lulo.run',_0x22f0c9);this['mqttClient']['on'](a18_0x1a80('0x1d'),this['mqttClient_connect']['bind'](this));this[a18_0x1a80('0x31')]['on'](a18_0x1a80('0x28'),this[a18_0x1a80('0x32')][a18_0x1a80('0x33')](this));this[a18_0x1a80('0x31')]['on'](a18_0x1a80('0x26'),()=>{console[a18_0x1a80('0xf')](a18_0x1a80('0x26'));});process['on']('exit',this['handleAppExit'][a18_0x1a80('0x33')](this));process['on']('SIGINT',this[a18_0x1a80('0x34')][a18_0x1a80('0x33')](this));process['on'](a18_0x1a80('0x35'),this['handleAppExit']['bind'](this));}[a18_0x1a80('0x36')](){console[a18_0x1a80('0xf')](a18_0x1a80('0x37')+this[a18_0x1a80('0x2f')]);this[a18_0x1a80('0x31')][a18_0x1a80('0x1e')]('player/open');this['mqttClient']['subscribe'](a18_0x1a80('0x38'));this[a18_0x1a80('0x31')][a18_0x1a80('0x1e')]('player/reboot',{'qos':0x2});this[a18_0x1a80('0x31')][a18_0x1a80('0x1e')](a18_0x1a80('0x39'),{'qos':0x2});this['mqttClient'][a18_0x1a80('0x1e')](a18_0x1a80('0x3a'),{'qos':0x2});this[a18_0x1a80('0x31')][a18_0x1a80('0x1e')](a18_0x1a80('0x3b'),{'qos':0x2});this[a18_0x1a80('0x31')][a18_0x1a80('0x1e')](a18_0x1a80('0x3c'),{'qos':0x2});this['mqttClient'][a18_0x1a80('0x1e')]('player/register',{'qos':0x2});}[a18_0x1a80('0x3d')](){}[a18_0x1a80('0x32')](_0x3ae687,_0x4c64b0){console[a18_0x1a80('0xf')](a18_0x1a80('0x3e'),_0x3ae687,_0x4c64b0);switch(_0x3ae687){case a18_0x1a80('0x3f'):return this[a18_0x1a80('0x40')](_0x4c64b0);case a18_0x1a80('0x38'):return this['handleCloseRequest'](_0x4c64b0);case a18_0x1a80('0x41'):return this[a18_0x1a80('0x42')](_0x4c64b0);case a18_0x1a80('0x3a'):return this[a18_0x1a80('0x43')](_0x4c64b0);case a18_0x1a80('0x39'):return this[a18_0x1a80('0x44')](_0x4c64b0);case a18_0x1a80('0x3b'):return this[a18_0x1a80('0x45')](_0x4c64b0);case a18_0x1a80('0x3c'):return this[a18_0x1a80('0x46')](_0x4c64b0);case a18_0x1a80('0x47'):return this[a18_0x1a80('0x48')](_0x4c64b0);}}[a18_0x1a80('0x48')](_0x43b013){if(_0x43b013==a18_0x1a80('0x49')||_0x43b013==String(this[a18_0x1a80('0x9')][a18_0x1a80('0x4a')])){this[a18_0x1a80('0x9')][a18_0x1a80('0x4b')]();}}[a18_0x1a80('0x46')](_0x35c4be){if(_0x35c4be==a18_0x1a80('0x49')||_0x35c4be==String(this[a18_0x1a80('0x9')][a18_0x1a80('0x4a')])){}}['handleUpdateRequest'](_0x32c70e){console[a18_0x1a80('0xf')](a18_0x1a80('0x4c')+_0x32c70e);if(_0x32c70e==a18_0x1a80('0x49')||_0x32c70e==String(this['syncPlaylistsService'][a18_0x1a80('0x4a')])){const _0x2b785e=__dirname;const _0xc765a9=require(a18_0x1a80('0x4d'))(_0x2b785e);console['log'](a18_0x1a80('0x4e'));_0xc765a9[a18_0x1a80('0x4f')]((_0x3b4136,_0x5df886)=>{if(_0x3b4136){console[a18_0x1a80('0xf')]('Error\x20git\x20updated');this[a18_0x1a80('0x45')](_0x32c70e);return;}else{}console[a18_0x1a80('0xf')](a18_0x1a80('0x50'));console[a18_0x1a80('0xf')](_0x5df886);if(_0x5df886&&_0x5df886[a18_0x1a80('0x51')][a18_0x1a80('0x52')]){const _0x3baaef=spawn(a18_0x1a80('0x53'),['-r','now']);}else{}});}}['handleLoadPlaylistRequest'](_0x241bcc){if(_0x241bcc==a18_0x1a80('0x49')||_0x241bcc==String(this['syncPlaylistsService'][a18_0x1a80('0x4a')])){this['syncPlaylistsService'][a18_0x1a80('0x54')]();}}['handleReloadPlaylistRequest'](_0x144de9){if(String(_0x144de9)==a18_0x1a80('0x49')||String(_0x144de9)==String(this[a18_0x1a80('0x9')][a18_0x1a80('0x4a')])){this[a18_0x1a80('0x9')][a18_0x1a80('0x55')]();}}['handleRebootRequest'](_0x2816e3){if(_0x2816e3==a18_0x1a80('0x49')||_0x2816e3==String(this['syncPlaylistsService'][a18_0x1a80('0x4a')])){console[a18_0x1a80('0xf')](a18_0x1a80('0x42'));try{this[a18_0x1a80('0x9')][a18_0x1a80('0x56')]();}catch(_0x333dbe){console[a18_0x1a80('0xf')](_0x333dbe);}}}[a18_0x1a80('0x57')](){console[a18_0x1a80('0xf')]('sending\x20state\x20%s',this['state']);this[a18_0x1a80('0x31')][a18_0x1a80('0x58')](a18_0x1a80('0x59'),this['syncPlaylistsService']['playerId']+'-'+this[a18_0x1a80('0xa')]);}[a18_0x1a80('0x40')](_0x5ec800){if(this[a18_0x1a80('0xa')]!==a18_0x1a80('0x5a')&&this[a18_0x1a80('0xa')]!=='opening'){console[a18_0x1a80('0xf')](a18_0x1a80('0x5b'));this['state']='opening';this[a18_0x1a80('0x57')]();setTimeout(()=>{this['state']=a18_0x1a80('0x5a');this[a18_0x1a80('0x57')]();},0x1388);}}[a18_0x1a80('0x5c')](_0x2ee45e){if(this[a18_0x1a80('0xa')]!==a18_0x1a80('0x5d')&&this[a18_0x1a80('0xa')]!==a18_0x1a80('0x5e')){this['state']=a18_0x1a80('0x5e');this[a18_0x1a80('0x57')]();setTimeout(()=>{this['state']=a18_0x1a80('0x5d');this['sendStateUpdate']();},0x1388);}}[a18_0x1a80('0x34')](_0x38ee51,_0x520156){if(_0x520156){console[a18_0x1a80('0xf')](_0x520156[a18_0x1a80('0x5f')]);}this['mqttClient'][a18_0x1a80('0x58')]('player/connected',a18_0x1a80('0x60'));}['createJwt'](_0x12a4d1,_0x53108d,_0x314b30){const _0x4b14c4={'iat':Math['round'](Date[a18_0x1a80('0x1c')]()/0x3e8),'exp':Math[a18_0x1a80('0x1b')](Date[a18_0x1a80('0x1c')]()/0x3e8)+0x14*0x3c,'aud':_0x12a4d1};const _0xdc6bbe=fs[a18_0x1a80('0x61')](_0x53108d);return jwt[a18_0x1a80('0x62')](_0x4b14c4,_0xdc6bbe,{'algorithm':_0x314b30});}}exports[a18_0x1a80('0x63')]=MqttService;