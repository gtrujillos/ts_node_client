var a18_0x44b3=['sending\x20state\x20%s','player/state','open','opening\x20player\x20door','opening','closing','stack','publish','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','mqttInit','log','clientId','lulo_mqtt','mqttClient','connect','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','subscribe','player/close','player/load_playlist','player/reload_playlist','player/update','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','player/register','all','playerId','registerClient','simple-git','pull','Error\x20git\x20updated','Git\x20updated','changes','shutdown','now','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','sendStateUpdate'];(function(_0x517c6b,_0x542cc7){var _0x58308f=function(_0x122844){while(--_0x122844){_0x517c6b['push'](_0x517c6b['shift']());}};_0x58308f(++_0x542cc7);}(a18_0x44b3,0x99));var a18_0x4380=function(_0x5c8571,_0x34f287){_0x5c8571=_0x5c8571-0x0;var _0x3b3fa2=a18_0x44b3[_0x5c8571];return _0x3b3fa2;};'use strict';Object[a18_0x4380('0x0')](exports,a18_0x4380('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x4380('0x2'));const fs=require('fs');const fsExtra=require(a18_0x4380('0x3'));const request=require(a18_0x4380('0x4'));const progress=require(a18_0x4380('0x5'));const spawn=require(a18_0x4380('0x6'))['spawn'];const isImage=require(a18_0x4380('0x7'));const format=require(a18_0x4380('0x8'));const os=require('os');const mqtt=require(a18_0x4380('0x9'));const uuidv4=require(a18_0x4380('0xa'));class MqttService{constructor(_0x5dae18){this[a18_0x4380('0xb')]=_0x5dae18;this[a18_0x4380('0xc')]=a18_0x4380('0xd');this[a18_0x4380('0xe')]=new HttpClientService_1['HttpClientService']();}[a18_0x4380('0xf')](){this[a18_0x4380('0x10')]();}[a18_0x4380('0x10')](){console[a18_0x4380('0x11')](a18_0x4380('0x10'));this[a18_0x4380('0x12')]=uuidv4();console[a18_0x4380('0x11')]('this.clientId');console[a18_0x4380('0x11')](this[a18_0x4380('0x12')]);const _0x3181bb={'clientId':this['clientId'],'username':a18_0x4380('0x13'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x4380('0x14')]=mqtt[a18_0x4380('0x15')]('mqtt://lulo.run',_0x3181bb);this[a18_0x4380('0x14')]['on'](a18_0x4380('0x15'),this[a18_0x4380('0x16')][a18_0x4380('0x17')](this));this['mqttClient']['on'](a18_0x4380('0x18'),this[a18_0x4380('0x19')][a18_0x4380('0x17')](this));process['on'](a18_0x4380('0x1a'),this[a18_0x4380('0x1b')][a18_0x4380('0x17')](this));process['on'](a18_0x4380('0x1c'),this[a18_0x4380('0x1b')]['bind'](this));process['on']('uncaughtException',this['handleAppExit']['bind'](this));}['mqttClient_connect'](){console[a18_0x4380('0x11')](a18_0x4380('0x1d')+this[a18_0x4380('0x12')]);this[a18_0x4380('0x14')][a18_0x4380('0x1e')]('player/open');this['mqttClient']['subscribe'](a18_0x4380('0x1f'));this[a18_0x4380('0x14')][a18_0x4380('0x1e')]('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x4380('0x1e')](a18_0x4380('0x20'),{'qos':0x2});this[a18_0x4380('0x14')]['subscribe'](a18_0x4380('0x21'),{'qos':0x2});this[a18_0x4380('0x14')][a18_0x4380('0x1e')](a18_0x4380('0x22'),{'qos':0x2});this['mqttClient'][a18_0x4380('0x1e')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a18_0x4380('0x1e')]('player/register',{'qos':0x2});}[a18_0x4380('0x23')](){}[a18_0x4380('0x19')](_0x11d322,_0x508970){console[a18_0x4380('0x11')](a18_0x4380('0x24'),_0x11d322,_0x508970);switch(_0x11d322){case'player/open':return this[a18_0x4380('0x25')](_0x508970);case'player/close':return this[a18_0x4380('0x26')](_0x508970);case a18_0x4380('0x27'):return this[a18_0x4380('0x28')](_0x508970);case'player/reload_playlist':return this[a18_0x4380('0x29')](_0x508970);case a18_0x4380('0x20'):return this['handleLoadPlaylistRequest'](_0x508970);case'player/update':return this[a18_0x4380('0x2a')](_0x508970);case a18_0x4380('0x2b'):return this[a18_0x4380('0x2c')](_0x508970);case a18_0x4380('0x2d'):return this['handleRegisterRequest'](_0x508970);}}['handleRegisterRequest'](_0x395c6b){if(_0x395c6b==a18_0x4380('0x2e')||_0x395c6b==String(this['syncPlaylistsService'][a18_0x4380('0x2f')])){this[a18_0x4380('0xb')][a18_0x4380('0x30')]();}}[a18_0x4380('0x2c')](_0x1a7bac){if(_0x1a7bac==a18_0x4380('0x2e')||_0x1a7bac==String(this[a18_0x4380('0xb')][a18_0x4380('0x2f')])){}}['handleUpdateRequest'](_0x12da61){if(_0x12da61=='all'||_0x12da61==String(this[a18_0x4380('0xb')][a18_0x4380('0x2f')])){const _0x2335c2=__dirname;const _0x1425f0=require(a18_0x4380('0x31'))(_0x2335c2);console[a18_0x4380('0x11')]('Git\x20updating');_0x1425f0[a18_0x4380('0x32')]((_0x5e3fff,_0x367b63)=>{if(_0x5e3fff){console[a18_0x4380('0x11')](a18_0x4380('0x33'));this['handleUpdateRequest'](_0x12da61);return;}else{}console[a18_0x4380('0x11')](a18_0x4380('0x34'));console['log'](_0x367b63);if(_0x367b63&&_0x367b63['summary'][a18_0x4380('0x35')]){const _0x30c08a=spawn(a18_0x4380('0x36'),['-r',a18_0x4380('0x37')]);}else{}});}}[a18_0x4380('0x38')](_0x46e1b2){if(_0x46e1b2==a18_0x4380('0x2e')||_0x46e1b2==String(this['syncPlaylistsService'][a18_0x4380('0x2f')])){this['syncPlaylistsService'][a18_0x4380('0x39')]();}}['handleReloadPlaylistRequest'](_0x31d99a){if(String(_0x31d99a)==a18_0x4380('0x2e')||String(_0x31d99a)==String(this[a18_0x4380('0xb')][a18_0x4380('0x2f')])){this['syncPlaylistsService'][a18_0x4380('0x3a')]();}}[a18_0x4380('0x28')](_0x159632){if(_0x159632==a18_0x4380('0x2e')||_0x159632==String(this[a18_0x4380('0xb')]['playerId'])){const _0xb13f77=spawn('shutdown',['-r',a18_0x4380('0x37')]);}}[a18_0x4380('0x3b')](){console['log'](a18_0x4380('0x3c'),this['state']);this[a18_0x4380('0x14')]['publish'](a18_0x4380('0x3d'),this[a18_0x4380('0xb')][a18_0x4380('0x2f')]+'-'+this[a18_0x4380('0xc')]);}[a18_0x4380('0x25')](_0x2061c4){if(this[a18_0x4380('0xc')]!==a18_0x4380('0x3e')&&this[a18_0x4380('0xc')]!=='opening'){console[a18_0x4380('0x11')](a18_0x4380('0x3f'));this[a18_0x4380('0xc')]=a18_0x4380('0x40');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x4380('0xc')]=a18_0x4380('0x3e');this['sendStateUpdate']();},0x1388);}}[a18_0x4380('0x26')](_0x30e3a9){if(this['state']!=='closed'&&this[a18_0x4380('0xc')]!==a18_0x4380('0x41')){this[a18_0x4380('0xc')]=a18_0x4380('0x41');this[a18_0x4380('0x3b')]();setTimeout(()=>{this['state']='closed';this[a18_0x4380('0x3b')]();},0x1388);}}['handleAppExit'](_0x4c4c77,_0x11b9d2){if(_0x11b9d2){console[a18_0x4380('0x11')](_0x11b9d2[a18_0x4380('0x42')]);}this[a18_0x4380('0x14')][a18_0x4380('0x43')](a18_0x4380('0x44'),a18_0x4380('0x45'));}}exports[a18_0x4380('0x46')]=MqttService;