var a18_0x1a90=['spawn','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','init','mqttInit','log','this.clientId','clientId','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reload_playlist','player/ifconfig','player/register','reportStatus','handleOpenRequest','handleCloseRequest','player/reboot','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleRegisterRequest','all','playerId','handleIfconfigRequest','handleUpdateRequest','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','now','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','opening','opening\x20player\x20door','open','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process'];(function(_0x38965b,_0x33d36a){var _0x149996=function(_0x553a40){while(--_0x553a40){_0x38965b['push'](_0x38965b['shift']());}};_0x149996(++_0x33d36a);}(a18_0x1a90,0x1ce));var a18_0x227b=function(_0x5a8ca8,_0x56fa0f){_0x5a8ca8=_0x5a8ca8-0x0;var _0x35ab1b=a18_0x1a90[_0x5a8ca8];return _0x35ab1b;};'use strict';Object[a18_0x227b('0x0')](exports,a18_0x227b('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x227b('0x2'));const fs=require('fs');const fsExtra=require(a18_0x227b('0x3'));const request=require(a18_0x227b('0x4'));const progress=require(a18_0x227b('0x5'));const spawn=require(a18_0x227b('0x6'))[a18_0x227b('0x7')];const isImage=require('is-image');const format=require(a18_0x227b('0x8'));const os=require('os');const mqtt=require(a18_0x227b('0x9'));const uuidv4=require(a18_0x227b('0xa'));class MqttService{constructor(_0x5429b0){this[a18_0x227b('0xb')]=_0x5429b0;this[a18_0x227b('0xc')]=a18_0x227b('0xd');this[a18_0x227b('0xe')]=new HttpClientService_1['HttpClientService']();}[a18_0x227b('0xf')](){this['mqttInit']();}[a18_0x227b('0x10')](){console[a18_0x227b('0x11')](a18_0x227b('0x10'));this['clientId']=uuidv4();console[a18_0x227b('0x11')](a18_0x227b('0x12'));console[a18_0x227b('0x11')](this[a18_0x227b('0x13')]);const _0x65d0eb={'clientId':this['clientId'],'username':'lulo_mqtt','password':'run.lulo_2018#.','clean':!![]};this[a18_0x227b('0x14')]=mqtt[a18_0x227b('0x15')](a18_0x227b('0x16'),_0x65d0eb);this[a18_0x227b('0x14')]['on'](a18_0x227b('0x15'),this[a18_0x227b('0x17')][a18_0x227b('0x18')](this));this[a18_0x227b('0x14')]['on']('message',this[a18_0x227b('0x19')][a18_0x227b('0x18')](this));process['on'](a18_0x227b('0x1a'),this[a18_0x227b('0x1b')][a18_0x227b('0x18')](this));process['on'](a18_0x227b('0x1c'),this[a18_0x227b('0x1b')][a18_0x227b('0x18')](this));process['on']('uncaughtException',this['handleAppExit'][a18_0x227b('0x18')](this));}[a18_0x227b('0x17')](){console[a18_0x227b('0x11')](a18_0x227b('0x1d')+this[a18_0x227b('0x13')]);this[a18_0x227b('0x14')][a18_0x227b('0x1e')](a18_0x227b('0x1f'));this[a18_0x227b('0x14')][a18_0x227b('0x1e')](a18_0x227b('0x20'));this['mqttClient'][a18_0x227b('0x1e')]('player/reboot',{'qos':0x2});this[a18_0x227b('0x14')][a18_0x227b('0x1e')]('player/load_playlist',{'qos':0x2});this[a18_0x227b('0x14')][a18_0x227b('0x1e')](a18_0x227b('0x21'),{'qos':0x2});this[a18_0x227b('0x14')][a18_0x227b('0x1e')]('player/update',{'qos':0x2});this[a18_0x227b('0x14')][a18_0x227b('0x1e')](a18_0x227b('0x22'),{'qos':0x2});this['mqttClient'][a18_0x227b('0x1e')](a18_0x227b('0x23'),{'qos':0x2});}[a18_0x227b('0x24')](){}[a18_0x227b('0x19')](_0x40bff5,_0x2afa47){console[a18_0x227b('0x11')]('received\x20message\x20%s\x20%s',_0x40bff5,_0x2afa47);switch(_0x40bff5){case a18_0x227b('0x1f'):return this[a18_0x227b('0x25')](_0x2afa47);case a18_0x227b('0x20'):return this[a18_0x227b('0x26')](_0x2afa47);case a18_0x227b('0x27'):return this['handleRebootRequest'](_0x2afa47);case a18_0x227b('0x21'):return this[a18_0x227b('0x28')](_0x2afa47);case'player/load_playlist':return this[a18_0x227b('0x29')](_0x2afa47);case'player/update':return this['handleUpdateRequest'](_0x2afa47);case a18_0x227b('0x22'):return this['handleIfconfigRequest'](_0x2afa47);case a18_0x227b('0x23'):return this[a18_0x227b('0x2a')](_0x2afa47);}}['handleRegisterRequest'](_0x153f8c){if(_0x153f8c==a18_0x227b('0x2b')||_0x153f8c==String(this['syncPlaylistsService'][a18_0x227b('0x2c')])){this[a18_0x227b('0xb')]['registerClient']();}}[a18_0x227b('0x2d')](_0x18dc27){if(_0x18dc27==a18_0x227b('0x2b')||_0x18dc27==String(this[a18_0x227b('0xb')]['playerId'])){}}[a18_0x227b('0x2e')](_0x2bf937){console[a18_0x227b('0x11')]('handleUpdateRequest:\x20'+_0x2bf937);if(_0x2bf937=='all'||_0x2bf937==String(this[a18_0x227b('0xb')][a18_0x227b('0x2c')])){const _0x3204a9=__dirname;const _0x35c8f9=require('simple-git')(_0x3204a9);console[a18_0x227b('0x11')](a18_0x227b('0x2f'));_0x35c8f9[a18_0x227b('0x30')]((_0x376f94,_0x2619ca)=>{if(_0x376f94){console[a18_0x227b('0x11')](a18_0x227b('0x31'));this[a18_0x227b('0x2e')](_0x2bf937);return;}else{}console[a18_0x227b('0x11')](a18_0x227b('0x32'));console['log'](_0x2619ca);if(_0x2619ca&&_0x2619ca[a18_0x227b('0x33')][a18_0x227b('0x34')]){const _0x1f47e8=spawn('shutdown',['-r',a18_0x227b('0x35')]);}else{}});}}[a18_0x227b('0x29')](_0x58f60b){if(_0x58f60b==a18_0x227b('0x2b')||_0x58f60b==String(this[a18_0x227b('0xb')][a18_0x227b('0x2c')])){this[a18_0x227b('0xb')]['loadMediaList']();}}[a18_0x227b('0x28')](_0x4f5c67){if(String(_0x4f5c67)==a18_0x227b('0x2b')||String(_0x4f5c67)==String(this['syncPlaylistsService']['playerId'])){this[a18_0x227b('0xb')][a18_0x227b('0x36')]();}}['handleRebootRequest'](_0x4eebb3){if(_0x4eebb3==a18_0x227b('0x2b')||_0x4eebb3==String(this['syncPlaylistsService']['playerId'])){const _0x1d640b=spawn('shutdown',['-r',a18_0x227b('0x35')]);}}[a18_0x227b('0x37')](){console['log'](a18_0x227b('0x38'),this['state']);this['mqttClient'][a18_0x227b('0x39')](a18_0x227b('0x3a'),this[a18_0x227b('0xb')]['playerId']+'-'+this[a18_0x227b('0xc')]);}['handleOpenRequest'](_0x3bd443){if(this['state']!=='open'&&this[a18_0x227b('0xc')]!==a18_0x227b('0x3b')){console['log'](a18_0x227b('0x3c'));this[a18_0x227b('0xc')]=a18_0x227b('0x3b');this[a18_0x227b('0x37')]();setTimeout(()=>{this[a18_0x227b('0xc')]=a18_0x227b('0x3d');this[a18_0x227b('0x37')]();},0x1388);}}[a18_0x227b('0x26')](_0x17f295){if(this[a18_0x227b('0xc')]!==a18_0x227b('0xd')&&this[a18_0x227b('0xc')]!==a18_0x227b('0x3e')){this['state']=a18_0x227b('0x3e');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x227b('0xc')]=a18_0x227b('0xd');this[a18_0x227b('0x37')]();},0x1388);}}[a18_0x227b('0x1b')](_0x2ecc82,_0x14c211){if(_0x14c211){console[a18_0x227b('0x11')](_0x14c211[a18_0x227b('0x3f')]);}this[a18_0x227b('0x14')][a18_0x227b('0x39')](a18_0x227b('0x40'),a18_0x227b('0x41'));}}exports[a18_0x227b('0x42')]=MqttService;