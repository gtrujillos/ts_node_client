var a18_0x4294=['child_process','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','mqtt.googleapis.com','events','projects/','/locations/','/devices/','unused','createJwt','round','now','connect','subscribe','/config','/commands/#','log','Client\x20not\x20connected...','-payload-0','publish','close','error','message','Message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist','player/ifconfig','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleRegisterRequest','all','playerId','registerClient','handleIfconfigRequest','pull','Error\x20git\x20updated','Git\x20updated','summary','shutdown','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown','shutdown\x20now','sendStateUpdate','sending\x20state\x20%s','state','player/state','opening','opening\x20player\x20door','open','closed','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request'];(function(_0x48ff8c,_0x1758dc){var _0x4a5234=function(_0x3b3020){while(--_0x3b3020){_0x48ff8c['push'](_0x48ff8c['shift']());}};_0x4a5234(++_0x1758dc);}(a18_0x4294,0x130));var a18_0x5784=function(_0x50aadb,_0x15b5e7){_0x50aadb=_0x50aadb-0x0;var _0x49fbdd=a18_0x4294[_0x50aadb];return _0x49fbdd;};'use strict';Object[a18_0x5784('0x0')](exports,a18_0x5784('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5784('0x2'));const fs=require('fs');const fsExtra=require(a18_0x5784('0x3'));const request=require(a18_0x5784('0x4'));const progress=require('request-progress');const {spawn}=require(a18_0x5784('0x5'));const exec=require(a18_0x5784('0x5'))['exec'];const isImage=require(a18_0x5784('0x6'));const format=require(a18_0x5784('0x7'));const os=require('os');const mqtt=require(a18_0x5784('0x8'));const uuidv4=require(a18_0x5784('0x9'));const jwt=require(a18_0x5784('0xa'));class MqttService{constructor(_0x10045d){this[a18_0x5784('0xb')]=_0x10045d;this['state']='closed';this[a18_0x5784('0xc')]=new HttpClientService_1[(a18_0x5784('0xd'))]();}[a18_0x5784('0xe')](){this[a18_0x5784('0xf')]();}[a18_0x5784('0x10')](){console['log'](a18_0x5784('0x11'));const _0x424189=a18_0x5784('0x12');const _0x1f0239=a18_0x5784('0x13');const _0x4897a7='my-registry';const _0x492ff4=a18_0x5784('0x14');const _0x25dd63=a18_0x5784('0x15');const _0x44ed37='resources/keys/rsa_private.pem';const _0x2ffc18=a18_0x5784('0x16');const _0x1313bd=0x1bb;const _0x2976f1=a18_0x5784('0x17');const _0x1e653a=0x5;const _0x2d1c20=a18_0x5784('0x18')+_0x424189+a18_0x5784('0x19')+_0x492ff4+'/registries/'+_0x4897a7+a18_0x5784('0x1a')+_0x1f0239;const _0x2c9737={'host':_0x2ffc18,'port':_0x1313bd,'clientId':_0x2d1c20,'username':a18_0x5784('0x1b'),'password':this[a18_0x5784('0x1c')](_0x424189,_0x44ed37,_0x25dd63),'protocol':'mqtts','secureProtocol':'TLSv1_2_method'};const _0x440fae=Math[a18_0x5784('0x1d')](Date[a18_0x5784('0x1e')]()/0x3e8);const _0x2706b6=mqtt[a18_0x5784('0x1f')](_0x2c9737);_0x2706b6[a18_0x5784('0x20')]('/devices/'+_0x1f0239+a18_0x5784('0x21'),{'qos':0x1});_0x2706b6['subscribe'](a18_0x5784('0x1a')+_0x1f0239+'/state',{'qos':0x1});_0x2706b6[a18_0x5784('0x20')](a18_0x5784('0x1a')+_0x1f0239+a18_0x5784('0x22'),{'qos':0x0});const _0x3ab74e=a18_0x5784('0x1a')+_0x1f0239+'/'+_0x2976f1;_0x2706b6['on'](a18_0x5784('0x1f'),_0x4451fc=>{console[a18_0x5784('0x23')](a18_0x5784('0x1f'));if(!_0x4451fc){console[a18_0x5784('0x23')](a18_0x5784('0x24'));}else{const _0x3ab74e='/projects/velvety-glazing-252020/topics/my-topic';const _0x7fe5fa=_0x4897a7+'/'+_0x1f0239+a18_0x5784('0x25');_0x2706b6[a18_0x5784('0x26')](_0x3ab74e,_0x7fe5fa,{'qos':0x1},_0x5ba4ed=>{console['log']('publish\x20result:');console[a18_0x5784('0x23')](_0x5ba4ed);if(!_0x5ba4ed){}});}});_0x2706b6['on'](a18_0x5784('0x27'),()=>{console[a18_0x5784('0x23')]('close');});_0x2706b6['on'](a18_0x5784('0x28'),_0x7ac33e=>{console[a18_0x5784('0x23')](a18_0x5784('0x28'),_0x7ac33e);});_0x2706b6['on'](a18_0x5784('0x29'),(_0x417cac,_0x2589ac)=>{let _0xbee7d6=a18_0x5784('0x2a');console[a18_0x5784('0x23')](_0x417cac);console[a18_0x5784('0x23')](_0x2589ac+'');if(_0x417cac==='/devices/'+_0x1f0239+a18_0x5784('0x21')){_0xbee7d6='Config\x20message\x20received:\x20';}else if(_0x417cac[a18_0x5784('0x2b')](a18_0x5784('0x1a')+_0x1f0239+a18_0x5784('0x2c'))){_0xbee7d6=a18_0x5784('0x2d');}_0xbee7d6+=Buffer[a18_0x5784('0x2e')](_0x2589ac,a18_0x5784('0x2f'))[a18_0x5784('0x30')](a18_0x5784('0x31'));console[a18_0x5784('0x23')](_0xbee7d6);});_0x2706b6['on'](a18_0x5784('0x32'),()=>{});console['log'](_0x2c9737);}[a18_0x5784('0xf')](){console['log'](a18_0x5784('0x11'));this[a18_0x5784('0x33')]=uuidv4();console[a18_0x5784('0x23')]('this.clientId');console[a18_0x5784('0x23')](this[a18_0x5784('0x33')]);const _0x1e3029={'clientId':this[a18_0x5784('0x33')],'username':a18_0x5784('0x34'),'password':a18_0x5784('0x35'),'clean':!![]};this[a18_0x5784('0x36')]=mqtt[a18_0x5784('0x1f')](a18_0x5784('0x37'),_0x1e3029);this[a18_0x5784('0x36')]['on'](a18_0x5784('0x1f'),this[a18_0x5784('0x38')][a18_0x5784('0x39')](this));this[a18_0x5784('0x36')]['on'](a18_0x5784('0x29'),this[a18_0x5784('0x3a')][a18_0x5784('0x39')](this));this[a18_0x5784('0x36')]['on'](a18_0x5784('0x27'),()=>{console['log'](a18_0x5784('0x27'));});process['on'](a18_0x5784('0x3b'),this[a18_0x5784('0x3c')][a18_0x5784('0x39')](this));process['on']('SIGINT',this[a18_0x5784('0x3c')][a18_0x5784('0x39')](this));process['on'](a18_0x5784('0x3d'),this['handleAppExit'][a18_0x5784('0x39')](this));}[a18_0x5784('0x38')](){console[a18_0x5784('0x23')](a18_0x5784('0x3e')+this[a18_0x5784('0x33')]);this[a18_0x5784('0x36')]['subscribe']('player/open');this[a18_0x5784('0x36')][a18_0x5784('0x20')](a18_0x5784('0x3f'));this['mqttClient']['subscribe']('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x5784('0x20')](a18_0x5784('0x40'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x5784('0x41'),{'qos':0x2});this[a18_0x5784('0x36')][a18_0x5784('0x20')]('player/update',{'qos':0x2});this['mqttClient'][a18_0x5784('0x20')](a18_0x5784('0x42'),{'qos':0x2});this[a18_0x5784('0x36')][a18_0x5784('0x20')]('player/register',{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x44df48,_0x54fcf5){console[a18_0x5784('0x23')]('received\x20message\x20%s\x20%s',_0x44df48,_0x54fcf5);switch(_0x44df48){case'player/open':return this[a18_0x5784('0x43')](_0x54fcf5);case'player/close':return this[a18_0x5784('0x44')](_0x54fcf5);case a18_0x5784('0x45'):return this[a18_0x5784('0x46')](_0x54fcf5);case a18_0x5784('0x41'):return this['handleReloadPlaylistRequest'](_0x54fcf5);case a18_0x5784('0x40'):return this[a18_0x5784('0x47')](_0x54fcf5);case a18_0x5784('0x48'):return this[a18_0x5784('0x49')](_0x54fcf5);case a18_0x5784('0x42'):return this['handleIfconfigRequest'](_0x54fcf5);case'player/register':return this[a18_0x5784('0x4a')](_0x54fcf5);}}['handleRegisterRequest'](_0x3dfc7e){if(_0x3dfc7e==a18_0x5784('0x4b')||_0x3dfc7e==String(this[a18_0x5784('0xb')][a18_0x5784('0x4c')])){this[a18_0x5784('0xb')][a18_0x5784('0x4d')]();}}[a18_0x5784('0x4e')](_0x101f06){if(_0x101f06==a18_0x5784('0x4b')||_0x101f06==String(this[a18_0x5784('0xb')][a18_0x5784('0x4c')])){}}[a18_0x5784('0x49')](_0x29fe4d){console[a18_0x5784('0x23')]('handleUpdateRequest:\x20'+_0x29fe4d);if(_0x29fe4d==a18_0x5784('0x4b')||_0x29fe4d==String(this['syncPlaylistsService'][a18_0x5784('0x4c')])){const _0x4eaad9=__dirname;const _0x26d77d=require('simple-git')(_0x4eaad9);console[a18_0x5784('0x23')]('Git\x20updating');_0x26d77d[a18_0x5784('0x4f')]((_0xd54792,_0x5de30d)=>{if(_0xd54792){console['log'](a18_0x5784('0x50'));this[a18_0x5784('0x49')](_0x29fe4d);return;}else{}console['log'](a18_0x5784('0x51'));console[a18_0x5784('0x23')](_0x5de30d);if(_0x5de30d&&_0x5de30d[a18_0x5784('0x52')]['changes']){const _0x4d3aa2=spawn(a18_0x5784('0x53'),['-r',a18_0x5784('0x1e')]);}else{}});}}[a18_0x5784('0x47')](_0x482643){if(_0x482643=='all'||_0x482643==String(this['syncPlaylistsService'][a18_0x5784('0x4c')])){this[a18_0x5784('0xb')][a18_0x5784('0x54')]();}}['handleReloadPlaylistRequest'](_0x545de1){if(String(_0x545de1)==a18_0x5784('0x4b')||String(_0x545de1)==String(this[a18_0x5784('0xb')][a18_0x5784('0x4c')])){this['syncPlaylistsService'][a18_0x5784('0x55')]();}}[a18_0x5784('0x46')](_0x20a3c4){if(_0x20a3c4==a18_0x5784('0x4b')||_0x20a3c4==String(this[a18_0x5784('0xb')][a18_0x5784('0x4c')])){console[a18_0x5784('0x23')](a18_0x5784('0x56'));try{exec(a18_0x5784('0x57'),function(_0xd1b2fc,_0x5f2190,_0x223024){console[a18_0x5784('0x23')](_0xd1b2fc);console[a18_0x5784('0x23')](_0x5f2190);console[a18_0x5784('0x23')](_0x223024);});}catch(_0x1e455a){console[a18_0x5784('0x23')](_0x1e455a);}}}[a18_0x5784('0x58')](){console[a18_0x5784('0x23')](a18_0x5784('0x59'),this[a18_0x5784('0x5a')]);this[a18_0x5784('0x36')][a18_0x5784('0x26')](a18_0x5784('0x5b'),this[a18_0x5784('0xb')]['playerId']+'-'+this[a18_0x5784('0x5a')]);}['handleOpenRequest'](_0x37988e){if(this[a18_0x5784('0x5a')]!=='open'&&this[a18_0x5784('0x5a')]!==a18_0x5784('0x5c')){console[a18_0x5784('0x23')](a18_0x5784('0x5d'));this[a18_0x5784('0x5a')]='opening';this[a18_0x5784('0x58')]();setTimeout(()=>{this['state']=a18_0x5784('0x5e');this[a18_0x5784('0x58')]();},0x1388);}}[a18_0x5784('0x44')](_0x3c9d66){if(this[a18_0x5784('0x5a')]!==a18_0x5784('0x5f')&&this[a18_0x5784('0x5a')]!==a18_0x5784('0x60')){this[a18_0x5784('0x5a')]=a18_0x5784('0x60');this[a18_0x5784('0x58')]();setTimeout(()=>{this[a18_0x5784('0x5a')]=a18_0x5784('0x5f');this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x8bd309,_0x17b0b0){if(_0x17b0b0){console['log'](_0x17b0b0[a18_0x5784('0x61')]);}this[a18_0x5784('0x36')][a18_0x5784('0x26')](a18_0x5784('0x62'),a18_0x5784('0x63'));}[a18_0x5784('0x1c')](_0x4b3c7c,_0x942335,_0x5dac0c){const _0x3ff241={'iat':Math[a18_0x5784('0x1d')](Date[a18_0x5784('0x1e')]()/0x3e8),'exp':Math[a18_0x5784('0x1d')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x4b3c7c};const _0xe4f59e=fs[a18_0x5784('0x64')](_0x942335);return jwt[a18_0x5784('0x65')](_0x3ff241,_0xe4f59e,{'algorithm':_0x5dac0c});}}exports[a18_0x5784('0x66')]=MqttService;