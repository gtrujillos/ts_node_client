var a18_0x523f=['mqttClient_message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','player/turn_off_tv','handleTurnOffTVRequest','handleTurnOnTVRequest','all','registerClient','handleUpdateRequest:\x20','playerId','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','sending\x20state\x20%s','player/state','handleOpenRequest','opening','opening\x20player\x20door','sendStateUpdate','open','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','us-central1','RS256','mqtt.googleapis.com','events','projects/','/registries/','unused','mqtts','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','close','error','message','Message\x20received:\x20','/commands','Command\x20message\x20received:\x20','base64','ascii','clientId','this.clientId','lulo_mqtt','mqtt://lulo.run','mqttClient','mqttClient_connect','bind'];(function(_0x445118,_0x331cc5){var _0x1a77e1=function(_0x257ed7){while(--_0x257ed7){_0x445118['push'](_0x445118['shift']());}};_0x1a77e1(++_0x331cc5);}(a18_0x523f,0x127));var a18_0x5824=function(_0x3e4e91,_0x140d8e){_0x3e4e91=_0x3e4e91-0x0;var _0x48ddab=a18_0x523f[_0x3e4e91];return _0x48ddab;};'use strict';Object[a18_0x5824('0x0')](exports,a18_0x5824('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x5824('0x2'));const fs=require('fs');const fsExtra=require(a18_0x5824('0x3'));const request=require('request');const progress=require(a18_0x5824('0x4'));const spawn=require('child_process')[a18_0x5824('0x5')];const exec=require('child_process')[a18_0x5824('0x6')];const isImage=require(a18_0x5824('0x7'));const format=require(a18_0x5824('0x8'));const os=require('os');const mqtt=require(a18_0x5824('0x9'));const uuidv4=require(a18_0x5824('0xa'));const jwt=require(a18_0x5824('0xb'));class MqttService{constructor(_0x102052){this[a18_0x5824('0xc')]=_0x102052;this[a18_0x5824('0xd')]=a18_0x5824('0xe');this[a18_0x5824('0xf')]=new HttpClientService_1[(a18_0x5824('0x10'))]();}[a18_0x5824('0x11')](){this[a18_0x5824('0x12')]();}[a18_0x5824('0x13')](){console['log'](a18_0x5824('0x14'));const _0x1c1540=a18_0x5824('0x15');const _0x121436=a18_0x5824('0x16');const _0x2cd958='my-registry';const _0x41d9fb=a18_0x5824('0x17');const _0x3a79ce=a18_0x5824('0x18');const _0x2b119d='resources/keys/rsa_private.pem';const _0xef3327=a18_0x5824('0x19');const _0xf33804=0x1bb;const _0x2448ca=a18_0x5824('0x1a');const _0x87b576=0x5;const _0x189182=a18_0x5824('0x1b')+_0x1c1540+'/locations/'+_0x41d9fb+a18_0x5824('0x1c')+_0x2cd958+'/devices/'+_0x121436;const _0x2cdf45={'host':_0xef3327,'port':_0xf33804,'clientId':_0x189182,'username':a18_0x5824('0x1d'),'password':this['createJwt'](_0x1c1540,_0x2b119d,_0x3a79ce),'protocol':a18_0x5824('0x1e'),'secureProtocol':a18_0x5824('0x1f')};const _0x3b896d=Math[a18_0x5824('0x20')](Date[a18_0x5824('0x21')]()/0x3e8);const _0x143286=mqtt[a18_0x5824('0x22')](_0x2cdf45);_0x143286[a18_0x5824('0x23')](a18_0x5824('0x24')+_0x121436+a18_0x5824('0x25'),{'qos':0x1});_0x143286[a18_0x5824('0x23')](a18_0x5824('0x24')+_0x121436+a18_0x5824('0x26'),{'qos':0x1});_0x143286[a18_0x5824('0x23')](a18_0x5824('0x24')+_0x121436+a18_0x5824('0x27'),{'qos':0x0});const _0x2288e4=a18_0x5824('0x24')+_0x121436+'/'+_0x2448ca;_0x143286['on']('connect',_0x5c3df6=>{console['log'](a18_0x5824('0x22'));if(!_0x5c3df6){console[a18_0x5824('0x28')](a18_0x5824('0x29'));}else{const _0x2288e4=a18_0x5824('0x2a');const _0x51d7b6=_0x2cd958+'/'+_0x121436+'-payload-0';_0x143286[a18_0x5824('0x2b')](_0x2288e4,_0x51d7b6,{'qos':0x1},_0x1281e8=>{console[a18_0x5824('0x28')]('publish\x20result:');console[a18_0x5824('0x28')](_0x1281e8);if(!_0x1281e8){}});}});_0x143286['on'](a18_0x5824('0x2c'),()=>{console[a18_0x5824('0x28')](a18_0x5824('0x2c'));});_0x143286['on'](a18_0x5824('0x2d'),_0x5793c9=>{console['log'](a18_0x5824('0x2d'),_0x5793c9);});_0x143286['on'](a18_0x5824('0x2e'),(_0x395d20,_0x8ffe2a)=>{let _0x476621=a18_0x5824('0x2f');console[a18_0x5824('0x28')](_0x395d20);console[a18_0x5824('0x28')](_0x8ffe2a+'');if(_0x395d20==='/devices/'+_0x121436+a18_0x5824('0x25')){_0x476621='Config\x20message\x20received:\x20';}else if(_0x395d20['startsWith'](a18_0x5824('0x24')+_0x121436+a18_0x5824('0x30'))){_0x476621=a18_0x5824('0x31');}_0x476621+=Buffer['from'](_0x8ffe2a,a18_0x5824('0x32'))['toString'](a18_0x5824('0x33'));console[a18_0x5824('0x28')](_0x476621);});_0x143286['on']('packetsend',()=>{});console[a18_0x5824('0x28')](_0x2cdf45);}[a18_0x5824('0x12')](){console[a18_0x5824('0x28')](a18_0x5824('0x14'));this[a18_0x5824('0x34')]=uuidv4();console[a18_0x5824('0x28')](a18_0x5824('0x35'));console[a18_0x5824('0x28')](this[a18_0x5824('0x34')]);const _0xf0e59e={'clientId':this[a18_0x5824('0x34')],'username':a18_0x5824('0x36'),'password':'run.lulo_2018#.','clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x5824('0x37'),_0xf0e59e);this[a18_0x5824('0x38')]['on']('connect',this[a18_0x5824('0x39')][a18_0x5824('0x3a')](this));this[a18_0x5824('0x38')]['on'](a18_0x5824('0x2e'),this[a18_0x5824('0x3b')][a18_0x5824('0x3a')](this));this[a18_0x5824('0x38')]['on']('close',()=>{console[a18_0x5824('0x28')](a18_0x5824('0x2c'));});process['on'](a18_0x5824('0x3c'),this[a18_0x5824('0x3d')][a18_0x5824('0x3a')](this));process['on'](a18_0x5824('0x3e'),this[a18_0x5824('0x3d')]['bind'](this));process['on']('uncaughtException',this[a18_0x5824('0x3d')]['bind'](this));}[a18_0x5824('0x39')](){console[a18_0x5824('0x28')](a18_0x5824('0x3f')+this[a18_0x5824('0x34')]);this[a18_0x5824('0x38')][a18_0x5824('0x23')]('player/open');this['mqttClient'][a18_0x5824('0x23')](a18_0x5824('0x40'));this[a18_0x5824('0x38')][a18_0x5824('0x23')](a18_0x5824('0x41'),{'qos':0x2});this[a18_0x5824('0x38')][a18_0x5824('0x23')](a18_0x5824('0x42'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x5824('0x43'),{'qos':0x2});this[a18_0x5824('0x38')][a18_0x5824('0x23')](a18_0x5824('0x44'),{'qos':0x2});this['mqttClient'][a18_0x5824('0x23')](a18_0x5824('0x45'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x5824('0x46'),{'qos':0x2});this[a18_0x5824('0x38')]['subscribe'](a18_0x5824('0x47'),{'qos':0x2});this[a18_0x5824('0x38')][a18_0x5824('0x23')]('player/turn_off_tv',{'qos':0x2});this[a18_0x5824('0x38')][a18_0x5824('0x23')](a18_0x5824('0x48'),{'qos':0x2});}[a18_0x5824('0x49')](){}[a18_0x5824('0x3b')](_0x1acfe6,_0x16b697){console[a18_0x5824('0x28')](a18_0x5824('0x4a'),_0x1acfe6,_0x16b697);switch(_0x1acfe6){case'player/open':return this['handleOpenRequest'](_0x16b697);case a18_0x5824('0x40'):return this[a18_0x5824('0x4b')](_0x16b697);case a18_0x5824('0x41'):return this[a18_0x5824('0x4c')](_0x16b697);case a18_0x5824('0x43'):return this['handleReloadPlaylistRequest'](_0x16b697);case a18_0x5824('0x42'):return this[a18_0x5824('0x4d')](_0x16b697);case a18_0x5824('0x44'):return this[a18_0x5824('0x4e')](_0x16b697);case a18_0x5824('0x45'):return this[a18_0x5824('0x4f')](_0x16b697);case a18_0x5824('0x46'):return this[a18_0x5824('0x50')](_0x16b697);case'player/update_settings':return this[a18_0x5824('0x51')](_0x16b697);case a18_0x5824('0x52'):return this[a18_0x5824('0x53')](_0x16b697);case a18_0x5824('0x48'):return this[a18_0x5824('0x54')](_0x16b697);}}[a18_0x5824('0x50')](_0x25aac4){if(_0x25aac4==a18_0x5824('0x55')||_0x25aac4==String(this[a18_0x5824('0xc')]['playerId'])){this[a18_0x5824('0xc')][a18_0x5824('0x56')]();}}[a18_0x5824('0x4f')](_0x536442){if(_0x536442==a18_0x5824('0x55')||_0x536442==String(this[a18_0x5824('0xc')]['playerId'])){}}[a18_0x5824('0x4e')](_0x20ff03){console[a18_0x5824('0x28')](a18_0x5824('0x57')+_0x20ff03);if(_0x20ff03==a18_0x5824('0x55')||_0x20ff03==String(this[a18_0x5824('0xc')][a18_0x5824('0x58')])){const _0x1b5f78=__dirname;const _0x21dc05=require(a18_0x5824('0x59'))(_0x1b5f78);console[a18_0x5824('0x28')](a18_0x5824('0x5a'));_0x21dc05[a18_0x5824('0x5b')]((_0x4f1d17,_0x3d9596)=>{if(_0x4f1d17){console[a18_0x5824('0x28')](a18_0x5824('0x5c'));this[a18_0x5824('0x4e')](_0x20ff03);return;}else{}console['log'](a18_0x5824('0x5d'));console['log'](_0x3d9596);if(_0x3d9596&&_0x3d9596[a18_0x5824('0x5e')][a18_0x5824('0x5f')]){this[a18_0x5824('0xc')]['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x20f3b3){if(_0x20f3b3==a18_0x5824('0x55')||_0x20f3b3==String(this[a18_0x5824('0xc')]['playerId'])){this[a18_0x5824('0xc')][a18_0x5824('0x60')]();}}[a18_0x5824('0x61')](_0x3cdc00){if(String(_0x3cdc00)==a18_0x5824('0x55')||String(_0x3cdc00)==String(this[a18_0x5824('0xc')]['playerId'])){this['syncPlaylistsService'][a18_0x5824('0x62')]();}}[a18_0x5824('0x4c')](_0x2bb318){if(_0x2bb318=='all'||_0x2bb318==String(this['syncPlaylistsService'][a18_0x5824('0x58')])){console[a18_0x5824('0x28')](a18_0x5824('0x63'));try{this[a18_0x5824('0xc')]['reboot']();}catch(_0x79ad89){console[a18_0x5824('0x28')](_0x79ad89);}}}[a18_0x5824('0x51')](_0xa87d93){if(_0xa87d93=='all'||_0xa87d93==String(this[a18_0x5824('0xc')][a18_0x5824('0x58')])){console[a18_0x5824('0x28')]('handleUpdateSettingsRequest:\x20');try{this[a18_0x5824('0xc')][a18_0x5824('0x64')]();}catch(_0x242cef){console['log'](_0x242cef);}}}[a18_0x5824('0x54')](_0x5acbc1){if(_0x5acbc1==a18_0x5824('0x55')||_0x5acbc1==String(this[a18_0x5824('0xc')][a18_0x5824('0x58')])){console[a18_0x5824('0x28')](a18_0x5824('0x65'));try{this[a18_0x5824('0xc')][a18_0x5824('0x66')]();}catch(_0xe8169b){console[a18_0x5824('0x28')](_0xe8169b);}}}[a18_0x5824('0x53')](_0x57b953){if(_0x57b953==a18_0x5824('0x55')||_0x57b953==String(this['syncPlaylistsService'][a18_0x5824('0x58')])){console[a18_0x5824('0x28')](a18_0x5824('0x67'));try{this['syncPlaylistsService']['turnOffTV']();}catch(_0x5841b5){console[a18_0x5824('0x28')](_0x5841b5);}}}['sendStateUpdate'](){console[a18_0x5824('0x28')](a18_0x5824('0x68'),this['state']);this[a18_0x5824('0x38')][a18_0x5824('0x2b')](a18_0x5824('0x69'),this[a18_0x5824('0xc')][a18_0x5824('0x58')]+'-'+this[a18_0x5824('0xd')]);}[a18_0x5824('0x6a')](_0x4595f8){if(this[a18_0x5824('0xd')]!=='open'&&this['state']!==a18_0x5824('0x6b')){console[a18_0x5824('0x28')](a18_0x5824('0x6c'));this[a18_0x5824('0xd')]=a18_0x5824('0x6b');this[a18_0x5824('0x6d')]();setTimeout(()=>{this[a18_0x5824('0xd')]=a18_0x5824('0x6e');this['sendStateUpdate']();},0x1388);}}[a18_0x5824('0x4b')](_0x3aae35){if(this[a18_0x5824('0xd')]!==a18_0x5824('0xe')&&this[a18_0x5824('0xd')]!==a18_0x5824('0x6f')){this[a18_0x5824('0xd')]='closing';this['sendStateUpdate']();setTimeout(()=>{this[a18_0x5824('0xd')]='closed';this[a18_0x5824('0x6d')]();},0x1388);}}[a18_0x5824('0x3d')](_0x310b11,_0x3b5f13){if(_0x3b5f13){console['log'](_0x3b5f13[a18_0x5824('0x70')]);}this[a18_0x5824('0x38')][a18_0x5824('0x2b')](a18_0x5824('0x71'),a18_0x5824('0x72'));}['createJwt'](_0x4cd243,_0x58a4b2,_0x3b2af8){const _0x2145e7={'iat':Math[a18_0x5824('0x20')](Date['now']()/0x3e8),'exp':Math['round'](Date[a18_0x5824('0x21')]()/0x3e8)+0x14*0x3c,'aud':_0x4cd243};const _0x51a018=fs[a18_0x5824('0x73')](_0x58a4b2);return jwt[a18_0x5824('0x74')](_0x2145e7,_0x51a018,{'algorithm':_0x3b2af8});}}exports[a18_0x5824('0x75')]=MqttService;