var a20_0x455b=['/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','from','base64','toString','ascii','packetsend','mqttInit','clientId','lulo_mqtt','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','player/open','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/ifconfig','handleIfconfigRequest','player/register','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','opening\x20player\x20door','opening','open','closing','stack','player/connected','false','now','sign','MqttService','./../infrastructure/HttpClientService','fs-extra','request','request-progress','spawn','exec','is-image','string-template','mqtt','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','my-registry','mqtt.googleapis.com','/locations/','/devices/','unused','createJwt','mqtts','round','connect','subscribe','/config'];(function(_0x374c23,_0xb61e1){var _0x1ec927=function(_0x2ca6dd){while(--_0x2ca6dd){_0x374c23['push'](_0x374c23['shift']());}};_0x1ec927(++_0xb61e1);}(a20_0x455b,0x190));var a20_0x48d2=function(_0x2ea5b5,_0x2023c0){_0x2ea5b5=_0x2ea5b5-0x0;var _0x5bb80e=a20_0x455b[_0x2ea5b5];return _0x5bb80e;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x48d2('0x0'));const fs=require('fs');const fsExtra=require(a20_0x48d2('0x1'));const request=require(a20_0x48d2('0x2'));const progress=require(a20_0x48d2('0x3'));const spawn=require('child_process')[a20_0x48d2('0x4')];const exec=require('child_process')[a20_0x48d2('0x5')];const isImage=require(a20_0x48d2('0x6'));const format=require(a20_0x48d2('0x7'));const os=require('os');const mqtt=require(a20_0x48d2('0x8'));const uuidv4=require('uuid/v4');const jwt=require(a20_0x48d2('0x9'));class MqttService{constructor(_0x1b3c03){this[a20_0x48d2('0xa')]=_0x1b3c03;this[a20_0x48d2('0xb')]=a20_0x48d2('0xc');this['httpClientService']=new HttpClientService_1[(a20_0x48d2('0xd'))]();}['init'](){this[a20_0x48d2('0xe')]();}[a20_0x48d2('0xf')](){console[a20_0x48d2('0x10')]('mqttInit');const _0x3b18f6='velvety-glazing-252020';const _0x3eda82='my-node-device';const _0x6e45ae=a20_0x48d2('0x11');const _0x353fe8='us-central1';const _0x54b50f='RS256';const _0x398ad8='resources/keys/rsa_private.pem';const _0x3c37fd=a20_0x48d2('0x12');const _0x488b9a=0x1bb;const _0x1beff9='events';const _0x53c9d6=0x5;const _0x446ac6='projects/'+_0x3b18f6+a20_0x48d2('0x13')+_0x353fe8+'/registries/'+_0x6e45ae+a20_0x48d2('0x14')+_0x3eda82;const _0x464adb={'host':_0x3c37fd,'port':_0x488b9a,'clientId':_0x446ac6,'username':a20_0x48d2('0x15'),'password':this[a20_0x48d2('0x16')](_0x3b18f6,_0x398ad8,_0x54b50f),'protocol':a20_0x48d2('0x17'),'secureProtocol':'TLSv1_2_method'};const _0x48a831=Math[a20_0x48d2('0x18')](Date['now']()/0x3e8);const _0x49bd79=mqtt[a20_0x48d2('0x19')](_0x464adb);_0x49bd79[a20_0x48d2('0x1a')](a20_0x48d2('0x14')+_0x3eda82+a20_0x48d2('0x1b'),{'qos':0x1});_0x49bd79[a20_0x48d2('0x1a')]('/devices/'+_0x3eda82+a20_0x48d2('0x1c'),{'qos':0x1});_0x49bd79[a20_0x48d2('0x1a')]('/devices/'+_0x3eda82+a20_0x48d2('0x1d'),{'qos':0x0});const _0x37ef12=a20_0x48d2('0x14')+_0x3eda82+'/'+_0x1beff9;_0x49bd79['on']('connect',_0x5ced25=>{console['log'](a20_0x48d2('0x19'));if(!_0x5ced25){console[a20_0x48d2('0x10')](a20_0x48d2('0x1e'));}else{const _0x37ef12=a20_0x48d2('0x1f');const _0x296210=_0x6e45ae+'/'+_0x3eda82+a20_0x48d2('0x20');_0x49bd79[a20_0x48d2('0x21')](_0x37ef12,_0x296210,{'qos':0x1},_0x282d13=>{console['log']('publish\x20result:');console[a20_0x48d2('0x10')](_0x282d13);if(!_0x282d13){}});}});_0x49bd79['on'](a20_0x48d2('0x22'),()=>{console[a20_0x48d2('0x10')](a20_0x48d2('0x22'));});_0x49bd79['on'](a20_0x48d2('0x23'),_0x4d74f9=>{console[a20_0x48d2('0x10')](a20_0x48d2('0x23'),_0x4d74f9);});_0x49bd79['on'](a20_0x48d2('0x24'),(_0x11ba2e,_0x5e3563)=>{let _0x845516=a20_0x48d2('0x25');console[a20_0x48d2('0x10')](_0x11ba2e);console[a20_0x48d2('0x10')](_0x5e3563+'');if(_0x11ba2e==='/devices/'+_0x3eda82+a20_0x48d2('0x1b')){_0x845516=a20_0x48d2('0x26');}else if(_0x11ba2e[a20_0x48d2('0x27')](a20_0x48d2('0x14')+_0x3eda82+'/commands')){_0x845516='Command\x20message\x20received:\x20';}_0x845516+=Buffer[a20_0x48d2('0x28')](_0x5e3563,a20_0x48d2('0x29'))[a20_0x48d2('0x2a')](a20_0x48d2('0x2b'));console['log'](_0x845516);});_0x49bd79['on'](a20_0x48d2('0x2c'),()=>{});console[a20_0x48d2('0x10')](_0x464adb);}['mqttInit_mosquitto'](){console[a20_0x48d2('0x10')](a20_0x48d2('0x2d'));this[a20_0x48d2('0x2e')]=uuidv4();console[a20_0x48d2('0x10')]('this.clientId');console[a20_0x48d2('0x10')](this['clientId']);const _0x5c1237={'clientId':this['clientId'],'username':a20_0x48d2('0x2f'),'password':'run.lulo_2018#.','clean':!![]};this[a20_0x48d2('0x30')]=mqtt[a20_0x48d2('0x19')]('mqtt://lulo.run',_0x5c1237);this[a20_0x48d2('0x30')]['on']('connect',this[a20_0x48d2('0x31')][a20_0x48d2('0x32')](this));this[a20_0x48d2('0x30')]['on'](a20_0x48d2('0x24'),this[a20_0x48d2('0x33')]['bind'](this));this['mqttClient']['on']('close',()=>{console[a20_0x48d2('0x10')](a20_0x48d2('0x22'));});process['on'](a20_0x48d2('0x34'),this[a20_0x48d2('0x35')][a20_0x48d2('0x32')](this));process['on'](a20_0x48d2('0x36'),this[a20_0x48d2('0x35')][a20_0x48d2('0x32')](this));process['on'](a20_0x48d2('0x37'),this[a20_0x48d2('0x35')][a20_0x48d2('0x32')](this));}[a20_0x48d2('0x31')](){console[a20_0x48d2('0x10')]('Connected\x20to\x20broker\x20client:'+this['clientId']);this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')]('player/open');this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')](a20_0x48d2('0x38'));this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')](a20_0x48d2('0x39'),{'qos':0x2});this['mqttClient'][a20_0x48d2('0x1a')](a20_0x48d2('0x3a'),{'qos':0x2});this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')](a20_0x48d2('0x3b'),{'qos':0x2});this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')](a20_0x48d2('0x3c'),{'qos':0x2});this['mqttClient'][a20_0x48d2('0x1a')]('player/ifconfig',{'qos':0x2});this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')]('player/register',{'qos':0x2});this[a20_0x48d2('0x30')][a20_0x48d2('0x1a')](a20_0x48d2('0x3d'),{'qos':0x2});this[a20_0x48d2('0x30')]['subscribe'](a20_0x48d2('0x3e'),{'qos':0x2});this[a20_0x48d2('0x30')]['subscribe'](a20_0x48d2('0x3f'),{'qos':0x2});}[a20_0x48d2('0x40')](){}[a20_0x48d2('0x33')](_0x554046,_0x51622d){console[a20_0x48d2('0x10')](a20_0x48d2('0x41'),_0x554046,_0x51622d);switch(_0x554046){case a20_0x48d2('0x42'):return this['handleOpenRequest'](_0x51622d);case a20_0x48d2('0x38'):return this[a20_0x48d2('0x43')](_0x51622d);case a20_0x48d2('0x39'):return this[a20_0x48d2('0x44')](_0x51622d);case a20_0x48d2('0x3b'):return this[a20_0x48d2('0x45')](_0x51622d);case a20_0x48d2('0x3a'):return this[a20_0x48d2('0x46')](_0x51622d);case a20_0x48d2('0x3c'):return this['handleUpdateRequest'](_0x51622d);case a20_0x48d2('0x47'):return this[a20_0x48d2('0x48')](_0x51622d);case a20_0x48d2('0x49'):return this[a20_0x48d2('0x4a')](_0x51622d);case a20_0x48d2('0x3d'):return this[a20_0x48d2('0x4b')](_0x51622d);case'player/turn_off_tv':return this[a20_0x48d2('0x4c')](_0x51622d);case a20_0x48d2('0x3f'):return this[a20_0x48d2('0x4d')](_0x51622d);}}['handleRegisterRequest'](_0x6cb633){if(_0x6cb633==a20_0x48d2('0x4e')||_0x6cb633==String(this['syncPlaylistsService'][a20_0x48d2('0x4f')])){this['syncPlaylistsService'][a20_0x48d2('0x50')]();}}[a20_0x48d2('0x48')](_0x2864ac){if(_0x2864ac==a20_0x48d2('0x4e')||_0x2864ac==String(this[a20_0x48d2('0xa')][a20_0x48d2('0x4f')])){}}[a20_0x48d2('0x51')](_0x4e8299){console[a20_0x48d2('0x10')](a20_0x48d2('0x52')+_0x4e8299);if(_0x4e8299==a20_0x48d2('0x4e')||_0x4e8299==String(this[a20_0x48d2('0xa')][a20_0x48d2('0x4f')])){const _0x405c00=__dirname;const _0x4e5bb2=require(a20_0x48d2('0x53'))(_0x405c00);console[a20_0x48d2('0x10')]('Git\x20updating');_0x4e5bb2[a20_0x48d2('0x54')]((_0x127a14,_0x3310cb)=>{if(_0x127a14){console[a20_0x48d2('0x10')](a20_0x48d2('0x55'));this[a20_0x48d2('0x51')](_0x4e8299);return;}else{}console[a20_0x48d2('0x10')](a20_0x48d2('0x56'));console[a20_0x48d2('0x10')](_0x3310cb);if(_0x3310cb&&_0x3310cb[a20_0x48d2('0x57')]['changes']){this[a20_0x48d2('0xa')]['reboot']();}else{}});}}[a20_0x48d2('0x46')](_0xfe1fd0){if(_0xfe1fd0==a20_0x48d2('0x4e')||_0xfe1fd0==String(this['syncPlaylistsService']['playerId'])){this[a20_0x48d2('0xa')]['loadMediaList']();}}[a20_0x48d2('0x45')](_0x18638e){if(String(_0x18638e)=='all'||String(_0x18638e)==String(this[a20_0x48d2('0xa')]['playerId'])){this[a20_0x48d2('0xa')]['reloadMediaList']();}}['handleRebootRequest'](_0x47d805){if(_0x47d805=='all'||_0x47d805==String(this['syncPlaylistsService'][a20_0x48d2('0x4f')])){console[a20_0x48d2('0x10')](a20_0x48d2('0x58'));try{this[a20_0x48d2('0xa')][a20_0x48d2('0x59')]();}catch(_0x23d253){console[a20_0x48d2('0x10')](_0x23d253);}}}['handleUpdateSettingsRequest'](_0x5ecb54){if(_0x5ecb54==a20_0x48d2('0x4e')||_0x5ecb54==String(this[a20_0x48d2('0xa')][a20_0x48d2('0x4f')])){console[a20_0x48d2('0x10')](a20_0x48d2('0x5a'));try{this[a20_0x48d2('0xa')][a20_0x48d2('0x5b')]();}catch(_0x4f67bd){console['log'](_0x4f67bd);}}}['handleTurnOnTVRequest'](_0x7fb0ce){if(_0x7fb0ce==a20_0x48d2('0x4e')||_0x7fb0ce==String(this[a20_0x48d2('0xa')][a20_0x48d2('0x4f')])){console[a20_0x48d2('0x10')](a20_0x48d2('0x5c'));try{this[a20_0x48d2('0xa')]['turnOnTV']();}catch(_0x358d3b){console[a20_0x48d2('0x10')](_0x358d3b);}}}[a20_0x48d2('0x4c')](_0x4d65cd){if(_0x4d65cd=='all'||_0x4d65cd==String(this['syncPlaylistsService'][a20_0x48d2('0x4f')])){console[a20_0x48d2('0x10')]('handleTurnOffTVRequest:\x20');try{this[a20_0x48d2('0xa')][a20_0x48d2('0x5d')]();}catch(_0x4bf900){console[a20_0x48d2('0x10')](_0x4bf900);}}}[a20_0x48d2('0x5e')](){console[a20_0x48d2('0x10')](a20_0x48d2('0x5f'),this[a20_0x48d2('0xb')]);this[a20_0x48d2('0x30')][a20_0x48d2('0x21')](a20_0x48d2('0x60'),this[a20_0x48d2('0xa')]['playerId']+'-'+this[a20_0x48d2('0xb')]);}['handleOpenRequest'](_0x3d3c2f){if(this[a20_0x48d2('0xb')]!=='open'&&this[a20_0x48d2('0xb')]!=='opening'){console[a20_0x48d2('0x10')](a20_0x48d2('0x61'));this[a20_0x48d2('0xb')]=a20_0x48d2('0x62');this['sendStateUpdate']();setTimeout(()=>{this[a20_0x48d2('0xb')]=a20_0x48d2('0x63');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x3b7518){if(this['state']!==a20_0x48d2('0xc')&&this[a20_0x48d2('0xb')]!=='closing'){this[a20_0x48d2('0xb')]=a20_0x48d2('0x64');this[a20_0x48d2('0x5e')]();setTimeout(()=>{this[a20_0x48d2('0xb')]=a20_0x48d2('0xc');this[a20_0x48d2('0x5e')]();},0x1388);}}[a20_0x48d2('0x35')](_0x2cef9c,_0x45945e){if(_0x45945e){console[a20_0x48d2('0x10')](_0x45945e[a20_0x48d2('0x65')]);}this[a20_0x48d2('0x30')]['publish'](a20_0x48d2('0x66'),a20_0x48d2('0x67'));}['createJwt'](_0x49229e,_0x1be47d,_0x3cca23){const _0x3f6626={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a20_0x48d2('0x18')](Date[a20_0x48d2('0x68')]()/0x3e8)+0x14*0x3c,'aud':_0x49229e};const _0x1b2178=fs['readFileSync'](_0x1be47d);return jwt[a20_0x48d2('0x69')](_0x3f6626,_0x1b2178,{'algorithm':_0x3cca23});}}exports[a20_0x48d2('0x6a')]=MqttService;