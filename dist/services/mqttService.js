var a20_0x1a29=['handleUpdateRequest','player/ifconfig','handleIfconfigRequest','handleRegisterRequest','handleTurnOffTVRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','Error\x20git\x20updated','Git\x20updated','changes','reboot','handleLoadPlaylistRequest','loadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','open','opening','sendStateUpdate','closing','stack','false','createJwt','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','my-node-device','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','mqtts','round','connect','subscribe','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','mqttClient_message','handleAppExit','bind','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/register','player/update_settings','player/turn_off_tv','player/open','handleOpenRequest','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest'];(function(_0x3524fc,_0x29485f){var _0x2a33b4=function(_0x4477c5){while(--_0x4477c5){_0x3524fc['push'](_0x3524fc['shift']());}};_0x2a33b4(++_0x29485f);}(a20_0x1a29,0x98));var a20_0x297e=function(_0x2902ae,_0x14c81f){_0x2902ae=_0x2902ae-0x0;var _0x4f59bd=a20_0x1a29[_0x2902ae];return _0x4f59bd;};'use strict';Object[a20_0x297e('0x0')](exports,a20_0x297e('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x297e('0x2'));const fs=require('fs');const fsExtra=require(a20_0x297e('0x3'));const request=require(a20_0x297e('0x4'));const progress=require('request-progress');const spawn=require(a20_0x297e('0x5'))[a20_0x297e('0x6')];const exec=require(a20_0x297e('0x5'))[a20_0x297e('0x7')];const isImage=require(a20_0x297e('0x8'));const format=require('string-template');const os=require('os');const mqtt=require(a20_0x297e('0x9'));const uuidv4=require(a20_0x297e('0xa'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x4eb279){this[a20_0x297e('0xb')]=_0x4eb279;this[a20_0x297e('0xc')]=a20_0x297e('0xd');this[a20_0x297e('0xe')]=new HttpClientService_1[(a20_0x297e('0xf'))]();}[a20_0x297e('0x10')](){this[a20_0x297e('0x11')]();}[a20_0x297e('0x12')](){console[a20_0x297e('0x13')](a20_0x297e('0x14'));const _0x2db180='velvety-glazing-252020';const _0x7f4178=a20_0x297e('0x15');const _0x4cbf08=a20_0x297e('0x16');const _0x3e7488=a20_0x297e('0x17');const _0x50bd08='RS256';const _0xab8a0a=a20_0x297e('0x18');const _0x2e85b1=a20_0x297e('0x19');const _0x2eaf30=0x1bb;const _0x1a8472=a20_0x297e('0x1a');const _0x177eb2=0x5;const _0x1e595c=a20_0x297e('0x1b')+_0x2db180+a20_0x297e('0x1c')+_0x3e7488+a20_0x297e('0x1d')+_0x4cbf08+a20_0x297e('0x1e')+_0x7f4178;const _0x55c44d={'host':_0x2e85b1,'port':_0x2eaf30,'clientId':_0x1e595c,'username':a20_0x297e('0x1f'),'password':this['createJwt'](_0x2db180,_0xab8a0a,_0x50bd08),'protocol':a20_0x297e('0x20'),'secureProtocol':'TLSv1_2_method'};const _0x5e1c22=Math[a20_0x297e('0x21')](Date['now']()/0x3e8);const _0x19c374=mqtt[a20_0x297e('0x22')](_0x55c44d);_0x19c374[a20_0x297e('0x23')]('/devices/'+_0x7f4178+'/config',{'qos':0x1});_0x19c374[a20_0x297e('0x23')]('/devices/'+_0x7f4178+a20_0x297e('0x24'),{'qos':0x1});_0x19c374[a20_0x297e('0x23')](a20_0x297e('0x1e')+_0x7f4178+a20_0x297e('0x25'),{'qos':0x0});const _0x3473b1=a20_0x297e('0x1e')+_0x7f4178+'/'+_0x1a8472;_0x19c374['on'](a20_0x297e('0x22'),_0x587ff3=>{console[a20_0x297e('0x13')](a20_0x297e('0x22'));if(!_0x587ff3){console[a20_0x297e('0x13')](a20_0x297e('0x26'));}else{const _0x3473b1=a20_0x297e('0x27');const _0x4a0cbc=_0x4cbf08+'/'+_0x7f4178+'-payload-0';_0x19c374[a20_0x297e('0x28')](_0x3473b1,_0x4a0cbc,{'qos':0x1},_0x2e474d=>{console[a20_0x297e('0x13')](a20_0x297e('0x29'));console[a20_0x297e('0x13')](_0x2e474d);if(!_0x2e474d){}});}});_0x19c374['on'](a20_0x297e('0x2a'),()=>{console[a20_0x297e('0x13')](a20_0x297e('0x2a'));});_0x19c374['on'](a20_0x297e('0x2b'),_0x5f47ed=>{console[a20_0x297e('0x13')](a20_0x297e('0x2b'),_0x5f47ed);});_0x19c374['on'](a20_0x297e('0x2c'),(_0x1a9c12,_0x58ad42)=>{let _0x2dc926=a20_0x297e('0x2d');console['log'](_0x1a9c12);console['log'](_0x58ad42+'');if(_0x1a9c12===a20_0x297e('0x1e')+_0x7f4178+a20_0x297e('0x2e')){_0x2dc926=a20_0x297e('0x2f');}else if(_0x1a9c12['startsWith'](a20_0x297e('0x1e')+_0x7f4178+'/commands')){_0x2dc926=a20_0x297e('0x30');}_0x2dc926+=Buffer[a20_0x297e('0x31')](_0x58ad42,a20_0x297e('0x32'))['toString'](a20_0x297e('0x33'));console['log'](_0x2dc926);});_0x19c374['on'](a20_0x297e('0x34'),()=>{});console[a20_0x297e('0x13')](_0x55c44d);}[a20_0x297e('0x11')](){console[a20_0x297e('0x13')](a20_0x297e('0x14'));this['clientId']=uuidv4();console[a20_0x297e('0x13')](a20_0x297e('0x35'));console[a20_0x297e('0x13')](this[a20_0x297e('0x36')]);const _0x564721={'clientId':this[a20_0x297e('0x36')],'username':a20_0x297e('0x37'),'password':a20_0x297e('0x38'),'clean':!![]};this[a20_0x297e('0x39')]=mqtt['connect'](a20_0x297e('0x3a'),_0x564721);this['mqttClient']['on'](a20_0x297e('0x22'),this[a20_0x297e('0x3b')]['bind'](this));this[a20_0x297e('0x39')]['on'](a20_0x297e('0x2c'),this[a20_0x297e('0x3c')]['bind'](this));this[a20_0x297e('0x39')]['on'](a20_0x297e('0x2a'),()=>{console[a20_0x297e('0x13')](a20_0x297e('0x2a'));});process['on']('exit',this[a20_0x297e('0x3d')][a20_0x297e('0x3e')](this));process['on']('SIGINT',this[a20_0x297e('0x3d')][a20_0x297e('0x3e')](this));process['on'](a20_0x297e('0x3f'),this[a20_0x297e('0x3d')][a20_0x297e('0x3e')](this));}['mqttClient_connect'](){console[a20_0x297e('0x13')](a20_0x297e('0x40')+this[a20_0x297e('0x36')]);this[a20_0x297e('0x39')]['subscribe']('player/open');this[a20_0x297e('0x39')][a20_0x297e('0x23')](a20_0x297e('0x41'));this[a20_0x297e('0x39')]['subscribe'](a20_0x297e('0x42'),{'qos':0x2});this[a20_0x297e('0x39')]['subscribe'](a20_0x297e('0x43'),{'qos':0x2});this['mqttClient']['subscribe'](a20_0x297e('0x44'),{'qos':0x2});this['mqttClient'][a20_0x297e('0x23')](a20_0x297e('0x45'),{'qos':0x2});this[a20_0x297e('0x39')][a20_0x297e('0x23')]('player/ifconfig',{'qos':0x2});this[a20_0x297e('0x39')]['subscribe'](a20_0x297e('0x46'),{'qos':0x2});this[a20_0x297e('0x39')][a20_0x297e('0x23')](a20_0x297e('0x47'),{'qos':0x2});this[a20_0x297e('0x39')][a20_0x297e('0x23')](a20_0x297e('0x48'),{'qos':0x2});this[a20_0x297e('0x39')][a20_0x297e('0x23')]('player/turn_on_tv',{'qos':0x2});}['reportStatus'](){}[a20_0x297e('0x3c')](_0x3baaaa,_0x5d422c){console['log']('received\x20message\x20%s\x20%s',_0x3baaaa,_0x5d422c);switch(_0x3baaaa){case a20_0x297e('0x49'):return this[a20_0x297e('0x4a')](_0x5d422c);case a20_0x297e('0x41'):return this[a20_0x297e('0x4b')](_0x5d422c);case a20_0x297e('0x42'):return this[a20_0x297e('0x4c')](_0x5d422c);case'player/reload_playlist':return this[a20_0x297e('0x4d')](_0x5d422c);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0x5d422c);case a20_0x297e('0x45'):return this[a20_0x297e('0x4e')](_0x5d422c);case a20_0x297e('0x4f'):return this[a20_0x297e('0x50')](_0x5d422c);case a20_0x297e('0x46'):return this[a20_0x297e('0x51')](_0x5d422c);case a20_0x297e('0x47'):return this['handleUpdateSettingsRequest'](_0x5d422c);case a20_0x297e('0x48'):return this[a20_0x297e('0x52')](_0x5d422c);case'player/turn_on_tv':return this['handleTurnOnTVRequest'](_0x5d422c);}}[a20_0x297e('0x51')](_0x454f5e){if(_0x454f5e==a20_0x297e('0x53')||_0x454f5e==String(this['syncPlaylistsService'][a20_0x297e('0x54')])){this[a20_0x297e('0xb')][a20_0x297e('0x55')]();}}[a20_0x297e('0x50')](_0x229c21){if(_0x229c21=='all'||_0x229c21==String(this[a20_0x297e('0xb')][a20_0x297e('0x54')])){}}[a20_0x297e('0x4e')](_0x27f53e){console[a20_0x297e('0x13')](a20_0x297e('0x56')+_0x27f53e);if(_0x27f53e=='all'||_0x27f53e==String(this[a20_0x297e('0xb')]['playerId'])){const _0x4b1da5=__dirname;const _0x2d0431=require(a20_0x297e('0x57'))(_0x4b1da5);console['log'](a20_0x297e('0x58'));_0x2d0431['pull']((_0x2a570e,_0x217955)=>{if(_0x2a570e){console[a20_0x297e('0x13')](a20_0x297e('0x59'));this[a20_0x297e('0x4e')](_0x27f53e);return;}else{}console[a20_0x297e('0x13')](a20_0x297e('0x5a'));console[a20_0x297e('0x13')](_0x217955);if(_0x217955&&_0x217955['summary'][a20_0x297e('0x5b')]){this['syncPlaylistsService'][a20_0x297e('0x5c')]();}else{}});}}[a20_0x297e('0x5d')](_0x36ba4){if(_0x36ba4==a20_0x297e('0x53')||_0x36ba4==String(this['syncPlaylistsService'][a20_0x297e('0x54')])){this[a20_0x297e('0xb')][a20_0x297e('0x5e')]();}}[a20_0x297e('0x4d')](_0x1cd3a7){if(String(_0x1cd3a7)==a20_0x297e('0x53')||String(_0x1cd3a7)==String(this[a20_0x297e('0xb')][a20_0x297e('0x54')])){this[a20_0x297e('0xb')]['reloadMediaList']();}}[a20_0x297e('0x4c')](_0x18276d){if(_0x18276d==a20_0x297e('0x53')||_0x18276d==String(this[a20_0x297e('0xb')][a20_0x297e('0x54')])){console[a20_0x297e('0x13')](a20_0x297e('0x5f'));try{this[a20_0x297e('0xb')][a20_0x297e('0x5c')]();}catch(_0xf939ec){console['log'](_0xf939ec);}}}[a20_0x297e('0x60')](_0x4cee74){if(_0x4cee74=='all'||_0x4cee74==String(this['syncPlaylistsService']['playerId'])){console[a20_0x297e('0x13')](a20_0x297e('0x61'));try{this[a20_0x297e('0xb')][a20_0x297e('0x62')]();}catch(_0x5262a6){console[a20_0x297e('0x13')](_0x5262a6);}}}[a20_0x297e('0x63')](_0x3f30f4){if(_0x3f30f4==a20_0x297e('0x53')||_0x3f30f4==String(this[a20_0x297e('0xb')][a20_0x297e('0x54')])){console[a20_0x297e('0x13')](a20_0x297e('0x64'));try{this[a20_0x297e('0xb')][a20_0x297e('0x65')]();}catch(_0x1a800d){console[a20_0x297e('0x13')](_0x1a800d);}}}[a20_0x297e('0x52')](_0x1a8ad7){if(_0x1a8ad7==a20_0x297e('0x53')||_0x1a8ad7==String(this[a20_0x297e('0xb')][a20_0x297e('0x54')])){console['log'](a20_0x297e('0x66'));try{this[a20_0x297e('0xb')][a20_0x297e('0x67')]();}catch(_0x27571d){console['log'](_0x27571d);}}}['sendStateUpdate'](){console[a20_0x297e('0x13')]('sending\x20state\x20%s',this[a20_0x297e('0xc')]);this['mqttClient'][a20_0x297e('0x28')]('player/state',this[a20_0x297e('0xb')]['playerId']+'-'+this['state']);}[a20_0x297e('0x4a')](_0x2e0be6){if(this['state']!==a20_0x297e('0x68')&&this[a20_0x297e('0xc')]!==a20_0x297e('0x69')){console['log']('opening\x20player\x20door');this[a20_0x297e('0xc')]=a20_0x297e('0x69');this[a20_0x297e('0x6a')]();setTimeout(()=>{this[a20_0x297e('0xc')]=a20_0x297e('0x68');this[a20_0x297e('0x6a')]();},0x1388);}}['handleCloseRequest'](_0x3c6297){if(this[a20_0x297e('0xc')]!=='closed'&&this[a20_0x297e('0xc')]!=='closing'){this['state']=a20_0x297e('0x6b');this['sendStateUpdate']();setTimeout(()=>{this['state']=a20_0x297e('0xd');this[a20_0x297e('0x6a')]();},0x1388);}}[a20_0x297e('0x3d')](_0x40f795,_0x18a41d){if(_0x18a41d){console[a20_0x297e('0x13')](_0x18a41d[a20_0x297e('0x6c')]);}this[a20_0x297e('0x39')]['publish']('player/connected',a20_0x297e('0x6d'));}[a20_0x297e('0x6e')](_0x60a9c8,_0x5b3f0b,_0x376b9){const _0x27aaf3={'iat':Math[a20_0x297e('0x21')](Date[a20_0x297e('0x6f')]()/0x3e8),'exp':Math[a20_0x297e('0x21')](Date[a20_0x297e('0x6f')]()/0x3e8)+0x14*0x3c,'aud':_0x60a9c8};const _0x21dc44=fs[a20_0x297e('0x70')](_0x5b3f0b);return jwt[a20_0x297e('0x71')](_0x27aaf3,_0x21dc44,{'algorithm':_0x376b9});}}exports[a20_0x297e('0x72')]=MqttService;