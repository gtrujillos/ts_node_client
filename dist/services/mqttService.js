var a18_0x13a4=['./../infrastructure/HttpClientService','request','request-progress','spawn','is-image','mqtt','uuid/v4','syncPlaylistsService','state','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','handleAppExit','SIGINT','uncaughtException','mqttClient','subscribe','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','player/open','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleRegisterRequest','all','registerClient','handleIfconfigRequest','playerId','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','shutdown','now','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','open','opening\x20player\x20door','opening','closed','closing','stack','player/connected','false','MqttService','defineProperty','__esModule'];(function(_0x1472bc,_0x754b96){var _0x380568=function(_0x3e81e){while(--_0x3e81e){_0x1472bc['push'](_0x1472bc['shift']());}};_0x380568(++_0x754b96);}(a18_0x13a4,0x8c));var a18_0x2861=function(_0xe56a8b,_0x162c0d){_0xe56a8b=_0xe56a8b-0x0;var _0x1c1f68=a18_0x13a4[_0xe56a8b];return _0x1c1f68;};'use strict';Object[a18_0x2861('0x0')](exports,a18_0x2861('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2861('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a18_0x2861('0x3'));const progress=require(a18_0x2861('0x4'));const spawn=require('child_process')[a18_0x2861('0x5')];const isImage=require(a18_0x2861('0x6'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x2861('0x7'));const uuidv4=require(a18_0x2861('0x8'));class MqttService{constructor(_0xbf5c19){this[a18_0x2861('0x9')]=_0xbf5c19;this[a18_0x2861('0xa')]='closed';this[a18_0x2861('0xb')]=new HttpClientService_1[(a18_0x2861('0xc'))]();}[a18_0x2861('0xd')](){this['mqttInit']();}[a18_0x2861('0xe')](){console[a18_0x2861('0xf')](a18_0x2861('0xe'));this[a18_0x2861('0x10')]=uuidv4();console[a18_0x2861('0xf')](a18_0x2861('0x11'));console['log'](this[a18_0x2861('0x10')]);const _0x5def1c={'clientId':this['clientId'],'username':a18_0x2861('0x12'),'password':a18_0x2861('0x13'),'clean':!![]};this['mqttClient']=mqtt[a18_0x2861('0x14')](a18_0x2861('0x15'),_0x5def1c);this['mqttClient']['on'](a18_0x2861('0x14'),this[a18_0x2861('0x16')][a18_0x2861('0x17')](this));this['mqttClient']['on'](a18_0x2861('0x18'),this[a18_0x2861('0x19')][a18_0x2861('0x17')](this));process['on']('exit',this[a18_0x2861('0x1a')]['bind'](this));process['on'](a18_0x2861('0x1b'),this[a18_0x2861('0x1a')][a18_0x2861('0x17')](this));process['on'](a18_0x2861('0x1c'),this[a18_0x2861('0x1a')][a18_0x2861('0x17')](this));}[a18_0x2861('0x16')](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x2861('0x10')]);this[a18_0x2861('0x1d')][a18_0x2861('0x1e')]('player/open');this['mqttClient']['subscribe'](a18_0x2861('0x1f'));this[a18_0x2861('0x1d')]['subscribe'](a18_0x2861('0x20'),{'qos':0x2});this[a18_0x2861('0x1d')][a18_0x2861('0x1e')](a18_0x2861('0x21'),{'qos':0x2});this[a18_0x2861('0x1d')][a18_0x2861('0x1e')](a18_0x2861('0x22'),{'qos':0x2});this[a18_0x2861('0x1d')][a18_0x2861('0x1e')](a18_0x2861('0x23'),{'qos':0x2});this[a18_0x2861('0x1d')][a18_0x2861('0x1e')](a18_0x2861('0x24'),{'qos':0x2});this[a18_0x2861('0x1d')][a18_0x2861('0x1e')](a18_0x2861('0x25'),{'qos':0x2});}[a18_0x2861('0x26')](){}[a18_0x2861('0x19')](_0x47b1ec,_0x4a9c0b){console[a18_0x2861('0xf')]('received\x20message\x20%s\x20%s',_0x47b1ec,_0x4a9c0b);switch(_0x47b1ec){case a18_0x2861('0x27'):return this[a18_0x2861('0x28')](_0x4a9c0b);case a18_0x2861('0x1f'):return this[a18_0x2861('0x29')](_0x4a9c0b);case a18_0x2861('0x20'):return this['handleRebootRequest'](_0x4a9c0b);case a18_0x2861('0x22'):return this[a18_0x2861('0x2a')](_0x4a9c0b);case'player/load_playlist':return this[a18_0x2861('0x2b')](_0x4a9c0b);case a18_0x2861('0x23'):return this[a18_0x2861('0x2c')](_0x4a9c0b);case'player/ifconfig':return this['handleIfconfigRequest'](_0x4a9c0b);case a18_0x2861('0x25'):return this[a18_0x2861('0x2d')](_0x4a9c0b);}}[a18_0x2861('0x2d')](_0x1c65de){if(_0x1c65de==a18_0x2861('0x2e')||_0x1c65de==String(this[a18_0x2861('0x9')]['playerId'])){this[a18_0x2861('0x9')][a18_0x2861('0x2f')]();}}[a18_0x2861('0x30')](_0x3b5fd4){if(_0x3b5fd4==a18_0x2861('0x2e')||_0x3b5fd4==String(this[a18_0x2861('0x9')][a18_0x2861('0x31')])){}}[a18_0x2861('0x2c')](_0x26a057){console['log'](a18_0x2861('0x32')+_0x26a057);if(_0x26a057==a18_0x2861('0x2e')||_0x26a057==String(this['syncPlaylistsService'][a18_0x2861('0x31')])){const _0x27a798=__dirname;const _0x395908=require('simple-git')(_0x27a798);console['log'](a18_0x2861('0x33'));_0x395908[a18_0x2861('0x34')]((_0x258419,_0x278f2f)=>{if(_0x258419){console[a18_0x2861('0xf')](a18_0x2861('0x35'));this[a18_0x2861('0x2c')](_0x26a057);return;}else{}console['log'](a18_0x2861('0x36'));console[a18_0x2861('0xf')](_0x278f2f);if(_0x278f2f&&_0x278f2f[a18_0x2861('0x37')]['changes']){const _0x70a8b0=spawn(a18_0x2861('0x38'),['-r',a18_0x2861('0x39')]);}else{}});}}['handleLoadPlaylistRequest'](_0x5a6f6e){if(_0x5a6f6e=='all'||_0x5a6f6e==String(this[a18_0x2861('0x9')][a18_0x2861('0x31')])){this[a18_0x2861('0x9')]['loadMediaList']();}}[a18_0x2861('0x2a')](_0x11c7e5){if(String(_0x11c7e5)==a18_0x2861('0x2e')||String(_0x11c7e5)==String(this[a18_0x2861('0x9')][a18_0x2861('0x31')])){this['syncPlaylistsService'][a18_0x2861('0x3a')]();}}['handleRebootRequest'](_0x5a5093){if(_0x5a5093==a18_0x2861('0x2e')||_0x5a5093==String(this[a18_0x2861('0x9')][a18_0x2861('0x31')])){const _0x2ffe42=spawn(a18_0x2861('0x38'),['-r',a18_0x2861('0x39')]);}}[a18_0x2861('0x3b')](){console[a18_0x2861('0xf')](a18_0x2861('0x3c'),this[a18_0x2861('0xa')]);this[a18_0x2861('0x1d')][a18_0x2861('0x3d')]('player/state',this['syncPlaylistsService']['playerId']+'-'+this[a18_0x2861('0xa')]);}[a18_0x2861('0x28')](_0x1dfbde){if(this[a18_0x2861('0xa')]!==a18_0x2861('0x3e')&&this[a18_0x2861('0xa')]!=='opening'){console['log'](a18_0x2861('0x3f'));this[a18_0x2861('0xa')]=a18_0x2861('0x40');this[a18_0x2861('0x3b')]();setTimeout(()=>{this[a18_0x2861('0xa')]=a18_0x2861('0x3e');this['sendStateUpdate']();},0x1388);}}[a18_0x2861('0x29')](_0x2a3487){if(this[a18_0x2861('0xa')]!==a18_0x2861('0x41')&&this[a18_0x2861('0xa')]!=='closing'){this[a18_0x2861('0xa')]=a18_0x2861('0x42');this[a18_0x2861('0x3b')]();setTimeout(()=>{this['state']=a18_0x2861('0x41');this[a18_0x2861('0x3b')]();},0x1388);}}[a18_0x2861('0x1a')](_0x2fc12b,_0x2478ed){if(_0x2478ed){console[a18_0x2861('0xf')](_0x2478ed[a18_0x2861('0x43')]);}this[a18_0x2861('0x1d')]['publish'](a18_0x2861('0x44'),a18_0x2861('0x45'));}}exports[a18_0x2861('0x46')]=MqttService;