var a20_0x4758=['player/connected','false','readFileSync','sign','MqttService','request','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','/locations/','/registries/','unused','createJwt','TLSv1_2_method','round','now','connect','subscribe','/devices/','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish','publish\x20result:','close','error','message','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','this.clientId','clientId','run.lulo_2018#.','mqttClient','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','uncaughtException','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','player/close','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleIfconfigRequest','handleTurnOnTVRequest','handleRegisterRequest','all','playerId','syncPlaylistsService','handleUpdateRequest','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','handleTurnOffTVRequest','handleTurnOffTVRequest:\x20','turnOffTV','sending\x20state\x20%s','player/state','handleOpenRequest','opening\x20player\x20door','opening','open','sendStateUpdate','closing'];(function(_0x217dac,_0x277438){var _0x212061=function(_0x38de5d){while(--_0x38de5d){_0x217dac['push'](_0x217dac['shift']());}};_0x212061(++_0x277438);}(a20_0x4758,0x75));var a20_0xe2f3=function(_0x44c879,_0x106d9f){_0x44c879=_0x44c879-0x0;var _0xc93408=a20_0x4758[_0x44c879];return _0xc93408;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require(a20_0xe2f3('0x0'));const progress=require(a20_0xe2f3('0x1'));const spawn=require(a20_0xe2f3('0x2'))[a20_0xe2f3('0x3')];const exec=require(a20_0xe2f3('0x2'))[a20_0xe2f3('0x4')];const isImage=require(a20_0xe2f3('0x5'));const format=require(a20_0xe2f3('0x6'));const os=require('os');const mqtt=require(a20_0xe2f3('0x7'));const uuidv4=require('uuid/v4');const jwt=require('jsonwebtoken');class MqttService{constructor(_0x5ab2ee){this['syncPlaylistsService']=_0x5ab2ee;this[a20_0xe2f3('0x8')]=a20_0xe2f3('0x9');this[a20_0xe2f3('0xa')]=new HttpClientService_1['HttpClientService']();}[a20_0xe2f3('0xb')](){this[a20_0xe2f3('0xc')]();}['mqttInit_google'](){console['log'](a20_0xe2f3('0xd'));const _0xc70d24=a20_0xe2f3('0xe');const _0x4f1862=a20_0xe2f3('0xf');const _0x4e8800=a20_0xe2f3('0x10');const _0x384b9f=a20_0xe2f3('0x11');const _0x3f7a12=a20_0xe2f3('0x12');const _0x143880=a20_0xe2f3('0x13');const _0x453b8c='mqtt.googleapis.com';const _0x25e04a=0x1bb;const _0x1fbc5e='events';const _0x128159=0x5;const _0x24c5f1='projects/'+_0xc70d24+a20_0xe2f3('0x14')+_0x384b9f+a20_0xe2f3('0x15')+_0x4e8800+'/devices/'+_0x4f1862;const _0x33254b={'host':_0x453b8c,'port':_0x25e04a,'clientId':_0x24c5f1,'username':a20_0xe2f3('0x16'),'password':this[a20_0xe2f3('0x17')](_0xc70d24,_0x143880,_0x3f7a12),'protocol':'mqtts','secureProtocol':a20_0xe2f3('0x18')};const _0xb2e210=Math[a20_0xe2f3('0x19')](Date[a20_0xe2f3('0x1a')]()/0x3e8);const _0x242d9a=mqtt[a20_0xe2f3('0x1b')](_0x33254b);_0x242d9a[a20_0xe2f3('0x1c')](a20_0xe2f3('0x1d')+_0x4f1862+'/config',{'qos':0x1});_0x242d9a['subscribe'](a20_0xe2f3('0x1d')+_0x4f1862+'/state',{'qos':0x1});_0x242d9a[a20_0xe2f3('0x1c')]('/devices/'+_0x4f1862+'/commands/#',{'qos':0x0});const _0x34d36e=a20_0xe2f3('0x1d')+_0x4f1862+'/'+_0x1fbc5e;_0x242d9a['on'](a20_0xe2f3('0x1b'),_0x708850=>{console['log'](a20_0xe2f3('0x1b'));if(!_0x708850){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x1f'));}else{const _0x34d36e=a20_0xe2f3('0x20');const _0x4a6b5e=_0x4e8800+'/'+_0x4f1862+'-payload-0';_0x242d9a[a20_0xe2f3('0x21')](_0x34d36e,_0x4a6b5e,{'qos':0x1},_0x135b3e=>{console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x22'));console[a20_0xe2f3('0x1e')](_0x135b3e);if(!_0x135b3e){}});}});_0x242d9a['on'](a20_0xe2f3('0x23'),()=>{console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x23'));});_0x242d9a['on'](a20_0xe2f3('0x24'),_0x272ba2=>{console[a20_0xe2f3('0x1e')]('error',_0x272ba2);});_0x242d9a['on'](a20_0xe2f3('0x25'),(_0x333474,_0x1ad12d)=>{let _0x15ed7e=a20_0xe2f3('0x26');console[a20_0xe2f3('0x1e')](_0x333474);console['log'](_0x1ad12d+'');if(_0x333474===a20_0xe2f3('0x1d')+_0x4f1862+a20_0xe2f3('0x27')){_0x15ed7e=a20_0xe2f3('0x28');}else if(_0x333474[a20_0xe2f3('0x29')](a20_0xe2f3('0x1d')+_0x4f1862+a20_0xe2f3('0x2a'))){_0x15ed7e=a20_0xe2f3('0x2b');}_0x15ed7e+=Buffer[a20_0xe2f3('0x2c')](_0x1ad12d,a20_0xe2f3('0x2d'))[a20_0xe2f3('0x2e')](a20_0xe2f3('0x2f'));console['log'](_0x15ed7e);});_0x242d9a['on'](a20_0xe2f3('0x30'),()=>{});console[a20_0xe2f3('0x1e')](_0x33254b);}['mqttInit_mosquitto'](){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0xd'));this['clientId']=uuidv4();console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x31'));console[a20_0xe2f3('0x1e')](this[a20_0xe2f3('0x32')]);const _0x5e9122={'clientId':this['clientId'],'username':'lulo_mqtt','password':a20_0xe2f3('0x33'),'clean':!![]};this[a20_0xe2f3('0x34')]=mqtt[a20_0xe2f3('0x1b')]('mqtt://lulo.run',_0x5e9122);this['mqttClient']['on'](a20_0xe2f3('0x1b'),this[a20_0xe2f3('0x35')][a20_0xe2f3('0x36')](this));this[a20_0xe2f3('0x34')]['on']('message',this[a20_0xe2f3('0x37')][a20_0xe2f3('0x36')](this));this[a20_0xe2f3('0x34')]['on'](a20_0xe2f3('0x23'),()=>{console['log'](a20_0xe2f3('0x23'));});process['on'](a20_0xe2f3('0x38'),this[a20_0xe2f3('0x39')][a20_0xe2f3('0x36')](this));process['on']('SIGINT',this[a20_0xe2f3('0x39')][a20_0xe2f3('0x36')](this));process['on'](a20_0xe2f3('0x3a'),this[a20_0xe2f3('0x39')][a20_0xe2f3('0x36')](this));}['mqttClient_connect'](){console[a20_0xe2f3('0x1e')]('Connected\x20to\x20broker\x20client:'+this[a20_0xe2f3('0x32')]);this['mqttClient'][a20_0xe2f3('0x1c')](a20_0xe2f3('0x3b'));this['mqttClient'][a20_0xe2f3('0x1c')]('player/close');this[a20_0xe2f3('0x34')]['subscribe'](a20_0xe2f3('0x3c'),{'qos':0x2});this[a20_0xe2f3('0x34')][a20_0xe2f3('0x1c')](a20_0xe2f3('0x3d'),{'qos':0x2});this[a20_0xe2f3('0x34')][a20_0xe2f3('0x1c')](a20_0xe2f3('0x3e'),{'qos':0x2});this['mqttClient']['subscribe']('player/update',{'qos':0x2});this[a20_0xe2f3('0x34')][a20_0xe2f3('0x1c')]('player/ifconfig',{'qos':0x2});this[a20_0xe2f3('0x34')]['subscribe'](a20_0xe2f3('0x3f'),{'qos':0x2});this[a20_0xe2f3('0x34')]['subscribe'](a20_0xe2f3('0x40'),{'qos':0x2});this[a20_0xe2f3('0x34')][a20_0xe2f3('0x1c')](a20_0xe2f3('0x41'),{'qos':0x2});this[a20_0xe2f3('0x34')][a20_0xe2f3('0x1c')](a20_0xe2f3('0x42'),{'qos':0x2});}[a20_0xe2f3('0x43')](){}[a20_0xe2f3('0x37')](_0x2551d2,_0x508e75){console[a20_0xe2f3('0x1e')]('received\x20message\x20%s\x20%s',_0x2551d2,_0x508e75);switch(_0x2551d2){case a20_0xe2f3('0x3b'):return this['handleOpenRequest'](_0x508e75);case a20_0xe2f3('0x44'):return this[a20_0xe2f3('0x45')](_0x508e75);case a20_0xe2f3('0x3c'):return this[a20_0xe2f3('0x46')](_0x508e75);case a20_0xe2f3('0x3e'):return this[a20_0xe2f3('0x47')](_0x508e75);case a20_0xe2f3('0x3d'):return this[a20_0xe2f3('0x48')](_0x508e75);case a20_0xe2f3('0x49'):return this['handleUpdateRequest'](_0x508e75);case'player/ifconfig':return this[a20_0xe2f3('0x4a')](_0x508e75);case a20_0xe2f3('0x3f'):return this['handleRegisterRequest'](_0x508e75);case a20_0xe2f3('0x40'):return this['handleUpdateSettingsRequest'](_0x508e75);case a20_0xe2f3('0x41'):return this['handleTurnOffTVRequest'](_0x508e75);case a20_0xe2f3('0x42'):return this[a20_0xe2f3('0x4b')](_0x508e75);}}[a20_0xe2f3('0x4c')](_0x1e9ec5){if(_0x1e9ec5==a20_0xe2f3('0x4d')||_0x1e9ec5==String(this['syncPlaylistsService'][a20_0xe2f3('0x4e')])){this[a20_0xe2f3('0x4f')]['registerClient']();}}[a20_0xe2f3('0x4a')](_0x1e0a16){if(_0x1e0a16==a20_0xe2f3('0x4d')||_0x1e0a16==String(this['syncPlaylistsService']['playerId'])){}}[a20_0xe2f3('0x50')](_0x453f89){console[a20_0xe2f3('0x1e')]('handleUpdateRequest:\x20'+_0x453f89);if(_0x453f89==a20_0xe2f3('0x4d')||_0x453f89==String(this['syncPlaylistsService'][a20_0xe2f3('0x4e')])){const _0x21b491=__dirname;const _0xfb4f0a=require('simple-git')(_0x21b491);console['log'](a20_0xe2f3('0x51'));_0xfb4f0a[a20_0xe2f3('0x52')]((_0x1c6d72,_0x21dda7)=>{if(_0x1c6d72){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x53'));this['handleUpdateRequest'](_0x453f89);return;}else{}console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x54'));console[a20_0xe2f3('0x1e')](_0x21dda7);if(_0x21dda7&&_0x21dda7[a20_0xe2f3('0x55')][a20_0xe2f3('0x56')]){this[a20_0xe2f3('0x4f')]['reboot']();}else{}});}}['handleLoadPlaylistRequest'](_0x3a501d){if(_0x3a501d==a20_0xe2f3('0x4d')||_0x3a501d==String(this[a20_0xe2f3('0x4f')]['playerId'])){this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x57')]();}}[a20_0xe2f3('0x47')](_0x53421e){if(String(_0x53421e)==a20_0xe2f3('0x4d')||String(_0x53421e)==String(this['syncPlaylistsService'][a20_0xe2f3('0x4e')])){this['syncPlaylistsService'][a20_0xe2f3('0x58')]();}}['handleRebootRequest'](_0x1940ec){if(_0x1940ec==a20_0xe2f3('0x4d')||_0x1940ec==String(this[a20_0xe2f3('0x4f')]['playerId'])){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x59'));try{this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x5a')]();}catch(_0x424a1e){console[a20_0xe2f3('0x1e')](_0x424a1e);}}}[a20_0xe2f3('0x5b')](_0x188231){if(_0x188231==a20_0xe2f3('0x4d')||_0x188231==String(this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x4e')])){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x5c'));try{this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x5d')]();}catch(_0x41fc68){console['log'](_0x41fc68);}}}[a20_0xe2f3('0x4b')](_0x339f9a){if(_0x339f9a==a20_0xe2f3('0x4d')||_0x339f9a==String(this[a20_0xe2f3('0x4f')]['playerId'])){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x5e'));try{this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x5f')]();}catch(_0x227aba){console['log'](_0x227aba);}}}[a20_0xe2f3('0x60')](_0x21ff1c){if(_0x21ff1c==a20_0xe2f3('0x4d')||_0x21ff1c==String(this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x4e')])){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x61'));try{this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x62')]();}catch(_0x566cb4){console['log'](_0x566cb4);}}}['sendStateUpdate'](){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x63'),this[a20_0xe2f3('0x8')]);this[a20_0xe2f3('0x34')][a20_0xe2f3('0x21')](a20_0xe2f3('0x64'),this[a20_0xe2f3('0x4f')][a20_0xe2f3('0x4e')]+'-'+this[a20_0xe2f3('0x8')]);}[a20_0xe2f3('0x65')](_0x5949d8){if(this[a20_0xe2f3('0x8')]!=='open'&&this[a20_0xe2f3('0x8')]!=='opening'){console[a20_0xe2f3('0x1e')](a20_0xe2f3('0x66'));this[a20_0xe2f3('0x8')]=a20_0xe2f3('0x67');this['sendStateUpdate']();setTimeout(()=>{this[a20_0xe2f3('0x8')]=a20_0xe2f3('0x68');this[a20_0xe2f3('0x69')]();},0x1388);}}['handleCloseRequest'](_0xc459fd){if(this[a20_0xe2f3('0x8')]!=='closed'&&this['state']!==a20_0xe2f3('0x6a')){this[a20_0xe2f3('0x8')]=a20_0xe2f3('0x6a');this[a20_0xe2f3('0x69')]();setTimeout(()=>{this[a20_0xe2f3('0x8')]=a20_0xe2f3('0x9');this['sendStateUpdate']();},0x1388);}}[a20_0xe2f3('0x39')](_0x2c39c6,_0x5ba47d){if(_0x5ba47d){console['log'](_0x5ba47d['stack']);}this[a20_0xe2f3('0x34')][a20_0xe2f3('0x21')](a20_0xe2f3('0x6b'),a20_0xe2f3('0x6c'));}[a20_0xe2f3('0x17')](_0x323e17,_0x26d1f6,_0xe61d13){const _0x5bf732={'iat':Math['round'](Date[a20_0xe2f3('0x1a')]()/0x3e8),'exp':Math[a20_0xe2f3('0x19')](Date[a20_0xe2f3('0x1a')]()/0x3e8)+0x14*0x3c,'aud':_0x323e17};const _0x3237fe=fs[a20_0xe2f3('0x6d')](_0x26d1f6);return jwt[a20_0xe2f3('0x6e')](_0x5bf732,_0x3237fe,{'algorithm':_0xe61d13});}}exports[a20_0xe2f3('0x6f')]=MqttService;