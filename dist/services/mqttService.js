var a20_0x4caf=['/state','/commands/#','connect','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','toString','ascii','clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','subscribe','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/update_settings','player/turn_off_tv','reportStatus','mqttClient_message','handleOpenRequest','player/close','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','player/ifconfig','handleIfconfigRequest','player/register','handleRegisterRequest','all','registerClient','handleUpdateRequest:\x20','playerId','simple-git','pull','Git\x20updated','summary','reboot','loadMediaList','reloadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest','handleTurnOnTVRequest:\x20','handleTurnOffTVRequest','turnOffTV','sendStateUpdate','open','opening','opening\x20player\x20door','closing','false','now','readFileSync','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','/config'];(function(_0x1137fd,_0x20b3b5){var _0x4d4056=function(_0x265a49){while(--_0x265a49){_0x1137fd['push'](_0x1137fd['shift']());}};_0x4d4056(++_0x20b3b5);}(a20_0x4caf,0x1aa));var a20_0x4eea=function(_0x197bc3,_0xc39c04){_0x197bc3=_0x197bc3-0x0;var _0x4778dd=a20_0x4caf[_0x197bc3];return _0x4778dd;};'use strict';Object[a20_0x4eea('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a20_0x4eea('0x1'));const fs=require('fs');const fsExtra=require(a20_0x4eea('0x2'));const request=require(a20_0x4eea('0x3'));const progress=require('request-progress');const spawn=require(a20_0x4eea('0x4'))[a20_0x4eea('0x5')];const exec=require(a20_0x4eea('0x4'))[a20_0x4eea('0x6')];const isImage=require(a20_0x4eea('0x7'));const format=require(a20_0x4eea('0x8'));const os=require('os');const mqtt=require(a20_0x4eea('0x9'));const uuidv4=require(a20_0x4eea('0xa'));const jwt=require(a20_0x4eea('0xb'));class MqttService{constructor(_0xc65e1c){this[a20_0x4eea('0xc')]=_0xc65e1c;this[a20_0x4eea('0xd')]=a20_0x4eea('0xe');this[a20_0x4eea('0xf')]=new HttpClientService_1[(a20_0x4eea('0x10'))]();}[a20_0x4eea('0x11')](){this[a20_0x4eea('0x12')]();}[a20_0x4eea('0x13')](){console[a20_0x4eea('0x14')](a20_0x4eea('0x15'));const _0x55b886=a20_0x4eea('0x16');const _0x1233e8=a20_0x4eea('0x17');const _0x187c2a=a20_0x4eea('0x18');const _0x5e6845='us-central1';const _0x255f99=a20_0x4eea('0x19');const _0x4adbbd=a20_0x4eea('0x1a');const _0x29824a=a20_0x4eea('0x1b');const _0x26202b=0x1bb;const _0x385b5c=a20_0x4eea('0x1c');const _0x112fd1=0x5;const _0xe5a8c4=a20_0x4eea('0x1d')+_0x55b886+'/locations/'+_0x5e6845+a20_0x4eea('0x1e')+_0x187c2a+a20_0x4eea('0x1f')+_0x1233e8;const _0x37a1e9={'host':_0x29824a,'port':_0x26202b,'clientId':_0xe5a8c4,'username':a20_0x4eea('0x20'),'password':this[a20_0x4eea('0x21')](_0x55b886,_0x4adbbd,_0x255f99),'protocol':a20_0x4eea('0x22'),'secureProtocol':a20_0x4eea('0x23')};const _0x2efddf=Math[a20_0x4eea('0x24')](Date['now']()/0x3e8);const _0x185dc2=mqtt['connect'](_0x37a1e9);_0x185dc2['subscribe']('/devices/'+_0x1233e8+a20_0x4eea('0x25'),{'qos':0x1});_0x185dc2['subscribe'](a20_0x4eea('0x1f')+_0x1233e8+a20_0x4eea('0x26'),{'qos':0x1});_0x185dc2['subscribe']('/devices/'+_0x1233e8+a20_0x4eea('0x27'),{'qos':0x0});const _0x16c2b7=a20_0x4eea('0x1f')+_0x1233e8+'/'+_0x385b5c;_0x185dc2['on'](a20_0x4eea('0x28'),_0x4e1b17=>{console[a20_0x4eea('0x14')]('connect');if(!_0x4e1b17){console[a20_0x4eea('0x14')](a20_0x4eea('0x29'));}else{const _0x16c2b7=a20_0x4eea('0x2a');const _0x4b0099=_0x187c2a+'/'+_0x1233e8+a20_0x4eea('0x2b');_0x185dc2[a20_0x4eea('0x2c')](_0x16c2b7,_0x4b0099,{'qos':0x1},_0x4f5b4d=>{console[a20_0x4eea('0x14')](a20_0x4eea('0x2d'));console[a20_0x4eea('0x14')](_0x4f5b4d);if(!_0x4f5b4d){}});}});_0x185dc2['on'](a20_0x4eea('0x2e'),()=>{console['log'](a20_0x4eea('0x2e'));});_0x185dc2['on'](a20_0x4eea('0x2f'),_0x488fe4=>{console['log'](a20_0x4eea('0x2f'),_0x488fe4);});_0x185dc2['on'](a20_0x4eea('0x30'),(_0x4fdbc3,_0x5a8649)=>{let _0x24502f=a20_0x4eea('0x31');console['log'](_0x4fdbc3);console[a20_0x4eea('0x14')](_0x5a8649+'');if(_0x4fdbc3==='/devices/'+_0x1233e8+'/config'){_0x24502f=a20_0x4eea('0x32');}else if(_0x4fdbc3[a20_0x4eea('0x33')](a20_0x4eea('0x1f')+_0x1233e8+a20_0x4eea('0x34'))){_0x24502f=a20_0x4eea('0x35');}_0x24502f+=Buffer['from'](_0x5a8649,'base64')[a20_0x4eea('0x36')](a20_0x4eea('0x37'));console['log'](_0x24502f);});_0x185dc2['on']('packetsend',()=>{});console[a20_0x4eea('0x14')](_0x37a1e9);}[a20_0x4eea('0x12')](){console[a20_0x4eea('0x14')](a20_0x4eea('0x15'));this[a20_0x4eea('0x38')]=uuidv4();console[a20_0x4eea('0x14')]('this.clientId');console['log'](this['clientId']);const _0x266da3={'clientId':this[a20_0x4eea('0x38')],'username':'lulo_mqtt','password':a20_0x4eea('0x39'),'clean':!![]};this[a20_0x4eea('0x3a')]=mqtt[a20_0x4eea('0x28')](a20_0x4eea('0x3b'),_0x266da3);this[a20_0x4eea('0x3a')]['on'](a20_0x4eea('0x28'),this['mqttClient_connect'][a20_0x4eea('0x3c')](this));this[a20_0x4eea('0x3a')]['on']('message',this['mqttClient_message']['bind'](this));this['mqttClient']['on'](a20_0x4eea('0x2e'),()=>{console[a20_0x4eea('0x14')](a20_0x4eea('0x2e'));});process['on'](a20_0x4eea('0x3d'),this[a20_0x4eea('0x3e')][a20_0x4eea('0x3c')](this));process['on'](a20_0x4eea('0x3f'),this[a20_0x4eea('0x3e')][a20_0x4eea('0x3c')](this));process['on'](a20_0x4eea('0x40'),this[a20_0x4eea('0x3e')][a20_0x4eea('0x3c')](this));}[a20_0x4eea('0x41')](){console[a20_0x4eea('0x14')](a20_0x4eea('0x42')+this[a20_0x4eea('0x38')]);this[a20_0x4eea('0x3a')]['subscribe'](a20_0x4eea('0x43'));this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')]('player/close');this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x45'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x46'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x47'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x48'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')]('player/ifconfig',{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')]('player/register',{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x49'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')](a20_0x4eea('0x4a'),{'qos':0x2});this[a20_0x4eea('0x3a')][a20_0x4eea('0x44')]('player/turn_on_tv',{'qos':0x2});}[a20_0x4eea('0x4b')](){}[a20_0x4eea('0x4c')](_0x5cf4b7,_0x305be6){console[a20_0x4eea('0x14')]('received\x20message\x20%s\x20%s',_0x5cf4b7,_0x305be6);switch(_0x5cf4b7){case a20_0x4eea('0x43'):return this[a20_0x4eea('0x4d')](_0x305be6);case a20_0x4eea('0x4e'):return this[a20_0x4eea('0x4f')](_0x305be6);case a20_0x4eea('0x45'):return this['handleRebootRequest'](_0x305be6);case a20_0x4eea('0x47'):return this[a20_0x4eea('0x50')](_0x305be6);case'player/load_playlist':return this[a20_0x4eea('0x51')](_0x305be6);case a20_0x4eea('0x48'):return this[a20_0x4eea('0x52')](_0x305be6);case a20_0x4eea('0x53'):return this[a20_0x4eea('0x54')](_0x305be6);case a20_0x4eea('0x55'):return this[a20_0x4eea('0x56')](_0x305be6);case a20_0x4eea('0x49'):return this['handleUpdateSettingsRequest'](_0x305be6);case a20_0x4eea('0x4a'):return this['handleTurnOffTVRequest'](_0x305be6);case'player/turn_on_tv':return this['handleTurnOnTVRequest'](_0x305be6);}}[a20_0x4eea('0x56')](_0x1b5fb2){if(_0x1b5fb2==a20_0x4eea('0x57')||_0x1b5fb2==String(this[a20_0x4eea('0xc')]['playerId'])){this['syncPlaylistsService'][a20_0x4eea('0x58')]();}}[a20_0x4eea('0x54')](_0x3a6a80){if(_0x3a6a80==a20_0x4eea('0x57')||_0x3a6a80==String(this[a20_0x4eea('0xc')]['playerId'])){}}[a20_0x4eea('0x52')](_0xb3baee){console[a20_0x4eea('0x14')](a20_0x4eea('0x59')+_0xb3baee);if(_0xb3baee==a20_0x4eea('0x57')||_0xb3baee==String(this[a20_0x4eea('0xc')][a20_0x4eea('0x5a')])){const _0x207872=__dirname;const _0x193ada=require(a20_0x4eea('0x5b'))(_0x207872);console[a20_0x4eea('0x14')]('Git\x20updating');_0x193ada[a20_0x4eea('0x5c')]((_0x2fff6d,_0x4d0611)=>{if(_0x2fff6d){console[a20_0x4eea('0x14')]('Error\x20git\x20updated');this['handleUpdateRequest'](_0xb3baee);return;}else{}console[a20_0x4eea('0x14')](a20_0x4eea('0x5d'));console[a20_0x4eea('0x14')](_0x4d0611);if(_0x4d0611&&_0x4d0611[a20_0x4eea('0x5e')]['changes']){this['syncPlaylistsService'][a20_0x4eea('0x5f')]();}else{}});}}[a20_0x4eea('0x51')](_0x11c84d){if(_0x11c84d=='all'||_0x11c84d==String(this[a20_0x4eea('0xc')][a20_0x4eea('0x5a')])){this['syncPlaylistsService'][a20_0x4eea('0x60')]();}}['handleReloadPlaylistRequest'](_0x4de22d){if(String(_0x4de22d)==a20_0x4eea('0x57')||String(_0x4de22d)==String(this[a20_0x4eea('0xc')]['playerId'])){this[a20_0x4eea('0xc')][a20_0x4eea('0x61')]();}}[a20_0x4eea('0x62')](_0x1fb6ee){if(_0x1fb6ee==a20_0x4eea('0x57')||_0x1fb6ee==String(this[a20_0x4eea('0xc')][a20_0x4eea('0x5a')])){console['log'](a20_0x4eea('0x63'));try{this[a20_0x4eea('0xc')][a20_0x4eea('0x5f')]();}catch(_0x30603d){console[a20_0x4eea('0x14')](_0x30603d);}}}[a20_0x4eea('0x64')](_0x12f725){if(_0x12f725==a20_0x4eea('0x57')||_0x12f725==String(this[a20_0x4eea('0xc')][a20_0x4eea('0x5a')])){console[a20_0x4eea('0x14')](a20_0x4eea('0x65'));try{this[a20_0x4eea('0xc')][a20_0x4eea('0x66')]();}catch(_0x5ea2c6){console['log'](_0x5ea2c6);}}}[a20_0x4eea('0x67')](_0x4c92af){if(_0x4c92af==a20_0x4eea('0x57')||_0x4c92af==String(this[a20_0x4eea('0xc')]['playerId'])){console[a20_0x4eea('0x14')](a20_0x4eea('0x68'));try{this['syncPlaylistsService']['turnOnTV']();}catch(_0x1c4568){console[a20_0x4eea('0x14')](_0x1c4568);}}}[a20_0x4eea('0x69')](_0x213814){if(_0x213814==a20_0x4eea('0x57')||_0x213814==String(this[a20_0x4eea('0xc')]['playerId'])){console[a20_0x4eea('0x14')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a20_0x4eea('0x6a')]();}catch(_0x172bdf){console[a20_0x4eea('0x14')](_0x172bdf);}}}[a20_0x4eea('0x6b')](){console[a20_0x4eea('0x14')]('sending\x20state\x20%s',this[a20_0x4eea('0xd')]);this['mqttClient'][a20_0x4eea('0x2c')]('player/state',this[a20_0x4eea('0xc')][a20_0x4eea('0x5a')]+'-'+this[a20_0x4eea('0xd')]);}[a20_0x4eea('0x4d')](_0x5b8583){if(this[a20_0x4eea('0xd')]!==a20_0x4eea('0x6c')&&this['state']!==a20_0x4eea('0x6d')){console[a20_0x4eea('0x14')](a20_0x4eea('0x6e'));this['state']=a20_0x4eea('0x6d');this[a20_0x4eea('0x6b')]();setTimeout(()=>{this[a20_0x4eea('0xd')]='open';this['sendStateUpdate']();},0x1388);}}[a20_0x4eea('0x4f')](_0x2b6766){if(this[a20_0x4eea('0xd')]!==a20_0x4eea('0xe')&&this['state']!=='closing'){this['state']=a20_0x4eea('0x6f');this[a20_0x4eea('0x6b')]();setTimeout(()=>{this['state']='closed';this[a20_0x4eea('0x6b')]();},0x1388);}}[a20_0x4eea('0x3e')](_0x5a4cff,_0x1096f0){if(_0x1096f0){console[a20_0x4eea('0x14')](_0x1096f0['stack']);}this[a20_0x4eea('0x3a')][a20_0x4eea('0x2c')]('player/connected',a20_0x4eea('0x70'));}[a20_0x4eea('0x21')](_0x394e8f,_0x323d48,_0x3ad574){const _0x4a0fbb={'iat':Math[a20_0x4eea('0x24')](Date[a20_0x4eea('0x71')]()/0x3e8),'exp':Math['round'](Date[a20_0x4eea('0x71')]()/0x3e8)+0x14*0x3c,'aud':_0x394e8f};const _0x22ab0d=fs[a20_0x4eea('0x72')](_0x323d48);return jwt['sign'](_0x4a0fbb,_0x22ab0d,{'algorithm':_0x3ad574});}}exports[a20_0x4eea('0x73')]=MqttService;