var a20_0x422e=['handleUpdateSettingsRequest:\x20','updateSettings','handleTurnOnTVRequest:\x20','turnOnTV','turnOffTV','sendStateUpdate','sending\x20state\x20%s','state','player/state','open','opening','opening\x20player\x20door','handleCloseRequest','closed','closing','player/connected','false','readFileSync','sign','defineProperty','fs-extra','request-progress','child_process','exec','is-image','string-template','uuid/v4','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-registry','resources/keys/rsa_private.pem','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','subscribe','/commands/#','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','/config','startsWith','Command\x20message\x20received:\x20','from','toString','ascii','packetsend','clientId','this.clientId','run.lulo_2018#.','mqttClient','mqtt://lulo.run','connect','bind','exit','handleAppExit','SIGINT','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/reload_playlist','player/ifconfig','player/register','player/update_settings','player/turn_off_tv','player/turn_on_tv','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleRebootRequest','player/load_playlist','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleTurnOnTVRequest','all','playerId','syncPlaylistsService','handleUpdateRequest:\x20','Git\x20updating','Error\x20git\x20updated','Git\x20updated','summary','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','reboot'];(function(_0x44c2f4,_0x419569){var _0x480c3c=function(_0x2c5b23){while(--_0x2c5b23){_0x44c2f4['push'](_0x44c2f4['shift']());}};_0x480c3c(++_0x419569);}(a20_0x422e,0x1d3));var a20_0x42d8=function(_0x5c7a04,_0x7ec787){_0x5c7a04=_0x5c7a04-0x0;var _0x593d80=a20_0x422e[_0x5c7a04];return _0x593d80;};'use strict';Object[a20_0x42d8('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a20_0x42d8('0x1'));const request=require('request');const progress=require(a20_0x42d8('0x2'));const spawn=require(a20_0x42d8('0x3'))['spawn'];const exec=require(a20_0x42d8('0x3'))[a20_0x42d8('0x4')];const isImage=require(a20_0x42d8('0x5'));const format=require(a20_0x42d8('0x6'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a20_0x42d8('0x7'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0xb1cf09){this['syncPlaylistsService']=_0xb1cf09;this['state']='closed';this[a20_0x42d8('0x8')]=new HttpClientService_1[(a20_0x42d8('0x9'))]();}[a20_0x42d8('0xa')](){this[a20_0x42d8('0xb')]();}[a20_0x42d8('0xc')](){console[a20_0x42d8('0xd')](a20_0x42d8('0xe'));const _0x5207f1=a20_0x42d8('0xf');const _0x39b375='my-node-device';const _0x347dbd=a20_0x42d8('0x10');const _0x377dad='us-central1';const _0x2256e5='RS256';const _0x518f88=a20_0x42d8('0x11');const _0x5548fb='mqtt.googleapis.com';const _0x525da6=0x1bb;const _0x5b7406='events';const _0x12916d=0x5;const _0x3bb0d1=a20_0x42d8('0x12')+_0x5207f1+a20_0x42d8('0x13')+_0x377dad+a20_0x42d8('0x14')+_0x347dbd+a20_0x42d8('0x15')+_0x39b375;const _0x474de6={'host':_0x5548fb,'port':_0x525da6,'clientId':_0x3bb0d1,'username':a20_0x42d8('0x16'),'password':this[a20_0x42d8('0x17')](_0x5207f1,_0x518f88,_0x2256e5),'protocol':a20_0x42d8('0x18'),'secureProtocol':a20_0x42d8('0x19')};const _0x5102dd=Math[a20_0x42d8('0x1a')](Date[a20_0x42d8('0x1b')]()/0x3e8);const _0x17e45a=mqtt['connect'](_0x474de6);_0x17e45a['subscribe'](a20_0x42d8('0x15')+_0x39b375+'/config',{'qos':0x1});_0x17e45a['subscribe'](a20_0x42d8('0x15')+_0x39b375+'/state',{'qos':0x1});_0x17e45a[a20_0x42d8('0x1c')](a20_0x42d8('0x15')+_0x39b375+a20_0x42d8('0x1d'),{'qos':0x0});const _0x535d2f=a20_0x42d8('0x15')+_0x39b375+'/'+_0x5b7406;_0x17e45a['on']('connect',_0x428523=>{console[a20_0x42d8('0xd')]('connect');if(!_0x428523){console['log']('Client\x20not\x20connected...');}else{const _0x535d2f=a20_0x42d8('0x1e');const _0x4c4dc8=_0x347dbd+'/'+_0x39b375+a20_0x42d8('0x1f');_0x17e45a[a20_0x42d8('0x20')](_0x535d2f,_0x4c4dc8,{'qos':0x1},_0x1f5a92=>{console[a20_0x42d8('0xd')](a20_0x42d8('0x21'));console['log'](_0x1f5a92);if(!_0x1f5a92){}});}});_0x17e45a['on'](a20_0x42d8('0x22'),()=>{console[a20_0x42d8('0xd')]('close');});_0x17e45a['on'](a20_0x42d8('0x23'),_0x4a4dd4=>{console[a20_0x42d8('0xd')](a20_0x42d8('0x23'),_0x4a4dd4);});_0x17e45a['on'](a20_0x42d8('0x24'),(_0x2d2bd5,_0x514222)=>{let _0x1c54fc=a20_0x42d8('0x25');console[a20_0x42d8('0xd')](_0x2d2bd5);console['log'](_0x514222+'');if(_0x2d2bd5===a20_0x42d8('0x15')+_0x39b375+a20_0x42d8('0x26')){_0x1c54fc='Config\x20message\x20received:\x20';}else if(_0x2d2bd5[a20_0x42d8('0x27')](a20_0x42d8('0x15')+_0x39b375+'/commands')){_0x1c54fc=a20_0x42d8('0x28');}_0x1c54fc+=Buffer[a20_0x42d8('0x29')](_0x514222,'base64')[a20_0x42d8('0x2a')](a20_0x42d8('0x2b'));console[a20_0x42d8('0xd')](_0x1c54fc);});_0x17e45a['on'](a20_0x42d8('0x2c'),()=>{});console[a20_0x42d8('0xd')](_0x474de6);}[a20_0x42d8('0xb')](){console['log']('mqttInit');this[a20_0x42d8('0x2d')]=uuidv4();console[a20_0x42d8('0xd')](a20_0x42d8('0x2e'));console[a20_0x42d8('0xd')](this[a20_0x42d8('0x2d')]);const _0x6a2e72={'clientId':this[a20_0x42d8('0x2d')],'username':'lulo_mqtt','password':a20_0x42d8('0x2f'),'clean':!![]};this[a20_0x42d8('0x30')]=mqtt['connect'](a20_0x42d8('0x31'),_0x6a2e72);this[a20_0x42d8('0x30')]['on'](a20_0x42d8('0x32'),this['mqttClient_connect'][a20_0x42d8('0x33')](this));this['mqttClient']['on'](a20_0x42d8('0x24'),this['mqttClient_message'][a20_0x42d8('0x33')](this));this[a20_0x42d8('0x30')]['on'](a20_0x42d8('0x22'),()=>{console[a20_0x42d8('0xd')](a20_0x42d8('0x22'));});process['on'](a20_0x42d8('0x34'),this[a20_0x42d8('0x35')][a20_0x42d8('0x33')](this));process['on'](a20_0x42d8('0x36'),this[a20_0x42d8('0x35')]['bind'](this));process['on'](a20_0x42d8('0x37'),this[a20_0x42d8('0x35')][a20_0x42d8('0x33')](this));}[a20_0x42d8('0x38')](){console['log'](a20_0x42d8('0x39')+this[a20_0x42d8('0x2d')]);this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')](a20_0x42d8('0x3a'));this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')](a20_0x42d8('0x3b'));this['mqttClient'][a20_0x42d8('0x1c')](a20_0x42d8('0x3c'),{'qos':0x2});this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')]('player/load_playlist',{'qos':0x2});this['mqttClient'][a20_0x42d8('0x1c')](a20_0x42d8('0x3d'),{'qos':0x2});this['mqttClient']['subscribe']('player/update',{'qos':0x2});this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')](a20_0x42d8('0x3e'),{'qos':0x2});this['mqttClient'][a20_0x42d8('0x1c')](a20_0x42d8('0x3f'),{'qos':0x2});this['mqttClient'][a20_0x42d8('0x1c')](a20_0x42d8('0x40'),{'qos':0x2});this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')](a20_0x42d8('0x41'),{'qos':0x2});this[a20_0x42d8('0x30')][a20_0x42d8('0x1c')](a20_0x42d8('0x42'),{'qos':0x2});}[a20_0x42d8('0x43')](){}[a20_0x42d8('0x44')](_0x42d381,_0x1741a6){console[a20_0x42d8('0xd')](a20_0x42d8('0x45'),_0x42d381,_0x1741a6);switch(_0x42d381){case a20_0x42d8('0x3a'):return this[a20_0x42d8('0x46')](_0x1741a6);case a20_0x42d8('0x3b'):return this['handleCloseRequest'](_0x1741a6);case a20_0x42d8('0x3c'):return this[a20_0x42d8('0x47')](_0x1741a6);case a20_0x42d8('0x3d'):return this['handleReloadPlaylistRequest'](_0x1741a6);case a20_0x42d8('0x48'):return this['handleLoadPlaylistRequest'](_0x1741a6);case a20_0x42d8('0x49'):return this[a20_0x42d8('0x4a')](_0x1741a6);case a20_0x42d8('0x3e'):return this[a20_0x42d8('0x4b')](_0x1741a6);case a20_0x42d8('0x3f'):return this[a20_0x42d8('0x4c')](_0x1741a6);case a20_0x42d8('0x40'):return this[a20_0x42d8('0x4d')](_0x1741a6);case a20_0x42d8('0x41'):return this[a20_0x42d8('0x4e')](_0x1741a6);case a20_0x42d8('0x42'):return this[a20_0x42d8('0x4f')](_0x1741a6);}}['handleRegisterRequest'](_0xf5d4a5){if(_0xf5d4a5==a20_0x42d8('0x50')||_0xf5d4a5==String(this['syncPlaylistsService'][a20_0x42d8('0x51')])){this[a20_0x42d8('0x52')]['registerClient']();}}[a20_0x42d8('0x4b')](_0x5d9fa0){if(_0x5d9fa0==a20_0x42d8('0x50')||_0x5d9fa0==String(this[a20_0x42d8('0x52')][a20_0x42d8('0x51')])){}}[a20_0x42d8('0x4a')](_0x5059b4){console['log'](a20_0x42d8('0x53')+_0x5059b4);if(_0x5059b4==a20_0x42d8('0x50')||_0x5059b4==String(this[a20_0x42d8('0x52')][a20_0x42d8('0x51')])){const _0x1359bc=__dirname;const _0x4b57d5=require('simple-git')(_0x1359bc);console[a20_0x42d8('0xd')](a20_0x42d8('0x54'));_0x4b57d5['pull']((_0x4bf56b,_0x79a5ba)=>{if(_0x4bf56b){console[a20_0x42d8('0xd')](a20_0x42d8('0x55'));this['handleUpdateRequest'](_0x5059b4);return;}else{}console[a20_0x42d8('0xd')](a20_0x42d8('0x56'));console['log'](_0x79a5ba);if(_0x79a5ba&&_0x79a5ba[a20_0x42d8('0x57')]['changes']){this['syncPlaylistsService']['reboot']();}else{}});}}[a20_0x42d8('0x58')](_0x201f6b){if(_0x201f6b==a20_0x42d8('0x50')||_0x201f6b==String(this['syncPlaylistsService'][a20_0x42d8('0x51')])){this[a20_0x42d8('0x52')][a20_0x42d8('0x59')]();}}['handleReloadPlaylistRequest'](_0x5a12aa){if(String(_0x5a12aa)==a20_0x42d8('0x50')||String(_0x5a12aa)==String(this['syncPlaylistsService'][a20_0x42d8('0x51')])){this[a20_0x42d8('0x52')][a20_0x42d8('0x5a')]();}}[a20_0x42d8('0x47')](_0x4200d5){if(_0x4200d5==a20_0x42d8('0x50')||_0x4200d5==String(this[a20_0x42d8('0x52')][a20_0x42d8('0x51')])){console[a20_0x42d8('0xd')](a20_0x42d8('0x5b'));try{this[a20_0x42d8('0x52')][a20_0x42d8('0x5c')]();}catch(_0x1499e0){console['log'](_0x1499e0);}}}[a20_0x42d8('0x4d')](_0x2884ea){if(_0x2884ea==a20_0x42d8('0x50')||_0x2884ea==String(this[a20_0x42d8('0x52')]['playerId'])){console[a20_0x42d8('0xd')](a20_0x42d8('0x5d'));try{this[a20_0x42d8('0x52')][a20_0x42d8('0x5e')]();}catch(_0x488e19){console[a20_0x42d8('0xd')](_0x488e19);}}}[a20_0x42d8('0x4f')](_0xc92fee){if(_0xc92fee==a20_0x42d8('0x50')||_0xc92fee==String(this[a20_0x42d8('0x52')][a20_0x42d8('0x51')])){console[a20_0x42d8('0xd')](a20_0x42d8('0x5f'));try{this[a20_0x42d8('0x52')][a20_0x42d8('0x60')]();}catch(_0x2385f1){console[a20_0x42d8('0xd')](_0x2385f1);}}}[a20_0x42d8('0x4e')](_0x471e11){if(_0x471e11==a20_0x42d8('0x50')||_0x471e11==String(this[a20_0x42d8('0x52')][a20_0x42d8('0x51')])){console[a20_0x42d8('0xd')]('handleTurnOffTVRequest:\x20');try{this[a20_0x42d8('0x52')][a20_0x42d8('0x61')]();}catch(_0x2c4518){console[a20_0x42d8('0xd')](_0x2c4518);}}}[a20_0x42d8('0x62')](){console[a20_0x42d8('0xd')](a20_0x42d8('0x63'),this[a20_0x42d8('0x64')]);this[a20_0x42d8('0x30')][a20_0x42d8('0x20')](a20_0x42d8('0x65'),this['syncPlaylistsService'][a20_0x42d8('0x51')]+'-'+this[a20_0x42d8('0x64')]);}[a20_0x42d8('0x46')](_0x341229){if(this[a20_0x42d8('0x64')]!==a20_0x42d8('0x66')&&this['state']!==a20_0x42d8('0x67')){console[a20_0x42d8('0xd')](a20_0x42d8('0x68'));this[a20_0x42d8('0x64')]=a20_0x42d8('0x67');this[a20_0x42d8('0x62')]();setTimeout(()=>{this[a20_0x42d8('0x64')]=a20_0x42d8('0x66');this[a20_0x42d8('0x62')]();},0x1388);}}[a20_0x42d8('0x69')](_0x998e0f){if(this['state']!==a20_0x42d8('0x6a')&&this[a20_0x42d8('0x64')]!==a20_0x42d8('0x6b')){this[a20_0x42d8('0x64')]=a20_0x42d8('0x6b');this[a20_0x42d8('0x62')]();setTimeout(()=>{this[a20_0x42d8('0x64')]=a20_0x42d8('0x6a');this[a20_0x42d8('0x62')]();},0x1388);}}[a20_0x42d8('0x35')](_0x2db0fe,_0x493bec){if(_0x493bec){console[a20_0x42d8('0xd')](_0x493bec['stack']);}this['mqttClient']['publish'](a20_0x42d8('0x6c'),a20_0x42d8('0x6d'));}[a20_0x42d8('0x17')](_0x102322,_0x3f88cd,_0x3820b7){const _0x59c323={'iat':Math[a20_0x42d8('0x1a')](Date[a20_0x42d8('0x1b')]()/0x3e8),'exp':Math[a20_0x42d8('0x1a')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x102322};const _0x323143=fs[a20_0x42d8('0x6e')](_0x3f88cd);return jwt[a20_0x42d8('0x6f')](_0x59c323,_0x323143,{'algorithm':_0x3820b7});}}exports['MqttService']=MqttService;