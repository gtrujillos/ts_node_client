var a20_0x34ef=['summary','changes','reboot','handleLoadPlaylistRequest','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','updateSettings','turnOnTV','turnOffTV','sendStateUpdate','player/state','opening','opening\x20player\x20door','open','closing','stack','player/connected','false','createJwt','now','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-node-device','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','TLSv1_2_method','round','connect','subscribe','/devices/','/config','/state','/commands/#','log','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/close','player/load_playlist','player/reload_playlist','player/update','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleRebootRequest','handleReloadPlaylistRequest','handleUpdateRequest','player/ifconfig','player/register','handleUpdateSettingsRequest','handleTurnOffTVRequest','handleRegisterRequest','all','playerId','handleIfconfigRequest','handleUpdateRequest:\x20','Git\x20updating','Error\x20git\x20updated'];(function(_0x1eda1d,_0x3e7990){var _0x39a189=function(_0x2935c1){while(--_0x2935c1){_0x1eda1d['push'](_0x1eda1d['shift']());}};_0x39a189(++_0x3e7990);}(a20_0x34ef,0x171));var a20_0x54ca=function(_0x2805cd,_0x8341af){_0x2805cd=_0x2805cd-0x0;var _0x578634=a20_0x34ef[_0x2805cd];return _0x578634;};'use strict';Object[a20_0x54ca('0x0')](exports,a20_0x54ca('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0x54ca('0x2'));const fs=require('fs');const fsExtra=require(a20_0x54ca('0x3'));const request=require('request');const progress=require(a20_0x54ca('0x4'));const spawn=require(a20_0x54ca('0x5'))[a20_0x54ca('0x6')];const exec=require(a20_0x54ca('0x5'))[a20_0x54ca('0x7')];const isImage=require(a20_0x54ca('0x8'));const format=require(a20_0x54ca('0x9'));const os=require('os');const mqtt=require(a20_0x54ca('0xa'));const uuidv4=require(a20_0x54ca('0xb'));const jwt=require(a20_0x54ca('0xc'));class MqttService{constructor(_0x4ed341){this[a20_0x54ca('0xd')]=_0x4ed341;this[a20_0x54ca('0xe')]=a20_0x54ca('0xf');this['httpClientService']=new HttpClientService_1[(a20_0x54ca('0x10'))]();}['init'](){this[a20_0x54ca('0x11')]();}[a20_0x54ca('0x12')](){console['log'](a20_0x54ca('0x13'));const _0x979eb3=a20_0x54ca('0x14');const _0x426507=a20_0x54ca('0x15');const _0xc926b6='my-registry';const _0x412dcf=a20_0x54ca('0x16');const _0x1e8e17='RS256';const _0x4be056=a20_0x54ca('0x17');const _0x4fc49c=a20_0x54ca('0x18');const _0x8eb074=0x1bb;const _0x102fd2=a20_0x54ca('0x19');const _0x236cc3=0x5;const _0x3d1e99=a20_0x54ca('0x1a')+_0x979eb3+a20_0x54ca('0x1b')+_0x412dcf+a20_0x54ca('0x1c')+_0xc926b6+'/devices/'+_0x426507;const _0x3e3436={'host':_0x4fc49c,'port':_0x8eb074,'clientId':_0x3d1e99,'username':'unused','password':this['createJwt'](_0x979eb3,_0x4be056,_0x1e8e17),'protocol':'mqtts','secureProtocol':a20_0x54ca('0x1d')};const _0x5453b5=Math[a20_0x54ca('0x1e')](Date['now']()/0x3e8);const _0x136c25=mqtt[a20_0x54ca('0x1f')](_0x3e3436);_0x136c25[a20_0x54ca('0x20')](a20_0x54ca('0x21')+_0x426507+a20_0x54ca('0x22'),{'qos':0x1});_0x136c25['subscribe'](a20_0x54ca('0x21')+_0x426507+a20_0x54ca('0x23'),{'qos':0x1});_0x136c25[a20_0x54ca('0x20')]('/devices/'+_0x426507+a20_0x54ca('0x24'),{'qos':0x0});const _0x4e21fb=a20_0x54ca('0x21')+_0x426507+'/'+_0x102fd2;_0x136c25['on'](a20_0x54ca('0x1f'),_0x1dfa65=>{console[a20_0x54ca('0x25')](a20_0x54ca('0x1f'));if(!_0x1dfa65){console[a20_0x54ca('0x25')]('Client\x20not\x20connected...');}else{const _0x4e21fb=a20_0x54ca('0x26');const _0x1fce8f=_0xc926b6+'/'+_0x426507+a20_0x54ca('0x27');_0x136c25[a20_0x54ca('0x28')](_0x4e21fb,_0x1fce8f,{'qos':0x1},_0x55d485=>{console['log'](a20_0x54ca('0x29'));console[a20_0x54ca('0x25')](_0x55d485);if(!_0x55d485){}});}});_0x136c25['on'](a20_0x54ca('0x2a'),()=>{console[a20_0x54ca('0x25')](a20_0x54ca('0x2a'));});_0x136c25['on']('error',_0x53cff8=>{console[a20_0x54ca('0x25')](a20_0x54ca('0x2b'),_0x53cff8);});_0x136c25['on']('message',(_0x5834da,_0x48718e)=>{let _0x52b62e=a20_0x54ca('0x2c');console[a20_0x54ca('0x25')](_0x5834da);console[a20_0x54ca('0x25')](_0x48718e+'');if(_0x5834da===a20_0x54ca('0x21')+_0x426507+'/config'){_0x52b62e=a20_0x54ca('0x2d');}else if(_0x5834da[a20_0x54ca('0x2e')](a20_0x54ca('0x21')+_0x426507+a20_0x54ca('0x2f'))){_0x52b62e=a20_0x54ca('0x30');}_0x52b62e+=Buffer[a20_0x54ca('0x31')](_0x48718e,a20_0x54ca('0x32'))['toString'](a20_0x54ca('0x33'));console['log'](_0x52b62e);});_0x136c25['on'](a20_0x54ca('0x34'),()=>{});console['log'](_0x3e3436);}['mqttInit_mosquitto'](){console['log']('mqttInit');this[a20_0x54ca('0x35')]=uuidv4();console[a20_0x54ca('0x25')](a20_0x54ca('0x36'));console[a20_0x54ca('0x25')](this[a20_0x54ca('0x35')]);const _0x1414fe={'clientId':this[a20_0x54ca('0x35')],'username':a20_0x54ca('0x37'),'password':a20_0x54ca('0x38'),'clean':!![]};this['mqttClient']=mqtt[a20_0x54ca('0x1f')](a20_0x54ca('0x39'),_0x1414fe);this[a20_0x54ca('0x3a')]['on']('connect',this[a20_0x54ca('0x3b')][a20_0x54ca('0x3c')](this));this[a20_0x54ca('0x3a')]['on'](a20_0x54ca('0x3d'),this[a20_0x54ca('0x3e')][a20_0x54ca('0x3c')](this));this[a20_0x54ca('0x3a')]['on']('close',()=>{console[a20_0x54ca('0x25')]('close');});process['on'](a20_0x54ca('0x3f'),this[a20_0x54ca('0x40')][a20_0x54ca('0x3c')](this));process['on'](a20_0x54ca('0x41'),this['handleAppExit'][a20_0x54ca('0x3c')](this));process['on'](a20_0x54ca('0x42'),this['handleAppExit'][a20_0x54ca('0x3c')](this));}['mqttClient_connect'](){console[a20_0x54ca('0x25')](a20_0x54ca('0x43')+this[a20_0x54ca('0x35')]);this[a20_0x54ca('0x3a')]['subscribe']('player/open');this[a20_0x54ca('0x3a')]['subscribe'](a20_0x54ca('0x44'));this[a20_0x54ca('0x3a')]['subscribe']('player/reboot',{'qos':0x2});this[a20_0x54ca('0x3a')][a20_0x54ca('0x20')](a20_0x54ca('0x45'),{'qos':0x2});this[a20_0x54ca('0x3a')][a20_0x54ca('0x20')](a20_0x54ca('0x46'),{'qos':0x2});this[a20_0x54ca('0x3a')]['subscribe'](a20_0x54ca('0x47'),{'qos':0x2});this[a20_0x54ca('0x3a')][a20_0x54ca('0x20')]('player/ifconfig',{'qos':0x2});this['mqttClient'][a20_0x54ca('0x20')]('player/register',{'qos':0x2});this[a20_0x54ca('0x3a')][a20_0x54ca('0x20')]('player/update_settings',{'qos':0x2});this[a20_0x54ca('0x3a')]['subscribe'](a20_0x54ca('0x48'),{'qos':0x2});this[a20_0x54ca('0x3a')][a20_0x54ca('0x20')](a20_0x54ca('0x49'),{'qos':0x2});}[a20_0x54ca('0x4a')](){}[a20_0x54ca('0x3e')](_0x2db72b,_0x1f53b4){console['log'](a20_0x54ca('0x4b'),_0x2db72b,_0x1f53b4);switch(_0x2db72b){case'player/open':return this[a20_0x54ca('0x4c')](_0x1f53b4);case'player/close':return this['handleCloseRequest'](_0x1f53b4);case'player/reboot':return this[a20_0x54ca('0x4d')](_0x1f53b4);case a20_0x54ca('0x46'):return this[a20_0x54ca('0x4e')](_0x1f53b4);case a20_0x54ca('0x45'):return this['handleLoadPlaylistRequest'](_0x1f53b4);case'player/update':return this[a20_0x54ca('0x4f')](_0x1f53b4);case a20_0x54ca('0x50'):return this['handleIfconfigRequest'](_0x1f53b4);case a20_0x54ca('0x51'):return this['handleRegisterRequest'](_0x1f53b4);case'player/update_settings':return this[a20_0x54ca('0x52')](_0x1f53b4);case a20_0x54ca('0x48'):return this[a20_0x54ca('0x53')](_0x1f53b4);case a20_0x54ca('0x49'):return this['handleTurnOnTVRequest'](_0x1f53b4);}}[a20_0x54ca('0x54')](_0x2e2a58){if(_0x2e2a58==a20_0x54ca('0x55')||_0x2e2a58==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){this['syncPlaylistsService']['registerClient']();}}[a20_0x54ca('0x57')](_0x5e6f04){if(_0x5e6f04=='all'||_0x5e6f04==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){}}[a20_0x54ca('0x4f')](_0x760b3e){console['log'](a20_0x54ca('0x58')+_0x760b3e);if(_0x760b3e==a20_0x54ca('0x55')||_0x760b3e==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){const _0x480f63=__dirname;const _0x512be4=require('simple-git')(_0x480f63);console[a20_0x54ca('0x25')](a20_0x54ca('0x59'));_0x512be4['pull']((_0x307852,_0xc397b9)=>{if(_0x307852){console[a20_0x54ca('0x25')](a20_0x54ca('0x5a'));this[a20_0x54ca('0x4f')](_0x760b3e);return;}else{}console['log']('Git\x20updated');console[a20_0x54ca('0x25')](_0xc397b9);if(_0xc397b9&&_0xc397b9[a20_0x54ca('0x5b')][a20_0x54ca('0x5c')]){this[a20_0x54ca('0xd')][a20_0x54ca('0x5d')]();}else{}});}}[a20_0x54ca('0x5e')](_0x3846bb){if(_0x3846bb==a20_0x54ca('0x55')||_0x3846bb==String(this[a20_0x54ca('0xd')]['playerId'])){this[a20_0x54ca('0xd')][a20_0x54ca('0x5f')]();}}[a20_0x54ca('0x4e')](_0x1d5848){if(String(_0x1d5848)==a20_0x54ca('0x55')||String(_0x1d5848)==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){this[a20_0x54ca('0xd')][a20_0x54ca('0x60')]();}}[a20_0x54ca('0x4d')](_0x499918){if(_0x499918=='all'||_0x499918==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){console[a20_0x54ca('0x25')](a20_0x54ca('0x61'));try{this['syncPlaylistsService']['reboot']();}catch(_0x6b7b68){console[a20_0x54ca('0x25')](_0x6b7b68);}}}[a20_0x54ca('0x52')](_0x2e4167){if(_0x2e4167==a20_0x54ca('0x55')||_0x2e4167==String(this[a20_0x54ca('0xd')][a20_0x54ca('0x56')])){console[a20_0x54ca('0x25')]('handleUpdateSettingsRequest:\x20');try{this['syncPlaylistsService'][a20_0x54ca('0x62')]();}catch(_0x42f394){console['log'](_0x42f394);}}}['handleTurnOnTVRequest'](_0x546681){if(_0x546681=='all'||_0x546681==String(this['syncPlaylistsService']['playerId'])){console[a20_0x54ca('0x25')]('handleTurnOnTVRequest:\x20');try{this[a20_0x54ca('0xd')][a20_0x54ca('0x63')]();}catch(_0x4eab0b){console['log'](_0x4eab0b);}}}['handleTurnOffTVRequest'](_0x11ddca){if(_0x11ddca==a20_0x54ca('0x55')||_0x11ddca==String(this['syncPlaylistsService']['playerId'])){console[a20_0x54ca('0x25')]('handleTurnOffTVRequest:\x20');try{this['syncPlaylistsService'][a20_0x54ca('0x64')]();}catch(_0x3ce550){console[a20_0x54ca('0x25')](_0x3ce550);}}}[a20_0x54ca('0x65')](){console[a20_0x54ca('0x25')]('sending\x20state\x20%s',this[a20_0x54ca('0xe')]);this[a20_0x54ca('0x3a')][a20_0x54ca('0x28')](a20_0x54ca('0x66'),this[a20_0x54ca('0xd')][a20_0x54ca('0x56')]+'-'+this['state']);}[a20_0x54ca('0x4c')](_0x301d91){if(this[a20_0x54ca('0xe')]!=='open'&&this[a20_0x54ca('0xe')]!==a20_0x54ca('0x67')){console['log'](a20_0x54ca('0x68'));this[a20_0x54ca('0xe')]=a20_0x54ca('0x67');this[a20_0x54ca('0x65')]();setTimeout(()=>{this[a20_0x54ca('0xe')]=a20_0x54ca('0x69');this[a20_0x54ca('0x65')]();},0x1388);}}['handleCloseRequest'](_0x17139f){if(this[a20_0x54ca('0xe')]!==a20_0x54ca('0xf')&&this['state']!==a20_0x54ca('0x6a')){this[a20_0x54ca('0xe')]='closing';this[a20_0x54ca('0x65')]();setTimeout(()=>{this[a20_0x54ca('0xe')]=a20_0x54ca('0xf');this[a20_0x54ca('0x65')]();},0x1388);}}[a20_0x54ca('0x40')](_0x953ad8,_0x37e4b5){if(_0x37e4b5){console[a20_0x54ca('0x25')](_0x37e4b5[a20_0x54ca('0x6b')]);}this[a20_0x54ca('0x3a')][a20_0x54ca('0x28')](a20_0x54ca('0x6c'),a20_0x54ca('0x6d'));}[a20_0x54ca('0x6e')](_0x135923,_0x29f32b,_0x52d58d){const _0x3ea2a8={'iat':Math[a20_0x54ca('0x1e')](Date[a20_0x54ca('0x6f')]()/0x3e8),'exp':Math[a20_0x54ca('0x1e')](Date[a20_0x54ca('0x6f')]()/0x3e8)+0x14*0x3c,'aud':_0x135923};const _0x4ddc65=fs[a20_0x54ca('0x70')](_0x29f32b);return jwt[a20_0x54ca('0x71')](_0x3ea2a8,_0x4ddc65,{'algorithm':_0x52d58d});}}exports[a20_0x54ca('0x72')]=MqttService;