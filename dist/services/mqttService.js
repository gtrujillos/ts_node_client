var a18_0x26bc=['mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleRegisterRequest','registerClient','handleIfconfigRequest','playerId','handleUpdateRequest:\x20','all','simple-git','pull','Error\x20git\x20updated','Git\x20updated','changes','handleLoadPlaylistRequest','reloadMediaList','shutdown','sending\x20state\x20%s','state','open','opening\x20player\x20door','opening','sendStateUpdate','closing','stack','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','closed','httpClientService','HttpClientService','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','base64','toString','ascii','packetsend','clientId','this.clientId','run.lulo_2018#.'];(function(_0x42a7dc,_0xbc44f2){var _0x373101=function(_0x53415c){while(--_0x53415c){_0x42a7dc['push'](_0x42a7dc['shift']());}};_0x373101(++_0xbc44f2);}(a18_0x26bc,0x179));var a18_0x2f9c=function(_0x247952,_0x67a643){_0x247952=_0x247952-0x0;var _0x531c40=a18_0x26bc[_0x247952];return _0x531c40;};'use strict';Object[a18_0x2f9c('0x0')](exports,a18_0x2f9c('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2f9c('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2f9c('0x3'));const request=require(a18_0x2f9c('0x4'));const progress=require(a18_0x2f9c('0x5'));const spawn=require(a18_0x2f9c('0x6'))[a18_0x2f9c('0x7')];const isImage=require(a18_0x2f9c('0x8'));const format=require(a18_0x2f9c('0x9'));const os=require('os');const mqtt=require(a18_0x2f9c('0xa'));const uuidv4=require(a18_0x2f9c('0xb'));const jwt=require(a18_0x2f9c('0xc'));class MqttService{constructor(_0x81e519){this[a18_0x2f9c('0xd')]=_0x81e519;this['state']=a18_0x2f9c('0xe');this[a18_0x2f9c('0xf')]=new HttpClientService_1[(a18_0x2f9c('0x10'))]();}['init'](){this[a18_0x2f9c('0x11')]();}[a18_0x2f9c('0x12')](){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x14'));const _0x2df7e=a18_0x2f9c('0x15');const _0x52e821=a18_0x2f9c('0x16');const _0x39fa1f=a18_0x2f9c('0x17');const _0xb1b265='us-central1';const _0x1172f7=a18_0x2f9c('0x18');const _0x52e61e=a18_0x2f9c('0x19');const _0x52f2ec=a18_0x2f9c('0x1a');const _0x287d46=0x1bb;const _0x4edadc=a18_0x2f9c('0x1b');const _0x26ba8f=0x5;const _0x4df9b7=a18_0x2f9c('0x1c')+_0x2df7e+a18_0x2f9c('0x1d')+_0xb1b265+a18_0x2f9c('0x1e')+_0x39fa1f+a18_0x2f9c('0x1f')+_0x52e821;const _0xa86c1c={'host':_0x52f2ec,'port':_0x287d46,'clientId':_0x4df9b7,'username':a18_0x2f9c('0x20'),'password':this[a18_0x2f9c('0x21')](_0x2df7e,_0x52e61e,_0x1172f7),'protocol':a18_0x2f9c('0x22'),'secureProtocol':a18_0x2f9c('0x23')};const _0x111547=Math[a18_0x2f9c('0x24')](Date[a18_0x2f9c('0x25')]()/0x3e8);const _0x2ab87a=mqtt[a18_0x2f9c('0x26')](_0xa86c1c);_0x2ab87a[a18_0x2f9c('0x27')](a18_0x2f9c('0x1f')+_0x52e821+a18_0x2f9c('0x28'),{'qos':0x1});_0x2ab87a[a18_0x2f9c('0x27')](a18_0x2f9c('0x1f')+_0x52e821+a18_0x2f9c('0x29'),{'qos':0x1});_0x2ab87a[a18_0x2f9c('0x27')](a18_0x2f9c('0x1f')+_0x52e821+a18_0x2f9c('0x2a'),{'qos':0x0});const _0x433680='/devices/'+_0x52e821+'/'+_0x4edadc;_0x2ab87a['on'](a18_0x2f9c('0x26'),_0x427389=>{console[a18_0x2f9c('0x13')]('connect');if(!_0x427389){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x2b'));}else{const _0x433680=a18_0x2f9c('0x2c');const _0xdf7b57=_0x39fa1f+'/'+_0x52e821+a18_0x2f9c('0x2d');_0x2ab87a[a18_0x2f9c('0x2e')](_0x433680,_0xdf7b57,{'qos':0x1},_0x39c264=>{console[a18_0x2f9c('0x13')](a18_0x2f9c('0x2f'));console[a18_0x2f9c('0x13')](_0x39c264);if(!_0x39c264){}});}});_0x2ab87a['on'](a18_0x2f9c('0x30'),()=>{console[a18_0x2f9c('0x13')]('close');});_0x2ab87a['on'](a18_0x2f9c('0x31'),_0x4ed936=>{console['log'](a18_0x2f9c('0x31'),_0x4ed936);});_0x2ab87a['on'](a18_0x2f9c('0x32'),(_0x4dbc50,_0x224b36)=>{let _0x336e14=a18_0x2f9c('0x33');console['log'](_0x4dbc50);console['log'](_0x224b36+'');if(_0x4dbc50==='/devices/'+_0x52e821+a18_0x2f9c('0x28')){_0x336e14=a18_0x2f9c('0x34');}else if(_0x4dbc50[a18_0x2f9c('0x35')](a18_0x2f9c('0x1f')+_0x52e821+a18_0x2f9c('0x36'))){_0x336e14=a18_0x2f9c('0x37');}_0x336e14+=Buffer['from'](_0x224b36,a18_0x2f9c('0x38'))[a18_0x2f9c('0x39')](a18_0x2f9c('0x3a'));console['log'](_0x336e14);});_0x2ab87a['on'](a18_0x2f9c('0x3b'),()=>{});console[a18_0x2f9c('0x13')](_0xa86c1c);}['mqttInit_mosquitto'](){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x14'));this[a18_0x2f9c('0x3c')]=uuidv4();console[a18_0x2f9c('0x13')](a18_0x2f9c('0x3d'));console['log'](this[a18_0x2f9c('0x3c')]);const _0x3dc860={'clientId':this['clientId'],'username':'lulo_mqtt','password':a18_0x2f9c('0x3e'),'clean':!![]};this[a18_0x2f9c('0x3f')]=mqtt[a18_0x2f9c('0x26')](a18_0x2f9c('0x40'),_0x3dc860);this[a18_0x2f9c('0x3f')]['on']('connect',this[a18_0x2f9c('0x41')][a18_0x2f9c('0x42')](this));this[a18_0x2f9c('0x3f')]['on'](a18_0x2f9c('0x32'),this[a18_0x2f9c('0x43')][a18_0x2f9c('0x42')](this));this[a18_0x2f9c('0x3f')]['on']('close',()=>{console[a18_0x2f9c('0x13')](a18_0x2f9c('0x30'));});process['on'](a18_0x2f9c('0x44'),this[a18_0x2f9c('0x45')]['bind'](this));process['on'](a18_0x2f9c('0x46'),this[a18_0x2f9c('0x45')][a18_0x2f9c('0x42')](this));process['on'](a18_0x2f9c('0x47'),this[a18_0x2f9c('0x45')]['bind'](this));}[a18_0x2f9c('0x41')](){console[a18_0x2f9c('0x13')]('Connected\x20to\x20broker\x20client:'+this[a18_0x2f9c('0x3c')]);this[a18_0x2f9c('0x3f')][a18_0x2f9c('0x27')](a18_0x2f9c('0x48'));this['mqttClient']['subscribe'](a18_0x2f9c('0x49'));this[a18_0x2f9c('0x3f')][a18_0x2f9c('0x27')]('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x2f9c('0x27')](a18_0x2f9c('0x4a'),{'qos':0x2});this[a18_0x2f9c('0x3f')]['subscribe'](a18_0x2f9c('0x4b'),{'qos':0x2});this[a18_0x2f9c('0x3f')][a18_0x2f9c('0x27')](a18_0x2f9c('0x4c'),{'qos':0x2});this['mqttClient'][a18_0x2f9c('0x27')]('player/ifconfig',{'qos':0x2});this[a18_0x2f9c('0x3f')][a18_0x2f9c('0x27')](a18_0x2f9c('0x4d'),{'qos':0x2});}[a18_0x2f9c('0x4e')](){}[a18_0x2f9c('0x43')](_0x375ce1,_0x51a9d6){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x4f'),_0x375ce1,_0x51a9d6);switch(_0x375ce1){case a18_0x2f9c('0x48'):return this[a18_0x2f9c('0x50')](_0x51a9d6);case'player/close':return this[a18_0x2f9c('0x51')](_0x51a9d6);case a18_0x2f9c('0x52'):return this[a18_0x2f9c('0x53')](_0x51a9d6);case a18_0x2f9c('0x4b'):return this[a18_0x2f9c('0x54')](_0x51a9d6);case a18_0x2f9c('0x4a'):return this['handleLoadPlaylistRequest'](_0x51a9d6);case a18_0x2f9c('0x4c'):return this['handleUpdateRequest'](_0x51a9d6);case'player/ifconfig':return this['handleIfconfigRequest'](_0x51a9d6);case a18_0x2f9c('0x4d'):return this[a18_0x2f9c('0x55')](_0x51a9d6);}}['handleRegisterRequest'](_0x2c4d39){if(_0x2c4d39=='all'||_0x2c4d39==String(this[a18_0x2f9c('0xd')]['playerId'])){this[a18_0x2f9c('0xd')][a18_0x2f9c('0x56')]();}}[a18_0x2f9c('0x57')](_0x571d46){if(_0x571d46=='all'||_0x571d46==String(this[a18_0x2f9c('0xd')][a18_0x2f9c('0x58')])){}}['handleUpdateRequest'](_0x417ebd){console['log'](a18_0x2f9c('0x59')+_0x417ebd);if(_0x417ebd==a18_0x2f9c('0x5a')||_0x417ebd==String(this['syncPlaylistsService'][a18_0x2f9c('0x58')])){const _0x598d30=__dirname;const _0x1f9558=require(a18_0x2f9c('0x5b'))(_0x598d30);console['log']('Git\x20updating');_0x1f9558[a18_0x2f9c('0x5c')]((_0x4186a9,_0x1b9ace)=>{if(_0x4186a9){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x5d'));this['handleUpdateRequest'](_0x417ebd);return;}else{}console[a18_0x2f9c('0x13')](a18_0x2f9c('0x5e'));console['log'](_0x1b9ace);if(_0x1b9ace&&_0x1b9ace['summary'][a18_0x2f9c('0x5f')]){const _0x3c4621=spawn('shutdown',['-r',a18_0x2f9c('0x25')]);}else{}});}}[a18_0x2f9c('0x60')](_0x1e0101){if(_0x1e0101==a18_0x2f9c('0x5a')||_0x1e0101==String(this['syncPlaylistsService'][a18_0x2f9c('0x58')])){this[a18_0x2f9c('0xd')]['loadMediaList']();}}[a18_0x2f9c('0x54')](_0x41f241){if(String(_0x41f241)==a18_0x2f9c('0x5a')||String(_0x41f241)==String(this[a18_0x2f9c('0xd')][a18_0x2f9c('0x58')])){this[a18_0x2f9c('0xd')][a18_0x2f9c('0x61')]();}}['handleRebootRequest'](_0x4885ba){if(_0x4885ba=='all'||_0x4885ba==String(this['syncPlaylistsService'][a18_0x2f9c('0x58')])){const _0x450e43=spawn(a18_0x2f9c('0x62'),['-r',a18_0x2f9c('0x25')]);}}['sendStateUpdate'](){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x63'),this[a18_0x2f9c('0x64')]);this['mqttClient'][a18_0x2f9c('0x2e')]('player/state',this[a18_0x2f9c('0xd')][a18_0x2f9c('0x58')]+'-'+this[a18_0x2f9c('0x64')]);}[a18_0x2f9c('0x50')](_0x408b2f){if(this[a18_0x2f9c('0x64')]!==a18_0x2f9c('0x65')&&this[a18_0x2f9c('0x64')]!=='opening'){console[a18_0x2f9c('0x13')](a18_0x2f9c('0x66'));this[a18_0x2f9c('0x64')]=a18_0x2f9c('0x67');this[a18_0x2f9c('0x68')]();setTimeout(()=>{this[a18_0x2f9c('0x64')]=a18_0x2f9c('0x65');this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x3625b7){if(this['state']!=='closed'&&this['state']!==a18_0x2f9c('0x69')){this['state']=a18_0x2f9c('0x69');this[a18_0x2f9c('0x68')]();setTimeout(()=>{this[a18_0x2f9c('0x64')]=a18_0x2f9c('0xe');this['sendStateUpdate']();},0x1388);}}[a18_0x2f9c('0x45')](_0x132ebd,_0x5217c1){if(_0x5217c1){console[a18_0x2f9c('0x13')](_0x5217c1[a18_0x2f9c('0x6a')]);}this['mqttClient'][a18_0x2f9c('0x2e')]('player/connected',a18_0x2f9c('0x6b'));}['createJwt'](_0x4477d2,_0x366238,_0x36f93f){const _0xb840a1={'iat':Math[a18_0x2f9c('0x24')](Date[a18_0x2f9c('0x25')]()/0x3e8),'exp':Math['round'](Date[a18_0x2f9c('0x25')]()/0x3e8)+0x14*0x3c,'aud':_0x4477d2};const _0x79121c=fs[a18_0x2f9c('0x6c')](_0x366238);return jwt[a18_0x2f9c('0x6d')](_0xb840a1,_0x79121c,{'algorithm':_0x36f93f});}}exports['MqttService']=MqttService;