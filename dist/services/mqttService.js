var a18_0x5647=['mqttClient_connect','message','mqttClient_message','handleAppExit','bind','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/update','handleOpenRequest','handleCloseRequest','handleRebootRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','syncPlaylistsService','playerId','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','now','loadMediaList','reloadMediaList','sendStateUpdate','publish','player/state','opening','open','closing','player/connected','false','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','is-image','string-template','uuid/v4','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run'];(function(_0x21783b,_0x50ddbf){var _0x407ebb=function(_0x4103e6){while(--_0x4103e6){_0x21783b['push'](_0x21783b['shift']());}};_0x407ebb(++_0x50ddbf);}(a18_0x5647,0x190));var a18_0x4652=function(_0x3e0911,_0x4babf8){_0x3e0911=_0x3e0911-0x0;var _0xc506b1=a18_0x5647[_0x3e0911];return _0xc506b1;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x4652('0x0'));const fs=require('fs');const fsExtra=require(a18_0x4652('0x1'));const request=require(a18_0x4652('0x2'));const progress=require('request-progress');const spawn=require(a18_0x4652('0x3'))[a18_0x4652('0x4')];const isImage=require(a18_0x4652('0x5'));const format=require(a18_0x4652('0x6'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x4652('0x7'));class MqttService{constructor(_0x3c6cf1){this['syncPlaylistsService']=_0x3c6cf1;this[a18_0x4652('0x8')]=a18_0x4652('0x9');this[a18_0x4652('0xa')]=new HttpClientService_1[(a18_0x4652('0xb'))]();}[a18_0x4652('0xc')](){this[a18_0x4652('0xd')]();}[a18_0x4652('0xd')](){console['log'](a18_0x4652('0xd'));this['clientId']=uuidv4();console[a18_0x4652('0xe')]('this.clientId');console[a18_0x4652('0xe')](this[a18_0x4652('0xf')]);const _0x56881b={'clientId':this[a18_0x4652('0xf')],'username':a18_0x4652('0x10'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x4652('0x11')]=mqtt[a18_0x4652('0x12')](a18_0x4652('0x13'),_0x56881b);this['mqttClient']['on'](a18_0x4652('0x12'),this[a18_0x4652('0x14')]['bind'](this));this[a18_0x4652('0x11')]['on'](a18_0x4652('0x15'),this[a18_0x4652('0x16')]['bind'](this));process['on']('exit',this[a18_0x4652('0x17')][a18_0x4652('0x18')](this));process['on']('SIGINT',this['handleAppExit'][a18_0x4652('0x18')](this));process['on'](a18_0x4652('0x19'),this[a18_0x4652('0x17')][a18_0x4652('0x18')](this));}[a18_0x4652('0x14')](){console['log'](a18_0x4652('0x1a')+this[a18_0x4652('0xf')]);this[a18_0x4652('0x11')][a18_0x4652('0x1b')](a18_0x4652('0x1c'));this[a18_0x4652('0x11')][a18_0x4652('0x1b')](a18_0x4652('0x1d'));this[a18_0x4652('0x11')][a18_0x4652('0x1b')](a18_0x4652('0x1e'),{'qos':0x2});this[a18_0x4652('0x11')][a18_0x4652('0x1b')](a18_0x4652('0x1f'),{'qos':0x2});this[a18_0x4652('0x11')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x4652('0x11')][a18_0x4652('0x1b')](a18_0x4652('0x20'),{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x146572,_0x1c96e0){console[a18_0x4652('0xe')]('received\x20message\x20%s\x20%s',_0x146572,_0x1c96e0);switch(_0x146572){case a18_0x4652('0x1c'):return this[a18_0x4652('0x21')](_0x1c96e0);case a18_0x4652('0x1d'):return this[a18_0x4652('0x22')](_0x1c96e0);case a18_0x4652('0x1e'):return this[a18_0x4652('0x23')](_0x1c96e0);case a18_0x4652('0x24'):return this[a18_0x4652('0x25')](_0x1c96e0);case a18_0x4652('0x1f'):return this[a18_0x4652('0x26')](_0x1c96e0);case'player/update':return this[a18_0x4652('0x27')](_0x1c96e0);}}[a18_0x4652('0x27')](_0xd729af){if(_0xd729af==a18_0x4652('0x28')||_0xd729af==String(this[a18_0x4652('0x29')][a18_0x4652('0x2a')])){const _0x187ea7=__dirname;const _0x82a663=require('simple-git')(_0x187ea7);console[a18_0x4652('0xe')]('Git\x20updating');_0x82a663[a18_0x4652('0x2b')]((_0x1a5ace,_0x143718)=>{if(_0x1a5ace){console[a18_0x4652('0xe')](a18_0x4652('0x2c'));this[a18_0x4652('0x27')](_0xd729af);return;}else{}console[a18_0x4652('0xe')](a18_0x4652('0x2d'));console[a18_0x4652('0xe')](_0x143718);if(_0x143718&&_0x143718[a18_0x4652('0x2e')][a18_0x4652('0x2f')]){const _0x350c15=spawn(a18_0x4652('0x30'),['-r',a18_0x4652('0x31')]);}else{}});}}[a18_0x4652('0x26')](_0x43e60f){if(_0x43e60f=='all'||_0x43e60f==String(this[a18_0x4652('0x29')][a18_0x4652('0x2a')])){this[a18_0x4652('0x29')][a18_0x4652('0x32')]();}}[a18_0x4652('0x25')](_0x34dd90){if(_0x34dd90=='all'||_0x34dd90==String(this[a18_0x4652('0x29')][a18_0x4652('0x2a')])){this[a18_0x4652('0x29')][a18_0x4652('0x33')]();}}[a18_0x4652('0x23')](_0x19a3db){if(_0x19a3db==a18_0x4652('0x28')||_0x19a3db==String(this[a18_0x4652('0x29')][a18_0x4652('0x2a')])){const _0x122dec=spawn(a18_0x4652('0x30'),['-r',a18_0x4652('0x31')]);}}[a18_0x4652('0x34')](){console[a18_0x4652('0xe')]('sending\x20state\x20%s',this[a18_0x4652('0x8')]);this[a18_0x4652('0x11')][a18_0x4652('0x35')](a18_0x4652('0x36'),this[a18_0x4652('0x29')][a18_0x4652('0x2a')]+'-'+this[a18_0x4652('0x8')]);}[a18_0x4652('0x21')](_0x2f3e9e){if(this[a18_0x4652('0x8')]!=='open'&&this['state']!==a18_0x4652('0x37')){console[a18_0x4652('0xe')]('opening\x20player\x20door');this[a18_0x4652('0x8')]=a18_0x4652('0x37');this[a18_0x4652('0x34')]();setTimeout(()=>{this[a18_0x4652('0x8')]=a18_0x4652('0x38');this['sendStateUpdate']();},0x1388);}}[a18_0x4652('0x22')](_0x1efdbf){if(this[a18_0x4652('0x8')]!==a18_0x4652('0x9')&&this[a18_0x4652('0x8')]!==a18_0x4652('0x39')){this[a18_0x4652('0x8')]='closing';this[a18_0x4652('0x34')]();setTimeout(()=>{this[a18_0x4652('0x8')]=a18_0x4652('0x9');this[a18_0x4652('0x34')]();},0x1388);}}[a18_0x4652('0x17')](_0x25aa30,_0x285431){if(_0x285431){console[a18_0x4652('0xe')](_0x285431['stack']);}this[a18_0x4652('0x11')][a18_0x4652('0x35')](a18_0x4652('0x3a'),a18_0x4652('0x3b'));}}exports['MqttService']=MqttService;