var a20_0x3b55=['handleUpdateSettingsRequest:\x20','turnOnTV','handleTurnOffTVRequest:\x20','turnOffTV','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','spawn','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','mqttInit','velvety-glazing-252020','my-registry','RS256','mqtt.googleapis.com','events','projects/','/locations/','/registries/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/devices/','/config','/state','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','from','base64','toString','packetsend','clientId','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','mqttClient_message','exit','SIGINT','handleAppExit','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/update','player/ifconfig','player/register','player/turn_off_tv','player/turn_on_tv','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','player/update_settings','handleTurnOffTVRequest','handleTurnOnTVRequest','playerId','all','handleUpdateRequest:\x20','simple-git','Error\x20git\x20updated','summary','reboot','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest'];(function(_0x1dccfd,_0x5267ca){var _0x3aa478=function(_0x10f3b0){while(--_0x10f3b0){_0x1dccfd['push'](_0x1dccfd['shift']());}};_0x3aa478(++_0x5267ca);}(a20_0x3b55,0x15f));var a20_0xea6e=function(_0x2b26ee,_0x24ae1d){_0x2b26ee=_0x2b26ee-0x0;var _0x39140b=a20_0x3b55[_0x2b26ee];return _0x39140b;};'use strict';Object[a20_0xea6e('0x0')](exports,a20_0xea6e('0x1'),{'value':!![]});const HttpClientService_1=require(a20_0xea6e('0x2'));const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require('request-progress');const spawn=require('child_process')[a20_0xea6e('0x3')];const exec=require('child_process')['exec'];const isImage=require(a20_0xea6e('0x4'));const format=require(a20_0xea6e('0x5'));const os=require('os');const mqtt=require(a20_0xea6e('0x6'));const uuidv4=require(a20_0xea6e('0x7'));const jwt=require(a20_0xea6e('0x8'));class MqttService{constructor(_0x5a9984){this[a20_0xea6e('0x9')]=_0x5a9984;this[a20_0xea6e('0xa')]=a20_0xea6e('0xb');this[a20_0xea6e('0xc')]=new HttpClientService_1[(a20_0xea6e('0xd'))]();}[a20_0xea6e('0xe')](){this[a20_0xea6e('0xf')]();}[a20_0xea6e('0x10')](){console['log'](a20_0xea6e('0x11'));const _0x4b3e4e=a20_0xea6e('0x12');const _0x5766c6='my-node-device';const _0x4b3ff7=a20_0xea6e('0x13');const _0x432f49='us-central1';const _0x4789ad=a20_0xea6e('0x14');const _0x56dea6='resources/keys/rsa_private.pem';const _0x93282e=a20_0xea6e('0x15');const _0x23dd8d=0x1bb;const _0xfd96e5=a20_0xea6e('0x16');const _0x47709f=0x5;const _0xb0d1e6=a20_0xea6e('0x17')+_0x4b3e4e+a20_0xea6e('0x18')+_0x432f49+a20_0xea6e('0x19')+_0x4b3ff7+'/devices/'+_0x5766c6;const _0x127406={'host':_0x93282e,'port':_0x23dd8d,'clientId':_0xb0d1e6,'username':a20_0xea6e('0x1a'),'password':this[a20_0xea6e('0x1b')](_0x4b3e4e,_0x56dea6,_0x4789ad),'protocol':a20_0xea6e('0x1c'),'secureProtocol':a20_0xea6e('0x1d')};const _0x9e288f=Math[a20_0xea6e('0x1e')](Date[a20_0xea6e('0x1f')]()/0x3e8);const _0x1ab574=mqtt[a20_0xea6e('0x20')](_0x127406);_0x1ab574[a20_0xea6e('0x21')](a20_0xea6e('0x22')+_0x5766c6+a20_0xea6e('0x23'),{'qos':0x1});_0x1ab574['subscribe']('/devices/'+_0x5766c6+a20_0xea6e('0x24'),{'qos':0x1});_0x1ab574[a20_0xea6e('0x21')](a20_0xea6e('0x22')+_0x5766c6+'/commands/#',{'qos':0x0});const _0x1d9871=a20_0xea6e('0x22')+_0x5766c6+'/'+_0xfd96e5;_0x1ab574['on'](a20_0xea6e('0x20'),_0x2af7d9=>{console['log'](a20_0xea6e('0x20'));if(!_0x2af7d9){console[a20_0xea6e('0x25')](a20_0xea6e('0x26'));}else{const _0x1d9871=a20_0xea6e('0x27');const _0x13da0c=_0x4b3ff7+'/'+_0x5766c6+a20_0xea6e('0x28');_0x1ab574[a20_0xea6e('0x29')](_0x1d9871,_0x13da0c,{'qos':0x1},_0x54e7c0=>{console[a20_0xea6e('0x25')]('publish\x20result:');console[a20_0xea6e('0x25')](_0x54e7c0);if(!_0x54e7c0){}});}});_0x1ab574['on'](a20_0xea6e('0x2a'),()=>{console[a20_0xea6e('0x25')](a20_0xea6e('0x2a'));});_0x1ab574['on'](a20_0xea6e('0x2b'),_0x131b6c=>{console[a20_0xea6e('0x25')](a20_0xea6e('0x2b'),_0x131b6c);});_0x1ab574['on'](a20_0xea6e('0x2c'),(_0x3a88b9,_0x290b40)=>{let _0x29c108=a20_0xea6e('0x2d');console['log'](_0x3a88b9);console[a20_0xea6e('0x25')](_0x290b40+'');if(_0x3a88b9==='/devices/'+_0x5766c6+a20_0xea6e('0x23')){_0x29c108=a20_0xea6e('0x2e');}else if(_0x3a88b9[a20_0xea6e('0x2f')](a20_0xea6e('0x22')+_0x5766c6+a20_0xea6e('0x30'))){_0x29c108='Command\x20message\x20received:\x20';}_0x29c108+=Buffer[a20_0xea6e('0x31')](_0x290b40,a20_0xea6e('0x32'))[a20_0xea6e('0x33')]('ascii');console[a20_0xea6e('0x25')](_0x29c108);});_0x1ab574['on'](a20_0xea6e('0x34'),()=>{});console['log'](_0x127406);}[a20_0xea6e('0xf')](){console[a20_0xea6e('0x25')](a20_0xea6e('0x11'));this[a20_0xea6e('0x35')]=uuidv4();console[a20_0xea6e('0x25')](a20_0xea6e('0x36'));console['log'](this['clientId']);const _0x3c785d={'clientId':this[a20_0xea6e('0x35')],'username':a20_0xea6e('0x37'),'password':'run.lulo_2018#.','clean':!![]};this[a20_0xea6e('0x38')]=mqtt['connect'](a20_0xea6e('0x39'),_0x3c785d);this[a20_0xea6e('0x38')]['on']('connect',this[a20_0xea6e('0x3a')][a20_0xea6e('0x3b')](this));this[a20_0xea6e('0x38')]['on']('message',this[a20_0xea6e('0x3c')]['bind'](this));this['mqttClient']['on'](a20_0xea6e('0x2a'),()=>{console['log']('close');});process['on'](a20_0xea6e('0x3d'),this['handleAppExit'][a20_0xea6e('0x3b')](this));process['on'](a20_0xea6e('0x3e'),this[a20_0xea6e('0x3f')][a20_0xea6e('0x3b')](this));process['on'](a20_0xea6e('0x40'),this[a20_0xea6e('0x3f')][a20_0xea6e('0x3b')](this));}['mqttClient_connect'](){console[a20_0xea6e('0x25')]('Connected\x20to\x20broker\x20client:'+this[a20_0xea6e('0x35')]);this['mqttClient'][a20_0xea6e('0x21')](a20_0xea6e('0x41'));this[a20_0xea6e('0x38')]['subscribe'](a20_0xea6e('0x42'));this[a20_0xea6e('0x38')][a20_0xea6e('0x21')](a20_0xea6e('0x43'),{'qos':0x2});this[a20_0xea6e('0x38')][a20_0xea6e('0x21')](a20_0xea6e('0x44'),{'qos':0x2});this['mqttClient'][a20_0xea6e('0x21')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a20_0xea6e('0x21')](a20_0xea6e('0x45'),{'qos':0x2});this[a20_0xea6e('0x38')][a20_0xea6e('0x21')](a20_0xea6e('0x46'),{'qos':0x2});this[a20_0xea6e('0x38')]['subscribe'](a20_0xea6e('0x47'),{'qos':0x2});this[a20_0xea6e('0x38')][a20_0xea6e('0x21')]('player/update_settings',{'qos':0x2});this[a20_0xea6e('0x38')]['subscribe'](a20_0xea6e('0x48'),{'qos':0x2});this[a20_0xea6e('0x38')][a20_0xea6e('0x21')](a20_0xea6e('0x49'),{'qos':0x2});}[a20_0xea6e('0x4a')](){}[a20_0xea6e('0x3c')](_0x1361b3,_0x39d484){console[a20_0xea6e('0x25')](a20_0xea6e('0x4b'),_0x1361b3,_0x39d484);switch(_0x1361b3){case a20_0xea6e('0x41'):return this[a20_0xea6e('0x4c')](_0x39d484);case a20_0xea6e('0x42'):return this[a20_0xea6e('0x4d')](_0x39d484);case a20_0xea6e('0x43'):return this['handleRebootRequest'](_0x39d484);case a20_0xea6e('0x4e'):return this[a20_0xea6e('0x4f')](_0x39d484);case a20_0xea6e('0x44'):return this[a20_0xea6e('0x50')](_0x39d484);case a20_0xea6e('0x45'):return this[a20_0xea6e('0x51')](_0x39d484);case a20_0xea6e('0x46'):return this[a20_0xea6e('0x52')](_0x39d484);case'player/register':return this[a20_0xea6e('0x53')](_0x39d484);case a20_0xea6e('0x54'):return this['handleUpdateSettingsRequest'](_0x39d484);case'player/turn_off_tv':return this[a20_0xea6e('0x55')](_0x39d484);case a20_0xea6e('0x49'):return this[a20_0xea6e('0x56')](_0x39d484);}}['handleRegisterRequest'](_0x9d06e7){if(_0x9d06e7=='all'||_0x9d06e7==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){this[a20_0xea6e('0x9')]['registerClient']();}}['handleIfconfigRequest'](_0x3db19c){if(_0x3db19c==a20_0xea6e('0x58')||_0x3db19c==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){}}[a20_0xea6e('0x51')](_0x1b9469){console[a20_0xea6e('0x25')](a20_0xea6e('0x59')+_0x1b9469);if(_0x1b9469==a20_0xea6e('0x58')||_0x1b9469==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){const _0x538879=__dirname;const _0x319c24=require(a20_0xea6e('0x5a'))(_0x538879);console[a20_0xea6e('0x25')]('Git\x20updating');_0x319c24['pull']((_0xb3f09b,_0x99ef24)=>{if(_0xb3f09b){console[a20_0xea6e('0x25')](a20_0xea6e('0x5b'));this[a20_0xea6e('0x51')](_0x1b9469);return;}else{}console[a20_0xea6e('0x25')]('Git\x20updated');console[a20_0xea6e('0x25')](_0x99ef24);if(_0x99ef24&&_0x99ef24[a20_0xea6e('0x5c')]['changes']){this[a20_0xea6e('0x9')][a20_0xea6e('0x5d')]();}else{}});}}[a20_0xea6e('0x50')](_0x57d497){if(_0x57d497==a20_0xea6e('0x58')||_0x57d497==String(this['syncPlaylistsService'][a20_0xea6e('0x57')])){this[a20_0xea6e('0x9')]['loadMediaList']();}}[a20_0xea6e('0x4f')](_0x3feecd){if(String(_0x3feecd)==a20_0xea6e('0x58')||String(_0x3feecd)==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){this['syncPlaylistsService']['reloadMediaList']();}}[a20_0xea6e('0x5e')](_0x2ef877){if(_0x2ef877==a20_0xea6e('0x58')||_0x2ef877==String(this['syncPlaylistsService'][a20_0xea6e('0x57')])){console[a20_0xea6e('0x25')](a20_0xea6e('0x5f'));try{this[a20_0xea6e('0x9')][a20_0xea6e('0x5d')]();}catch(_0x39b694){console['log'](_0x39b694);}}}[a20_0xea6e('0x60')](_0x217f99){if(_0x217f99==a20_0xea6e('0x58')||_0x217f99==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){console[a20_0xea6e('0x25')](a20_0xea6e('0x61'));try{this[a20_0xea6e('0x9')]['updateSettings']();}catch(_0x10f9a0){console[a20_0xea6e('0x25')](_0x10f9a0);}}}[a20_0xea6e('0x56')](_0x17a216){if(_0x17a216==a20_0xea6e('0x58')||_0x17a216==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){console[a20_0xea6e('0x25')]('handleTurnOnTVRequest:\x20');try{this[a20_0xea6e('0x9')][a20_0xea6e('0x62')]();}catch(_0x53e932){console['log'](_0x53e932);}}}['handleTurnOffTVRequest'](_0xef5916){if(_0xef5916==a20_0xea6e('0x58')||_0xef5916==String(this[a20_0xea6e('0x9')][a20_0xea6e('0x57')])){console[a20_0xea6e('0x25')](a20_0xea6e('0x63'));try{this[a20_0xea6e('0x9')][a20_0xea6e('0x64')]();}catch(_0x389d3a){console[a20_0xea6e('0x25')](_0x389d3a);}}}[a20_0xea6e('0x65')](){console[a20_0xea6e('0x25')](a20_0xea6e('0x66'),this[a20_0xea6e('0xa')]);this[a20_0xea6e('0x38')][a20_0xea6e('0x29')](a20_0xea6e('0x67'),this[a20_0xea6e('0x9')]['playerId']+'-'+this['state']);}[a20_0xea6e('0x4c')](_0x2ecfba){if(this[a20_0xea6e('0xa')]!==a20_0xea6e('0x68')&&this[a20_0xea6e('0xa')]!==a20_0xea6e('0x69')){console[a20_0xea6e('0x25')](a20_0xea6e('0x6a'));this[a20_0xea6e('0xa')]='opening';this[a20_0xea6e('0x65')]();setTimeout(()=>{this[a20_0xea6e('0xa')]=a20_0xea6e('0x68');this[a20_0xea6e('0x65')]();},0x1388);}}[a20_0xea6e('0x4d')](_0x185b22){if(this[a20_0xea6e('0xa')]!=='closed'&&this[a20_0xea6e('0xa')]!==a20_0xea6e('0x6b')){this['state']=a20_0xea6e('0x6b');this[a20_0xea6e('0x65')]();setTimeout(()=>{this[a20_0xea6e('0xa')]=a20_0xea6e('0xb');this[a20_0xea6e('0x65')]();},0x1388);}}[a20_0xea6e('0x3f')](_0x2e9037,_0x5d5d71){if(_0x5d5d71){console[a20_0xea6e('0x25')](_0x5d5d71[a20_0xea6e('0x6c')]);}this['mqttClient']['publish'](a20_0xea6e('0x6d'),'false');}[a20_0xea6e('0x1b')](_0x1d0540,_0x5ace76,_0x2d51b0){const _0x4c90c4={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a20_0xea6e('0x1e')](Date[a20_0xea6e('0x1f')]()/0x3e8)+0x14*0x3c,'aud':_0x1d0540};const _0xc83e5e=fs['readFileSync'](_0x5ace76);return jwt[a20_0xea6e('0x6e')](_0x4c90c4,_0xc83e5e,{'algorithm':_0x2d51b0});}}exports[a20_0xea6e('0x6f')]=MqttService;