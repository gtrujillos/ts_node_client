var a18_0x775c=['exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','state','closed','httpClientService','HttpClientService','init','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','projects/','/locations/','/registries/','/devices/','unused','TLSv1_2_method','round','now','connect','subscribe','/config','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish\x20result:','close','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','Command\x20message\x20received:\x20','from','toString','ascii','packetsend','mqttInit_mosquitto','clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','bind','message','mqttClient_message','mqttClient','exit','handleAppExit','SIGINT','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleCloseRequest','handleRebootRequest','handleLoadPlaylistRequest','handleIfconfigRequest','player/update_settings','handleRegisterRequest','all','syncPlaylistsService','playerId','registerClient','handleUpdateRequest','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','publish','opening','opening\x20player\x20door','open','closing','stack','player/connected','false','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process'];(function(_0x3a034e,_0x42782b){var _0x57a9e8=function(_0x82727e){while(--_0x82727e){_0x3a034e['push'](_0x3a034e['shift']());}};_0x57a9e8(++_0x42782b);}(a18_0x775c,0xdb));var a18_0x2ea2=function(_0x52aa69,_0x4e5342){_0x52aa69=_0x52aa69-0x0;var _0x4d69e6=a18_0x775c[_0x52aa69];return _0x4d69e6;};'use strict';Object[a18_0x2ea2('0x0')](exports,a18_0x2ea2('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2ea2('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2ea2('0x3'));const request=require(a18_0x2ea2('0x4'));const progress=require(a18_0x2ea2('0x5'));const spawn=require(a18_0x2ea2('0x6'))['spawn'];const exec=require(a18_0x2ea2('0x6'))[a18_0x2ea2('0x7')];const isImage=require(a18_0x2ea2('0x8'));const format=require(a18_0x2ea2('0x9'));const os=require('os');const mqtt=require(a18_0x2ea2('0xa'));const uuidv4=require(a18_0x2ea2('0xb'));const jwt=require(a18_0x2ea2('0xc'));class MqttService{constructor(_0x150739){this['syncPlaylistsService']=_0x150739;this[a18_0x2ea2('0xd')]=a18_0x2ea2('0xe');this[a18_0x2ea2('0xf')]=new HttpClientService_1[(a18_0x2ea2('0x10'))]();}[a18_0x2ea2('0x11')](){this['mqttInit_mosquitto']();}['mqttInit_google'](){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x13'));const _0x5d3612=a18_0x2ea2('0x14');const _0x565d78=a18_0x2ea2('0x15');const _0x50e871=a18_0x2ea2('0x16');const _0x5bb3a3=a18_0x2ea2('0x17');const _0x21c4d2=a18_0x2ea2('0x18');const _0x3eed45=a18_0x2ea2('0x19');const _0x58a7e7=a18_0x2ea2('0x1a');const _0x36c34f=0x1bb;const _0xb21329='events';const _0x2c10b4=0x5;const _0x4f5c9e=a18_0x2ea2('0x1b')+_0x5d3612+a18_0x2ea2('0x1c')+_0x5bb3a3+a18_0x2ea2('0x1d')+_0x50e871+a18_0x2ea2('0x1e')+_0x565d78;const _0x1a0cac={'host':_0x58a7e7,'port':_0x36c34f,'clientId':_0x4f5c9e,'username':a18_0x2ea2('0x1f'),'password':this['createJwt'](_0x5d3612,_0x3eed45,_0x21c4d2),'protocol':'mqtts','secureProtocol':a18_0x2ea2('0x20')};const _0x518c5f=Math[a18_0x2ea2('0x21')](Date[a18_0x2ea2('0x22')]()/0x3e8);const _0x231b39=mqtt[a18_0x2ea2('0x23')](_0x1a0cac);_0x231b39[a18_0x2ea2('0x24')](a18_0x2ea2('0x1e')+_0x565d78+a18_0x2ea2('0x25'),{'qos':0x1});_0x231b39[a18_0x2ea2('0x24')](a18_0x2ea2('0x1e')+_0x565d78+'/state',{'qos':0x1});_0x231b39[a18_0x2ea2('0x24')](a18_0x2ea2('0x1e')+_0x565d78+'/commands/#',{'qos':0x0});const _0x5557b4=a18_0x2ea2('0x1e')+_0x565d78+'/'+_0xb21329;_0x231b39['on'](a18_0x2ea2('0x23'),_0xb6a959=>{console[a18_0x2ea2('0x12')](a18_0x2ea2('0x23'));if(!_0xb6a959){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x26'));}else{const _0x5557b4=a18_0x2ea2('0x27');const _0x2faab1=_0x50e871+'/'+_0x565d78+a18_0x2ea2('0x28');_0x231b39['publish'](_0x5557b4,_0x2faab1,{'qos':0x1},_0x1aa1c8=>{console[a18_0x2ea2('0x12')](a18_0x2ea2('0x29'));console[a18_0x2ea2('0x12')](_0x1aa1c8);if(!_0x1aa1c8){}});}});_0x231b39['on'](a18_0x2ea2('0x2a'),()=>{console[a18_0x2ea2('0x12')](a18_0x2ea2('0x2a'));});_0x231b39['on']('error',_0x151bca=>{console[a18_0x2ea2('0x12')]('error',_0x151bca);});_0x231b39['on']('message',(_0x25ce83,_0x226150)=>{let _0x34ca96=a18_0x2ea2('0x2b');console[a18_0x2ea2('0x12')](_0x25ce83);console[a18_0x2ea2('0x12')](_0x226150+'');if(_0x25ce83==='/devices/'+_0x565d78+a18_0x2ea2('0x25')){_0x34ca96=a18_0x2ea2('0x2c');}else if(_0x25ce83[a18_0x2ea2('0x2d')](a18_0x2ea2('0x1e')+_0x565d78+a18_0x2ea2('0x2e'))){_0x34ca96=a18_0x2ea2('0x2f');}_0x34ca96+=Buffer[a18_0x2ea2('0x30')](_0x226150,'base64')[a18_0x2ea2('0x31')](a18_0x2ea2('0x32'));console[a18_0x2ea2('0x12')](_0x34ca96);});_0x231b39['on'](a18_0x2ea2('0x33'),()=>{});console[a18_0x2ea2('0x12')](_0x1a0cac);}[a18_0x2ea2('0x34')](){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x13'));this[a18_0x2ea2('0x35')]=uuidv4();console[a18_0x2ea2('0x12')]('this.clientId');console[a18_0x2ea2('0x12')](this[a18_0x2ea2('0x35')]);const _0x51c751={'clientId':this[a18_0x2ea2('0x35')],'username':a18_0x2ea2('0x36'),'password':a18_0x2ea2('0x37'),'clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x2ea2('0x38'),_0x51c751);this['mqttClient']['on'](a18_0x2ea2('0x23'),this['mqttClient_connect'][a18_0x2ea2('0x39')](this));this['mqttClient']['on'](a18_0x2ea2('0x3a'),this[a18_0x2ea2('0x3b')][a18_0x2ea2('0x39')](this));this[a18_0x2ea2('0x3c')]['on']('close',()=>{console[a18_0x2ea2('0x12')](a18_0x2ea2('0x2a'));});process['on'](a18_0x2ea2('0x3d'),this[a18_0x2ea2('0x3e')]['bind'](this));process['on'](a18_0x2ea2('0x3f'),this[a18_0x2ea2('0x3e')][a18_0x2ea2('0x39')](this));process['on']('uncaughtException',this[a18_0x2ea2('0x3e')][a18_0x2ea2('0x39')](this));}[a18_0x2ea2('0x40')](){console['log'](a18_0x2ea2('0x41')+this['clientId']);this[a18_0x2ea2('0x3c')][a18_0x2ea2('0x24')](a18_0x2ea2('0x42'));this[a18_0x2ea2('0x3c')][a18_0x2ea2('0x24')]('player/close');this[a18_0x2ea2('0x3c')]['subscribe'](a18_0x2ea2('0x43'),{'qos':0x2});this['mqttClient'][a18_0x2ea2('0x24')](a18_0x2ea2('0x44'),{'qos':0x2});this[a18_0x2ea2('0x3c')][a18_0x2ea2('0x24')](a18_0x2ea2('0x45'),{'qos':0x2});this['mqttClient'][a18_0x2ea2('0x24')](a18_0x2ea2('0x46'),{'qos':0x2});this[a18_0x2ea2('0x3c')]['subscribe'](a18_0x2ea2('0x47'),{'qos':0x2});this['mqttClient'][a18_0x2ea2('0x24')](a18_0x2ea2('0x48'),{'qos':0x2});this[a18_0x2ea2('0x3c')][a18_0x2ea2('0x24')]('player/update_settings',{'qos':0x2});}['reportStatus'](){}['mqttClient_message'](_0x34790e,_0x4f1c6e){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x49'),_0x34790e,_0x4f1c6e);switch(_0x34790e){case a18_0x2ea2('0x42'):return this[a18_0x2ea2('0x4a')](_0x4f1c6e);case a18_0x2ea2('0x4b'):return this[a18_0x2ea2('0x4c')](_0x4f1c6e);case'player/reboot':return this[a18_0x2ea2('0x4d')](_0x4f1c6e);case a18_0x2ea2('0x45'):return this['handleReloadPlaylistRequest'](_0x4f1c6e);case a18_0x2ea2('0x44'):return this[a18_0x2ea2('0x4e')](_0x4f1c6e);case a18_0x2ea2('0x46'):return this['handleUpdateRequest'](_0x4f1c6e);case a18_0x2ea2('0x47'):return this[a18_0x2ea2('0x4f')](_0x4f1c6e);case a18_0x2ea2('0x48'):return this['handleRegisterRequest'](_0x4f1c6e);case a18_0x2ea2('0x50'):return this['handleUpdateSettingsRequest'](_0x4f1c6e);}}[a18_0x2ea2('0x51')](_0x3966cd){if(_0x3966cd==a18_0x2ea2('0x52')||_0x3966cd==String(this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')])){this[a18_0x2ea2('0x53')][a18_0x2ea2('0x55')]();}}[a18_0x2ea2('0x4f')](_0x391987){if(_0x391987==a18_0x2ea2('0x52')||_0x391987==String(this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')])){}}[a18_0x2ea2('0x56')](_0x179f96){console['log']('handleUpdateRequest:\x20'+_0x179f96);if(_0x179f96=='all'||_0x179f96==String(this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')])){const _0x269cc8=__dirname;const _0x41bf8f=require(a18_0x2ea2('0x57'))(_0x269cc8);console['log'](a18_0x2ea2('0x58'));_0x41bf8f[a18_0x2ea2('0x59')]((_0x163d8b,_0x295878)=>{if(_0x163d8b){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x5a'));this[a18_0x2ea2('0x56')](_0x179f96);return;}else{}console[a18_0x2ea2('0x12')](a18_0x2ea2('0x5b'));console[a18_0x2ea2('0x12')](_0x295878);if(_0x295878&&_0x295878[a18_0x2ea2('0x5c')][a18_0x2ea2('0x5d')]){this[a18_0x2ea2('0x53')][a18_0x2ea2('0x5e')]();}else{}});}}[a18_0x2ea2('0x4e')](_0x3c283a){if(_0x3c283a==a18_0x2ea2('0x52')||_0x3c283a==String(this['syncPlaylistsService'][a18_0x2ea2('0x54')])){this['syncPlaylistsService'][a18_0x2ea2('0x5f')]();}}['handleReloadPlaylistRequest'](_0x5fde6){if(String(_0x5fde6)=='all'||String(_0x5fde6)==String(this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')])){this['syncPlaylistsService'][a18_0x2ea2('0x60')]();}}['handleRebootRequest'](_0x4225e2){if(_0x4225e2==a18_0x2ea2('0x52')||_0x4225e2==String(this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')])){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x61'));try{this[a18_0x2ea2('0x53')][a18_0x2ea2('0x5e')]();}catch(_0x5173dc){console[a18_0x2ea2('0x12')](_0x5173dc);}}}[a18_0x2ea2('0x62')](_0xc68ab){if(_0xc68ab==a18_0x2ea2('0x52')||_0xc68ab==String(this[a18_0x2ea2('0x53')]['playerId'])){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x63'));try{this[a18_0x2ea2('0x53')][a18_0x2ea2('0x64')]();}catch(_0x567f7a){console[a18_0x2ea2('0x12')](_0x567f7a);}}}[a18_0x2ea2('0x65')](){console['log'](a18_0x2ea2('0x66'),this[a18_0x2ea2('0xd')]);this[a18_0x2ea2('0x3c')][a18_0x2ea2('0x67')]('player/state',this[a18_0x2ea2('0x53')][a18_0x2ea2('0x54')]+'-'+this[a18_0x2ea2('0xd')]);}[a18_0x2ea2('0x4a')](_0x4dae7b){if(this[a18_0x2ea2('0xd')]!=='open'&&this[a18_0x2ea2('0xd')]!==a18_0x2ea2('0x68')){console[a18_0x2ea2('0x12')](a18_0x2ea2('0x69'));this['state']=a18_0x2ea2('0x68');this[a18_0x2ea2('0x65')]();setTimeout(()=>{this[a18_0x2ea2('0xd')]=a18_0x2ea2('0x6a');this[a18_0x2ea2('0x65')]();},0x1388);}}[a18_0x2ea2('0x4c')](_0x3e2287){if(this['state']!=='closed'&&this[a18_0x2ea2('0xd')]!==a18_0x2ea2('0x6b')){this[a18_0x2ea2('0xd')]=a18_0x2ea2('0x6b');this[a18_0x2ea2('0x65')]();setTimeout(()=>{this[a18_0x2ea2('0xd')]=a18_0x2ea2('0xe');this[a18_0x2ea2('0x65')]();},0x1388);}}[a18_0x2ea2('0x3e')](_0x1faa4b,_0x307320){if(_0x307320){console['log'](_0x307320[a18_0x2ea2('0x6c')]);}this['mqttClient']['publish'](a18_0x2ea2('0x6d'),a18_0x2ea2('0x6e'));}['createJwt'](_0x460aa8,_0x465d93,_0xa5eba4){const _0x171d64={'iat':Math[a18_0x2ea2('0x21')](Date[a18_0x2ea2('0x22')]()/0x3e8),'exp':Math['round'](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x460aa8};const _0x25f43b=fs[a18_0x2ea2('0x6f')](_0x465d93);return jwt[a18_0x2ea2('0x70')](_0x171d64,_0x25f43b,{'algorithm':_0xa5eba4});}}exports['MqttService']=MqttService;