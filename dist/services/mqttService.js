var a18_0x3677=['mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/reboot','player/load_playlist','player/reload_playlist','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','player/close','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','changes','loadMediaList','reloadMediaList','handleRebootRequest','shutdown','sendStateUpdate','sending\x20state\x20%s','state','publish','player/state','open','opening','handleCloseRequest','closing','stack','player/connected','false','readFileSync','sign','MqttService','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','is-image','string-template','uuid/v4','jsonwebtoken','syncPlaylistsService','closed','HttpClientService','mqttInit_mosquitto','mqttInit_google','mqttInit','my-node-device','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','projects/','/locations/','/registries/','/devices/','createJwt','TLSv1_2_method','round','now','connect','subscribe','/state','/commands/#','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','handleAppExit','SIGINT'];(function(_0x303898,_0x1a633a){var _0x542c15=function(_0x1576d4){while(--_0x1576d4){_0x303898['push'](_0x303898['shift']());}};_0x542c15(++_0x1a633a);}(a18_0x3677,0xfe));var a18_0x1bed=function(_0x1b84ce,_0xa4cf05){_0x1b84ce=_0x1b84ce-0x0;var _0x120a2e=a18_0x3677[_0x1b84ce];return _0x120a2e;};'use strict';Object['defineProperty'](exports,a18_0x1bed('0x0'),{'value':!![]});const HttpClientService_1=require(a18_0x1bed('0x1'));const fs=require('fs');const fsExtra=require(a18_0x1bed('0x2'));const request=require(a18_0x1bed('0x3'));const progress=require('request-progress');const spawn=require(a18_0x1bed('0x4'))[a18_0x1bed('0x5')];const isImage=require(a18_0x1bed('0x6'));const format=require(a18_0x1bed('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x1bed('0x8'));const jwt=require(a18_0x1bed('0x9'));class MqttService{constructor(_0x1665e5){this[a18_0x1bed('0xa')]=_0x1665e5;this['state']=a18_0x1bed('0xb');this['httpClientService']=new HttpClientService_1[(a18_0x1bed('0xc'))]();}['init'](){this[a18_0x1bed('0xd')]();}[a18_0x1bed('0xe')](){console['log'](a18_0x1bed('0xf'));const _0x5f30a3='velvety-glazing-252020';const _0x22b9e4=a18_0x1bed('0x10');const _0x2ef24e=a18_0x1bed('0x11');const _0x53920c=a18_0x1bed('0x12');const _0x5503fb=a18_0x1bed('0x13');const _0x1a80ed=a18_0x1bed('0x14');const _0x40a644=a18_0x1bed('0x15');const _0x51e0a2=0x1bb;const _0x3129b4='events';const _0x39ef30=0x5;const _0x39b5df=a18_0x1bed('0x16')+_0x5f30a3+a18_0x1bed('0x17')+_0x53920c+a18_0x1bed('0x18')+_0x2ef24e+a18_0x1bed('0x19')+_0x22b9e4;const _0x31ea89={'host':_0x40a644,'port':_0x51e0a2,'clientId':_0x39b5df,'username':'unused','password':this[a18_0x1bed('0x1a')](_0x5f30a3,_0x1a80ed,_0x5503fb),'protocol':'mqtts','secureProtocol':a18_0x1bed('0x1b')};const _0x9cbe8e=Math[a18_0x1bed('0x1c')](Date[a18_0x1bed('0x1d')]()/0x3e8);const _0xfddb3e=mqtt[a18_0x1bed('0x1e')](_0x31ea89);_0xfddb3e[a18_0x1bed('0x1f')](a18_0x1bed('0x19')+_0x22b9e4+'/config',{'qos':0x1});_0xfddb3e[a18_0x1bed('0x1f')](a18_0x1bed('0x19')+_0x22b9e4+a18_0x1bed('0x20'),{'qos':0x1});_0xfddb3e[a18_0x1bed('0x1f')]('/devices/'+_0x22b9e4+a18_0x1bed('0x21'),{'qos':0x0});const _0x1de12a=a18_0x1bed('0x19')+_0x22b9e4+'/'+_0x3129b4;_0xfddb3e['on']('connect',_0x348b81=>{console[a18_0x1bed('0x22')](a18_0x1bed('0x1e'));if(!_0x348b81){console[a18_0x1bed('0x22')](a18_0x1bed('0x23'));}else{const _0x1de12a=a18_0x1bed('0x24');const _0x3c3a5e=_0x2ef24e+'/'+_0x22b9e4+a18_0x1bed('0x25');_0xfddb3e['publish'](_0x1de12a,_0x3c3a5e,{'qos':0x1},_0x106413=>{console[a18_0x1bed('0x22')]('publish\x20result:');console[a18_0x1bed('0x22')](_0x106413);if(!_0x106413){}});}});_0xfddb3e['on'](a18_0x1bed('0x26'),()=>{console[a18_0x1bed('0x22')](a18_0x1bed('0x26'));});_0xfddb3e['on'](a18_0x1bed('0x27'),_0x5a480b=>{console[a18_0x1bed('0x22')](a18_0x1bed('0x27'),_0x5a480b);});_0xfddb3e['on']('message',(_0x2981b3,_0x453d92)=>{let _0xe1ef0e=a18_0x1bed('0x28');console['log'](_0x2981b3);console['log'](_0x453d92+'');if(_0x2981b3===a18_0x1bed('0x19')+_0x22b9e4+a18_0x1bed('0x29')){_0xe1ef0e=a18_0x1bed('0x2a');}else if(_0x2981b3['startsWith'](a18_0x1bed('0x19')+_0x22b9e4+'/commands')){_0xe1ef0e='Command\x20message\x20received:\x20';}_0xe1ef0e+=Buffer[a18_0x1bed('0x2b')](_0x453d92,a18_0x1bed('0x2c'))[a18_0x1bed('0x2d')](a18_0x1bed('0x2e'));console[a18_0x1bed('0x22')](_0xe1ef0e);});_0xfddb3e['on'](a18_0x1bed('0x2f'),()=>{});console[a18_0x1bed('0x22')](_0x31ea89);}[a18_0x1bed('0xd')](){console[a18_0x1bed('0x22')](a18_0x1bed('0xf'));this[a18_0x1bed('0x30')]=uuidv4();console['log'](a18_0x1bed('0x31'));console['log'](this['clientId']);const _0x3f2184={'clientId':this['clientId'],'username':a18_0x1bed('0x32'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x1bed('0x33')]=mqtt[a18_0x1bed('0x1e')](a18_0x1bed('0x34'),_0x3f2184);this['mqttClient']['on'](a18_0x1bed('0x1e'),this['mqttClient_connect'][a18_0x1bed('0x35')](this));this[a18_0x1bed('0x33')]['on']('message',this[a18_0x1bed('0x36')]['bind'](this));this['mqttClient']['on'](a18_0x1bed('0x26'),()=>{console['log'](a18_0x1bed('0x26'));});process['on'](a18_0x1bed('0x37'),this[a18_0x1bed('0x38')]['bind'](this));process['on'](a18_0x1bed('0x39'),this['handleAppExit'][a18_0x1bed('0x35')](this));process['on']('uncaughtException',this[a18_0x1bed('0x38')][a18_0x1bed('0x35')](this));}[a18_0x1bed('0x3a')](){console[a18_0x1bed('0x22')](a18_0x1bed('0x3b')+this['clientId']);this[a18_0x1bed('0x33')]['subscribe'](a18_0x1bed('0x3c'));this['mqttClient'][a18_0x1bed('0x1f')]('player/close');this[a18_0x1bed('0x33')][a18_0x1bed('0x1f')](a18_0x1bed('0x3d'),{'qos':0x2});this[a18_0x1bed('0x33')]['subscribe'](a18_0x1bed('0x3e'),{'qos':0x2});this[a18_0x1bed('0x33')][a18_0x1bed('0x1f')](a18_0x1bed('0x3f'),{'qos':0x2});this[a18_0x1bed('0x33')][a18_0x1bed('0x1f')]('player/update',{'qos':0x2});this['mqttClient'][a18_0x1bed('0x1f')](a18_0x1bed('0x40'),{'qos':0x2});this[a18_0x1bed('0x33')][a18_0x1bed('0x1f')](a18_0x1bed('0x41'),{'qos':0x2});}[a18_0x1bed('0x42')](){}[a18_0x1bed('0x36')](_0x22c0ab,_0x31d0ed){console['log'](a18_0x1bed('0x43'),_0x22c0ab,_0x31d0ed);switch(_0x22c0ab){case a18_0x1bed('0x3c'):return this[a18_0x1bed('0x44')](_0x31d0ed);case a18_0x1bed('0x45'):return this['handleCloseRequest'](_0x31d0ed);case a18_0x1bed('0x3d'):return this['handleRebootRequest'](_0x31d0ed);case a18_0x1bed('0x3f'):return this[a18_0x1bed('0x46')](_0x31d0ed);case a18_0x1bed('0x3e'):return this[a18_0x1bed('0x47')](_0x31d0ed);case a18_0x1bed('0x48'):return this[a18_0x1bed('0x49')](_0x31d0ed);case a18_0x1bed('0x40'):return this[a18_0x1bed('0x4a')](_0x31d0ed);case a18_0x1bed('0x41'):return this[a18_0x1bed('0x4b')](_0x31d0ed);}}[a18_0x1bed('0x4b')](_0x16add2){if(_0x16add2==a18_0x1bed('0x4c')||_0x16add2==String(this[a18_0x1bed('0xa')][a18_0x1bed('0x4d')])){this['syncPlaylistsService'][a18_0x1bed('0x4e')]();}}[a18_0x1bed('0x4a')](_0x37c8e4){if(_0x37c8e4==a18_0x1bed('0x4c')||_0x37c8e4==String(this[a18_0x1bed('0xa')][a18_0x1bed('0x4d')])){}}[a18_0x1bed('0x49')](_0x29bb43){console[a18_0x1bed('0x22')](a18_0x1bed('0x4f')+_0x29bb43);if(_0x29bb43=='all'||_0x29bb43==String(this[a18_0x1bed('0xa')][a18_0x1bed('0x4d')])){const _0x2259d4=__dirname;const _0x14ff94=require(a18_0x1bed('0x50'))(_0x2259d4);console['log']('Git\x20updating');_0x14ff94[a18_0x1bed('0x51')]((_0x3e5965,_0x19ebcd)=>{if(_0x3e5965){console[a18_0x1bed('0x22')](a18_0x1bed('0x52'));this['handleUpdateRequest'](_0x29bb43);return;}else{}console[a18_0x1bed('0x22')](a18_0x1bed('0x53'));console[a18_0x1bed('0x22')](_0x19ebcd);if(_0x19ebcd&&_0x19ebcd['summary'][a18_0x1bed('0x54')]){const _0x2e0e48=spawn('shutdown',['-r',a18_0x1bed('0x1d')]);}else{}});}}['handleLoadPlaylistRequest'](_0x3475f1){if(_0x3475f1==a18_0x1bed('0x4c')||_0x3475f1==String(this[a18_0x1bed('0xa')][a18_0x1bed('0x4d')])){this[a18_0x1bed('0xa')][a18_0x1bed('0x55')]();}}[a18_0x1bed('0x46')](_0x3f7341){if(String(_0x3f7341)==a18_0x1bed('0x4c')||String(_0x3f7341)==String(this[a18_0x1bed('0xa')][a18_0x1bed('0x4d')])){this[a18_0x1bed('0xa')][a18_0x1bed('0x56')]();}}['handleRebootRequest'](_0x253c8c){if(_0x253c8c=='all'||_0x253c8c==String(this['syncPlaylistsService'][a18_0x1bed('0x4d')])){console[a18_0x1bed('0x22')](a18_0x1bed('0x57'));try{const _0x15061f=spawn(a18_0x1bed('0x58'),['-r',a18_0x1bed('0x1d')]);}catch(_0x460e40){console[a18_0x1bed('0x22')](_0x460e40);}}}[a18_0x1bed('0x59')](){console['log'](a18_0x1bed('0x5a'),this[a18_0x1bed('0x5b')]);this[a18_0x1bed('0x33')][a18_0x1bed('0x5c')](a18_0x1bed('0x5d'),this['syncPlaylistsService']['playerId']+'-'+this[a18_0x1bed('0x5b')]);}[a18_0x1bed('0x44')](_0x1e89e7){if(this[a18_0x1bed('0x5b')]!==a18_0x1bed('0x5e')&&this[a18_0x1bed('0x5b')]!==a18_0x1bed('0x5f')){console['log']('opening\x20player\x20door');this[a18_0x1bed('0x5b')]=a18_0x1bed('0x5f');this[a18_0x1bed('0x59')]();setTimeout(()=>{this[a18_0x1bed('0x5b')]=a18_0x1bed('0x5e');this[a18_0x1bed('0x59')]();},0x1388);}}[a18_0x1bed('0x60')](_0x5b876f){if(this[a18_0x1bed('0x5b')]!=='closed'&&this[a18_0x1bed('0x5b')]!==a18_0x1bed('0x61')){this[a18_0x1bed('0x5b')]=a18_0x1bed('0x61');this[a18_0x1bed('0x59')]();setTimeout(()=>{this[a18_0x1bed('0x5b')]=a18_0x1bed('0xb');this[a18_0x1bed('0x59')]();},0x1388);}}['handleAppExit'](_0x5bff4b,_0x4431be){if(_0x4431be){console['log'](_0x4431be[a18_0x1bed('0x62')]);}this['mqttClient'][a18_0x1bed('0x5c')](a18_0x1bed('0x63'),a18_0x1bed('0x64'));}['createJwt'](_0x45481f,_0x7e367b,_0x4477b4){const _0xbc460a={'iat':Math[a18_0x1bed('0x1c')](Date[a18_0x1bed('0x1d')]()/0x3e8),'exp':Math[a18_0x1bed('0x1c')](Date['now']()/0x3e8)+0x14*0x3c,'aud':_0x45481f};const _0x15bd4b=fs[a18_0x1bed('0x65')](_0x7e367b);return jwt[a18_0x1bed('0x66')](_0xbc460a,_0x15bd4b,{'algorithm':_0x4477b4});}}exports[a18_0x1bed('0x67')]=MqttService;