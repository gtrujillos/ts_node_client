var a18_0xc608=['received\x20message\x20%s\x20%s','handleCloseRequest','player/reboot','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleIfconfigRequest','player/register','handleUpdateSettingsRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','sendStateUpdate','player/state','state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','player/connected','readFileSync','MqttService','defineProperty','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','is-image','mqtt','jsonwebtoken','syncPlaylistsService','closed','HttpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','close','error','message','Message\x20received:\x20','/config','startsWith','/commands','Command\x20message\x20received:\x20','from','toString','ascii','packetsend','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','bind','exit','SIGINT','handleAppExit','uncaughtException','mqttClient_connect','Connected\x20to\x20broker\x20client:','player/open','player/close','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/update_settings','mqttClient_message'];(function(_0x305671,_0x5ab584){var _0x12bed9=function(_0x1200e7){while(--_0x1200e7){_0x305671['push'](_0x305671['shift']());}};_0x12bed9(++_0x5ab584);}(a18_0xc608,0x91));var a18_0x2571=function(_0x39e015,_0x3f4f23){_0x39e015=_0x39e015-0x0;var _0x4d55ab=a18_0xc608[_0x39e015];return _0x4d55ab;};'use strict';Object[a18_0x2571('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require(a18_0x2571('0x1'));const fs=require('fs');const fsExtra=require(a18_0x2571('0x2'));const request=require(a18_0x2571('0x3'));const progress=require(a18_0x2571('0x4'));const spawn=require('child_process')['spawn'];const exec=require(a18_0x2571('0x5'))['exec'];const isImage=require(a18_0x2571('0x6'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x2571('0x7'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x2571('0x8'));class MqttService{constructor(_0x1b37b0){this[a18_0x2571('0x9')]=_0x1b37b0;this['state']=a18_0x2571('0xa');this['httpClientService']=new HttpClientService_1[(a18_0x2571('0xb'))]();}[a18_0x2571('0xc')](){this[a18_0x2571('0xd')]();}['mqttInit_google'](){console[a18_0x2571('0xe')](a18_0x2571('0xf'));const _0x366861=a18_0x2571('0x10');const _0x106b0c='my-node-device';const _0x1c35ff=a18_0x2571('0x11');const _0x71efdc=a18_0x2571('0x12');const _0x3203f1=a18_0x2571('0x13');const _0x3c5422=a18_0x2571('0x14');const _0x3c82e9=a18_0x2571('0x15');const _0x20df8f=0x1bb;const _0x2315ad=a18_0x2571('0x16');const _0x203029=0x5;const _0x4a8318=a18_0x2571('0x17')+_0x366861+a18_0x2571('0x18')+_0x71efdc+a18_0x2571('0x19')+_0x1c35ff+a18_0x2571('0x1a')+_0x106b0c;const _0x2d4bd7={'host':_0x3c82e9,'port':_0x20df8f,'clientId':_0x4a8318,'username':a18_0x2571('0x1b'),'password':this[a18_0x2571('0x1c')](_0x366861,_0x3c5422,_0x3203f1),'protocol':a18_0x2571('0x1d'),'secureProtocol':a18_0x2571('0x1e')};const _0x5cb870=Math[a18_0x2571('0x1f')](Date[a18_0x2571('0x20')]()/0x3e8);const _0x573e72=mqtt[a18_0x2571('0x21')](_0x2d4bd7);_0x573e72[a18_0x2571('0x22')](a18_0x2571('0x1a')+_0x106b0c+'/config',{'qos':0x1});_0x573e72[a18_0x2571('0x22')](a18_0x2571('0x1a')+_0x106b0c+'/state',{'qos':0x1});_0x573e72[a18_0x2571('0x22')](a18_0x2571('0x1a')+_0x106b0c+a18_0x2571('0x23'),{'qos':0x0});const _0x3cac80=a18_0x2571('0x1a')+_0x106b0c+'/'+_0x2315ad;_0x573e72['on'](a18_0x2571('0x21'),_0x2eb9d1=>{console[a18_0x2571('0xe')](a18_0x2571('0x21'));if(!_0x2eb9d1){console[a18_0x2571('0xe')](a18_0x2571('0x24'));}else{const _0x3cac80=a18_0x2571('0x25');const _0x223d19=_0x1c35ff+'/'+_0x106b0c+a18_0x2571('0x26');_0x573e72[a18_0x2571('0x27')](_0x3cac80,_0x223d19,{'qos':0x1},_0x33a8d7=>{console[a18_0x2571('0xe')]('publish\x20result:');console[a18_0x2571('0xe')](_0x33a8d7);if(!_0x33a8d7){}});}});_0x573e72['on']('close',()=>{console[a18_0x2571('0xe')](a18_0x2571('0x28'));});_0x573e72['on'](a18_0x2571('0x29'),_0x5950c2=>{console[a18_0x2571('0xe')](a18_0x2571('0x29'),_0x5950c2);});_0x573e72['on'](a18_0x2571('0x2a'),(_0x26efdc,_0x5d4823)=>{let _0x4e32df=a18_0x2571('0x2b');console[a18_0x2571('0xe')](_0x26efdc);console[a18_0x2571('0xe')](_0x5d4823+'');if(_0x26efdc===a18_0x2571('0x1a')+_0x106b0c+a18_0x2571('0x2c')){_0x4e32df='Config\x20message\x20received:\x20';}else if(_0x26efdc[a18_0x2571('0x2d')](a18_0x2571('0x1a')+_0x106b0c+a18_0x2571('0x2e'))){_0x4e32df=a18_0x2571('0x2f');}_0x4e32df+=Buffer[a18_0x2571('0x30')](_0x5d4823,'base64')[a18_0x2571('0x31')](a18_0x2571('0x32'));console[a18_0x2571('0xe')](_0x4e32df);});_0x573e72['on'](a18_0x2571('0x33'),()=>{});console[a18_0x2571('0xe')](_0x2d4bd7);}[a18_0x2571('0xd')](){console[a18_0x2571('0xe')](a18_0x2571('0xf'));this[a18_0x2571('0x34')]=uuidv4();console[a18_0x2571('0xe')]('this.clientId');console[a18_0x2571('0xe')](this[a18_0x2571('0x34')]);const _0x3c3090={'clientId':this['clientId'],'username':a18_0x2571('0x35'),'password':a18_0x2571('0x36'),'clean':!![]};this[a18_0x2571('0x37')]=mqtt[a18_0x2571('0x21')]('mqtt://lulo.run',_0x3c3090);this['mqttClient']['on'](a18_0x2571('0x21'),this['mqttClient_connect'][a18_0x2571('0x38')](this));this[a18_0x2571('0x37')]['on'](a18_0x2571('0x2a'),this['mqttClient_message']['bind'](this));this['mqttClient']['on'](a18_0x2571('0x28'),()=>{console[a18_0x2571('0xe')]('close');});process['on'](a18_0x2571('0x39'),this['handleAppExit'][a18_0x2571('0x38')](this));process['on'](a18_0x2571('0x3a'),this[a18_0x2571('0x3b')][a18_0x2571('0x38')](this));process['on'](a18_0x2571('0x3c'),this[a18_0x2571('0x3b')][a18_0x2571('0x38')](this));}[a18_0x2571('0x3d')](){console[a18_0x2571('0xe')](a18_0x2571('0x3e')+this[a18_0x2571('0x34')]);this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x3f'));this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x40'));this[a18_0x2571('0x37')][a18_0x2571('0x22')]('player/reboot',{'qos':0x2});this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x41'),{'qos':0x2});this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x42'),{'qos':0x2});this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x43'),{'qos':0x2});this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x44'),{'qos':0x2});this['mqttClient'][a18_0x2571('0x22')]('player/register',{'qos':0x2});this[a18_0x2571('0x37')][a18_0x2571('0x22')](a18_0x2571('0x45'),{'qos':0x2});}['reportStatus'](){}[a18_0x2571('0x46')](_0x1ea304,_0x23df7c){console['log'](a18_0x2571('0x47'),_0x1ea304,_0x23df7c);switch(_0x1ea304){case a18_0x2571('0x3f'):return this['handleOpenRequest'](_0x23df7c);case'player/close':return this[a18_0x2571('0x48')](_0x23df7c);case a18_0x2571('0x49'):return this[a18_0x2571('0x4a')](_0x23df7c);case'player/reload_playlist':return this[a18_0x2571('0x4b')](_0x23df7c);case'player/load_playlist':return this[a18_0x2571('0x4c')](_0x23df7c);case a18_0x2571('0x43'):return this['handleUpdateRequest'](_0x23df7c);case a18_0x2571('0x44'):return this[a18_0x2571('0x4d')](_0x23df7c);case a18_0x2571('0x4e'):return this['handleRegisterRequest'](_0x23df7c);case a18_0x2571('0x45'):return this[a18_0x2571('0x4f')](_0x23df7c);}}[a18_0x2571('0x50')](_0x5b9805){if(_0x5b9805==a18_0x2571('0x51')||_0x5b9805==String(this[a18_0x2571('0x9')][a18_0x2571('0x52')])){this['syncPlaylistsService'][a18_0x2571('0x53')]();}}[a18_0x2571('0x4d')](_0x173e77){if(_0x173e77=='all'||_0x173e77==String(this[a18_0x2571('0x9')][a18_0x2571('0x52')])){}}[a18_0x2571('0x54')](_0x3a4b7c){console[a18_0x2571('0xe')](a18_0x2571('0x55')+_0x3a4b7c);if(_0x3a4b7c==a18_0x2571('0x51')||_0x3a4b7c==String(this['syncPlaylistsService'][a18_0x2571('0x52')])){const _0x269d6f=__dirname;const _0x20eed0=require('simple-git')(_0x269d6f);console['log'](a18_0x2571('0x56'));_0x20eed0[a18_0x2571('0x57')]((_0x3ae730,_0x5727cc)=>{if(_0x3ae730){console[a18_0x2571('0xe')](a18_0x2571('0x58'));this['handleUpdateRequest'](_0x3a4b7c);return;}else{}console['log'](a18_0x2571('0x59'));console[a18_0x2571('0xe')](_0x5727cc);if(_0x5727cc&&_0x5727cc[a18_0x2571('0x5a')][a18_0x2571('0x5b')]){this['syncPlaylistsService'][a18_0x2571('0x5c')]();}else{}});}}['handleLoadPlaylistRequest'](_0x468d98){if(_0x468d98=='all'||_0x468d98==String(this[a18_0x2571('0x9')][a18_0x2571('0x52')])){this[a18_0x2571('0x9')][a18_0x2571('0x5d')]();}}['handleReloadPlaylistRequest'](_0x5c0c4a){if(String(_0x5c0c4a)==a18_0x2571('0x51')||String(_0x5c0c4a)==String(this['syncPlaylistsService'][a18_0x2571('0x52')])){this[a18_0x2571('0x9')][a18_0x2571('0x5e')]();}}[a18_0x2571('0x4a')](_0x2a6449){if(_0x2a6449==a18_0x2571('0x51')||_0x2a6449==String(this[a18_0x2571('0x9')][a18_0x2571('0x52')])){console[a18_0x2571('0xe')](a18_0x2571('0x5f'));try{this[a18_0x2571('0x9')][a18_0x2571('0x5c')]();}catch(_0x3dfa33){console[a18_0x2571('0xe')](_0x3dfa33);}}}[a18_0x2571('0x4f')](_0x235ec5){if(_0x235ec5==a18_0x2571('0x51')||_0x235ec5==String(this['syncPlaylistsService'][a18_0x2571('0x52')])){console[a18_0x2571('0xe')](a18_0x2571('0x60'));try{this['syncPlaylistsService']['updateSettings']();}catch(_0x535fad){console[a18_0x2571('0xe')](_0x535fad);}}}[a18_0x2571('0x61')](){console[a18_0x2571('0xe')]('sending\x20state\x20%s',this['state']);this['mqttClient']['publish'](a18_0x2571('0x62'),this['syncPlaylistsService'][a18_0x2571('0x52')]+'-'+this[a18_0x2571('0x63')]);}[a18_0x2571('0x64')](_0x36be55){if(this[a18_0x2571('0x63')]!==a18_0x2571('0x65')&&this[a18_0x2571('0x63')]!==a18_0x2571('0x66')){console[a18_0x2571('0xe')](a18_0x2571('0x67'));this['state']='opening';this['sendStateUpdate']();setTimeout(()=>{this['state']='open';this[a18_0x2571('0x61')]();},0x1388);}}[a18_0x2571('0x48')](_0x2f4dae){if(this[a18_0x2571('0x63')]!==a18_0x2571('0xa')&&this[a18_0x2571('0x63')]!==a18_0x2571('0x68')){this[a18_0x2571('0x63')]='closing';this[a18_0x2571('0x61')]();setTimeout(()=>{this['state']=a18_0x2571('0xa');this[a18_0x2571('0x61')]();},0x1388);}}[a18_0x2571('0x3b')](_0x2f83a9,_0x52da5f){if(_0x52da5f){console['log'](_0x52da5f['stack']);}this[a18_0x2571('0x37')]['publish'](a18_0x2571('0x69'),'false');}[a18_0x2571('0x1c')](_0x22a0ea,_0xef4652,_0x54e55a){const _0x1078eb={'iat':Math['round'](Date[a18_0x2571('0x20')]()/0x3e8),'exp':Math[a18_0x2571('0x1f')](Date[a18_0x2571('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x22a0ea};const _0x17f18e=fs[a18_0x2571('0x6a')](_0xef4652);return jwt['sign'](_0x1078eb,_0x17f18e,{'algorithm':_0x54e55a});}}exports[a18_0x2571('0x6b')]=MqttService;