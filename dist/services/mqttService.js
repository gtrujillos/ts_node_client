var a18_0x41f5=['lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','reportStatus','received\x20message\x20%s\x20%s','handleOpenRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','playerId','handleUpdateRequest:\x20','Git\x20updating','pull','Error\x20git\x20updated','summary','changes','shutdown','now','loadMediaList','reloadMediaList','publish','player/state','state','sendStateUpdate','open','handleCloseRequest','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','child_process','spawn','is-image','uuid/v4','syncPlaylistsService','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId'];(function(_0x4b8751,_0x582f4b){var _0x5d1381=function(_0x19d886){while(--_0x19d886){_0x4b8751['push'](_0x4b8751['shift']());}};_0x5d1381(++_0x582f4b);}(a18_0x41f5,0x19e));var a18_0x2619=function(_0x37e05e,_0x25bcc2){_0x37e05e=_0x37e05e-0x0;var _0x1ea677=a18_0x41f5[_0x37e05e];return _0x1ea677;};'use strict';Object[a18_0x2619('0x0')](exports,a18_0x2619('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2619('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2619('0x3'));const request=require(a18_0x2619('0x4'));const progress=require('request-progress');const spawn=require(a18_0x2619('0x5'))[a18_0x2619('0x6')];const isImage=require(a18_0x2619('0x7'));const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x2619('0x8'));class MqttService{constructor(_0x22d6d8){this[a18_0x2619('0x9')]=_0x22d6d8;this['state']=a18_0x2619('0xa');this[a18_0x2619('0xb')]=new HttpClientService_1[(a18_0x2619('0xc'))]();}[a18_0x2619('0xd')](){this[a18_0x2619('0xe')]();}['mqttInit'](){console[a18_0x2619('0xf')]('mqttInit');this[a18_0x2619('0x10')]=uuidv4();console[a18_0x2619('0xf')](a18_0x2619('0x11'));console[a18_0x2619('0xf')](this['clientId']);const _0x40e7f7={'clientId':this['clientId'],'username':a18_0x2619('0x12'),'password':a18_0x2619('0x13'),'clean':!![]};this[a18_0x2619('0x14')]=mqtt[a18_0x2619('0x15')](a18_0x2619('0x16'),_0x40e7f7);this['mqttClient']['on'](a18_0x2619('0x15'),this[a18_0x2619('0x17')][a18_0x2619('0x18')](this));this['mqttClient']['on'](a18_0x2619('0x19'),this[a18_0x2619('0x1a')]['bind'](this));process['on'](a18_0x2619('0x1b'),this[a18_0x2619('0x1c')]['bind'](this));process['on']('SIGINT',this[a18_0x2619('0x1c')][a18_0x2619('0x18')](this));process['on'](a18_0x2619('0x1d'),this['handleAppExit'][a18_0x2619('0x18')](this));}[a18_0x2619('0x17')](){console[a18_0x2619('0xf')](a18_0x2619('0x1e')+this[a18_0x2619('0x10')]);this['mqttClient'][a18_0x2619('0x1f')](a18_0x2619('0x20'));this[a18_0x2619('0x14')][a18_0x2619('0x1f')](a18_0x2619('0x21'));this[a18_0x2619('0x14')][a18_0x2619('0x1f')](a18_0x2619('0x22'),{'qos':0x2});this[a18_0x2619('0x14')][a18_0x2619('0x1f')](a18_0x2619('0x23'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x2619('0x24'),{'qos':0x2});this[a18_0x2619('0x14')][a18_0x2619('0x1f')](a18_0x2619('0x25'),{'qos':0x2});this['mqttClient'][a18_0x2619('0x1f')](a18_0x2619('0x26'),{'qos':0x2});this[a18_0x2619('0x14')]['subscribe'](a18_0x2619('0x27'),{'qos':0x2});}[a18_0x2619('0x28')](){}['mqttClient_message'](_0x59cc12,_0x90738){console[a18_0x2619('0xf')](a18_0x2619('0x29'),_0x59cc12,_0x90738);switch(_0x59cc12){case'player/open':return this[a18_0x2619('0x2a')](_0x90738);case a18_0x2619('0x21'):return this['handleCloseRequest'](_0x90738);case a18_0x2619('0x22'):return this[a18_0x2619('0x2b')](_0x90738);case'player/reload_playlist':return this[a18_0x2619('0x2c')](_0x90738);case a18_0x2619('0x23'):return this[a18_0x2619('0x2d')](_0x90738);case'player/update':return this[a18_0x2619('0x2e')](_0x90738);case'player/ifconfig':return this[a18_0x2619('0x2f')](_0x90738);case'player/register':return this[a18_0x2619('0x30')](_0x90738);}}[a18_0x2619('0x30')](_0x6da240){if(_0x6da240==a18_0x2619('0x31')||_0x6da240==String(this[a18_0x2619('0x9')][a18_0x2619('0x32')])){this['syncPlaylistsService']['registerClient']();}}['handleIfconfigRequest'](_0x18e19a){if(_0x18e19a==a18_0x2619('0x31')||_0x18e19a==String(this[a18_0x2619('0x9')][a18_0x2619('0x32')])){}}['handleUpdateRequest'](_0x40286d){console[a18_0x2619('0xf')](a18_0x2619('0x33')+_0x40286d);if(_0x40286d==a18_0x2619('0x31')||_0x40286d==String(this[a18_0x2619('0x9')][a18_0x2619('0x32')])){const _0x2a5aa0=__dirname;const _0x560be1=require('simple-git')(_0x2a5aa0);console[a18_0x2619('0xf')](a18_0x2619('0x34'));_0x560be1[a18_0x2619('0x35')]((_0x15d731,_0x109839)=>{if(_0x15d731){console[a18_0x2619('0xf')](a18_0x2619('0x36'));this['handleUpdateRequest'](_0x40286d);return;}else{}console['log']('Git\x20updated');console[a18_0x2619('0xf')](_0x109839);if(_0x109839&&_0x109839[a18_0x2619('0x37')][a18_0x2619('0x38')]){const _0x18a747=spawn(a18_0x2619('0x39'),['-r',a18_0x2619('0x3a')]);}else{}});}}[a18_0x2619('0x2d')](_0x4ac9c0){if(_0x4ac9c0=='all'||_0x4ac9c0==String(this['syncPlaylistsService'][a18_0x2619('0x32')])){this['syncPlaylistsService'][a18_0x2619('0x3b')]();}}['handleReloadPlaylistRequest'](_0x293b3e){if(String(_0x293b3e)==a18_0x2619('0x31')||String(_0x293b3e)==String(this[a18_0x2619('0x9')][a18_0x2619('0x32')])){this['syncPlaylistsService'][a18_0x2619('0x3c')]();}}[a18_0x2619('0x2b')](_0x532f0b){if(_0x532f0b==a18_0x2619('0x31')||_0x532f0b==String(this[a18_0x2619('0x9')][a18_0x2619('0x32')])){const _0x44ea9a=spawn(a18_0x2619('0x39'),['-r','now']);}}['sendStateUpdate'](){console[a18_0x2619('0xf')]('sending\x20state\x20%s',this['state']);this[a18_0x2619('0x14')][a18_0x2619('0x3d')](a18_0x2619('0x3e'),this[a18_0x2619('0x9')][a18_0x2619('0x32')]+'-'+this[a18_0x2619('0x3f')]);}[a18_0x2619('0x2a')](_0x320659){if(this[a18_0x2619('0x3f')]!=='open'&&this[a18_0x2619('0x3f')]!=='opening'){console['log']('opening\x20player\x20door');this[a18_0x2619('0x3f')]='opening';this[a18_0x2619('0x40')]();setTimeout(()=>{this[a18_0x2619('0x3f')]=a18_0x2619('0x41');this[a18_0x2619('0x40')]();},0x1388);}}[a18_0x2619('0x42')](_0x3a8db3){if(this[a18_0x2619('0x3f')]!==a18_0x2619('0xa')&&this[a18_0x2619('0x3f')]!==a18_0x2619('0x43')){this[a18_0x2619('0x3f')]=a18_0x2619('0x43');this[a18_0x2619('0x40')]();setTimeout(()=>{this['state']=a18_0x2619('0xa');this[a18_0x2619('0x40')]();},0x1388);}}['handleAppExit'](_0xf6c66e,_0x50e3db){if(_0x50e3db){console['log'](_0x50e3db[a18_0x2619('0x44')]);}this[a18_0x2619('0x14')][a18_0x2619('0x3d')](a18_0x2619('0x45'),a18_0x2619('0x46'));}}exports[a18_0x2619('0x47')]=MqttService;