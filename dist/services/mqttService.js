var a18_0x4e52=['player/update','player/ifconfig','player/register','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleRegisterRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','shutdown','reloadMediaList','handleRebootRequest','sudo','sendStateUpdate','sending\x20state\x20%s','publish','state','open','opening','closed','closing','stack','false','readFileSync','sign','defineProperty','__esModule','fs-extra','request','request-progress','child_process','spawn','string-template','uuid/v4','syncPlaylistsService','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','mqttInit','velvety-glazing-252020','my-node-device','my-registry','RS256','resources/keys/rsa_private.pem','mqtt.googleapis.com','/locations/','/registries/','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round','now','connect','subscribe','/state','/commands/#','Client\x20not\x20connected...','-payload-0','publish\x20result:','close','error','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','Command\x20message\x20received:\x20','from','toString','ascii','packetsend','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','message','exit','SIGINT','handleAppExit','uncaughtException','mqttClient_connect','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a18_0x4e52,0x8e));var a18_0x7bad=function(_0x2cddc9,_0x4659c0){_0x2cddc9=_0x2cddc9-0x0;var _0x1a4f4e=a18_0x4e52[_0x2cddc9];return _0x1a4f4e;};'use strict';Object[a18_0x7bad('0x0')](exports,a18_0x7bad('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x7bad('0x2'));const request=require(a18_0x7bad('0x3'));const progress=require(a18_0x7bad('0x4'));const spawn=require(a18_0x7bad('0x5'))[a18_0x7bad('0x6')];const isImage=require('is-image');const format=require(a18_0x7bad('0x7'));const os=require('os');const mqtt=require('mqtt');const uuidv4=require(a18_0x7bad('0x8'));const jwt=require('jsonwebtoken');class MqttService{constructor(_0x1fd595){this[a18_0x7bad('0x9')]=_0x1fd595;this['state']='closed';this['httpClientService']=new HttpClientService_1[(a18_0x7bad('0xa'))]();}[a18_0x7bad('0xb')](){this[a18_0x7bad('0xc')]();}[a18_0x7bad('0xd')](){console[a18_0x7bad('0xe')](a18_0x7bad('0xf'));const _0x9d5ca4=a18_0x7bad('0x10');const _0x270e75=a18_0x7bad('0x11');const _0xddd311=a18_0x7bad('0x12');const _0x4b7c87='us-central1';const _0xd7b528=a18_0x7bad('0x13');const _0x238bed=a18_0x7bad('0x14');const _0x551cdc=a18_0x7bad('0x15');const _0x5326fc=0x1bb;const _0x26ee61='events';const _0x552799=0x5;const _0x10a6f1='projects/'+_0x9d5ca4+a18_0x7bad('0x16')+_0x4b7c87+a18_0x7bad('0x17')+_0xddd311+a18_0x7bad('0x18')+_0x270e75;const _0x56d61d={'host':_0x551cdc,'port':_0x5326fc,'clientId':_0x10a6f1,'username':a18_0x7bad('0x19'),'password':this[a18_0x7bad('0x1a')](_0x9d5ca4,_0x238bed,_0xd7b528),'protocol':a18_0x7bad('0x1b'),'secureProtocol':a18_0x7bad('0x1c')};const _0x3e7f34=Math[a18_0x7bad('0x1d')](Date[a18_0x7bad('0x1e')]()/0x3e8);const _0x1612d0=mqtt[a18_0x7bad('0x1f')](_0x56d61d);_0x1612d0[a18_0x7bad('0x20')](a18_0x7bad('0x18')+_0x270e75+'/config',{'qos':0x1});_0x1612d0['subscribe']('/devices/'+_0x270e75+a18_0x7bad('0x21'),{'qos':0x1});_0x1612d0['subscribe'](a18_0x7bad('0x18')+_0x270e75+a18_0x7bad('0x22'),{'qos':0x0});const _0xdc13ca=a18_0x7bad('0x18')+_0x270e75+'/'+_0x26ee61;_0x1612d0['on'](a18_0x7bad('0x1f'),_0x11f354=>{console[a18_0x7bad('0xe')](a18_0x7bad('0x1f'));if(!_0x11f354){console[a18_0x7bad('0xe')](a18_0x7bad('0x23'));}else{const _0xdc13ca='/projects/velvety-glazing-252020/topics/my-topic';const _0x2cbf1e=_0xddd311+'/'+_0x270e75+a18_0x7bad('0x24');_0x1612d0['publish'](_0xdc13ca,_0x2cbf1e,{'qos':0x1},_0x238dcc=>{console[a18_0x7bad('0xe')](a18_0x7bad('0x25'));console[a18_0x7bad('0xe')](_0x238dcc);if(!_0x238dcc){}});}});_0x1612d0['on']('close',()=>{console['log'](a18_0x7bad('0x26'));});_0x1612d0['on'](a18_0x7bad('0x27'),_0x5932e2=>{console[a18_0x7bad('0xe')](a18_0x7bad('0x27'),_0x5932e2);});_0x1612d0['on']('message',(_0x180de5,_0x238e06)=>{let _0x2f9b94=a18_0x7bad('0x28');console['log'](_0x180de5);console[a18_0x7bad('0xe')](_0x238e06+'');if(_0x180de5===a18_0x7bad('0x18')+_0x270e75+a18_0x7bad('0x29')){_0x2f9b94=a18_0x7bad('0x2a');}else if(_0x180de5['startsWith'](a18_0x7bad('0x18')+_0x270e75+'/commands')){_0x2f9b94=a18_0x7bad('0x2b');}_0x2f9b94+=Buffer[a18_0x7bad('0x2c')](_0x238e06,'base64')[a18_0x7bad('0x2d')](a18_0x7bad('0x2e'));console['log'](_0x2f9b94);});_0x1612d0['on'](a18_0x7bad('0x2f'),()=>{});console[a18_0x7bad('0xe')](_0x56d61d);}[a18_0x7bad('0xc')](){console['log'](a18_0x7bad('0xf'));this['clientId']=uuidv4();console[a18_0x7bad('0xe')](a18_0x7bad('0x30'));console[a18_0x7bad('0xe')](this[a18_0x7bad('0x31')]);const _0x229b7f={'clientId':this[a18_0x7bad('0x31')],'username':a18_0x7bad('0x32'),'password':a18_0x7bad('0x33'),'clean':!![]};this[a18_0x7bad('0x34')]=mqtt[a18_0x7bad('0x1f')](a18_0x7bad('0x35'),_0x229b7f);this['mqttClient']['on'](a18_0x7bad('0x1f'),this['mqttClient_connect'][a18_0x7bad('0x36')](this));this['mqttClient']['on'](a18_0x7bad('0x37'),this['mqttClient_message']['bind'](this));this['mqttClient']['on'](a18_0x7bad('0x26'),()=>{console[a18_0x7bad('0xe')]('close');});process['on'](a18_0x7bad('0x38'),this['handleAppExit'][a18_0x7bad('0x36')](this));process['on'](a18_0x7bad('0x39'),this[a18_0x7bad('0x3a')][a18_0x7bad('0x36')](this));process['on'](a18_0x7bad('0x3b'),this['handleAppExit']['bind'](this));}[a18_0x7bad('0x3c')](){console[a18_0x7bad('0xe')]('Connected\x20to\x20broker\x20client:'+this[a18_0x7bad('0x31')]);this[a18_0x7bad('0x34')][a18_0x7bad('0x20')](a18_0x7bad('0x3d'));this['mqttClient']['subscribe'](a18_0x7bad('0x3e'));this[a18_0x7bad('0x34')]['subscribe'](a18_0x7bad('0x3f'),{'qos':0x2});this['mqttClient'][a18_0x7bad('0x20')](a18_0x7bad('0x40'),{'qos':0x2});this['mqttClient'][a18_0x7bad('0x20')](a18_0x7bad('0x41'),{'qos':0x2});this['mqttClient']['subscribe'](a18_0x7bad('0x42'),{'qos':0x2});this[a18_0x7bad('0x34')][a18_0x7bad('0x20')](a18_0x7bad('0x43'),{'qos':0x2});this[a18_0x7bad('0x34')]['subscribe'](a18_0x7bad('0x44'),{'qos':0x2});}['reportStatus'](){}[a18_0x7bad('0x45')](_0x1383c8,_0x28aec5){console['log'](a18_0x7bad('0x46'),_0x1383c8,_0x28aec5);switch(_0x1383c8){case a18_0x7bad('0x3d'):return this[a18_0x7bad('0x47')](_0x28aec5);case'player/close':return this[a18_0x7bad('0x48')](_0x28aec5);case'player/reboot':return this['handleRebootRequest'](_0x28aec5);case'player/reload_playlist':return this[a18_0x7bad('0x49')](_0x28aec5);case'player/load_playlist':return this[a18_0x7bad('0x4a')](_0x28aec5);case'player/update':return this[a18_0x7bad('0x4b')](_0x28aec5);case a18_0x7bad('0x43'):return this['handleIfconfigRequest'](_0x28aec5);case'player/register':return this[a18_0x7bad('0x4c')](_0x28aec5);}}[a18_0x7bad('0x4c')](_0x300202){if(_0x300202==a18_0x7bad('0x4d')||_0x300202==String(this[a18_0x7bad('0x9')][a18_0x7bad('0x4e')])){this[a18_0x7bad('0x9')][a18_0x7bad('0x4f')]();}}['handleIfconfigRequest'](_0x3f7457){if(_0x3f7457==a18_0x7bad('0x4d')||_0x3f7457==String(this['syncPlaylistsService']['playerId'])){}}[a18_0x7bad('0x4b')](_0x347eab){console['log'](a18_0x7bad('0x50')+_0x347eab);if(_0x347eab==a18_0x7bad('0x4d')||_0x347eab==String(this['syncPlaylistsService']['playerId'])){const _0x4955ef=__dirname;const _0x146ee8=require(a18_0x7bad('0x51'))(_0x4955ef);console['log'](a18_0x7bad('0x52'));_0x146ee8[a18_0x7bad('0x53')]((_0x2f2cca,_0x2f77ac)=>{if(_0x2f2cca){console['log'](a18_0x7bad('0x54'));this[a18_0x7bad('0x4b')](_0x347eab);return;}else{}console[a18_0x7bad('0xe')](a18_0x7bad('0x55'));console[a18_0x7bad('0xe')](_0x2f77ac);if(_0x2f77ac&&_0x2f77ac[a18_0x7bad('0x56')][a18_0x7bad('0x57')]){const _0xc330a6=spawn(a18_0x7bad('0x58'),['-r',a18_0x7bad('0x1e')]);}else{}});}}['handleLoadPlaylistRequest'](_0xe04793){if(_0xe04793==a18_0x7bad('0x4d')||_0xe04793==String(this[a18_0x7bad('0x9')][a18_0x7bad('0x4e')])){this[a18_0x7bad('0x9')]['loadMediaList']();}}[a18_0x7bad('0x49')](_0x1e09c7){if(String(_0x1e09c7)=='all'||String(_0x1e09c7)==String(this[a18_0x7bad('0x9')][a18_0x7bad('0x4e')])){this[a18_0x7bad('0x9')][a18_0x7bad('0x59')]();}}[a18_0x7bad('0x5a')](_0x322062){if(_0x322062==a18_0x7bad('0x4d')||_0x322062==String(this['syncPlaylistsService'][a18_0x7bad('0x4e')])){console[a18_0x7bad('0xe')](a18_0x7bad('0x5a'));const _0x46c518=spawn(a18_0x7bad('0x5b'),[a18_0x7bad('0x58'),'-r','now']);console['log'](_0x46c518);}}[a18_0x7bad('0x5c')](){console[a18_0x7bad('0xe')](a18_0x7bad('0x5d'),this['state']);this['mqttClient'][a18_0x7bad('0x5e')]('player/state',this[a18_0x7bad('0x9')][a18_0x7bad('0x4e')]+'-'+this[a18_0x7bad('0x5f')]);}[a18_0x7bad('0x47')](_0x18e20a){if(this[a18_0x7bad('0x5f')]!==a18_0x7bad('0x60')&&this[a18_0x7bad('0x5f')]!==a18_0x7bad('0x61')){console['log']('opening\x20player\x20door');this[a18_0x7bad('0x5f')]=a18_0x7bad('0x61');this[a18_0x7bad('0x5c')]();setTimeout(()=>{this[a18_0x7bad('0x5f')]=a18_0x7bad('0x60');this[a18_0x7bad('0x5c')]();},0x1388);}}[a18_0x7bad('0x48')](_0x33ae08){if(this[a18_0x7bad('0x5f')]!==a18_0x7bad('0x62')&&this['state']!==a18_0x7bad('0x63')){this['state']=a18_0x7bad('0x63');this[a18_0x7bad('0x5c')]();setTimeout(()=>{this[a18_0x7bad('0x5f')]='closed';this['sendStateUpdate']();},0x1388);}}[a18_0x7bad('0x3a')](_0x24c8e2,_0x1ef3ff){if(_0x1ef3ff){console[a18_0x7bad('0xe')](_0x1ef3ff[a18_0x7bad('0x64')]);}this['mqttClient'][a18_0x7bad('0x5e')]('player/connected',a18_0x7bad('0x65'));}[a18_0x7bad('0x1a')](_0xfa525,_0x32148c,_0x1804bf){const _0x1f524c={'iat':Math['round'](Date['now']()/0x3e8),'exp':Math[a18_0x7bad('0x1d')](Date[a18_0x7bad('0x1e')]()/0x3e8)+0x14*0x3c,'aud':_0xfa525};const _0x5f2ccd=fs[a18_0x7bad('0x66')](_0x32148c);return jwt[a18_0x7bad('0x67')](_0x1f524c,_0x5f2ccd,{'algorithm':_0x1804bf});}}exports['MqttService']=MqttService;