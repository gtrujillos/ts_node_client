var a18_0x4825=['subscribe','player/open','player/reload_playlist','player/update','player/close','player/reboot','handleRebootRequest','handleUpdateRequest','all','playerId','simple-git','Git\x20updating','Error\x20git\x20updated','summary','changes','shutdown','now','handleReloadPlaylistRequest','sendStateUpdate','publish','player/state','handleOpenRequest','open','opening','opening\x20player\x20door','closing','stack','false','MqttService','defineProperty','child_process','spawn','is-image','string-template','mqtt','uuid/v4','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','mqttClient','connect','mqtt://lulo.run','mqttClient_connect','bind','message','mqttClient_message','exit','handleAppExit','uncaughtException','Connected\x20to\x20broker\x20client:'];(function(_0x42d24e,_0x171f14){var _0xdce523=function(_0x5cf45f){while(--_0x5cf45f){_0x42d24e['push'](_0x42d24e['shift']());}};_0xdce523(++_0x171f14);}(a18_0x4825,0x1b3));var a18_0x2ba3=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a18_0x4825[_0x2d8f05];return _0x4d74cb;};'use strict';Object[a18_0x2ba3('0x0')](exports,'__esModule',{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require('fs-extra');const request=require('request');const progress=require('request-progress');const spawn=require(a18_0x2ba3('0x1'))[a18_0x2ba3('0x2')];const isImage=require(a18_0x2ba3('0x3'));const format=require(a18_0x2ba3('0x4'));const os=require('os');const mqtt=require(a18_0x2ba3('0x5'));const uuidv4=require(a18_0x2ba3('0x6'));class MqttService{constructor(_0x1e1634){this[a18_0x2ba3('0x7')]=_0x1e1634;this[a18_0x2ba3('0x8')]=a18_0x2ba3('0x9');this[a18_0x2ba3('0xa')]=new HttpClientService_1[(a18_0x2ba3('0xb'))]();}[a18_0x2ba3('0xc')](){this[a18_0x2ba3('0xd')]();}[a18_0x2ba3('0xd')](){console[a18_0x2ba3('0xe')]('mqttInit');this[a18_0x2ba3('0xf')]=uuidv4();console[a18_0x2ba3('0xe')](a18_0x2ba3('0x10'));console[a18_0x2ba3('0xe')](this[a18_0x2ba3('0xf')]);const _0x248945={'clientId':this[a18_0x2ba3('0xf')],'username':a18_0x2ba3('0x11'),'password':'run.lulo_2018#.','clean':!![]};this[a18_0x2ba3('0x12')]=mqtt[a18_0x2ba3('0x13')](a18_0x2ba3('0x14'),_0x248945);this[a18_0x2ba3('0x12')]['on'](a18_0x2ba3('0x13'),this[a18_0x2ba3('0x15')][a18_0x2ba3('0x16')](this));this[a18_0x2ba3('0x12')]['on'](a18_0x2ba3('0x17'),this[a18_0x2ba3('0x18')][a18_0x2ba3('0x16')](this));process['on'](a18_0x2ba3('0x19'),this[a18_0x2ba3('0x1a')]['bind'](this));process['on']('SIGINT',this[a18_0x2ba3('0x1a')][a18_0x2ba3('0x16')](this));process['on'](a18_0x2ba3('0x1b'),this['handleAppExit'][a18_0x2ba3('0x16')](this));}['mqttClient_connect'](){console['log'](a18_0x2ba3('0x1c')+this[a18_0x2ba3('0xf')]);this['mqttClient'][a18_0x2ba3('0x1d')](a18_0x2ba3('0x1e'));this[a18_0x2ba3('0x12')][a18_0x2ba3('0x1d')]('player/close');this[a18_0x2ba3('0x12')][a18_0x2ba3('0x1d')]('player/reboot',{'qos':0x2});this['mqttClient']['subscribe']('player/load_playlist',{'qos':0x2});this[a18_0x2ba3('0x12')]['subscribe'](a18_0x2ba3('0x1f'),{'qos':0x2});this[a18_0x2ba3('0x12')][a18_0x2ba3('0x1d')](a18_0x2ba3('0x20'),{'qos':0x2});}['reportStatus'](){}[a18_0x2ba3('0x18')](_0x379106,_0x47b2bb){console[a18_0x2ba3('0xe')]('received\x20message\x20%s\x20%s',_0x379106,_0x47b2bb);switch(_0x379106){case'player/open':return this['handleOpenRequest'](_0x47b2bb);case a18_0x2ba3('0x21'):return this['handleCloseRequest'](_0x47b2bb);case a18_0x2ba3('0x22'):return this[a18_0x2ba3('0x23')](_0x47b2bb);case a18_0x2ba3('0x1f'):return this['handleReloadPlaylistRequest'](_0x47b2bb);case'player/load_playlist':return this['handleLoadPlaylistRequest'](_0x47b2bb);case'player/update':return this['handleUpdateRequest'](_0x47b2bb);}}[a18_0x2ba3('0x24')](_0x2fc7ba){if(_0x2fc7ba==a18_0x2ba3('0x25')||_0x2fc7ba==String(this[a18_0x2ba3('0x7')][a18_0x2ba3('0x26')])){const _0x5bf178=__dirname;const _0x44a1c4=require(a18_0x2ba3('0x27'))(_0x5bf178);console[a18_0x2ba3('0xe')](a18_0x2ba3('0x28'));_0x44a1c4['pull']((_0x5bc009,_0x461d24)=>{if(_0x5bc009){console[a18_0x2ba3('0xe')](a18_0x2ba3('0x29'));this[a18_0x2ba3('0x24')](_0x2fc7ba);return;}else{}console[a18_0x2ba3('0xe')]('Git\x20updated');console[a18_0x2ba3('0xe')](_0x461d24);if(_0x461d24&&_0x461d24[a18_0x2ba3('0x2a')][a18_0x2ba3('0x2b')]){const _0x1e4f75=spawn(a18_0x2ba3('0x2c'),['-r',a18_0x2ba3('0x2d')]);}else{}});}}['handleLoadPlaylistRequest'](_0xba66f9){if(_0xba66f9==a18_0x2ba3('0x25')||_0xba66f9==String(this['syncPlaylistsService'][a18_0x2ba3('0x26')])){this['syncPlaylistsService']['loadMediaList']();}}[a18_0x2ba3('0x2e')](_0x43b240){if(_0x43b240=='all'||_0x43b240==String(this[a18_0x2ba3('0x7')][a18_0x2ba3('0x26')])){this[a18_0x2ba3('0x7')]['reloadMediaList']();}}[a18_0x2ba3('0x23')](_0x531f84){if(_0x531f84=='all'||_0x531f84==String(this['syncPlaylistsService'][a18_0x2ba3('0x26')])){const _0x2912d8=spawn(a18_0x2ba3('0x2c'),['-r',a18_0x2ba3('0x2d')]);}}[a18_0x2ba3('0x2f')](){console[a18_0x2ba3('0xe')]('sending\x20state\x20%s',this['state']);this[a18_0x2ba3('0x12')][a18_0x2ba3('0x30')](a18_0x2ba3('0x31'),this['syncPlaylistsService']['playerId']+'-'+this['state']);}[a18_0x2ba3('0x32')](_0x2b54d0){if(this[a18_0x2ba3('0x8')]!==a18_0x2ba3('0x33')&&this[a18_0x2ba3('0x8')]!==a18_0x2ba3('0x34')){console['log'](a18_0x2ba3('0x35'));this[a18_0x2ba3('0x8')]=a18_0x2ba3('0x34');this[a18_0x2ba3('0x2f')]();setTimeout(()=>{this[a18_0x2ba3('0x8')]='open';this['sendStateUpdate']();},0x1388);}}['handleCloseRequest'](_0x5946b4){if(this['state']!==a18_0x2ba3('0x9')&&this[a18_0x2ba3('0x8')]!==a18_0x2ba3('0x36')){this[a18_0x2ba3('0x8')]=a18_0x2ba3('0x36');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x2ba3('0x8')]='closed';this['sendStateUpdate']();},0x1388);}}[a18_0x2ba3('0x1a')](_0x29227f,_0x171ec2){if(_0x171ec2){console[a18_0x2ba3('0xe')](_0x171ec2[a18_0x2ba3('0x37')]);}this['mqttClient'][a18_0x2ba3('0x30')]('player/connected',a18_0x2ba3('0x38'));}}exports[a18_0x2ba3('0x39')]=MqttService;