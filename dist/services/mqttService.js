var a18_0x4daa=['reloadMediaList','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest','handleUpdateSettingsRequest:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','publish','handleOpenRequest','opening','open','closing','stack','player/connected','false','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','spawn','exec','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','mqttInit_mosquitto','mqttInit_google','my-node-device','my-registry','us-central1','resources/keys/rsa_private.pem','mqtt.googleapis.com','events','projects/','/locations/','/devices/','unused','createJwt','TLSv1_2_method','round','now','subscribe','/state','connect','log','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','publish\x20result:','close','error','message','Message\x20received:\x20','/config','startsWith','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','packetsend','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','bind','mqttClient_message','exit','handleAppExit','SIGINT','uncaughtException','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','player/ifconfig','player/register','player/update_settings','reportStatus','received\x20message\x20%s\x20%s','handleCloseRequest','handleRebootRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','playerId','registerClient','all','handleUpdateRequest:\x20','simple-git','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList'];(function(_0x9ab5b7,_0x2a0b38){var _0x4d46d6=function(_0x537f37){while(--_0x537f37){_0x9ab5b7['push'](_0x9ab5b7['shift']());}};_0x4d46d6(++_0x2a0b38);}(a18_0x4daa,0x1cc));var a18_0x51e4=function(_0x19b508,_0x327907){_0x19b508=_0x19b508-0x0;var _0x4559b0=a18_0x4daa[_0x19b508];return _0x4559b0;};'use strict';Object[a18_0x51e4('0x0')](exports,a18_0x51e4('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x51e4('0x2'));const fs=require('fs');const fsExtra=require(a18_0x51e4('0x3'));const request=require(a18_0x51e4('0x4'));const progress=require(a18_0x51e4('0x5'));const spawn=require(a18_0x51e4('0x6'))[a18_0x51e4('0x7')];const exec=require('child_process')[a18_0x51e4('0x8')];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require(a18_0x51e4('0x9'));const uuidv4=require(a18_0x51e4('0xa'));const jwt=require(a18_0x51e4('0xb'));class MqttService{constructor(_0x408bc4){this[a18_0x51e4('0xc')]=_0x408bc4;this[a18_0x51e4('0xd')]=a18_0x51e4('0xe');this[a18_0x51e4('0xf')]=new HttpClientService_1['HttpClientService']();}[a18_0x51e4('0x10')](){this[a18_0x51e4('0x11')]();}[a18_0x51e4('0x12')](){console['log']('mqttInit');const _0x1b47dd='velvety-glazing-252020';const _0x2e0717=a18_0x51e4('0x13');const _0x3df23c=a18_0x51e4('0x14');const _0x401283=a18_0x51e4('0x15');const _0x542728='RS256';const _0x758fd7=a18_0x51e4('0x16');const _0x39361f=a18_0x51e4('0x17');const _0x1f56b6=0x1bb;const _0x23a2ae=a18_0x51e4('0x18');const _0x15388e=0x5;const _0x13aca6=a18_0x51e4('0x19')+_0x1b47dd+a18_0x51e4('0x1a')+_0x401283+'/registries/'+_0x3df23c+a18_0x51e4('0x1b')+_0x2e0717;const _0x478c6c={'host':_0x39361f,'port':_0x1f56b6,'clientId':_0x13aca6,'username':a18_0x51e4('0x1c'),'password':this[a18_0x51e4('0x1d')](_0x1b47dd,_0x758fd7,_0x542728),'protocol':'mqtts','secureProtocol':a18_0x51e4('0x1e')};const _0x272869=Math[a18_0x51e4('0x1f')](Date[a18_0x51e4('0x20')]()/0x3e8);const _0x76867a=mqtt['connect'](_0x478c6c);_0x76867a[a18_0x51e4('0x21')](a18_0x51e4('0x1b')+_0x2e0717+'/config',{'qos':0x1});_0x76867a['subscribe'](a18_0x51e4('0x1b')+_0x2e0717+a18_0x51e4('0x22'),{'qos':0x1});_0x76867a[a18_0x51e4('0x21')]('/devices/'+_0x2e0717+'/commands/#',{'qos':0x0});const _0x9687fb=a18_0x51e4('0x1b')+_0x2e0717+'/'+_0x23a2ae;_0x76867a['on'](a18_0x51e4('0x23'),_0x345b48=>{console[a18_0x51e4('0x24')](a18_0x51e4('0x23'));if(!_0x345b48){console[a18_0x51e4('0x24')](a18_0x51e4('0x25'));}else{const _0x9687fb=a18_0x51e4('0x26');const _0x505340=_0x3df23c+'/'+_0x2e0717+'-payload-0';_0x76867a['publish'](_0x9687fb,_0x505340,{'qos':0x1},_0x4ec724=>{console[a18_0x51e4('0x24')](a18_0x51e4('0x27'));console[a18_0x51e4('0x24')](_0x4ec724);if(!_0x4ec724){}});}});_0x76867a['on']('close',()=>{console[a18_0x51e4('0x24')](a18_0x51e4('0x28'));});_0x76867a['on'](a18_0x51e4('0x29'),_0x4b9f52=>{console[a18_0x51e4('0x24')](a18_0x51e4('0x29'),_0x4b9f52);});_0x76867a['on'](a18_0x51e4('0x2a'),(_0x42d785,_0x58923b)=>{let _0x91be5=a18_0x51e4('0x2b');console[a18_0x51e4('0x24')](_0x42d785);console[a18_0x51e4('0x24')](_0x58923b+'');if(_0x42d785===a18_0x51e4('0x1b')+_0x2e0717+a18_0x51e4('0x2c')){_0x91be5='Config\x20message\x20received:\x20';}else if(_0x42d785[a18_0x51e4('0x2d')](a18_0x51e4('0x1b')+_0x2e0717+a18_0x51e4('0x2e'))){_0x91be5=a18_0x51e4('0x2f');}_0x91be5+=Buffer[a18_0x51e4('0x30')](_0x58923b,a18_0x51e4('0x31'))[a18_0x51e4('0x32')](a18_0x51e4('0x33'));console[a18_0x51e4('0x24')](_0x91be5);});_0x76867a['on'](a18_0x51e4('0x34'),()=>{});console[a18_0x51e4('0x24')](_0x478c6c);}[a18_0x51e4('0x11')](){console['log']('mqttInit');this[a18_0x51e4('0x35')]=uuidv4();console['log'](a18_0x51e4('0x36'));console[a18_0x51e4('0x24')](this[a18_0x51e4('0x35')]);const _0x121186={'clientId':this['clientId'],'username':a18_0x51e4('0x37'),'password':a18_0x51e4('0x38'),'clean':!![]};this[a18_0x51e4('0x39')]=mqtt[a18_0x51e4('0x23')](a18_0x51e4('0x3a'),_0x121186);this['mqttClient']['on'](a18_0x51e4('0x23'),this['mqttClient_connect'][a18_0x51e4('0x3b')](this));this[a18_0x51e4('0x39')]['on'](a18_0x51e4('0x2a'),this[a18_0x51e4('0x3c')][a18_0x51e4('0x3b')](this));this['mqttClient']['on'](a18_0x51e4('0x28'),()=>{console[a18_0x51e4('0x24')](a18_0x51e4('0x28'));});process['on'](a18_0x51e4('0x3d'),this[a18_0x51e4('0x3e')][a18_0x51e4('0x3b')](this));process['on'](a18_0x51e4('0x3f'),this[a18_0x51e4('0x3e')][a18_0x51e4('0x3b')](this));process['on'](a18_0x51e4('0x40'),this[a18_0x51e4('0x3e')]['bind'](this));}['mqttClient_connect'](){console[a18_0x51e4('0x24')]('Connected\x20to\x20broker\x20client:'+this[a18_0x51e4('0x35')]);this['mqttClient']['subscribe'](a18_0x51e4('0x41'));this['mqttClient'][a18_0x51e4('0x21')](a18_0x51e4('0x42'));this['mqttClient'][a18_0x51e4('0x21')](a18_0x51e4('0x43'),{'qos':0x2});this[a18_0x51e4('0x39')][a18_0x51e4('0x21')](a18_0x51e4('0x44'),{'qos':0x2});this['mqttClient'][a18_0x51e4('0x21')](a18_0x51e4('0x45'),{'qos':0x2});this[a18_0x51e4('0x39')][a18_0x51e4('0x21')](a18_0x51e4('0x46'),{'qos':0x2});this[a18_0x51e4('0x39')][a18_0x51e4('0x21')](a18_0x51e4('0x47'),{'qos':0x2});this[a18_0x51e4('0x39')][a18_0x51e4('0x21')](a18_0x51e4('0x48'),{'qos':0x2});this['mqttClient'][a18_0x51e4('0x21')](a18_0x51e4('0x49'),{'qos':0x2});}[a18_0x51e4('0x4a')](){}[a18_0x51e4('0x3c')](_0x2f3454,_0x5d7e12){console[a18_0x51e4('0x24')](a18_0x51e4('0x4b'),_0x2f3454,_0x5d7e12);switch(_0x2f3454){case a18_0x51e4('0x41'):return this['handleOpenRequest'](_0x5d7e12);case'player/close':return this[a18_0x51e4('0x4c')](_0x5d7e12);case a18_0x51e4('0x43'):return this[a18_0x51e4('0x4d')](_0x5d7e12);case a18_0x51e4('0x45'):return this[a18_0x51e4('0x4e')](_0x5d7e12);case'player/load_playlist':return this[a18_0x51e4('0x4f')](_0x5d7e12);case'player/update':return this[a18_0x51e4('0x50')](_0x5d7e12);case'player/ifconfig':return this[a18_0x51e4('0x51')](_0x5d7e12);case a18_0x51e4('0x48'):return this[a18_0x51e4('0x52')](_0x5d7e12);case a18_0x51e4('0x49'):return this['handleUpdateSettingsRequest'](_0x5d7e12);}}[a18_0x51e4('0x52')](_0x34aed3){if(_0x34aed3=='all'||_0x34aed3==String(this[a18_0x51e4('0xc')][a18_0x51e4('0x53')])){this[a18_0x51e4('0xc')][a18_0x51e4('0x54')]();}}[a18_0x51e4('0x51')](_0x59fafe){if(_0x59fafe==a18_0x51e4('0x55')||_0x59fafe==String(this['syncPlaylistsService'][a18_0x51e4('0x53')])){}}['handleUpdateRequest'](_0x5807d8){console['log'](a18_0x51e4('0x56')+_0x5807d8);if(_0x5807d8==a18_0x51e4('0x55')||_0x5807d8==String(this['syncPlaylistsService'][a18_0x51e4('0x53')])){const _0x5f2981=__dirname;const _0xcaa3b3=require(a18_0x51e4('0x57'))(_0x5f2981);console['log']('Git\x20updating');_0xcaa3b3[a18_0x51e4('0x58')]((_0x5fb8f4,_0x320e80)=>{if(_0x5fb8f4){console['log'](a18_0x51e4('0x59'));this[a18_0x51e4('0x50')](_0x5807d8);return;}else{}console[a18_0x51e4('0x24')](a18_0x51e4('0x5a'));console[a18_0x51e4('0x24')](_0x320e80);if(_0x320e80&&_0x320e80[a18_0x51e4('0x5b')][a18_0x51e4('0x5c')]){this[a18_0x51e4('0xc')][a18_0x51e4('0x5d')]();}else{}});}}[a18_0x51e4('0x4f')](_0x1cc651){if(_0x1cc651=='all'||_0x1cc651==String(this[a18_0x51e4('0xc')][a18_0x51e4('0x53')])){this[a18_0x51e4('0xc')][a18_0x51e4('0x5e')]();}}[a18_0x51e4('0x4e')](_0x46462c){if(String(_0x46462c)=='all'||String(_0x46462c)==String(this[a18_0x51e4('0xc')][a18_0x51e4('0x53')])){this['syncPlaylistsService'][a18_0x51e4('0x5f')]();}}[a18_0x51e4('0x4d')](_0x5377be){if(_0x5377be==a18_0x51e4('0x55')||_0x5377be==String(this['syncPlaylistsService']['playerId'])){console['log'](a18_0x51e4('0x60'));try{this[a18_0x51e4('0xc')][a18_0x51e4('0x5d')]();}catch(_0x4fdc0a){console[a18_0x51e4('0x24')](_0x4fdc0a);}}}[a18_0x51e4('0x61')](_0xe3f477){if(_0xe3f477==a18_0x51e4('0x55')||_0xe3f477==String(this['syncPlaylistsService'][a18_0x51e4('0x53')])){console['log'](a18_0x51e4('0x62'));try{this[a18_0x51e4('0xc')][a18_0x51e4('0x63')]();}catch(_0x744e37){console['log'](_0x744e37);}}}[a18_0x51e4('0x64')](){console[a18_0x51e4('0x24')](a18_0x51e4('0x65'),this['state']);this[a18_0x51e4('0x39')][a18_0x51e4('0x66')]('player/state',this[a18_0x51e4('0xc')]['playerId']+'-'+this['state']);}[a18_0x51e4('0x67')](_0x3dd24d){if(this[a18_0x51e4('0xd')]!=='open'&&this['state']!==a18_0x51e4('0x68')){console[a18_0x51e4('0x24')]('opening\x20player\x20door');this[a18_0x51e4('0xd')]=a18_0x51e4('0x68');this[a18_0x51e4('0x64')]();setTimeout(()=>{this[a18_0x51e4('0xd')]=a18_0x51e4('0x69');this[a18_0x51e4('0x64')]();},0x1388);}}[a18_0x51e4('0x4c')](_0x1ef3f9){if(this[a18_0x51e4('0xd')]!==a18_0x51e4('0xe')&&this[a18_0x51e4('0xd')]!==a18_0x51e4('0x6a')){this[a18_0x51e4('0xd')]=a18_0x51e4('0x6a');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x51e4('0xd')]=a18_0x51e4('0xe');this[a18_0x51e4('0x64')]();},0x1388);}}[a18_0x51e4('0x3e')](_0x3b12fb,_0x568988){if(_0x568988){console[a18_0x51e4('0x24')](_0x568988[a18_0x51e4('0x6b')]);}this[a18_0x51e4('0x39')][a18_0x51e4('0x66')](a18_0x51e4('0x6c'),a18_0x51e4('0x6d'));}[a18_0x51e4('0x1d')](_0x1a44d1,_0x4b7f24,_0x4a1a77){const _0xd10c64={'iat':Math[a18_0x51e4('0x1f')](Date['now']()/0x3e8),'exp':Math[a18_0x51e4('0x1f')](Date[a18_0x51e4('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x1a44d1};const _0x26a334=fs['readFileSync'](_0x4b7f24);return jwt[a18_0x51e4('0x6e')](_0xd10c64,_0x26a334,{'algorithm':_0x4a1a77});}}exports['MqttService']=MqttService;