var a18_0x274d=['spawn','syncPlaylistsService','state','closed','httpClientService','HttpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqtt://lulo.run','mqttClient','connect','mqttClient_connect','bind','message','exit','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/load_playlist','subscribe','player/update','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','player/reload_playlist','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','all','playerId','simple-git','Git\x20updating','pull','Git\x20updated','summary','changes','shutdown','now','loadMediaList','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','opening\x20player\x20door','opening','closing','stack','player/connected','false','MqttService','defineProperty','__esModule','fs-extra','request','request-progress','child_process'];(function(_0x231c64,_0x2e6518){var _0x5ed191=function(_0x23cb8e){while(--_0x23cb8e){_0x231c64['push'](_0x231c64['shift']());}};_0x5ed191(++_0x2e6518);}(a18_0x274d,0x18c));var a18_0x1dc0=function(_0x5d41e1,_0x22da22){_0x5d41e1=_0x5d41e1-0x0;var _0x41ef24=a18_0x274d[_0x5d41e1];return _0x41ef24;};'use strict';Object[a18_0x1dc0('0x0')](exports,a18_0x1dc0('0x1'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x1dc0('0x2'));const request=require(a18_0x1dc0('0x3'));const progress=require(a18_0x1dc0('0x4'));const spawn=require(a18_0x1dc0('0x5'))[a18_0x1dc0('0x6')];const isImage=require('is-image');const format=require('string-template');const os=require('os');const mqtt=require('mqtt');const uuidv4=require('uuid/v4');class MqttService{constructor(_0x597ff2){this[a18_0x1dc0('0x7')]=_0x597ff2;this[a18_0x1dc0('0x8')]=a18_0x1dc0('0x9');this[a18_0x1dc0('0xa')]=new HttpClientService_1[(a18_0x1dc0('0xb'))]();}[a18_0x1dc0('0xc')](){this[a18_0x1dc0('0xd')]();}[a18_0x1dc0('0xd')](){console[a18_0x1dc0('0xe')](a18_0x1dc0('0xd'));this[a18_0x1dc0('0xf')]=uuidv4();console['log'](a18_0x1dc0('0x10'));console[a18_0x1dc0('0xe')](this['clientId']);const _0x41d46f={'clientId':this[a18_0x1dc0('0xf')],'username':a18_0x1dc0('0x11'),'password':a18_0x1dc0('0x12'),'clean':!![]};this['mqttClient']=mqtt['connect'](a18_0x1dc0('0x13'),_0x41d46f);this[a18_0x1dc0('0x14')]['on'](a18_0x1dc0('0x15'),this[a18_0x1dc0('0x16')][a18_0x1dc0('0x17')](this));this['mqttClient']['on'](a18_0x1dc0('0x18'),this['mqttClient_message'][a18_0x1dc0('0x17')](this));process['on'](a18_0x1dc0('0x19'),this[a18_0x1dc0('0x1a')][a18_0x1dc0('0x17')](this));process['on'](a18_0x1dc0('0x1b'),this[a18_0x1dc0('0x1a')][a18_0x1dc0('0x17')](this));process['on']('uncaughtException',this[a18_0x1dc0('0x1a')]['bind'](this));}['mqttClient_connect'](){console['log'](a18_0x1dc0('0x1c')+this[a18_0x1dc0('0xf')]);this[a18_0x1dc0('0x14')]['subscribe'](a18_0x1dc0('0x1d'));this['mqttClient']['subscribe'](a18_0x1dc0('0x1e'));this[a18_0x1dc0('0x14')]['subscribe'](a18_0x1dc0('0x1f'),{'qos':0x2});this[a18_0x1dc0('0x14')]['subscribe'](a18_0x1dc0('0x20'),{'qos':0x2});this[a18_0x1dc0('0x14')]['subscribe']('player/reload_playlist',{'qos':0x2});this[a18_0x1dc0('0x14')][a18_0x1dc0('0x21')](a18_0x1dc0('0x22'),{'qos':0x2});}[a18_0x1dc0('0x23')](){}[a18_0x1dc0('0x24')](_0x1564b5,_0x447d36){console[a18_0x1dc0('0xe')](a18_0x1dc0('0x25'),_0x1564b5,_0x447d36);switch(_0x1564b5){case a18_0x1dc0('0x1d'):return this[a18_0x1dc0('0x26')](_0x447d36);case a18_0x1dc0('0x1e'):return this[a18_0x1dc0('0x27')](_0x447d36);case a18_0x1dc0('0x1f'):return this['handleRebootRequest'](_0x447d36);case a18_0x1dc0('0x28'):return this[a18_0x1dc0('0x29')](_0x447d36);case a18_0x1dc0('0x20'):return this[a18_0x1dc0('0x2a')](_0x447d36);case'player/update':return this[a18_0x1dc0('0x2b')](_0x447d36);}}['handleUpdateRequest'](_0x2f9e42){if(_0x2f9e42==a18_0x1dc0('0x2c')||_0x2f9e42==String(this['syncPlaylistsService'][a18_0x1dc0('0x2d')])){const _0x2f6368=__dirname;const _0x42d7e9=require(a18_0x1dc0('0x2e'))(_0x2f6368);console[a18_0x1dc0('0xe')](a18_0x1dc0('0x2f'));_0x42d7e9[a18_0x1dc0('0x30')]((_0x2ddf57,_0x4c4b89)=>{if(_0x2ddf57){console[a18_0x1dc0('0xe')]('Error\x20git\x20updated');this[a18_0x1dc0('0x2b')](_0x2f9e42);return;}else{}console['log'](a18_0x1dc0('0x31'));console[a18_0x1dc0('0xe')](_0x4c4b89);if(_0x4c4b89&&_0x4c4b89[a18_0x1dc0('0x32')][a18_0x1dc0('0x33')]){const _0x10d2ed=spawn(a18_0x1dc0('0x34'),['-r',a18_0x1dc0('0x35')]);}else{}});}}[a18_0x1dc0('0x2a')](_0x221718){if(_0x221718==a18_0x1dc0('0x2c')||_0x221718==String(this[a18_0x1dc0('0x7')]['playerId'])){this[a18_0x1dc0('0x7')][a18_0x1dc0('0x36')]();}}[a18_0x1dc0('0x29')](_0x2a14eb){if(String(_0x2a14eb)==a18_0x1dc0('0x2c')||String(_0x2a14eb)==String(this[a18_0x1dc0('0x7')][a18_0x1dc0('0x2d')])){this['syncPlaylistsService'][a18_0x1dc0('0x37')]();}}['handleRebootRequest'](_0x5b9ba3){if(_0x5b9ba3==a18_0x1dc0('0x2c')||_0x5b9ba3==String(this[a18_0x1dc0('0x7')]['playerId'])){const _0x40e37d=spawn(a18_0x1dc0('0x34'),['-r',a18_0x1dc0('0x35')]);}}[a18_0x1dc0('0x38')](){console[a18_0x1dc0('0xe')](a18_0x1dc0('0x39'),this[a18_0x1dc0('0x8')]);this[a18_0x1dc0('0x14')][a18_0x1dc0('0x3a')](a18_0x1dc0('0x3b'),this[a18_0x1dc0('0x7')][a18_0x1dc0('0x2d')]+'-'+this['state']);}[a18_0x1dc0('0x26')](_0xec45c5){if(this['state']!=='open'&&this[a18_0x1dc0('0x8')]!=='opening'){console[a18_0x1dc0('0xe')](a18_0x1dc0('0x3c'));this[a18_0x1dc0('0x8')]=a18_0x1dc0('0x3d');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x1dc0('0x8')]='open';this[a18_0x1dc0('0x38')]();},0x1388);}}['handleCloseRequest'](_0x47f7c8){if(this['state']!==a18_0x1dc0('0x9')&&this[a18_0x1dc0('0x8')]!==a18_0x1dc0('0x3e')){this[a18_0x1dc0('0x8')]=a18_0x1dc0('0x3e');this[a18_0x1dc0('0x38')]();setTimeout(()=>{this['state']='closed';this['sendStateUpdate']();},0x1388);}}['handleAppExit'](_0x5f0271,_0x47ea59){if(_0x47ea59){console['log'](_0x47ea59[a18_0x1dc0('0x3f')]);}this[a18_0x1dc0('0x14')][a18_0x1dc0('0x3a')](a18_0x1dc0('0x40'),a18_0x1dc0('0x41'));}}exports[a18_0x1dc0('0x42')]=MqttService;