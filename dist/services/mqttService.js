var a18_0x55b3=['summary','changes','shutdown','now','handleLoadPlaylistRequest','loadMediaList','handleReloadPlaylistRequest','reloadMediaList','sendStateUpdate','sending\x20state\x20%s','publish','player/state','open','opening','closing','player/connected','false','createJwt','readFileSync','sign','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request-progress','child_process','spawn','is-image','string-template','mqtt','jsonwebtoken','state','closed','HttpClientService','init','mqttInit_mosquitto','mqttInit_google','log','velvety-glazing-252020','my-registry','us-central1','RS256','resources/keys/rsa_private.pem','events','projects/','/locations/','/registries/','/devices/','unused','mqtts','TLSv1_2_method','round','connect','subscribe','/config','/state','/commands/#','Client\x20not\x20connected...','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','error','message','Message\x20received:\x20','Config\x20message\x20received:\x20','startsWith','/commands','from','base64','toString','ascii','packetsend','mqttInit','this.clientId','clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','close','handleAppExit','SIGINT','uncaughtException','Connected\x20to\x20broker\x20client:','player/open','player/load_playlist','player/ifconfig','player/register','reportStatus','mqttClient_message','handleOpenRequest','handleCloseRequest','player/reboot','handleRebootRequest','player/reload_playlist','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','all','syncPlaylistsService','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated'];(function(_0x4aaef2,_0x18c932){var _0x548492=function(_0x2cca30){while(--_0x2cca30){_0x4aaef2['push'](_0x4aaef2['shift']());}};_0x548492(++_0x18c932);}(a18_0x55b3,0x1cc));var a18_0x2ec0=function(_0x55c4a4,_0x3e7d4c){_0x55c4a4=_0x55c4a4-0x0;var _0x1cc13d=a18_0x55b3[_0x55c4a4];return _0x1cc13d;};'use strict';Object[a18_0x2ec0('0x0')](exports,a18_0x2ec0('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x2ec0('0x2'));const fs=require('fs');const fsExtra=require(a18_0x2ec0('0x3'));const request=require('request');const progress=require(a18_0x2ec0('0x4'));const spawn=require(a18_0x2ec0('0x5'))[a18_0x2ec0('0x6')];const isImage=require(a18_0x2ec0('0x7'));const format=require(a18_0x2ec0('0x8'));const os=require('os');const mqtt=require(a18_0x2ec0('0x9'));const uuidv4=require('uuid/v4');const jwt=require(a18_0x2ec0('0xa'));class MqttService{constructor(_0x2d83da){this['syncPlaylistsService']=_0x2d83da;this[a18_0x2ec0('0xb')]=a18_0x2ec0('0xc');this['httpClientService']=new HttpClientService_1[(a18_0x2ec0('0xd'))]();}[a18_0x2ec0('0xe')](){this[a18_0x2ec0('0xf')]();}[a18_0x2ec0('0x10')](){console[a18_0x2ec0('0x11')]('mqttInit');const _0x2ef675=a18_0x2ec0('0x12');const _0x513113='my-node-device';const _0x1d6ca7=a18_0x2ec0('0x13');const _0x342a02=a18_0x2ec0('0x14');const _0x173a50=a18_0x2ec0('0x15');const _0x2e85d1=a18_0x2ec0('0x16');const _0x3e3f62='mqtt.googleapis.com';const _0x43d390=0x1bb;const _0x460472=a18_0x2ec0('0x17');const _0x18bde3=0x5;const _0x5b416d=a18_0x2ec0('0x18')+_0x2ef675+a18_0x2ec0('0x19')+_0x342a02+a18_0x2ec0('0x1a')+_0x1d6ca7+a18_0x2ec0('0x1b')+_0x513113;const _0x22a1f8={'host':_0x3e3f62,'port':_0x43d390,'clientId':_0x5b416d,'username':a18_0x2ec0('0x1c'),'password':this['createJwt'](_0x2ef675,_0x2e85d1,_0x173a50),'protocol':a18_0x2ec0('0x1d'),'secureProtocol':a18_0x2ec0('0x1e')};const _0x1eb0a2=Math[a18_0x2ec0('0x1f')](Date['now']()/0x3e8);const _0x43add2=mqtt[a18_0x2ec0('0x20')](_0x22a1f8);_0x43add2[a18_0x2ec0('0x21')]('/devices/'+_0x513113+a18_0x2ec0('0x22'),{'qos':0x1});_0x43add2[a18_0x2ec0('0x21')]('/devices/'+_0x513113+a18_0x2ec0('0x23'),{'qos':0x1});_0x43add2[a18_0x2ec0('0x21')]('/devices/'+_0x513113+a18_0x2ec0('0x24'),{'qos':0x0});const _0x14ddc6=a18_0x2ec0('0x1b')+_0x513113+'/'+_0x460472;_0x43add2['on'](a18_0x2ec0('0x20'),_0x3eb0db=>{console[a18_0x2ec0('0x11')](a18_0x2ec0('0x20'));if(!_0x3eb0db){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x25'));}else{const _0x14ddc6=a18_0x2ec0('0x26');const _0x373926=_0x1d6ca7+'/'+_0x513113+a18_0x2ec0('0x27');_0x43add2['publish'](_0x14ddc6,_0x373926,{'qos':0x1},_0x3054d7=>{console[a18_0x2ec0('0x11')]('publish\x20result:');console[a18_0x2ec0('0x11')](_0x3054d7);if(!_0x3054d7){}});}});_0x43add2['on']('close',()=>{console[a18_0x2ec0('0x11')]('close');});_0x43add2['on'](a18_0x2ec0('0x28'),_0xfddadb=>{console['log']('error',_0xfddadb);});_0x43add2['on'](a18_0x2ec0('0x29'),(_0x932e29,_0x596e7c)=>{let _0x50cda8=a18_0x2ec0('0x2a');console[a18_0x2ec0('0x11')](_0x932e29);console[a18_0x2ec0('0x11')](_0x596e7c+'');if(_0x932e29===a18_0x2ec0('0x1b')+_0x513113+a18_0x2ec0('0x22')){_0x50cda8=a18_0x2ec0('0x2b');}else if(_0x932e29[a18_0x2ec0('0x2c')](a18_0x2ec0('0x1b')+_0x513113+a18_0x2ec0('0x2d'))){_0x50cda8='Command\x20message\x20received:\x20';}_0x50cda8+=Buffer[a18_0x2ec0('0x2e')](_0x596e7c,a18_0x2ec0('0x2f'))[a18_0x2ec0('0x30')](a18_0x2ec0('0x31'));console[a18_0x2ec0('0x11')](_0x50cda8);});_0x43add2['on'](a18_0x2ec0('0x32'),()=>{});console[a18_0x2ec0('0x11')](_0x22a1f8);}[a18_0x2ec0('0xf')](){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x33'));this['clientId']=uuidv4();console[a18_0x2ec0('0x11')](a18_0x2ec0('0x34'));console[a18_0x2ec0('0x11')](this[a18_0x2ec0('0x35')]);const _0x466895={'clientId':this[a18_0x2ec0('0x35')],'username':a18_0x2ec0('0x36'),'password':a18_0x2ec0('0x37'),'clean':!![]};this[a18_0x2ec0('0x38')]=mqtt[a18_0x2ec0('0x20')](a18_0x2ec0('0x39'),_0x466895);this[a18_0x2ec0('0x38')]['on'](a18_0x2ec0('0x20'),this[a18_0x2ec0('0x3a')]['bind'](this));this[a18_0x2ec0('0x38')]['on'](a18_0x2ec0('0x29'),this['mqttClient_message'][a18_0x2ec0('0x3b')](this));this['mqttClient']['on'](a18_0x2ec0('0x3c'),()=>{console[a18_0x2ec0('0x11')](a18_0x2ec0('0x3c'));});process['on']('exit',this[a18_0x2ec0('0x3d')][a18_0x2ec0('0x3b')](this));process['on'](a18_0x2ec0('0x3e'),this[a18_0x2ec0('0x3d')]['bind'](this));process['on'](a18_0x2ec0('0x3f'),this[a18_0x2ec0('0x3d')][a18_0x2ec0('0x3b')](this));}[a18_0x2ec0('0x3a')](){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x40')+this[a18_0x2ec0('0x35')]);this[a18_0x2ec0('0x38')][a18_0x2ec0('0x21')](a18_0x2ec0('0x41'));this['mqttClient'][a18_0x2ec0('0x21')]('player/close');this['mqttClient'][a18_0x2ec0('0x21')]('player/reboot',{'qos':0x2});this['mqttClient'][a18_0x2ec0('0x21')](a18_0x2ec0('0x42'),{'qos':0x2});this[a18_0x2ec0('0x38')][a18_0x2ec0('0x21')]('player/reload_playlist',{'qos':0x2});this['mqttClient'][a18_0x2ec0('0x21')]('player/update',{'qos':0x2});this[a18_0x2ec0('0x38')]['subscribe'](a18_0x2ec0('0x43'),{'qos':0x2});this[a18_0x2ec0('0x38')][a18_0x2ec0('0x21')](a18_0x2ec0('0x44'),{'qos':0x2});}[a18_0x2ec0('0x45')](){}[a18_0x2ec0('0x46')](_0xf43653,_0x1def62){console[a18_0x2ec0('0x11')]('received\x20message\x20%s\x20%s',_0xf43653,_0x1def62);switch(_0xf43653){case a18_0x2ec0('0x41'):return this[a18_0x2ec0('0x47')](_0x1def62);case'player/close':return this[a18_0x2ec0('0x48')](_0x1def62);case a18_0x2ec0('0x49'):return this[a18_0x2ec0('0x4a')](_0x1def62);case a18_0x2ec0('0x4b'):return this['handleReloadPlaylistRequest'](_0x1def62);case a18_0x2ec0('0x42'):return this['handleLoadPlaylistRequest'](_0x1def62);case a18_0x2ec0('0x4c'):return this[a18_0x2ec0('0x4d')](_0x1def62);case a18_0x2ec0('0x43'):return this[a18_0x2ec0('0x4e')](_0x1def62);case'player/register':return this['handleRegisterRequest'](_0x1def62);}}[a18_0x2ec0('0x4f')](_0x19f297){if(_0x19f297==a18_0x2ec0('0x50')||_0x19f297==String(this[a18_0x2ec0('0x51')][a18_0x2ec0('0x52')])){this[a18_0x2ec0('0x51')][a18_0x2ec0('0x53')]();}}[a18_0x2ec0('0x4e')](_0x321668){if(_0x321668==a18_0x2ec0('0x50')||_0x321668==String(this['syncPlaylistsService'][a18_0x2ec0('0x52')])){}}['handleUpdateRequest'](_0x38e4b7){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x54')+_0x38e4b7);if(_0x38e4b7=='all'||_0x38e4b7==String(this[a18_0x2ec0('0x51')][a18_0x2ec0('0x52')])){const _0x563cdf=__dirname;const _0x3e68d0=require(a18_0x2ec0('0x55'))(_0x563cdf);console[a18_0x2ec0('0x11')](a18_0x2ec0('0x56'));_0x3e68d0[a18_0x2ec0('0x57')]((_0x1205f8,_0x16345d)=>{if(_0x1205f8){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x58'));this[a18_0x2ec0('0x4d')](_0x38e4b7);return;}else{}console[a18_0x2ec0('0x11')](a18_0x2ec0('0x59'));console[a18_0x2ec0('0x11')](_0x16345d);if(_0x16345d&&_0x16345d[a18_0x2ec0('0x5a')][a18_0x2ec0('0x5b')]){const _0x137a74=spawn(a18_0x2ec0('0x5c'),['-r',a18_0x2ec0('0x5d')]);}else{}});}}[a18_0x2ec0('0x5e')](_0x43c26c){if(_0x43c26c=='all'||_0x43c26c==String(this['syncPlaylistsService'][a18_0x2ec0('0x52')])){this[a18_0x2ec0('0x51')][a18_0x2ec0('0x5f')]();}}[a18_0x2ec0('0x60')](_0x1915b4){if(String(_0x1915b4)==a18_0x2ec0('0x50')||String(_0x1915b4)==String(this[a18_0x2ec0('0x51')][a18_0x2ec0('0x52')])){this[a18_0x2ec0('0x51')][a18_0x2ec0('0x61')]();}}[a18_0x2ec0('0x4a')](_0x16bc09){if(_0x16bc09==a18_0x2ec0('0x50')||_0x16bc09==String(this[a18_0x2ec0('0x51')][a18_0x2ec0('0x52')])){console['log'](a18_0x2ec0('0x4a'));const _0x12fabe=spawn('sudo',[a18_0x2ec0('0x5c'),'-r',a18_0x2ec0('0x5d')]);}}[a18_0x2ec0('0x62')](){console[a18_0x2ec0('0x11')](a18_0x2ec0('0x63'),this[a18_0x2ec0('0xb')]);this[a18_0x2ec0('0x38')][a18_0x2ec0('0x64')](a18_0x2ec0('0x65'),this[a18_0x2ec0('0x51')][a18_0x2ec0('0x52')]+'-'+this[a18_0x2ec0('0xb')]);}['handleOpenRequest'](_0xae5730){if(this['state']!==a18_0x2ec0('0x66')&&this['state']!=='opening'){console['log']('opening\x20player\x20door');this[a18_0x2ec0('0xb')]=a18_0x2ec0('0x67');this['sendStateUpdate']();setTimeout(()=>{this[a18_0x2ec0('0xb')]=a18_0x2ec0('0x66');this['sendStateUpdate']();},0x1388);}}[a18_0x2ec0('0x48')](_0x5b4f70){if(this['state']!=='closed'&&this[a18_0x2ec0('0xb')]!==a18_0x2ec0('0x68')){this[a18_0x2ec0('0xb')]='closing';this[a18_0x2ec0('0x62')]();setTimeout(()=>{this[a18_0x2ec0('0xb')]=a18_0x2ec0('0xc');this[a18_0x2ec0('0x62')]();},0x1388);}}[a18_0x2ec0('0x3d')](_0x512aca,_0x1a6cf2){if(_0x1a6cf2){console[a18_0x2ec0('0x11')](_0x1a6cf2['stack']);}this[a18_0x2ec0('0x38')][a18_0x2ec0('0x64')](a18_0x2ec0('0x69'),a18_0x2ec0('0x6a'));}[a18_0x2ec0('0x6b')](_0x516365,_0x3d815b,_0x3edc18){const _0x430f57={'iat':Math[a18_0x2ec0('0x1f')](Date['now']()/0x3e8),'exp':Math[a18_0x2ec0('0x1f')](Date[a18_0x2ec0('0x5d')]()/0x3e8)+0x14*0x3c,'aud':_0x516365};const _0x35897=fs[a18_0x2ec0('0x6c')](_0x3d815b);return jwt[a18_0x2ec0('0x6d')](_0x430f57,_0x35897,{'algorithm':_0x3edc18});}}exports['MqttService']=MqttService;