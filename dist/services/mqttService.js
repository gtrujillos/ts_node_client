var a18_0x5034=['now','connect','subscribe','/state','/commands/#','/projects/velvety-glazing-252020/topics/my-topic','-payload-0','publish','publish\x20result:','close','error','message','Message\x20received:\x20','/config','Config\x20message\x20received:\x20','/commands','Command\x20message\x20received:\x20','from','base64','toString','ascii','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','mqtt://lulo.run','mqttClient_connect','bind','handleAppExit','SIGINT','Connected\x20to\x20broker\x20client:','player/open','player/close','player/reboot','player/reload_playlist','player/ifconfig','player/register','player/update_settings','reportStatus','mqttClient_message','received\x20message\x20%s\x20%s','handleOpenRequest','handleCloseRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','player/update','handleUpdateRequest','handleIfconfigRequest','handleRegisterRequest','handleUpdateSettingsRequest','all','playerId','registerClient','handleUpdateRequest:\x20','simple-git','Git\x20updating','pull','Error\x20git\x20updated','Git\x20updated','summary','changes','reboot','loadMediaList','handleRebootRequest','handleRebootRequest\x20shutdown\x20-r\x20now:\x20','handleUpdateSettingsRequest:\x20','updateSettings','sendStateUpdate','sending\x20state\x20%s','player/state','open','opening','opening\x20player\x20door','closing','stack','player/connected','false','readFileSync','sign','MqttService','defineProperty','__esModule','./../infrastructure/HttpClientService','fs-extra','request','request-progress','child_process','exec','is-image','string-template','mqtt','uuid/v4','jsonwebtoken','syncPlaylistsService','state','closed','httpClientService','init','mqttInit_mosquitto','log','mqttInit','velvety-glazing-252020','my-node-device','RS256','resources/keys/rsa_private.pem','events','/devices/','unused','createJwt','mqtts','TLSv1_2_method','round'];(function(_0x1619ae,_0x3cd81b){var _0x132687=function(_0x2fd3a4){while(--_0x2fd3a4){_0x1619ae['push'](_0x1619ae['shift']());}};_0x132687(++_0x3cd81b);}(a18_0x5034,0xc2));var a18_0x394c=function(_0x10493e,_0x299fc8){_0x10493e=_0x10493e-0x0;var _0x481d51=a18_0x5034[_0x10493e];return _0x481d51;};'use strict';Object[a18_0x394c('0x0')](exports,a18_0x394c('0x1'),{'value':!![]});const HttpClientService_1=require(a18_0x394c('0x2'));const fs=require('fs');const fsExtra=require(a18_0x394c('0x3'));const request=require(a18_0x394c('0x4'));const progress=require(a18_0x394c('0x5'));const spawn=require(a18_0x394c('0x6'))['spawn'];const exec=require(a18_0x394c('0x6'))[a18_0x394c('0x7')];const isImage=require(a18_0x394c('0x8'));const format=require(a18_0x394c('0x9'));const os=require('os');const mqtt=require(a18_0x394c('0xa'));const uuidv4=require(a18_0x394c('0xb'));const jwt=require(a18_0x394c('0xc'));class MqttService{constructor(_0x38885a){this[a18_0x394c('0xd')]=_0x38885a;this[a18_0x394c('0xe')]=a18_0x394c('0xf');this[a18_0x394c('0x10')]=new HttpClientService_1['HttpClientService']();}[a18_0x394c('0x11')](){this[a18_0x394c('0x12')]();}['mqttInit_google'](){console[a18_0x394c('0x13')](a18_0x394c('0x14'));const _0x15cd9b=a18_0x394c('0x15');const _0x59d983=a18_0x394c('0x16');const _0xd4f222='my-registry';const _0xa67545='us-central1';const _0x1b58e8=a18_0x394c('0x17');const _0x3ae3c4=a18_0x394c('0x18');const _0x4cf1f3='mqtt.googleapis.com';const _0x38f76c=0x1bb;const _0xbef8e=a18_0x394c('0x19');const _0x477d96=0x5;const _0xd96113='projects/'+_0x15cd9b+'/locations/'+_0xa67545+'/registries/'+_0xd4f222+a18_0x394c('0x1a')+_0x59d983;const _0x44fb41={'host':_0x4cf1f3,'port':_0x38f76c,'clientId':_0xd96113,'username':a18_0x394c('0x1b'),'password':this[a18_0x394c('0x1c')](_0x15cd9b,_0x3ae3c4,_0x1b58e8),'protocol':a18_0x394c('0x1d'),'secureProtocol':a18_0x394c('0x1e')};const _0x1e5a71=Math[a18_0x394c('0x1f')](Date[a18_0x394c('0x20')]()/0x3e8);const _0x20643b=mqtt[a18_0x394c('0x21')](_0x44fb41);_0x20643b['subscribe'](a18_0x394c('0x1a')+_0x59d983+'/config',{'qos':0x1});_0x20643b[a18_0x394c('0x22')](a18_0x394c('0x1a')+_0x59d983+a18_0x394c('0x23'),{'qos':0x1});_0x20643b[a18_0x394c('0x22')]('/devices/'+_0x59d983+a18_0x394c('0x24'),{'qos':0x0});const _0x3e4b5b=a18_0x394c('0x1a')+_0x59d983+'/'+_0xbef8e;_0x20643b['on']('connect',_0x41b8b2=>{console[a18_0x394c('0x13')]('connect');if(!_0x41b8b2){console[a18_0x394c('0x13')]('Client\x20not\x20connected...');}else{const _0x3e4b5b=a18_0x394c('0x25');const _0xd0316=_0xd4f222+'/'+_0x59d983+a18_0x394c('0x26');_0x20643b[a18_0x394c('0x27')](_0x3e4b5b,_0xd0316,{'qos':0x1},_0x2baee6=>{console[a18_0x394c('0x13')](a18_0x394c('0x28'));console[a18_0x394c('0x13')](_0x2baee6);if(!_0x2baee6){}});}});_0x20643b['on'](a18_0x394c('0x29'),()=>{console[a18_0x394c('0x13')](a18_0x394c('0x29'));});_0x20643b['on']('error',_0x478054=>{console[a18_0x394c('0x13')](a18_0x394c('0x2a'),_0x478054);});_0x20643b['on'](a18_0x394c('0x2b'),(_0x1dc34d,_0x46335a)=>{let _0x94d400=a18_0x394c('0x2c');console[a18_0x394c('0x13')](_0x1dc34d);console[a18_0x394c('0x13')](_0x46335a+'');if(_0x1dc34d===a18_0x394c('0x1a')+_0x59d983+a18_0x394c('0x2d')){_0x94d400=a18_0x394c('0x2e');}else if(_0x1dc34d['startsWith'](a18_0x394c('0x1a')+_0x59d983+a18_0x394c('0x2f'))){_0x94d400=a18_0x394c('0x30');}_0x94d400+=Buffer[a18_0x394c('0x31')](_0x46335a,a18_0x394c('0x32'))[a18_0x394c('0x33')](a18_0x394c('0x34'));console[a18_0x394c('0x13')](_0x94d400);});_0x20643b['on']('packetsend',()=>{});console[a18_0x394c('0x13')](_0x44fb41);}['mqttInit_mosquitto'](){console[a18_0x394c('0x13')](a18_0x394c('0x14'));this[a18_0x394c('0x35')]=uuidv4();console[a18_0x394c('0x13')](a18_0x394c('0x36'));console[a18_0x394c('0x13')](this[a18_0x394c('0x35')]);const _0x357df4={'clientId':this[a18_0x394c('0x35')],'username':a18_0x394c('0x37'),'password':a18_0x394c('0x38'),'clean':!![]};this[a18_0x394c('0x39')]=mqtt['connect'](a18_0x394c('0x3a'),_0x357df4);this[a18_0x394c('0x39')]['on'](a18_0x394c('0x21'),this[a18_0x394c('0x3b')][a18_0x394c('0x3c')](this));this[a18_0x394c('0x39')]['on']('message',this['mqttClient_message'][a18_0x394c('0x3c')](this));this[a18_0x394c('0x39')]['on'](a18_0x394c('0x29'),()=>{console['log'](a18_0x394c('0x29'));});process['on']('exit',this[a18_0x394c('0x3d')]['bind'](this));process['on'](a18_0x394c('0x3e'),this[a18_0x394c('0x3d')][a18_0x394c('0x3c')](this));process['on']('uncaughtException',this[a18_0x394c('0x3d')]['bind'](this));}['mqttClient_connect'](){console['log'](a18_0x394c('0x3f')+this[a18_0x394c('0x35')]);this[a18_0x394c('0x39')]['subscribe'](a18_0x394c('0x40'));this[a18_0x394c('0x39')]['subscribe'](a18_0x394c('0x41'));this[a18_0x394c('0x39')][a18_0x394c('0x22')](a18_0x394c('0x42'),{'qos':0x2});this[a18_0x394c('0x39')][a18_0x394c('0x22')]('player/load_playlist',{'qos':0x2});this[a18_0x394c('0x39')][a18_0x394c('0x22')](a18_0x394c('0x43'),{'qos':0x2});this[a18_0x394c('0x39')]['subscribe']('player/update',{'qos':0x2});this[a18_0x394c('0x39')][a18_0x394c('0x22')](a18_0x394c('0x44'),{'qos':0x2});this[a18_0x394c('0x39')]['subscribe'](a18_0x394c('0x45'),{'qos':0x2});this[a18_0x394c('0x39')]['subscribe'](a18_0x394c('0x46'),{'qos':0x2});}[a18_0x394c('0x47')](){}[a18_0x394c('0x48')](_0x376b53,_0x1da72d){console[a18_0x394c('0x13')](a18_0x394c('0x49'),_0x376b53,_0x1da72d);switch(_0x376b53){case a18_0x394c('0x40'):return this[a18_0x394c('0x4a')](_0x1da72d);case a18_0x394c('0x41'):return this[a18_0x394c('0x4b')](_0x1da72d);case a18_0x394c('0x42'):return this['handleRebootRequest'](_0x1da72d);case a18_0x394c('0x43'):return this[a18_0x394c('0x4c')](_0x1da72d);case'player/load_playlist':return this[a18_0x394c('0x4d')](_0x1da72d);case a18_0x394c('0x4e'):return this[a18_0x394c('0x4f')](_0x1da72d);case a18_0x394c('0x44'):return this[a18_0x394c('0x50')](_0x1da72d);case a18_0x394c('0x45'):return this[a18_0x394c('0x51')](_0x1da72d);case a18_0x394c('0x46'):return this[a18_0x394c('0x52')](_0x1da72d);}}[a18_0x394c('0x51')](_0x23768d){if(_0x23768d==a18_0x394c('0x53')||_0x23768d==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){this[a18_0x394c('0xd')][a18_0x394c('0x55')]();}}[a18_0x394c('0x50')](_0x2e7eb6){if(_0x2e7eb6==a18_0x394c('0x53')||_0x2e7eb6==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){}}[a18_0x394c('0x4f')](_0x530a43){console['log'](a18_0x394c('0x56')+_0x530a43);if(_0x530a43=='all'||_0x530a43==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){const _0x3e5f77=__dirname;const _0x301fe4=require(a18_0x394c('0x57'))(_0x3e5f77);console[a18_0x394c('0x13')](a18_0x394c('0x58'));_0x301fe4[a18_0x394c('0x59')]((_0x3a4d72,_0x2f333c)=>{if(_0x3a4d72){console[a18_0x394c('0x13')](a18_0x394c('0x5a'));this['handleUpdateRequest'](_0x530a43);return;}else{}console[a18_0x394c('0x13')](a18_0x394c('0x5b'));console['log'](_0x2f333c);if(_0x2f333c&&_0x2f333c[a18_0x394c('0x5c')][a18_0x394c('0x5d')]){this['syncPlaylistsService'][a18_0x394c('0x5e')]();}else{}});}}[a18_0x394c('0x4d')](_0x51021c){if(_0x51021c==a18_0x394c('0x53')||_0x51021c==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){this[a18_0x394c('0xd')][a18_0x394c('0x5f')]();}}[a18_0x394c('0x4c')](_0xd1c2fd){if(String(_0xd1c2fd)==a18_0x394c('0x53')||String(_0xd1c2fd)==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){this['syncPlaylistsService']['reloadMediaList']();}}[a18_0x394c('0x60')](_0x40f3a7){if(_0x40f3a7==a18_0x394c('0x53')||_0x40f3a7==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){console[a18_0x394c('0x13')](a18_0x394c('0x61'));try{this['syncPlaylistsService']['reboot']();}catch(_0x4e5038){console[a18_0x394c('0x13')](_0x4e5038);}}}[a18_0x394c('0x52')](_0x28e6d4){if(_0x28e6d4==a18_0x394c('0x53')||_0x28e6d4==String(this[a18_0x394c('0xd')][a18_0x394c('0x54')])){console['log'](a18_0x394c('0x62'));try{this[a18_0x394c('0xd')][a18_0x394c('0x63')]();}catch(_0x4505bc){console[a18_0x394c('0x13')](_0x4505bc);}}}[a18_0x394c('0x64')](){console[a18_0x394c('0x13')](a18_0x394c('0x65'),this['state']);this[a18_0x394c('0x39')][a18_0x394c('0x27')](a18_0x394c('0x66'),this['syncPlaylistsService'][a18_0x394c('0x54')]+'-'+this[a18_0x394c('0xe')]);}[a18_0x394c('0x4a')](_0x86410f){if(this[a18_0x394c('0xe')]!==a18_0x394c('0x67')&&this['state']!==a18_0x394c('0x68')){console['log'](a18_0x394c('0x69'));this[a18_0x394c('0xe')]=a18_0x394c('0x68');this[a18_0x394c('0x64')]();setTimeout(()=>{this[a18_0x394c('0xe')]=a18_0x394c('0x67');this['sendStateUpdate']();},0x1388);}}[a18_0x394c('0x4b')](_0x322877){if(this[a18_0x394c('0xe')]!=='closed'&&this[a18_0x394c('0xe')]!==a18_0x394c('0x6a')){this['state']='closing';this[a18_0x394c('0x64')]();setTimeout(()=>{this[a18_0x394c('0xe')]=a18_0x394c('0xf');this[a18_0x394c('0x64')]();},0x1388);}}[a18_0x394c('0x3d')](_0x370f27,_0x3d1f15){if(_0x3d1f15){console['log'](_0x3d1f15[a18_0x394c('0x6b')]);}this[a18_0x394c('0x39')][a18_0x394c('0x27')](a18_0x394c('0x6c'),a18_0x394c('0x6d'));}[a18_0x394c('0x1c')](_0x3fbf96,_0x82250c,_0x5de775){const _0x3759dc={'iat':Math[a18_0x394c('0x1f')](Date[a18_0x394c('0x20')]()/0x3e8),'exp':Math[a18_0x394c('0x1f')](Date[a18_0x394c('0x20')]()/0x3e8)+0x14*0x3c,'aud':_0x3fbf96};const _0xce9763=fs[a18_0x394c('0x6e')](_0x82250c);return jwt[a18_0x394c('0x6f')](_0x3759dc,_0xce9763,{'algorithm':_0x5de775});}}exports[a18_0x394c('0x70')]=MqttService;