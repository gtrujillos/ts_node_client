var a18_0x20a1=['uuid/v4','syncPlaylistsService','state','httpClientService','init','mqttInit','log','clientId','this.clientId','lulo_mqtt','run.lulo_2018#.','mqttClient','connect','mqttClient_connect','message','mqttClient_message','bind','exit','handleAppExit','SIGINT','subscribe','player/open','player/close','player/reboot','player/load_playlist','player/reload_playlist','player/update','reportStatus','handleOpenRequest','handleReloadPlaylistRequest','handleLoadPlaylistRequest','handleUpdateRequest','Git\x20updating','pull','Error\x20git\x20updated','changes','shutdown','now','playerId','loadMediaList','reloadMediaList','handleRebootRequest','all','publish','player/state','open','opening','opening\x20player\x20door','sendStateUpdate','handleCloseRequest','closed','closing','stack','player/connected','false','MqttService','__esModule','fs-extra','request','request-progress','child_process','is-image','mqtt'];(function(_0x34f6d1,_0x4b8a80){var _0x1df8ed=function(_0x3988c5){while(--_0x3988c5){_0x34f6d1['push'](_0x34f6d1['shift']());}};_0x1df8ed(++_0x4b8a80);}(a18_0x20a1,0xf5));var a18_0x4c81=function(_0x3a7aa2,_0xc18dd2){_0x3a7aa2=_0x3a7aa2-0x0;var _0x1771c5=a18_0x20a1[_0x3a7aa2];return _0x1771c5;};'use strict';Object['defineProperty'](exports,a18_0x4c81('0x0'),{'value':!![]});const HttpClientService_1=require('./../infrastructure/HttpClientService');const fs=require('fs');const fsExtra=require(a18_0x4c81('0x1'));const request=require(a18_0x4c81('0x2'));const progress=require(a18_0x4c81('0x3'));const spawn=require(a18_0x4c81('0x4'))['spawn'];const isImage=require(a18_0x4c81('0x5'));const format=require('string-template');const os=require('os');const mqtt=require(a18_0x4c81('0x6'));const uuidv4=require(a18_0x4c81('0x7'));class MqttService{constructor(_0x558aea){this[a18_0x4c81('0x8')]=_0x558aea;this[a18_0x4c81('0x9')]='closed';this[a18_0x4c81('0xa')]=new HttpClientService_1['HttpClientService']();}[a18_0x4c81('0xb')](){this['mqttInit']();}[a18_0x4c81('0xc')](){console[a18_0x4c81('0xd')](a18_0x4c81('0xc'));this[a18_0x4c81('0xe')]=uuidv4();console['log'](a18_0x4c81('0xf'));console[a18_0x4c81('0xd')](this[a18_0x4c81('0xe')]);const _0x497f99={'clientId':this[a18_0x4c81('0xe')],'username':a18_0x4c81('0x10'),'password':a18_0x4c81('0x11'),'clean':!![]};this[a18_0x4c81('0x12')]=mqtt[a18_0x4c81('0x13')]('mqtt://lulo.run',_0x497f99);this['mqttClient']['on'](a18_0x4c81('0x13'),this[a18_0x4c81('0x14')]['bind'](this));this['mqttClient']['on'](a18_0x4c81('0x15'),this[a18_0x4c81('0x16')][a18_0x4c81('0x17')](this));process['on'](a18_0x4c81('0x18'),this[a18_0x4c81('0x19')][a18_0x4c81('0x17')](this));process['on'](a18_0x4c81('0x1a'),this[a18_0x4c81('0x19')][a18_0x4c81('0x17')](this));process['on']('uncaughtException',this[a18_0x4c81('0x19')][a18_0x4c81('0x17')](this));}['mqttClient_connect'](){console['log']('Connected\x20to\x20broker\x20client:'+this[a18_0x4c81('0xe')]);this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x1c'));this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x1d'));this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x1e'),{'qos':0x2});this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x1f'),{'qos':0x2});this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x20'),{'qos':0x2});this[a18_0x4c81('0x12')][a18_0x4c81('0x1b')](a18_0x4c81('0x21'),{'qos':0x2});}[a18_0x4c81('0x22')](){}[a18_0x4c81('0x16')](_0x285232,_0x5bf3d5){console[a18_0x4c81('0xd')]('received\x20message\x20%s\x20%s',_0x285232,_0x5bf3d5);switch(_0x285232){case a18_0x4c81('0x1c'):return this[a18_0x4c81('0x23')](_0x5bf3d5);case a18_0x4c81('0x1d'):return this['handleCloseRequest'](_0x5bf3d5);case'player/reboot':return this['handleRebootRequest'](_0x5bf3d5);case a18_0x4c81('0x20'):return this[a18_0x4c81('0x24')](_0x5bf3d5);case a18_0x4c81('0x1f'):return this[a18_0x4c81('0x25')](_0x5bf3d5);case a18_0x4c81('0x21'):return this[a18_0x4c81('0x26')](_0x5bf3d5);}}[a18_0x4c81('0x26')](_0x4dac8e){if(_0x4dac8e=='all'||_0x4dac8e==String(this[a18_0x4c81('0x8')]['playerId'])){const _0x288365=__dirname;const _0x5355bd=require('simple-git')(_0x288365);console['log'](a18_0x4c81('0x27'));_0x5355bd[a18_0x4c81('0x28')]((_0xd368a2,_0x1d1fe6)=>{if(_0xd368a2){console[a18_0x4c81('0xd')](a18_0x4c81('0x29'));this['handleUpdateRequest'](_0x4dac8e);return;}else{}console[a18_0x4c81('0xd')]('Git\x20updated');console['log'](_0x1d1fe6);if(_0x1d1fe6&&_0x1d1fe6['summary'][a18_0x4c81('0x2a')]){const _0x30f02e=spawn(a18_0x4c81('0x2b'),['-r',a18_0x4c81('0x2c')]);}else{}});}}['handleLoadPlaylistRequest'](_0x431b33){if(_0x431b33=='all'||_0x431b33==String(this[a18_0x4c81('0x8')][a18_0x4c81('0x2d')])){this[a18_0x4c81('0x8')][a18_0x4c81('0x2e')]();}}[a18_0x4c81('0x24')](_0x5a6fd4){if(String(_0x5a6fd4)=='all'||String(_0x5a6fd4)==String(this[a18_0x4c81('0x8')][a18_0x4c81('0x2d')])){this[a18_0x4c81('0x8')][a18_0x4c81('0x2f')]();}}[a18_0x4c81('0x30')](_0x3780b6){if(_0x3780b6==a18_0x4c81('0x31')||_0x3780b6==String(this[a18_0x4c81('0x8')][a18_0x4c81('0x2d')])){const _0x471826=spawn(a18_0x4c81('0x2b'),['-r',a18_0x4c81('0x2c')]);}}['sendStateUpdate'](){console['log']('sending\x20state\x20%s',this['state']);this[a18_0x4c81('0x12')][a18_0x4c81('0x32')](a18_0x4c81('0x33'),this[a18_0x4c81('0x8')][a18_0x4c81('0x2d')]+'-'+this['state']);}[a18_0x4c81('0x23')](_0x477052){if(this[a18_0x4c81('0x9')]!==a18_0x4c81('0x34')&&this[a18_0x4c81('0x9')]!==a18_0x4c81('0x35')){console[a18_0x4c81('0xd')](a18_0x4c81('0x36'));this[a18_0x4c81('0x9')]=a18_0x4c81('0x35');this[a18_0x4c81('0x37')]();setTimeout(()=>{this[a18_0x4c81('0x9')]=a18_0x4c81('0x34');this[a18_0x4c81('0x37')]();},0x1388);}}[a18_0x4c81('0x38')](_0x88506b){if(this[a18_0x4c81('0x9')]!==a18_0x4c81('0x39')&&this['state']!==a18_0x4c81('0x3a')){this[a18_0x4c81('0x9')]=a18_0x4c81('0x3a');this['sendStateUpdate']();setTimeout(()=>{this['state']=a18_0x4c81('0x39');this['sendStateUpdate']();},0x1388);}}[a18_0x4c81('0x19')](_0x5ac18f,_0x152af8){if(_0x152af8){console[a18_0x4c81('0xd')](_0x152af8[a18_0x4c81('0x3b')]);}this[a18_0x4c81('0x12')][a18_0x4c81('0x32')](a18_0x4c81('0x3c'),a18_0x4c81('0x3d'));}}exports[a18_0x4c81('0x3e')]=MqttService;