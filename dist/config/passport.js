var a1_0x5ecc=['slice','find','redirect','/auth/','__importDefault','__esModule','defineProperty','passport','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','/auth/facebook/callback','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','name','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','findOne','email','https://graph.facebook.com/','location','isAuthenticated','/login','isAuthorized','path','split'];(function(_0x1d2076,_0x2a7e5a){var _0x6ffefc=function(_0x3ddd21){while(--_0x3ddd21){_0x1d2076['push'](_0x1d2076['shift']());}};_0x6ffefc(++_0x2a7e5a);}(a1_0x5ecc,0x1ea));var a1_0x59a2=function(_0x13c468,_0x41f442){_0x13c468=_0x13c468-0x0;var _0x1c84f3=a1_0x5ecc[_0x13c468];return _0x1c84f3;};'use strict';var __importDefault=this&&this[a1_0x59a2('0x0')]||function(_0x2609c5){return _0x2609c5&&_0x2609c5[a1_0x59a2('0x1')]?_0x2609c5:{'default':_0x2609c5};};Object[a1_0x59a2('0x2')](exports,a1_0x59a2('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x59a2('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x59a2('0x4')));const lodash_1=__importDefault(require(a1_0x59a2('0x5')));const User_1=__importDefault(require(a1_0x59a2('0x6')));const LocalStrategy=passport_local_1[a1_0x59a2('0x7')][a1_0x59a2('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x59a2('0x7')][a1_0x59a2('0x8')];passport_1['default'][a1_0x59a2('0x9')]((_0x1332ae,_0x169b65)=>{_0x169b65(undefined,_0x1332ae['id']);});passport_1[a1_0x59a2('0x7')][a1_0x59a2('0xa')]((_0xa432d2,_0x2da0bd)=>{User_1[a1_0x59a2('0x7')][a1_0x59a2('0xb')](_0xa432d2,(_0x2eabd5,_0x5aeeb8)=>{_0x2da0bd(_0x2eabd5,_0x5aeeb8);});});passport_1['default'][a1_0x59a2('0xc')](new LocalStrategy({'usernameField':'email'},(_0x4e8b47,_0x951598,_0x3ca56b)=>{User_1[a1_0x59a2('0x7')]['findOne']({'email':_0x4e8b47[a1_0x59a2('0xd')]()},(_0x8c9cc4,_0x50d7eb)=>{if(_0x8c9cc4){return _0x3ca56b(_0x8c9cc4);}if(!_0x50d7eb){return _0x3ca56b(undefined,![],{'message':a1_0x59a2('0xe')+_0x4e8b47+a1_0x59a2('0xf')});}_0x50d7eb[a1_0x59a2('0x10')](_0x951598,(_0x8c9cc4,_0x143dd7)=>{if(_0x8c9cc4){return _0x3ca56b(_0x8c9cc4);}if(_0x143dd7){return _0x3ca56b(undefined,_0x50d7eb);}return _0x3ca56b(undefined,![],{'message':a1_0x59a2('0x11')});});});}));passport_1[a1_0x59a2('0x7')][a1_0x59a2('0xc')](new FacebookStrategy({'clientID':process[a1_0x59a2('0x12')][a1_0x59a2('0x13')],'clientSecret':process[a1_0x59a2('0x12')]['FACEBOOK_SECRET'],'callbackURL':a1_0x59a2('0x14'),'profileFields':['name','email',a1_0x59a2('0x15'),a1_0x59a2('0x16'),a1_0x59a2('0x17')],'passReqToCallback':!![]},(_0x540d2b,_0x9a5034,_0x2fe662,_0x65e7f,_0x17130e)=>{if(_0x540d2b[a1_0x59a2('0x18')]){User_1[a1_0x59a2('0x7')]['findOne']({'facebook':_0x65e7f['id']},(_0x1f7fc2,_0x51e1db)=>{if(_0x1f7fc2){return _0x17130e(_0x1f7fc2);}if(_0x51e1db){_0x540d2b[a1_0x59a2('0x19')](a1_0x59a2('0x1a'),{'msg':a1_0x59a2('0x1b')});_0x17130e(_0x1f7fc2);}else{User_1[a1_0x59a2('0x7')][a1_0x59a2('0xb')](_0x540d2b[a1_0x59a2('0x18')]['id'],(_0x1f7fc2,_0x52fd24)=>{if(_0x1f7fc2){return _0x17130e(_0x1f7fc2);}_0x52fd24[a1_0x59a2('0x1c')]=_0x65e7f['id'];_0x52fd24[a1_0x59a2('0x1d')][a1_0x59a2('0x1e')]({'kind':a1_0x59a2('0x1c'),'accessToken':_0x9a5034});_0x52fd24[a1_0x59a2('0x1f')][a1_0x59a2('0x20')]=_0x52fd24['profile']['name']||_0x65e7f[a1_0x59a2('0x20')][a1_0x59a2('0x21')]+'\x20'+_0x65e7f[a1_0x59a2('0x20')][a1_0x59a2('0x22')];_0x52fd24[a1_0x59a2('0x1f')][a1_0x59a2('0x23')]=_0x52fd24[a1_0x59a2('0x1f')]['gender']||_0x65e7f[a1_0x59a2('0x24')][a1_0x59a2('0x23')];_0x52fd24[a1_0x59a2('0x1f')][a1_0x59a2('0x25')]=_0x52fd24[a1_0x59a2('0x1f')][a1_0x59a2('0x25')]||'https://graph.facebook.com/'+_0x65e7f['id']+a1_0x59a2('0x26');_0x52fd24[a1_0x59a2('0x27')](_0x1f7fc2=>{_0x540d2b[a1_0x59a2('0x19')](a1_0x59a2('0x28'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x17130e(_0x1f7fc2,_0x52fd24);});});}});}else{User_1[a1_0x59a2('0x7')]['findOne']({'facebook':_0x65e7f['id']},(_0x11e324,_0xc67401)=>{if(_0x11e324){return _0x17130e(_0x11e324);}if(_0xc67401){return _0x17130e(undefined,_0xc67401);}User_1[a1_0x59a2('0x7')][a1_0x59a2('0x29')]({'email':_0x65e7f[a1_0x59a2('0x24')][a1_0x59a2('0x2a')]},(_0x11e324,_0x31125e)=>{if(_0x11e324){return _0x17130e(_0x11e324);}if(_0x31125e){_0x540d2b[a1_0x59a2('0x19')](a1_0x59a2('0x1a'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x17130e(_0x11e324);}else{const _0x11568c=new User_1[(a1_0x59a2('0x7'))]();_0x11568c[a1_0x59a2('0x2a')]=_0x65e7f['_json'][a1_0x59a2('0x2a')];_0x11568c['facebook']=_0x65e7f['id'];_0x11568c[a1_0x59a2('0x1d')][a1_0x59a2('0x1e')]({'kind':a1_0x59a2('0x1c'),'accessToken':_0x9a5034});_0x11568c[a1_0x59a2('0x1f')][a1_0x59a2('0x20')]=_0x65e7f[a1_0x59a2('0x20')][a1_0x59a2('0x21')]+'\x20'+_0x65e7f['name'][a1_0x59a2('0x22')];_0x11568c[a1_0x59a2('0x1f')][a1_0x59a2('0x23')]=_0x65e7f[a1_0x59a2('0x24')][a1_0x59a2('0x23')];_0x11568c[a1_0x59a2('0x1f')][a1_0x59a2('0x25')]=a1_0x59a2('0x2b')+_0x65e7f['id']+'/picture?type=large';_0x11568c[a1_0x59a2('0x1f')][a1_0x59a2('0x2c')]=_0x65e7f[a1_0x59a2('0x24')][a1_0x59a2('0x2c')]?_0x65e7f[a1_0x59a2('0x24')][a1_0x59a2('0x2c')]['name']:'';_0x11568c[a1_0x59a2('0x27')](_0x11e324=>{_0x17130e(_0x11e324,_0x11568c);});}});});}}));exports['isAuthenticated']=(_0x4ae2be,_0x38a9e3,_0x2ef3c4)=>{if(_0x4ae2be[a1_0x59a2('0x2d')]()){return _0x2ef3c4();}_0x38a9e3['redirect'](a1_0x59a2('0x2e'));};exports[a1_0x59a2('0x2f')]=(_0x361d47,_0x5da9ce,_0x51c705)=>{const _0x427b27=_0x361d47[a1_0x59a2('0x30')][a1_0x59a2('0x31')]('/')[a1_0x59a2('0x32')](-0x1)[0x0];if(lodash_1[a1_0x59a2('0x7')][a1_0x59a2('0x33')](_0x361d47['user']['tokens'],{'kind':_0x427b27})){_0x51c705();}else{_0x5da9ce[a1_0x59a2('0x34')](a1_0x59a2('0x35')+_0x427b27);}};