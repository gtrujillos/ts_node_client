var a1_0x37da=['email','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','link','timezone','user','findOne','flash','tokens','push','facebook','profile','name','gender','picture','https://graph.facebook.com/','save','Facebook\x20account\x20has\x20been\x20linked.','errors','_json','givenName','familyName','/picture?type=large','location','isAuthenticated','redirect','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById'];(function(_0x2c23d4,_0x19e976){var _0x13a1b4=function(_0x5ca1e3){while(--_0x5ca1e3){_0x2c23d4['push'](_0x2c23d4['shift']());}};_0x13a1b4(++_0x19e976);}(a1_0x37da,0xbf));var a1_0x5106=function(_0x44409b,_0x465e5e){_0x44409b=_0x44409b-0x0;var _0xf2ab43=a1_0x37da[_0x44409b];return _0xf2ab43;};'use strict';var __importDefault=this&&this[a1_0x5106('0x0')]||function(_0x54e172){return _0x54e172&&_0x54e172[a1_0x5106('0x1')]?_0x54e172:{'default':_0x54e172};};Object[a1_0x5106('0x2')](exports,a1_0x5106('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5106('0x3')));const passport_local_1=__importDefault(require(a1_0x5106('0x4')));const passport_facebook_1=__importDefault(require(a1_0x5106('0x5')));const lodash_1=__importDefault(require(a1_0x5106('0x6')));const User_1=__importDefault(require(a1_0x5106('0x7')));const LocalStrategy=passport_local_1['default'][a1_0x5106('0x8')];const FacebookStrategy=passport_facebook_1['default'][a1_0x5106('0x8')];passport_1[a1_0x5106('0x9')][a1_0x5106('0xa')]((_0x1f8885,_0xc1fad5)=>{_0xc1fad5(undefined,_0x1f8885['id']);});passport_1[a1_0x5106('0x9')][a1_0x5106('0xb')]((_0xd0c770,_0x2a212b)=>{User_1['default'][a1_0x5106('0xc')](_0xd0c770,(_0x2634a5,_0x1dbf5a)=>{_0x2a212b(_0x2634a5,_0x1dbf5a);});});passport_1[a1_0x5106('0x9')]['use'](new LocalStrategy({'usernameField':a1_0x5106('0xd')},(_0x49c434,_0x7e982d,_0x30e410)=>{User_1[a1_0x5106('0x9')]['findOne']({'email':_0x49c434[a1_0x5106('0xe')]()},(_0x2e0007,_0x46410a)=>{if(_0x2e0007){return _0x30e410(_0x2e0007);}if(!_0x46410a){return _0x30e410(undefined,![],{'message':a1_0x5106('0xf')+_0x49c434+a1_0x5106('0x10')});}_0x46410a[a1_0x5106('0x11')](_0x7e982d,(_0x2e0007,_0x57cf11)=>{if(_0x2e0007){return _0x30e410(_0x2e0007);}if(_0x57cf11){return _0x30e410(undefined,_0x46410a);}return _0x30e410(undefined,![],{'message':a1_0x5106('0x12')});});});}));passport_1[a1_0x5106('0x9')]['use'](new FacebookStrategy({'clientID':process[a1_0x5106('0x13')]['FACEBOOK_ID'],'clientSecret':process[a1_0x5106('0x13')][a1_0x5106('0x14')],'callbackURL':a1_0x5106('0x15'),'profileFields':['name',a1_0x5106('0xd'),a1_0x5106('0x16'),'locale',a1_0x5106('0x17')],'passReqToCallback':!![]},(_0x278b1a,_0x571466,_0x182e95,_0x136f61,_0x420281)=>{if(_0x278b1a[a1_0x5106('0x18')]){User_1['default'][a1_0x5106('0x19')]({'facebook':_0x136f61['id']},(_0x4e6659,_0x317d97)=>{if(_0x4e6659){return _0x420281(_0x4e6659);}if(_0x317d97){_0x278b1a[a1_0x5106('0x1a')]('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x420281(_0x4e6659);}else{User_1[a1_0x5106('0x9')][a1_0x5106('0xc')](_0x278b1a[a1_0x5106('0x18')]['id'],(_0x4e6659,_0x252241)=>{if(_0x4e6659){return _0x420281(_0x4e6659);}_0x252241['facebook']=_0x136f61['id'];_0x252241[a1_0x5106('0x1b')][a1_0x5106('0x1c')]({'kind':a1_0x5106('0x1d'),'accessToken':_0x571466});_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x1f')]=_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x1f')]||_0x136f61[a1_0x5106('0x1f')]['givenName']+'\x20'+_0x136f61[a1_0x5106('0x1f')]['familyName'];_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x20')]=_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x20')]||_0x136f61['_json'][a1_0x5106('0x20')];_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x21')]=_0x252241[a1_0x5106('0x1e')][a1_0x5106('0x21')]||a1_0x5106('0x22')+_0x136f61['id']+'/picture?type=large';_0x252241[a1_0x5106('0x23')](_0x4e6659=>{_0x278b1a[a1_0x5106('0x1a')]('info',{'msg':a1_0x5106('0x24')});_0x420281(_0x4e6659,_0x252241);});});}});}else{User_1[a1_0x5106('0x9')][a1_0x5106('0x19')]({'facebook':_0x136f61['id']},(_0x1218bb,_0x94d145)=>{if(_0x1218bb){return _0x420281(_0x1218bb);}if(_0x94d145){return _0x420281(undefined,_0x94d145);}User_1['default'][a1_0x5106('0x19')]({'email':_0x136f61['_json'][a1_0x5106('0xd')]},(_0x1218bb,_0x2d24e7)=>{if(_0x1218bb){return _0x420281(_0x1218bb);}if(_0x2d24e7){_0x278b1a[a1_0x5106('0x1a')](a1_0x5106('0x25'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x420281(_0x1218bb);}else{const _0x417f8b=new User_1['default']();_0x417f8b[a1_0x5106('0xd')]=_0x136f61[a1_0x5106('0x26')][a1_0x5106('0xd')];_0x417f8b[a1_0x5106('0x1d')]=_0x136f61['id'];_0x417f8b[a1_0x5106('0x1b')]['push']({'kind':a1_0x5106('0x1d'),'accessToken':_0x571466});_0x417f8b[a1_0x5106('0x1e')][a1_0x5106('0x1f')]=_0x136f61[a1_0x5106('0x1f')][a1_0x5106('0x27')]+'\x20'+_0x136f61[a1_0x5106('0x1f')][a1_0x5106('0x28')];_0x417f8b['profile'][a1_0x5106('0x20')]=_0x136f61[a1_0x5106('0x26')][a1_0x5106('0x20')];_0x417f8b[a1_0x5106('0x1e')][a1_0x5106('0x21')]=a1_0x5106('0x22')+_0x136f61['id']+a1_0x5106('0x29');_0x417f8b['profile'][a1_0x5106('0x2a')]=_0x136f61[a1_0x5106('0x26')][a1_0x5106('0x2a')]?_0x136f61[a1_0x5106('0x26')][a1_0x5106('0x2a')][a1_0x5106('0x1f')]:'';_0x417f8b[a1_0x5106('0x23')](_0x1218bb=>{_0x420281(_0x1218bb,_0x417f8b);});}});});}}));exports[a1_0x5106('0x2b')]=(_0x3f1717,_0x3079e4,_0x419152)=>{if(_0x3f1717[a1_0x5106('0x2b')]()){return _0x419152();}_0x3079e4[a1_0x5106('0x2c')]('/login');};exports[a1_0x5106('0x2d')]=(_0xf0d16b,_0x417ec3,_0xd22e62)=>{const _0x1a962a=_0xf0d16b[a1_0x5106('0x2e')][a1_0x5106('0x2f')]('/')[a1_0x5106('0x30')](-0x1)[0x0];if(lodash_1[a1_0x5106('0x9')][a1_0x5106('0x31')](_0xf0d16b['user'][a1_0x5106('0x1b')],{'kind':_0x1a962a})){_0xd22e62();}else{_0x417ec3[a1_0x5106('0x2c')](a1_0x5106('0x32')+_0x1a962a);}};