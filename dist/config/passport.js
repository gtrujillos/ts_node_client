var a1_0x1a4e=['email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','name','link','timezone','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','tokens','push','facebook','profile','givenName','familyName','gender','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','_json','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','isAuthenticated','redirect','isAuthorized','path','split','find','user','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','use'];(function(_0x139274,_0x38330c){var _0x5b10d3=function(_0x57f7f9){while(--_0x57f7f9){_0x139274['push'](_0x139274['shift']());}};_0x5b10d3(++_0x38330c);}(a1_0x1a4e,0x11f));var a1_0x5421=function(_0xf34179,_0x5b6b9b){_0xf34179=_0xf34179-0x0;var _0x554d0e=a1_0x1a4e[_0xf34179];return _0x554d0e;};'use strict';var __importDefault=this&&this[a1_0x5421('0x0')]||function(_0x213c97){return _0x213c97&&_0x213c97[a1_0x5421('0x1')]?_0x213c97:{'default':_0x213c97};};Object[a1_0x5421('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x5421('0x3')));const passport_local_1=__importDefault(require(a1_0x5421('0x4')));const passport_facebook_1=__importDefault(require(a1_0x5421('0x5')));const lodash_1=__importDefault(require(a1_0x5421('0x6')));const User_1=__importDefault(require(a1_0x5421('0x7')));const LocalStrategy=passport_local_1[a1_0x5421('0x8')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5421('0x8')][a1_0x5421('0x9')];passport_1[a1_0x5421('0x8')][a1_0x5421('0xa')]((_0x2edb36,_0x391df4)=>{_0x391df4(undefined,_0x2edb36['id']);});passport_1[a1_0x5421('0x8')][a1_0x5421('0xb')]((_0x5a469d,_0x35a55b)=>{User_1[a1_0x5421('0x8')]['findById'](_0x5a469d,(_0x97d8c9,_0x303ea5)=>{_0x35a55b(_0x97d8c9,_0x303ea5);});});passport_1[a1_0x5421('0x8')][a1_0x5421('0xc')](new LocalStrategy({'usernameField':a1_0x5421('0xd')},(_0xc2f680,_0x2a2f9f,_0x54599f)=>{User_1[a1_0x5421('0x8')][a1_0x5421('0xe')]({'email':_0xc2f680[a1_0x5421('0xf')]()},(_0x221b0e,_0x94752e)=>{if(_0x221b0e){return _0x54599f(_0x221b0e);}if(!_0x94752e){return _0x54599f(undefined,![],{'message':a1_0x5421('0x10')+_0xc2f680+'\x20not\x20found.'});}_0x94752e[a1_0x5421('0x11')](_0x2a2f9f,(_0x221b0e,_0x3e9e50)=>{if(_0x221b0e){return _0x54599f(_0x221b0e);}if(_0x3e9e50){return _0x54599f(undefined,_0x94752e);}return _0x54599f(undefined,![],{'message':a1_0x5421('0x12')});});});}));passport_1[a1_0x5421('0x8')]['use'](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process['env']['FACEBOOK_SECRET'],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x5421('0x13'),a1_0x5421('0xd'),a1_0x5421('0x14'),'locale',a1_0x5421('0x15')],'passReqToCallback':!![]},(_0x37b73a,_0x59d3c9,_0xbdfc3b,_0x11dde9,_0x26c389)=>{if(_0x37b73a['user']){User_1['default']['findOne']({'facebook':_0x11dde9['id']},(_0x3fc617,_0x274317)=>{if(_0x3fc617){return _0x26c389(_0x3fc617);}if(_0x274317){_0x37b73a[a1_0x5421('0x16')]('errors',{'msg':a1_0x5421('0x17')});_0x26c389(_0x3fc617);}else{User_1[a1_0x5421('0x8')][a1_0x5421('0x18')](_0x37b73a['user']['id'],(_0x3fc617,_0x2683f3)=>{if(_0x3fc617){return _0x26c389(_0x3fc617);}_0x2683f3['facebook']=_0x11dde9['id'];_0x2683f3[a1_0x5421('0x19')][a1_0x5421('0x1a')]({'kind':a1_0x5421('0x1b'),'accessToken':_0x59d3c9});_0x2683f3[a1_0x5421('0x1c')]['name']=_0x2683f3['profile'][a1_0x5421('0x13')]||_0x11dde9['name'][a1_0x5421('0x1d')]+'\x20'+_0x11dde9[a1_0x5421('0x13')][a1_0x5421('0x1e')];_0x2683f3[a1_0x5421('0x1c')]['gender']=_0x2683f3[a1_0x5421('0x1c')][a1_0x5421('0x1f')]||_0x11dde9['_json'][a1_0x5421('0x1f')];_0x2683f3[a1_0x5421('0x1c')][a1_0x5421('0x20')]=_0x2683f3[a1_0x5421('0x1c')][a1_0x5421('0x20')]||'https://graph.facebook.com/'+_0x11dde9['id']+a1_0x5421('0x21');_0x2683f3[a1_0x5421('0x22')](_0x3fc617=>{_0x37b73a['flash'](a1_0x5421('0x23'),{'msg':a1_0x5421('0x24')});_0x26c389(_0x3fc617,_0x2683f3);});});}});}else{User_1[a1_0x5421('0x8')][a1_0x5421('0xe')]({'facebook':_0x11dde9['id']},(_0xd8c03f,_0x3676da)=>{if(_0xd8c03f){return _0x26c389(_0xd8c03f);}if(_0x3676da){return _0x26c389(undefined,_0x3676da);}User_1[a1_0x5421('0x8')][a1_0x5421('0xe')]({'email':_0x11dde9[a1_0x5421('0x25')]['email']},(_0xd8c03f,_0x5914a2)=>{if(_0xd8c03f){return _0x26c389(_0xd8c03f);}if(_0x5914a2){_0x37b73a[a1_0x5421('0x16')](a1_0x5421('0x26'),{'msg':a1_0x5421('0x27')});_0x26c389(_0xd8c03f);}else{const _0x588b88=new User_1['default']();_0x588b88[a1_0x5421('0xd')]=_0x11dde9['_json']['email'];_0x588b88[a1_0x5421('0x1b')]=_0x11dde9['id'];_0x588b88[a1_0x5421('0x19')][a1_0x5421('0x1a')]({'kind':a1_0x5421('0x1b'),'accessToken':_0x59d3c9});_0x588b88[a1_0x5421('0x1c')]['name']=_0x11dde9[a1_0x5421('0x13')]['givenName']+'\x20'+_0x11dde9[a1_0x5421('0x13')]['familyName'];_0x588b88[a1_0x5421('0x1c')][a1_0x5421('0x1f')]=_0x11dde9[a1_0x5421('0x25')][a1_0x5421('0x1f')];_0x588b88[a1_0x5421('0x1c')][a1_0x5421('0x20')]=a1_0x5421('0x28')+_0x11dde9['id']+a1_0x5421('0x21');_0x588b88[a1_0x5421('0x1c')][a1_0x5421('0x29')]=_0x11dde9[a1_0x5421('0x25')][a1_0x5421('0x29')]?_0x11dde9['_json'][a1_0x5421('0x29')]['name']:'';_0x588b88[a1_0x5421('0x22')](_0xd8c03f=>{_0x26c389(_0xd8c03f,_0x588b88);});}});});}}));exports[a1_0x5421('0x2a')]=(_0x4555bf,_0x21bdb0,_0x5a573e)=>{if(_0x4555bf[a1_0x5421('0x2a')]()){return _0x5a573e();}_0x21bdb0[a1_0x5421('0x2b')]('/login');};exports[a1_0x5421('0x2c')]=(_0x11e6c2,_0x397aee,_0x226901)=>{const _0x5dbc04=_0x11e6c2[a1_0x5421('0x2d')][a1_0x5421('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x5421('0x8')][a1_0x5421('0x2f')](_0x11e6c2[a1_0x5421('0x30')][a1_0x5421('0x19')],{'kind':_0x5dbc04})){_0x226901();}else{_0x397aee[a1_0x5421('0x2b')](a1_0x5421('0x31')+_0x5dbc04);}};