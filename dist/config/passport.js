var a1_0xc72d=['defineProperty','__esModule','passport','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','profile','familyName','gender','_json','picture','/picture?type=large','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','givenName','https://graph.facebook.com/','location','isAuthenticated','/login','isAuthorized','path','slice','tokens','redirect','/auth/','__importDefault'];(function(_0x2a5711,_0xb2bd66){var _0x5c9b6c=function(_0x554d43){while(--_0x554d43){_0x2a5711['push'](_0x2a5711['shift']());}};_0x5c9b6c(++_0xb2bd66);}(a1_0xc72d,0x131));var a1_0x46ec=function(_0x5378bb,_0x309e41){_0x5378bb=_0x5378bb-0x0;var _0x264bcb=a1_0xc72d[_0x5378bb];return _0x264bcb;};'use strict';var __importDefault=this&&this[a1_0x46ec('0x0')]||function(_0x61aa71){return _0x61aa71&&_0x61aa71['__esModule']?_0x61aa71:{'default':_0x61aa71};};Object[a1_0x46ec('0x1')](exports,a1_0x46ec('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x46ec('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x46ec('0x4')));const lodash_1=__importDefault(require(a1_0x46ec('0x5')));const User_1=__importDefault(require(a1_0x46ec('0x6')));const LocalStrategy=passport_local_1[a1_0x46ec('0x7')][a1_0x46ec('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x46ec('0x7')]['Strategy'];passport_1[a1_0x46ec('0x7')][a1_0x46ec('0x9')]((_0x488680,_0x11ba48)=>{_0x11ba48(undefined,_0x488680['id']);});passport_1[a1_0x46ec('0x7')][a1_0x46ec('0xa')]((_0x1c02bd,_0x305d61)=>{User_1[a1_0x46ec('0x7')][a1_0x46ec('0xb')](_0x1c02bd,(_0x1626f2,_0xb06c01)=>{_0x305d61(_0x1626f2,_0xb06c01);});});passport_1[a1_0x46ec('0x7')][a1_0x46ec('0xc')](new LocalStrategy({'usernameField':a1_0x46ec('0xd')},(_0xf3ed47,_0x3a4ee7,_0x1f57d1)=>{User_1[a1_0x46ec('0x7')][a1_0x46ec('0xe')]({'email':_0xf3ed47['toLowerCase']()},(_0x1303bd,_0x59c593)=>{if(_0x1303bd){return _0x1f57d1(_0x1303bd);}if(!_0x59c593){return _0x1f57d1(undefined,![],{'message':a1_0x46ec('0xf')+_0xf3ed47+a1_0x46ec('0x10')});}_0x59c593['comparePassword'](_0x3a4ee7,(_0x1303bd,_0x3019bb)=>{if(_0x1303bd){return _0x1f57d1(_0x1303bd);}if(_0x3019bb){return _0x1f57d1(undefined,_0x59c593);}return _0x1f57d1(undefined,![],{'message':a1_0x46ec('0x11')});});});}));passport_1[a1_0x46ec('0x7')][a1_0x46ec('0xc')](new FacebookStrategy({'clientID':process['env'][a1_0x46ec('0x12')],'clientSecret':process[a1_0x46ec('0x13')]['FACEBOOK_SECRET'],'callbackURL':a1_0x46ec('0x14'),'profileFields':[a1_0x46ec('0x15'),a1_0x46ec('0xd'),a1_0x46ec('0x16'),a1_0x46ec('0x17'),a1_0x46ec('0x18')],'passReqToCallback':!![]},(_0x58b8a4,_0x47b1ad,_0x228c67,_0x554ba3,_0x3d787a)=>{if(_0x58b8a4[a1_0x46ec('0x19')]){User_1[a1_0x46ec('0x7')][a1_0x46ec('0xe')]({'facebook':_0x554ba3['id']},(_0x59a4e8,_0x19824d)=>{if(_0x59a4e8){return _0x3d787a(_0x59a4e8);}if(_0x19824d){_0x58b8a4[a1_0x46ec('0x1a')](a1_0x46ec('0x1b'),{'msg':a1_0x46ec('0x1c')});_0x3d787a(_0x59a4e8);}else{User_1[a1_0x46ec('0x7')][a1_0x46ec('0xb')](_0x58b8a4[a1_0x46ec('0x19')]['id'],(_0x59a4e8,_0x3beaf2)=>{if(_0x59a4e8){return _0x3d787a(_0x59a4e8);}_0x3beaf2[a1_0x46ec('0x1d')]=_0x554ba3['id'];_0x3beaf2['tokens']['push']({'kind':a1_0x46ec('0x1d'),'accessToken':_0x47b1ad});_0x3beaf2[a1_0x46ec('0x1e')][a1_0x46ec('0x15')]=_0x3beaf2[a1_0x46ec('0x1e')][a1_0x46ec('0x15')]||_0x554ba3['name']['givenName']+'\x20'+_0x554ba3[a1_0x46ec('0x15')][a1_0x46ec('0x1f')];_0x3beaf2[a1_0x46ec('0x1e')][a1_0x46ec('0x20')]=_0x3beaf2[a1_0x46ec('0x1e')]['gender']||_0x554ba3[a1_0x46ec('0x21')][a1_0x46ec('0x20')];_0x3beaf2[a1_0x46ec('0x1e')]['picture']=_0x3beaf2[a1_0x46ec('0x1e')][a1_0x46ec('0x22')]||'https://graph.facebook.com/'+_0x554ba3['id']+a1_0x46ec('0x23');_0x3beaf2[a1_0x46ec('0x24')](_0x59a4e8=>{_0x58b8a4['flash'](a1_0x46ec('0x25'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x3d787a(_0x59a4e8,_0x3beaf2);});});}});}else{User_1[a1_0x46ec('0x7')][a1_0x46ec('0xe')]({'facebook':_0x554ba3['id']},(_0xb68915,_0x1faf3d)=>{if(_0xb68915){return _0x3d787a(_0xb68915);}if(_0x1faf3d){return _0x3d787a(undefined,_0x1faf3d);}User_1[a1_0x46ec('0x7')][a1_0x46ec('0xe')]({'email':_0x554ba3[a1_0x46ec('0x21')]['email']},(_0xb68915,_0x35f8a6)=>{if(_0xb68915){return _0x3d787a(_0xb68915);}if(_0x35f8a6){_0x58b8a4[a1_0x46ec('0x1a')](a1_0x46ec('0x1b'),{'msg':a1_0x46ec('0x26')});_0x3d787a(_0xb68915);}else{const _0xbc9ba3=new User_1['default']();_0xbc9ba3[a1_0x46ec('0xd')]=_0x554ba3[a1_0x46ec('0x21')][a1_0x46ec('0xd')];_0xbc9ba3[a1_0x46ec('0x1d')]=_0x554ba3['id'];_0xbc9ba3['tokens'][a1_0x46ec('0x27')]({'kind':a1_0x46ec('0x1d'),'accessToken':_0x47b1ad});_0xbc9ba3[a1_0x46ec('0x1e')][a1_0x46ec('0x15')]=_0x554ba3[a1_0x46ec('0x15')][a1_0x46ec('0x28')]+'\x20'+_0x554ba3[a1_0x46ec('0x15')]['familyName'];_0xbc9ba3['profile'][a1_0x46ec('0x20')]=_0x554ba3[a1_0x46ec('0x21')]['gender'];_0xbc9ba3[a1_0x46ec('0x1e')][a1_0x46ec('0x22')]=a1_0x46ec('0x29')+_0x554ba3['id']+'/picture?type=large';_0xbc9ba3['profile'][a1_0x46ec('0x2a')]=_0x554ba3[a1_0x46ec('0x21')][a1_0x46ec('0x2a')]?_0x554ba3['_json'][a1_0x46ec('0x2a')][a1_0x46ec('0x15')]:'';_0xbc9ba3[a1_0x46ec('0x24')](_0xb68915=>{_0x3d787a(_0xb68915,_0xbc9ba3);});}});});}}));exports[a1_0x46ec('0x2b')]=(_0x87c0f4,_0x3b8296,_0x40d9ac)=>{if(_0x87c0f4[a1_0x46ec('0x2b')]()){return _0x40d9ac();}_0x3b8296['redirect'](a1_0x46ec('0x2c'));};exports[a1_0x46ec('0x2d')]=(_0x434aba,_0x30599e,_0x28b389)=>{const _0x1bed3b=_0x434aba[a1_0x46ec('0x2e')]['split']('/')[a1_0x46ec('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x46ec('0x7')]['find'](_0x434aba['user'][a1_0x46ec('0x30')],{'kind':_0x1bed3b})){_0x28b389();}else{_0x30599e[a1_0x46ec('0x31')](a1_0x46ec('0x32')+_0x1bed3b);}};