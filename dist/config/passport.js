var a1_0x4209=['find','/auth/','__esModule','defineProperty','passport','../models/User','default','Strategy','serializeUser','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','facebook','tokens','push','profile','givenName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','_json','familyName','location','isAuthenticated','/login','isAuthorized','path','split'];(function(_0x36cc5f,_0x292931){var _0x4d52d3=function(_0x5c6e9b){while(--_0x5c6e9b){_0x36cc5f['push'](_0x36cc5f['shift']());}};_0x4d52d3(++_0x292931);}(a1_0x4209,0x152));var a1_0x563f=function(_0x1fb050,_0x5a3a06){_0x1fb050=_0x1fb050-0x0;var _0x2001c1=a1_0x4209[_0x1fb050];return _0x2001c1;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5da2e2){return _0x5da2e2&&_0x5da2e2[a1_0x563f('0x0')]?_0x5da2e2:{'default':_0x5da2e2};};Object[a1_0x563f('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x563f('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x563f('0x3')));const LocalStrategy=passport_local_1[a1_0x563f('0x4')]['Strategy'];const FacebookStrategy=passport_facebook_1['default'][a1_0x563f('0x5')];passport_1[a1_0x563f('0x4')][a1_0x563f('0x6')]((_0x265a76,_0x3b4978)=>{_0x3b4978(undefined,_0x265a76['id']);});passport_1[a1_0x563f('0x4')]['deserializeUser']((_0x3dd40d,_0x5121ad)=>{User_1[a1_0x563f('0x4')]['findById'](_0x3dd40d,(_0x15ddff,_0x281889)=>{_0x5121ad(_0x15ddff,_0x281889);});});passport_1['default']['use'](new LocalStrategy({'usernameField':'email'},(_0x292f31,_0x10100a,_0x4805a3)=>{User_1[a1_0x563f('0x4')][a1_0x563f('0x7')]({'email':_0x292f31[a1_0x563f('0x8')]()},(_0x1f8030,_0x4a1eb9)=>{if(_0x1f8030){return _0x4805a3(_0x1f8030);}if(!_0x4a1eb9){return _0x4805a3(undefined,![],{'message':a1_0x563f('0x9')+_0x292f31+a1_0x563f('0xa')});}_0x4a1eb9[a1_0x563f('0xb')](_0x10100a,(_0x1f8030,_0x11174c)=>{if(_0x1f8030){return _0x4805a3(_0x1f8030);}if(_0x11174c){return _0x4805a3(undefined,_0x4a1eb9);}return _0x4805a3(undefined,![],{'message':a1_0x563f('0xc')});});});}));passport_1[a1_0x563f('0x4')][a1_0x563f('0xd')](new FacebookStrategy({'clientID':process['env'][a1_0x563f('0xe')],'clientSecret':process[a1_0x563f('0xf')][a1_0x563f('0x10')],'callbackURL':a1_0x563f('0x11'),'profileFields':[a1_0x563f('0x12'),a1_0x563f('0x13'),a1_0x563f('0x14'),'locale',a1_0x563f('0x15')],'passReqToCallback':!![]},(_0x3d2605,_0x3701fc,_0x3757a7,_0x46c280,_0x551c9f)=>{if(_0x3d2605[a1_0x563f('0x16')]){User_1[a1_0x563f('0x4')][a1_0x563f('0x7')]({'facebook':_0x46c280['id']},(_0x49cfd9,_0x429516)=>{if(_0x49cfd9){return _0x551c9f(_0x49cfd9);}if(_0x429516){_0x3d2605[a1_0x563f('0x17')](a1_0x563f('0x18'),{'msg':a1_0x563f('0x19')});_0x551c9f(_0x49cfd9);}else{User_1['default'][a1_0x563f('0x1a')](_0x3d2605[a1_0x563f('0x16')]['id'],(_0x49cfd9,_0x26431f)=>{if(_0x49cfd9){return _0x551c9f(_0x49cfd9);}_0x26431f[a1_0x563f('0x1b')]=_0x46c280['id'];_0x26431f[a1_0x563f('0x1c')][a1_0x563f('0x1d')]({'kind':a1_0x563f('0x1b'),'accessToken':_0x3701fc});_0x26431f['profile']['name']=_0x26431f[a1_0x563f('0x1e')]['name']||_0x46c280[a1_0x563f('0x12')][a1_0x563f('0x1f')]+'\x20'+_0x46c280[a1_0x563f('0x12')]['familyName'];_0x26431f[a1_0x563f('0x1e')][a1_0x563f('0x20')]=_0x26431f[a1_0x563f('0x1e')][a1_0x563f('0x20')]||_0x46c280['_json'][a1_0x563f('0x20')];_0x26431f[a1_0x563f('0x1e')][a1_0x563f('0x21')]=_0x26431f[a1_0x563f('0x1e')][a1_0x563f('0x21')]||a1_0x563f('0x22')+_0x46c280['id']+a1_0x563f('0x23');_0x26431f[a1_0x563f('0x24')](_0x49cfd9=>{_0x3d2605['flash']('info',{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x551c9f(_0x49cfd9,_0x26431f);});});}});}else{User_1[a1_0x563f('0x4')][a1_0x563f('0x7')]({'facebook':_0x46c280['id']},(_0x57a6f3,_0x233f12)=>{if(_0x57a6f3){return _0x551c9f(_0x57a6f3);}if(_0x233f12){return _0x551c9f(undefined,_0x233f12);}User_1['default'][a1_0x563f('0x7')]({'email':_0x46c280['_json']['email']},(_0x57a6f3,_0x3e09ed)=>{if(_0x57a6f3){return _0x551c9f(_0x57a6f3);}if(_0x3e09ed){_0x3d2605['flash'](a1_0x563f('0x18'),{'msg':a1_0x563f('0x25')});_0x551c9f(_0x57a6f3);}else{const _0x52bc18=new User_1[(a1_0x563f('0x4'))]();_0x52bc18[a1_0x563f('0x13')]=_0x46c280[a1_0x563f('0x26')][a1_0x563f('0x13')];_0x52bc18['facebook']=_0x46c280['id'];_0x52bc18[a1_0x563f('0x1c')][a1_0x563f('0x1d')]({'kind':a1_0x563f('0x1b'),'accessToken':_0x3701fc});_0x52bc18[a1_0x563f('0x1e')][a1_0x563f('0x12')]=_0x46c280[a1_0x563f('0x12')][a1_0x563f('0x1f')]+'\x20'+_0x46c280[a1_0x563f('0x12')][a1_0x563f('0x27')];_0x52bc18[a1_0x563f('0x1e')][a1_0x563f('0x20')]=_0x46c280[a1_0x563f('0x26')][a1_0x563f('0x20')];_0x52bc18[a1_0x563f('0x1e')][a1_0x563f('0x21')]=a1_0x563f('0x22')+_0x46c280['id']+a1_0x563f('0x23');_0x52bc18[a1_0x563f('0x1e')][a1_0x563f('0x28')]=_0x46c280['_json'][a1_0x563f('0x28')]?_0x46c280[a1_0x563f('0x26')][a1_0x563f('0x28')][a1_0x563f('0x12')]:'';_0x52bc18[a1_0x563f('0x24')](_0x57a6f3=>{_0x551c9f(_0x57a6f3,_0x52bc18);});}});});}}));exports[a1_0x563f('0x29')]=(_0x13a428,_0x437342,_0xab2f04)=>{if(_0x13a428[a1_0x563f('0x29')]()){return _0xab2f04();}_0x437342['redirect'](a1_0x563f('0x2a'));};exports[a1_0x563f('0x2b')]=(_0x147922,_0x43f939,_0x4b2e59)=>{const _0x4384cf=_0x147922[a1_0x563f('0x2c')][a1_0x563f('0x2d')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x563f('0x2e')](_0x147922[a1_0x563f('0x16')]['tokens'],{'kind':_0x4384cf})){_0x4b2e59();}else{_0x43f939['redirect'](a1_0x563f('0x2f')+_0x4384cf);}};