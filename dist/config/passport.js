var a1_0x457a=['There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','tokens','push','profile','familyName','gender','_json','picture','flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','givenName','https://graph.facebook.com/','/picture?type=large','location','save','isAuthenticated','/login','path','split','slice','find','redirect','__importDefault','__esModule','defineProperty','passport','passport-facebook','lodash','default','deserializeUser','findById','use','email','findOne','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone','errors'];(function(_0x4c401a,_0x468aa8){var _0x2546b0=function(_0x55a580){while(--_0x55a580){_0x4c401a['push'](_0x4c401a['shift']());}};_0x2546b0(++_0x468aa8);}(a1_0x457a,0xa7));var a1_0x1990=function(_0x4f67b7,_0x2198c8){_0x4f67b7=_0x4f67b7-0x0;var _0x2b663c=a1_0x457a[_0x4f67b7];return _0x2b663c;};'use strict';var __importDefault=this&&this[a1_0x1990('0x0')]||function(_0x314ef1){return _0x314ef1&&_0x314ef1[a1_0x1990('0x1')]?_0x314ef1:{'default':_0x314ef1};};Object[a1_0x1990('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x1990('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x1990('0x4')));const lodash_1=__importDefault(require(a1_0x1990('0x5')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x1990('0x6')]['Strategy'];passport_1[a1_0x1990('0x6')]['serializeUser']((_0x4974d4,_0xd1a924)=>{_0xd1a924(undefined,_0x4974d4['id']);});passport_1[a1_0x1990('0x6')][a1_0x1990('0x7')]((_0x508f91,_0x326f8a)=>{User_1[a1_0x1990('0x6')][a1_0x1990('0x8')](_0x508f91,(_0x403f73,_0x886865)=>{_0x326f8a(_0x403f73,_0x886865);});});passport_1[a1_0x1990('0x6')][a1_0x1990('0x9')](new LocalStrategy({'usernameField':a1_0x1990('0xa')},(_0x49365f,_0x41fd3c,_0x2f0ebd)=>{User_1[a1_0x1990('0x6')][a1_0x1990('0xb')]({'email':_0x49365f['toLowerCase']()},(_0xc6d33f,_0x511fa1)=>{if(_0xc6d33f){return _0x2f0ebd(_0xc6d33f);}if(!_0x511fa1){return _0x2f0ebd(undefined,![],{'message':'Email\x20'+_0x49365f+'\x20not\x20found.'});}_0x511fa1[a1_0x1990('0xc')](_0x41fd3c,(_0xc6d33f,_0x2c65d9)=>{if(_0xc6d33f){return _0x2f0ebd(_0xc6d33f);}if(_0x2c65d9){return _0x2f0ebd(undefined,_0x511fa1);}return _0x2f0ebd(undefined,![],{'message':a1_0x1990('0xd')});});});}));passport_1[a1_0x1990('0x6')][a1_0x1990('0x9')](new FacebookStrategy({'clientID':process[a1_0x1990('0xe')]['FACEBOOK_ID'],'clientSecret':process[a1_0x1990('0xe')][a1_0x1990('0xf')],'callbackURL':a1_0x1990('0x10'),'profileFields':[a1_0x1990('0x11'),'email',a1_0x1990('0x12'),'locale',a1_0x1990('0x13')],'passReqToCallback':!![]},(_0x2ceedd,_0x52e62b,_0x507727,_0x450011,_0x1a52e9)=>{if(_0x2ceedd['user']){User_1[a1_0x1990('0x6')]['findOne']({'facebook':_0x450011['id']},(_0x3bae88,_0xba516f)=>{if(_0x3bae88){return _0x1a52e9(_0x3bae88);}if(_0xba516f){_0x2ceedd['flash'](a1_0x1990('0x14'),{'msg':a1_0x1990('0x15')});_0x1a52e9(_0x3bae88);}else{User_1[a1_0x1990('0x6')][a1_0x1990('0x8')](_0x2ceedd[a1_0x1990('0x16')]['id'],(_0x3bae88,_0x8c3a8f)=>{if(_0x3bae88){return _0x1a52e9(_0x3bae88);}_0x8c3a8f['facebook']=_0x450011['id'];_0x8c3a8f[a1_0x1990('0x17')][a1_0x1990('0x18')]({'kind':'facebook','accessToken':_0x52e62b});_0x8c3a8f['profile']['name']=_0x8c3a8f[a1_0x1990('0x19')][a1_0x1990('0x11')]||_0x450011[a1_0x1990('0x11')]['givenName']+'\x20'+_0x450011[a1_0x1990('0x11')][a1_0x1990('0x1a')];_0x8c3a8f[a1_0x1990('0x19')]['gender']=_0x8c3a8f['profile'][a1_0x1990('0x1b')]||_0x450011[a1_0x1990('0x1c')][a1_0x1990('0x1b')];_0x8c3a8f[a1_0x1990('0x19')][a1_0x1990('0x1d')]=_0x8c3a8f[a1_0x1990('0x19')][a1_0x1990('0x1d')]||'https://graph.facebook.com/'+_0x450011['id']+'/picture?type=large';_0x8c3a8f['save'](_0x3bae88=>{_0x2ceedd[a1_0x1990('0x1e')](a1_0x1990('0x1f'),{'msg':a1_0x1990('0x20')});_0x1a52e9(_0x3bae88,_0x8c3a8f);});});}});}else{User_1[a1_0x1990('0x6')]['findOne']({'facebook':_0x450011['id']},(_0x1d9ee7,_0x1d33ff)=>{if(_0x1d9ee7){return _0x1a52e9(_0x1d9ee7);}if(_0x1d33ff){return _0x1a52e9(undefined,_0x1d33ff);}User_1['default'][a1_0x1990('0xb')]({'email':_0x450011[a1_0x1990('0x1c')][a1_0x1990('0xa')]},(_0x1d9ee7,_0x55fc9c)=>{if(_0x1d9ee7){return _0x1a52e9(_0x1d9ee7);}if(_0x55fc9c){_0x2ceedd[a1_0x1990('0x1e')]('errors',{'msg':a1_0x1990('0x21')});_0x1a52e9(_0x1d9ee7);}else{const _0x37d6a1=new User_1[(a1_0x1990('0x6'))]();_0x37d6a1[a1_0x1990('0xa')]=_0x450011['_json'][a1_0x1990('0xa')];_0x37d6a1[a1_0x1990('0x22')]=_0x450011['id'];_0x37d6a1[a1_0x1990('0x17')]['push']({'kind':a1_0x1990('0x22'),'accessToken':_0x52e62b});_0x37d6a1[a1_0x1990('0x19')][a1_0x1990('0x11')]=_0x450011[a1_0x1990('0x11')][a1_0x1990('0x23')]+'\x20'+_0x450011[a1_0x1990('0x11')]['familyName'];_0x37d6a1[a1_0x1990('0x19')][a1_0x1990('0x1b')]=_0x450011[a1_0x1990('0x1c')][a1_0x1990('0x1b')];_0x37d6a1[a1_0x1990('0x19')][a1_0x1990('0x1d')]=a1_0x1990('0x24')+_0x450011['id']+a1_0x1990('0x25');_0x37d6a1[a1_0x1990('0x19')][a1_0x1990('0x26')]=_0x450011[a1_0x1990('0x1c')][a1_0x1990('0x26')]?_0x450011['_json']['location'][a1_0x1990('0x11')]:'';_0x37d6a1[a1_0x1990('0x27')](_0x1d9ee7=>{_0x1a52e9(_0x1d9ee7,_0x37d6a1);});}});});}}));exports[a1_0x1990('0x28')]=(_0x35f263,_0x594564,_0x56a87c)=>{if(_0x35f263[a1_0x1990('0x28')]()){return _0x56a87c();}_0x594564['redirect'](a1_0x1990('0x29'));};exports['isAuthorized']=(_0xdfc676,_0x13482f,_0x18ccdb)=>{const _0x55a485=_0xdfc676[a1_0x1990('0x2a')][a1_0x1990('0x2b')]('/')[a1_0x1990('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x1990('0x6')][a1_0x1990('0x2d')](_0xdfc676[a1_0x1990('0x16')][a1_0x1990('0x17')],{'kind':_0x55a485})){_0x18ccdb();}else{_0x13482f[a1_0x1990('0x2e')]('/auth/'+_0x55a485);}};