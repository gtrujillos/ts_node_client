var a1_0x1a6d=['__importDefault','defineProperty','__esModule','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','user','errors','facebook','push','profile','givenName','familyName','gender','_json','picture','flash','Facebook\x20account\x20has\x20been\x20linked.','tokens','/picture?type=large','location','save','isAuthenticated','redirect','isAuthorized','path','split','slice','find','/auth/'];(function(_0x51bedc,_0x4ac59b){var _0x243f24=function(_0x3541e7){while(--_0x3541e7){_0x51bedc['push'](_0x51bedc['shift']());}};_0x243f24(++_0x4ac59b);}(a1_0x1a6d,0x8d));var a1_0x4288=function(_0x749ed9,_0x52c58c){_0x749ed9=_0x749ed9-0x0;var _0x98c04c=a1_0x1a6d[_0x749ed9];return _0x98c04c;};'use strict';var __importDefault=this&&this[a1_0x4288('0x0')]||function(_0x3b6954){return _0x3b6954&&_0x3b6954['__esModule']?_0x3b6954:{'default':_0x3b6954};};Object[a1_0x4288('0x1')](exports,a1_0x4288('0x2'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4288('0x3')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4288('0x4')));const LocalStrategy=passport_local_1[a1_0x4288('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x4288('0x5')][a1_0x4288('0x6')];passport_1[a1_0x4288('0x5')][a1_0x4288('0x7')]((_0x1266c0,_0x43407c)=>{_0x43407c(undefined,_0x1266c0['id']);});passport_1[a1_0x4288('0x5')][a1_0x4288('0x8')]((_0x770ee0,_0x4194d5)=>{User_1['default'][a1_0x4288('0x9')](_0x770ee0,(_0x297ffe,_0x25a903)=>{_0x4194d5(_0x297ffe,_0x25a903);});});passport_1[a1_0x4288('0x5')][a1_0x4288('0xa')](new LocalStrategy({'usernameField':a1_0x4288('0xb')},(_0x43cfa5,_0x450524,_0x40b11d)=>{User_1[a1_0x4288('0x5')][a1_0x4288('0xc')]({'email':_0x43cfa5[a1_0x4288('0xd')]()},(_0x2ae170,_0x45fd64)=>{if(_0x2ae170){return _0x40b11d(_0x2ae170);}if(!_0x45fd64){return _0x40b11d(undefined,![],{'message':a1_0x4288('0xe')+_0x43cfa5+a1_0x4288('0xf')});}_0x45fd64[a1_0x4288('0x10')](_0x450524,(_0x2ae170,_0x3c4a07)=>{if(_0x2ae170){return _0x40b11d(_0x2ae170);}if(_0x3c4a07){return _0x40b11d(undefined,_0x45fd64);}return _0x40b11d(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x4288('0x5')][a1_0x4288('0xa')](new FacebookStrategy({'clientID':process[a1_0x4288('0x11')][a1_0x4288('0x12')],'clientSecret':process[a1_0x4288('0x11')][a1_0x4288('0x13')],'callbackURL':a1_0x4288('0x14'),'profileFields':[a1_0x4288('0x15'),a1_0x4288('0xb'),a1_0x4288('0x16'),'locale','timezone'],'passReqToCallback':!![]},(_0x1cd33d,_0x130d09,_0x40e5a6,_0x52bca1,_0x352fbb)=>{if(_0x1cd33d[a1_0x4288('0x17')]){User_1[a1_0x4288('0x5')][a1_0x4288('0xc')]({'facebook':_0x52bca1['id']},(_0x3fa460,_0x7b1714)=>{if(_0x3fa460){return _0x352fbb(_0x3fa460);}if(_0x7b1714){_0x1cd33d['flash'](a1_0x4288('0x18'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x352fbb(_0x3fa460);}else{User_1[a1_0x4288('0x5')][a1_0x4288('0x9')](_0x1cd33d[a1_0x4288('0x17')]['id'],(_0x3fa460,_0x147ade)=>{if(_0x3fa460){return _0x352fbb(_0x3fa460);}_0x147ade[a1_0x4288('0x19')]=_0x52bca1['id'];_0x147ade['tokens'][a1_0x4288('0x1a')]({'kind':a1_0x4288('0x19'),'accessToken':_0x130d09});_0x147ade[a1_0x4288('0x1b')][a1_0x4288('0x15')]=_0x147ade[a1_0x4288('0x1b')][a1_0x4288('0x15')]||_0x52bca1['name'][a1_0x4288('0x1c')]+'\x20'+_0x52bca1[a1_0x4288('0x15')][a1_0x4288('0x1d')];_0x147ade[a1_0x4288('0x1b')][a1_0x4288('0x1e')]=_0x147ade[a1_0x4288('0x1b')]['gender']||_0x52bca1[a1_0x4288('0x1f')][a1_0x4288('0x1e')];_0x147ade['profile'][a1_0x4288('0x20')]=_0x147ade[a1_0x4288('0x1b')][a1_0x4288('0x20')]||'https://graph.facebook.com/'+_0x52bca1['id']+'/picture?type=large';_0x147ade['save'](_0x3fa460=>{_0x1cd33d[a1_0x4288('0x21')]('info',{'msg':a1_0x4288('0x22')});_0x352fbb(_0x3fa460,_0x147ade);});});}});}else{User_1[a1_0x4288('0x5')]['findOne']({'facebook':_0x52bca1['id']},(_0x13a081,_0x1a8399)=>{if(_0x13a081){return _0x352fbb(_0x13a081);}if(_0x1a8399){return _0x352fbb(undefined,_0x1a8399);}User_1[a1_0x4288('0x5')][a1_0x4288('0xc')]({'email':_0x52bca1['_json'][a1_0x4288('0xb')]},(_0x13a081,_0x37762b)=>{if(_0x13a081){return _0x352fbb(_0x13a081);}if(_0x37762b){_0x1cd33d['flash'](a1_0x4288('0x18'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x352fbb(_0x13a081);}else{const _0x5ecbd2=new User_1[(a1_0x4288('0x5'))]();_0x5ecbd2[a1_0x4288('0xb')]=_0x52bca1[a1_0x4288('0x1f')][a1_0x4288('0xb')];_0x5ecbd2[a1_0x4288('0x19')]=_0x52bca1['id'];_0x5ecbd2[a1_0x4288('0x23')][a1_0x4288('0x1a')]({'kind':'facebook','accessToken':_0x130d09});_0x5ecbd2[a1_0x4288('0x1b')][a1_0x4288('0x15')]=_0x52bca1[a1_0x4288('0x15')][a1_0x4288('0x1c')]+'\x20'+_0x52bca1[a1_0x4288('0x15')]['familyName'];_0x5ecbd2[a1_0x4288('0x1b')][a1_0x4288('0x1e')]=_0x52bca1[a1_0x4288('0x1f')]['gender'];_0x5ecbd2[a1_0x4288('0x1b')][a1_0x4288('0x20')]='https://graph.facebook.com/'+_0x52bca1['id']+a1_0x4288('0x24');_0x5ecbd2['profile']['location']=_0x52bca1['_json'][a1_0x4288('0x25')]?_0x52bca1[a1_0x4288('0x1f')][a1_0x4288('0x25')][a1_0x4288('0x15')]:'';_0x5ecbd2[a1_0x4288('0x26')](_0x13a081=>{_0x352fbb(_0x13a081,_0x5ecbd2);});}});});}}));exports[a1_0x4288('0x27')]=(_0x27b590,_0x4b74b6,_0x2a84bb)=>{if(_0x27b590[a1_0x4288('0x27')]()){return _0x2a84bb();}_0x4b74b6[a1_0x4288('0x28')]('/login');};exports[a1_0x4288('0x29')]=(_0x528fa0,_0xba441a,_0x5123ca)=>{const _0x4edd5e=_0x528fa0[a1_0x4288('0x2a')][a1_0x4288('0x2b')]('/')[a1_0x4288('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x4288('0x5')][a1_0x4288('0x2d')](_0x528fa0[a1_0x4288('0x17')][a1_0x4288('0x23')],{'kind':_0x4edd5e})){_0x5123ca();}else{_0xba441a['redirect'](a1_0x4288('0x2e')+_0x4edd5e);}};