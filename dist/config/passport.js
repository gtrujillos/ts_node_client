var a1_0x1b2a=['split','slice','redirect','/auth/','__importDefault','__esModule','passport','passport-local','../models/User','default','Strategy','serializeUser','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','familyName','location','/login','isAuthorized','path'];(function(_0x341912,_0x21dd68){var _0xc36b4=function(_0x58dcde){while(--_0x58dcde){_0x341912['push'](_0x341912['shift']());}};_0xc36b4(++_0x21dd68);}(a1_0x1b2a,0x12a));var a1_0x1e80=function(_0x1be6b0,_0x5ad1fb){_0x1be6b0=_0x1be6b0-0x0;var _0x26aaf6=a1_0x1b2a[_0x1be6b0];return _0x26aaf6;};'use strict';var __importDefault=this&&this[a1_0x1e80('0x0')]||function(_0x305377){return _0x305377&&_0x305377[a1_0x1e80('0x1')]?_0x305377:{'default':_0x305377};};Object['defineProperty'](exports,a1_0x1e80('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x1e80('0x2')));const passport_local_1=__importDefault(require(a1_0x1e80('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x1e80('0x4')));const LocalStrategy=passport_local_1[a1_0x1e80('0x5')][a1_0x1e80('0x6')];const FacebookStrategy=passport_facebook_1['default'][a1_0x1e80('0x6')];passport_1[a1_0x1e80('0x5')][a1_0x1e80('0x7')]((_0x22e42d,_0x2c75e1)=>{_0x2c75e1(undefined,_0x22e42d['id']);});passport_1[a1_0x1e80('0x5')]['deserializeUser']((_0x11991c,_0x15e9e6)=>{User_1[a1_0x1e80('0x5')][a1_0x1e80('0x8')](_0x11991c,(_0x11760d,_0x788999)=>{_0x15e9e6(_0x11760d,_0x788999);});});passport_1[a1_0x1e80('0x5')][a1_0x1e80('0x9')](new LocalStrategy({'usernameField':a1_0x1e80('0xa')},(_0x389409,_0x10d669,_0xc95225)=>{User_1[a1_0x1e80('0x5')][a1_0x1e80('0xb')]({'email':_0x389409[a1_0x1e80('0xc')]()},(_0x64188,_0x2f06c1)=>{if(_0x64188){return _0xc95225(_0x64188);}if(!_0x2f06c1){return _0xc95225(undefined,![],{'message':a1_0x1e80('0xd')+_0x389409+'\x20not\x20found.'});}_0x2f06c1[a1_0x1e80('0xe')](_0x10d669,(_0x64188,_0x5b58d4)=>{if(_0x64188){return _0xc95225(_0x64188);}if(_0x5b58d4){return _0xc95225(undefined,_0x2f06c1);}return _0xc95225(undefined,![],{'message':a1_0x1e80('0xf')});});});}));passport_1[a1_0x1e80('0x5')][a1_0x1e80('0x9')](new FacebookStrategy({'clientID':process[a1_0x1e80('0x10')][a1_0x1e80('0x11')],'clientSecret':process[a1_0x1e80('0x10')][a1_0x1e80('0x12')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x1e80('0x13'),'email','link',a1_0x1e80('0x14'),a1_0x1e80('0x15')],'passReqToCallback':!![]},(_0x28c145,_0x58c925,_0x17e1fd,_0x124a8a,_0x5e951b)=>{if(_0x28c145[a1_0x1e80('0x16')]){User_1[a1_0x1e80('0x5')][a1_0x1e80('0xb')]({'facebook':_0x124a8a['id']},(_0x2ee2e9,_0x357712)=>{if(_0x2ee2e9){return _0x5e951b(_0x2ee2e9);}if(_0x357712){_0x28c145[a1_0x1e80('0x17')](a1_0x1e80('0x18'),{'msg':a1_0x1e80('0x19')});_0x5e951b(_0x2ee2e9);}else{User_1[a1_0x1e80('0x5')][a1_0x1e80('0x8')](_0x28c145['user']['id'],(_0x2ee2e9,_0x2edb68)=>{if(_0x2ee2e9){return _0x5e951b(_0x2ee2e9);}_0x2edb68[a1_0x1e80('0x1a')]=_0x124a8a['id'];_0x2edb68[a1_0x1e80('0x1b')][a1_0x1e80('0x1c')]({'kind':a1_0x1e80('0x1a'),'accessToken':_0x58c925});_0x2edb68[a1_0x1e80('0x1d')][a1_0x1e80('0x13')]=_0x2edb68[a1_0x1e80('0x1d')][a1_0x1e80('0x13')]||_0x124a8a[a1_0x1e80('0x13')][a1_0x1e80('0x1e')]+'\x20'+_0x124a8a[a1_0x1e80('0x13')]['familyName'];_0x2edb68['profile']['gender']=_0x2edb68['profile'][a1_0x1e80('0x1f')]||_0x124a8a[a1_0x1e80('0x20')][a1_0x1e80('0x1f')];_0x2edb68[a1_0x1e80('0x1d')][a1_0x1e80('0x21')]=_0x2edb68[a1_0x1e80('0x1d')][a1_0x1e80('0x21')]||a1_0x1e80('0x22')+_0x124a8a['id']+a1_0x1e80('0x23');_0x2edb68[a1_0x1e80('0x24')](_0x2ee2e9=>{_0x28c145['flash'](a1_0x1e80('0x25'),{'msg':a1_0x1e80('0x26')});_0x5e951b(_0x2ee2e9,_0x2edb68);});});}});}else{User_1['default']['findOne']({'facebook':_0x124a8a['id']},(_0x22f0e6,_0x2c60a2)=>{if(_0x22f0e6){return _0x5e951b(_0x22f0e6);}if(_0x2c60a2){return _0x5e951b(undefined,_0x2c60a2);}User_1[a1_0x1e80('0x5')][a1_0x1e80('0xb')]({'email':_0x124a8a['_json']['email']},(_0x22f0e6,_0x5eb689)=>{if(_0x22f0e6){return _0x5e951b(_0x22f0e6);}if(_0x5eb689){_0x28c145[a1_0x1e80('0x17')]('errors',{'msg':a1_0x1e80('0x27')});_0x5e951b(_0x22f0e6);}else{const _0x30fc3b=new User_1[(a1_0x1e80('0x5'))]();_0x30fc3b['email']=_0x124a8a[a1_0x1e80('0x20')][a1_0x1e80('0xa')];_0x30fc3b[a1_0x1e80('0x1a')]=_0x124a8a['id'];_0x30fc3b[a1_0x1e80('0x1b')][a1_0x1e80('0x1c')]({'kind':a1_0x1e80('0x1a'),'accessToken':_0x58c925});_0x30fc3b[a1_0x1e80('0x1d')][a1_0x1e80('0x13')]=_0x124a8a[a1_0x1e80('0x13')]['givenName']+'\x20'+_0x124a8a['name'][a1_0x1e80('0x28')];_0x30fc3b[a1_0x1e80('0x1d')][a1_0x1e80('0x1f')]=_0x124a8a[a1_0x1e80('0x20')]['gender'];_0x30fc3b[a1_0x1e80('0x1d')][a1_0x1e80('0x21')]=a1_0x1e80('0x22')+_0x124a8a['id']+'/picture?type=large';_0x30fc3b[a1_0x1e80('0x1d')][a1_0x1e80('0x29')]=_0x124a8a[a1_0x1e80('0x20')][a1_0x1e80('0x29')]?_0x124a8a[a1_0x1e80('0x20')][a1_0x1e80('0x29')][a1_0x1e80('0x13')]:'';_0x30fc3b[a1_0x1e80('0x24')](_0x22f0e6=>{_0x5e951b(_0x22f0e6,_0x30fc3b);});}});});}}));exports['isAuthenticated']=(_0x38457a,_0x529b20,_0x56c7de)=>{if(_0x38457a['isAuthenticated']()){return _0x56c7de();}_0x529b20['redirect'](a1_0x1e80('0x2a'));};exports[a1_0x1e80('0x2b')]=(_0x3da136,_0x564744,_0x520aaa)=>{const _0x53f9db=_0x3da136[a1_0x1e80('0x2c')][a1_0x1e80('0x2d')]('/')[a1_0x1e80('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x1e80('0x5')]['find'](_0x3da136[a1_0x1e80('0x16')][a1_0x1e80('0x1b')],{'kind':_0x53f9db})){_0x520aaa();}else{_0x564744[a1_0x1e80('0x2f')](a1_0x1e80('0x30')+_0x53f9db);}};