var a1_0x4624=['path','split','slice','find','__importDefault','__esModule','defineProperty','passport','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name','link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','user','push','facebook','profile','givenName','familyName','gender','_json','picture','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','https://graph.facebook.com/','/picture?type=large','location','isAuthenticated','redirect','/login','isAuthorized'];(function(_0x719243,_0x33a0f0){var _0x139cea=function(_0xd83189){while(--_0xd83189){_0x719243['push'](_0x719243['shift']());}};_0x139cea(++_0x33a0f0);}(a1_0x4624,0x1e1));var a1_0x4cc0=function(_0x2d158c,_0x5267c3){_0x2d158c=_0x2d158c-0x0;var _0x228c42=a1_0x4624[_0x2d158c];return _0x228c42;};'use strict';var __importDefault=this&&this[a1_0x4cc0('0x0')]||function(_0x3c6bc3){return _0x3c6bc3&&_0x3c6bc3[a1_0x4cc0('0x1')]?_0x3c6bc3:{'default':_0x3c6bc3};};Object[a1_0x4cc0('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4cc0('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4cc0('0x4')));const lodash_1=__importDefault(require(a1_0x4cc0('0x5')));const User_1=__importDefault(require(a1_0x4cc0('0x6')));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x4cc0('0x7')][a1_0x4cc0('0x8')];passport_1[a1_0x4cc0('0x7')][a1_0x4cc0('0x9')]((_0x3ea576,_0x4070ec)=>{_0x4070ec(undefined,_0x3ea576['id']);});passport_1[a1_0x4cc0('0x7')][a1_0x4cc0('0xa')]((_0x507815,_0x30e704)=>{User_1[a1_0x4cc0('0x7')]['findById'](_0x507815,(_0x5661bf,_0x41b5a7)=>{_0x30e704(_0x5661bf,_0x41b5a7);});});passport_1['default'][a1_0x4cc0('0xb')](new LocalStrategy({'usernameField':a1_0x4cc0('0xc')},(_0x5f0281,_0x455422,_0x37ee40)=>{User_1[a1_0x4cc0('0x7')][a1_0x4cc0('0xd')]({'email':_0x5f0281['toLowerCase']()},(_0x2d5acd,_0x5cd885)=>{if(_0x2d5acd){return _0x37ee40(_0x2d5acd);}if(!_0x5cd885){return _0x37ee40(undefined,![],{'message':a1_0x4cc0('0xe')+_0x5f0281+a1_0x4cc0('0xf')});}_0x5cd885[a1_0x4cc0('0x10')](_0x455422,(_0x2d5acd,_0x407ed7)=>{if(_0x2d5acd){return _0x37ee40(_0x2d5acd);}if(_0x407ed7){return _0x37ee40(undefined,_0x5cd885);}return _0x37ee40(undefined,![],{'message':a1_0x4cc0('0x11')});});});}));passport_1[a1_0x4cc0('0x7')][a1_0x4cc0('0xb')](new FacebookStrategy({'clientID':process[a1_0x4cc0('0x12')][a1_0x4cc0('0x13')],'clientSecret':process[a1_0x4cc0('0x12')][a1_0x4cc0('0x14')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x4cc0('0x15'),a1_0x4cc0('0xc'),a1_0x4cc0('0x16'),a1_0x4cc0('0x17'),a1_0x4cc0('0x18')],'passReqToCallback':!![]},(_0x5d213c,_0x334d14,_0x3dee8a,_0x559900,_0x4e9ac1)=>{if(_0x5d213c['user']){User_1['default'][a1_0x4cc0('0xd')]({'facebook':_0x559900['id']},(_0x446502,_0x22ccac)=>{if(_0x446502){return _0x4e9ac1(_0x446502);}if(_0x22ccac){_0x5d213c[a1_0x4cc0('0x19')](a1_0x4cc0('0x1a'),{'msg':a1_0x4cc0('0x1b')});_0x4e9ac1(_0x446502);}else{User_1['default'][a1_0x4cc0('0x1c')](_0x5d213c[a1_0x4cc0('0x1d')]['id'],(_0x446502,_0x539512)=>{if(_0x446502){return _0x4e9ac1(_0x446502);}_0x539512['facebook']=_0x559900['id'];_0x539512['tokens'][a1_0x4cc0('0x1e')]({'kind':a1_0x4cc0('0x1f'),'accessToken':_0x334d14});_0x539512[a1_0x4cc0('0x20')][a1_0x4cc0('0x15')]=_0x539512[a1_0x4cc0('0x20')][a1_0x4cc0('0x15')]||_0x559900['name'][a1_0x4cc0('0x21')]+'\x20'+_0x559900[a1_0x4cc0('0x15')][a1_0x4cc0('0x22')];_0x539512['profile'][a1_0x4cc0('0x23')]=_0x539512['profile']['gender']||_0x559900[a1_0x4cc0('0x24')][a1_0x4cc0('0x23')];_0x539512[a1_0x4cc0('0x20')][a1_0x4cc0('0x25')]=_0x539512[a1_0x4cc0('0x20')]['picture']||'https://graph.facebook.com/'+_0x559900['id']+'/picture?type=large';_0x539512['save'](_0x446502=>{_0x5d213c[a1_0x4cc0('0x19')](a1_0x4cc0('0x26'),{'msg':a1_0x4cc0('0x27')});_0x4e9ac1(_0x446502,_0x539512);});});}});}else{User_1[a1_0x4cc0('0x7')]['findOne']({'facebook':_0x559900['id']},(_0x2ce6a1,_0x131faa)=>{if(_0x2ce6a1){return _0x4e9ac1(_0x2ce6a1);}if(_0x131faa){return _0x4e9ac1(undefined,_0x131faa);}User_1[a1_0x4cc0('0x7')]['findOne']({'email':_0x559900[a1_0x4cc0('0x24')]['email']},(_0x2ce6a1,_0x408a27)=>{if(_0x2ce6a1){return _0x4e9ac1(_0x2ce6a1);}if(_0x408a27){_0x5d213c[a1_0x4cc0('0x19')]('errors',{'msg':a1_0x4cc0('0x28')});_0x4e9ac1(_0x2ce6a1);}else{const _0x3e5dfb=new User_1[(a1_0x4cc0('0x7'))]();_0x3e5dfb['email']=_0x559900[a1_0x4cc0('0x24')][a1_0x4cc0('0xc')];_0x3e5dfb[a1_0x4cc0('0x1f')]=_0x559900['id'];_0x3e5dfb[a1_0x4cc0('0x29')][a1_0x4cc0('0x1e')]({'kind':a1_0x4cc0('0x1f'),'accessToken':_0x334d14});_0x3e5dfb[a1_0x4cc0('0x20')][a1_0x4cc0('0x15')]=_0x559900['name'][a1_0x4cc0('0x21')]+'\x20'+_0x559900['name']['familyName'];_0x3e5dfb['profile']['gender']=_0x559900[a1_0x4cc0('0x24')][a1_0x4cc0('0x23')];_0x3e5dfb[a1_0x4cc0('0x20')][a1_0x4cc0('0x25')]=a1_0x4cc0('0x2a')+_0x559900['id']+a1_0x4cc0('0x2b');_0x3e5dfb[a1_0x4cc0('0x20')]['location']=_0x559900[a1_0x4cc0('0x24')]['location']?_0x559900['_json'][a1_0x4cc0('0x2c')]['name']:'';_0x3e5dfb['save'](_0x2ce6a1=>{_0x4e9ac1(_0x2ce6a1,_0x3e5dfb);});}});});}}));exports[a1_0x4cc0('0x2d')]=(_0x2c0c99,_0x1dbc54,_0x1f0cd9)=>{if(_0x2c0c99[a1_0x4cc0('0x2d')]()){return _0x1f0cd9();}_0x1dbc54[a1_0x4cc0('0x2e')](a1_0x4cc0('0x2f'));};exports[a1_0x4cc0('0x30')]=(_0x1e774f,_0x5482f7,_0x543280)=>{const _0x410b2b=_0x1e774f[a1_0x4cc0('0x31')][a1_0x4cc0('0x32')]('/')[a1_0x4cc0('0x33')](-0x1)[0x0];if(lodash_1[a1_0x4cc0('0x7')][a1_0x4cc0('0x34')](_0x1e774f[a1_0x4cc0('0x1d')]['tokens'],{'kind':_0x410b2b})){_0x543280();}else{_0x5482f7[a1_0x4cc0('0x2e')]('/auth/'+_0x410b2b);}};