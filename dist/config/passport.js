var a1_0xddf5=['errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','tokens','profile','name','familyName','gender','picture','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','https://graph.facebook.com/','location','isAuthenticated','redirect','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','deserializeUser','findById','email','findOne','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','timezone'];(function(_0x40d688,_0x4654d4){var _0x39c89b=function(_0x4e88bb){while(--_0x4e88bb){_0x40d688['push'](_0x40d688['shift']());}};_0x39c89b(++_0x4654d4);}(a1_0xddf5,0x11b));var a1_0x1265=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=a1_0xddf5[_0xb67384];return _0x156d7c;};'use strict';var __importDefault=this&&this[a1_0x1265('0x0')]||function(_0x16055c){return _0x16055c&&_0x16055c[a1_0x1265('0x1')]?_0x16055c:{'default':_0x16055c};};Object[a1_0x1265('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x1265('0x3')));const passport_local_1=__importDefault(require(a1_0x1265('0x4')));const passport_facebook_1=__importDefault(require(a1_0x1265('0x5')));const lodash_1=__importDefault(require(a1_0x1265('0x6')));const User_1=__importDefault(require(a1_0x1265('0x7')));const LocalStrategy=passport_local_1['default'][a1_0x1265('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x1265('0x9')][a1_0x1265('0x8')];passport_1[a1_0x1265('0x9')]['serializeUser']((_0x5e3c80,_0x1c7398)=>{_0x1c7398(undefined,_0x5e3c80['id']);});passport_1[a1_0x1265('0x9')][a1_0x1265('0xa')]((_0x119df1,_0x37a917)=>{User_1[a1_0x1265('0x9')][a1_0x1265('0xb')](_0x119df1,(_0x2a2b3c,_0x212ee1)=>{_0x37a917(_0x2a2b3c,_0x212ee1);});});passport_1[a1_0x1265('0x9')]['use'](new LocalStrategy({'usernameField':a1_0x1265('0xc')},(_0x52d899,_0x3d52b1,_0x5433dc)=>{User_1[a1_0x1265('0x9')][a1_0x1265('0xd')]({'email':_0x52d899['toLowerCase']()},(_0x2ddcde,_0x50b18c)=>{if(_0x2ddcde){return _0x5433dc(_0x2ddcde);}if(!_0x50b18c){return _0x5433dc(undefined,![],{'message':a1_0x1265('0xe')+_0x52d899+'\x20not\x20found.'});}_0x50b18c[a1_0x1265('0xf')](_0x3d52b1,(_0x2ddcde,_0x2d5272)=>{if(_0x2ddcde){return _0x5433dc(_0x2ddcde);}if(_0x2d5272){return _0x5433dc(undefined,_0x50b18c);}return _0x5433dc(undefined,![],{'message':a1_0x1265('0x10')});});});}));passport_1[a1_0x1265('0x9')]['use'](new FacebookStrategy({'clientID':process[a1_0x1265('0x11')]['FACEBOOK_ID'],'clientSecret':process[a1_0x1265('0x11')][a1_0x1265('0x12')],'callbackURL':a1_0x1265('0x13'),'profileFields':['name','email',a1_0x1265('0x14'),a1_0x1265('0x15'),a1_0x1265('0x16')],'passReqToCallback':!![]},(_0x15eed5,_0x428c82,_0x1167fe,_0xe25fc9,_0x3e52b5)=>{if(_0x15eed5['user']){User_1[a1_0x1265('0x9')][a1_0x1265('0xd')]({'facebook':_0xe25fc9['id']},(_0x1c3e6d,_0x3be6ea)=>{if(_0x1c3e6d){return _0x3e52b5(_0x1c3e6d);}if(_0x3be6ea){_0x15eed5['flash'](a1_0x1265('0x17'),{'msg':a1_0x1265('0x18')});_0x3e52b5(_0x1c3e6d);}else{User_1['default'][a1_0x1265('0xb')](_0x15eed5[a1_0x1265('0x19')]['id'],(_0x1c3e6d,_0x124b8b)=>{if(_0x1c3e6d){return _0x3e52b5(_0x1c3e6d);}_0x124b8b[a1_0x1265('0x1a')]=_0xe25fc9['id'];_0x124b8b[a1_0x1265('0x1b')]['push']({'kind':a1_0x1265('0x1a'),'accessToken':_0x428c82});_0x124b8b[a1_0x1265('0x1c')][a1_0x1265('0x1d')]=_0x124b8b[a1_0x1265('0x1c')]['name']||_0xe25fc9[a1_0x1265('0x1d')]['givenName']+'\x20'+_0xe25fc9[a1_0x1265('0x1d')][a1_0x1265('0x1e')];_0x124b8b[a1_0x1265('0x1c')]['gender']=_0x124b8b['profile'][a1_0x1265('0x1f')]||_0xe25fc9['_json'][a1_0x1265('0x1f')];_0x124b8b[a1_0x1265('0x1c')][a1_0x1265('0x20')]=_0x124b8b[a1_0x1265('0x1c')][a1_0x1265('0x20')]||'https://graph.facebook.com/'+_0xe25fc9['id']+a1_0x1265('0x21');_0x124b8b[a1_0x1265('0x22')](_0x1c3e6d=>{_0x15eed5[a1_0x1265('0x23')](a1_0x1265('0x24'),{'msg':a1_0x1265('0x25')});_0x3e52b5(_0x1c3e6d,_0x124b8b);});});}});}else{User_1[a1_0x1265('0x9')][a1_0x1265('0xd')]({'facebook':_0xe25fc9['id']},(_0x355db6,_0x376d1f)=>{if(_0x355db6){return _0x3e52b5(_0x355db6);}if(_0x376d1f){return _0x3e52b5(undefined,_0x376d1f);}User_1[a1_0x1265('0x9')][a1_0x1265('0xd')]({'email':_0xe25fc9[a1_0x1265('0x26')][a1_0x1265('0xc')]},(_0x355db6,_0x42c9e4)=>{if(_0x355db6){return _0x3e52b5(_0x355db6);}if(_0x42c9e4){_0x15eed5[a1_0x1265('0x23')]('errors',{'msg':a1_0x1265('0x27')});_0x3e52b5(_0x355db6);}else{const _0x525fbe=new User_1[(a1_0x1265('0x9'))]();_0x525fbe[a1_0x1265('0xc')]=_0xe25fc9['_json'][a1_0x1265('0xc')];_0x525fbe[a1_0x1265('0x1a')]=_0xe25fc9['id'];_0x525fbe[a1_0x1265('0x1b')]['push']({'kind':a1_0x1265('0x1a'),'accessToken':_0x428c82});_0x525fbe[a1_0x1265('0x1c')]['name']=_0xe25fc9[a1_0x1265('0x1d')][a1_0x1265('0x28')]+'\x20'+_0xe25fc9[a1_0x1265('0x1d')][a1_0x1265('0x1e')];_0x525fbe[a1_0x1265('0x1c')][a1_0x1265('0x1f')]=_0xe25fc9[a1_0x1265('0x26')][a1_0x1265('0x1f')];_0x525fbe[a1_0x1265('0x1c')][a1_0x1265('0x20')]=a1_0x1265('0x29')+_0xe25fc9['id']+a1_0x1265('0x21');_0x525fbe[a1_0x1265('0x1c')]['location']=_0xe25fc9[a1_0x1265('0x26')][a1_0x1265('0x2a')]?_0xe25fc9['_json'][a1_0x1265('0x2a')][a1_0x1265('0x1d')]:'';_0x525fbe[a1_0x1265('0x22')](_0x355db6=>{_0x3e52b5(_0x355db6,_0x525fbe);});}});});}}));exports[a1_0x1265('0x2b')]=(_0x27223e,_0x5bca23,_0x1a3a24)=>{if(_0x27223e[a1_0x1265('0x2b')]()){return _0x1a3a24();}_0x5bca23[a1_0x1265('0x2c')]('/login');};exports[a1_0x1265('0x2d')]=(_0x2f903a,_0x3c2b4d,_0x457f79)=>{const _0x4d0384=_0x2f903a[a1_0x1265('0x2e')][a1_0x1265('0x2f')]('/')[a1_0x1265('0x30')](-0x1)[0x0];if(lodash_1[a1_0x1265('0x9')][a1_0x1265('0x31')](_0x2f903a['user']['tokens'],{'kind':_0x4d0384})){_0x457f79();}else{_0x3c2b4d[a1_0x1265('0x2c')](a1_0x1265('0x32')+_0x4d0384);}};