var a1_0x3112=['slice','__importDefault','__esModule','defineProperty','passport','../models/User','default','Strategy','deserializeUser','findById','email','findOne','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','/auth/facebook/callback','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','name','givenName','familyName','gender','_json','https://graph.facebook.com/','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','picture','location','isAuthenticated','/login','isAuthorized','path'];(function(_0x15f0ba,_0x4018fc){var _0x31c2f1=function(_0x5118ad){while(--_0x5118ad){_0x15f0ba['push'](_0x15f0ba['shift']());}};_0x31c2f1(++_0x4018fc);}(a1_0x3112,0x88));var a1_0x29c1=function(_0x5870a1,_0xfcf8d1){_0x5870a1=_0x5870a1-0x0;var _0x3350ec=a1_0x3112[_0x5870a1];return _0x3350ec;};'use strict';var __importDefault=this&&this[a1_0x29c1('0x0')]||function(_0x51b3f4){return _0x51b3f4&&_0x51b3f4[a1_0x29c1('0x1')]?_0x51b3f4:{'default':_0x51b3f4};};Object[a1_0x29c1('0x2')](exports,a1_0x29c1('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x29c1('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x29c1('0x4')));const LocalStrategy=passport_local_1[a1_0x29c1('0x5')][a1_0x29c1('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x29c1('0x5')][a1_0x29c1('0x6')];passport_1[a1_0x29c1('0x5')]['serializeUser']((_0x235f25,_0x4ffbf3)=>{_0x4ffbf3(undefined,_0x235f25['id']);});passport_1[a1_0x29c1('0x5')][a1_0x29c1('0x7')]((_0x1e08af,_0x1e2e30)=>{User_1['default'][a1_0x29c1('0x8')](_0x1e08af,(_0xb3714e,_0x3ff3d0)=>{_0x1e2e30(_0xb3714e,_0x3ff3d0);});});passport_1[a1_0x29c1('0x5')]['use'](new LocalStrategy({'usernameField':a1_0x29c1('0x9')},(_0x597e78,_0x2b4a76,_0x37418d)=>{User_1[a1_0x29c1('0x5')][a1_0x29c1('0xa')]({'email':_0x597e78['toLowerCase']()},(_0x4bc543,_0x4e59ac)=>{if(_0x4bc543){return _0x37418d(_0x4bc543);}if(!_0x4e59ac){return _0x37418d(undefined,![],{'message':'Email\x20'+_0x597e78+a1_0x29c1('0xb')});}_0x4e59ac[a1_0x29c1('0xc')](_0x2b4a76,(_0x4bc543,_0x5484e9)=>{if(_0x4bc543){return _0x37418d(_0x4bc543);}if(_0x5484e9){return _0x37418d(undefined,_0x4e59ac);}return _0x37418d(undefined,![],{'message':a1_0x29c1('0xd')});});});}));passport_1[a1_0x29c1('0x5')][a1_0x29c1('0xe')](new FacebookStrategy({'clientID':process[a1_0x29c1('0xf')][a1_0x29c1('0x10')],'clientSecret':process[a1_0x29c1('0xf')]['FACEBOOK_SECRET'],'callbackURL':a1_0x29c1('0x11'),'profileFields':['name',a1_0x29c1('0x9'),a1_0x29c1('0x12'),a1_0x29c1('0x13'),a1_0x29c1('0x14')],'passReqToCallback':!![]},(_0x4afed4,_0x58757e,_0x69392f,_0x5be99a,_0x5ce595)=>{if(_0x4afed4[a1_0x29c1('0x15')]){User_1[a1_0x29c1('0x5')][a1_0x29c1('0xa')]({'facebook':_0x5be99a['id']},(_0x4f498c,_0x55a14a)=>{if(_0x4f498c){return _0x5ce595(_0x4f498c);}if(_0x55a14a){_0x4afed4[a1_0x29c1('0x16')](a1_0x29c1('0x17'),{'msg':a1_0x29c1('0x18')});_0x5ce595(_0x4f498c);}else{User_1[a1_0x29c1('0x5')][a1_0x29c1('0x8')](_0x4afed4['user']['id'],(_0x4f498c,_0x329a70)=>{if(_0x4f498c){return _0x5ce595(_0x4f498c);}_0x329a70[a1_0x29c1('0x19')]=_0x5be99a['id'];_0x329a70[a1_0x29c1('0x1a')][a1_0x29c1('0x1b')]({'kind':a1_0x29c1('0x19'),'accessToken':_0x58757e});_0x329a70[a1_0x29c1('0x1c')][a1_0x29c1('0x1d')]=_0x329a70[a1_0x29c1('0x1c')][a1_0x29c1('0x1d')]||_0x5be99a[a1_0x29c1('0x1d')][a1_0x29c1('0x1e')]+'\x20'+_0x5be99a['name'][a1_0x29c1('0x1f')];_0x329a70[a1_0x29c1('0x1c')][a1_0x29c1('0x20')]=_0x329a70[a1_0x29c1('0x1c')][a1_0x29c1('0x20')]||_0x5be99a[a1_0x29c1('0x21')]['gender'];_0x329a70['profile']['picture']=_0x329a70['profile']['picture']||a1_0x29c1('0x22')+_0x5be99a['id']+'/picture?type=large';_0x329a70[a1_0x29c1('0x23')](_0x4f498c=>{_0x4afed4[a1_0x29c1('0x16')](a1_0x29c1('0x24'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x5ce595(_0x4f498c,_0x329a70);});});}});}else{User_1[a1_0x29c1('0x5')][a1_0x29c1('0xa')]({'facebook':_0x5be99a['id']},(_0x324b83,_0x3ac9d9)=>{if(_0x324b83){return _0x5ce595(_0x324b83);}if(_0x3ac9d9){return _0x5ce595(undefined,_0x3ac9d9);}User_1[a1_0x29c1('0x5')]['findOne']({'email':_0x5be99a[a1_0x29c1('0x21')][a1_0x29c1('0x9')]},(_0x324b83,_0x27c27f)=>{if(_0x324b83){return _0x5ce595(_0x324b83);}if(_0x27c27f){_0x4afed4[a1_0x29c1('0x16')](a1_0x29c1('0x17'),{'msg':a1_0x29c1('0x25')});_0x5ce595(_0x324b83);}else{const _0x4cb56f=new User_1[(a1_0x29c1('0x5'))]();_0x4cb56f['email']=_0x5be99a[a1_0x29c1('0x21')][a1_0x29c1('0x9')];_0x4cb56f['facebook']=_0x5be99a['id'];_0x4cb56f[a1_0x29c1('0x1a')][a1_0x29c1('0x1b')]({'kind':a1_0x29c1('0x19'),'accessToken':_0x58757e});_0x4cb56f[a1_0x29c1('0x1c')][a1_0x29c1('0x1d')]=_0x5be99a[a1_0x29c1('0x1d')][a1_0x29c1('0x1e')]+'\x20'+_0x5be99a[a1_0x29c1('0x1d')][a1_0x29c1('0x1f')];_0x4cb56f[a1_0x29c1('0x1c')][a1_0x29c1('0x20')]=_0x5be99a[a1_0x29c1('0x21')][a1_0x29c1('0x20')];_0x4cb56f['profile'][a1_0x29c1('0x26')]=a1_0x29c1('0x22')+_0x5be99a['id']+'/picture?type=large';_0x4cb56f[a1_0x29c1('0x1c')]['location']=_0x5be99a[a1_0x29c1('0x21')][a1_0x29c1('0x27')]?_0x5be99a['_json'][a1_0x29c1('0x27')]['name']:'';_0x4cb56f['save'](_0x324b83=>{_0x5ce595(_0x324b83,_0x4cb56f);});}});});}}));exports[a1_0x29c1('0x28')]=(_0x229d77,_0x448dee,_0x1586a9)=>{if(_0x229d77[a1_0x29c1('0x28')]()){return _0x1586a9();}_0x448dee['redirect'](a1_0x29c1('0x29'));};exports[a1_0x29c1('0x2a')]=(_0x505bb6,_0x20b09d,_0x2def27)=>{const _0x50aaf0=_0x505bb6[a1_0x29c1('0x2b')]['split']('/')[a1_0x29c1('0x2c')](-0x1)[0x0];if(lodash_1['default']['find'](_0x505bb6[a1_0x29c1('0x15')][a1_0x29c1('0x1a')],{'kind':_0x50aaf0})){_0x2def27();}else{_0x20b09d['redirect']('/auth/'+_0x50aaf0);}};