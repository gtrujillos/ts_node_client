var a1_0x5474=['name','familyName','gender','_json','picture','save','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','push','givenName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','/auth/','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','serializeUser','findById','use','email','findOne','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','profile'];(function(_0x31f803,_0x2de713){var _0x23327c=function(_0x5c2d9c){while(--_0x5c2d9c){_0x31f803['push'](_0x31f803['shift']());}};_0x23327c(++_0x2de713);}(a1_0x5474,0x77));var a1_0x39ee=function(_0x1f8e37,_0x1753db){_0x1f8e37=_0x1f8e37-0x0;var _0x2c5012=a1_0x5474[_0x1f8e37];return _0x2c5012;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4e0db7){return _0x4e0db7&&_0x4e0db7[a1_0x39ee('0x0')]?_0x4e0db7:{'default':_0x4e0db7};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x39ee('0x1')));const passport_local_1=__importDefault(require(a1_0x39ee('0x2')));const passport_facebook_1=__importDefault(require(a1_0x39ee('0x3')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x39ee('0x4')));const LocalStrategy=passport_local_1[a1_0x39ee('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x39ee('0x5')][a1_0x39ee('0x6')];passport_1['default'][a1_0x39ee('0x7')]((_0x597c60,_0x3a3eb7)=>{_0x3a3eb7(undefined,_0x597c60['id']);});passport_1[a1_0x39ee('0x5')]['deserializeUser']((_0x1951ed,_0x2125fb)=>{User_1[a1_0x39ee('0x5')][a1_0x39ee('0x8')](_0x1951ed,(_0x16c196,_0x2156fa)=>{_0x2125fb(_0x16c196,_0x2156fa);});});passport_1[a1_0x39ee('0x5')][a1_0x39ee('0x9')](new LocalStrategy({'usernameField':a1_0x39ee('0xa')},(_0x2022e8,_0x410cca,_0xcb99df)=>{User_1['default'][a1_0x39ee('0xb')]({'email':_0x2022e8['toLowerCase']()},(_0x322957,_0xd8cdc5)=>{if(_0x322957){return _0xcb99df(_0x322957);}if(!_0xd8cdc5){return _0xcb99df(undefined,![],{'message':'Email\x20'+_0x2022e8+a1_0x39ee('0xc')});}_0xd8cdc5[a1_0x39ee('0xd')](_0x410cca,(_0x322957,_0xcb31c1)=>{if(_0x322957){return _0xcb99df(_0x322957);}if(_0xcb31c1){return _0xcb99df(undefined,_0xd8cdc5);}return _0xcb99df(undefined,![],{'message':a1_0x39ee('0xe')});});});}));passport_1[a1_0x39ee('0x5')]['use'](new FacebookStrategy({'clientID':process[a1_0x39ee('0xf')][a1_0x39ee('0x10')],'clientSecret':process['env'][a1_0x39ee('0x11')],'callbackURL':a1_0x39ee('0x12'),'profileFields':['name',a1_0x39ee('0xa'),a1_0x39ee('0x13'),a1_0x39ee('0x14'),a1_0x39ee('0x15')],'passReqToCallback':!![]},(_0x44d532,_0x1846d8,_0x23825d,_0x44624e,_0x384b38)=>{if(_0x44d532[a1_0x39ee('0x16')]){User_1[a1_0x39ee('0x5')][a1_0x39ee('0xb')]({'facebook':_0x44624e['id']},(_0x3d484c,_0x20886b)=>{if(_0x3d484c){return _0x384b38(_0x3d484c);}if(_0x20886b){_0x44d532[a1_0x39ee('0x17')](a1_0x39ee('0x18'),{'msg':a1_0x39ee('0x19')});_0x384b38(_0x3d484c);}else{User_1[a1_0x39ee('0x5')][a1_0x39ee('0x8')](_0x44d532[a1_0x39ee('0x16')]['id'],(_0x3d484c,_0x43f7c9)=>{if(_0x3d484c){return _0x384b38(_0x3d484c);}_0x43f7c9[a1_0x39ee('0x1a')]=_0x44624e['id'];_0x43f7c9['tokens']['push']({'kind':a1_0x39ee('0x1a'),'accessToken':_0x1846d8});_0x43f7c9['profile']['name']=_0x43f7c9[a1_0x39ee('0x1b')][a1_0x39ee('0x1c')]||_0x44624e[a1_0x39ee('0x1c')]['givenName']+'\x20'+_0x44624e['name'][a1_0x39ee('0x1d')];_0x43f7c9[a1_0x39ee('0x1b')][a1_0x39ee('0x1e')]=_0x43f7c9['profile']['gender']||_0x44624e[a1_0x39ee('0x1f')][a1_0x39ee('0x1e')];_0x43f7c9[a1_0x39ee('0x1b')][a1_0x39ee('0x20')]=_0x43f7c9[a1_0x39ee('0x1b')][a1_0x39ee('0x20')]||'https://graph.facebook.com/'+_0x44624e['id']+'/picture?type=large';_0x43f7c9[a1_0x39ee('0x21')](_0x3d484c=>{_0x44d532[a1_0x39ee('0x17')]('info',{'msg':a1_0x39ee('0x22')});_0x384b38(_0x3d484c,_0x43f7c9);});});}});}else{User_1['default']['findOne']({'facebook':_0x44624e['id']},(_0x4b91ef,_0xe32551)=>{if(_0x4b91ef){return _0x384b38(_0x4b91ef);}if(_0xe32551){return _0x384b38(undefined,_0xe32551);}User_1['default'][a1_0x39ee('0xb')]({'email':_0x44624e[a1_0x39ee('0x1f')][a1_0x39ee('0xa')]},(_0x4b91ef,_0x43b33a)=>{if(_0x4b91ef){return _0x384b38(_0x4b91ef);}if(_0x43b33a){_0x44d532[a1_0x39ee('0x17')]('errors',{'msg':a1_0x39ee('0x23')});_0x384b38(_0x4b91ef);}else{const _0x5f11eb=new User_1[(a1_0x39ee('0x5'))]();_0x5f11eb[a1_0x39ee('0xa')]=_0x44624e[a1_0x39ee('0x1f')][a1_0x39ee('0xa')];_0x5f11eb[a1_0x39ee('0x1a')]=_0x44624e['id'];_0x5f11eb[a1_0x39ee('0x24')][a1_0x39ee('0x25')]({'kind':a1_0x39ee('0x1a'),'accessToken':_0x1846d8});_0x5f11eb[a1_0x39ee('0x1b')]['name']=_0x44624e['name'][a1_0x39ee('0x26')]+'\x20'+_0x44624e[a1_0x39ee('0x1c')][a1_0x39ee('0x1d')];_0x5f11eb[a1_0x39ee('0x1b')][a1_0x39ee('0x1e')]=_0x44624e['_json'][a1_0x39ee('0x1e')];_0x5f11eb[a1_0x39ee('0x1b')][a1_0x39ee('0x20')]=a1_0x39ee('0x27')+_0x44624e['id']+'/picture?type=large';_0x5f11eb['profile'][a1_0x39ee('0x28')]=_0x44624e[a1_0x39ee('0x1f')][a1_0x39ee('0x28')]?_0x44624e[a1_0x39ee('0x1f')][a1_0x39ee('0x28')][a1_0x39ee('0x1c')]:'';_0x5f11eb[a1_0x39ee('0x21')](_0x4b91ef=>{_0x384b38(_0x4b91ef,_0x5f11eb);});}});});}}));exports[a1_0x39ee('0x29')]=(_0x32a0f1,_0x18c4a6,_0x223b01)=>{if(_0x32a0f1['isAuthenticated']()){return _0x223b01();}_0x18c4a6[a1_0x39ee('0x2a')](a1_0x39ee('0x2b'));};exports[a1_0x39ee('0x2c')]=(_0x4165bf,_0x252b27,_0x2cc9ca)=>{const _0x480e6e=_0x4165bf[a1_0x39ee('0x2d')][a1_0x39ee('0x2e')]('/')[a1_0x39ee('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x39ee('0x5')]['find'](_0x4165bf[a1_0x39ee('0x16')]['tokens'],{'kind':_0x480e6e})){_0x2cc9ca();}else{_0x252b27['redirect'](a1_0x39ee('0x30')+_0x480e6e);}};