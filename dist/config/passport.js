var a1_0x5e54=['path','split','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','findOne','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','email','link','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','tokens','push','profile','name','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','givenName','location','save','isAuthenticated','redirect','/login','isAuthorized'];(function(_0x3bdbff,_0x43ad7c){var _0x3dbf97=function(_0x108e5d){while(--_0x108e5d){_0x3bdbff['push'](_0x3bdbff['shift']());}};_0x3dbf97(++_0x43ad7c);}(a1_0x5e54,0x1d7));var a1_0x4f56=function(_0x4f4598,_0x249fe8){_0x4f4598=_0x4f4598-0x0;var _0x41add6=a1_0x5e54[_0x4f4598];return _0x41add6;};'use strict';var __importDefault=this&&this[a1_0x4f56('0x0')]||function(_0x1e191c){return _0x1e191c&&_0x1e191c[a1_0x4f56('0x1')]?_0x1e191c:{'default':_0x1e191c};};Object[a1_0x4f56('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4f56('0x3')));const passport_local_1=__importDefault(require(a1_0x4f56('0x4')));const passport_facebook_1=__importDefault(require(a1_0x4f56('0x5')));const lodash_1=__importDefault(require(a1_0x4f56('0x6')));const User_1=__importDefault(require(a1_0x4f56('0x7')));const LocalStrategy=passport_local_1[a1_0x4f56('0x8')][a1_0x4f56('0x9')];const FacebookStrategy=passport_facebook_1['default'][a1_0x4f56('0x9')];passport_1['default'][a1_0x4f56('0xa')]((_0x4a953c,_0x6da4d7)=>{_0x6da4d7(undefined,_0x4a953c['id']);});passport_1[a1_0x4f56('0x8')][a1_0x4f56('0xb')]((_0x2c92ae,_0xadac64)=>{User_1[a1_0x4f56('0x8')][a1_0x4f56('0xc')](_0x2c92ae,(_0x7e34d2,_0x5927a8)=>{_0xadac64(_0x7e34d2,_0x5927a8);});});passport_1[a1_0x4f56('0x8')]['use'](new LocalStrategy({'usernameField':'email'},(_0x4791ec,_0x5c974a,_0x148455)=>{User_1[a1_0x4f56('0x8')][a1_0x4f56('0xd')]({'email':_0x4791ec['toLowerCase']()},(_0xbff0e7,_0xaa06ff)=>{if(_0xbff0e7){return _0x148455(_0xbff0e7);}if(!_0xaa06ff){return _0x148455(undefined,![],{'message':'Email\x20'+_0x4791ec+a1_0x4f56('0xe')});}_0xaa06ff[a1_0x4f56('0xf')](_0x5c974a,(_0xbff0e7,_0x5a18de)=>{if(_0xbff0e7){return _0x148455(_0xbff0e7);}if(_0x5a18de){return _0x148455(undefined,_0xaa06ff);}return _0x148455(undefined,![],{'message':a1_0x4f56('0x10')});});});}));passport_1[a1_0x4f56('0x8')][a1_0x4f56('0x11')](new FacebookStrategy({'clientID':process[a1_0x4f56('0x12')][a1_0x4f56('0x13')],'clientSecret':process[a1_0x4f56('0x12')][a1_0x4f56('0x14')],'callbackURL':a1_0x4f56('0x15'),'profileFields':['name',a1_0x4f56('0x16'),a1_0x4f56('0x17'),'locale',a1_0x4f56('0x18')],'passReqToCallback':!![]},(_0x11735c,_0x761252,_0x21af8d,_0x20ce0c,_0x1d3249)=>{if(_0x11735c['user']){User_1[a1_0x4f56('0x8')]['findOne']({'facebook':_0x20ce0c['id']},(_0x44fdc9,_0x19516e)=>{if(_0x44fdc9){return _0x1d3249(_0x44fdc9);}if(_0x19516e){_0x11735c[a1_0x4f56('0x19')](a1_0x4f56('0x1a'),{'msg':a1_0x4f56('0x1b')});_0x1d3249(_0x44fdc9);}else{User_1['default'][a1_0x4f56('0xc')](_0x11735c[a1_0x4f56('0x1c')]['id'],(_0x44fdc9,_0x40c559)=>{if(_0x44fdc9){return _0x1d3249(_0x44fdc9);}_0x40c559[a1_0x4f56('0x1d')]=_0x20ce0c['id'];_0x40c559[a1_0x4f56('0x1e')][a1_0x4f56('0x1f')]({'kind':a1_0x4f56('0x1d'),'accessToken':_0x761252});_0x40c559[a1_0x4f56('0x20')][a1_0x4f56('0x21')]=_0x40c559['profile'][a1_0x4f56('0x21')]||_0x20ce0c[a1_0x4f56('0x21')]['givenName']+'\x20'+_0x20ce0c[a1_0x4f56('0x21')][a1_0x4f56('0x22')];_0x40c559['profile']['gender']=_0x40c559['profile'][a1_0x4f56('0x23')]||_0x20ce0c[a1_0x4f56('0x24')][a1_0x4f56('0x23')];_0x40c559['profile'][a1_0x4f56('0x25')]=_0x40c559['profile'][a1_0x4f56('0x25')]||a1_0x4f56('0x26')+_0x20ce0c['id']+a1_0x4f56('0x27');_0x40c559['save'](_0x44fdc9=>{_0x11735c[a1_0x4f56('0x19')](a1_0x4f56('0x28'),{'msg':a1_0x4f56('0x29')});_0x1d3249(_0x44fdc9,_0x40c559);});});}});}else{User_1[a1_0x4f56('0x8')][a1_0x4f56('0xd')]({'facebook':_0x20ce0c['id']},(_0x1010c8,_0x45bafe)=>{if(_0x1010c8){return _0x1d3249(_0x1010c8);}if(_0x45bafe){return _0x1d3249(undefined,_0x45bafe);}User_1[a1_0x4f56('0x8')][a1_0x4f56('0xd')]({'email':_0x20ce0c[a1_0x4f56('0x24')]['email']},(_0x1010c8,_0x47c7b9)=>{if(_0x1010c8){return _0x1d3249(_0x1010c8);}if(_0x47c7b9){_0x11735c[a1_0x4f56('0x19')](a1_0x4f56('0x1a'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x1d3249(_0x1010c8);}else{const _0x2e5084=new User_1[(a1_0x4f56('0x8'))]();_0x2e5084['email']=_0x20ce0c[a1_0x4f56('0x24')][a1_0x4f56('0x16')];_0x2e5084['facebook']=_0x20ce0c['id'];_0x2e5084[a1_0x4f56('0x1e')]['push']({'kind':a1_0x4f56('0x1d'),'accessToken':_0x761252});_0x2e5084['profile'][a1_0x4f56('0x21')]=_0x20ce0c[a1_0x4f56('0x21')][a1_0x4f56('0x2a')]+'\x20'+_0x20ce0c[a1_0x4f56('0x21')]['familyName'];_0x2e5084[a1_0x4f56('0x20')][a1_0x4f56('0x23')]=_0x20ce0c['_json']['gender'];_0x2e5084[a1_0x4f56('0x20')]['picture']=a1_0x4f56('0x26')+_0x20ce0c['id']+a1_0x4f56('0x27');_0x2e5084[a1_0x4f56('0x20')][a1_0x4f56('0x2b')]=_0x20ce0c[a1_0x4f56('0x24')][a1_0x4f56('0x2b')]?_0x20ce0c[a1_0x4f56('0x24')][a1_0x4f56('0x2b')]['name']:'';_0x2e5084[a1_0x4f56('0x2c')](_0x1010c8=>{_0x1d3249(_0x1010c8,_0x2e5084);});}});});}}));exports[a1_0x4f56('0x2d')]=(_0x3c87ea,_0x31a074,_0x21b0ef)=>{if(_0x3c87ea[a1_0x4f56('0x2d')]()){return _0x21b0ef();}_0x31a074[a1_0x4f56('0x2e')](a1_0x4f56('0x2f'));};exports[a1_0x4f56('0x30')]=(_0x3b4804,_0x241d4a,_0x1c2662)=>{const _0x450f79=_0x3b4804[a1_0x4f56('0x31')][a1_0x4f56('0x32')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x4f56('0x8')]['find'](_0x3b4804[a1_0x4f56('0x1c')][a1_0x4f56('0x1e')],{'kind':_0x450f79})){_0x1c2662();}else{_0x241d4a[a1_0x4f56('0x2e')](a1_0x4f56('0x33')+_0x450f79);}};