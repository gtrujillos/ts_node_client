var a1_0x2f22=['/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','link','locale','timezone','user','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile','name','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','errors','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','slice','find'];(function(_0x232628,_0x5bab48){var _0x316daa=function(_0xa1372){while(--_0xa1372){_0x232628['push'](_0x232628['shift']());}};_0x316daa(++_0x5bab48);}(a1_0x2f22,0xd9));var a1_0x2571=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a1_0x2f22[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a1_0x2571('0x0')]||function(_0x5f47f2){return _0x5f47f2&&_0x5f47f2['__esModule']?_0x5f47f2:{'default':_0x5f47f2};};Object[a1_0x2571('0x1')](exports,a1_0x2571('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2571('0x3')));const passport_local_1=__importDefault(require(a1_0x2571('0x4')));const passport_facebook_1=__importDefault(require(a1_0x2571('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x2571('0x6')));const LocalStrategy=passport_local_1[a1_0x2571('0x7')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x2571('0x7')][a1_0x2571('0x8')];passport_1[a1_0x2571('0x7')][a1_0x2571('0x9')]((_0x203f6a,_0x4f4713)=>{_0x4f4713(undefined,_0x203f6a['id']);});passport_1[a1_0x2571('0x7')][a1_0x2571('0xa')]((_0x330283,_0x2ca639)=>{User_1[a1_0x2571('0x7')][a1_0x2571('0xb')](_0x330283,(_0x2f8aba,_0xf3bc0e)=>{_0x2ca639(_0x2f8aba,_0xf3bc0e);});});passport_1[a1_0x2571('0x7')][a1_0x2571('0xc')](new LocalStrategy({'usernameField':a1_0x2571('0xd')},(_0xaf3acb,_0x14d3b0,_0x2da271)=>{User_1[a1_0x2571('0x7')][a1_0x2571('0xe')]({'email':_0xaf3acb[a1_0x2571('0xf')]()},(_0x53fe2e,_0x38091a)=>{if(_0x53fe2e){return _0x2da271(_0x53fe2e);}if(!_0x38091a){return _0x2da271(undefined,![],{'message':a1_0x2571('0x10')+_0xaf3acb+a1_0x2571('0x11')});}_0x38091a[a1_0x2571('0x12')](_0x14d3b0,(_0x53fe2e,_0x1ee57e)=>{if(_0x53fe2e){return _0x2da271(_0x53fe2e);}if(_0x1ee57e){return _0x2da271(undefined,_0x38091a);}return _0x2da271(undefined,![],{'message':a1_0x2571('0x13')});});});}));passport_1[a1_0x2571('0x7')][a1_0x2571('0xc')](new FacebookStrategy({'clientID':process[a1_0x2571('0x14')][a1_0x2571('0x15')],'clientSecret':process['env'][a1_0x2571('0x16')],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x2571('0xd'),a1_0x2571('0x17'),a1_0x2571('0x18'),a1_0x2571('0x19')],'passReqToCallback':!![]},(_0x58ee01,_0xca8e20,_0x47e0ec,_0x153acf,_0x40efc2)=>{if(_0x58ee01[a1_0x2571('0x1a')]){User_1[a1_0x2571('0x7')]['findOne']({'facebook':_0x153acf['id']},(_0x429ff4,_0x454aa8)=>{if(_0x429ff4){return _0x40efc2(_0x429ff4);}if(_0x454aa8){_0x58ee01['flash']('errors',{'msg':a1_0x2571('0x1b')});_0x40efc2(_0x429ff4);}else{User_1[a1_0x2571('0x7')][a1_0x2571('0xb')](_0x58ee01['user']['id'],(_0x429ff4,_0x911f25)=>{if(_0x429ff4){return _0x40efc2(_0x429ff4);}_0x911f25['facebook']=_0x153acf['id'];_0x911f25[a1_0x2571('0x1c')][a1_0x2571('0x1d')]({'kind':a1_0x2571('0x1e'),'accessToken':_0xca8e20});_0x911f25[a1_0x2571('0x1f')][a1_0x2571('0x20')]=_0x911f25[a1_0x2571('0x1f')][a1_0x2571('0x20')]||_0x153acf[a1_0x2571('0x20')][a1_0x2571('0x21')]+'\x20'+_0x153acf[a1_0x2571('0x20')]['familyName'];_0x911f25[a1_0x2571('0x1f')][a1_0x2571('0x22')]=_0x911f25[a1_0x2571('0x1f')][a1_0x2571('0x22')]||_0x153acf[a1_0x2571('0x23')][a1_0x2571('0x22')];_0x911f25[a1_0x2571('0x1f')][a1_0x2571('0x24')]=_0x911f25['profile'][a1_0x2571('0x24')]||a1_0x2571('0x25')+_0x153acf['id']+a1_0x2571('0x26');_0x911f25[a1_0x2571('0x27')](_0x429ff4=>{_0x58ee01[a1_0x2571('0x28')](a1_0x2571('0x29'),{'msg':a1_0x2571('0x2a')});_0x40efc2(_0x429ff4,_0x911f25);});});}});}else{User_1[a1_0x2571('0x7')][a1_0x2571('0xe')]({'facebook':_0x153acf['id']},(_0x1397fc,_0x342f94)=>{if(_0x1397fc){return _0x40efc2(_0x1397fc);}if(_0x342f94){return _0x40efc2(undefined,_0x342f94);}User_1[a1_0x2571('0x7')][a1_0x2571('0xe')]({'email':_0x153acf[a1_0x2571('0x23')][a1_0x2571('0xd')]},(_0x1397fc,_0x5f3d08)=>{if(_0x1397fc){return _0x40efc2(_0x1397fc);}if(_0x5f3d08){_0x58ee01['flash'](a1_0x2571('0x2b'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x40efc2(_0x1397fc);}else{const _0x2a258c=new User_1[(a1_0x2571('0x7'))]();_0x2a258c[a1_0x2571('0xd')]=_0x153acf[a1_0x2571('0x23')][a1_0x2571('0xd')];_0x2a258c[a1_0x2571('0x1e')]=_0x153acf['id'];_0x2a258c['tokens'][a1_0x2571('0x1d')]({'kind':a1_0x2571('0x1e'),'accessToken':_0xca8e20});_0x2a258c['profile']['name']=_0x153acf[a1_0x2571('0x20')][a1_0x2571('0x21')]+'\x20'+_0x153acf[a1_0x2571('0x20')][a1_0x2571('0x2c')];_0x2a258c[a1_0x2571('0x1f')]['gender']=_0x153acf[a1_0x2571('0x23')][a1_0x2571('0x22')];_0x2a258c['profile'][a1_0x2571('0x24')]=a1_0x2571('0x25')+_0x153acf['id']+'/picture?type=large';_0x2a258c['profile']['location']=_0x153acf[a1_0x2571('0x23')]['location']?_0x153acf[a1_0x2571('0x23')][a1_0x2571('0x2d')][a1_0x2571('0x20')]:'';_0x2a258c[a1_0x2571('0x27')](_0x1397fc=>{_0x40efc2(_0x1397fc,_0x2a258c);});}});});}}));exports['isAuthenticated']=(_0x142a3a,_0x449933,_0x3c2a97)=>{if(_0x142a3a[a1_0x2571('0x2e')]()){return _0x3c2a97();}_0x449933[a1_0x2571('0x2f')](a1_0x2571('0x30'));};exports[a1_0x2571('0x31')]=(_0x32e2a8,_0x5d44fc,_0x17adef)=>{const _0x264191=_0x32e2a8[a1_0x2571('0x32')]['split']('/')[a1_0x2571('0x33')](-0x1)[0x0];if(lodash_1[a1_0x2571('0x7')][a1_0x2571('0x34')](_0x32e2a8[a1_0x2571('0x1a')]['tokens'],{'kind':_0x264191})){_0x17adef();}else{_0x5d44fc[a1_0x2571('0x2f')](a1_0x2571('0x35')+_0x264191);}};