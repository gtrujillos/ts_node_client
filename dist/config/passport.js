var a1_0x1791=['gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','push','givenName','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser','findById','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','profile'];(function(_0x24203d,_0x2a9944){var _0x27ae73=function(_0x4f1366){while(--_0x4f1366){_0x24203d['push'](_0x24203d['shift']());}};_0x27ae73(++_0x2a9944);}(a1_0x1791,0x196));var a1_0x1132=function(_0x23d1eb,_0x33f365){_0x23d1eb=_0x23d1eb-0x0;var _0x2d6b3a=a1_0x1791[_0x23d1eb];return _0x2d6b3a;};'use strict';var __importDefault=this&&this[a1_0x1132('0x0')]||function(_0x3ddb3e){return _0x3ddb3e&&_0x3ddb3e['__esModule']?_0x3ddb3e:{'default':_0x3ddb3e};};Object[a1_0x1132('0x1')](exports,a1_0x1132('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x1132('0x3')));const passport_local_1=__importDefault(require(a1_0x1132('0x4')));const passport_facebook_1=__importDefault(require(a1_0x1132('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x1132('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x1132('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x1132('0x8')][a1_0x1132('0x7')];passport_1[a1_0x1132('0x8')][a1_0x1132('0x9')]((_0x5213ed,_0x40995a)=>{_0x40995a(undefined,_0x5213ed['id']);});passport_1['default'][a1_0x1132('0xa')]((_0x294166,_0xda4632)=>{User_1[a1_0x1132('0x8')][a1_0x1132('0xb')](_0x294166,(_0x2501e4,_0x2340b8)=>{_0xda4632(_0x2501e4,_0x2340b8);});});passport_1[a1_0x1132('0x8')]['use'](new LocalStrategy({'usernameField':a1_0x1132('0xc')},(_0x59c6e8,_0x28e12a,_0x5bff6c)=>{User_1['default'][a1_0x1132('0xd')]({'email':_0x59c6e8[a1_0x1132('0xe')]()},(_0x860c2c,_0x52d83e)=>{if(_0x860c2c){return _0x5bff6c(_0x860c2c);}if(!_0x52d83e){return _0x5bff6c(undefined,![],{'message':a1_0x1132('0xf')+_0x59c6e8+a1_0x1132('0x10')});}_0x52d83e[a1_0x1132('0x11')](_0x28e12a,(_0x860c2c,_0x600559)=>{if(_0x860c2c){return _0x5bff6c(_0x860c2c);}if(_0x600559){return _0x5bff6c(undefined,_0x52d83e);}return _0x5bff6c(undefined,![],{'message':a1_0x1132('0x12')});});});}));passport_1[a1_0x1132('0x8')][a1_0x1132('0x13')](new FacebookStrategy({'clientID':process['env'][a1_0x1132('0x14')],'clientSecret':process[a1_0x1132('0x15')][a1_0x1132('0x16')],'callbackURL':a1_0x1132('0x17'),'profileFields':[a1_0x1132('0x18'),a1_0x1132('0xc'),a1_0x1132('0x19'),'locale',a1_0x1132('0x1a')],'passReqToCallback':!![]},(_0x28e9c9,_0x2c9724,_0x283fc7,_0x3e9fc2,_0x3a4fdd)=>{if(_0x28e9c9[a1_0x1132('0x1b')]){User_1[a1_0x1132('0x8')][a1_0x1132('0xd')]({'facebook':_0x3e9fc2['id']},(_0x227e50,_0x2a0099)=>{if(_0x227e50){return _0x3a4fdd(_0x227e50);}if(_0x2a0099){_0x28e9c9[a1_0x1132('0x1c')](a1_0x1132('0x1d'),{'msg':a1_0x1132('0x1e')});_0x3a4fdd(_0x227e50);}else{User_1['default'][a1_0x1132('0xb')](_0x28e9c9[a1_0x1132('0x1b')]['id'],(_0x227e50,_0x55eca0)=>{if(_0x227e50){return _0x3a4fdd(_0x227e50);}_0x55eca0[a1_0x1132('0x1f')]=_0x3e9fc2['id'];_0x55eca0[a1_0x1132('0x20')]['push']({'kind':a1_0x1132('0x1f'),'accessToken':_0x2c9724});_0x55eca0[a1_0x1132('0x21')]['name']=_0x55eca0['profile']['name']||_0x3e9fc2[a1_0x1132('0x18')]['givenName']+'\x20'+_0x3e9fc2['name']['familyName'];_0x55eca0[a1_0x1132('0x21')][a1_0x1132('0x22')]=_0x55eca0[a1_0x1132('0x21')][a1_0x1132('0x22')]||_0x3e9fc2[a1_0x1132('0x23')][a1_0x1132('0x22')];_0x55eca0['profile'][a1_0x1132('0x24')]=_0x55eca0[a1_0x1132('0x21')]['picture']||a1_0x1132('0x25')+_0x3e9fc2['id']+a1_0x1132('0x26');_0x55eca0[a1_0x1132('0x27')](_0x227e50=>{_0x28e9c9['flash'](a1_0x1132('0x28'),{'msg':a1_0x1132('0x29')});_0x3a4fdd(_0x227e50,_0x55eca0);});});}});}else{User_1[a1_0x1132('0x8')]['findOne']({'facebook':_0x3e9fc2['id']},(_0x13eaaf,_0x13a3c0)=>{if(_0x13eaaf){return _0x3a4fdd(_0x13eaaf);}if(_0x13a3c0){return _0x3a4fdd(undefined,_0x13a3c0);}User_1[a1_0x1132('0x8')]['findOne']({'email':_0x3e9fc2[a1_0x1132('0x23')][a1_0x1132('0xc')]},(_0x13eaaf,_0x1aab15)=>{if(_0x13eaaf){return _0x3a4fdd(_0x13eaaf);}if(_0x1aab15){_0x28e9c9[a1_0x1132('0x1c')]('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x3a4fdd(_0x13eaaf);}else{const _0x4bc2f2=new User_1['default']();_0x4bc2f2['email']=_0x3e9fc2['_json'][a1_0x1132('0xc')];_0x4bc2f2[a1_0x1132('0x1f')]=_0x3e9fc2['id'];_0x4bc2f2[a1_0x1132('0x20')][a1_0x1132('0x2a')]({'kind':'facebook','accessToken':_0x2c9724});_0x4bc2f2[a1_0x1132('0x21')][a1_0x1132('0x18')]=_0x3e9fc2[a1_0x1132('0x18')][a1_0x1132('0x2b')]+'\x20'+_0x3e9fc2['name'][a1_0x1132('0x2c')];_0x4bc2f2[a1_0x1132('0x21')][a1_0x1132('0x22')]=_0x3e9fc2['_json'][a1_0x1132('0x22')];_0x4bc2f2[a1_0x1132('0x21')][a1_0x1132('0x24')]=a1_0x1132('0x25')+_0x3e9fc2['id']+a1_0x1132('0x26');_0x4bc2f2[a1_0x1132('0x21')][a1_0x1132('0x2d')]=_0x3e9fc2[a1_0x1132('0x23')][a1_0x1132('0x2d')]?_0x3e9fc2[a1_0x1132('0x23')][a1_0x1132('0x2d')][a1_0x1132('0x18')]:'';_0x4bc2f2['save'](_0x13eaaf=>{_0x3a4fdd(_0x13eaaf,_0x4bc2f2);});}});});}}));exports[a1_0x1132('0x2e')]=(_0x1e76db,_0x579b87,_0x559391)=>{if(_0x1e76db['isAuthenticated']()){return _0x559391();}_0x579b87[a1_0x1132('0x2f')](a1_0x1132('0x30'));};exports[a1_0x1132('0x31')]=(_0x3e3fd8,_0x4c2d26,_0x1b0eea)=>{const _0x47f53a=_0x3e3fd8[a1_0x1132('0x32')][a1_0x1132('0x33')]('/')[a1_0x1132('0x34')](-0x1)[0x0];if(lodash_1[a1_0x1132('0x8')][a1_0x1132('0x35')](_0x3e3fd8[a1_0x1132('0x1b')][a1_0x1132('0x20')],{'kind':_0x47f53a})){_0x1b0eea();}else{_0x4c2d26['redirect'](a1_0x1132('0x36')+_0x47f53a);}};