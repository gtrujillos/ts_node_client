var a1_0x570d=['profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','/auth/','defineProperty','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','facebook','tokens','push'];(function(_0xb479be,_0x4bb6ab){var _0x44c2ed=function(_0x39774b){while(--_0x39774b){_0xb479be['push'](_0xb479be['shift']());}};_0x44c2ed(++_0x4bb6ab);}(a1_0x570d,0x1ce));var a1_0x38dc=function(_0x235076,_0x252b47){_0x235076=_0x235076-0x0;var _0x4bc6ad=a1_0x570d[_0x235076];return _0x4bc6ad;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5ef6ce){return _0x5ef6ce&&_0x5ef6ce['__esModule']?_0x5ef6ce:{'default':_0x5ef6ce};};Object[a1_0x38dc('0x0')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x38dc('0x1')));const lodash_1=__importDefault(require(a1_0x38dc('0x2')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x38dc('0x3')][a1_0x38dc('0x4')];const FacebookStrategy=passport_facebook_1[a1_0x38dc('0x3')][a1_0x38dc('0x4')];passport_1[a1_0x38dc('0x3')][a1_0x38dc('0x5')]((_0x2b037c,_0x496ed4)=>{_0x496ed4(undefined,_0x2b037c['id']);});passport_1[a1_0x38dc('0x3')][a1_0x38dc('0x6')]((_0x423faf,_0x2e82fd)=>{User_1[a1_0x38dc('0x3')][a1_0x38dc('0x7')](_0x423faf,(_0x376e2b,_0x2879cf)=>{_0x2e82fd(_0x376e2b,_0x2879cf);});});passport_1[a1_0x38dc('0x3')][a1_0x38dc('0x8')](new LocalStrategy({'usernameField':a1_0x38dc('0x9')},(_0x14aa09,_0x2f3104,_0x2268df)=>{User_1['default'][a1_0x38dc('0xa')]({'email':_0x14aa09['toLowerCase']()},(_0x2d3593,_0x3207ba)=>{if(_0x2d3593){return _0x2268df(_0x2d3593);}if(!_0x3207ba){return _0x2268df(undefined,![],{'message':a1_0x38dc('0xb')+_0x14aa09+'\x20not\x20found.'});}_0x3207ba[a1_0x38dc('0xc')](_0x2f3104,(_0x2d3593,_0x318a6f)=>{if(_0x2d3593){return _0x2268df(_0x2d3593);}if(_0x318a6f){return _0x2268df(undefined,_0x3207ba);}return _0x2268df(undefined,![],{'message':a1_0x38dc('0xd')});});});}));passport_1[a1_0x38dc('0x3')]['use'](new FacebookStrategy({'clientID':process[a1_0x38dc('0xe')][a1_0x38dc('0xf')],'clientSecret':process[a1_0x38dc('0xe')][a1_0x38dc('0x10')],'callbackURL':a1_0x38dc('0x11'),'profileFields':[a1_0x38dc('0x12'),'email',a1_0x38dc('0x13'),a1_0x38dc('0x14'),a1_0x38dc('0x15')],'passReqToCallback':!![]},(_0x5cbe91,_0x34352c,_0x517080,_0x515330,_0x55ca87)=>{if(_0x5cbe91[a1_0x38dc('0x16')]){User_1['default'][a1_0x38dc('0xa')]({'facebook':_0x515330['id']},(_0x573b19,_0x2bea83)=>{if(_0x573b19){return _0x55ca87(_0x573b19);}if(_0x2bea83){_0x5cbe91[a1_0x38dc('0x17')](a1_0x38dc('0x18'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x55ca87(_0x573b19);}else{User_1['default']['findById'](_0x5cbe91[a1_0x38dc('0x16')]['id'],(_0x573b19,_0x547c12)=>{if(_0x573b19){return _0x55ca87(_0x573b19);}_0x547c12[a1_0x38dc('0x19')]=_0x515330['id'];_0x547c12[a1_0x38dc('0x1a')][a1_0x38dc('0x1b')]({'kind':a1_0x38dc('0x19'),'accessToken':_0x34352c});_0x547c12[a1_0x38dc('0x1c')][a1_0x38dc('0x12')]=_0x547c12[a1_0x38dc('0x1c')][a1_0x38dc('0x12')]||_0x515330['name'][a1_0x38dc('0x1d')]+'\x20'+_0x515330[a1_0x38dc('0x12')][a1_0x38dc('0x1e')];_0x547c12[a1_0x38dc('0x1c')]['gender']=_0x547c12['profile'][a1_0x38dc('0x1f')]||_0x515330['_json'][a1_0x38dc('0x1f')];_0x547c12['profile'][a1_0x38dc('0x20')]=_0x547c12[a1_0x38dc('0x1c')][a1_0x38dc('0x20')]||a1_0x38dc('0x21')+_0x515330['id']+a1_0x38dc('0x22');_0x547c12[a1_0x38dc('0x23')](_0x573b19=>{_0x5cbe91[a1_0x38dc('0x17')](a1_0x38dc('0x24'),{'msg':a1_0x38dc('0x25')});_0x55ca87(_0x573b19,_0x547c12);});});}});}else{User_1[a1_0x38dc('0x3')][a1_0x38dc('0xa')]({'facebook':_0x515330['id']},(_0x210b70,_0x30d3d7)=>{if(_0x210b70){return _0x55ca87(_0x210b70);}if(_0x30d3d7){return _0x55ca87(undefined,_0x30d3d7);}User_1[a1_0x38dc('0x3')][a1_0x38dc('0xa')]({'email':_0x515330[a1_0x38dc('0x26')][a1_0x38dc('0x9')]},(_0x210b70,_0x534ecc)=>{if(_0x210b70){return _0x55ca87(_0x210b70);}if(_0x534ecc){_0x5cbe91[a1_0x38dc('0x17')](a1_0x38dc('0x18'),{'msg':a1_0x38dc('0x27')});_0x55ca87(_0x210b70);}else{const _0xb2467e=new User_1['default']();_0xb2467e[a1_0x38dc('0x9')]=_0x515330['_json']['email'];_0xb2467e[a1_0x38dc('0x19')]=_0x515330['id'];_0xb2467e[a1_0x38dc('0x1a')][a1_0x38dc('0x1b')]({'kind':'facebook','accessToken':_0x34352c});_0xb2467e[a1_0x38dc('0x1c')]['name']=_0x515330[a1_0x38dc('0x12')]['givenName']+'\x20'+_0x515330[a1_0x38dc('0x12')][a1_0x38dc('0x1e')];_0xb2467e[a1_0x38dc('0x1c')]['gender']=_0x515330[a1_0x38dc('0x26')][a1_0x38dc('0x1f')];_0xb2467e[a1_0x38dc('0x1c')]['picture']=a1_0x38dc('0x21')+_0x515330['id']+a1_0x38dc('0x22');_0xb2467e['profile']['location']=_0x515330[a1_0x38dc('0x26')][a1_0x38dc('0x28')]?_0x515330[a1_0x38dc('0x26')][a1_0x38dc('0x28')][a1_0x38dc('0x12')]:'';_0xb2467e['save'](_0x210b70=>{_0x55ca87(_0x210b70,_0xb2467e);});}});});}}));exports[a1_0x38dc('0x29')]=(_0x285eb4,_0x3de344,_0x5ca7d2)=>{if(_0x285eb4[a1_0x38dc('0x29')]()){return _0x5ca7d2();}_0x3de344[a1_0x38dc('0x2a')](a1_0x38dc('0x2b'));};exports[a1_0x38dc('0x2c')]=(_0x1d7459,_0x21db81,_0x4b60cf)=>{const _0x5ebce4=_0x1d7459[a1_0x38dc('0x2d')][a1_0x38dc('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x38dc('0x2f')](_0x1d7459['user'][a1_0x38dc('0x1a')],{'kind':_0x5ebce4})){_0x4b60cf();}else{_0x21db81[a1_0x38dc('0x2a')](a1_0x38dc('0x30')+_0x5ebce4);}};