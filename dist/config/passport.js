var a1_0x31be=['findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','push','facebook','profile','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','tokens','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__esModule','defineProperty','passport-local','../models/User','default','Strategy','serializeUser','deserializeUser','email'];(function(_0x3ecfc2,_0x2a485c){var _0x2ebafb=function(_0x47eb28){while(--_0x47eb28){_0x3ecfc2['push'](_0x3ecfc2['shift']());}};_0x2ebafb(++_0x2a485c);}(a1_0x31be,0x18f));var a1_0x1fb4=function(_0x12c1ef,_0x52902b){_0x12c1ef=_0x12c1ef-0x0;var _0x4e2f48=a1_0x31be[_0x12c1ef];return _0x4e2f48;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0xac9f2c){return _0xac9f2c&&_0xac9f2c[a1_0x1fb4('0x0')]?_0xac9f2c:{'default':_0xac9f2c};};Object[a1_0x1fb4('0x1')](exports,a1_0x1fb4('0x0'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x1fb4('0x2')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x1fb4('0x3')));const LocalStrategy=passport_local_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x5')];const FacebookStrategy=passport_facebook_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x5')];passport_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x6')]((_0x28ebc7,_0x41a7ec)=>{_0x41a7ec(undefined,_0x28ebc7['id']);});passport_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x7')]((_0x36729e,_0x2e2f81)=>{User_1[a1_0x1fb4('0x4')]['findById'](_0x36729e,(_0x388df8,_0x4c8a47)=>{_0x2e2f81(_0x388df8,_0x4c8a47);});});passport_1[a1_0x1fb4('0x4')]['use'](new LocalStrategy({'usernameField':a1_0x1fb4('0x8')},(_0x21d71f,_0x253d51,_0x589a17)=>{User_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x9')]({'email':_0x21d71f[a1_0x1fb4('0xa')]()},(_0x3c4e2a,_0x126ba7)=>{if(_0x3c4e2a){return _0x589a17(_0x3c4e2a);}if(!_0x126ba7){return _0x589a17(undefined,![],{'message':a1_0x1fb4('0xb')+_0x21d71f+a1_0x1fb4('0xc')});}_0x126ba7[a1_0x1fb4('0xd')](_0x253d51,(_0x3c4e2a,_0x415386)=>{if(_0x3c4e2a){return _0x589a17(_0x3c4e2a);}if(_0x415386){return _0x589a17(undefined,_0x126ba7);}return _0x589a17(undefined,![],{'message':a1_0x1fb4('0xe')});});});}));passport_1[a1_0x1fb4('0x4')][a1_0x1fb4('0xf')](new FacebookStrategy({'clientID':process[a1_0x1fb4('0x10')]['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x1fb4('0x11')],'callbackURL':a1_0x1fb4('0x12'),'profileFields':[a1_0x1fb4('0x13'),a1_0x1fb4('0x8'),a1_0x1fb4('0x14'),'locale',a1_0x1fb4('0x15')],'passReqToCallback':!![]},(_0x4ce9ff,_0x3b3985,_0x4652c6,_0x2220b8,_0x5d81df)=>{if(_0x4ce9ff[a1_0x1fb4('0x16')]){User_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x9')]({'facebook':_0x2220b8['id']},(_0x4d2851,_0x123758)=>{if(_0x4d2851){return _0x5d81df(_0x4d2851);}if(_0x123758){_0x4ce9ff[a1_0x1fb4('0x17')](a1_0x1fb4('0x18'),{'msg':a1_0x1fb4('0x19')});_0x5d81df(_0x4d2851);}else{User_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x1a')](_0x4ce9ff['user']['id'],(_0x4d2851,_0x276855)=>{if(_0x4d2851){return _0x5d81df(_0x4d2851);}_0x276855['facebook']=_0x2220b8['id'];_0x276855['tokens'][a1_0x1fb4('0x1b')]({'kind':a1_0x1fb4('0x1c'),'accessToken':_0x3b3985});_0x276855['profile'][a1_0x1fb4('0x13')]=_0x276855[a1_0x1fb4('0x1d')][a1_0x1fb4('0x13')]||_0x2220b8[a1_0x1fb4('0x13')][a1_0x1fb4('0x1e')]+'\x20'+_0x2220b8[a1_0x1fb4('0x13')]['familyName'];_0x276855['profile'][a1_0x1fb4('0x1f')]=_0x276855['profile']['gender']||_0x2220b8[a1_0x1fb4('0x20')][a1_0x1fb4('0x1f')];_0x276855[a1_0x1fb4('0x1d')][a1_0x1fb4('0x21')]=_0x276855[a1_0x1fb4('0x1d')][a1_0x1fb4('0x21')]||a1_0x1fb4('0x22')+_0x2220b8['id']+a1_0x1fb4('0x23');_0x276855[a1_0x1fb4('0x24')](_0x4d2851=>{_0x4ce9ff['flash'](a1_0x1fb4('0x25'),{'msg':a1_0x1fb4('0x26')});_0x5d81df(_0x4d2851,_0x276855);});});}});}else{User_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x9')]({'facebook':_0x2220b8['id']},(_0x59b131,_0xc65739)=>{if(_0x59b131){return _0x5d81df(_0x59b131);}if(_0xc65739){return _0x5d81df(undefined,_0xc65739);}User_1['default'][a1_0x1fb4('0x9')]({'email':_0x2220b8[a1_0x1fb4('0x20')][a1_0x1fb4('0x8')]},(_0x59b131,_0x52943c)=>{if(_0x59b131){return _0x5d81df(_0x59b131);}if(_0x52943c){_0x4ce9ff['flash'](a1_0x1fb4('0x18'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x5d81df(_0x59b131);}else{const _0x107b71=new User_1[(a1_0x1fb4('0x4'))]();_0x107b71[a1_0x1fb4('0x8')]=_0x2220b8[a1_0x1fb4('0x20')]['email'];_0x107b71[a1_0x1fb4('0x1c')]=_0x2220b8['id'];_0x107b71[a1_0x1fb4('0x27')][a1_0x1fb4('0x1b')]({'kind':a1_0x1fb4('0x1c'),'accessToken':_0x3b3985});_0x107b71[a1_0x1fb4('0x1d')]['name']=_0x2220b8[a1_0x1fb4('0x13')][a1_0x1fb4('0x1e')]+'\x20'+_0x2220b8[a1_0x1fb4('0x13')][a1_0x1fb4('0x28')];_0x107b71[a1_0x1fb4('0x1d')][a1_0x1fb4('0x1f')]=_0x2220b8[a1_0x1fb4('0x20')][a1_0x1fb4('0x1f')];_0x107b71[a1_0x1fb4('0x1d')][a1_0x1fb4('0x21')]=a1_0x1fb4('0x22')+_0x2220b8['id']+a1_0x1fb4('0x23');_0x107b71[a1_0x1fb4('0x1d')]['location']=_0x2220b8[a1_0x1fb4('0x20')][a1_0x1fb4('0x29')]?_0x2220b8[a1_0x1fb4('0x20')]['location'][a1_0x1fb4('0x13')]:'';_0x107b71['save'](_0x59b131=>{_0x5d81df(_0x59b131,_0x107b71);});}});});}}));exports[a1_0x1fb4('0x2a')]=(_0x22c2e2,_0xb7b35d,_0x4ff42e)=>{if(_0x22c2e2[a1_0x1fb4('0x2a')]()){return _0x4ff42e();}_0xb7b35d[a1_0x1fb4('0x2b')](a1_0x1fb4('0x2c'));};exports[a1_0x1fb4('0x2d')]=(_0x3ac37e,_0x4f68c4,_0x2b41e3)=>{const _0x228662=_0x3ac37e[a1_0x1fb4('0x2e')][a1_0x1fb4('0x2f')]('/')[a1_0x1fb4('0x30')](-0x1)[0x0];if(lodash_1[a1_0x1fb4('0x4')][a1_0x1fb4('0x31')](_0x3ac37e['user'][a1_0x1fb4('0x27')],{'kind':_0x228662})){_0x2b41e3();}else{_0x4f68c4[a1_0x1fb4('0x2b')](a1_0x1fb4('0x32')+_0x228662);}};