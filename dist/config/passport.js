var a1_0x3fa8=['__importDefault','__esModule','passport','passport-local','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','findOne','toLowerCase','\x20not\x20found.','env','FACEBOOK_SECRET','/auth/facebook/callback','link','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','name','familyName','gender','_json','picture','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','email','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','save','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','/auth/'];(function(_0x4bd822,_0x2bd6f7){var _0xb4bdb3=function(_0x1d68f6){while(--_0x1d68f6){_0x4bd822['push'](_0x4bd822['shift']());}};_0xb4bdb3(++_0x2bd6f7);}(a1_0x3fa8,0x188));var a1_0x1b31=function(_0x4d365f,_0xba04b6){_0x4d365f=_0x4d365f-0x0;var _0x2ba26d=a1_0x3fa8[_0x4d365f];return _0x2ba26d;};'use strict';var __importDefault=this&&this[a1_0x1b31('0x0')]||function(_0x501c9d){return _0x501c9d&&_0x501c9d[a1_0x1b31('0x1')]?_0x501c9d:{'default':_0x501c9d};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x1b31('0x2')));const passport_local_1=__importDefault(require(a1_0x1b31('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x1b31('0x4')));const User_1=__importDefault(require(a1_0x1b31('0x5')));const LocalStrategy=passport_local_1[a1_0x1b31('0x6')][a1_0x1b31('0x7')];const FacebookStrategy=passport_facebook_1['default'][a1_0x1b31('0x7')];passport_1['default'][a1_0x1b31('0x8')]((_0x575665,_0x3ddcff)=>{_0x3ddcff(undefined,_0x575665['id']);});passport_1[a1_0x1b31('0x6')][a1_0x1b31('0x9')]((_0x4246ad,_0x151ca4)=>{User_1['default'][a1_0x1b31('0xa')](_0x4246ad,(_0x2910f3,_0x583f9e)=>{_0x151ca4(_0x2910f3,_0x583f9e);});});passport_1[a1_0x1b31('0x6')][a1_0x1b31('0xb')](new LocalStrategy({'usernameField':'email'},(_0x35d240,_0x842e88,_0x468133)=>{User_1[a1_0x1b31('0x6')][a1_0x1b31('0xc')]({'email':_0x35d240[a1_0x1b31('0xd')]()},(_0x178203,_0x3e6c8e)=>{if(_0x178203){return _0x468133(_0x178203);}if(!_0x3e6c8e){return _0x468133(undefined,![],{'message':'Email\x20'+_0x35d240+a1_0x1b31('0xe')});}_0x3e6c8e['comparePassword'](_0x842e88,(_0x178203,_0x9cb149)=>{if(_0x178203){return _0x468133(_0x178203);}if(_0x9cb149){return _0x468133(undefined,_0x3e6c8e);}return _0x468133(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x1b31('0x6')][a1_0x1b31('0xb')](new FacebookStrategy({'clientID':process[a1_0x1b31('0xf')]['FACEBOOK_ID'],'clientSecret':process[a1_0x1b31('0xf')][a1_0x1b31('0x10')],'callbackURL':a1_0x1b31('0x11'),'profileFields':['name','email',a1_0x1b31('0x12'),'locale',a1_0x1b31('0x13')],'passReqToCallback':!![]},(_0xa26b4d,_0x5a22aa,_0x4a7a18,_0x27afcb,_0x12df20)=>{if(_0xa26b4d[a1_0x1b31('0x14')]){User_1[a1_0x1b31('0x6')]['findOne']({'facebook':_0x27afcb['id']},(_0x39cca9,_0x10da60)=>{if(_0x39cca9){return _0x12df20(_0x39cca9);}if(_0x10da60){_0xa26b4d[a1_0x1b31('0x15')](a1_0x1b31('0x16'),{'msg':a1_0x1b31('0x17')});_0x12df20(_0x39cca9);}else{User_1[a1_0x1b31('0x6')][a1_0x1b31('0xa')](_0xa26b4d['user']['id'],(_0x39cca9,_0x265d97)=>{if(_0x39cca9){return _0x12df20(_0x39cca9);}_0x265d97[a1_0x1b31('0x18')]=_0x27afcb['id'];_0x265d97[a1_0x1b31('0x19')][a1_0x1b31('0x1a')]({'kind':'facebook','accessToken':_0x5a22aa});_0x265d97[a1_0x1b31('0x1b')][a1_0x1b31('0x1c')]=_0x265d97[a1_0x1b31('0x1b')][a1_0x1b31('0x1c')]||_0x27afcb[a1_0x1b31('0x1c')]['givenName']+'\x20'+_0x27afcb[a1_0x1b31('0x1c')][a1_0x1b31('0x1d')];_0x265d97[a1_0x1b31('0x1b')][a1_0x1b31('0x1e')]=_0x265d97[a1_0x1b31('0x1b')]['gender']||_0x27afcb[a1_0x1b31('0x1f')][a1_0x1b31('0x1e')];_0x265d97[a1_0x1b31('0x1b')][a1_0x1b31('0x20')]=_0x265d97[a1_0x1b31('0x1b')]['picture']||'https://graph.facebook.com/'+_0x27afcb['id']+a1_0x1b31('0x21');_0x265d97['save'](_0x39cca9=>{_0xa26b4d[a1_0x1b31('0x15')](a1_0x1b31('0x22'),{'msg':a1_0x1b31('0x23')});_0x12df20(_0x39cca9,_0x265d97);});});}});}else{User_1[a1_0x1b31('0x6')][a1_0x1b31('0xc')]({'facebook':_0x27afcb['id']},(_0x19b264,_0xa3ddfe)=>{if(_0x19b264){return _0x12df20(_0x19b264);}if(_0xa3ddfe){return _0x12df20(undefined,_0xa3ddfe);}User_1[a1_0x1b31('0x6')][a1_0x1b31('0xc')]({'email':_0x27afcb['_json'][a1_0x1b31('0x24')]},(_0x19b264,_0x31eed1)=>{if(_0x19b264){return _0x12df20(_0x19b264);}if(_0x31eed1){_0xa26b4d[a1_0x1b31('0x15')](a1_0x1b31('0x16'),{'msg':a1_0x1b31('0x25')});_0x12df20(_0x19b264);}else{const _0x203d58=new User_1[(a1_0x1b31('0x6'))]();_0x203d58[a1_0x1b31('0x24')]=_0x27afcb[a1_0x1b31('0x1f')]['email'];_0x203d58[a1_0x1b31('0x18')]=_0x27afcb['id'];_0x203d58['tokens']['push']({'kind':'facebook','accessToken':_0x5a22aa});_0x203d58['profile']['name']=_0x27afcb[a1_0x1b31('0x1c')]['givenName']+'\x20'+_0x27afcb[a1_0x1b31('0x1c')][a1_0x1b31('0x1d')];_0x203d58[a1_0x1b31('0x1b')][a1_0x1b31('0x1e')]=_0x27afcb[a1_0x1b31('0x1f')][a1_0x1b31('0x1e')];_0x203d58[a1_0x1b31('0x1b')][a1_0x1b31('0x20')]=a1_0x1b31('0x26')+_0x27afcb['id']+a1_0x1b31('0x21');_0x203d58[a1_0x1b31('0x1b')][a1_0x1b31('0x27')]=_0x27afcb[a1_0x1b31('0x1f')][a1_0x1b31('0x27')]?_0x27afcb[a1_0x1b31('0x1f')][a1_0x1b31('0x27')][a1_0x1b31('0x1c')]:'';_0x203d58[a1_0x1b31('0x28')](_0x19b264=>{_0x12df20(_0x19b264,_0x203d58);});}});});}}));exports[a1_0x1b31('0x29')]=(_0x557bd2,_0x553138,_0x3b61dc)=>{if(_0x557bd2['isAuthenticated']()){return _0x3b61dc();}_0x553138[a1_0x1b31('0x2a')](a1_0x1b31('0x2b'));};exports[a1_0x1b31('0x2c')]=(_0x5b508e,_0x10c0c5,_0x1a64c8)=>{const _0x2a294e=_0x5b508e[a1_0x1b31('0x2d')][a1_0x1b31('0x2e')]('/')[a1_0x1b31('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x1b31('0x6')]['find'](_0x5b508e[a1_0x1b31('0x14')][a1_0x1b31('0x19')],{'kind':_0x2a294e})){_0x1a64c8();}else{_0x10c0c5['redirect'](a1_0x1b31('0x30')+_0x2a294e);}};