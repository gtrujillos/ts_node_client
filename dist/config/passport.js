var a1_0x9e25=['findById','email','Email\x20','\x20not\x20found.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','link','timezone','user','findOne','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','name','profile','givenName','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','errors','familyName','gender','location','isAuthenticated','redirect','/login','isAuthorized','path','slice','/auth/','__importDefault','defineProperty','passport-local','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser'];(function(_0x59a31e,_0x1739dc){var _0x4e3536=function(_0x26ca57){while(--_0x26ca57){_0x59a31e['push'](_0x59a31e['shift']());}};_0x4e3536(++_0x1739dc);}(a1_0x9e25,0xaf));var a1_0x12f3=function(_0x47b1da,_0x387305){_0x47b1da=_0x47b1da-0x0;var _0x5b927a=a1_0x9e25[_0x47b1da];return _0x5b927a;};'use strict';var __importDefault=this&&this[a1_0x12f3('0x0')]||function(_0x25ec47){return _0x25ec47&&_0x25ec47['__esModule']?_0x25ec47:{'default':_0x25ec47};};Object[a1_0x12f3('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x12f3('0x2')));const passport_facebook_1=__importDefault(require(a1_0x12f3('0x3')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x12f3('0x4')));const LocalStrategy=passport_local_1['default'][a1_0x12f3('0x5')];const FacebookStrategy=passport_facebook_1[a1_0x12f3('0x6')]['Strategy'];passport_1[a1_0x12f3('0x6')][a1_0x12f3('0x7')]((_0x41fcd8,_0x32b201)=>{_0x32b201(undefined,_0x41fcd8['id']);});passport_1[a1_0x12f3('0x6')][a1_0x12f3('0x8')]((_0x23e89c,_0x59cbc8)=>{User_1[a1_0x12f3('0x6')][a1_0x12f3('0x9')](_0x23e89c,(_0x2e6d5e,_0x1da8af)=>{_0x59cbc8(_0x2e6d5e,_0x1da8af);});});passport_1[a1_0x12f3('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x12f3('0xa')},(_0x5cb47d,_0x18500c,_0x3fd94f)=>{User_1[a1_0x12f3('0x6')]['findOne']({'email':_0x5cb47d['toLowerCase']()},(_0x9a40a1,_0x20b9bb)=>{if(_0x9a40a1){return _0x3fd94f(_0x9a40a1);}if(!_0x20b9bb){return _0x3fd94f(undefined,![],{'message':a1_0x12f3('0xb')+_0x5cb47d+a1_0x12f3('0xc')});}_0x20b9bb['comparePassword'](_0x18500c,(_0x9a40a1,_0x324891)=>{if(_0x9a40a1){return _0x3fd94f(_0x9a40a1);}if(_0x324891){return _0x3fd94f(undefined,_0x20b9bb);}return _0x3fd94f(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x12f3('0x6')][a1_0x12f3('0xd')](new FacebookStrategy({'clientID':process[a1_0x12f3('0xe')][a1_0x12f3('0xf')],'clientSecret':process[a1_0x12f3('0xe')][a1_0x12f3('0x10')],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x12f3('0xa'),a1_0x12f3('0x11'),'locale',a1_0x12f3('0x12')],'passReqToCallback':!![]},(_0x4773fc,_0x78760e,_0x4e5339,_0x3520d8,_0x46f0c5)=>{if(_0x4773fc[a1_0x12f3('0x13')]){User_1[a1_0x12f3('0x6')][a1_0x12f3('0x14')]({'facebook':_0x3520d8['id']},(_0x461c76,_0x2bf63b)=>{if(_0x461c76){return _0x46f0c5(_0x461c76);}if(_0x2bf63b){_0x4773fc[a1_0x12f3('0x15')]('errors',{'msg':a1_0x12f3('0x16')});_0x46f0c5(_0x461c76);}else{User_1[a1_0x12f3('0x6')][a1_0x12f3('0x9')](_0x4773fc[a1_0x12f3('0x13')]['id'],(_0x461c76,_0x38bc83)=>{if(_0x461c76){return _0x46f0c5(_0x461c76);}_0x38bc83[a1_0x12f3('0x17')]=_0x3520d8['id'];_0x38bc83[a1_0x12f3('0x18')][a1_0x12f3('0x19')]({'kind':'facebook','accessToken':_0x78760e});_0x38bc83['profile'][a1_0x12f3('0x1a')]=_0x38bc83[a1_0x12f3('0x1b')][a1_0x12f3('0x1a')]||_0x3520d8[a1_0x12f3('0x1a')][a1_0x12f3('0x1c')]+'\x20'+_0x3520d8[a1_0x12f3('0x1a')]['familyName'];_0x38bc83[a1_0x12f3('0x1b')]['gender']=_0x38bc83[a1_0x12f3('0x1b')]['gender']||_0x3520d8[a1_0x12f3('0x1d')]['gender'];_0x38bc83[a1_0x12f3('0x1b')][a1_0x12f3('0x1e')]=_0x38bc83['profile']['picture']||a1_0x12f3('0x1f')+_0x3520d8['id']+a1_0x12f3('0x20');_0x38bc83[a1_0x12f3('0x21')](_0x461c76=>{_0x4773fc[a1_0x12f3('0x15')](a1_0x12f3('0x22'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x46f0c5(_0x461c76,_0x38bc83);});});}});}else{User_1[a1_0x12f3('0x6')][a1_0x12f3('0x14')]({'facebook':_0x3520d8['id']},(_0x1c88a1,_0x20d208)=>{if(_0x1c88a1){return _0x46f0c5(_0x1c88a1);}if(_0x20d208){return _0x46f0c5(undefined,_0x20d208);}User_1[a1_0x12f3('0x6')][a1_0x12f3('0x14')]({'email':_0x3520d8['_json']['email']},(_0x1c88a1,_0x43681b)=>{if(_0x1c88a1){return _0x46f0c5(_0x1c88a1);}if(_0x43681b){_0x4773fc[a1_0x12f3('0x15')](a1_0x12f3('0x23'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x46f0c5(_0x1c88a1);}else{const _0x56122b=new User_1['default']();_0x56122b[a1_0x12f3('0xa')]=_0x3520d8[a1_0x12f3('0x1d')][a1_0x12f3('0xa')];_0x56122b[a1_0x12f3('0x17')]=_0x3520d8['id'];_0x56122b[a1_0x12f3('0x18')][a1_0x12f3('0x19')]({'kind':'facebook','accessToken':_0x78760e});_0x56122b[a1_0x12f3('0x1b')][a1_0x12f3('0x1a')]=_0x3520d8[a1_0x12f3('0x1a')][a1_0x12f3('0x1c')]+'\x20'+_0x3520d8[a1_0x12f3('0x1a')][a1_0x12f3('0x24')];_0x56122b['profile'][a1_0x12f3('0x25')]=_0x3520d8['_json'][a1_0x12f3('0x25')];_0x56122b[a1_0x12f3('0x1b')][a1_0x12f3('0x1e')]=a1_0x12f3('0x1f')+_0x3520d8['id']+a1_0x12f3('0x20');_0x56122b[a1_0x12f3('0x1b')][a1_0x12f3('0x26')]=_0x3520d8[a1_0x12f3('0x1d')]['location']?_0x3520d8[a1_0x12f3('0x1d')][a1_0x12f3('0x26')]['name']:'';_0x56122b['save'](_0x1c88a1=>{_0x46f0c5(_0x1c88a1,_0x56122b);});}});});}}));exports['isAuthenticated']=(_0x23f4fa,_0x2bf739,_0x53494f)=>{if(_0x23f4fa[a1_0x12f3('0x27')]()){return _0x53494f();}_0x2bf739[a1_0x12f3('0x28')](a1_0x12f3('0x29'));};exports[a1_0x12f3('0x2a')]=(_0x2ef089,_0x2b3467,_0x1a0dcb)=>{const _0x31b5c3=_0x2ef089[a1_0x12f3('0x2b')]['split']('/')[a1_0x12f3('0x2c')](-0x1)[0x0];if(lodash_1['default']['find'](_0x2ef089[a1_0x12f3('0x13')]['tokens'],{'kind':_0x31b5c3})){_0x1a0dcb();}else{_0x2b3467[a1_0x12f3('0x28')](a1_0x12f3('0x2d')+_0x31b5c3);}};