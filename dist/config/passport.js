var a1_0x303c=['push','profile','givenName','_json','gender','picture','https://graph.facebook.com/','save','info','Facebook\x20account\x20has\x20been\x20linked.','familyName','/picture?type=large','location','isAuthenticated','redirect','/login','path','split','find','/auth/','defineProperty','__esModule','passport','passport-local','passport-facebook','default','Strategy','serializeUser','deserializeUser','findById','use','email','toLowerCase','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','user','findOne','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens'];(function(_0x251558,_0x1bc028){var _0x57a3b5=function(_0x302214){while(--_0x302214){_0x251558['push'](_0x251558['shift']());}};_0x57a3b5(++_0x1bc028);}(a1_0x303c,0xd8));var a1_0x3f31=function(_0x320fe8,_0x2eb3c0){_0x320fe8=_0x320fe8-0x0;var _0x340067=a1_0x303c[_0x320fe8];return _0x340067;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x471848){return _0x471848&&_0x471848['__esModule']?_0x471848:{'default':_0x471848};};Object[a1_0x3f31('0x0')](exports,a1_0x3f31('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3f31('0x2')));const passport_local_1=__importDefault(require(a1_0x3f31('0x3')));const passport_facebook_1=__importDefault(require(a1_0x3f31('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x3f31('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x3f31('0x5')][a1_0x3f31('0x6')];passport_1[a1_0x3f31('0x5')][a1_0x3f31('0x7')]((_0x42abb4,_0x2d7777)=>{_0x2d7777(undefined,_0x42abb4['id']);});passport_1['default'][a1_0x3f31('0x8')]((_0x13c013,_0x3d85a2)=>{User_1[a1_0x3f31('0x5')][a1_0x3f31('0x9')](_0x13c013,(_0x249bd7,_0x1b00ec)=>{_0x3d85a2(_0x249bd7,_0x1b00ec);});});passport_1['default'][a1_0x3f31('0xa')](new LocalStrategy({'usernameField':a1_0x3f31('0xb')},(_0xdbc9e6,_0x3f927f,_0x5deb5b)=>{User_1['default']['findOne']({'email':_0xdbc9e6[a1_0x3f31('0xc')]()},(_0x290b01,_0x3517c8)=>{if(_0x290b01){return _0x5deb5b(_0x290b01);}if(!_0x3517c8){return _0x5deb5b(undefined,![],{'message':'Email\x20'+_0xdbc9e6+'\x20not\x20found.'});}_0x3517c8[a1_0x3f31('0xd')](_0x3f927f,(_0x290b01,_0x5d9e12)=>{if(_0x290b01){return _0x5deb5b(_0x290b01);}if(_0x5d9e12){return _0x5deb5b(undefined,_0x3517c8);}return _0x5deb5b(undefined,![],{'message':a1_0x3f31('0xe')});});});}));passport_1[a1_0x3f31('0x5')][a1_0x3f31('0xa')](new FacebookStrategy({'clientID':process[a1_0x3f31('0xf')][a1_0x3f31('0x10')],'clientSecret':process[a1_0x3f31('0xf')][a1_0x3f31('0x11')],'callbackURL':a1_0x3f31('0x12'),'profileFields':[a1_0x3f31('0x13'),a1_0x3f31('0xb'),a1_0x3f31('0x14'),a1_0x3f31('0x15'),'timezone'],'passReqToCallback':!![]},(_0x4ff34f,_0x54a370,_0x148b64,_0x4faebb,_0x5b1410)=>{if(_0x4ff34f[a1_0x3f31('0x16')]){User_1[a1_0x3f31('0x5')][a1_0x3f31('0x17')]({'facebook':_0x4faebb['id']},(_0x120cb7,_0x9960ac)=>{if(_0x120cb7){return _0x5b1410(_0x120cb7);}if(_0x9960ac){_0x4ff34f[a1_0x3f31('0x18')](a1_0x3f31('0x19'),{'msg':a1_0x3f31('0x1a')});_0x5b1410(_0x120cb7);}else{User_1[a1_0x3f31('0x5')][a1_0x3f31('0x9')](_0x4ff34f[a1_0x3f31('0x16')]['id'],(_0x120cb7,_0x4b4f69)=>{if(_0x120cb7){return _0x5b1410(_0x120cb7);}_0x4b4f69[a1_0x3f31('0x1b')]=_0x4faebb['id'];_0x4b4f69[a1_0x3f31('0x1c')][a1_0x3f31('0x1d')]({'kind':a1_0x3f31('0x1b'),'accessToken':_0x54a370});_0x4b4f69['profile']['name']=_0x4b4f69[a1_0x3f31('0x1e')][a1_0x3f31('0x13')]||_0x4faebb['name'][a1_0x3f31('0x1f')]+'\x20'+_0x4faebb['name']['familyName'];_0x4b4f69[a1_0x3f31('0x1e')]['gender']=_0x4b4f69[a1_0x3f31('0x1e')]['gender']||_0x4faebb[a1_0x3f31('0x20')][a1_0x3f31('0x21')];_0x4b4f69[a1_0x3f31('0x1e')][a1_0x3f31('0x22')]=_0x4b4f69[a1_0x3f31('0x1e')]['picture']||a1_0x3f31('0x23')+_0x4faebb['id']+'/picture?type=large';_0x4b4f69[a1_0x3f31('0x24')](_0x120cb7=>{_0x4ff34f[a1_0x3f31('0x18')](a1_0x3f31('0x25'),{'msg':a1_0x3f31('0x26')});_0x5b1410(_0x120cb7,_0x4b4f69);});});}});}else{User_1[a1_0x3f31('0x5')][a1_0x3f31('0x17')]({'facebook':_0x4faebb['id']},(_0x411e25,_0x5ec07a)=>{if(_0x411e25){return _0x5b1410(_0x411e25);}if(_0x5ec07a){return _0x5b1410(undefined,_0x5ec07a);}User_1[a1_0x3f31('0x5')][a1_0x3f31('0x17')]({'email':_0x4faebb[a1_0x3f31('0x20')][a1_0x3f31('0xb')]},(_0x411e25,_0x42a6ed)=>{if(_0x411e25){return _0x5b1410(_0x411e25);}if(_0x42a6ed){_0x4ff34f[a1_0x3f31('0x18')]('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x5b1410(_0x411e25);}else{const _0x2b4d9e=new User_1[(a1_0x3f31('0x5'))]();_0x2b4d9e[a1_0x3f31('0xb')]=_0x4faebb[a1_0x3f31('0x20')][a1_0x3f31('0xb')];_0x2b4d9e[a1_0x3f31('0x1b')]=_0x4faebb['id'];_0x2b4d9e[a1_0x3f31('0x1c')][a1_0x3f31('0x1d')]({'kind':a1_0x3f31('0x1b'),'accessToken':_0x54a370});_0x2b4d9e[a1_0x3f31('0x1e')][a1_0x3f31('0x13')]=_0x4faebb[a1_0x3f31('0x13')][a1_0x3f31('0x1f')]+'\x20'+_0x4faebb[a1_0x3f31('0x13')][a1_0x3f31('0x27')];_0x2b4d9e[a1_0x3f31('0x1e')][a1_0x3f31('0x21')]=_0x4faebb[a1_0x3f31('0x20')][a1_0x3f31('0x21')];_0x2b4d9e['profile'][a1_0x3f31('0x22')]='https://graph.facebook.com/'+_0x4faebb['id']+a1_0x3f31('0x28');_0x2b4d9e[a1_0x3f31('0x1e')][a1_0x3f31('0x29')]=_0x4faebb[a1_0x3f31('0x20')]['location']?_0x4faebb['_json']['location'][a1_0x3f31('0x13')]:'';_0x2b4d9e['save'](_0x411e25=>{_0x5b1410(_0x411e25,_0x2b4d9e);});}});});}}));exports[a1_0x3f31('0x2a')]=(_0x69c3d2,_0x72d0,_0x63f0b3)=>{if(_0x69c3d2[a1_0x3f31('0x2a')]()){return _0x63f0b3();}_0x72d0[a1_0x3f31('0x2b')](a1_0x3f31('0x2c'));};exports['isAuthorized']=(_0x431bb7,_0x25c80c,_0x3ef07f)=>{const _0x4628ae=_0x431bb7[a1_0x3f31('0x2d')][a1_0x3f31('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x3f31('0x5')][a1_0x3f31('0x2f')](_0x431bb7['user']['tokens'],{'kind':_0x4628ae})){_0x3ef07f();}else{_0x25c80c[a1_0x3f31('0x2b')](a1_0x3f31('0x30')+_0x4628ae);}};