var a1_0x4d75=['redirect','/login','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','user','flash','errors','facebook','tokens','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','Facebook\x20account\x20has\x20been\x20linked.','/picture?type=large','location','save','isAuthenticated'];(function(_0x1d76ea,_0x2dd14e){var _0x2dcc5a=function(_0x46c642){while(--_0x46c642){_0x1d76ea['push'](_0x1d76ea['shift']());}};_0x2dcc5a(++_0x2dd14e);}(a1_0x4d75,0xd3));var a1_0x12f5=function(_0x2fbeca,_0x302170){_0x2fbeca=_0x2fbeca-0x0;var _0x1ae02f=a1_0x4d75[_0x2fbeca];return _0x1ae02f;};'use strict';var __importDefault=this&&this[a1_0x12f5('0x0')]||function(_0x262e18){return _0x262e18&&_0x262e18[a1_0x12f5('0x1')]?_0x262e18:{'default':_0x262e18};};Object[a1_0x12f5('0x2')](exports,a1_0x12f5('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x12f5('0x3')));const passport_local_1=__importDefault(require(a1_0x12f5('0x4')));const passport_facebook_1=__importDefault(require(a1_0x12f5('0x5')));const lodash_1=__importDefault(require(a1_0x12f5('0x6')));const User_1=__importDefault(require(a1_0x12f5('0x7')));const LocalStrategy=passport_local_1[a1_0x12f5('0x8')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x12f5('0x8')][a1_0x12f5('0x9')];passport_1[a1_0x12f5('0x8')]['serializeUser']((_0xfd583a,_0x218106)=>{_0x218106(undefined,_0xfd583a['id']);});passport_1[a1_0x12f5('0x8')][a1_0x12f5('0xa')]((_0x37f409,_0x4d7cab)=>{User_1[a1_0x12f5('0x8')][a1_0x12f5('0xb')](_0x37f409,(_0x4d1a7a,_0x5a19cc)=>{_0x4d7cab(_0x4d1a7a,_0x5a19cc);});});passport_1['default'][a1_0x12f5('0xc')](new LocalStrategy({'usernameField':a1_0x12f5('0xd')},(_0x1349ce,_0x409b3c,_0x3ecbdf)=>{User_1[a1_0x12f5('0x8')][a1_0x12f5('0xe')]({'email':_0x1349ce[a1_0x12f5('0xf')]()},(_0x1a4b1e,_0x53df13)=>{if(_0x1a4b1e){return _0x3ecbdf(_0x1a4b1e);}if(!_0x53df13){return _0x3ecbdf(undefined,![],{'message':a1_0x12f5('0x10')+_0x1349ce+a1_0x12f5('0x11')});}_0x53df13[a1_0x12f5('0x12')](_0x409b3c,(_0x1a4b1e,_0x49c773)=>{if(_0x1a4b1e){return _0x3ecbdf(_0x1a4b1e);}if(_0x49c773){return _0x3ecbdf(undefined,_0x53df13);}return _0x3ecbdf(undefined,![],{'message':a1_0x12f5('0x13')});});});}));passport_1['default'][a1_0x12f5('0xc')](new FacebookStrategy({'clientID':process[a1_0x12f5('0x14')][a1_0x12f5('0x15')],'clientSecret':process[a1_0x12f5('0x14')][a1_0x12f5('0x16')],'callbackURL':a1_0x12f5('0x17'),'profileFields':[a1_0x12f5('0x18'),'email','link',a1_0x12f5('0x19'),a1_0x12f5('0x1a')],'passReqToCallback':!![]},(_0x1de4b2,_0x15cc02,_0x1b11aa,_0x357faf,_0x15c6fe)=>{if(_0x1de4b2[a1_0x12f5('0x1b')]){User_1[a1_0x12f5('0x8')][a1_0x12f5('0xe')]({'facebook':_0x357faf['id']},(_0x1b1247,_0x19feb2)=>{if(_0x1b1247){return _0x15c6fe(_0x1b1247);}if(_0x19feb2){_0x1de4b2[a1_0x12f5('0x1c')](a1_0x12f5('0x1d'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x15c6fe(_0x1b1247);}else{User_1[a1_0x12f5('0x8')]['findById'](_0x1de4b2[a1_0x12f5('0x1b')]['id'],(_0x1b1247,_0x1b425c)=>{if(_0x1b1247){return _0x15c6fe(_0x1b1247);}_0x1b425c[a1_0x12f5('0x1e')]=_0x357faf['id'];_0x1b425c[a1_0x12f5('0x1f')]['push']({'kind':a1_0x12f5('0x1e'),'accessToken':_0x15cc02});_0x1b425c[a1_0x12f5('0x20')][a1_0x12f5('0x18')]=_0x1b425c['profile'][a1_0x12f5('0x18')]||_0x357faf[a1_0x12f5('0x18')][a1_0x12f5('0x21')]+'\x20'+_0x357faf[a1_0x12f5('0x18')][a1_0x12f5('0x22')];_0x1b425c['profile'][a1_0x12f5('0x23')]=_0x1b425c[a1_0x12f5('0x20')]['gender']||_0x357faf[a1_0x12f5('0x24')][a1_0x12f5('0x23')];_0x1b425c[a1_0x12f5('0x20')][a1_0x12f5('0x25')]=_0x1b425c[a1_0x12f5('0x20')][a1_0x12f5('0x25')]||a1_0x12f5('0x26')+_0x357faf['id']+'/picture?type=large';_0x1b425c['save'](_0x1b1247=>{_0x1de4b2[a1_0x12f5('0x1c')]('info',{'msg':a1_0x12f5('0x27')});_0x15c6fe(_0x1b1247,_0x1b425c);});});}});}else{User_1['default'][a1_0x12f5('0xe')]({'facebook':_0x357faf['id']},(_0x330219,_0x117af8)=>{if(_0x330219){return _0x15c6fe(_0x330219);}if(_0x117af8){return _0x15c6fe(undefined,_0x117af8);}User_1['default'][a1_0x12f5('0xe')]({'email':_0x357faf[a1_0x12f5('0x24')][a1_0x12f5('0xd')]},(_0x330219,_0x524b28)=>{if(_0x330219){return _0x15c6fe(_0x330219);}if(_0x524b28){_0x1de4b2['flash'](a1_0x12f5('0x1d'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x15c6fe(_0x330219);}else{const _0x412f54=new User_1['default']();_0x412f54[a1_0x12f5('0xd')]=_0x357faf['_json'][a1_0x12f5('0xd')];_0x412f54[a1_0x12f5('0x1e')]=_0x357faf['id'];_0x412f54[a1_0x12f5('0x1f')]['push']({'kind':a1_0x12f5('0x1e'),'accessToken':_0x15cc02});_0x412f54[a1_0x12f5('0x20')][a1_0x12f5('0x18')]=_0x357faf[a1_0x12f5('0x18')]['givenName']+'\x20'+_0x357faf['name']['familyName'];_0x412f54[a1_0x12f5('0x20')][a1_0x12f5('0x23')]=_0x357faf[a1_0x12f5('0x24')][a1_0x12f5('0x23')];_0x412f54[a1_0x12f5('0x20')][a1_0x12f5('0x25')]=a1_0x12f5('0x26')+_0x357faf['id']+a1_0x12f5('0x28');_0x412f54[a1_0x12f5('0x20')]['location']=_0x357faf[a1_0x12f5('0x24')][a1_0x12f5('0x29')]?_0x357faf[a1_0x12f5('0x24')]['location'][a1_0x12f5('0x18')]:'';_0x412f54[a1_0x12f5('0x2a')](_0x330219=>{_0x15c6fe(_0x330219,_0x412f54);});}});});}}));exports[a1_0x12f5('0x2b')]=(_0x2f1c25,_0x56fe87,_0x2f6481)=>{if(_0x2f1c25[a1_0x12f5('0x2b')]()){return _0x2f6481();}_0x56fe87[a1_0x12f5('0x2c')](a1_0x12f5('0x2d'));};exports['isAuthorized']=(_0x37bac8,_0x171de7,_0x271460)=>{const _0x2497b9=_0x37bac8[a1_0x12f5('0x2e')][a1_0x12f5('0x2f')]('/')[a1_0x12f5('0x30')](-0x1)[0x0];if(lodash_1['default'][a1_0x12f5('0x31')](_0x37bac8[a1_0x12f5('0x1b')][a1_0x12f5('0x1f')],{'kind':_0x2497b9})){_0x271460();}else{_0x171de7['redirect'](a1_0x12f5('0x32')+_0x2497b9);}};