var a1_0x1681=['lodash','../models/User','default','Strategy','findById','use','toLowerCase','\x20not\x20found.','comparePassword','env','FACEBOOK_SECRET','locale','timezone','user','findOne','flash','errors','facebook','profile','name','givenName','familyName','gender','_json','picture','info','Facebook\x20account\x20has\x20been\x20linked.','email','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','push','https://graph.facebook.com/','/picture?type=large','location','save','isAuthenticated','redirect','/login','path','slice','find','/auth/','__importDefault','__esModule','passport','passport-facebook'];(function(_0x16ffe2,_0x57c45a){var _0x5c29a0=function(_0xfe82a6){while(--_0xfe82a6){_0x16ffe2['push'](_0x16ffe2['shift']());}};_0x5c29a0(++_0x57c45a);}(a1_0x1681,0x13e));var a1_0x2bf3=function(_0x2f3e31,_0x3a89c9){_0x2f3e31=_0x2f3e31-0x0;var _0x2c6db2=a1_0x1681[_0x2f3e31];return _0x2c6db2;};'use strict';var __importDefault=this&&this[a1_0x2bf3('0x0')]||function(_0x32a103){return _0x32a103&&_0x32a103[a1_0x2bf3('0x1')]?_0x32a103:{'default':_0x32a103};};Object['defineProperty'](exports,a1_0x2bf3('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2bf3('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x2bf3('0x3')));const lodash_1=__importDefault(require(a1_0x2bf3('0x4')));const User_1=__importDefault(require(a1_0x2bf3('0x5')));const LocalStrategy=passport_local_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x7')];passport_1[a1_0x2bf3('0x6')]['serializeUser']((_0x2bdb11,_0x2059d2)=>{_0x2059d2(undefined,_0x2bdb11['id']);});passport_1[a1_0x2bf3('0x6')]['deserializeUser']((_0x53d20f,_0x47a2cd)=>{User_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x8')](_0x53d20f,(_0x5ae8e4,_0x591587)=>{_0x47a2cd(_0x5ae8e4,_0x591587);});});passport_1['default'][a1_0x2bf3('0x9')](new LocalStrategy({'usernameField':'email'},(_0x219e94,_0x29cf6f,_0x416e6b)=>{User_1['default']['findOne']({'email':_0x219e94[a1_0x2bf3('0xa')]()},(_0x573bcb,_0x7b237f)=>{if(_0x573bcb){return _0x416e6b(_0x573bcb);}if(!_0x7b237f){return _0x416e6b(undefined,![],{'message':'Email\x20'+_0x219e94+a1_0x2bf3('0xb')});}_0x7b237f[a1_0x2bf3('0xc')](_0x29cf6f,(_0x573bcb,_0x3e8cc1)=>{if(_0x573bcb){return _0x416e6b(_0x573bcb);}if(_0x3e8cc1){return _0x416e6b(undefined,_0x7b237f);}return _0x416e6b(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x9')](new FacebookStrategy({'clientID':process[a1_0x2bf3('0xd')]['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x2bf3('0xe')],'callbackURL':'/auth/facebook/callback','profileFields':['name','email','link',a1_0x2bf3('0xf'),a1_0x2bf3('0x10')],'passReqToCallback':!![]},(_0x5ba93b,_0x2b6f6a,_0xdf912a,_0x2ca59b,_0x365a8f)=>{if(_0x5ba93b[a1_0x2bf3('0x11')]){User_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x12')]({'facebook':_0x2ca59b['id']},(_0x4aa9b8,_0x288304)=>{if(_0x4aa9b8){return _0x365a8f(_0x4aa9b8);}if(_0x288304){_0x5ba93b[a1_0x2bf3('0x13')](a1_0x2bf3('0x14'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x365a8f(_0x4aa9b8);}else{User_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x8')](_0x5ba93b[a1_0x2bf3('0x11')]['id'],(_0x4aa9b8,_0x24477c)=>{if(_0x4aa9b8){return _0x365a8f(_0x4aa9b8);}_0x24477c['facebook']=_0x2ca59b['id'];_0x24477c['tokens']['push']({'kind':a1_0x2bf3('0x15'),'accessToken':_0x2b6f6a});_0x24477c[a1_0x2bf3('0x16')][a1_0x2bf3('0x17')]=_0x24477c[a1_0x2bf3('0x16')][a1_0x2bf3('0x17')]||_0x2ca59b[a1_0x2bf3('0x17')][a1_0x2bf3('0x18')]+'\x20'+_0x2ca59b[a1_0x2bf3('0x17')][a1_0x2bf3('0x19')];_0x24477c['profile'][a1_0x2bf3('0x1a')]=_0x24477c[a1_0x2bf3('0x16')]['gender']||_0x2ca59b[a1_0x2bf3('0x1b')][a1_0x2bf3('0x1a')];_0x24477c[a1_0x2bf3('0x16')][a1_0x2bf3('0x1c')]=_0x24477c[a1_0x2bf3('0x16')][a1_0x2bf3('0x1c')]||'https://graph.facebook.com/'+_0x2ca59b['id']+'/picture?type=large';_0x24477c['save'](_0x4aa9b8=>{_0x5ba93b[a1_0x2bf3('0x13')](a1_0x2bf3('0x1d'),{'msg':a1_0x2bf3('0x1e')});_0x365a8f(_0x4aa9b8,_0x24477c);});});}});}else{User_1[a1_0x2bf3('0x6')]['findOne']({'facebook':_0x2ca59b['id']},(_0x511ad9,_0x265f0b)=>{if(_0x511ad9){return _0x365a8f(_0x511ad9);}if(_0x265f0b){return _0x365a8f(undefined,_0x265f0b);}User_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x12')]({'email':_0x2ca59b[a1_0x2bf3('0x1b')][a1_0x2bf3('0x1f')]},(_0x511ad9,_0x5854c3)=>{if(_0x511ad9){return _0x365a8f(_0x511ad9);}if(_0x5854c3){_0x5ba93b['flash']('errors',{'msg':a1_0x2bf3('0x20')});_0x365a8f(_0x511ad9);}else{const _0x46fff9=new User_1[(a1_0x2bf3('0x6'))]();_0x46fff9[a1_0x2bf3('0x1f')]=_0x2ca59b['_json'][a1_0x2bf3('0x1f')];_0x46fff9[a1_0x2bf3('0x15')]=_0x2ca59b['id'];_0x46fff9[a1_0x2bf3('0x21')][a1_0x2bf3('0x22')]({'kind':a1_0x2bf3('0x15'),'accessToken':_0x2b6f6a});_0x46fff9[a1_0x2bf3('0x16')]['name']=_0x2ca59b[a1_0x2bf3('0x17')][a1_0x2bf3('0x18')]+'\x20'+_0x2ca59b[a1_0x2bf3('0x17')][a1_0x2bf3('0x19')];_0x46fff9['profile'][a1_0x2bf3('0x1a')]=_0x2ca59b[a1_0x2bf3('0x1b')][a1_0x2bf3('0x1a')];_0x46fff9[a1_0x2bf3('0x16')][a1_0x2bf3('0x1c')]=a1_0x2bf3('0x23')+_0x2ca59b['id']+a1_0x2bf3('0x24');_0x46fff9[a1_0x2bf3('0x16')][a1_0x2bf3('0x25')]=_0x2ca59b[a1_0x2bf3('0x1b')]['location']?_0x2ca59b[a1_0x2bf3('0x1b')][a1_0x2bf3('0x25')]['name']:'';_0x46fff9[a1_0x2bf3('0x26')](_0x511ad9=>{_0x365a8f(_0x511ad9,_0x46fff9);});}});});}}));exports[a1_0x2bf3('0x27')]=(_0x4f2614,_0x152405,_0x412d1c)=>{if(_0x4f2614['isAuthenticated']()){return _0x412d1c();}_0x152405[a1_0x2bf3('0x28')](a1_0x2bf3('0x29'));};exports['isAuthorized']=(_0x4c631e,_0x46ddb1,_0x1d68c6)=>{const _0x796a66=_0x4c631e[a1_0x2bf3('0x2a')]['split']('/')[a1_0x2bf3('0x2b')](-0x1)[0x0];if(lodash_1[a1_0x2bf3('0x6')][a1_0x2bf3('0x2c')](_0x4c631e[a1_0x2bf3('0x11')]['tokens'],{'kind':_0x796a66})){_0x1d68c6();}else{_0x46ddb1[a1_0x2bf3('0x28')](a1_0x2bf3('0x2d')+_0x796a66);}};