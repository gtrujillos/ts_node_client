var a1_0x2358=['env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','save','info','Facebook\x20account\x20has\x20been\x20linked.','location','redirect','/login','isAuthorized','path','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a1_0x2358,0x185));var a1_0x29ff=function(_0x1ce79e,_0x41dd88){_0x1ce79e=_0x1ce79e-0x0;var _0x499f3b=a1_0x2358[_0x1ce79e];return _0x499f3b;};'use strict';var __importDefault=this&&this[a1_0x29ff('0x0')]||function(_0x1f7697){return _0x1f7697&&_0x1f7697[a1_0x29ff('0x1')]?_0x1f7697:{'default':_0x1f7697};};Object[a1_0x29ff('0x2')](exports,a1_0x29ff('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x29ff('0x3')));const passport_local_1=__importDefault(require(a1_0x29ff('0x4')));const passport_facebook_1=__importDefault(require(a1_0x29ff('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x29ff('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x29ff('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x29ff('0x8')][a1_0x29ff('0x7')];passport_1[a1_0x29ff('0x8')][a1_0x29ff('0x9')]((_0x32635a,_0x407625)=>{_0x407625(undefined,_0x32635a['id']);});passport_1[a1_0x29ff('0x8')][a1_0x29ff('0xa')]((_0x4071b8,_0x3f4509)=>{User_1['default']['findById'](_0x4071b8,(_0x56bb08,_0x55f530)=>{_0x3f4509(_0x56bb08,_0x55f530);});});passport_1[a1_0x29ff('0x8')]['use'](new LocalStrategy({'usernameField':a1_0x29ff('0xb')},(_0x4658c9,_0x418a2b,_0x499d8f)=>{User_1[a1_0x29ff('0x8')][a1_0x29ff('0xc')]({'email':_0x4658c9[a1_0x29ff('0xd')]()},(_0x45b26c,_0x37ddd0)=>{if(_0x45b26c){return _0x499d8f(_0x45b26c);}if(!_0x37ddd0){return _0x499d8f(undefined,![],{'message':a1_0x29ff('0xe')+_0x4658c9+a1_0x29ff('0xf')});}_0x37ddd0[a1_0x29ff('0x10')](_0x418a2b,(_0x45b26c,_0x18c4d0)=>{if(_0x45b26c){return _0x499d8f(_0x45b26c);}if(_0x18c4d0){return _0x499d8f(undefined,_0x37ddd0);}return _0x499d8f(undefined,![],{'message':a1_0x29ff('0x11')});});});}));passport_1[a1_0x29ff('0x8')][a1_0x29ff('0x12')](new FacebookStrategy({'clientID':process[a1_0x29ff('0x13')][a1_0x29ff('0x14')],'clientSecret':process[a1_0x29ff('0x13')][a1_0x29ff('0x15')],'callbackURL':a1_0x29ff('0x16'),'profileFields':[a1_0x29ff('0x17'),'email',a1_0x29ff('0x18'),a1_0x29ff('0x19'),'timezone'],'passReqToCallback':!![]},(_0x3ee90f,_0x194da0,_0x5c9542,_0x5856d5,_0x15924e)=>{if(_0x3ee90f[a1_0x29ff('0x1a')]){User_1['default']['findOne']({'facebook':_0x5856d5['id']},(_0x5b06a2,_0x2dc37e)=>{if(_0x5b06a2){return _0x15924e(_0x5b06a2);}if(_0x2dc37e){_0x3ee90f[a1_0x29ff('0x1b')](a1_0x29ff('0x1c'),{'msg':a1_0x29ff('0x1d')});_0x15924e(_0x5b06a2);}else{User_1[a1_0x29ff('0x8')]['findById'](_0x3ee90f[a1_0x29ff('0x1a')]['id'],(_0x5b06a2,_0x466960)=>{if(_0x5b06a2){return _0x15924e(_0x5b06a2);}_0x466960[a1_0x29ff('0x1e')]=_0x5856d5['id'];_0x466960[a1_0x29ff('0x1f')][a1_0x29ff('0x20')]({'kind':a1_0x29ff('0x1e'),'accessToken':_0x194da0});_0x466960[a1_0x29ff('0x21')][a1_0x29ff('0x17')]=_0x466960[a1_0x29ff('0x21')][a1_0x29ff('0x17')]||_0x5856d5[a1_0x29ff('0x17')][a1_0x29ff('0x22')]+'\x20'+_0x5856d5[a1_0x29ff('0x17')][a1_0x29ff('0x23')];_0x466960[a1_0x29ff('0x21')][a1_0x29ff('0x24')]=_0x466960[a1_0x29ff('0x21')][a1_0x29ff('0x24')]||_0x5856d5[a1_0x29ff('0x25')][a1_0x29ff('0x24')];_0x466960[a1_0x29ff('0x21')][a1_0x29ff('0x26')]=_0x466960[a1_0x29ff('0x21')]['picture']||a1_0x29ff('0x27')+_0x5856d5['id']+'/picture?type=large';_0x466960[a1_0x29ff('0x28')](_0x5b06a2=>{_0x3ee90f[a1_0x29ff('0x1b')](a1_0x29ff('0x29'),{'msg':a1_0x29ff('0x2a')});_0x15924e(_0x5b06a2,_0x466960);});});}});}else{User_1[a1_0x29ff('0x8')][a1_0x29ff('0xc')]({'facebook':_0x5856d5['id']},(_0x37287c,_0x4e6339)=>{if(_0x37287c){return _0x15924e(_0x37287c);}if(_0x4e6339){return _0x15924e(undefined,_0x4e6339);}User_1[a1_0x29ff('0x8')][a1_0x29ff('0xc')]({'email':_0x5856d5[a1_0x29ff('0x25')][a1_0x29ff('0xb')]},(_0x37287c,_0x1f2ecc)=>{if(_0x37287c){return _0x15924e(_0x37287c);}if(_0x1f2ecc){_0x3ee90f[a1_0x29ff('0x1b')](a1_0x29ff('0x1c'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x15924e(_0x37287c);}else{const _0x5d261c=new User_1[(a1_0x29ff('0x8'))]();_0x5d261c['email']=_0x5856d5[a1_0x29ff('0x25')][a1_0x29ff('0xb')];_0x5d261c[a1_0x29ff('0x1e')]=_0x5856d5['id'];_0x5d261c[a1_0x29ff('0x1f')]['push']({'kind':a1_0x29ff('0x1e'),'accessToken':_0x194da0});_0x5d261c[a1_0x29ff('0x21')]['name']=_0x5856d5['name']['givenName']+'\x20'+_0x5856d5[a1_0x29ff('0x17')][a1_0x29ff('0x23')];_0x5d261c[a1_0x29ff('0x21')]['gender']=_0x5856d5['_json']['gender'];_0x5d261c['profile'][a1_0x29ff('0x26')]=a1_0x29ff('0x27')+_0x5856d5['id']+'/picture?type=large';_0x5d261c[a1_0x29ff('0x21')]['location']=_0x5856d5[a1_0x29ff('0x25')]['location']?_0x5856d5[a1_0x29ff('0x25')][a1_0x29ff('0x2b')][a1_0x29ff('0x17')]:'';_0x5d261c[a1_0x29ff('0x28')](_0x37287c=>{_0x15924e(_0x37287c,_0x5d261c);});}});});}}));exports['isAuthenticated']=(_0x36bd40,_0x470082,_0x146bfc)=>{if(_0x36bd40['isAuthenticated']()){return _0x146bfc();}_0x470082[a1_0x29ff('0x2c')](a1_0x29ff('0x2d'));};exports[a1_0x29ff('0x2e')]=(_0x4c0122,_0x26ded1,_0x33b51d)=>{const _0x44df85=_0x4c0122[a1_0x29ff('0x2f')]['split']('/')[a1_0x29ff('0x30')](-0x1)[0x0];if(lodash_1[a1_0x29ff('0x8')][a1_0x29ff('0x31')](_0x4c0122[a1_0x29ff('0x1a')][a1_0x29ff('0x1f')],{'kind':_0x44df85})){_0x33b51d();}else{_0x26ded1['redirect'](a1_0x29ff('0x32')+_0x44df85);}};