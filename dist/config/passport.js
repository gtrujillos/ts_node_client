var a1_0xd671=['serializeUser','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','email','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile','name','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','_json','location','isAuthenticated','redirect','/login','isAuthorized','path','split','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default'];(function(_0x2d60b9,_0x3444aa){var _0x1c7519=function(_0x2c82a9){while(--_0x2c82a9){_0x2d60b9['push'](_0x2d60b9['shift']());}};_0x1c7519(++_0x3444aa);}(a1_0xd671,0x12e));var a1_0x4461=function(_0x13e158,_0x108827){_0x13e158=_0x13e158-0x0;var _0x29f4e0=a1_0xd671[_0x13e158];return _0x29f4e0;};'use strict';var __importDefault=this&&this[a1_0x4461('0x0')]||function(_0x41a2c0){return _0x41a2c0&&_0x41a2c0[a1_0x4461('0x1')]?_0x41a2c0:{'default':_0x41a2c0};};Object[a1_0x4461('0x2')](exports,a1_0x4461('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4461('0x3')));const passport_local_1=__importDefault(require(a1_0x4461('0x4')));const passport_facebook_1=__importDefault(require(a1_0x4461('0x5')));const lodash_1=__importDefault(require(a1_0x4461('0x6')));const User_1=__importDefault(require(a1_0x4461('0x7')));const LocalStrategy=passport_local_1['default'][a1_0x4461('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x4461('0x9')]['Strategy'];passport_1[a1_0x4461('0x9')][a1_0x4461('0xa')]((_0xe069d9,_0x2da3ac)=>{_0x2da3ac(undefined,_0xe069d9['id']);});passport_1[a1_0x4461('0x9')][a1_0x4461('0xb')]((_0x5b4ed6,_0xd6a332)=>{User_1['default'][a1_0x4461('0xc')](_0x5b4ed6,(_0x24e62d,_0xa1316c)=>{_0xd6a332(_0x24e62d,_0xa1316c);});});passport_1['default'][a1_0x4461('0xd')](new LocalStrategy({'usernameField':'email'},(_0x40410f,_0x51c5b5,_0x7add8f)=>{User_1[a1_0x4461('0x9')][a1_0x4461('0xe')]({'email':_0x40410f[a1_0x4461('0xf')]()},(_0x19547e,_0x501a7c)=>{if(_0x19547e){return _0x7add8f(_0x19547e);}if(!_0x501a7c){return _0x7add8f(undefined,![],{'message':a1_0x4461('0x10')+_0x40410f+'\x20not\x20found.'});}_0x501a7c['comparePassword'](_0x51c5b5,(_0x19547e,_0x199cfb)=>{if(_0x19547e){return _0x7add8f(_0x19547e);}if(_0x199cfb){return _0x7add8f(undefined,_0x501a7c);}return _0x7add8f(undefined,![],{'message':a1_0x4461('0x11')});});});}));passport_1['default'][a1_0x4461('0xd')](new FacebookStrategy({'clientID':process[a1_0x4461('0x12')][a1_0x4461('0x13')],'clientSecret':process[a1_0x4461('0x12')][a1_0x4461('0x14')],'callbackURL':a1_0x4461('0x15'),'profileFields':['name',a1_0x4461('0x16'),a1_0x4461('0x17'),a1_0x4461('0x18'),a1_0x4461('0x19')],'passReqToCallback':!![]},(_0x3ee2c3,_0x19f0e8,_0x1e717e,_0x35ae4f,_0x392f16)=>{if(_0x3ee2c3[a1_0x4461('0x1a')]){User_1[a1_0x4461('0x9')][a1_0x4461('0xe')]({'facebook':_0x35ae4f['id']},(_0x255b87,_0x2000b1)=>{if(_0x255b87){return _0x392f16(_0x255b87);}if(_0x2000b1){_0x3ee2c3[a1_0x4461('0x1b')](a1_0x4461('0x1c'),{'msg':a1_0x4461('0x1d')});_0x392f16(_0x255b87);}else{User_1[a1_0x4461('0x9')][a1_0x4461('0xc')](_0x3ee2c3['user']['id'],(_0x255b87,_0x3661bc)=>{if(_0x255b87){return _0x392f16(_0x255b87);}_0x3661bc['facebook']=_0x35ae4f['id'];_0x3661bc[a1_0x4461('0x1e')][a1_0x4461('0x1f')]({'kind':a1_0x4461('0x20'),'accessToken':_0x19f0e8});_0x3661bc[a1_0x4461('0x21')][a1_0x4461('0x22')]=_0x3661bc['profile'][a1_0x4461('0x22')]||_0x35ae4f[a1_0x4461('0x22')][a1_0x4461('0x23')]+'\x20'+_0x35ae4f[a1_0x4461('0x22')][a1_0x4461('0x24')];_0x3661bc[a1_0x4461('0x21')][a1_0x4461('0x25')]=_0x3661bc[a1_0x4461('0x21')][a1_0x4461('0x25')]||_0x35ae4f['_json']['gender'];_0x3661bc['profile']['picture']=_0x3661bc['profile'][a1_0x4461('0x26')]||a1_0x4461('0x27')+_0x35ae4f['id']+a1_0x4461('0x28');_0x3661bc[a1_0x4461('0x29')](_0x255b87=>{_0x3ee2c3['flash'](a1_0x4461('0x2a'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x392f16(_0x255b87,_0x3661bc);});});}});}else{User_1[a1_0x4461('0x9')][a1_0x4461('0xe')]({'facebook':_0x35ae4f['id']},(_0x4baa17,_0x32557c)=>{if(_0x4baa17){return _0x392f16(_0x4baa17);}if(_0x32557c){return _0x392f16(undefined,_0x32557c);}User_1[a1_0x4461('0x9')]['findOne']({'email':_0x35ae4f[a1_0x4461('0x2b')][a1_0x4461('0x16')]},(_0x4baa17,_0x56bd61)=>{if(_0x4baa17){return _0x392f16(_0x4baa17);}if(_0x56bd61){_0x3ee2c3['flash']('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x392f16(_0x4baa17);}else{const _0x405ec1=new User_1[(a1_0x4461('0x9'))]();_0x405ec1[a1_0x4461('0x16')]=_0x35ae4f[a1_0x4461('0x2b')]['email'];_0x405ec1[a1_0x4461('0x20')]=_0x35ae4f['id'];_0x405ec1[a1_0x4461('0x1e')][a1_0x4461('0x1f')]({'kind':'facebook','accessToken':_0x19f0e8});_0x405ec1[a1_0x4461('0x21')][a1_0x4461('0x22')]=_0x35ae4f['name'][a1_0x4461('0x23')]+'\x20'+_0x35ae4f[a1_0x4461('0x22')][a1_0x4461('0x24')];_0x405ec1[a1_0x4461('0x21')][a1_0x4461('0x25')]=_0x35ae4f[a1_0x4461('0x2b')][a1_0x4461('0x25')];_0x405ec1[a1_0x4461('0x21')][a1_0x4461('0x26')]=a1_0x4461('0x27')+_0x35ae4f['id']+a1_0x4461('0x28');_0x405ec1['profile']['location']=_0x35ae4f[a1_0x4461('0x2b')][a1_0x4461('0x2c')]?_0x35ae4f[a1_0x4461('0x2b')][a1_0x4461('0x2c')][a1_0x4461('0x22')]:'';_0x405ec1[a1_0x4461('0x29')](_0x4baa17=>{_0x392f16(_0x4baa17,_0x405ec1);});}});});}}));exports[a1_0x4461('0x2d')]=(_0x5662ed,_0x1a22ab,_0x3585f7)=>{if(_0x5662ed[a1_0x4461('0x2d')]()){return _0x3585f7();}_0x1a22ab[a1_0x4461('0x2e')](a1_0x4461('0x2f'));};exports[a1_0x4461('0x30')]=(_0x39fae5,_0x29c8ad,_0x3ec79a)=>{const _0x3deead=_0x39fae5[a1_0x4461('0x31')][a1_0x4461('0x32')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x4461('0x9')]['find'](_0x39fae5[a1_0x4461('0x1a')]['tokens'],{'kind':_0x3deead})){_0x3ec79a();}else{_0x29c8ad[a1_0x4461('0x2e')](a1_0x4461('0x33')+_0x3deead);}};