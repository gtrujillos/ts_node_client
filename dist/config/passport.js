var a1_0x4942=['flash','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','familyName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','locale','user','findOne','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile','name','gender','_json','picture','/picture?type=large','save','info'];(function(_0x528262,_0x5cf2b4){var _0x508a08=function(_0x1d7450){while(--_0x1d7450){_0x528262['push'](_0x528262['shift']());}};_0x508a08(++_0x5cf2b4);}(a1_0x4942,0xd0));var a1_0x33ad=function(_0x30b154,_0x4f1a4c){_0x30b154=_0x30b154-0x0;var _0x8b103=a1_0x4942[_0x30b154];return _0x8b103;};'use strict';var __importDefault=this&&this[a1_0x33ad('0x0')]||function(_0x4e84e9){return _0x4e84e9&&_0x4e84e9[a1_0x33ad('0x1')]?_0x4e84e9:{'default':_0x4e84e9};};Object[a1_0x33ad('0x2')](exports,a1_0x33ad('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x33ad('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x33ad('0x4')));const lodash_1=__importDefault(require(a1_0x33ad('0x5')));const User_1=__importDefault(require(a1_0x33ad('0x6')));const LocalStrategy=passport_local_1[a1_0x33ad('0x7')][a1_0x33ad('0x8')];const FacebookStrategy=passport_facebook_1['default']['Strategy'];passport_1[a1_0x33ad('0x7')][a1_0x33ad('0x9')]((_0x535e8a,_0x87e2fb)=>{_0x87e2fb(undefined,_0x535e8a['id']);});passport_1[a1_0x33ad('0x7')][a1_0x33ad('0xa')]((_0x3203d7,_0x20f81b)=>{User_1[a1_0x33ad('0x7')][a1_0x33ad('0xb')](_0x3203d7,(_0x3b9abd,_0x4e201c)=>{_0x20f81b(_0x3b9abd,_0x4e201c);});});passport_1['default'][a1_0x33ad('0xc')](new LocalStrategy({'usernameField':a1_0x33ad('0xd')},(_0x482ab6,_0x12375f,_0x2109b8)=>{User_1[a1_0x33ad('0x7')]['findOne']({'email':_0x482ab6[a1_0x33ad('0xe')]()},(_0x6f0881,_0x32d5b1)=>{if(_0x6f0881){return _0x2109b8(_0x6f0881);}if(!_0x32d5b1){return _0x2109b8(undefined,![],{'message':'Email\x20'+_0x482ab6+a1_0x33ad('0xf')});}_0x32d5b1[a1_0x33ad('0x10')](_0x12375f,(_0x6f0881,_0x42f4be)=>{if(_0x6f0881){return _0x2109b8(_0x6f0881);}if(_0x42f4be){return _0x2109b8(undefined,_0x32d5b1);}return _0x2109b8(undefined,![],{'message':a1_0x33ad('0x11')});});});}));passport_1[a1_0x33ad('0x7')][a1_0x33ad('0xc')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x33ad('0x12')][a1_0x33ad('0x13')],'callbackURL':a1_0x33ad('0x14'),'profileFields':['name',a1_0x33ad('0xd'),'link',a1_0x33ad('0x15'),'timezone'],'passReqToCallback':!![]},(_0x47c32f,_0x453182,_0x21a95a,_0x4bc3f3,_0x172add)=>{if(_0x47c32f[a1_0x33ad('0x16')]){User_1[a1_0x33ad('0x7')][a1_0x33ad('0x17')]({'facebook':_0x4bc3f3['id']},(_0x5df2d5,_0x49fa8a)=>{if(_0x5df2d5){return _0x172add(_0x5df2d5);}if(_0x49fa8a){_0x47c32f['flash'](a1_0x33ad('0x18'),{'msg':a1_0x33ad('0x19')});_0x172add(_0x5df2d5);}else{User_1[a1_0x33ad('0x7')][a1_0x33ad('0xb')](_0x47c32f[a1_0x33ad('0x16')]['id'],(_0x5df2d5,_0x140bcb)=>{if(_0x5df2d5){return _0x172add(_0x5df2d5);}_0x140bcb['facebook']=_0x4bc3f3['id'];_0x140bcb[a1_0x33ad('0x1a')][a1_0x33ad('0x1b')]({'kind':a1_0x33ad('0x1c'),'accessToken':_0x453182});_0x140bcb[a1_0x33ad('0x1d')]['name']=_0x140bcb[a1_0x33ad('0x1d')][a1_0x33ad('0x1e')]||_0x4bc3f3[a1_0x33ad('0x1e')]['givenName']+'\x20'+_0x4bc3f3[a1_0x33ad('0x1e')]['familyName'];_0x140bcb[a1_0x33ad('0x1d')]['gender']=_0x140bcb[a1_0x33ad('0x1d')][a1_0x33ad('0x1f')]||_0x4bc3f3[a1_0x33ad('0x20')]['gender'];_0x140bcb['profile'][a1_0x33ad('0x21')]=_0x140bcb[a1_0x33ad('0x1d')][a1_0x33ad('0x21')]||'https://graph.facebook.com/'+_0x4bc3f3['id']+a1_0x33ad('0x22');_0x140bcb[a1_0x33ad('0x23')](_0x5df2d5=>{_0x47c32f['flash'](a1_0x33ad('0x24'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x172add(_0x5df2d5,_0x140bcb);});});}});}else{User_1[a1_0x33ad('0x7')][a1_0x33ad('0x17')]({'facebook':_0x4bc3f3['id']},(_0x1539ab,_0x7c428a)=>{if(_0x1539ab){return _0x172add(_0x1539ab);}if(_0x7c428a){return _0x172add(undefined,_0x7c428a);}User_1[a1_0x33ad('0x7')][a1_0x33ad('0x17')]({'email':_0x4bc3f3['_json'][a1_0x33ad('0xd')]},(_0x1539ab,_0x1bbe05)=>{if(_0x1539ab){return _0x172add(_0x1539ab);}if(_0x1bbe05){_0x47c32f[a1_0x33ad('0x25')](a1_0x33ad('0x18'),{'msg':a1_0x33ad('0x26')});_0x172add(_0x1539ab);}else{const _0x15d14d=new User_1[(a1_0x33ad('0x7'))]();_0x15d14d['email']=_0x4bc3f3[a1_0x33ad('0x20')][a1_0x33ad('0xd')];_0x15d14d['facebook']=_0x4bc3f3['id'];_0x15d14d[a1_0x33ad('0x1a')][a1_0x33ad('0x1b')]({'kind':a1_0x33ad('0x1c'),'accessToken':_0x453182});_0x15d14d[a1_0x33ad('0x1d')][a1_0x33ad('0x1e')]=_0x4bc3f3[a1_0x33ad('0x1e')][a1_0x33ad('0x27')]+'\x20'+_0x4bc3f3[a1_0x33ad('0x1e')][a1_0x33ad('0x28')];_0x15d14d[a1_0x33ad('0x1d')]['gender']=_0x4bc3f3[a1_0x33ad('0x20')][a1_0x33ad('0x1f')];_0x15d14d[a1_0x33ad('0x1d')][a1_0x33ad('0x21')]=a1_0x33ad('0x29')+_0x4bc3f3['id']+a1_0x33ad('0x22');_0x15d14d[a1_0x33ad('0x1d')][a1_0x33ad('0x2a')]=_0x4bc3f3[a1_0x33ad('0x20')][a1_0x33ad('0x2a')]?_0x4bc3f3[a1_0x33ad('0x20')][a1_0x33ad('0x2a')][a1_0x33ad('0x1e')]:'';_0x15d14d[a1_0x33ad('0x23')](_0x1539ab=>{_0x172add(_0x1539ab,_0x15d14d);});}});});}}));exports[a1_0x33ad('0x2b')]=(_0x26f969,_0x36ca21,_0x534bc7)=>{if(_0x26f969[a1_0x33ad('0x2b')]()){return _0x534bc7();}_0x36ca21[a1_0x33ad('0x2c')](a1_0x33ad('0x2d'));};exports['isAuthorized']=(_0x34f558,_0x2aaa4f,_0x1edf8c)=>{const _0x5614ce=_0x34f558['path']['split']('/')[a1_0x33ad('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x33ad('0x7')][a1_0x33ad('0x2f')](_0x34f558[a1_0x33ad('0x16')]['tokens'],{'kind':_0x5614ce})){_0x1edf8c();}else{_0x2aaa4f[a1_0x33ad('0x2c')](a1_0x33ad('0x30')+_0x5614ce);}};