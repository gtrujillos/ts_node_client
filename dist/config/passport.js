var a1_0x1b8c=['lodash','../models/User','Strategy','default','serializeUser','deserializeUser','use','email','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','timezone','user','findOne','flash','errors','findById','tokens','push','facebook','profile','name','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','isAuthenticated','/login','isAuthorized','path','slice','find','redirect','/auth/','__importDefault','__esModule','defineProperty','passport-local'];(function(_0x28474a,_0x1a6544){var _0x121323=function(_0x290d2c){while(--_0x290d2c){_0x28474a['push'](_0x28474a['shift']());}};_0x121323(++_0x1a6544);}(a1_0x1b8c,0x105));var a1_0x590d=function(_0x3e21ae,_0x12c303){_0x3e21ae=_0x3e21ae-0x0;var _0x1ac304=a1_0x1b8c[_0x3e21ae];return _0x1ac304;};'use strict';var __importDefault=this&&this[a1_0x590d('0x0')]||function(_0x4fb7ed){return _0x4fb7ed&&_0x4fb7ed[a1_0x590d('0x1')]?_0x4fb7ed:{'default':_0x4fb7ed};};Object[a1_0x590d('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x590d('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x590d('0x4')));const User_1=__importDefault(require(a1_0x590d('0x5')));const LocalStrategy=passport_local_1['default'][a1_0x590d('0x6')];const FacebookStrategy=passport_facebook_1['default']['Strategy'];passport_1[a1_0x590d('0x7')][a1_0x590d('0x8')]((_0x340f18,_0x3e6232)=>{_0x3e6232(undefined,_0x340f18['id']);});passport_1[a1_0x590d('0x7')][a1_0x590d('0x9')]((_0x194cc1,_0x436c2d)=>{User_1[a1_0x590d('0x7')]['findById'](_0x194cc1,(_0x35246c,_0xb67e1a)=>{_0x436c2d(_0x35246c,_0xb67e1a);});});passport_1[a1_0x590d('0x7')][a1_0x590d('0xa')](new LocalStrategy({'usernameField':a1_0x590d('0xb')},(_0x10183c,_0x2089b8,_0xd9a238)=>{User_1[a1_0x590d('0x7')]['findOne']({'email':_0x10183c[a1_0x590d('0xc')]()},(_0xa4edfb,_0x48667c)=>{if(_0xa4edfb){return _0xd9a238(_0xa4edfb);}if(!_0x48667c){return _0xd9a238(undefined,![],{'message':'Email\x20'+_0x10183c+a1_0x590d('0xd')});}_0x48667c[a1_0x590d('0xe')](_0x2089b8,(_0xa4edfb,_0x3cee5f)=>{if(_0xa4edfb){return _0xd9a238(_0xa4edfb);}if(_0x3cee5f){return _0xd9a238(undefined,_0x48667c);}return _0xd9a238(undefined,![],{'message':a1_0x590d('0xf')});});});}));passport_1[a1_0x590d('0x7')][a1_0x590d('0xa')](new FacebookStrategy({'clientID':process[a1_0x590d('0x10')][a1_0x590d('0x11')],'clientSecret':process[a1_0x590d('0x10')][a1_0x590d('0x12')],'callbackURL':a1_0x590d('0x13'),'profileFields':['name',a1_0x590d('0xb'),a1_0x590d('0x14'),a1_0x590d('0x15'),a1_0x590d('0x16')],'passReqToCallback':!![]},(_0x38e2b0,_0x46c346,_0x512071,_0x4a6ac6,_0x258d78)=>{if(_0x38e2b0[a1_0x590d('0x17')]){User_1[a1_0x590d('0x7')][a1_0x590d('0x18')]({'facebook':_0x4a6ac6['id']},(_0x3d1906,_0x6b2b0)=>{if(_0x3d1906){return _0x258d78(_0x3d1906);}if(_0x6b2b0){_0x38e2b0[a1_0x590d('0x19')](a1_0x590d('0x1a'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x258d78(_0x3d1906);}else{User_1[a1_0x590d('0x7')][a1_0x590d('0x1b')](_0x38e2b0['user']['id'],(_0x3d1906,_0x6b247e)=>{if(_0x3d1906){return _0x258d78(_0x3d1906);}_0x6b247e['facebook']=_0x4a6ac6['id'];_0x6b247e[a1_0x590d('0x1c')][a1_0x590d('0x1d')]({'kind':a1_0x590d('0x1e'),'accessToken':_0x46c346});_0x6b247e[a1_0x590d('0x1f')][a1_0x590d('0x20')]=_0x6b247e[a1_0x590d('0x1f')][a1_0x590d('0x20')]||_0x4a6ac6[a1_0x590d('0x20')][a1_0x590d('0x21')]+'\x20'+_0x4a6ac6[a1_0x590d('0x20')][a1_0x590d('0x22')];_0x6b247e[a1_0x590d('0x1f')][a1_0x590d('0x23')]=_0x6b247e[a1_0x590d('0x1f')][a1_0x590d('0x23')]||_0x4a6ac6[a1_0x590d('0x24')][a1_0x590d('0x23')];_0x6b247e[a1_0x590d('0x1f')]['picture']=_0x6b247e[a1_0x590d('0x1f')][a1_0x590d('0x25')]||'https://graph.facebook.com/'+_0x4a6ac6['id']+a1_0x590d('0x26');_0x6b247e[a1_0x590d('0x27')](_0x3d1906=>{_0x38e2b0[a1_0x590d('0x19')](a1_0x590d('0x28'),{'msg':a1_0x590d('0x29')});_0x258d78(_0x3d1906,_0x6b247e);});});}});}else{User_1[a1_0x590d('0x7')]['findOne']({'facebook':_0x4a6ac6['id']},(_0x30c2af,_0x306c66)=>{if(_0x30c2af){return _0x258d78(_0x30c2af);}if(_0x306c66){return _0x258d78(undefined,_0x306c66);}User_1[a1_0x590d('0x7')]['findOne']({'email':_0x4a6ac6[a1_0x590d('0x24')][a1_0x590d('0xb')]},(_0x30c2af,_0x45bfdd)=>{if(_0x30c2af){return _0x258d78(_0x30c2af);}if(_0x45bfdd){_0x38e2b0[a1_0x590d('0x19')](a1_0x590d('0x1a'),{'msg':a1_0x590d('0x2a')});_0x258d78(_0x30c2af);}else{const _0x4bcae3=new User_1[(a1_0x590d('0x7'))]();_0x4bcae3[a1_0x590d('0xb')]=_0x4a6ac6[a1_0x590d('0x24')][a1_0x590d('0xb')];_0x4bcae3[a1_0x590d('0x1e')]=_0x4a6ac6['id'];_0x4bcae3[a1_0x590d('0x1c')]['push']({'kind':a1_0x590d('0x1e'),'accessToken':_0x46c346});_0x4bcae3['profile'][a1_0x590d('0x20')]=_0x4a6ac6[a1_0x590d('0x20')]['givenName']+'\x20'+_0x4a6ac6[a1_0x590d('0x20')][a1_0x590d('0x22')];_0x4bcae3[a1_0x590d('0x1f')]['gender']=_0x4a6ac6['_json'][a1_0x590d('0x23')];_0x4bcae3[a1_0x590d('0x1f')][a1_0x590d('0x25')]=a1_0x590d('0x2b')+_0x4a6ac6['id']+a1_0x590d('0x26');_0x4bcae3[a1_0x590d('0x1f')][a1_0x590d('0x2c')]=_0x4a6ac6[a1_0x590d('0x24')][a1_0x590d('0x2c')]?_0x4a6ac6[a1_0x590d('0x24')]['location'][a1_0x590d('0x20')]:'';_0x4bcae3['save'](_0x30c2af=>{_0x258d78(_0x30c2af,_0x4bcae3);});}});});}}));exports['isAuthenticated']=(_0x39018f,_0x285373,_0x454a1b)=>{if(_0x39018f[a1_0x590d('0x2d')]()){return _0x454a1b();}_0x285373['redirect'](a1_0x590d('0x2e'));};exports[a1_0x590d('0x2f')]=(_0x149d46,_0x3db4fb,_0x21d45a)=>{const _0x5e6a3c=_0x149d46[a1_0x590d('0x30')]['split']('/')[a1_0x590d('0x31')](-0x1)[0x0];if(lodash_1[a1_0x590d('0x7')][a1_0x590d('0x32')](_0x149d46[a1_0x590d('0x17')][a1_0x590d('0x1c')],{'kind':_0x5e6a3c})){_0x21d45a();}else{_0x3db4fb[a1_0x590d('0x33')](a1_0x590d('0x34')+_0x5e6a3c);}};