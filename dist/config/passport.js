var a1_0x50e5=['passport-local','passport-facebook','lodash','../models/User','default','serializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','familyName','location','isAuthenticated','redirect','isAuthorized','split','find','__importDefault','defineProperty','__esModule'];(function(_0x3e39c6,_0x40265c){var _0x4c544e=function(_0x1c1805){while(--_0x1c1805){_0x3e39c6['push'](_0x3e39c6['shift']());}};_0x4c544e(++_0x40265c);}(a1_0x50e5,0x14d));var a1_0x5ecc=function(_0x216808,_0x4c7034){_0x216808=_0x216808-0x0;var _0x44c49a=a1_0x50e5[_0x216808];return _0x44c49a;};'use strict';var __importDefault=this&&this[a1_0x5ecc('0x0')]||function(_0x289312){return _0x289312&&_0x289312['__esModule']?_0x289312:{'default':_0x289312};};Object[a1_0x5ecc('0x1')](exports,a1_0x5ecc('0x2'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x5ecc('0x3')));const passport_facebook_1=__importDefault(require(a1_0x5ecc('0x4')));const lodash_1=__importDefault(require(a1_0x5ecc('0x5')));const User_1=__importDefault(require(a1_0x5ecc('0x6')));const LocalStrategy=passport_local_1[a1_0x5ecc('0x7')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5ecc('0x7')]['Strategy'];passport_1['default'][a1_0x5ecc('0x8')]((_0x3bd53b,_0x3b1dc8)=>{_0x3b1dc8(undefined,_0x3bd53b['id']);});passport_1['default']['deserializeUser']((_0x2bc258,_0x263b9e)=>{User_1[a1_0x5ecc('0x7')][a1_0x5ecc('0x9')](_0x2bc258,(_0xb35344,_0x27f51e)=>{_0x263b9e(_0xb35344,_0x27f51e);});});passport_1[a1_0x5ecc('0x7')][a1_0x5ecc('0xa')](new LocalStrategy({'usernameField':a1_0x5ecc('0xb')},(_0x12f06f,_0x45e11f,_0x1e0f23)=>{User_1[a1_0x5ecc('0x7')][a1_0x5ecc('0xc')]({'email':_0x12f06f['toLowerCase']()},(_0x27e5e4,_0x5e292e)=>{if(_0x27e5e4){return _0x1e0f23(_0x27e5e4);}if(!_0x5e292e){return _0x1e0f23(undefined,![],{'message':a1_0x5ecc('0xd')+_0x12f06f+a1_0x5ecc('0xe')});}_0x5e292e[a1_0x5ecc('0xf')](_0x45e11f,(_0x27e5e4,_0x4d2ab9)=>{if(_0x27e5e4){return _0x1e0f23(_0x27e5e4);}if(_0x4d2ab9){return _0x1e0f23(undefined,_0x5e292e);}return _0x1e0f23(undefined,![],{'message':a1_0x5ecc('0x10')});});});}));passport_1[a1_0x5ecc('0x7')]['use'](new FacebookStrategy({'clientID':process[a1_0x5ecc('0x11')][a1_0x5ecc('0x12')],'clientSecret':process[a1_0x5ecc('0x11')]['FACEBOOK_SECRET'],'callbackURL':a1_0x5ecc('0x13'),'profileFields':[a1_0x5ecc('0x14'),'email',a1_0x5ecc('0x15'),a1_0x5ecc('0x16'),a1_0x5ecc('0x17')],'passReqToCallback':!![]},(_0x6ac99d,_0x14b61b,_0x4e52fa,_0x57ac72,_0x4a7827)=>{if(_0x6ac99d[a1_0x5ecc('0x18')]){User_1[a1_0x5ecc('0x7')][a1_0x5ecc('0xc')]({'facebook':_0x57ac72['id']},(_0x1ec71c,_0x283e3c)=>{if(_0x1ec71c){return _0x4a7827(_0x1ec71c);}if(_0x283e3c){_0x6ac99d[a1_0x5ecc('0x19')](a1_0x5ecc('0x1a'),{'msg':a1_0x5ecc('0x1b')});_0x4a7827(_0x1ec71c);}else{User_1['default'][a1_0x5ecc('0x9')](_0x6ac99d[a1_0x5ecc('0x18')]['id'],(_0x1ec71c,_0x4dbd25)=>{if(_0x1ec71c){return _0x4a7827(_0x1ec71c);}_0x4dbd25[a1_0x5ecc('0x1c')]=_0x57ac72['id'];_0x4dbd25[a1_0x5ecc('0x1d')][a1_0x5ecc('0x1e')]({'kind':a1_0x5ecc('0x1c'),'accessToken':_0x14b61b});_0x4dbd25[a1_0x5ecc('0x1f')]['name']=_0x4dbd25[a1_0x5ecc('0x1f')][a1_0x5ecc('0x14')]||_0x57ac72[a1_0x5ecc('0x14')][a1_0x5ecc('0x20')]+'\x20'+_0x57ac72[a1_0x5ecc('0x14')]['familyName'];_0x4dbd25[a1_0x5ecc('0x1f')]['gender']=_0x4dbd25[a1_0x5ecc('0x1f')][a1_0x5ecc('0x21')]||_0x57ac72['_json'][a1_0x5ecc('0x21')];_0x4dbd25[a1_0x5ecc('0x1f')][a1_0x5ecc('0x22')]=_0x4dbd25[a1_0x5ecc('0x1f')][a1_0x5ecc('0x22')]||a1_0x5ecc('0x23')+_0x57ac72['id']+a1_0x5ecc('0x24');_0x4dbd25[a1_0x5ecc('0x25')](_0x1ec71c=>{_0x6ac99d[a1_0x5ecc('0x19')](a1_0x5ecc('0x26'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x4a7827(_0x1ec71c,_0x4dbd25);});});}});}else{User_1['default']['findOne']({'facebook':_0x57ac72['id']},(_0x11450c,_0x2931ed)=>{if(_0x11450c){return _0x4a7827(_0x11450c);}if(_0x2931ed){return _0x4a7827(undefined,_0x2931ed);}User_1['default'][a1_0x5ecc('0xc')]({'email':_0x57ac72[a1_0x5ecc('0x27')][a1_0x5ecc('0xb')]},(_0x11450c,_0x40ed02)=>{if(_0x11450c){return _0x4a7827(_0x11450c);}if(_0x40ed02){_0x6ac99d['flash'](a1_0x5ecc('0x1a'),{'msg':a1_0x5ecc('0x28')});_0x4a7827(_0x11450c);}else{const _0x1ea34d=new User_1[(a1_0x5ecc('0x7'))]();_0x1ea34d['email']=_0x57ac72[a1_0x5ecc('0x27')][a1_0x5ecc('0xb')];_0x1ea34d[a1_0x5ecc('0x1c')]=_0x57ac72['id'];_0x1ea34d[a1_0x5ecc('0x1d')]['push']({'kind':'facebook','accessToken':_0x14b61b});_0x1ea34d[a1_0x5ecc('0x1f')][a1_0x5ecc('0x14')]=_0x57ac72['name'][a1_0x5ecc('0x20')]+'\x20'+_0x57ac72['name'][a1_0x5ecc('0x29')];_0x1ea34d[a1_0x5ecc('0x1f')]['gender']=_0x57ac72['_json']['gender'];_0x1ea34d['profile'][a1_0x5ecc('0x22')]=a1_0x5ecc('0x23')+_0x57ac72['id']+a1_0x5ecc('0x24');_0x1ea34d['profile'][a1_0x5ecc('0x2a')]=_0x57ac72[a1_0x5ecc('0x27')][a1_0x5ecc('0x2a')]?_0x57ac72['_json'][a1_0x5ecc('0x2a')][a1_0x5ecc('0x14')]:'';_0x1ea34d[a1_0x5ecc('0x25')](_0x11450c=>{_0x4a7827(_0x11450c,_0x1ea34d);});}});});}}));exports[a1_0x5ecc('0x2b')]=(_0x3cb30b,_0x599e08,_0x322d5e)=>{if(_0x3cb30b[a1_0x5ecc('0x2b')]()){return _0x322d5e();}_0x599e08[a1_0x5ecc('0x2c')]('/login');};exports[a1_0x5ecc('0x2d')]=(_0x4f3c0d,_0x4d87aa,_0x1972f5)=>{const _0x4156b8=_0x4f3c0d['path'][a1_0x5ecc('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x5ecc('0x2f')](_0x4f3c0d[a1_0x5ecc('0x18')]['tokens'],{'kind':_0x4156b8})){_0x1972f5();}else{_0x4d87aa[a1_0x5ecc('0x2c')]('/auth/'+_0x4156b8);}};