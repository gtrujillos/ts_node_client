var a1_0x1cd4=['profile','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','findOne','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','isAuthorized','slice','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','givenName','familyName','gender','_json'];(function(_0x325d64,_0x8d2515){var _0xba4d5d=function(_0x8d640c){while(--_0x8d640c){_0x325d64['push'](_0x325d64['shift']());}};_0xba4d5d(++_0x8d2515);}(a1_0x1cd4,0x9a));var a1_0x2591=function(_0x542af9,_0x282f05){_0x542af9=_0x542af9-0x0;var _0x187440=a1_0x1cd4[_0x542af9];return _0x187440;};'use strict';var __importDefault=this&&this[a1_0x2591('0x0')]||function(_0x241fbd){return _0x241fbd&&_0x241fbd[a1_0x2591('0x1')]?_0x241fbd:{'default':_0x241fbd};};Object[a1_0x2591('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x2591('0x3')));const passport_local_1=__importDefault(require(a1_0x2591('0x4')));const passport_facebook_1=__importDefault(require(a1_0x2591('0x5')));const lodash_1=__importDefault(require(a1_0x2591('0x6')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x2591('0x7')][a1_0x2591('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x2591('0x7')][a1_0x2591('0x8')];passport_1[a1_0x2591('0x7')][a1_0x2591('0x9')]((_0x65cc3e,_0x5218b0)=>{_0x5218b0(undefined,_0x65cc3e['id']);});passport_1['default'][a1_0x2591('0xa')]((_0x12681e,_0x151ef5)=>{User_1[a1_0x2591('0x7')][a1_0x2591('0xb')](_0x12681e,(_0x56c458,_0x3e88e2)=>{_0x151ef5(_0x56c458,_0x3e88e2);});});passport_1[a1_0x2591('0x7')][a1_0x2591('0xc')](new LocalStrategy({'usernameField':a1_0x2591('0xd')},(_0x5519cf,_0x3686f3,_0x2b508b)=>{User_1[a1_0x2591('0x7')]['findOne']({'email':_0x5519cf[a1_0x2591('0xe')]()},(_0x7f2ce9,_0x4b275e)=>{if(_0x7f2ce9){return _0x2b508b(_0x7f2ce9);}if(!_0x4b275e){return _0x2b508b(undefined,![],{'message':a1_0x2591('0xf')+_0x5519cf+a1_0x2591('0x10')});}_0x4b275e[a1_0x2591('0x11')](_0x3686f3,(_0x7f2ce9,_0x385769)=>{if(_0x7f2ce9){return _0x2b508b(_0x7f2ce9);}if(_0x385769){return _0x2b508b(undefined,_0x4b275e);}return _0x2b508b(undefined,![],{'message':a1_0x2591('0x12')});});});}));passport_1[a1_0x2591('0x7')][a1_0x2591('0xc')](new FacebookStrategy({'clientID':process[a1_0x2591('0x13')][a1_0x2591('0x14')],'clientSecret':process[a1_0x2591('0x13')][a1_0x2591('0x15')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x2591('0x16'),a1_0x2591('0xd'),'link','locale','timezone'],'passReqToCallback':!![]},(_0x4c013f,_0x170b9a,_0x14ae29,_0x1e4459,_0x38b242)=>{if(_0x4c013f[a1_0x2591('0x17')]){User_1[a1_0x2591('0x7')]['findOne']({'facebook':_0x1e4459['id']},(_0x348137,_0x5d034b)=>{if(_0x348137){return _0x38b242(_0x348137);}if(_0x5d034b){_0x4c013f[a1_0x2591('0x18')](a1_0x2591('0x19'),{'msg':a1_0x2591('0x1a')});_0x38b242(_0x348137);}else{User_1[a1_0x2591('0x7')]['findById'](_0x4c013f['user']['id'],(_0x348137,_0x2866a3)=>{if(_0x348137){return _0x38b242(_0x348137);}_0x2866a3[a1_0x2591('0x1b')]=_0x1e4459['id'];_0x2866a3[a1_0x2591('0x1c')][a1_0x2591('0x1d')]({'kind':a1_0x2591('0x1b'),'accessToken':_0x170b9a});_0x2866a3['profile']['name']=_0x2866a3['profile'][a1_0x2591('0x16')]||_0x1e4459[a1_0x2591('0x16')][a1_0x2591('0x1e')]+'\x20'+_0x1e4459[a1_0x2591('0x16')][a1_0x2591('0x1f')];_0x2866a3['profile']['gender']=_0x2866a3['profile'][a1_0x2591('0x20')]||_0x1e4459[a1_0x2591('0x21')]['gender'];_0x2866a3[a1_0x2591('0x22')][a1_0x2591('0x23')]=_0x2866a3[a1_0x2591('0x22')][a1_0x2591('0x23')]||a1_0x2591('0x24')+_0x1e4459['id']+a1_0x2591('0x25');_0x2866a3[a1_0x2591('0x26')](_0x348137=>{_0x4c013f[a1_0x2591('0x18')]('info',{'msg':a1_0x2591('0x27')});_0x38b242(_0x348137,_0x2866a3);});});}});}else{User_1[a1_0x2591('0x7')][a1_0x2591('0x28')]({'facebook':_0x1e4459['id']},(_0x10b148,_0x1ab046)=>{if(_0x10b148){return _0x38b242(_0x10b148);}if(_0x1ab046){return _0x38b242(undefined,_0x1ab046);}User_1[a1_0x2591('0x7')][a1_0x2591('0x28')]({'email':_0x1e4459[a1_0x2591('0x21')][a1_0x2591('0xd')]},(_0x10b148,_0x452384)=>{if(_0x10b148){return _0x38b242(_0x10b148);}if(_0x452384){_0x4c013f['flash'](a1_0x2591('0x19'),{'msg':a1_0x2591('0x29')});_0x38b242(_0x10b148);}else{const _0x56253d=new User_1[(a1_0x2591('0x7'))]();_0x56253d[a1_0x2591('0xd')]=_0x1e4459['_json']['email'];_0x56253d['facebook']=_0x1e4459['id'];_0x56253d[a1_0x2591('0x1c')][a1_0x2591('0x1d')]({'kind':a1_0x2591('0x1b'),'accessToken':_0x170b9a});_0x56253d[a1_0x2591('0x22')][a1_0x2591('0x16')]=_0x1e4459[a1_0x2591('0x16')][a1_0x2591('0x1e')]+'\x20'+_0x1e4459[a1_0x2591('0x16')][a1_0x2591('0x1f')];_0x56253d[a1_0x2591('0x22')][a1_0x2591('0x20')]=_0x1e4459['_json'][a1_0x2591('0x20')];_0x56253d[a1_0x2591('0x22')][a1_0x2591('0x23')]=a1_0x2591('0x24')+_0x1e4459['id']+a1_0x2591('0x25');_0x56253d[a1_0x2591('0x22')][a1_0x2591('0x2a')]=_0x1e4459[a1_0x2591('0x21')][a1_0x2591('0x2a')]?_0x1e4459[a1_0x2591('0x21')][a1_0x2591('0x2a')][a1_0x2591('0x16')]:'';_0x56253d['save'](_0x10b148=>{_0x38b242(_0x10b148,_0x56253d);});}});});}}));exports[a1_0x2591('0x2b')]=(_0x475e51,_0xa8bef,_0x23aedb)=>{if(_0x475e51[a1_0x2591('0x2b')]()){return _0x23aedb();}_0xa8bef[a1_0x2591('0x2c')]('/login');};exports[a1_0x2591('0x2d')]=(_0x388212,_0x22036e,_0x19b715)=>{const _0x149e12=_0x388212['path']['split']('/')[a1_0x2591('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x2591('0x7')]['find'](_0x388212[a1_0x2591('0x17')][a1_0x2591('0x1c')],{'kind':_0x149e12})){_0x19b715();}else{_0x22036e[a1_0x2591('0x2c')]('/auth/'+_0x149e12);}};