var a1_0x4355=['split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','use','email','findOne','toLowerCase','Email\x20','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','/login','isAuthorized'];(function(_0x279172,_0x4256fa){var _0x1098a3=function(_0x5d0039){while(--_0x5d0039){_0x279172['push'](_0x279172['shift']());}};_0x1098a3(++_0x4256fa);}(a1_0x4355,0x9a));var a1_0x5407=function(_0x27b823,_0x304f1d){_0x27b823=_0x27b823-0x0;var _0x425e9f=a1_0x4355[_0x27b823];return _0x425e9f;};'use strict';var __importDefault=this&&this[a1_0x5407('0x0')]||function(_0x2aa0cc){return _0x2aa0cc&&_0x2aa0cc[a1_0x5407('0x1')]?_0x2aa0cc:{'default':_0x2aa0cc};};Object[a1_0x5407('0x2')](exports,a1_0x5407('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x5407('0x3')));const passport_facebook_1=__importDefault(require(a1_0x5407('0x4')));const lodash_1=__importDefault(require(a1_0x5407('0x5')));const User_1=__importDefault(require(a1_0x5407('0x6')));const LocalStrategy=passport_local_1[a1_0x5407('0x7')][a1_0x5407('0x8')];const FacebookStrategy=passport_facebook_1['default'][a1_0x5407('0x8')];passport_1[a1_0x5407('0x7')]['serializeUser']((_0x31d1e3,_0x40ed8b)=>{_0x40ed8b(undefined,_0x31d1e3['id']);});passport_1['default']['deserializeUser']((_0x54ba9a,_0x5d2cb9)=>{User_1[a1_0x5407('0x7')]['findById'](_0x54ba9a,(_0x4e5fb3,_0x54681e)=>{_0x5d2cb9(_0x4e5fb3,_0x54681e);});});passport_1['default'][a1_0x5407('0x9')](new LocalStrategy({'usernameField':a1_0x5407('0xa')},(_0x4796af,_0x9de4e1,_0xfd848b)=>{User_1[a1_0x5407('0x7')][a1_0x5407('0xb')]({'email':_0x4796af[a1_0x5407('0xc')]()},(_0x4c678f,_0x49c226)=>{if(_0x4c678f){return _0xfd848b(_0x4c678f);}if(!_0x49c226){return _0xfd848b(undefined,![],{'message':a1_0x5407('0xd')+_0x4796af+'\x20not\x20found.'});}_0x49c226['comparePassword'](_0x9de4e1,(_0x4c678f,_0x30ee44)=>{if(_0x4c678f){return _0xfd848b(_0x4c678f);}if(_0x30ee44){return _0xfd848b(undefined,_0x49c226);}return _0xfd848b(undefined,![],{'message':a1_0x5407('0xe')});});});}));passport_1['default'][a1_0x5407('0x9')](new FacebookStrategy({'clientID':process[a1_0x5407('0xf')][a1_0x5407('0x10')],'clientSecret':process[a1_0x5407('0xf')][a1_0x5407('0x11')],'callbackURL':a1_0x5407('0x12'),'profileFields':[a1_0x5407('0x13'),a1_0x5407('0xa'),a1_0x5407('0x14'),a1_0x5407('0x15'),a1_0x5407('0x16')],'passReqToCallback':!![]},(_0x5e6785,_0x16aad6,_0x1e96ec,_0x4d3007,_0x290a11)=>{if(_0x5e6785[a1_0x5407('0x17')]){User_1[a1_0x5407('0x7')][a1_0x5407('0xb')]({'facebook':_0x4d3007['id']},(_0x1eac29,_0x5d10fc)=>{if(_0x1eac29){return _0x290a11(_0x1eac29);}if(_0x5d10fc){_0x5e6785[a1_0x5407('0x18')](a1_0x5407('0x19'),{'msg':a1_0x5407('0x1a')});_0x290a11(_0x1eac29);}else{User_1[a1_0x5407('0x7')]['findById'](_0x5e6785[a1_0x5407('0x17')]['id'],(_0x1eac29,_0x323c0c)=>{if(_0x1eac29){return _0x290a11(_0x1eac29);}_0x323c0c[a1_0x5407('0x1b')]=_0x4d3007['id'];_0x323c0c[a1_0x5407('0x1c')][a1_0x5407('0x1d')]({'kind':a1_0x5407('0x1b'),'accessToken':_0x16aad6});_0x323c0c[a1_0x5407('0x1e')][a1_0x5407('0x13')]=_0x323c0c[a1_0x5407('0x1e')][a1_0x5407('0x13')]||_0x4d3007[a1_0x5407('0x13')][a1_0x5407('0x1f')]+'\x20'+_0x4d3007[a1_0x5407('0x13')][a1_0x5407('0x20')];_0x323c0c['profile'][a1_0x5407('0x21')]=_0x323c0c[a1_0x5407('0x1e')][a1_0x5407('0x21')]||_0x4d3007[a1_0x5407('0x22')][a1_0x5407('0x21')];_0x323c0c[a1_0x5407('0x1e')][a1_0x5407('0x23')]=_0x323c0c['profile'][a1_0x5407('0x23')]||a1_0x5407('0x24')+_0x4d3007['id']+'/picture?type=large';_0x323c0c[a1_0x5407('0x25')](_0x1eac29=>{_0x5e6785[a1_0x5407('0x18')](a1_0x5407('0x26'),{'msg':a1_0x5407('0x27')});_0x290a11(_0x1eac29,_0x323c0c);});});}});}else{User_1[a1_0x5407('0x7')][a1_0x5407('0xb')]({'facebook':_0x4d3007['id']},(_0x3d38ac,_0x4f1cce)=>{if(_0x3d38ac){return _0x290a11(_0x3d38ac);}if(_0x4f1cce){return _0x290a11(undefined,_0x4f1cce);}User_1[a1_0x5407('0x7')][a1_0x5407('0xb')]({'email':_0x4d3007[a1_0x5407('0x22')]['email']},(_0x3d38ac,_0x159438)=>{if(_0x3d38ac){return _0x290a11(_0x3d38ac);}if(_0x159438){_0x5e6785[a1_0x5407('0x18')](a1_0x5407('0x19'),{'msg':a1_0x5407('0x28')});_0x290a11(_0x3d38ac);}else{const _0x194a66=new User_1['default']();_0x194a66[a1_0x5407('0xa')]=_0x4d3007[a1_0x5407('0x22')]['email'];_0x194a66[a1_0x5407('0x1b')]=_0x4d3007['id'];_0x194a66[a1_0x5407('0x1c')][a1_0x5407('0x1d')]({'kind':'facebook','accessToken':_0x16aad6});_0x194a66['profile'][a1_0x5407('0x13')]=_0x4d3007[a1_0x5407('0x13')][a1_0x5407('0x1f')]+'\x20'+_0x4d3007['name'][a1_0x5407('0x20')];_0x194a66[a1_0x5407('0x1e')][a1_0x5407('0x21')]=_0x4d3007['_json']['gender'];_0x194a66[a1_0x5407('0x1e')]['picture']=a1_0x5407('0x24')+_0x4d3007['id']+'/picture?type=large';_0x194a66['profile']['location']=_0x4d3007['_json'][a1_0x5407('0x29')]?_0x4d3007[a1_0x5407('0x22')][a1_0x5407('0x29')][a1_0x5407('0x13')]:'';_0x194a66[a1_0x5407('0x25')](_0x3d38ac=>{_0x290a11(_0x3d38ac,_0x194a66);});}});});}}));exports['isAuthenticated']=(_0x2bc32a,_0x7c8dda,_0x3a68ab)=>{if(_0x2bc32a[a1_0x5407('0x2a')]()){return _0x3a68ab();}_0x7c8dda[a1_0x5407('0x2b')](a1_0x5407('0x2c'));};exports[a1_0x5407('0x2d')]=(_0x5b761,_0x44c8f2,_0x2474ef)=>{const _0x5ddc5e=_0x5b761['path'][a1_0x5407('0x2e')]('/')[a1_0x5407('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x5407('0x7')][a1_0x5407('0x30')](_0x5b761[a1_0x5407('0x17')][a1_0x5407('0x1c')],{'kind':_0x5ddc5e})){_0x2474ef();}else{_0x44c8f2[a1_0x5407('0x2b')](a1_0x5407('0x31')+_0x5ddc5e);}};