var a1_0x12b2=['givenName','familyName','gender','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','_json','flash','errors','picture','location','save','isAuthenticated','redirect','/login','path','split','slice','/auth/','__importDefault','__esModule','defineProperty','passport-local','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','name','link','locale','timezone','user','findOne','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile'];(function(_0xd49644,_0x3e7dd1){var _0x13c0a5=function(_0x2eb040){while(--_0x2eb040){_0xd49644['push'](_0xd49644['shift']());}};_0x13c0a5(++_0x3e7dd1);}(a1_0x12b2,0x78));var a1_0x2f63=function(_0x425cbb,_0x15e1d2){_0x425cbb=_0x425cbb-0x0;var _0x1ac369=a1_0x12b2[_0x425cbb];return _0x1ac369;};'use strict';var __importDefault=this&&this[a1_0x2f63('0x0')]||function(_0x17321a){return _0x17321a&&_0x17321a[a1_0x2f63('0x1')]?_0x17321a:{'default':_0x17321a};};Object[a1_0x2f63('0x2')](exports,a1_0x2f63('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x2f63('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x2f63('0x4')));const User_1=__importDefault(require(a1_0x2f63('0x5')));const LocalStrategy=passport_local_1[a1_0x2f63('0x6')][a1_0x2f63('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x2f63('0x6')][a1_0x2f63('0x7')];passport_1[a1_0x2f63('0x6')][a1_0x2f63('0x8')]((_0x404b12,_0x19d6bb)=>{_0x19d6bb(undefined,_0x404b12['id']);});passport_1[a1_0x2f63('0x6')][a1_0x2f63('0x9')]((_0x221cab,_0x1af07f)=>{User_1[a1_0x2f63('0x6')][a1_0x2f63('0xa')](_0x221cab,(_0x194b2b,_0x29d07b)=>{_0x1af07f(_0x194b2b,_0x29d07b);});});passport_1[a1_0x2f63('0x6')][a1_0x2f63('0xb')](new LocalStrategy({'usernameField':a1_0x2f63('0xc')},(_0x5cd52c,_0x144d0f,_0x109685)=>{User_1['default']['findOne']({'email':_0x5cd52c[a1_0x2f63('0xd')]()},(_0x465cc0,_0x193508)=>{if(_0x465cc0){return _0x109685(_0x465cc0);}if(!_0x193508){return _0x109685(undefined,![],{'message':'Email\x20'+_0x5cd52c+a1_0x2f63('0xe')});}_0x193508[a1_0x2f63('0xf')](_0x144d0f,(_0x465cc0,_0x18743e)=>{if(_0x465cc0){return _0x109685(_0x465cc0);}if(_0x18743e){return _0x109685(undefined,_0x193508);}return _0x109685(undefined,![],{'message':a1_0x2f63('0x10')});});});}));passport_1[a1_0x2f63('0x6')][a1_0x2f63('0xb')](new FacebookStrategy({'clientID':process[a1_0x2f63('0x11')]['FACEBOOK_ID'],'clientSecret':process[a1_0x2f63('0x11')][a1_0x2f63('0x12')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x2f63('0x13'),a1_0x2f63('0xc'),a1_0x2f63('0x14'),a1_0x2f63('0x15'),a1_0x2f63('0x16')],'passReqToCallback':!![]},(_0x44c64e,_0x212489,_0x1fd7d1,_0x445bd6,_0xc48d58)=>{if(_0x44c64e[a1_0x2f63('0x17')]){User_1[a1_0x2f63('0x6')][a1_0x2f63('0x18')]({'facebook':_0x445bd6['id']},(_0x31ae8f,_0x59bce9)=>{if(_0x31ae8f){return _0xc48d58(_0x31ae8f);}if(_0x59bce9){_0x44c64e['flash']('errors',{'msg':a1_0x2f63('0x19')});_0xc48d58(_0x31ae8f);}else{User_1[a1_0x2f63('0x6')][a1_0x2f63('0xa')](_0x44c64e[a1_0x2f63('0x17')]['id'],(_0x31ae8f,_0x3050b5)=>{if(_0x31ae8f){return _0xc48d58(_0x31ae8f);}_0x3050b5['facebook']=_0x445bd6['id'];_0x3050b5[a1_0x2f63('0x1a')][a1_0x2f63('0x1b')]({'kind':a1_0x2f63('0x1c'),'accessToken':_0x212489});_0x3050b5[a1_0x2f63('0x1d')][a1_0x2f63('0x13')]=_0x3050b5[a1_0x2f63('0x1d')][a1_0x2f63('0x13')]||_0x445bd6['name'][a1_0x2f63('0x1e')]+'\x20'+_0x445bd6['name'][a1_0x2f63('0x1f')];_0x3050b5[a1_0x2f63('0x1d')][a1_0x2f63('0x20')]=_0x3050b5[a1_0x2f63('0x1d')][a1_0x2f63('0x20')]||_0x445bd6['_json'][a1_0x2f63('0x20')];_0x3050b5[a1_0x2f63('0x1d')]['picture']=_0x3050b5[a1_0x2f63('0x1d')]['picture']||a1_0x2f63('0x21')+_0x445bd6['id']+a1_0x2f63('0x22');_0x3050b5['save'](_0x31ae8f=>{_0x44c64e['flash'](a1_0x2f63('0x23'),{'msg':a1_0x2f63('0x24')});_0xc48d58(_0x31ae8f,_0x3050b5);});});}});}else{User_1[a1_0x2f63('0x6')][a1_0x2f63('0x18')]({'facebook':_0x445bd6['id']},(_0x405223,_0x1b78f2)=>{if(_0x405223){return _0xc48d58(_0x405223);}if(_0x1b78f2){return _0xc48d58(undefined,_0x1b78f2);}User_1[a1_0x2f63('0x6')][a1_0x2f63('0x18')]({'email':_0x445bd6[a1_0x2f63('0x25')][a1_0x2f63('0xc')]},(_0x405223,_0x30e059)=>{if(_0x405223){return _0xc48d58(_0x405223);}if(_0x30e059){_0x44c64e[a1_0x2f63('0x26')](a1_0x2f63('0x27'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0xc48d58(_0x405223);}else{const _0x4f6339=new User_1[(a1_0x2f63('0x6'))]();_0x4f6339['email']=_0x445bd6[a1_0x2f63('0x25')][a1_0x2f63('0xc')];_0x4f6339[a1_0x2f63('0x1c')]=_0x445bd6['id'];_0x4f6339['tokens']['push']({'kind':'facebook','accessToken':_0x212489});_0x4f6339[a1_0x2f63('0x1d')][a1_0x2f63('0x13')]=_0x445bd6[a1_0x2f63('0x13')][a1_0x2f63('0x1e')]+'\x20'+_0x445bd6[a1_0x2f63('0x13')]['familyName'];_0x4f6339[a1_0x2f63('0x1d')][a1_0x2f63('0x20')]=_0x445bd6[a1_0x2f63('0x25')][a1_0x2f63('0x20')];_0x4f6339[a1_0x2f63('0x1d')][a1_0x2f63('0x28')]=a1_0x2f63('0x21')+_0x445bd6['id']+a1_0x2f63('0x22');_0x4f6339[a1_0x2f63('0x1d')]['location']=_0x445bd6[a1_0x2f63('0x25')][a1_0x2f63('0x29')]?_0x445bd6[a1_0x2f63('0x25')]['location'][a1_0x2f63('0x13')]:'';_0x4f6339[a1_0x2f63('0x2a')](_0x405223=>{_0xc48d58(_0x405223,_0x4f6339);});}});});}}));exports[a1_0x2f63('0x2b')]=(_0x26088c,_0x568662,_0x12ca44)=>{if(_0x26088c['isAuthenticated']()){return _0x12ca44();}_0x568662[a1_0x2f63('0x2c')](a1_0x2f63('0x2d'));};exports['isAuthorized']=(_0x5735a7,_0x3590d0,_0x98bedc)=>{const _0x23d316=_0x5735a7[a1_0x2f63('0x2e')][a1_0x2f63('0x2f')]('/')[a1_0x2f63('0x30')](-0x1)[0x0];if(lodash_1[a1_0x2f63('0x6')]['find'](_0x5735a7[a1_0x2f63('0x17')][a1_0x2f63('0x1a')],{'kind':_0x23d316})){_0x98bedc();}else{_0x3590d0[a1_0x2f63('0x2c')](a1_0x2f63('0x31')+_0x23d316);}};