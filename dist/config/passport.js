var a1_0x3526=['isAuthenticated','redirect','path','slice','find','/auth/','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','email','findOne','\x20not\x20found.','comparePassword','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','familyName','gender','picture','https://graph.facebook.com/','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','_json','givenName','/picture?type=large','location','save'];(function(_0x2ef09e,_0x38170d){var _0x265fee=function(_0x36cebb){while(--_0x36cebb){_0x2ef09e['push'](_0x2ef09e['shift']());}};_0x265fee(++_0x38170d);}(a1_0x3526,0xce));var a1_0x4bcc=function(_0x2064fb,_0xb5bb74){_0x2064fb=_0x2064fb-0x0;var _0x5e94b2=a1_0x3526[_0x2064fb];return _0x5e94b2;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x166e69){return _0x166e69&&_0x166e69[a1_0x4bcc('0x0')]?_0x166e69:{'default':_0x166e69};};Object[a1_0x4bcc('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4bcc('0x2')));const passport_local_1=__importDefault(require(a1_0x4bcc('0x3')));const passport_facebook_1=__importDefault(require(a1_0x4bcc('0x4')));const lodash_1=__importDefault(require(a1_0x4bcc('0x5')));const User_1=__importDefault(require(a1_0x4bcc('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x4bcc('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x4bcc('0x8')]['Strategy'];passport_1[a1_0x4bcc('0x8')][a1_0x4bcc('0x9')]((_0x535a3f,_0x309e94)=>{_0x309e94(undefined,_0x535a3f['id']);});passport_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xa')]((_0x1867ee,_0x2da841)=>{User_1['default'][a1_0x4bcc('0xb')](_0x1867ee,(_0x249a51,_0x5eb4b3)=>{_0x2da841(_0x249a51,_0x5eb4b3);});});passport_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xc')](new LocalStrategy({'usernameField':a1_0x4bcc('0xd')},(_0x19224d,_0x299596,_0x30657a)=>{User_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xe')]({'email':_0x19224d['toLowerCase']()},(_0xf6584f,_0x3f498d)=>{if(_0xf6584f){return _0x30657a(_0xf6584f);}if(!_0x3f498d){return _0x30657a(undefined,![],{'message':'Email\x20'+_0x19224d+a1_0x4bcc('0xf')});}_0x3f498d[a1_0x4bcc('0x10')](_0x299596,(_0xf6584f,_0x4dc188)=>{if(_0xf6584f){return _0x30657a(_0xf6584f);}if(_0x4dc188){return _0x30657a(undefined,_0x3f498d);}return _0x30657a(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xc')](new FacebookStrategy({'clientID':process['env'][a1_0x4bcc('0x11')],'clientSecret':process[a1_0x4bcc('0x12')][a1_0x4bcc('0x13')],'callbackURL':a1_0x4bcc('0x14'),'profileFields':[a1_0x4bcc('0x15'),a1_0x4bcc('0xd'),a1_0x4bcc('0x16'),a1_0x4bcc('0x17'),a1_0x4bcc('0x18')],'passReqToCallback':!![]},(_0x5d30cd,_0xd7ac3e,_0x51e808,_0x57ab99,_0x4f0971)=>{if(_0x5d30cd[a1_0x4bcc('0x19')]){User_1['default']['findOne']({'facebook':_0x57ab99['id']},(_0x181166,_0x1ce81f)=>{if(_0x181166){return _0x4f0971(_0x181166);}if(_0x1ce81f){_0x5d30cd[a1_0x4bcc('0x1a')](a1_0x4bcc('0x1b'),{'msg':a1_0x4bcc('0x1c')});_0x4f0971(_0x181166);}else{User_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xb')](_0x5d30cd[a1_0x4bcc('0x19')]['id'],(_0x181166,_0x2e79d5)=>{if(_0x181166){return _0x4f0971(_0x181166);}_0x2e79d5[a1_0x4bcc('0x1d')]=_0x57ab99['id'];_0x2e79d5[a1_0x4bcc('0x1e')][a1_0x4bcc('0x1f')]({'kind':a1_0x4bcc('0x1d'),'accessToken':_0xd7ac3e});_0x2e79d5[a1_0x4bcc('0x20')][a1_0x4bcc('0x15')]=_0x2e79d5[a1_0x4bcc('0x20')][a1_0x4bcc('0x15')]||_0x57ab99[a1_0x4bcc('0x15')]['givenName']+'\x20'+_0x57ab99['name'][a1_0x4bcc('0x21')];_0x2e79d5[a1_0x4bcc('0x20')]['gender']=_0x2e79d5[a1_0x4bcc('0x20')]['gender']||_0x57ab99['_json'][a1_0x4bcc('0x22')];_0x2e79d5[a1_0x4bcc('0x20')][a1_0x4bcc('0x23')]=_0x2e79d5[a1_0x4bcc('0x20')][a1_0x4bcc('0x23')]||a1_0x4bcc('0x24')+_0x57ab99['id']+'/picture?type=large';_0x2e79d5['save'](_0x181166=>{_0x5d30cd[a1_0x4bcc('0x1a')](a1_0x4bcc('0x25'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x4f0971(_0x181166,_0x2e79d5);});});}});}else{User_1[a1_0x4bcc('0x8')]['findOne']({'facebook':_0x57ab99['id']},(_0x3efe04,_0x20d232)=>{if(_0x3efe04){return _0x4f0971(_0x3efe04);}if(_0x20d232){return _0x4f0971(undefined,_0x20d232);}User_1[a1_0x4bcc('0x8')][a1_0x4bcc('0xe')]({'email':_0x57ab99['_json'][a1_0x4bcc('0xd')]},(_0x3efe04,_0x45cf15)=>{if(_0x3efe04){return _0x4f0971(_0x3efe04);}if(_0x45cf15){_0x5d30cd[a1_0x4bcc('0x1a')](a1_0x4bcc('0x1b'),{'msg':a1_0x4bcc('0x26')});_0x4f0971(_0x3efe04);}else{const _0xfa23d9=new User_1[(a1_0x4bcc('0x8'))]();_0xfa23d9[a1_0x4bcc('0xd')]=_0x57ab99[a1_0x4bcc('0x27')][a1_0x4bcc('0xd')];_0xfa23d9[a1_0x4bcc('0x1d')]=_0x57ab99['id'];_0xfa23d9[a1_0x4bcc('0x1e')][a1_0x4bcc('0x1f')]({'kind':a1_0x4bcc('0x1d'),'accessToken':_0xd7ac3e});_0xfa23d9['profile'][a1_0x4bcc('0x15')]=_0x57ab99[a1_0x4bcc('0x15')][a1_0x4bcc('0x28')]+'\x20'+_0x57ab99[a1_0x4bcc('0x15')][a1_0x4bcc('0x21')];_0xfa23d9[a1_0x4bcc('0x20')][a1_0x4bcc('0x22')]=_0x57ab99['_json']['gender'];_0xfa23d9[a1_0x4bcc('0x20')][a1_0x4bcc('0x23')]=a1_0x4bcc('0x24')+_0x57ab99['id']+a1_0x4bcc('0x29');_0xfa23d9[a1_0x4bcc('0x20')][a1_0x4bcc('0x2a')]=_0x57ab99['_json']['location']?_0x57ab99[a1_0x4bcc('0x27')]['location'][a1_0x4bcc('0x15')]:'';_0xfa23d9[a1_0x4bcc('0x2b')](_0x3efe04=>{_0x4f0971(_0x3efe04,_0xfa23d9);});}});});}}));exports[a1_0x4bcc('0x2c')]=(_0x4c74b1,_0x52c094,_0x650e67)=>{if(_0x4c74b1[a1_0x4bcc('0x2c')]()){return _0x650e67();}_0x52c094[a1_0x4bcc('0x2d')]('/login');};exports['isAuthorized']=(_0x5b4879,_0x2f26cd,_0x5649af)=>{const _0x2653cc=_0x5b4879[a1_0x4bcc('0x2e')]['split']('/')[a1_0x4bcc('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x4bcc('0x8')][a1_0x4bcc('0x30')](_0x5b4879[a1_0x4bcc('0x19')][a1_0x4bcc('0x1e')],{'kind':_0x2653cc})){_0x5649af();}else{_0x2f26cd['redirect'](a1_0x4bcc('0x31')+_0x2653cc);}};