var a1_0x1e80=['FACEBOOK_SECRET','name','link','locale','timezone','user','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','familyName','profile','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','email','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','location','isAuthenticated','isAuthorized','path','find','/auth/','__esModule','defineProperty','passport','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','findOne','toLowerCase','use','env','FACEBOOK_ID'];(function(_0x1040ab,_0x485472){var _0x373f6a=function(_0x27905d){while(--_0x27905d){_0x1040ab['push'](_0x1040ab['shift']());}};_0x373f6a(++_0x485472);}(a1_0x1e80,0x1eb));var a1_0x2e5d=function(_0x580489,_0x7c2650){_0x580489=_0x580489-0x0;var _0x2a496e=a1_0x1e80[_0x580489];return _0x2a496e;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1c8ef6){return _0x1c8ef6&&_0x1c8ef6[a1_0x2e5d('0x0')]?_0x1c8ef6:{'default':_0x1c8ef6};};Object[a1_0x2e5d('0x1')](exports,a1_0x2e5d('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2e5d('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x2e5d('0x3')));const lodash_1=__importDefault(require(a1_0x2e5d('0x4')));const User_1=__importDefault(require(a1_0x2e5d('0x5')));const LocalStrategy=passport_local_1[a1_0x2e5d('0x6')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x2e5d('0x6')][a1_0x2e5d('0x7')];passport_1[a1_0x2e5d('0x6')]['serializeUser']((_0x1dc7b4,_0xb91a3f)=>{_0xb91a3f(undefined,_0x1dc7b4['id']);});passport_1[a1_0x2e5d('0x6')][a1_0x2e5d('0x8')]((_0x14518f,_0x2e526b)=>{User_1[a1_0x2e5d('0x6')][a1_0x2e5d('0x9')](_0x14518f,(_0x51c255,_0x2385cd)=>{_0x2e526b(_0x51c255,_0x2385cd);});});passport_1[a1_0x2e5d('0x6')]['use'](new LocalStrategy({'usernameField':'email'},(_0x10acfa,_0x448380,_0x40245a)=>{User_1[a1_0x2e5d('0x6')][a1_0x2e5d('0xa')]({'email':_0x10acfa[a1_0x2e5d('0xb')]()},(_0x4e4eac,_0x24a61d)=>{if(_0x4e4eac){return _0x40245a(_0x4e4eac);}if(!_0x24a61d){return _0x40245a(undefined,![],{'message':'Email\x20'+_0x10acfa+'\x20not\x20found.'});}_0x24a61d['comparePassword'](_0x448380,(_0x4e4eac,_0x2692ab)=>{if(_0x4e4eac){return _0x40245a(_0x4e4eac);}if(_0x2692ab){return _0x40245a(undefined,_0x24a61d);}return _0x40245a(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1['default'][a1_0x2e5d('0xc')](new FacebookStrategy({'clientID':process[a1_0x2e5d('0xd')][a1_0x2e5d('0xe')],'clientSecret':process[a1_0x2e5d('0xd')][a1_0x2e5d('0xf')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x2e5d('0x10'),'email',a1_0x2e5d('0x11'),a1_0x2e5d('0x12'),a1_0x2e5d('0x13')],'passReqToCallback':!![]},(_0x16f4fb,_0x105c4b,_0x3d086f,_0x918e4,_0x19b8a6)=>{if(_0x16f4fb[a1_0x2e5d('0x14')]){User_1[a1_0x2e5d('0x6')][a1_0x2e5d('0xa')]({'facebook':_0x918e4['id']},(_0xaf0490,_0x1a2589)=>{if(_0xaf0490){return _0x19b8a6(_0xaf0490);}if(_0x1a2589){_0x16f4fb['flash'](a1_0x2e5d('0x15'),{'msg':a1_0x2e5d('0x16')});_0x19b8a6(_0xaf0490);}else{User_1[a1_0x2e5d('0x6')][a1_0x2e5d('0x9')](_0x16f4fb[a1_0x2e5d('0x14')]['id'],(_0xaf0490,_0x25d7cf)=>{if(_0xaf0490){return _0x19b8a6(_0xaf0490);}_0x25d7cf[a1_0x2e5d('0x17')]=_0x918e4['id'];_0x25d7cf[a1_0x2e5d('0x18')][a1_0x2e5d('0x19')]({'kind':a1_0x2e5d('0x17'),'accessToken':_0x105c4b});_0x25d7cf['profile'][a1_0x2e5d('0x10')]=_0x25d7cf['profile']['name']||_0x918e4['name']['givenName']+'\x20'+_0x918e4[a1_0x2e5d('0x10')][a1_0x2e5d('0x1a')];_0x25d7cf[a1_0x2e5d('0x1b')][a1_0x2e5d('0x1c')]=_0x25d7cf[a1_0x2e5d('0x1b')][a1_0x2e5d('0x1c')]||_0x918e4[a1_0x2e5d('0x1d')]['gender'];_0x25d7cf[a1_0x2e5d('0x1b')]['picture']=_0x25d7cf[a1_0x2e5d('0x1b')][a1_0x2e5d('0x1e')]||a1_0x2e5d('0x1f')+_0x918e4['id']+a1_0x2e5d('0x20');_0x25d7cf[a1_0x2e5d('0x21')](_0xaf0490=>{_0x16f4fb[a1_0x2e5d('0x22')](a1_0x2e5d('0x23'),{'msg':a1_0x2e5d('0x24')});_0x19b8a6(_0xaf0490,_0x25d7cf);});});}});}else{User_1[a1_0x2e5d('0x6')]['findOne']({'facebook':_0x918e4['id']},(_0x487c4e,_0x445efd)=>{if(_0x487c4e){return _0x19b8a6(_0x487c4e);}if(_0x445efd){return _0x19b8a6(undefined,_0x445efd);}User_1[a1_0x2e5d('0x6')][a1_0x2e5d('0xa')]({'email':_0x918e4[a1_0x2e5d('0x1d')][a1_0x2e5d('0x25')]},(_0x487c4e,_0x1658c3)=>{if(_0x487c4e){return _0x19b8a6(_0x487c4e);}if(_0x1658c3){_0x16f4fb[a1_0x2e5d('0x22')](a1_0x2e5d('0x15'),{'msg':a1_0x2e5d('0x26')});_0x19b8a6(_0x487c4e);}else{const _0x1214a2=new User_1[(a1_0x2e5d('0x6'))]();_0x1214a2[a1_0x2e5d('0x25')]=_0x918e4['_json']['email'];_0x1214a2[a1_0x2e5d('0x17')]=_0x918e4['id'];_0x1214a2['tokens'][a1_0x2e5d('0x19')]({'kind':a1_0x2e5d('0x17'),'accessToken':_0x105c4b});_0x1214a2[a1_0x2e5d('0x1b')]['name']=_0x918e4['name'][a1_0x2e5d('0x27')]+'\x20'+_0x918e4[a1_0x2e5d('0x10')][a1_0x2e5d('0x1a')];_0x1214a2[a1_0x2e5d('0x1b')]['gender']=_0x918e4[a1_0x2e5d('0x1d')][a1_0x2e5d('0x1c')];_0x1214a2[a1_0x2e5d('0x1b')]['picture']='https://graph.facebook.com/'+_0x918e4['id']+a1_0x2e5d('0x20');_0x1214a2[a1_0x2e5d('0x1b')][a1_0x2e5d('0x28')]=_0x918e4['_json'][a1_0x2e5d('0x28')]?_0x918e4[a1_0x2e5d('0x1d')][a1_0x2e5d('0x28')][a1_0x2e5d('0x10')]:'';_0x1214a2[a1_0x2e5d('0x21')](_0x487c4e=>{_0x19b8a6(_0x487c4e,_0x1214a2);});}});});}}));exports[a1_0x2e5d('0x29')]=(_0x515204,_0x23874b,_0x339ece)=>{if(_0x515204[a1_0x2e5d('0x29')]()){return _0x339ece();}_0x23874b['redirect']('/login');};exports[a1_0x2e5d('0x2a')]=(_0x3bca3c,_0x230fe4,_0x33630a)=>{const _0x1417a1=_0x3bca3c[a1_0x2e5d('0x2b')]['split']('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x2e5d('0x2c')](_0x3bca3c[a1_0x2e5d('0x14')][a1_0x2e5d('0x18')],{'kind':_0x1417a1})){_0x33630a();}else{_0x230fe4['redirect'](a1_0x2e5d('0x2d')+_0x1417a1);}};