var a1_0x25c2=['save','isAuthenticated','/login','isAuthorized','path','slice','/auth/','__importDefault','defineProperty','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','profile','name','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','location'];(function(_0x3b57a2,_0x84169f){var _0xc054a8=function(_0x25daa6){while(--_0x25daa6){_0x3b57a2['push'](_0x3b57a2['shift']());}};_0xc054a8(++_0x84169f);}(a1_0x25c2,0xbf));var a1_0x25f1=function(_0xe3c694,_0xd757d){_0xe3c694=_0xe3c694-0x0;var _0x5defc6=a1_0x25c2[_0xe3c694];return _0x5defc6;};'use strict';var __importDefault=this&&this[a1_0x25f1('0x0')]||function(_0x31ef0c){return _0x31ef0c&&_0x31ef0c['__esModule']?_0x31ef0c:{'default':_0x31ef0c};};Object[a1_0x25f1('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x25f1('0x2')));const passport_facebook_1=__importDefault(require(a1_0x25f1('0x3')));const lodash_1=__importDefault(require(a1_0x25f1('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x25f1('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x25f1('0x5')][a1_0x25f1('0x6')];passport_1[a1_0x25f1('0x5')][a1_0x25f1('0x7')]((_0x528e4c,_0x57b903)=>{_0x57b903(undefined,_0x528e4c['id']);});passport_1[a1_0x25f1('0x5')][a1_0x25f1('0x8')]((_0x442940,_0x48614d)=>{User_1[a1_0x25f1('0x5')][a1_0x25f1('0x9')](_0x442940,(_0x38b6de,_0x14bd62)=>{_0x48614d(_0x38b6de,_0x14bd62);});});passport_1[a1_0x25f1('0x5')][a1_0x25f1('0xa')](new LocalStrategy({'usernameField':a1_0x25f1('0xb')},(_0x157787,_0x43201f,_0x4ffaa5)=>{User_1[a1_0x25f1('0x5')][a1_0x25f1('0xc')]({'email':_0x157787[a1_0x25f1('0xd')]()},(_0x41769a,_0x22e75e)=>{if(_0x41769a){return _0x4ffaa5(_0x41769a);}if(!_0x22e75e){return _0x4ffaa5(undefined,![],{'message':a1_0x25f1('0xe')+_0x157787+a1_0x25f1('0xf')});}_0x22e75e['comparePassword'](_0x43201f,(_0x41769a,_0x21978c)=>{if(_0x41769a){return _0x4ffaa5(_0x41769a);}if(_0x21978c){return _0x4ffaa5(undefined,_0x22e75e);}return _0x4ffaa5(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x25f1('0x5')][a1_0x25f1('0xa')](new FacebookStrategy({'clientID':process[a1_0x25f1('0x10')][a1_0x25f1('0x11')],'clientSecret':process[a1_0x25f1('0x10')][a1_0x25f1('0x12')],'callbackURL':a1_0x25f1('0x13'),'profileFields':['name','email',a1_0x25f1('0x14'),a1_0x25f1('0x15'),'timezone'],'passReqToCallback':!![]},(_0x4803ef,_0x2b586e,_0x173309,_0x498bac,_0x1dba0a)=>{if(_0x4803ef[a1_0x25f1('0x16')]){User_1[a1_0x25f1('0x5')][a1_0x25f1('0xc')]({'facebook':_0x498bac['id']},(_0x26a7f0,_0x132d4c)=>{if(_0x26a7f0){return _0x1dba0a(_0x26a7f0);}if(_0x132d4c){_0x4803ef[a1_0x25f1('0x17')](a1_0x25f1('0x18'),{'msg':a1_0x25f1('0x19')});_0x1dba0a(_0x26a7f0);}else{User_1['default'][a1_0x25f1('0x9')](_0x4803ef['user']['id'],(_0x26a7f0,_0x22ed1c)=>{if(_0x26a7f0){return _0x1dba0a(_0x26a7f0);}_0x22ed1c['facebook']=_0x498bac['id'];_0x22ed1c[a1_0x25f1('0x1a')]['push']({'kind':'facebook','accessToken':_0x2b586e});_0x22ed1c[a1_0x25f1('0x1b')][a1_0x25f1('0x1c')]=_0x22ed1c['profile']['name']||_0x498bac[a1_0x25f1('0x1c')]['givenName']+'\x20'+_0x498bac[a1_0x25f1('0x1c')][a1_0x25f1('0x1d')];_0x22ed1c[a1_0x25f1('0x1b')][a1_0x25f1('0x1e')]=_0x22ed1c[a1_0x25f1('0x1b')][a1_0x25f1('0x1e')]||_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0x1e')];_0x22ed1c[a1_0x25f1('0x1b')][a1_0x25f1('0x20')]=_0x22ed1c[a1_0x25f1('0x1b')][a1_0x25f1('0x20')]||a1_0x25f1('0x21')+_0x498bac['id']+a1_0x25f1('0x22');_0x22ed1c['save'](_0x26a7f0=>{_0x4803ef[a1_0x25f1('0x17')](a1_0x25f1('0x23'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x1dba0a(_0x26a7f0,_0x22ed1c);});});}});}else{User_1[a1_0x25f1('0x5')][a1_0x25f1('0xc')]({'facebook':_0x498bac['id']},(_0x310864,_0xde0336)=>{if(_0x310864){return _0x1dba0a(_0x310864);}if(_0xde0336){return _0x1dba0a(undefined,_0xde0336);}User_1[a1_0x25f1('0x5')][a1_0x25f1('0xc')]({'email':_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0xb')]},(_0x310864,_0x361e31)=>{if(_0x310864){return _0x1dba0a(_0x310864);}if(_0x361e31){_0x4803ef[a1_0x25f1('0x17')](a1_0x25f1('0x18'),{'msg':a1_0x25f1('0x24')});_0x1dba0a(_0x310864);}else{const _0x2ae72a=new User_1[(a1_0x25f1('0x5'))]();_0x2ae72a[a1_0x25f1('0xb')]=_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0xb')];_0x2ae72a[a1_0x25f1('0x25')]=_0x498bac['id'];_0x2ae72a[a1_0x25f1('0x1a')]['push']({'kind':a1_0x25f1('0x25'),'accessToken':_0x2b586e});_0x2ae72a[a1_0x25f1('0x1b')][a1_0x25f1('0x1c')]=_0x498bac['name']['givenName']+'\x20'+_0x498bac['name']['familyName'];_0x2ae72a[a1_0x25f1('0x1b')][a1_0x25f1('0x1e')]=_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0x1e')];_0x2ae72a[a1_0x25f1('0x1b')][a1_0x25f1('0x20')]=a1_0x25f1('0x21')+_0x498bac['id']+a1_0x25f1('0x22');_0x2ae72a['profile'][a1_0x25f1('0x26')]=_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0x26')]?_0x498bac[a1_0x25f1('0x1f')][a1_0x25f1('0x26')]['name']:'';_0x2ae72a[a1_0x25f1('0x27')](_0x310864=>{_0x1dba0a(_0x310864,_0x2ae72a);});}});});}}));exports[a1_0x25f1('0x28')]=(_0x1b5e9d,_0x1802ef,_0x46182f)=>{if(_0x1b5e9d[a1_0x25f1('0x28')]()){return _0x46182f();}_0x1802ef['redirect'](a1_0x25f1('0x29'));};exports[a1_0x25f1('0x2a')]=(_0x4f9a27,_0x31c4e4,_0x5ea393)=>{const _0x43779a=_0x4f9a27[a1_0x25f1('0x2b')]['split']('/')[a1_0x25f1('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x25f1('0x5')]['find'](_0x4f9a27[a1_0x25f1('0x16')][a1_0x25f1('0x1a')],{'kind':_0x43779a})){_0x5ea393();}else{_0x31c4e4['redirect'](a1_0x25f1('0x2d')+_0x43779a);}};