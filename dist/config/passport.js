var a1_0x47b7=['profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','save','info','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','/picture?type=large','location','isAuthenticated','/login','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','locale','timezone','user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook'];(function(_0x2318af,_0x40db45){var _0x241cd7=function(_0x252b72){while(--_0x252b72){_0x2318af['push'](_0x2318af['shift']());}};_0x241cd7(++_0x40db45);}(a1_0x47b7,0x171));var a1_0x2507=function(_0x503726,_0x33484d){_0x503726=_0x503726-0x0;var _0x27463e=a1_0x47b7[_0x503726];return _0x27463e;};'use strict';var __importDefault=this&&this[a1_0x2507('0x0')]||function(_0x5a46ca){return _0x5a46ca&&_0x5a46ca[a1_0x2507('0x1')]?_0x5a46ca:{'default':_0x5a46ca};};Object[a1_0x2507('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x2507('0x3')));const passport_facebook_1=__importDefault(require(a1_0x2507('0x4')));const lodash_1=__importDefault(require(a1_0x2507('0x5')));const User_1=__importDefault(require(a1_0x2507('0x6')));const LocalStrategy=passport_local_1[a1_0x2507('0x7')][a1_0x2507('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x2507('0x7')]['Strategy'];passport_1[a1_0x2507('0x7')]['serializeUser']((_0x3a7baf,_0x1dff35)=>{_0x1dff35(undefined,_0x3a7baf['id']);});passport_1[a1_0x2507('0x7')][a1_0x2507('0x9')]((_0x145045,_0x628457)=>{User_1['default'][a1_0x2507('0xa')](_0x145045,(_0x5bc34d,_0x5ca477)=>{_0x628457(_0x5bc34d,_0x5ca477);});});passport_1[a1_0x2507('0x7')][a1_0x2507('0xb')](new LocalStrategy({'usernameField':'email'},(_0x104c84,_0x32558a,_0x32db50)=>{User_1['default'][a1_0x2507('0xc')]({'email':_0x104c84[a1_0x2507('0xd')]()},(_0x557301,_0x4ec7dc)=>{if(_0x557301){return _0x32db50(_0x557301);}if(!_0x4ec7dc){return _0x32db50(undefined,![],{'message':a1_0x2507('0xe')+_0x104c84+a1_0x2507('0xf')});}_0x4ec7dc[a1_0x2507('0x10')](_0x32558a,(_0x557301,_0x4b81a5)=>{if(_0x557301){return _0x32db50(_0x557301);}if(_0x4b81a5){return _0x32db50(undefined,_0x4ec7dc);}return _0x32db50(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x2507('0x7')][a1_0x2507('0xb')](new FacebookStrategy({'clientID':process[a1_0x2507('0x11')][a1_0x2507('0x12')],'clientSecret':process[a1_0x2507('0x11')][a1_0x2507('0x13')],'callbackURL':a1_0x2507('0x14'),'profileFields':[a1_0x2507('0x15'),a1_0x2507('0x16'),'link',a1_0x2507('0x17'),a1_0x2507('0x18')],'passReqToCallback':!![]},(_0x187ab2,_0x2f5a7c,_0x136221,_0x590d6a,_0x232ab2)=>{if(_0x187ab2[a1_0x2507('0x19')]){User_1[a1_0x2507('0x7')][a1_0x2507('0xc')]({'facebook':_0x590d6a['id']},(_0x24e921,_0x2bad60)=>{if(_0x24e921){return _0x232ab2(_0x24e921);}if(_0x2bad60){_0x187ab2[a1_0x2507('0x1a')]('errors',{'msg':a1_0x2507('0x1b')});_0x232ab2(_0x24e921);}else{User_1['default'][a1_0x2507('0xa')](_0x187ab2[a1_0x2507('0x19')]['id'],(_0x24e921,_0x493666)=>{if(_0x24e921){return _0x232ab2(_0x24e921);}_0x493666['facebook']=_0x590d6a['id'];_0x493666[a1_0x2507('0x1c')][a1_0x2507('0x1d')]({'kind':a1_0x2507('0x1e'),'accessToken':_0x2f5a7c});_0x493666[a1_0x2507('0x1f')]['name']=_0x493666[a1_0x2507('0x1f')]['name']||_0x590d6a[a1_0x2507('0x15')][a1_0x2507('0x20')]+'\x20'+_0x590d6a[a1_0x2507('0x15')][a1_0x2507('0x21')];_0x493666[a1_0x2507('0x1f')]['gender']=_0x493666[a1_0x2507('0x1f')][a1_0x2507('0x22')]||_0x590d6a[a1_0x2507('0x23')][a1_0x2507('0x22')];_0x493666[a1_0x2507('0x1f')][a1_0x2507('0x24')]=_0x493666[a1_0x2507('0x1f')]['picture']||a1_0x2507('0x25')+_0x590d6a['id']+'/picture?type=large';_0x493666[a1_0x2507('0x26')](_0x24e921=>{_0x187ab2[a1_0x2507('0x1a')](a1_0x2507('0x27'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x232ab2(_0x24e921,_0x493666);});});}});}else{User_1['default'][a1_0x2507('0xc')]({'facebook':_0x590d6a['id']},(_0x3f297b,_0xe0897e)=>{if(_0x3f297b){return _0x232ab2(_0x3f297b);}if(_0xe0897e){return _0x232ab2(undefined,_0xe0897e);}User_1[a1_0x2507('0x7')][a1_0x2507('0xc')]({'email':_0x590d6a[a1_0x2507('0x23')][a1_0x2507('0x16')]},(_0x3f297b,_0x273444)=>{if(_0x3f297b){return _0x232ab2(_0x3f297b);}if(_0x273444){_0x187ab2[a1_0x2507('0x1a')](a1_0x2507('0x28'),{'msg':a1_0x2507('0x29')});_0x232ab2(_0x3f297b);}else{const _0x201274=new User_1[(a1_0x2507('0x7'))]();_0x201274[a1_0x2507('0x16')]=_0x590d6a[a1_0x2507('0x23')]['email'];_0x201274[a1_0x2507('0x1e')]=_0x590d6a['id'];_0x201274[a1_0x2507('0x1c')]['push']({'kind':'facebook','accessToken':_0x2f5a7c});_0x201274[a1_0x2507('0x1f')][a1_0x2507('0x15')]=_0x590d6a[a1_0x2507('0x15')][a1_0x2507('0x20')]+'\x20'+_0x590d6a[a1_0x2507('0x15')]['familyName'];_0x201274[a1_0x2507('0x1f')]['gender']=_0x590d6a['_json'][a1_0x2507('0x22')];_0x201274['profile'][a1_0x2507('0x24')]=a1_0x2507('0x25')+_0x590d6a['id']+a1_0x2507('0x2a');_0x201274[a1_0x2507('0x1f')][a1_0x2507('0x2b')]=_0x590d6a[a1_0x2507('0x23')][a1_0x2507('0x2b')]?_0x590d6a[a1_0x2507('0x23')][a1_0x2507('0x2b')][a1_0x2507('0x15')]:'';_0x201274[a1_0x2507('0x26')](_0x3f297b=>{_0x232ab2(_0x3f297b,_0x201274);});}});});}}));exports[a1_0x2507('0x2c')]=(_0x44627f,_0x2513e5,_0xc1ceef)=>{if(_0x44627f[a1_0x2507('0x2c')]()){return _0xc1ceef();}_0x2513e5['redirect'](a1_0x2507('0x2d'));};exports['isAuthorized']=(_0xbccb94,_0x297bb7,_0x35bdda)=>{const _0x3900f7=_0xbccb94['path'][a1_0x2507('0x2e')]('/')[a1_0x2507('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x2507('0x7')][a1_0x2507('0x30')](_0xbccb94[a1_0x2507('0x19')][a1_0x2507('0x1c')],{'kind':_0x3900f7})){_0x35bdda();}else{_0x297bb7['redirect'](a1_0x2507('0x31')+_0x3900f7);}};