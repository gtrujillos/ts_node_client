var a1_0x536d=['/picture?type=large','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','isAuthorized','path','split','slice','__importDefault','defineProperty','__esModule','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','link','locale','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','name','givenName','familyName','gender','_json','picture','https://graph.facebook.com/'];(function(_0x9160cd,_0xde0b49){var _0x240f19=function(_0x558196){while(--_0x558196){_0x9160cd['push'](_0x9160cd['shift']());}};_0x240f19(++_0xde0b49);}(a1_0x536d,0x1cd));var a1_0x14f9=function(_0x129696,_0x1e8e0a){_0x129696=_0x129696-0x0;var _0x569dfd=a1_0x536d[_0x129696];return _0x569dfd;};'use strict';var __importDefault=this&&this[a1_0x14f9('0x0')]||function(_0x3d53bb){return _0x3d53bb&&_0x3d53bb['__esModule']?_0x3d53bb:{'default':_0x3d53bb};};Object[a1_0x14f9('0x1')](exports,a1_0x14f9('0x2'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x14f9('0x3')));const lodash_1=__importDefault(require(a1_0x14f9('0x4')));const User_1=__importDefault(require(a1_0x14f9('0x5')));const LocalStrategy=passport_local_1[a1_0x14f9('0x6')][a1_0x14f9('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x14f9('0x6')][a1_0x14f9('0x7')];passport_1['default'][a1_0x14f9('0x8')]((_0x3ad715,_0x4ecd5f)=>{_0x4ecd5f(undefined,_0x3ad715['id']);});passport_1[a1_0x14f9('0x6')][a1_0x14f9('0x9')]((_0xd332ec,_0x29c1de)=>{User_1[a1_0x14f9('0x6')][a1_0x14f9('0xa')](_0xd332ec,(_0xb0d7c8,_0x2b6a0c)=>{_0x29c1de(_0xb0d7c8,_0x2b6a0c);});});passport_1[a1_0x14f9('0x6')][a1_0x14f9('0xb')](new LocalStrategy({'usernameField':a1_0x14f9('0xc')},(_0x3db96a,_0x37f13d,_0x26cd5e)=>{User_1['default'][a1_0x14f9('0xd')]({'email':_0x3db96a[a1_0x14f9('0xe')]()},(_0x205ce9,_0x9b1aeb)=>{if(_0x205ce9){return _0x26cd5e(_0x205ce9);}if(!_0x9b1aeb){return _0x26cd5e(undefined,![],{'message':a1_0x14f9('0xf')+_0x3db96a+a1_0x14f9('0x10')});}_0x9b1aeb[a1_0x14f9('0x11')](_0x37f13d,(_0x205ce9,_0x475e92)=>{if(_0x205ce9){return _0x26cd5e(_0x205ce9);}if(_0x475e92){return _0x26cd5e(undefined,_0x9b1aeb);}return _0x26cd5e(undefined,![],{'message':a1_0x14f9('0x12')});});});}));passport_1[a1_0x14f9('0x6')]['use'](new FacebookStrategy({'clientID':process[a1_0x14f9('0x13')][a1_0x14f9('0x14')],'clientSecret':process[a1_0x14f9('0x13')][a1_0x14f9('0x15')],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x14f9('0xc'),a1_0x14f9('0x16'),a1_0x14f9('0x17'),'timezone'],'passReqToCallback':!![]},(_0x63f65c,_0x119396,_0x2f1a68,_0x31715d,_0x544881)=>{if(_0x63f65c[a1_0x14f9('0x18')]){User_1[a1_0x14f9('0x6')]['findOne']({'facebook':_0x31715d['id']},(_0xa23a61,_0x4692dc)=>{if(_0xa23a61){return _0x544881(_0xa23a61);}if(_0x4692dc){_0x63f65c[a1_0x14f9('0x19')](a1_0x14f9('0x1a'),{'msg':a1_0x14f9('0x1b')});_0x544881(_0xa23a61);}else{User_1[a1_0x14f9('0x6')][a1_0x14f9('0xa')](_0x63f65c[a1_0x14f9('0x18')]['id'],(_0xa23a61,_0x390efc)=>{if(_0xa23a61){return _0x544881(_0xa23a61);}_0x390efc[a1_0x14f9('0x1c')]=_0x31715d['id'];_0x390efc[a1_0x14f9('0x1d')][a1_0x14f9('0x1e')]({'kind':a1_0x14f9('0x1c'),'accessToken':_0x119396});_0x390efc[a1_0x14f9('0x1f')][a1_0x14f9('0x20')]=_0x390efc[a1_0x14f9('0x1f')][a1_0x14f9('0x20')]||_0x31715d[a1_0x14f9('0x20')][a1_0x14f9('0x21')]+'\x20'+_0x31715d['name'][a1_0x14f9('0x22')];_0x390efc[a1_0x14f9('0x1f')][a1_0x14f9('0x23')]=_0x390efc[a1_0x14f9('0x1f')][a1_0x14f9('0x23')]||_0x31715d[a1_0x14f9('0x24')][a1_0x14f9('0x23')];_0x390efc['profile'][a1_0x14f9('0x25')]=_0x390efc['profile']['picture']||a1_0x14f9('0x26')+_0x31715d['id']+a1_0x14f9('0x27');_0x390efc[a1_0x14f9('0x28')](_0xa23a61=>{_0x63f65c[a1_0x14f9('0x19')](a1_0x14f9('0x29'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x544881(_0xa23a61,_0x390efc);});});}});}else{User_1['default']['findOne']({'facebook':_0x31715d['id']},(_0x5acc45,_0x48a8a3)=>{if(_0x5acc45){return _0x544881(_0x5acc45);}if(_0x48a8a3){return _0x544881(undefined,_0x48a8a3);}User_1[a1_0x14f9('0x6')][a1_0x14f9('0xd')]({'email':_0x31715d[a1_0x14f9('0x24')][a1_0x14f9('0xc')]},(_0x5acc45,_0x23e6cb)=>{if(_0x5acc45){return _0x544881(_0x5acc45);}if(_0x23e6cb){_0x63f65c['flash'](a1_0x14f9('0x1a'),{'msg':a1_0x14f9('0x2a')});_0x544881(_0x5acc45);}else{const _0x4e798d=new User_1['default']();_0x4e798d[a1_0x14f9('0xc')]=_0x31715d['_json']['email'];_0x4e798d[a1_0x14f9('0x1c')]=_0x31715d['id'];_0x4e798d['tokens']['push']({'kind':'facebook','accessToken':_0x119396});_0x4e798d['profile'][a1_0x14f9('0x20')]=_0x31715d[a1_0x14f9('0x20')][a1_0x14f9('0x21')]+'\x20'+_0x31715d[a1_0x14f9('0x20')][a1_0x14f9('0x22')];_0x4e798d[a1_0x14f9('0x1f')]['gender']=_0x31715d[a1_0x14f9('0x24')]['gender'];_0x4e798d['profile'][a1_0x14f9('0x25')]=a1_0x14f9('0x26')+_0x31715d['id']+a1_0x14f9('0x27');_0x4e798d[a1_0x14f9('0x1f')]['location']=_0x31715d[a1_0x14f9('0x24')][a1_0x14f9('0x2b')]?_0x31715d[a1_0x14f9('0x24')]['location'][a1_0x14f9('0x20')]:'';_0x4e798d[a1_0x14f9('0x28')](_0x5acc45=>{_0x544881(_0x5acc45,_0x4e798d);});}});});}}));exports[a1_0x14f9('0x2c')]=(_0x1b6a8c,_0x159e87,_0x833470)=>{if(_0x1b6a8c['isAuthenticated']()){return _0x833470();}_0x159e87[a1_0x14f9('0x2d')]('/login');};exports[a1_0x14f9('0x2e')]=(_0xbe1d7c,_0x3713ef,_0x40eece)=>{const _0x3a8370=_0xbe1d7c[a1_0x14f9('0x2f')][a1_0x14f9('0x30')]('/')[a1_0x14f9('0x31')](-0x1)[0x0];if(lodash_1[a1_0x14f9('0x6')]['find'](_0xbe1d7c[a1_0x14f9('0x18')][a1_0x14f9('0x1d')],{'kind':_0x3a8370})){_0x40eece();}else{_0x3713ef[a1_0x14f9('0x2d')]('/auth/'+_0x3a8370);}};