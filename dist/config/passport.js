var a1_0x2356=['tokens','https://graph.facebook.com/','save','isAuthenticated','isAuthorized','path','split','find','redirect','/auth/','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','use','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','locale','timezone','user','flash','errors','facebook','push','profile','givenName','familyName','gender','picture','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','findOne','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'];(function(_0x21998f,_0x972bb0){var _0x41e2c6=function(_0x3ab2cc){while(--_0x3ab2cc){_0x21998f['push'](_0x21998f['shift']());}};_0x41e2c6(++_0x972bb0);}(a1_0x2356,0xda));var a1_0x29d1=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=a1_0x2356[_0xb67384];return _0x156d7c;};'use strict';var __importDefault=this&&this[a1_0x29d1('0x0')]||function(_0x642332){return _0x642332&&_0x642332[a1_0x29d1('0x1')]?_0x642332:{'default':_0x642332};};Object[a1_0x29d1('0x2')](exports,a1_0x29d1('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x29d1('0x3')));const passport_facebook_1=__importDefault(require(a1_0x29d1('0x4')));const lodash_1=__importDefault(require(a1_0x29d1('0x5')));const User_1=__importDefault(require(a1_0x29d1('0x6')));const LocalStrategy=passport_local_1[a1_0x29d1('0x7')][a1_0x29d1('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x29d1('0x7')][a1_0x29d1('0x8')];passport_1[a1_0x29d1('0x7')][a1_0x29d1('0x9')]((_0xa50dc3,_0x11962c)=>{_0x11962c(undefined,_0xa50dc3['id']);});passport_1['default'][a1_0x29d1('0xa')]((_0x93a407,_0x38bb5e)=>{User_1[a1_0x29d1('0x7')][a1_0x29d1('0xb')](_0x93a407,(_0x503824,_0x3a4e83)=>{_0x38bb5e(_0x503824,_0x3a4e83);});});passport_1['default']['use'](new LocalStrategy({'usernameField':'email'},(_0xe64913,_0x51576b,_0x59fc85)=>{User_1[a1_0x29d1('0x7')]['findOne']({'email':_0xe64913[a1_0x29d1('0xc')]()},(_0x5bf658,_0x14c83c)=>{if(_0x5bf658){return _0x59fc85(_0x5bf658);}if(!_0x14c83c){return _0x59fc85(undefined,![],{'message':a1_0x29d1('0xd')+_0xe64913+a1_0x29d1('0xe')});}_0x14c83c[a1_0x29d1('0xf')](_0x51576b,(_0x5bf658,_0x2a9c3b)=>{if(_0x5bf658){return _0x59fc85(_0x5bf658);}if(_0x2a9c3b){return _0x59fc85(undefined,_0x14c83c);}return _0x59fc85(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x29d1('0x7')][a1_0x29d1('0x10')](new FacebookStrategy({'clientID':process[a1_0x29d1('0x11')][a1_0x29d1('0x12')],'clientSecret':process[a1_0x29d1('0x11')][a1_0x29d1('0x13')],'callbackURL':a1_0x29d1('0x14'),'profileFields':[a1_0x29d1('0x15'),a1_0x29d1('0x16'),a1_0x29d1('0x17'),a1_0x29d1('0x18'),a1_0x29d1('0x19')],'passReqToCallback':!![]},(_0x3eaa17,_0x56a993,_0x19bb55,_0x29de30,_0x3b8cc2)=>{if(_0x3eaa17[a1_0x29d1('0x1a')]){User_1[a1_0x29d1('0x7')]['findOne']({'facebook':_0x29de30['id']},(_0x2fc3be,_0x82e632)=>{if(_0x2fc3be){return _0x3b8cc2(_0x2fc3be);}if(_0x82e632){_0x3eaa17[a1_0x29d1('0x1b')](a1_0x29d1('0x1c'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x3b8cc2(_0x2fc3be);}else{User_1[a1_0x29d1('0x7')][a1_0x29d1('0xb')](_0x3eaa17['user']['id'],(_0x2fc3be,_0x5f486a)=>{if(_0x2fc3be){return _0x3b8cc2(_0x2fc3be);}_0x5f486a[a1_0x29d1('0x1d')]=_0x29de30['id'];_0x5f486a['tokens'][a1_0x29d1('0x1e')]({'kind':a1_0x29d1('0x1d'),'accessToken':_0x56a993});_0x5f486a[a1_0x29d1('0x1f')][a1_0x29d1('0x15')]=_0x5f486a['profile'][a1_0x29d1('0x15')]||_0x29de30[a1_0x29d1('0x15')][a1_0x29d1('0x20')]+'\x20'+_0x29de30['name'][a1_0x29d1('0x21')];_0x5f486a[a1_0x29d1('0x1f')][a1_0x29d1('0x22')]=_0x5f486a[a1_0x29d1('0x1f')][a1_0x29d1('0x22')]||_0x29de30['_json'][a1_0x29d1('0x22')];_0x5f486a[a1_0x29d1('0x1f')][a1_0x29d1('0x23')]=_0x5f486a[a1_0x29d1('0x1f')]['picture']||'https://graph.facebook.com/'+_0x29de30['id']+a1_0x29d1('0x24');_0x5f486a['save'](_0x2fc3be=>{_0x3eaa17['flash'](a1_0x29d1('0x25'),{'msg':a1_0x29d1('0x26')});_0x3b8cc2(_0x2fc3be,_0x5f486a);});});}});}else{User_1[a1_0x29d1('0x7')][a1_0x29d1('0x27')]({'facebook':_0x29de30['id']},(_0x2c5cfa,_0x467ec9)=>{if(_0x2c5cfa){return _0x3b8cc2(_0x2c5cfa);}if(_0x467ec9){return _0x3b8cc2(undefined,_0x467ec9);}User_1['default'][a1_0x29d1('0x27')]({'email':_0x29de30[a1_0x29d1('0x28')][a1_0x29d1('0x16')]},(_0x2c5cfa,_0x213e6c)=>{if(_0x2c5cfa){return _0x3b8cc2(_0x2c5cfa);}if(_0x213e6c){_0x3eaa17[a1_0x29d1('0x1b')]('errors',{'msg':a1_0x29d1('0x29')});_0x3b8cc2(_0x2c5cfa);}else{const _0x20af05=new User_1[(a1_0x29d1('0x7'))]();_0x20af05[a1_0x29d1('0x16')]=_0x29de30['_json'][a1_0x29d1('0x16')];_0x20af05[a1_0x29d1('0x1d')]=_0x29de30['id'];_0x20af05[a1_0x29d1('0x2a')][a1_0x29d1('0x1e')]({'kind':a1_0x29d1('0x1d'),'accessToken':_0x56a993});_0x20af05[a1_0x29d1('0x1f')][a1_0x29d1('0x15')]=_0x29de30[a1_0x29d1('0x15')][a1_0x29d1('0x20')]+'\x20'+_0x29de30['name'][a1_0x29d1('0x21')];_0x20af05['profile'][a1_0x29d1('0x22')]=_0x29de30['_json'][a1_0x29d1('0x22')];_0x20af05[a1_0x29d1('0x1f')][a1_0x29d1('0x23')]=a1_0x29d1('0x2b')+_0x29de30['id']+a1_0x29d1('0x24');_0x20af05['profile']['location']=_0x29de30['_json']['location']?_0x29de30['_json']['location']['name']:'';_0x20af05[a1_0x29d1('0x2c')](_0x2c5cfa=>{_0x3b8cc2(_0x2c5cfa,_0x20af05);});}});});}}));exports[a1_0x29d1('0x2d')]=(_0x2eea00,_0x1e4ea7,_0x7eb491)=>{if(_0x2eea00['isAuthenticated']()){return _0x7eb491();}_0x1e4ea7['redirect']('/login');};exports[a1_0x29d1('0x2e')]=(_0x3889a8,_0x3287d9,_0x4b077a)=>{const _0x219d08=_0x3889a8[a1_0x29d1('0x2f')][a1_0x29d1('0x30')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x29d1('0x31')](_0x3889a8['user'][a1_0x29d1('0x2a')],{'kind':_0x219d08})){_0x4b077a();}else{_0x3287d9[a1_0x29d1('0x32')](a1_0x29d1('0x33')+_0x219d08);}};