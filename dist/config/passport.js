var a1_0xb2f0=['gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','familyName','location','isAuthenticated','redirect','/login','isAuthorized','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name','email','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','profile'];(function(_0x1b8337,_0x4bef52){var _0x3badfe=function(_0x28b4fd){while(--_0x28b4fd){_0x1b8337['push'](_0x1b8337['shift']());}};_0x3badfe(++_0x4bef52);}(a1_0xb2f0,0x1de));var a1_0x271e=function(_0x4e8d0b,_0x10c888){_0x4e8d0b=_0x4e8d0b-0x0;var _0x371057=a1_0xb2f0[_0x4e8d0b];return _0x371057;};'use strict';var __importDefault=this&&this[a1_0x271e('0x0')]||function(_0x9c46b5){return _0x9c46b5&&_0x9c46b5[a1_0x271e('0x1')]?_0x9c46b5:{'default':_0x9c46b5};};Object[a1_0x271e('0x2')](exports,a1_0x271e('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x271e('0x3')));const passport_local_1=__importDefault(require(a1_0x271e('0x4')));const passport_facebook_1=__importDefault(require(a1_0x271e('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x271e('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x271e('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x271e('0x8')]['Strategy'];passport_1[a1_0x271e('0x8')][a1_0x271e('0x9')]((_0x19f236,_0x5c79b2)=>{_0x5c79b2(undefined,_0x19f236['id']);});passport_1[a1_0x271e('0x8')][a1_0x271e('0xa')]((_0xd5c0f3,_0xfb559c)=>{User_1[a1_0x271e('0x8')][a1_0x271e('0xb')](_0xd5c0f3,(_0x4919dc,_0x1b92e3)=>{_0xfb559c(_0x4919dc,_0x1b92e3);});});passport_1['default'][a1_0x271e('0xc')](new LocalStrategy({'usernameField':'email'},(_0xb1dab6,_0x26c755,_0x89b9b9)=>{User_1[a1_0x271e('0x8')][a1_0x271e('0xd')]({'email':_0xb1dab6[a1_0x271e('0xe')]()},(_0x3fd146,_0xd13c51)=>{if(_0x3fd146){return _0x89b9b9(_0x3fd146);}if(!_0xd13c51){return _0x89b9b9(undefined,![],{'message':a1_0x271e('0xf')+_0xb1dab6+'\x20not\x20found.'});}_0xd13c51['comparePassword'](_0x26c755,(_0x3fd146,_0x4dadff)=>{if(_0x3fd146){return _0x89b9b9(_0x3fd146);}if(_0x4dadff){return _0x89b9b9(undefined,_0xd13c51);}return _0x89b9b9(undefined,![],{'message':a1_0x271e('0x10')});});});}));passport_1[a1_0x271e('0x8')][a1_0x271e('0xc')](new FacebookStrategy({'clientID':process[a1_0x271e('0x11')][a1_0x271e('0x12')],'clientSecret':process[a1_0x271e('0x11')][a1_0x271e('0x13')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x271e('0x14'),a1_0x271e('0x15'),a1_0x271e('0x16'),a1_0x271e('0x17'),a1_0x271e('0x18')],'passReqToCallback':!![]},(_0x2b9754,_0x1dd9c5,_0x2937eb,_0x322384,_0x5e6673)=>{if(_0x2b9754[a1_0x271e('0x19')]){User_1[a1_0x271e('0x8')][a1_0x271e('0xd')]({'facebook':_0x322384['id']},(_0x12505d,_0xb2e35a)=>{if(_0x12505d){return _0x5e6673(_0x12505d);}if(_0xb2e35a){_0x2b9754[a1_0x271e('0x1a')](a1_0x271e('0x1b'),{'msg':a1_0x271e('0x1c')});_0x5e6673(_0x12505d);}else{User_1[a1_0x271e('0x8')][a1_0x271e('0xb')](_0x2b9754[a1_0x271e('0x19')]['id'],(_0x12505d,_0x304408)=>{if(_0x12505d){return _0x5e6673(_0x12505d);}_0x304408[a1_0x271e('0x1d')]=_0x322384['id'];_0x304408[a1_0x271e('0x1e')]['push']({'kind':a1_0x271e('0x1d'),'accessToken':_0x1dd9c5});_0x304408[a1_0x271e('0x1f')][a1_0x271e('0x14')]=_0x304408[a1_0x271e('0x1f')]['name']||_0x322384[a1_0x271e('0x14')]['givenName']+'\x20'+_0x322384[a1_0x271e('0x14')]['familyName'];_0x304408[a1_0x271e('0x1f')]['gender']=_0x304408['profile'][a1_0x271e('0x20')]||_0x322384[a1_0x271e('0x21')][a1_0x271e('0x20')];_0x304408['profile'][a1_0x271e('0x22')]=_0x304408[a1_0x271e('0x1f')][a1_0x271e('0x22')]||a1_0x271e('0x23')+_0x322384['id']+a1_0x271e('0x24');_0x304408[a1_0x271e('0x25')](_0x12505d=>{_0x2b9754[a1_0x271e('0x1a')]('info',{'msg':a1_0x271e('0x26')});_0x5e6673(_0x12505d,_0x304408);});});}});}else{User_1[a1_0x271e('0x8')][a1_0x271e('0xd')]({'facebook':_0x322384['id']},(_0x579c2c,_0x26cc52)=>{if(_0x579c2c){return _0x5e6673(_0x579c2c);}if(_0x26cc52){return _0x5e6673(undefined,_0x26cc52);}User_1[a1_0x271e('0x8')][a1_0x271e('0xd')]({'email':_0x322384[a1_0x271e('0x21')]['email']},(_0x579c2c,_0x3eb8c0)=>{if(_0x579c2c){return _0x5e6673(_0x579c2c);}if(_0x3eb8c0){_0x2b9754['flash']('errors',{'msg':a1_0x271e('0x27')});_0x5e6673(_0x579c2c);}else{const _0x352743=new User_1[(a1_0x271e('0x8'))]();_0x352743[a1_0x271e('0x15')]=_0x322384[a1_0x271e('0x21')]['email'];_0x352743[a1_0x271e('0x1d')]=_0x322384['id'];_0x352743[a1_0x271e('0x1e')][a1_0x271e('0x28')]({'kind':'facebook','accessToken':_0x1dd9c5});_0x352743[a1_0x271e('0x1f')][a1_0x271e('0x14')]=_0x322384[a1_0x271e('0x14')]['givenName']+'\x20'+_0x322384['name'][a1_0x271e('0x29')];_0x352743[a1_0x271e('0x1f')][a1_0x271e('0x20')]=_0x322384[a1_0x271e('0x21')][a1_0x271e('0x20')];_0x352743[a1_0x271e('0x1f')][a1_0x271e('0x22')]=a1_0x271e('0x23')+_0x322384['id']+a1_0x271e('0x24');_0x352743[a1_0x271e('0x1f')]['location']=_0x322384[a1_0x271e('0x21')][a1_0x271e('0x2a')]?_0x322384[a1_0x271e('0x21')][a1_0x271e('0x2a')][a1_0x271e('0x14')]:'';_0x352743['save'](_0x579c2c=>{_0x5e6673(_0x579c2c,_0x352743);});}});});}}));exports['isAuthenticated']=(_0xcd817a,_0x5ac413,_0x5b1280)=>{if(_0xcd817a[a1_0x271e('0x2b')]()){return _0x5b1280();}_0x5ac413[a1_0x271e('0x2c')](a1_0x271e('0x2d'));};exports[a1_0x271e('0x2e')]=(_0x1a96f9,_0x3beb13,_0x41c4a9)=>{const _0x5c195b=_0x1a96f9['path'][a1_0x271e('0x2f')]('/')[a1_0x271e('0x30')](-0x1)[0x0];if(lodash_1[a1_0x271e('0x8')][a1_0x271e('0x31')](_0x1a96f9['user'][a1_0x271e('0x1e')],{'kind':_0x5c195b})){_0x41c4a9();}else{_0x3beb13['redirect'](a1_0x271e('0x32')+_0x5c195b);}};