var a1_0x2362=['split','find','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','use','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','locale','timezone','user','findOne','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','facebook','push','profile','name','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','email','givenName','familyName','location','save','isAuthenticated','redirect','/login','isAuthorized','path'];(function(_0x4d697b,_0x412f5d){var _0x13a220=function(_0x10c543){while(--_0x10c543){_0x4d697b['push'](_0x4d697b['shift']());}};_0x13a220(++_0x412f5d);}(a1_0x2362,0x19b));var a1_0x3b3b=function(_0xb7a56a,_0x1d5bba){_0xb7a56a=_0xb7a56a-0x0;var _0x1bc579=a1_0x2362[_0xb7a56a];return _0x1bc579;};'use strict';var __importDefault=this&&this[a1_0x3b3b('0x0')]||function(_0x573277){return _0x573277&&_0x573277['__esModule']?_0x573277:{'default':_0x573277};};Object[a1_0x3b3b('0x1')](exports,a1_0x3b3b('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3b3b('0x3')));const passport_local_1=__importDefault(require(a1_0x3b3b('0x4')));const passport_facebook_1=__importDefault(require(a1_0x3b3b('0x5')));const lodash_1=__importDefault(require(a1_0x3b3b('0x6')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x8')];passport_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x9')]((_0xd4f954,_0x25ba67)=>{_0x25ba67(undefined,_0xd4f954['id']);});passport_1['default']['deserializeUser']((_0x19e8fa,_0x25435b)=>{User_1[a1_0x3b3b('0x7')]['findById'](_0x19e8fa,(_0x12f91f,_0x9ffcf)=>{_0x25435b(_0x12f91f,_0x9ffcf);});});passport_1['default'][a1_0x3b3b('0xa')](new LocalStrategy({'usernameField':'email'},(_0x346ae9,_0x47b48d,_0x43d482)=>{User_1[a1_0x3b3b('0x7')]['findOne']({'email':_0x346ae9[a1_0x3b3b('0xb')]()},(_0x1b1bda,_0x3eb62c)=>{if(_0x1b1bda){return _0x43d482(_0x1b1bda);}if(!_0x3eb62c){return _0x43d482(undefined,![],{'message':a1_0x3b3b('0xc')+_0x346ae9+'\x20not\x20found.'});}_0x3eb62c[a1_0x3b3b('0xd')](_0x47b48d,(_0x1b1bda,_0x51c2f8)=>{if(_0x1b1bda){return _0x43d482(_0x1b1bda);}if(_0x51c2f8){return _0x43d482(undefined,_0x3eb62c);}return _0x43d482(undefined,![],{'message':a1_0x3b3b('0xe')});});});}));passport_1['default'][a1_0x3b3b('0xa')](new FacebookStrategy({'clientID':process['env'][a1_0x3b3b('0xf')],'clientSecret':process[a1_0x3b3b('0x10')][a1_0x3b3b('0x11')],'callbackURL':a1_0x3b3b('0x12'),'profileFields':['name','email','link',a1_0x3b3b('0x13'),a1_0x3b3b('0x14')],'passReqToCallback':!![]},(_0x2d4380,_0x2526d8,_0x17b35e,_0x100b41,_0x112951)=>{if(_0x2d4380[a1_0x3b3b('0x15')]){User_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x16')]({'facebook':_0x100b41['id']},(_0x29c4a9,_0x18c5ae)=>{if(_0x29c4a9){return _0x112951(_0x29c4a9);}if(_0x18c5ae){_0x2d4380[a1_0x3b3b('0x17')](a1_0x3b3b('0x18'),{'msg':a1_0x3b3b('0x19')});_0x112951(_0x29c4a9);}else{User_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x1a')](_0x2d4380[a1_0x3b3b('0x15')]['id'],(_0x29c4a9,_0x2094ea)=>{if(_0x29c4a9){return _0x112951(_0x29c4a9);}_0x2094ea[a1_0x3b3b('0x1b')]=_0x100b41['id'];_0x2094ea['tokens'][a1_0x3b3b('0x1c')]({'kind':a1_0x3b3b('0x1b'),'accessToken':_0x2526d8});_0x2094ea[a1_0x3b3b('0x1d')][a1_0x3b3b('0x1e')]=_0x2094ea[a1_0x3b3b('0x1d')]['name']||_0x100b41[a1_0x3b3b('0x1e')]['givenName']+'\x20'+_0x100b41[a1_0x3b3b('0x1e')]['familyName'];_0x2094ea['profile']['gender']=_0x2094ea['profile'][a1_0x3b3b('0x1f')]||_0x100b41[a1_0x3b3b('0x20')]['gender'];_0x2094ea[a1_0x3b3b('0x1d')][a1_0x3b3b('0x21')]=_0x2094ea['profile'][a1_0x3b3b('0x21')]||a1_0x3b3b('0x22')+_0x100b41['id']+a1_0x3b3b('0x23');_0x2094ea['save'](_0x29c4a9=>{_0x2d4380[a1_0x3b3b('0x17')](a1_0x3b3b('0x24'),{'msg':a1_0x3b3b('0x25')});_0x112951(_0x29c4a9,_0x2094ea);});});}});}else{User_1['default'][a1_0x3b3b('0x16')]({'facebook':_0x100b41['id']},(_0x60e9fb,_0xa9ec73)=>{if(_0x60e9fb){return _0x112951(_0x60e9fb);}if(_0xa9ec73){return _0x112951(undefined,_0xa9ec73);}User_1[a1_0x3b3b('0x7')][a1_0x3b3b('0x16')]({'email':_0x100b41[a1_0x3b3b('0x20')][a1_0x3b3b('0x26')]},(_0x60e9fb,_0x5d47f6)=>{if(_0x60e9fb){return _0x112951(_0x60e9fb);}if(_0x5d47f6){_0x2d4380[a1_0x3b3b('0x17')](a1_0x3b3b('0x18'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x112951(_0x60e9fb);}else{const _0x2d0a3b=new User_1[(a1_0x3b3b('0x7'))]();_0x2d0a3b[a1_0x3b3b('0x26')]=_0x100b41[a1_0x3b3b('0x20')]['email'];_0x2d0a3b[a1_0x3b3b('0x1b')]=_0x100b41['id'];_0x2d0a3b['tokens'][a1_0x3b3b('0x1c')]({'kind':'facebook','accessToken':_0x2526d8});_0x2d0a3b['profile'][a1_0x3b3b('0x1e')]=_0x100b41['name'][a1_0x3b3b('0x27')]+'\x20'+_0x100b41['name'][a1_0x3b3b('0x28')];_0x2d0a3b[a1_0x3b3b('0x1d')][a1_0x3b3b('0x1f')]=_0x100b41['_json'][a1_0x3b3b('0x1f')];_0x2d0a3b[a1_0x3b3b('0x1d')][a1_0x3b3b('0x21')]=a1_0x3b3b('0x22')+_0x100b41['id']+'/picture?type=large';_0x2d0a3b[a1_0x3b3b('0x1d')][a1_0x3b3b('0x29')]=_0x100b41['_json']['location']?_0x100b41[a1_0x3b3b('0x20')][a1_0x3b3b('0x29')][a1_0x3b3b('0x1e')]:'';_0x2d0a3b[a1_0x3b3b('0x2a')](_0x60e9fb=>{_0x112951(_0x60e9fb,_0x2d0a3b);});}});});}}));exports[a1_0x3b3b('0x2b')]=(_0x502172,_0x410830,_0x483d8a)=>{if(_0x502172[a1_0x3b3b('0x2b')]()){return _0x483d8a();}_0x410830[a1_0x3b3b('0x2c')](a1_0x3b3b('0x2d'));};exports[a1_0x3b3b('0x2e')]=(_0x1d734f,_0x25cc7e,_0x283c10)=>{const _0x4fa493=_0x1d734f[a1_0x3b3b('0x2f')][a1_0x3b3b('0x30')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x3b3b('0x31')](_0x1d734f['user']['tokens'],{'kind':_0x4fa493})){_0x283c10();}else{_0x25cc7e[a1_0x3b3b('0x2c')](a1_0x3b3b('0x32')+_0x4fa493);}};