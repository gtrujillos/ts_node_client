var a1_0x487f=['Email\x20','\x20not\x20found.','comparePassword','env','/auth/facebook/callback','name','locale','findOne','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','/login','isAuthorized','slice','find','redirect','__esModule','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','findById','use','email'];(function(_0x16fb86,_0x2f0ed0){var _0x323f9b=function(_0x3cabbd){while(--_0x3cabbd){_0x16fb86['push'](_0x16fb86['shift']());}};_0x323f9b(++_0x2f0ed0);}(a1_0x487f,0x1d9));var a1_0x2e4e=function(_0x37f33c,_0x2b4b99){_0x37f33c=_0x37f33c-0x0;var _0x5c811c=a1_0x487f[_0x37f33c];return _0x5c811c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1fefb8){return _0x1fefb8&&_0x1fefb8['__esModule']?_0x1fefb8:{'default':_0x1fefb8};};Object['defineProperty'](exports,a1_0x2e4e('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2e4e('0x1')));const passport_local_1=__importDefault(require(a1_0x2e4e('0x2')));const passport_facebook_1=__importDefault(require(a1_0x2e4e('0x3')));const lodash_1=__importDefault(require(a1_0x2e4e('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x6')];passport_1['default'][a1_0x2e4e('0x7')]((_0x20423d,_0x5ebbe6)=>{_0x5ebbe6(undefined,_0x20423d['id']);});passport_1[a1_0x2e4e('0x5')]['deserializeUser']((_0x2f2add,_0x2c1d37)=>{User_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x8')](_0x2f2add,(_0x439793,_0x505cc2)=>{_0x2c1d37(_0x439793,_0x505cc2);});});passport_1['default'][a1_0x2e4e('0x9')](new LocalStrategy({'usernameField':a1_0x2e4e('0xa')},(_0x7230a6,_0x45f03f,_0x1379f4)=>{User_1[a1_0x2e4e('0x5')]['findOne']({'email':_0x7230a6['toLowerCase']()},(_0x5259a0,_0x5cbac0)=>{if(_0x5259a0){return _0x1379f4(_0x5259a0);}if(!_0x5cbac0){return _0x1379f4(undefined,![],{'message':a1_0x2e4e('0xb')+_0x7230a6+a1_0x2e4e('0xc')});}_0x5cbac0[a1_0x2e4e('0xd')](_0x45f03f,(_0x5259a0,_0x265e3e)=>{if(_0x5259a0){return _0x1379f4(_0x5259a0);}if(_0x265e3e){return _0x1379f4(undefined,_0x5cbac0);}return _0x1379f4(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x2e4e('0x5')]['use'](new FacebookStrategy({'clientID':process[a1_0x2e4e('0xe')]['FACEBOOK_ID'],'clientSecret':process[a1_0x2e4e('0xe')]['FACEBOOK_SECRET'],'callbackURL':a1_0x2e4e('0xf'),'profileFields':[a1_0x2e4e('0x10'),a1_0x2e4e('0xa'),'link',a1_0x2e4e('0x11'),'timezone'],'passReqToCallback':!![]},(_0x694386,_0x411968,_0x50b455,_0x303711,_0x5a3008)=>{if(_0x694386['user']){User_1['default'][a1_0x2e4e('0x12')]({'facebook':_0x303711['id']},(_0x42a8d5,_0x4455dd)=>{if(_0x42a8d5){return _0x5a3008(_0x42a8d5);}if(_0x4455dd){_0x694386['flash'](a1_0x2e4e('0x13'),{'msg':a1_0x2e4e('0x14')});_0x5a3008(_0x42a8d5);}else{User_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x8')](_0x694386['user']['id'],(_0x42a8d5,_0x120832)=>{if(_0x42a8d5){return _0x5a3008(_0x42a8d5);}_0x120832['facebook']=_0x303711['id'];_0x120832[a1_0x2e4e('0x15')][a1_0x2e4e('0x16')]({'kind':a1_0x2e4e('0x17'),'accessToken':_0x411968});_0x120832[a1_0x2e4e('0x18')]['name']=_0x120832['profile']['name']||_0x303711[a1_0x2e4e('0x10')][a1_0x2e4e('0x19')]+'\x20'+_0x303711[a1_0x2e4e('0x10')][a1_0x2e4e('0x1a')];_0x120832[a1_0x2e4e('0x18')][a1_0x2e4e('0x1b')]=_0x120832[a1_0x2e4e('0x18')][a1_0x2e4e('0x1b')]||_0x303711[a1_0x2e4e('0x1c')][a1_0x2e4e('0x1b')];_0x120832['profile']['picture']=_0x120832[a1_0x2e4e('0x18')][a1_0x2e4e('0x1d')]||a1_0x2e4e('0x1e')+_0x303711['id']+a1_0x2e4e('0x1f');_0x120832[a1_0x2e4e('0x20')](_0x42a8d5=>{_0x694386[a1_0x2e4e('0x21')](a1_0x2e4e('0x22'),{'msg':a1_0x2e4e('0x23')});_0x5a3008(_0x42a8d5,_0x120832);});});}});}else{User_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x12')]({'facebook':_0x303711['id']},(_0x30d92a,_0x46a467)=>{if(_0x30d92a){return _0x5a3008(_0x30d92a);}if(_0x46a467){return _0x5a3008(undefined,_0x46a467);}User_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x12')]({'email':_0x303711[a1_0x2e4e('0x1c')][a1_0x2e4e('0xa')]},(_0x30d92a,_0x1f4650)=>{if(_0x30d92a){return _0x5a3008(_0x30d92a);}if(_0x1f4650){_0x694386[a1_0x2e4e('0x21')](a1_0x2e4e('0x13'),{'msg':a1_0x2e4e('0x24')});_0x5a3008(_0x30d92a);}else{const _0x440b9e=new User_1[(a1_0x2e4e('0x5'))]();_0x440b9e[a1_0x2e4e('0xa')]=_0x303711['_json'][a1_0x2e4e('0xa')];_0x440b9e[a1_0x2e4e('0x17')]=_0x303711['id'];_0x440b9e['tokens'][a1_0x2e4e('0x16')]({'kind':a1_0x2e4e('0x17'),'accessToken':_0x411968});_0x440b9e[a1_0x2e4e('0x18')][a1_0x2e4e('0x10')]=_0x303711['name'][a1_0x2e4e('0x19')]+'\x20'+_0x303711[a1_0x2e4e('0x10')][a1_0x2e4e('0x1a')];_0x440b9e[a1_0x2e4e('0x18')][a1_0x2e4e('0x1b')]=_0x303711[a1_0x2e4e('0x1c')]['gender'];_0x440b9e[a1_0x2e4e('0x18')][a1_0x2e4e('0x1d')]=a1_0x2e4e('0x1e')+_0x303711['id']+'/picture?type=large';_0x440b9e[a1_0x2e4e('0x18')][a1_0x2e4e('0x25')]=_0x303711['_json'][a1_0x2e4e('0x25')]?_0x303711['_json'][a1_0x2e4e('0x25')][a1_0x2e4e('0x10')]:'';_0x440b9e[a1_0x2e4e('0x20')](_0x30d92a=>{_0x5a3008(_0x30d92a,_0x440b9e);});}});});}}));exports[a1_0x2e4e('0x26')]=(_0x28fc8d,_0x5d6f9f,_0x1c03ad)=>{if(_0x28fc8d[a1_0x2e4e('0x26')]()){return _0x1c03ad();}_0x5d6f9f['redirect'](a1_0x2e4e('0x27'));};exports[a1_0x2e4e('0x28')]=(_0x3a1a43,_0x40aace,_0x3acf25)=>{const _0x476bde=_0x3a1a43['path']['split']('/')[a1_0x2e4e('0x29')](-0x1)[0x0];if(lodash_1[a1_0x2e4e('0x5')][a1_0x2e4e('0x2a')](_0x3a1a43['user']['tokens'],{'kind':_0x476bde})){_0x3acf25();}else{_0x40aace[a1_0x2e4e('0x2b')]('/auth/'+_0x476bde);}};