var a1_0x36cf=['facebook','givenName','profile','gender','_json','picture','https://graph.facebook.com/','Facebook\x20account\x20has\x20been\x20linked.','flash','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','push','familyName','/picture?type=large','location','save','isAuthenticated','redirect','/login','isAuthorized','split','slice','find','__esModule','passport','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','user'];(function(_0x423eac,_0x3340c){var _0x2bc717=function(_0x357db4){while(--_0x357db4){_0x423eac['push'](_0x423eac['shift']());}};_0x2bc717(++_0x3340c);}(a1_0x36cf,0x190));var a1_0x3dd8=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a1_0x36cf[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3bf15e){return _0x3bf15e&&_0x3bf15e[a1_0x3dd8('0x0')]?_0x3bf15e:{'default':_0x3bf15e};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x3dd8('0x1')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x3dd8('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x3dd8('0x3')));const LocalStrategy=passport_local_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x5')];const FacebookStrategy=passport_facebook_1['default'][a1_0x3dd8('0x5')];passport_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x6')]((_0xb7aa06,_0x280c3c)=>{_0x280c3c(undefined,_0xb7aa06['id']);});passport_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x7')]((_0xa575b1,_0x1ca0c9)=>{User_1['default'][a1_0x3dd8('0x8')](_0xa575b1,(_0x395613,_0x1af5d6)=>{_0x1ca0c9(_0x395613,_0x1af5d6);});});passport_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x9')](new LocalStrategy({'usernameField':a1_0x3dd8('0xa')},(_0x106e03,_0x4e740c,_0x1803cc)=>{User_1[a1_0x3dd8('0x4')][a1_0x3dd8('0xb')]({'email':_0x106e03[a1_0x3dd8('0xc')]()},(_0x63019e,_0x182f1c)=>{if(_0x63019e){return _0x1803cc(_0x63019e);}if(!_0x182f1c){return _0x1803cc(undefined,![],{'message':'Email\x20'+_0x106e03+a1_0x3dd8('0xd')});}_0x182f1c['comparePassword'](_0x4e740c,(_0x63019e,_0x1542ed)=>{if(_0x63019e){return _0x1803cc(_0x63019e);}if(_0x1542ed){return _0x1803cc(undefined,_0x182f1c);}return _0x1803cc(undefined,![],{'message':a1_0x3dd8('0xe')});});});}));passport_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x9')](new FacebookStrategy({'clientID':process[a1_0x3dd8('0xf')][a1_0x3dd8('0x10')],'clientSecret':process['env'][a1_0x3dd8('0x11')],'callbackURL':a1_0x3dd8('0x12'),'profileFields':[a1_0x3dd8('0x13'),a1_0x3dd8('0xa'),a1_0x3dd8('0x14'),a1_0x3dd8('0x15'),'timezone'],'passReqToCallback':!![]},(_0x2eed5a,_0x2f6fde,_0x179519,_0x17d256,_0x2d2992)=>{if(_0x2eed5a[a1_0x3dd8('0x16')]){User_1['default'][a1_0x3dd8('0xb')]({'facebook':_0x17d256['id']},(_0x11fc42,_0x2dbc7b)=>{if(_0x11fc42){return _0x2d2992(_0x11fc42);}if(_0x2dbc7b){_0x2eed5a['flash']('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x2d2992(_0x11fc42);}else{User_1['default'][a1_0x3dd8('0x8')](_0x2eed5a['user']['id'],(_0x11fc42,_0xba43f0)=>{if(_0x11fc42){return _0x2d2992(_0x11fc42);}_0xba43f0[a1_0x3dd8('0x17')]=_0x17d256['id'];_0xba43f0['tokens']['push']({'kind':'facebook','accessToken':_0x2f6fde});_0xba43f0['profile'][a1_0x3dd8('0x13')]=_0xba43f0['profile'][a1_0x3dd8('0x13')]||_0x17d256[a1_0x3dd8('0x13')][a1_0x3dd8('0x18')]+'\x20'+_0x17d256[a1_0x3dd8('0x13')]['familyName'];_0xba43f0[a1_0x3dd8('0x19')][a1_0x3dd8('0x1a')]=_0xba43f0[a1_0x3dd8('0x19')][a1_0x3dd8('0x1a')]||_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0x1a')];_0xba43f0['profile'][a1_0x3dd8('0x1c')]=_0xba43f0['profile'][a1_0x3dd8('0x1c')]||a1_0x3dd8('0x1d')+_0x17d256['id']+'/picture?type=large';_0xba43f0['save'](_0x11fc42=>{_0x2eed5a['flash']('info',{'msg':a1_0x3dd8('0x1e')});_0x2d2992(_0x11fc42,_0xba43f0);});});}});}else{User_1[a1_0x3dd8('0x4')]['findOne']({'facebook':_0x17d256['id']},(_0x3a529f,_0x7ac5c0)=>{if(_0x3a529f){return _0x2d2992(_0x3a529f);}if(_0x7ac5c0){return _0x2d2992(undefined,_0x7ac5c0);}User_1[a1_0x3dd8('0x4')][a1_0x3dd8('0xb')]({'email':_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0xa')]},(_0x3a529f,_0x267396)=>{if(_0x3a529f){return _0x2d2992(_0x3a529f);}if(_0x267396){_0x2eed5a[a1_0x3dd8('0x1f')](a1_0x3dd8('0x20'),{'msg':a1_0x3dd8('0x21')});_0x2d2992(_0x3a529f);}else{const _0x5d8804=new User_1[(a1_0x3dd8('0x4'))]();_0x5d8804[a1_0x3dd8('0xa')]=_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0xa')];_0x5d8804['facebook']=_0x17d256['id'];_0x5d8804[a1_0x3dd8('0x22')][a1_0x3dd8('0x23')]({'kind':a1_0x3dd8('0x17'),'accessToken':_0x2f6fde});_0x5d8804['profile'][a1_0x3dd8('0x13')]=_0x17d256[a1_0x3dd8('0x13')][a1_0x3dd8('0x18')]+'\x20'+_0x17d256[a1_0x3dd8('0x13')][a1_0x3dd8('0x24')];_0x5d8804[a1_0x3dd8('0x19')][a1_0x3dd8('0x1a')]=_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0x1a')];_0x5d8804[a1_0x3dd8('0x19')][a1_0x3dd8('0x1c')]='https://graph.facebook.com/'+_0x17d256['id']+a1_0x3dd8('0x25');_0x5d8804[a1_0x3dd8('0x19')][a1_0x3dd8('0x26')]=_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0x26')]?_0x17d256[a1_0x3dd8('0x1b')][a1_0x3dd8('0x26')][a1_0x3dd8('0x13')]:'';_0x5d8804[a1_0x3dd8('0x27')](_0x3a529f=>{_0x2d2992(_0x3a529f,_0x5d8804);});}});});}}));exports[a1_0x3dd8('0x28')]=(_0x73379c,_0x249afb,_0x35b4d9)=>{if(_0x73379c[a1_0x3dd8('0x28')]()){return _0x35b4d9();}_0x249afb[a1_0x3dd8('0x29')](a1_0x3dd8('0x2a'));};exports[a1_0x3dd8('0x2b')]=(_0x466702,_0x43fe2a,_0x3c7084)=>{const _0x1def0e=_0x466702['path'][a1_0x3dd8('0x2c')]('/')[a1_0x3dd8('0x2d')](-0x1)[0x0];if(lodash_1[a1_0x3dd8('0x4')][a1_0x3dd8('0x2e')](_0x466702['user']['tokens'],{'kind':_0x1def0e})){_0x3c7084();}else{_0x43fe2a[a1_0x3dd8('0x29')]('/auth/'+_0x1def0e);}};