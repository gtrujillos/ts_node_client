var a1_0x302a=['save','Facebook\x20account\x20has\x20been\x20linked.','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','__importDefault','__esModule','defineProperty','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','tokens','push','facebook','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large'];(function(_0x52b911,_0x43ac20){var _0x15f672=function(_0x542dc5){while(--_0x542dc5){_0x52b911['push'](_0x52b911['shift']());}};_0x15f672(++_0x43ac20);}(a1_0x302a,0x72));var a1_0x2e5b=function(_0x5cc308,_0xaf37c){_0x5cc308=_0x5cc308-0x0;var _0x3e50b5=a1_0x302a[_0x5cc308];return _0x3e50b5;};'use strict';var __importDefault=this&&this[a1_0x2e5b('0x0')]||function(_0x47499a){return _0x47499a&&_0x47499a[a1_0x2e5b('0x1')]?_0x47499a:{'default':_0x47499a};};Object[a1_0x2e5b('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x2e5b('0x3')));const lodash_1=__importDefault(require(a1_0x2e5b('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x2e5b('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x2e5b('0x5')][a1_0x2e5b('0x6')];passport_1[a1_0x2e5b('0x5')][a1_0x2e5b('0x7')]((_0x181522,_0x506d87)=>{_0x506d87(undefined,_0x181522['id']);});passport_1[a1_0x2e5b('0x5')][a1_0x2e5b('0x8')]((_0x328a7c,_0x8b0b0)=>{User_1[a1_0x2e5b('0x5')]['findById'](_0x328a7c,(_0x1afbe3,_0x5c218b)=>{_0x8b0b0(_0x1afbe3,_0x5c218b);});});passport_1['default'][a1_0x2e5b('0x9')](new LocalStrategy({'usernameField':a1_0x2e5b('0xa')},(_0x51cd88,_0x2289f1,_0x110fba)=>{User_1[a1_0x2e5b('0x5')][a1_0x2e5b('0xb')]({'email':_0x51cd88[a1_0x2e5b('0xc')]()},(_0x3de5d1,_0x8b753)=>{if(_0x3de5d1){return _0x110fba(_0x3de5d1);}if(!_0x8b753){return _0x110fba(undefined,![],{'message':a1_0x2e5b('0xd')+_0x51cd88+a1_0x2e5b('0xe')});}_0x8b753[a1_0x2e5b('0xf')](_0x2289f1,(_0x3de5d1,_0x1f37d1)=>{if(_0x3de5d1){return _0x110fba(_0x3de5d1);}if(_0x1f37d1){return _0x110fba(undefined,_0x8b753);}return _0x110fba(undefined,![],{'message':a1_0x2e5b('0x10')});});});}));passport_1[a1_0x2e5b('0x5')][a1_0x2e5b('0x9')](new FacebookStrategy({'clientID':process[a1_0x2e5b('0x11')][a1_0x2e5b('0x12')],'clientSecret':process[a1_0x2e5b('0x11')]['FACEBOOK_SECRET'],'callbackURL':a1_0x2e5b('0x13'),'profileFields':[a1_0x2e5b('0x14'),a1_0x2e5b('0xa'),a1_0x2e5b('0x15'),a1_0x2e5b('0x16'),a1_0x2e5b('0x17')],'passReqToCallback':!![]},(_0x1f6333,_0x1d3b6f,_0x7277a5,_0x2e858a,_0x39717d)=>{if(_0x1f6333[a1_0x2e5b('0x18')]){User_1[a1_0x2e5b('0x5')][a1_0x2e5b('0xb')]({'facebook':_0x2e858a['id']},(_0x202176,_0x51760a)=>{if(_0x202176){return _0x39717d(_0x202176);}if(_0x51760a){_0x1f6333[a1_0x2e5b('0x19')](a1_0x2e5b('0x1a'),{'msg':a1_0x2e5b('0x1b')});_0x39717d(_0x202176);}else{User_1[a1_0x2e5b('0x5')][a1_0x2e5b('0x1c')](_0x1f6333[a1_0x2e5b('0x18')]['id'],(_0x202176,_0x165fdd)=>{if(_0x202176){return _0x39717d(_0x202176);}_0x165fdd['facebook']=_0x2e858a['id'];_0x165fdd[a1_0x2e5b('0x1d')][a1_0x2e5b('0x1e')]({'kind':a1_0x2e5b('0x1f'),'accessToken':_0x1d3b6f});_0x165fdd['profile'][a1_0x2e5b('0x14')]=_0x165fdd[a1_0x2e5b('0x20')][a1_0x2e5b('0x14')]||_0x2e858a[a1_0x2e5b('0x14')][a1_0x2e5b('0x21')]+'\x20'+_0x2e858a[a1_0x2e5b('0x14')][a1_0x2e5b('0x22')];_0x165fdd[a1_0x2e5b('0x20')][a1_0x2e5b('0x23')]=_0x165fdd[a1_0x2e5b('0x20')][a1_0x2e5b('0x23')]||_0x2e858a['_json'][a1_0x2e5b('0x23')];_0x165fdd[a1_0x2e5b('0x20')][a1_0x2e5b('0x24')]=_0x165fdd[a1_0x2e5b('0x20')][a1_0x2e5b('0x24')]||a1_0x2e5b('0x25')+_0x2e858a['id']+a1_0x2e5b('0x26');_0x165fdd[a1_0x2e5b('0x27')](_0x202176=>{_0x1f6333[a1_0x2e5b('0x19')]('info',{'msg':a1_0x2e5b('0x28')});_0x39717d(_0x202176,_0x165fdd);});});}});}else{User_1[a1_0x2e5b('0x5')][a1_0x2e5b('0xb')]({'facebook':_0x2e858a['id']},(_0x565766,_0x16a2ce)=>{if(_0x565766){return _0x39717d(_0x565766);}if(_0x16a2ce){return _0x39717d(undefined,_0x16a2ce);}User_1[a1_0x2e5b('0x5')][a1_0x2e5b('0xb')]({'email':_0x2e858a[a1_0x2e5b('0x29')][a1_0x2e5b('0xa')]},(_0x565766,_0x2ecb13)=>{if(_0x565766){return _0x39717d(_0x565766);}if(_0x2ecb13){_0x1f6333[a1_0x2e5b('0x19')](a1_0x2e5b('0x1a'),{'msg':a1_0x2e5b('0x2a')});_0x39717d(_0x565766);}else{const _0x509128=new User_1[(a1_0x2e5b('0x5'))]();_0x509128[a1_0x2e5b('0xa')]=_0x2e858a[a1_0x2e5b('0x29')][a1_0x2e5b('0xa')];_0x509128[a1_0x2e5b('0x1f')]=_0x2e858a['id'];_0x509128[a1_0x2e5b('0x1d')][a1_0x2e5b('0x1e')]({'kind':a1_0x2e5b('0x1f'),'accessToken':_0x1d3b6f});_0x509128[a1_0x2e5b('0x20')][a1_0x2e5b('0x14')]=_0x2e858a[a1_0x2e5b('0x14')]['givenName']+'\x20'+_0x2e858a[a1_0x2e5b('0x14')][a1_0x2e5b('0x22')];_0x509128[a1_0x2e5b('0x20')][a1_0x2e5b('0x23')]=_0x2e858a[a1_0x2e5b('0x29')][a1_0x2e5b('0x23')];_0x509128[a1_0x2e5b('0x20')][a1_0x2e5b('0x24')]=a1_0x2e5b('0x25')+_0x2e858a['id']+a1_0x2e5b('0x26');_0x509128[a1_0x2e5b('0x20')][a1_0x2e5b('0x2b')]=_0x2e858a[a1_0x2e5b('0x29')][a1_0x2e5b('0x2b')]?_0x2e858a[a1_0x2e5b('0x29')]['location']['name']:'';_0x509128[a1_0x2e5b('0x27')](_0x565766=>{_0x39717d(_0x565766,_0x509128);});}});});}}));exports[a1_0x2e5b('0x2c')]=(_0x1f544d,_0xb98b29,_0xafcb41)=>{if(_0x1f544d[a1_0x2e5b('0x2c')]()){return _0xafcb41();}_0xb98b29[a1_0x2e5b('0x2d')](a1_0x2e5b('0x2e'));};exports[a1_0x2e5b('0x2f')]=(_0x6bf3f4,_0x57d535,_0x3eb95a)=>{const _0x3d9433=_0x6bf3f4[a1_0x2e5b('0x30')][a1_0x2e5b('0x31')]('/')[a1_0x2e5b('0x32')](-0x1)[0x0];if(lodash_1['default']['find'](_0x6bf3f4['user'][a1_0x2e5b('0x1d')],{'kind':_0x3d9433})){_0x3eb95a();}else{_0x57d535[a1_0x2e5b('0x2d')]('/auth/'+_0x3d9433);}};