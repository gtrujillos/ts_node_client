var a1_0x3441=['Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','push','givenName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','/auth/','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_SECRET','/auth/facebook/callback','name','timezone','user','flash','errors','facebook','gender','profile','_json','picture','/picture?type=large','save','info'];(function(_0x175027,_0x12d06f){var _0x271ffb=function(_0x34922e){while(--_0x34922e){_0x175027['push'](_0x175027['shift']());}};_0x271ffb(++_0x12d06f);}(a1_0x3441,0x174));var a1_0x2fa6=function(_0x4b9748,_0x2905bd){_0x4b9748=_0x4b9748-0x0;var _0xeaa26=a1_0x3441[_0x4b9748];return _0xeaa26;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4a15ec){return _0x4a15ec&&_0x4a15ec[a1_0x2fa6('0x0')]?_0x4a15ec:{'default':_0x4a15ec};};Object[a1_0x2fa6('0x1')](exports,a1_0x2fa6('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2fa6('0x2')));const passport_local_1=__importDefault(require(a1_0x2fa6('0x3')));const passport_facebook_1=__importDefault(require(a1_0x2fa6('0x4')));const lodash_1=__importDefault(require(a1_0x2fa6('0x5')));const User_1=__importDefault(require(a1_0x2fa6('0x6')));const LocalStrategy=passport_local_1[a1_0x2fa6('0x7')][a1_0x2fa6('0x8')];const FacebookStrategy=passport_facebook_1['default'][a1_0x2fa6('0x8')];passport_1[a1_0x2fa6('0x7')][a1_0x2fa6('0x9')]((_0x17c013,_0x52f721)=>{_0x52f721(undefined,_0x17c013['id']);});passport_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xa')]((_0x1ee9a3,_0xab145d)=>{User_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xb')](_0x1ee9a3,(_0x3ccb74,_0x55fa00)=>{_0xab145d(_0x3ccb74,_0x55fa00);});});passport_1[a1_0x2fa6('0x7')]['use'](new LocalStrategy({'usernameField':a1_0x2fa6('0xc')},(_0x3146ef,_0x443caa,_0x5ea383)=>{User_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xd')]({'email':_0x3146ef[a1_0x2fa6('0xe')]()},(_0x2ec2fe,_0x2f054e)=>{if(_0x2ec2fe){return _0x5ea383(_0x2ec2fe);}if(!_0x2f054e){return _0x5ea383(undefined,![],{'message':a1_0x2fa6('0xf')+_0x3146ef+a1_0x2fa6('0x10')});}_0x2f054e[a1_0x2fa6('0x11')](_0x443caa,(_0x2ec2fe,_0xa46c43)=>{if(_0x2ec2fe){return _0x5ea383(_0x2ec2fe);}if(_0xa46c43){return _0x5ea383(undefined,_0x2f054e);}return _0x5ea383(undefined,![],{'message':a1_0x2fa6('0x12')});});});}));passport_1[a1_0x2fa6('0x7')][a1_0x2fa6('0x13')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x2fa6('0x14')][a1_0x2fa6('0x15')],'callbackURL':a1_0x2fa6('0x16'),'profileFields':[a1_0x2fa6('0x17'),a1_0x2fa6('0xc'),'link','locale',a1_0x2fa6('0x18')],'passReqToCallback':!![]},(_0x56b86a,_0xb297a6,_0xa7ffd9,_0x164237,_0x5ba880)=>{if(_0x56b86a[a1_0x2fa6('0x19')]){User_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xd')]({'facebook':_0x164237['id']},(_0x33311e,_0x1b8362)=>{if(_0x33311e){return _0x5ba880(_0x33311e);}if(_0x1b8362){_0x56b86a[a1_0x2fa6('0x1a')](a1_0x2fa6('0x1b'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x5ba880(_0x33311e);}else{User_1[a1_0x2fa6('0x7')]['findById'](_0x56b86a[a1_0x2fa6('0x19')]['id'],(_0x33311e,_0x534327)=>{if(_0x33311e){return _0x5ba880(_0x33311e);}_0x534327[a1_0x2fa6('0x1c')]=_0x164237['id'];_0x534327['tokens']['push']({'kind':a1_0x2fa6('0x1c'),'accessToken':_0xb297a6});_0x534327['profile']['name']=_0x534327['profile'][a1_0x2fa6('0x17')]||_0x164237['name']['givenName']+'\x20'+_0x164237['name']['familyName'];_0x534327['profile'][a1_0x2fa6('0x1d')]=_0x534327[a1_0x2fa6('0x1e')][a1_0x2fa6('0x1d')]||_0x164237[a1_0x2fa6('0x1f')][a1_0x2fa6('0x1d')];_0x534327[a1_0x2fa6('0x1e')]['picture']=_0x534327[a1_0x2fa6('0x1e')][a1_0x2fa6('0x20')]||'https://graph.facebook.com/'+_0x164237['id']+a1_0x2fa6('0x21');_0x534327[a1_0x2fa6('0x22')](_0x33311e=>{_0x56b86a[a1_0x2fa6('0x1a')](a1_0x2fa6('0x23'),{'msg':a1_0x2fa6('0x24')});_0x5ba880(_0x33311e,_0x534327);});});}});}else{User_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xd')]({'facebook':_0x164237['id']},(_0x10fedc,_0x102ac3)=>{if(_0x10fedc){return _0x5ba880(_0x10fedc);}if(_0x102ac3){return _0x5ba880(undefined,_0x102ac3);}User_1[a1_0x2fa6('0x7')][a1_0x2fa6('0xd')]({'email':_0x164237[a1_0x2fa6('0x1f')][a1_0x2fa6('0xc')]},(_0x10fedc,_0x593825)=>{if(_0x10fedc){return _0x5ba880(_0x10fedc);}if(_0x593825){_0x56b86a[a1_0x2fa6('0x1a')](a1_0x2fa6('0x1b'),{'msg':a1_0x2fa6('0x25')});_0x5ba880(_0x10fedc);}else{const _0x4e4320=new User_1['default']();_0x4e4320['email']=_0x164237[a1_0x2fa6('0x1f')][a1_0x2fa6('0xc')];_0x4e4320[a1_0x2fa6('0x1c')]=_0x164237['id'];_0x4e4320[a1_0x2fa6('0x26')][a1_0x2fa6('0x27')]({'kind':a1_0x2fa6('0x1c'),'accessToken':_0xb297a6});_0x4e4320[a1_0x2fa6('0x1e')][a1_0x2fa6('0x17')]=_0x164237['name'][a1_0x2fa6('0x28')]+'\x20'+_0x164237['name']['familyName'];_0x4e4320[a1_0x2fa6('0x1e')][a1_0x2fa6('0x1d')]=_0x164237['_json']['gender'];_0x4e4320[a1_0x2fa6('0x1e')][a1_0x2fa6('0x20')]=a1_0x2fa6('0x29')+_0x164237['id']+a1_0x2fa6('0x21');_0x4e4320[a1_0x2fa6('0x1e')][a1_0x2fa6('0x2a')]=_0x164237[a1_0x2fa6('0x1f')][a1_0x2fa6('0x2a')]?_0x164237[a1_0x2fa6('0x1f')][a1_0x2fa6('0x2a')][a1_0x2fa6('0x17')]:'';_0x4e4320[a1_0x2fa6('0x22')](_0x10fedc=>{_0x5ba880(_0x10fedc,_0x4e4320);});}});});}}));exports['isAuthenticated']=(_0x1fa9f5,_0x3006c9,_0x9f42b0)=>{if(_0x1fa9f5[a1_0x2fa6('0x2b')]()){return _0x9f42b0();}_0x3006c9[a1_0x2fa6('0x2c')](a1_0x2fa6('0x2d'));};exports[a1_0x2fa6('0x2e')]=(_0x45ace5,_0xd7cee6,_0x17d5ac)=>{const _0x47876d=_0x45ace5[a1_0x2fa6('0x2f')][a1_0x2fa6('0x30')]('/')[a1_0x2fa6('0x31')](-0x1)[0x0];if(lodash_1[a1_0x2fa6('0x7')]['find'](_0x45ace5[a1_0x2fa6('0x19')][a1_0x2fa6('0x26')],{'kind':_0x47876d})){_0x17d5ac();}else{_0xd7cee6['redirect'](a1_0x2fa6('0x32')+_0x47876d);}};