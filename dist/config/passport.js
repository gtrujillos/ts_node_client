var a1_0x40ac=['isAuthorized','path','split','slice','__importDefault','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','push','profile','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','tokens','givenName','location','isAuthenticated','redirect','/login'];(function(_0x365993,_0x5904b0){var _0x448c91=function(_0x519fa0){while(--_0x519fa0){_0x365993['push'](_0x365993['shift']());}};_0x448c91(++_0x5904b0);}(a1_0x40ac,0x1da));var a1_0x379b=function(_0x5490bd,_0x2df1d3){_0x5490bd=_0x5490bd-0x0;var _0x285559=a1_0x40ac[_0x5490bd];return _0x285559;};'use strict';var __importDefault=this&&this[a1_0x379b('0x0')]||function(_0x1872f3){return _0x1872f3&&_0x1872f3[a1_0x379b('0x1')]?_0x1872f3:{'default':_0x1872f3};};Object['defineProperty'](exports,a1_0x379b('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x379b('0x2')));const passport_local_1=__importDefault(require(a1_0x379b('0x3')));const passport_facebook_1=__importDefault(require(a1_0x379b('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x379b('0x5')));const LocalStrategy=passport_local_1[a1_0x379b('0x6')][a1_0x379b('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x379b('0x6')][a1_0x379b('0x7')];passport_1[a1_0x379b('0x6')][a1_0x379b('0x8')]((_0x39af7d,_0x3cd66a)=>{_0x3cd66a(undefined,_0x39af7d['id']);});passport_1[a1_0x379b('0x6')][a1_0x379b('0x9')]((_0x49e49d,_0x3ab34b)=>{User_1['default'][a1_0x379b('0xa')](_0x49e49d,(_0x3c896b,_0x359d6e)=>{_0x3ab34b(_0x3c896b,_0x359d6e);});});passport_1[a1_0x379b('0x6')][a1_0x379b('0xb')](new LocalStrategy({'usernameField':a1_0x379b('0xc')},(_0x3195c4,_0x11cda2,_0xd3246f)=>{User_1[a1_0x379b('0x6')][a1_0x379b('0xd')]({'email':_0x3195c4[a1_0x379b('0xe')]()},(_0x4b6c5c,_0x2ff3bb)=>{if(_0x4b6c5c){return _0xd3246f(_0x4b6c5c);}if(!_0x2ff3bb){return _0xd3246f(undefined,![],{'message':a1_0x379b('0xf')+_0x3195c4+a1_0x379b('0x10')});}_0x2ff3bb['comparePassword'](_0x11cda2,(_0x4b6c5c,_0x2ee8e5)=>{if(_0x4b6c5c){return _0xd3246f(_0x4b6c5c);}if(_0x2ee8e5){return _0xd3246f(undefined,_0x2ff3bb);}return _0xd3246f(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x379b('0x6')][a1_0x379b('0xb')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x379b('0x11')],'callbackURL':a1_0x379b('0x12'),'profileFields':[a1_0x379b('0x13'),a1_0x379b('0xc'),'link',a1_0x379b('0x14'),a1_0x379b('0x15')],'passReqToCallback':!![]},(_0x5c4baf,_0x4ae8ee,_0x4f4fb7,_0x22c259,_0x13b2cf)=>{if(_0x5c4baf['user']){User_1[a1_0x379b('0x6')]['findOne']({'facebook':_0x22c259['id']},(_0x261f93,_0x345c5e)=>{if(_0x261f93){return _0x13b2cf(_0x261f93);}if(_0x345c5e){_0x5c4baf[a1_0x379b('0x16')](a1_0x379b('0x17'),{'msg':a1_0x379b('0x18')});_0x13b2cf(_0x261f93);}else{User_1[a1_0x379b('0x6')][a1_0x379b('0xa')](_0x5c4baf[a1_0x379b('0x19')]['id'],(_0x261f93,_0x1fdd9e)=>{if(_0x261f93){return _0x13b2cf(_0x261f93);}_0x1fdd9e[a1_0x379b('0x1a')]=_0x22c259['id'];_0x1fdd9e['tokens'][a1_0x379b('0x1b')]({'kind':'facebook','accessToken':_0x4ae8ee});_0x1fdd9e[a1_0x379b('0x1c')][a1_0x379b('0x13')]=_0x1fdd9e[a1_0x379b('0x1c')][a1_0x379b('0x13')]||_0x22c259['name']['givenName']+'\x20'+_0x22c259[a1_0x379b('0x13')][a1_0x379b('0x1d')];_0x1fdd9e[a1_0x379b('0x1c')]['gender']=_0x1fdd9e['profile'][a1_0x379b('0x1e')]||_0x22c259[a1_0x379b('0x1f')][a1_0x379b('0x1e')];_0x1fdd9e[a1_0x379b('0x1c')][a1_0x379b('0x20')]=_0x1fdd9e['profile'][a1_0x379b('0x20')]||a1_0x379b('0x21')+_0x22c259['id']+a1_0x379b('0x22');_0x1fdd9e[a1_0x379b('0x23')](_0x261f93=>{_0x5c4baf[a1_0x379b('0x16')]('info',{'msg':a1_0x379b('0x24')});_0x13b2cf(_0x261f93,_0x1fdd9e);});});}});}else{User_1['default'][a1_0x379b('0xd')]({'facebook':_0x22c259['id']},(_0x1a2b39,_0x34c20d)=>{if(_0x1a2b39){return _0x13b2cf(_0x1a2b39);}if(_0x34c20d){return _0x13b2cf(undefined,_0x34c20d);}User_1[a1_0x379b('0x6')][a1_0x379b('0xd')]({'email':_0x22c259[a1_0x379b('0x1f')][a1_0x379b('0xc')]},(_0x1a2b39,_0x152616)=>{if(_0x1a2b39){return _0x13b2cf(_0x1a2b39);}if(_0x152616){_0x5c4baf['flash'](a1_0x379b('0x17'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x13b2cf(_0x1a2b39);}else{const _0x27423f=new User_1[(a1_0x379b('0x6'))]();_0x27423f['email']=_0x22c259[a1_0x379b('0x1f')][a1_0x379b('0xc')];_0x27423f[a1_0x379b('0x1a')]=_0x22c259['id'];_0x27423f[a1_0x379b('0x25')]['push']({'kind':a1_0x379b('0x1a'),'accessToken':_0x4ae8ee});_0x27423f[a1_0x379b('0x1c')]['name']=_0x22c259[a1_0x379b('0x13')][a1_0x379b('0x26')]+'\x20'+_0x22c259[a1_0x379b('0x13')][a1_0x379b('0x1d')];_0x27423f['profile'][a1_0x379b('0x1e')]=_0x22c259['_json'][a1_0x379b('0x1e')];_0x27423f[a1_0x379b('0x1c')][a1_0x379b('0x20')]=a1_0x379b('0x21')+_0x22c259['id']+'/picture?type=large';_0x27423f[a1_0x379b('0x1c')][a1_0x379b('0x27')]=_0x22c259['_json']['location']?_0x22c259[a1_0x379b('0x1f')][a1_0x379b('0x27')][a1_0x379b('0x13')]:'';_0x27423f[a1_0x379b('0x23')](_0x1a2b39=>{_0x13b2cf(_0x1a2b39,_0x27423f);});}});});}}));exports[a1_0x379b('0x28')]=(_0x2d9bf6,_0x5b82b7,_0x46bc6b)=>{if(_0x2d9bf6[a1_0x379b('0x28')]()){return _0x46bc6b();}_0x5b82b7[a1_0x379b('0x29')](a1_0x379b('0x2a'));};exports[a1_0x379b('0x2b')]=(_0x5aa455,_0x1646ae,_0x54ef6c)=>{const _0xec402d=_0x5aa455[a1_0x379b('0x2c')][a1_0x379b('0x2d')]('/')[a1_0x379b('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x379b('0x6')]['find'](_0x5aa455[a1_0x379b('0x19')][a1_0x379b('0x25')],{'kind':_0xec402d})){_0x54ef6c();}else{_0x1646ae[a1_0x379b('0x29')]('/auth/'+_0xec402d);}};