var a1_0x4b0e=['default','Strategy','serializeUser','deserializeUser','findById','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','/auth/facebook/callback','name','link','locale','timezone','user','errors','push','facebook','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','flash','info','_json','tokens','location','isAuthenticated','redirect','isAuthorized','split','slice','find','/auth/','defineProperty','__esModule','passport','passport-local','lodash','../models/User'];(function(_0x396af6,_0x479c8e){var _0x54cd6e=function(_0xfc8fc3){while(--_0xfc8fc3){_0x396af6['push'](_0x396af6['shift']());}};_0x54cd6e(++_0x479c8e);}(a1_0x4b0e,0xbe));var a1_0x90a9=function(_0x596b0d,_0x43ad29){_0x596b0d=_0x596b0d-0x0;var _0xae5b48=a1_0x4b0e[_0x596b0d];return _0xae5b48;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x46262f){return _0x46262f&&_0x46262f['__esModule']?_0x46262f:{'default':_0x46262f};};Object[a1_0x90a9('0x0')](exports,a1_0x90a9('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x90a9('0x2')));const passport_local_1=__importDefault(require(a1_0x90a9('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x90a9('0x4')));const User_1=__importDefault(require(a1_0x90a9('0x5')));const LocalStrategy=passport_local_1[a1_0x90a9('0x6')][a1_0x90a9('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x90a9('0x6')][a1_0x90a9('0x7')];passport_1['default'][a1_0x90a9('0x8')]((_0x6b809f,_0x3fe8cf)=>{_0x3fe8cf(undefined,_0x6b809f['id']);});passport_1[a1_0x90a9('0x6')][a1_0x90a9('0x9')]((_0xb63398,_0x2228e3)=>{User_1[a1_0x90a9('0x6')][a1_0x90a9('0xa')](_0xb63398,(_0x527029,_0x10464c)=>{_0x2228e3(_0x527029,_0x10464c);});});passport_1[a1_0x90a9('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x90a9('0xb')},(_0x1bf984,_0x4e1454,_0x47f370)=>{User_1[a1_0x90a9('0x6')][a1_0x90a9('0xc')]({'email':_0x1bf984[a1_0x90a9('0xd')]()},(_0x2da451,_0xc70f5c)=>{if(_0x2da451){return _0x47f370(_0x2da451);}if(!_0xc70f5c){return _0x47f370(undefined,![],{'message':a1_0x90a9('0xe')+_0x1bf984+'\x20not\x20found.'});}_0xc70f5c[a1_0x90a9('0xf')](_0x4e1454,(_0x2da451,_0x11f137)=>{if(_0x2da451){return _0x47f370(_0x2da451);}if(_0x11f137){return _0x47f370(undefined,_0xc70f5c);}return _0x47f370(undefined,![],{'message':a1_0x90a9('0x10')});});});}));passport_1[a1_0x90a9('0x6')][a1_0x90a9('0x11')](new FacebookStrategy({'clientID':process['env'][a1_0x90a9('0x12')],'clientSecret':process[a1_0x90a9('0x13')]['FACEBOOK_SECRET'],'callbackURL':a1_0x90a9('0x14'),'profileFields':[a1_0x90a9('0x15'),'email',a1_0x90a9('0x16'),a1_0x90a9('0x17'),a1_0x90a9('0x18')],'passReqToCallback':!![]},(_0x4b87d0,_0x15425d,_0x1dfba8,_0x26fa00,_0x34cb87)=>{if(_0x4b87d0[a1_0x90a9('0x19')]){User_1[a1_0x90a9('0x6')][a1_0x90a9('0xc')]({'facebook':_0x26fa00['id']},(_0x22d648,_0x1302e7)=>{if(_0x22d648){return _0x34cb87(_0x22d648);}if(_0x1302e7){_0x4b87d0['flash'](a1_0x90a9('0x1a'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x34cb87(_0x22d648);}else{User_1[a1_0x90a9('0x6')][a1_0x90a9('0xa')](_0x4b87d0[a1_0x90a9('0x19')]['id'],(_0x22d648,_0x1659e5)=>{if(_0x22d648){return _0x34cb87(_0x22d648);}_0x1659e5['facebook']=_0x26fa00['id'];_0x1659e5['tokens'][a1_0x90a9('0x1b')]({'kind':a1_0x90a9('0x1c'),'accessToken':_0x15425d});_0x1659e5[a1_0x90a9('0x1d')]['name']=_0x1659e5['profile']['name']||_0x26fa00['name'][a1_0x90a9('0x1e')]+'\x20'+_0x26fa00['name'][a1_0x90a9('0x1f')];_0x1659e5['profile'][a1_0x90a9('0x20')]=_0x1659e5[a1_0x90a9('0x1d')][a1_0x90a9('0x20')]||_0x26fa00['_json'][a1_0x90a9('0x20')];_0x1659e5[a1_0x90a9('0x1d')][a1_0x90a9('0x21')]=_0x1659e5['profile'][a1_0x90a9('0x21')]||a1_0x90a9('0x22')+_0x26fa00['id']+a1_0x90a9('0x23');_0x1659e5[a1_0x90a9('0x24')](_0x22d648=>{_0x4b87d0[a1_0x90a9('0x25')](a1_0x90a9('0x26'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x34cb87(_0x22d648,_0x1659e5);});});}});}else{User_1[a1_0x90a9('0x6')][a1_0x90a9('0xc')]({'facebook':_0x26fa00['id']},(_0x37ec00,_0x15bebf)=>{if(_0x37ec00){return _0x34cb87(_0x37ec00);}if(_0x15bebf){return _0x34cb87(undefined,_0x15bebf);}User_1['default'][a1_0x90a9('0xc')]({'email':_0x26fa00['_json'][a1_0x90a9('0xb')]},(_0x37ec00,_0x21867f)=>{if(_0x37ec00){return _0x34cb87(_0x37ec00);}if(_0x21867f){_0x4b87d0[a1_0x90a9('0x25')]('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x34cb87(_0x37ec00);}else{const _0x5ea676=new User_1[(a1_0x90a9('0x6'))]();_0x5ea676[a1_0x90a9('0xb')]=_0x26fa00[a1_0x90a9('0x27')][a1_0x90a9('0xb')];_0x5ea676[a1_0x90a9('0x1c')]=_0x26fa00['id'];_0x5ea676[a1_0x90a9('0x28')][a1_0x90a9('0x1b')]({'kind':'facebook','accessToken':_0x15425d});_0x5ea676[a1_0x90a9('0x1d')]['name']=_0x26fa00[a1_0x90a9('0x15')][a1_0x90a9('0x1e')]+'\x20'+_0x26fa00[a1_0x90a9('0x15')]['familyName'];_0x5ea676['profile'][a1_0x90a9('0x20')]=_0x26fa00[a1_0x90a9('0x27')][a1_0x90a9('0x20')];_0x5ea676[a1_0x90a9('0x1d')][a1_0x90a9('0x21')]='https://graph.facebook.com/'+_0x26fa00['id']+a1_0x90a9('0x23');_0x5ea676[a1_0x90a9('0x1d')][a1_0x90a9('0x29')]=_0x26fa00[a1_0x90a9('0x27')][a1_0x90a9('0x29')]?_0x26fa00[a1_0x90a9('0x27')][a1_0x90a9('0x29')]['name']:'';_0x5ea676[a1_0x90a9('0x24')](_0x37ec00=>{_0x34cb87(_0x37ec00,_0x5ea676);});}});});}}));exports[a1_0x90a9('0x2a')]=(_0x85af58,_0x4cdd74,_0xa5216a)=>{if(_0x85af58[a1_0x90a9('0x2a')]()){return _0xa5216a();}_0x4cdd74[a1_0x90a9('0x2b')]('/login');};exports[a1_0x90a9('0x2c')]=(_0x288b3c,_0x51db5c,_0x355b6d)=>{const _0x1e512a=_0x288b3c['path'][a1_0x90a9('0x2d')]('/')[a1_0x90a9('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x90a9('0x6')][a1_0x90a9('0x2f')](_0x288b3c[a1_0x90a9('0x19')]['tokens'],{'kind':_0x1e512a})){_0x355b6d();}else{_0x51db5c[a1_0x90a9('0x2b')](a1_0x90a9('0x30')+_0x1e512a);}};