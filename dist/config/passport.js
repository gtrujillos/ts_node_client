var a1_0x4fb8=['info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','picture','https://graph.facebook.com/','location','isAuthenticated','redirect','split','find','/auth/','__importDefault','defineProperty','lodash','default','Strategy','serializeUser','deserializeUser','findById','email','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone','user','flash','errors','facebook','tokens','push','profile','givenName','familyName','_json','gender','/picture?type=large'];(function(_0x43c084,_0x10c701){var _0x2c27a0=function(_0x574dce){while(--_0x574dce){_0x43c084['push'](_0x43c084['shift']());}};_0x2c27a0(++_0x10c701);}(a1_0x4fb8,0x173));var a1_0x478b=function(_0x4d697b,_0x412f5d){_0x4d697b=_0x4d697b-0x0;var _0x13a220=a1_0x4fb8[_0x4d697b];return _0x13a220;};'use strict';var __importDefault=this&&this[a1_0x478b('0x0')]||function(_0x36fcbe){return _0x36fcbe&&_0x36fcbe['__esModule']?_0x36fcbe:{'default':_0x36fcbe};};Object[a1_0x478b('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x478b('0x2')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x478b('0x3')][a1_0x478b('0x4')];const FacebookStrategy=passport_facebook_1[a1_0x478b('0x3')]['Strategy'];passport_1[a1_0x478b('0x3')][a1_0x478b('0x5')]((_0x2bb814,_0x506508)=>{_0x506508(undefined,_0x2bb814['id']);});passport_1['default'][a1_0x478b('0x6')]((_0x3bdd7d,_0x858002)=>{User_1['default'][a1_0x478b('0x7')](_0x3bdd7d,(_0x165677,_0x1515be)=>{_0x858002(_0x165677,_0x1515be);});});passport_1[a1_0x478b('0x3')]['use'](new LocalStrategy({'usernameField':a1_0x478b('0x8')},(_0x436329,_0x12b725,_0x430ac8)=>{User_1['default'][a1_0x478b('0x9')]({'email':_0x436329['toLowerCase']()},(_0x4c4b29,_0x41fe2a)=>{if(_0x4c4b29){return _0x430ac8(_0x4c4b29);}if(!_0x41fe2a){return _0x430ac8(undefined,![],{'message':a1_0x478b('0xa')+_0x436329+a1_0x478b('0xb')});}_0x41fe2a[a1_0x478b('0xc')](_0x12b725,(_0x4c4b29,_0x5c8b90)=>{if(_0x4c4b29){return _0x430ac8(_0x4c4b29);}if(_0x5c8b90){return _0x430ac8(undefined,_0x41fe2a);}return _0x430ac8(undefined,![],{'message':a1_0x478b('0xd')});});});}));passport_1['default'][a1_0x478b('0xe')](new FacebookStrategy({'clientID':process[a1_0x478b('0xf')][a1_0x478b('0x10')],'clientSecret':process[a1_0x478b('0xf')][a1_0x478b('0x11')],'callbackURL':a1_0x478b('0x12'),'profileFields':[a1_0x478b('0x13'),'email',a1_0x478b('0x14'),'locale',a1_0x478b('0x15')],'passReqToCallback':!![]},(_0x146bae,_0xca2e8d,_0x362559,_0x1be3e9,_0x1fe6be)=>{if(_0x146bae[a1_0x478b('0x16')]){User_1[a1_0x478b('0x3')]['findOne']({'facebook':_0x1be3e9['id']},(_0x443e26,_0x2a49d6)=>{if(_0x443e26){return _0x1fe6be(_0x443e26);}if(_0x2a49d6){_0x146bae[a1_0x478b('0x17')](a1_0x478b('0x18'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x1fe6be(_0x443e26);}else{User_1[a1_0x478b('0x3')][a1_0x478b('0x7')](_0x146bae[a1_0x478b('0x16')]['id'],(_0x443e26,_0x22b3c9)=>{if(_0x443e26){return _0x1fe6be(_0x443e26);}_0x22b3c9[a1_0x478b('0x19')]=_0x1be3e9['id'];_0x22b3c9[a1_0x478b('0x1a')][a1_0x478b('0x1b')]({'kind':a1_0x478b('0x19'),'accessToken':_0xca2e8d});_0x22b3c9[a1_0x478b('0x1c')][a1_0x478b('0x13')]=_0x22b3c9[a1_0x478b('0x1c')][a1_0x478b('0x13')]||_0x1be3e9['name'][a1_0x478b('0x1d')]+'\x20'+_0x1be3e9[a1_0x478b('0x13')][a1_0x478b('0x1e')];_0x22b3c9[a1_0x478b('0x1c')]['gender']=_0x22b3c9[a1_0x478b('0x1c')]['gender']||_0x1be3e9[a1_0x478b('0x1f')][a1_0x478b('0x20')];_0x22b3c9['profile']['picture']=_0x22b3c9[a1_0x478b('0x1c')]['picture']||'https://graph.facebook.com/'+_0x1be3e9['id']+a1_0x478b('0x21');_0x22b3c9['save'](_0x443e26=>{_0x146bae[a1_0x478b('0x17')](a1_0x478b('0x22'),{'msg':a1_0x478b('0x23')});_0x1fe6be(_0x443e26,_0x22b3c9);});});}});}else{User_1[a1_0x478b('0x3')][a1_0x478b('0x9')]({'facebook':_0x1be3e9['id']},(_0x10df80,_0x372fae)=>{if(_0x10df80){return _0x1fe6be(_0x10df80);}if(_0x372fae){return _0x1fe6be(undefined,_0x372fae);}User_1[a1_0x478b('0x3')]['findOne']({'email':_0x1be3e9[a1_0x478b('0x1f')][a1_0x478b('0x8')]},(_0x10df80,_0x199219)=>{if(_0x10df80){return _0x1fe6be(_0x10df80);}if(_0x199219){_0x146bae[a1_0x478b('0x17')](a1_0x478b('0x18'),{'msg':a1_0x478b('0x24')});_0x1fe6be(_0x10df80);}else{const _0x6a0c38=new User_1[(a1_0x478b('0x3'))]();_0x6a0c38[a1_0x478b('0x8')]=_0x1be3e9[a1_0x478b('0x1f')][a1_0x478b('0x8')];_0x6a0c38[a1_0x478b('0x19')]=_0x1be3e9['id'];_0x6a0c38[a1_0x478b('0x1a')][a1_0x478b('0x1b')]({'kind':'facebook','accessToken':_0xca2e8d});_0x6a0c38[a1_0x478b('0x1c')]['name']=_0x1be3e9[a1_0x478b('0x13')][a1_0x478b('0x1d')]+'\x20'+_0x1be3e9['name'][a1_0x478b('0x1e')];_0x6a0c38['profile']['gender']=_0x1be3e9['_json'][a1_0x478b('0x20')];_0x6a0c38[a1_0x478b('0x1c')][a1_0x478b('0x25')]=a1_0x478b('0x26')+_0x1be3e9['id']+a1_0x478b('0x21');_0x6a0c38[a1_0x478b('0x1c')][a1_0x478b('0x27')]=_0x1be3e9[a1_0x478b('0x1f')][a1_0x478b('0x27')]?_0x1be3e9[a1_0x478b('0x1f')][a1_0x478b('0x27')][a1_0x478b('0x13')]:'';_0x6a0c38['save'](_0x10df80=>{_0x1fe6be(_0x10df80,_0x6a0c38);});}});});}}));exports['isAuthenticated']=(_0x26a634,_0x2b9f75,_0x3e257d)=>{if(_0x26a634[a1_0x478b('0x28')]()){return _0x3e257d();}_0x2b9f75[a1_0x478b('0x29')]('/login');};exports['isAuthorized']=(_0x3dcc50,_0xb11312,_0x586db3)=>{const _0x4b5573=_0x3dcc50['path'][a1_0x478b('0x2a')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x478b('0x3')][a1_0x478b('0x2b')](_0x3dcc50[a1_0x478b('0x16')][a1_0x478b('0x1a')],{'kind':_0x4b5573})){_0x586db3();}else{_0xb11312['redirect'](a1_0x478b('0x2c')+_0x4b5573);}};