var a1_0x4ea5=['push','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','__importDefault','__esModule','defineProperty','passport','passport-local','lodash','../models/User','default','Strategy','serializeUser','findById','email','findOne','toLowerCase','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','profile','givenName','gender','_json','picture','/picture?type=large','info'];(function(_0x225a66,_0x1fb307){var _0x2bb2c8=function(_0x407337){while(--_0x407337){_0x225a66['push'](_0x225a66['shift']());}};_0x2bb2c8(++_0x1fb307);}(a1_0x4ea5,0x1e1));var a1_0x3abd=function(_0x311fe5,_0x58ec4c){_0x311fe5=_0x311fe5-0x0;var _0x232036=a1_0x4ea5[_0x311fe5];return _0x232036;};'use strict';var __importDefault=this&&this[a1_0x3abd('0x0')]||function(_0x468f61){return _0x468f61&&_0x468f61[a1_0x3abd('0x1')]?_0x468f61:{'default':_0x468f61};};Object[a1_0x3abd('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x3abd('0x3')));const passport_local_1=__importDefault(require(a1_0x3abd('0x4')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x3abd('0x5')));const User_1=__importDefault(require(a1_0x3abd('0x6')));const LocalStrategy=passport_local_1[a1_0x3abd('0x7')][a1_0x3abd('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x3abd('0x7')]['Strategy'];passport_1['default'][a1_0x3abd('0x9')]((_0x41ec28,_0x19d027)=>{_0x19d027(undefined,_0x41ec28['id']);});passport_1[a1_0x3abd('0x7')]['deserializeUser']((_0x55a354,_0x552312)=>{User_1['default'][a1_0x3abd('0xa')](_0x55a354,(_0x5d0c97,_0x2ad32e)=>{_0x552312(_0x5d0c97,_0x2ad32e);});});passport_1[a1_0x3abd('0x7')]['use'](new LocalStrategy({'usernameField':a1_0x3abd('0xb')},(_0x243993,_0x5ef030,_0x1d5939)=>{User_1[a1_0x3abd('0x7')][a1_0x3abd('0xc')]({'email':_0x243993[a1_0x3abd('0xd')]()},(_0x26c869,_0x58a1ff)=>{if(_0x26c869){return _0x1d5939(_0x26c869);}if(!_0x58a1ff){return _0x1d5939(undefined,![],{'message':'Email\x20'+_0x243993+'\x20not\x20found.'});}_0x58a1ff[a1_0x3abd('0xe')](_0x5ef030,(_0x26c869,_0x2d1f51)=>{if(_0x26c869){return _0x1d5939(_0x26c869);}if(_0x2d1f51){return _0x1d5939(undefined,_0x58a1ff);}return _0x1d5939(undefined,![],{'message':a1_0x3abd('0xf')});});});}));passport_1[a1_0x3abd('0x7')]['use'](new FacebookStrategy({'clientID':process[a1_0x3abd('0x10')][a1_0x3abd('0x11')],'clientSecret':process['env'][a1_0x3abd('0x12')],'callbackURL':a1_0x3abd('0x13'),'profileFields':[a1_0x3abd('0x14'),a1_0x3abd('0xb'),'link',a1_0x3abd('0x15'),a1_0x3abd('0x16')],'passReqToCallback':!![]},(_0x448680,_0x279382,_0x3686ba,_0x92d7,_0x1c2a90)=>{if(_0x448680[a1_0x3abd('0x17')]){User_1[a1_0x3abd('0x7')]['findOne']({'facebook':_0x92d7['id']},(_0x165489,_0x425e26)=>{if(_0x165489){return _0x1c2a90(_0x165489);}if(_0x425e26){_0x448680[a1_0x3abd('0x18')](a1_0x3abd('0x19'),{'msg':a1_0x3abd('0x1a')});_0x1c2a90(_0x165489);}else{User_1['default']['findById'](_0x448680[a1_0x3abd('0x17')]['id'],(_0x165489,_0x3efa9b)=>{if(_0x165489){return _0x1c2a90(_0x165489);}_0x3efa9b[a1_0x3abd('0x1b')]=_0x92d7['id'];_0x3efa9b[a1_0x3abd('0x1c')]['push']({'kind':a1_0x3abd('0x1b'),'accessToken':_0x279382});_0x3efa9b[a1_0x3abd('0x1d')][a1_0x3abd('0x14')]=_0x3efa9b['profile'][a1_0x3abd('0x14')]||_0x92d7[a1_0x3abd('0x14')][a1_0x3abd('0x1e')]+'\x20'+_0x92d7['name']['familyName'];_0x3efa9b[a1_0x3abd('0x1d')][a1_0x3abd('0x1f')]=_0x3efa9b['profile'][a1_0x3abd('0x1f')]||_0x92d7[a1_0x3abd('0x20')]['gender'];_0x3efa9b['profile']['picture']=_0x3efa9b[a1_0x3abd('0x1d')][a1_0x3abd('0x21')]||'https://graph.facebook.com/'+_0x92d7['id']+a1_0x3abd('0x22');_0x3efa9b['save'](_0x165489=>{_0x448680[a1_0x3abd('0x18')](a1_0x3abd('0x23'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x1c2a90(_0x165489,_0x3efa9b);});});}});}else{User_1[a1_0x3abd('0x7')][a1_0x3abd('0xc')]({'facebook':_0x92d7['id']},(_0x2d03cc,_0x58477c)=>{if(_0x2d03cc){return _0x1c2a90(_0x2d03cc);}if(_0x58477c){return _0x1c2a90(undefined,_0x58477c);}User_1['default'][a1_0x3abd('0xc')]({'email':_0x92d7[a1_0x3abd('0x20')][a1_0x3abd('0xb')]},(_0x2d03cc,_0x4e04f7)=>{if(_0x2d03cc){return _0x1c2a90(_0x2d03cc);}if(_0x4e04f7){_0x448680['flash'](a1_0x3abd('0x19'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x1c2a90(_0x2d03cc);}else{const _0x22564d=new User_1['default']();_0x22564d[a1_0x3abd('0xb')]=_0x92d7[a1_0x3abd('0x20')][a1_0x3abd('0xb')];_0x22564d[a1_0x3abd('0x1b')]=_0x92d7['id'];_0x22564d[a1_0x3abd('0x1c')][a1_0x3abd('0x24')]({'kind':a1_0x3abd('0x1b'),'accessToken':_0x279382});_0x22564d[a1_0x3abd('0x1d')][a1_0x3abd('0x14')]=_0x92d7[a1_0x3abd('0x14')]['givenName']+'\x20'+_0x92d7['name'][a1_0x3abd('0x25')];_0x22564d['profile']['gender']=_0x92d7[a1_0x3abd('0x20')][a1_0x3abd('0x1f')];_0x22564d[a1_0x3abd('0x1d')][a1_0x3abd('0x21')]='https://graph.facebook.com/'+_0x92d7['id']+'/picture?type=large';_0x22564d[a1_0x3abd('0x1d')][a1_0x3abd('0x26')]=_0x92d7[a1_0x3abd('0x20')][a1_0x3abd('0x26')]?_0x92d7[a1_0x3abd('0x20')]['location'][a1_0x3abd('0x14')]:'';_0x22564d['save'](_0x2d03cc=>{_0x1c2a90(_0x2d03cc,_0x22564d);});}});});}}));exports[a1_0x3abd('0x27')]=(_0x54b6ba,_0x14766d,_0x5adcef)=>{if(_0x54b6ba[a1_0x3abd('0x27')]()){return _0x5adcef();}_0x14766d[a1_0x3abd('0x28')](a1_0x3abd('0x29'));};exports[a1_0x3abd('0x2a')]=(_0x366a6a,_0x5cb233,_0x155e8c)=>{const _0x216ffb=_0x366a6a[a1_0x3abd('0x2b')][a1_0x3abd('0x2c')]('/')[a1_0x3abd('0x2d')](-0x1)[0x0];if(lodash_1['default'][a1_0x3abd('0x2e')](_0x366a6a['user'][a1_0x3abd('0x1c')],{'kind':_0x216ffb})){_0x155e8c();}else{_0x5cb233[a1_0x3abd('0x28')]('/auth/'+_0x216ffb);}};