var a1_0x2878=['use','env','FACEBOOK_ID','/auth/facebook/callback','name','timezone','errors','findById','user','facebook','familyName','profile','gender','_json','picture','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','/picture?type=large','location','isAuthenticated','redirect','/login','isAuthorized','path','find','tokens','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','email','findOne','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.'];(function(_0x30fe4e,_0x587004){var _0x1f3771=function(_0x3baba8){while(--_0x3baba8){_0x30fe4e['push'](_0x30fe4e['shift']());}};_0x1f3771(++_0x587004);}(a1_0x2878,0x1c6));var a1_0x1758=function(_0x424ee1,_0xaf4029){_0x424ee1=_0x424ee1-0x0;var _0x1a252e=a1_0x2878[_0x424ee1];return _0x1a252e;};'use strict';var __importDefault=this&&this[a1_0x1758('0x0')]||function(_0x45ca5c){return _0x45ca5c&&_0x45ca5c['__esModule']?_0x45ca5c:{'default':_0x45ca5c};};Object[a1_0x1758('0x1')](exports,a1_0x1758('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x1758('0x3')));const passport_local_1=__importDefault(require(a1_0x1758('0x4')));const passport_facebook_1=__importDefault(require(a1_0x1758('0x5')));const lodash_1=__importDefault(require(a1_0x1758('0x6')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x1758('0x7')][a1_0x1758('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x1758('0x7')][a1_0x1758('0x8')];passport_1['default'][a1_0x1758('0x9')]((_0xfae7d3,_0x5d7f76)=>{_0x5d7f76(undefined,_0xfae7d3['id']);});passport_1[a1_0x1758('0x7')][a1_0x1758('0xa')]((_0x28865f,_0x23f6a3)=>{User_1[a1_0x1758('0x7')]['findById'](_0x28865f,(_0x462974,_0x34cd05)=>{_0x23f6a3(_0x462974,_0x34cd05);});});passport_1[a1_0x1758('0x7')]['use'](new LocalStrategy({'usernameField':a1_0x1758('0xb')},(_0x2a67d3,_0x1831ae,_0x489f23)=>{User_1[a1_0x1758('0x7')][a1_0x1758('0xc')]({'email':_0x2a67d3['toLowerCase']()},(_0x47ab4a,_0x1528ab)=>{if(_0x47ab4a){return _0x489f23(_0x47ab4a);}if(!_0x1528ab){return _0x489f23(undefined,![],{'message':a1_0x1758('0xd')+_0x2a67d3+'\x20not\x20found.'});}_0x1528ab[a1_0x1758('0xe')](_0x1831ae,(_0x47ab4a,_0xd420eb)=>{if(_0x47ab4a){return _0x489f23(_0x47ab4a);}if(_0xd420eb){return _0x489f23(undefined,_0x1528ab);}return _0x489f23(undefined,![],{'message':a1_0x1758('0xf')});});});}));passport_1['default'][a1_0x1758('0x10')](new FacebookStrategy({'clientID':process[a1_0x1758('0x11')][a1_0x1758('0x12')],'clientSecret':process[a1_0x1758('0x11')]['FACEBOOK_SECRET'],'callbackURL':a1_0x1758('0x13'),'profileFields':[a1_0x1758('0x14'),'email','link','locale',a1_0x1758('0x15')],'passReqToCallback':!![]},(_0x2efd84,_0x4996a0,_0xd27863,_0x2fe722,_0x50c5ca)=>{if(_0x2efd84['user']){User_1[a1_0x1758('0x7')][a1_0x1758('0xc')]({'facebook':_0x2fe722['id']},(_0x31b99d,_0xeeed00)=>{if(_0x31b99d){return _0x50c5ca(_0x31b99d);}if(_0xeeed00){_0x2efd84['flash'](a1_0x1758('0x16'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x50c5ca(_0x31b99d);}else{User_1[a1_0x1758('0x7')][a1_0x1758('0x17')](_0x2efd84[a1_0x1758('0x18')]['id'],(_0x31b99d,_0x7c1c26)=>{if(_0x31b99d){return _0x50c5ca(_0x31b99d);}_0x7c1c26['facebook']=_0x2fe722['id'];_0x7c1c26['tokens']['push']({'kind':a1_0x1758('0x19'),'accessToken':_0x4996a0});_0x7c1c26['profile']['name']=_0x7c1c26['profile'][a1_0x1758('0x14')]||_0x2fe722[a1_0x1758('0x14')]['givenName']+'\x20'+_0x2fe722[a1_0x1758('0x14')][a1_0x1758('0x1a')];_0x7c1c26[a1_0x1758('0x1b')]['gender']=_0x7c1c26['profile'][a1_0x1758('0x1c')]||_0x2fe722[a1_0x1758('0x1d')][a1_0x1758('0x1c')];_0x7c1c26[a1_0x1758('0x1b')][a1_0x1758('0x1e')]=_0x7c1c26[a1_0x1758('0x1b')][a1_0x1758('0x1e')]||'https://graph.facebook.com/'+_0x2fe722['id']+'/picture?type=large';_0x7c1c26[a1_0x1758('0x1f')](_0x31b99d=>{_0x2efd84[a1_0x1758('0x20')](a1_0x1758('0x21'),{'msg':a1_0x1758('0x22')});_0x50c5ca(_0x31b99d,_0x7c1c26);});});}});}else{User_1[a1_0x1758('0x7')][a1_0x1758('0xc')]({'facebook':_0x2fe722['id']},(_0x18f5f6,_0x1987ad)=>{if(_0x18f5f6){return _0x50c5ca(_0x18f5f6);}if(_0x1987ad){return _0x50c5ca(undefined,_0x1987ad);}User_1['default']['findOne']({'email':_0x2fe722[a1_0x1758('0x1d')][a1_0x1758('0xb')]},(_0x18f5f6,_0x262814)=>{if(_0x18f5f6){return _0x50c5ca(_0x18f5f6);}if(_0x262814){_0x2efd84[a1_0x1758('0x20')]('errors',{'msg':a1_0x1758('0x23')});_0x50c5ca(_0x18f5f6);}else{const _0x1f79f6=new User_1[(a1_0x1758('0x7'))]();_0x1f79f6[a1_0x1758('0xb')]=_0x2fe722[a1_0x1758('0x1d')][a1_0x1758('0xb')];_0x1f79f6[a1_0x1758('0x19')]=_0x2fe722['id'];_0x1f79f6['tokens']['push']({'kind':'facebook','accessToken':_0x4996a0});_0x1f79f6[a1_0x1758('0x1b')][a1_0x1758('0x14')]=_0x2fe722[a1_0x1758('0x14')][a1_0x1758('0x24')]+'\x20'+_0x2fe722[a1_0x1758('0x14')][a1_0x1758('0x1a')];_0x1f79f6[a1_0x1758('0x1b')][a1_0x1758('0x1c')]=_0x2fe722['_json'][a1_0x1758('0x1c')];_0x1f79f6[a1_0x1758('0x1b')]['picture']='https://graph.facebook.com/'+_0x2fe722['id']+a1_0x1758('0x25');_0x1f79f6[a1_0x1758('0x1b')][a1_0x1758('0x26')]=_0x2fe722[a1_0x1758('0x1d')][a1_0x1758('0x26')]?_0x2fe722[a1_0x1758('0x1d')]['location']['name']:'';_0x1f79f6[a1_0x1758('0x1f')](_0x18f5f6=>{_0x50c5ca(_0x18f5f6,_0x1f79f6);});}});});}}));exports[a1_0x1758('0x27')]=(_0x3cec0a,_0x43c44f,_0x1f99d9)=>{if(_0x3cec0a[a1_0x1758('0x27')]()){return _0x1f99d9();}_0x43c44f[a1_0x1758('0x28')](a1_0x1758('0x29'));};exports[a1_0x1758('0x2a')]=(_0x202975,_0x286411,_0x5ec384)=>{const _0x55dc62=_0x202975[a1_0x1758('0x2b')]['split']('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x1758('0x7')][a1_0x1758('0x2c')](_0x202975['user'][a1_0x1758('0x2d')],{'kind':_0x55dc62})){_0x5ec384();}else{_0x286411['redirect'](a1_0x1758('0x2e')+_0x55dc62);}};