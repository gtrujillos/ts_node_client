var a1_0x5c34=['link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','tokens','push','facebook','profile','givenName','gender','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','_json','familyName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','__esModule','passport','passport-local','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name'];(function(_0x2bbf9a,_0x147b81){var _0x345f21=function(_0xd9db8d){while(--_0xd9db8d){_0x2bbf9a['push'](_0x2bbf9a['shift']());}};_0x345f21(++_0x147b81);}(a1_0x5c34,0x1d7));var a1_0x19be=function(_0x2619f6,_0x520f2a){_0x2619f6=_0x2619f6-0x0;var _0x1466f4=a1_0x5c34[_0x2619f6];return _0x1466f4;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5a04c1){return _0x5a04c1&&_0x5a04c1[a1_0x19be('0x0')]?_0x5a04c1:{'default':_0x5a04c1};};Object['defineProperty'](exports,a1_0x19be('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x19be('0x1')));const passport_local_1=__importDefault(require(a1_0x19be('0x2')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x19be('0x3')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x19be('0x3')][a1_0x19be('0x4')];passport_1[a1_0x19be('0x3')][a1_0x19be('0x5')]((_0x528346,_0x29ed03)=>{_0x29ed03(undefined,_0x528346['id']);});passport_1[a1_0x19be('0x3')][a1_0x19be('0x6')]((_0x37f460,_0x16d354)=>{User_1['default'][a1_0x19be('0x7')](_0x37f460,(_0x11ff0e,_0xaa51d4)=>{_0x16d354(_0x11ff0e,_0xaa51d4);});});passport_1[a1_0x19be('0x3')][a1_0x19be('0x8')](new LocalStrategy({'usernameField':a1_0x19be('0x9')},(_0x40057b,_0x1c3585,_0x58b555)=>{User_1[a1_0x19be('0x3')][a1_0x19be('0xa')]({'email':_0x40057b[a1_0x19be('0xb')]()},(_0xe60dea,_0x430aed)=>{if(_0xe60dea){return _0x58b555(_0xe60dea);}if(!_0x430aed){return _0x58b555(undefined,![],{'message':a1_0x19be('0xc')+_0x40057b+'\x20not\x20found.'});}_0x430aed[a1_0x19be('0xd')](_0x1c3585,(_0xe60dea,_0x592270)=>{if(_0xe60dea){return _0x58b555(_0xe60dea);}if(_0x592270){return _0x58b555(undefined,_0x430aed);}return _0x58b555(undefined,![],{'message':a1_0x19be('0xe')});});});}));passport_1[a1_0x19be('0x3')][a1_0x19be('0x8')](new FacebookStrategy({'clientID':process[a1_0x19be('0xf')][a1_0x19be('0x10')],'clientSecret':process['env'][a1_0x19be('0x11')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x19be('0x12'),'email',a1_0x19be('0x13'),a1_0x19be('0x14'),a1_0x19be('0x15')],'passReqToCallback':!![]},(_0x57e503,_0xbc7495,_0x334055,_0x5730c2,_0x4d4284)=>{if(_0x57e503['user']){User_1[a1_0x19be('0x3')][a1_0x19be('0xa')]({'facebook':_0x5730c2['id']},(_0x50531f,_0x21b931)=>{if(_0x50531f){return _0x4d4284(_0x50531f);}if(_0x21b931){_0x57e503[a1_0x19be('0x16')](a1_0x19be('0x17'),{'msg':a1_0x19be('0x18')});_0x4d4284(_0x50531f);}else{User_1['default'][a1_0x19be('0x7')](_0x57e503[a1_0x19be('0x19')]['id'],(_0x50531f,_0xd8374c)=>{if(_0x50531f){return _0x4d4284(_0x50531f);}_0xd8374c['facebook']=_0x5730c2['id'];_0xd8374c[a1_0x19be('0x1a')][a1_0x19be('0x1b')]({'kind':a1_0x19be('0x1c'),'accessToken':_0xbc7495});_0xd8374c[a1_0x19be('0x1d')][a1_0x19be('0x12')]=_0xd8374c['profile'][a1_0x19be('0x12')]||_0x5730c2[a1_0x19be('0x12')][a1_0x19be('0x1e')]+'\x20'+_0x5730c2[a1_0x19be('0x12')]['familyName'];_0xd8374c[a1_0x19be('0x1d')]['gender']=_0xd8374c['profile'][a1_0x19be('0x1f')]||_0x5730c2['_json'][a1_0x19be('0x1f')];_0xd8374c['profile']['picture']=_0xd8374c['profile'][a1_0x19be('0x20')]||'https://graph.facebook.com/'+_0x5730c2['id']+a1_0x19be('0x21');_0xd8374c[a1_0x19be('0x22')](_0x50531f=>{_0x57e503[a1_0x19be('0x16')](a1_0x19be('0x23'),{'msg':a1_0x19be('0x24')});_0x4d4284(_0x50531f,_0xd8374c);});});}});}else{User_1['default'][a1_0x19be('0xa')]({'facebook':_0x5730c2['id']},(_0x1de64c,_0x1d575e)=>{if(_0x1de64c){return _0x4d4284(_0x1de64c);}if(_0x1d575e){return _0x4d4284(undefined,_0x1d575e);}User_1[a1_0x19be('0x3')][a1_0x19be('0xa')]({'email':_0x5730c2[a1_0x19be('0x25')][a1_0x19be('0x9')]},(_0x1de64c,_0x87aa81)=>{if(_0x1de64c){return _0x4d4284(_0x1de64c);}if(_0x87aa81){_0x57e503[a1_0x19be('0x16')](a1_0x19be('0x17'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x4d4284(_0x1de64c);}else{const _0x3a9564=new User_1[(a1_0x19be('0x3'))]();_0x3a9564[a1_0x19be('0x9')]=_0x5730c2[a1_0x19be('0x25')]['email'];_0x3a9564[a1_0x19be('0x1c')]=_0x5730c2['id'];_0x3a9564['tokens'][a1_0x19be('0x1b')]({'kind':a1_0x19be('0x1c'),'accessToken':_0xbc7495});_0x3a9564[a1_0x19be('0x1d')][a1_0x19be('0x12')]=_0x5730c2[a1_0x19be('0x12')][a1_0x19be('0x1e')]+'\x20'+_0x5730c2['name'][a1_0x19be('0x26')];_0x3a9564[a1_0x19be('0x1d')][a1_0x19be('0x1f')]=_0x5730c2[a1_0x19be('0x25')][a1_0x19be('0x1f')];_0x3a9564[a1_0x19be('0x1d')][a1_0x19be('0x20')]=a1_0x19be('0x27')+_0x5730c2['id']+a1_0x19be('0x21');_0x3a9564[a1_0x19be('0x1d')][a1_0x19be('0x28')]=_0x5730c2[a1_0x19be('0x25')][a1_0x19be('0x28')]?_0x5730c2[a1_0x19be('0x25')][a1_0x19be('0x28')][a1_0x19be('0x12')]:'';_0x3a9564[a1_0x19be('0x22')](_0x1de64c=>{_0x4d4284(_0x1de64c,_0x3a9564);});}});});}}));exports['isAuthenticated']=(_0x3af44c,_0xe53ef3,_0x22f3b5)=>{if(_0x3af44c[a1_0x19be('0x29')]()){return _0x22f3b5();}_0xe53ef3[a1_0x19be('0x2a')](a1_0x19be('0x2b'));};exports[a1_0x19be('0x2c')]=(_0x4377e0,_0x37f63b,_0x15e369)=>{const _0x440190=_0x4377e0[a1_0x19be('0x2d')][a1_0x19be('0x2e')]('/')[a1_0x19be('0x2f')](-0x1)[0x0];if(lodash_1['default'][a1_0x19be('0x30')](_0x4377e0['user'][a1_0x19be('0x1a')],{'kind':_0x440190})){_0x15e369();}else{_0x37f63b['redirect']('/auth/'+_0x440190);}};