var a1_0x3a2e=['Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','split','slice','find','user','/auth/','__esModule','defineProperty','passport','passport-local','../models/User','default','Strategy','serializeUser','deserializeUser','findById','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','locale','findOne','flash','errors','facebook','tokens','push','profile','familyName','gender','_json','picture','/picture?type=large','save','info'];(function(_0x50b579,_0x1a4950){var _0x2267d5=function(_0x592d60){while(--_0x592d60){_0x50b579['push'](_0x50b579['shift']());}};_0x2267d5(++_0x1a4950);}(a1_0x3a2e,0x19e));var a1_0x5ccc=function(_0x1b637c,_0x488454){_0x1b637c=_0x1b637c-0x0;var _0x31483d=a1_0x3a2e[_0x1b637c];return _0x31483d;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3a8c83){return _0x3a8c83&&_0x3a8c83[a1_0x5ccc('0x0')]?_0x3a8c83:{'default':_0x3a8c83};};Object[a1_0x5ccc('0x1')](exports,a1_0x5ccc('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5ccc('0x2')));const passport_local_1=__importDefault(require(a1_0x5ccc('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x5ccc('0x4')));const LocalStrategy=passport_local_1[a1_0x5ccc('0x5')][a1_0x5ccc('0x6')];const FacebookStrategy=passport_facebook_1['default'][a1_0x5ccc('0x6')];passport_1[a1_0x5ccc('0x5')][a1_0x5ccc('0x7')]((_0x1539e9,_0x1afcef)=>{_0x1afcef(undefined,_0x1539e9['id']);});passport_1['default'][a1_0x5ccc('0x8')]((_0x57847f,_0x5e90fb)=>{User_1[a1_0x5ccc('0x5')][a1_0x5ccc('0x9')](_0x57847f,(_0xaa0e0e,_0xf04b27)=>{_0x5e90fb(_0xaa0e0e,_0xf04b27);});});passport_1[a1_0x5ccc('0x5')]['use'](new LocalStrategy({'usernameField':'email'},(_0x32ad97,_0x5a8484,_0x2f1eef)=>{User_1[a1_0x5ccc('0x5')]['findOne']({'email':_0x32ad97['toLowerCase']()},(_0x1da137,_0x48692f)=>{if(_0x1da137){return _0x2f1eef(_0x1da137);}if(!_0x48692f){return _0x2f1eef(undefined,![],{'message':a1_0x5ccc('0xa')+_0x32ad97+a1_0x5ccc('0xb')});}_0x48692f['comparePassword'](_0x5a8484,(_0x1da137,_0x287dd5)=>{if(_0x1da137){return _0x2f1eef(_0x1da137);}if(_0x287dd5){return _0x2f1eef(undefined,_0x48692f);}return _0x2f1eef(undefined,![],{'message':a1_0x5ccc('0xc')});});});}));passport_1[a1_0x5ccc('0x5')][a1_0x5ccc('0xd')](new FacebookStrategy({'clientID':process[a1_0x5ccc('0xe')][a1_0x5ccc('0xf')],'clientSecret':process[a1_0x5ccc('0xe')][a1_0x5ccc('0x10')],'callbackURL':a1_0x5ccc('0x11'),'profileFields':[a1_0x5ccc('0x12'),a1_0x5ccc('0x13'),a1_0x5ccc('0x14'),a1_0x5ccc('0x15'),'timezone'],'passReqToCallback':!![]},(_0x2838ca,_0x362c89,_0x2a61b8,_0x35f2b7,_0x1863b6)=>{if(_0x2838ca['user']){User_1[a1_0x5ccc('0x5')][a1_0x5ccc('0x16')]({'facebook':_0x35f2b7['id']},(_0x5d5d4d,_0x59578c)=>{if(_0x5d5d4d){return _0x1863b6(_0x5d5d4d);}if(_0x59578c){_0x2838ca[a1_0x5ccc('0x17')](a1_0x5ccc('0x18'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x1863b6(_0x5d5d4d);}else{User_1['default'][a1_0x5ccc('0x9')](_0x2838ca['user']['id'],(_0x5d5d4d,_0x3552fa)=>{if(_0x5d5d4d){return _0x1863b6(_0x5d5d4d);}_0x3552fa[a1_0x5ccc('0x19')]=_0x35f2b7['id'];_0x3552fa[a1_0x5ccc('0x1a')][a1_0x5ccc('0x1b')]({'kind':a1_0x5ccc('0x19'),'accessToken':_0x362c89});_0x3552fa[a1_0x5ccc('0x1c')][a1_0x5ccc('0x12')]=_0x3552fa[a1_0x5ccc('0x1c')][a1_0x5ccc('0x12')]||_0x35f2b7[a1_0x5ccc('0x12')]['givenName']+'\x20'+_0x35f2b7[a1_0x5ccc('0x12')][a1_0x5ccc('0x1d')];_0x3552fa['profile'][a1_0x5ccc('0x1e')]=_0x3552fa['profile'][a1_0x5ccc('0x1e')]||_0x35f2b7[a1_0x5ccc('0x1f')][a1_0x5ccc('0x1e')];_0x3552fa[a1_0x5ccc('0x1c')]['picture']=_0x3552fa[a1_0x5ccc('0x1c')][a1_0x5ccc('0x20')]||'https://graph.facebook.com/'+_0x35f2b7['id']+a1_0x5ccc('0x21');_0x3552fa[a1_0x5ccc('0x22')](_0x5d5d4d=>{_0x2838ca[a1_0x5ccc('0x17')](a1_0x5ccc('0x23'),{'msg':a1_0x5ccc('0x24')});_0x1863b6(_0x5d5d4d,_0x3552fa);});});}});}else{User_1['default'][a1_0x5ccc('0x16')]({'facebook':_0x35f2b7['id']},(_0x50ad4f,_0x32cf84)=>{if(_0x50ad4f){return _0x1863b6(_0x50ad4f);}if(_0x32cf84){return _0x1863b6(undefined,_0x32cf84);}User_1['default'][a1_0x5ccc('0x16')]({'email':_0x35f2b7[a1_0x5ccc('0x1f')][a1_0x5ccc('0x13')]},(_0x50ad4f,_0x2016d9)=>{if(_0x50ad4f){return _0x1863b6(_0x50ad4f);}if(_0x2016d9){_0x2838ca['flash']('errors',{'msg':a1_0x5ccc('0x25')});_0x1863b6(_0x50ad4f);}else{const _0xc0c638=new User_1[(a1_0x5ccc('0x5'))]();_0xc0c638[a1_0x5ccc('0x13')]=_0x35f2b7[a1_0x5ccc('0x1f')][a1_0x5ccc('0x13')];_0xc0c638[a1_0x5ccc('0x19')]=_0x35f2b7['id'];_0xc0c638[a1_0x5ccc('0x1a')][a1_0x5ccc('0x1b')]({'kind':a1_0x5ccc('0x19'),'accessToken':_0x362c89});_0xc0c638['profile'][a1_0x5ccc('0x12')]=_0x35f2b7[a1_0x5ccc('0x12')][a1_0x5ccc('0x26')]+'\x20'+_0x35f2b7[a1_0x5ccc('0x12')][a1_0x5ccc('0x1d')];_0xc0c638[a1_0x5ccc('0x1c')]['gender']=_0x35f2b7['_json'][a1_0x5ccc('0x1e')];_0xc0c638[a1_0x5ccc('0x1c')][a1_0x5ccc('0x20')]=a1_0x5ccc('0x27')+_0x35f2b7['id']+a1_0x5ccc('0x21');_0xc0c638[a1_0x5ccc('0x1c')][a1_0x5ccc('0x28')]=_0x35f2b7[a1_0x5ccc('0x1f')]['location']?_0x35f2b7[a1_0x5ccc('0x1f')][a1_0x5ccc('0x28')]['name']:'';_0xc0c638[a1_0x5ccc('0x22')](_0x50ad4f=>{_0x1863b6(_0x50ad4f,_0xc0c638);});}});});}}));exports[a1_0x5ccc('0x29')]=(_0x123548,_0x1574c6,_0x3dd8f4)=>{if(_0x123548[a1_0x5ccc('0x29')]()){return _0x3dd8f4();}_0x1574c6[a1_0x5ccc('0x2a')](a1_0x5ccc('0x2b'));};exports[a1_0x5ccc('0x2c')]=(_0x4aa6b8,_0x4bdadc,_0x13abe4)=>{const _0x393af2=_0x4aa6b8['path'][a1_0x5ccc('0x2d')]('/')[a1_0x5ccc('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x5ccc('0x5')][a1_0x5ccc('0x2f')](_0x4aa6b8[a1_0x5ccc('0x30')]['tokens'],{'kind':_0x393af2})){_0x13abe4();}else{_0x4bdadc[a1_0x5ccc('0x2a')](a1_0x5ccc('0x31')+_0x393af2);}};