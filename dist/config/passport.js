var a1_0x55f7=['isAuthenticated','redirect','/login','isAuthorized','split','slice','find','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','link','timezone','user','flash','errors','push','profile','name','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','tokens','location'];(function(_0x59db44,_0x106a3e){var _0x247f0b=function(_0x5de653){while(--_0x5de653){_0x59db44['push'](_0x59db44['shift']());}};_0x247f0b(++_0x106a3e);}(a1_0x55f7,0x1f1));var a1_0xdfe0=function(_0x3a2d7c,_0x5ef8d9){_0x3a2d7c=_0x3a2d7c-0x0;var _0x2c2548=a1_0x55f7[_0x3a2d7c];return _0x2c2548;};'use strict';var __importDefault=this&&this[a1_0xdfe0('0x0')]||function(_0x6dd374){return _0x6dd374&&_0x6dd374['__esModule']?_0x6dd374:{'default':_0x6dd374};};Object[a1_0xdfe0('0x1')](exports,a1_0xdfe0('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0xdfe0('0x3')));const passport_local_1=__importDefault(require(a1_0xdfe0('0x4')));const passport_facebook_1=__importDefault(require(a1_0xdfe0('0x5')));const lodash_1=__importDefault(require(a1_0xdfe0('0x6')));const User_1=__importDefault(require(a1_0xdfe0('0x7')));const LocalStrategy=passport_local_1['default'][a1_0xdfe0('0x8')];const FacebookStrategy=passport_facebook_1[a1_0xdfe0('0x9')]['Strategy'];passport_1[a1_0xdfe0('0x9')][a1_0xdfe0('0xa')]((_0x203832,_0x2bdfa5)=>{_0x2bdfa5(undefined,_0x203832['id']);});passport_1[a1_0xdfe0('0x9')][a1_0xdfe0('0xb')]((_0x2c323b,_0x1f8ddc)=>{User_1[a1_0xdfe0('0x9')][a1_0xdfe0('0xc')](_0x2c323b,(_0x23ed62,_0x5cbb9d)=>{_0x1f8ddc(_0x23ed62,_0x5cbb9d);});});passport_1['default'][a1_0xdfe0('0xd')](new LocalStrategy({'usernameField':a1_0xdfe0('0xe')},(_0x1c5f18,_0x2f7aaf,_0x266d4d)=>{User_1['default'][a1_0xdfe0('0xf')]({'email':_0x1c5f18['toLowerCase']()},(_0x18b025,_0x51c2ea)=>{if(_0x18b025){return _0x266d4d(_0x18b025);}if(!_0x51c2ea){return _0x266d4d(undefined,![],{'message':a1_0xdfe0('0x10')+_0x1c5f18+a1_0xdfe0('0x11')});}_0x51c2ea[a1_0xdfe0('0x12')](_0x2f7aaf,(_0x18b025,_0x30b2cc)=>{if(_0x18b025){return _0x266d4d(_0x18b025);}if(_0x30b2cc){return _0x266d4d(undefined,_0x51c2ea);}return _0x266d4d(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0xdfe0('0x9')][a1_0xdfe0('0xd')](new FacebookStrategy({'clientID':process['env'][a1_0xdfe0('0x13')],'clientSecret':process[a1_0xdfe0('0x14')][a1_0xdfe0('0x15')],'callbackURL':a1_0xdfe0('0x16'),'profileFields':['name',a1_0xdfe0('0xe'),a1_0xdfe0('0x17'),'locale',a1_0xdfe0('0x18')],'passReqToCallback':!![]},(_0x3e996b,_0x2140c9,_0x45833e,_0x4c55d2,_0x599add)=>{if(_0x3e996b[a1_0xdfe0('0x19')]){User_1[a1_0xdfe0('0x9')]['findOne']({'facebook':_0x4c55d2['id']},(_0x5a2919,_0x5437a4)=>{if(_0x5a2919){return _0x599add(_0x5a2919);}if(_0x5437a4){_0x3e996b[a1_0xdfe0('0x1a')](a1_0xdfe0('0x1b'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x599add(_0x5a2919);}else{User_1[a1_0xdfe0('0x9')]['findById'](_0x3e996b[a1_0xdfe0('0x19')]['id'],(_0x5a2919,_0x61acdb)=>{if(_0x5a2919){return _0x599add(_0x5a2919);}_0x61acdb['facebook']=_0x4c55d2['id'];_0x61acdb['tokens'][a1_0xdfe0('0x1c')]({'kind':'facebook','accessToken':_0x2140c9});_0x61acdb[a1_0xdfe0('0x1d')][a1_0xdfe0('0x1e')]=_0x61acdb['profile']['name']||_0x4c55d2[a1_0xdfe0('0x1e')][a1_0xdfe0('0x1f')]+'\x20'+_0x4c55d2[a1_0xdfe0('0x1e')]['familyName'];_0x61acdb[a1_0xdfe0('0x1d')][a1_0xdfe0('0x20')]=_0x61acdb[a1_0xdfe0('0x1d')][a1_0xdfe0('0x20')]||_0x4c55d2[a1_0xdfe0('0x21')][a1_0xdfe0('0x20')];_0x61acdb[a1_0xdfe0('0x1d')][a1_0xdfe0('0x22')]=_0x61acdb[a1_0xdfe0('0x1d')][a1_0xdfe0('0x22')]||a1_0xdfe0('0x23')+_0x4c55d2['id']+a1_0xdfe0('0x24');_0x61acdb['save'](_0x5a2919=>{_0x3e996b['flash'](a1_0xdfe0('0x25'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x599add(_0x5a2919,_0x61acdb);});});}});}else{User_1['default']['findOne']({'facebook':_0x4c55d2['id']},(_0x469463,_0x5cdcc3)=>{if(_0x469463){return _0x599add(_0x469463);}if(_0x5cdcc3){return _0x599add(undefined,_0x5cdcc3);}User_1[a1_0xdfe0('0x9')][a1_0xdfe0('0xf')]({'email':_0x4c55d2['_json'][a1_0xdfe0('0xe')]},(_0x469463,_0x10dd6a)=>{if(_0x469463){return _0x599add(_0x469463);}if(_0x10dd6a){_0x3e996b[a1_0xdfe0('0x1a')](a1_0xdfe0('0x1b'),{'msg':a1_0xdfe0('0x26')});_0x599add(_0x469463);}else{const _0x2fe284=new User_1[(a1_0xdfe0('0x9'))]();_0x2fe284[a1_0xdfe0('0xe')]=_0x4c55d2[a1_0xdfe0('0x21')][a1_0xdfe0('0xe')];_0x2fe284[a1_0xdfe0('0x27')]=_0x4c55d2['id'];_0x2fe284[a1_0xdfe0('0x28')][a1_0xdfe0('0x1c')]({'kind':a1_0xdfe0('0x27'),'accessToken':_0x2140c9});_0x2fe284['profile'][a1_0xdfe0('0x1e')]=_0x4c55d2['name'][a1_0xdfe0('0x1f')]+'\x20'+_0x4c55d2[a1_0xdfe0('0x1e')]['familyName'];_0x2fe284[a1_0xdfe0('0x1d')][a1_0xdfe0('0x20')]=_0x4c55d2['_json'][a1_0xdfe0('0x20')];_0x2fe284[a1_0xdfe0('0x1d')]['picture']=a1_0xdfe0('0x23')+_0x4c55d2['id']+'/picture?type=large';_0x2fe284[a1_0xdfe0('0x1d')][a1_0xdfe0('0x29')]=_0x4c55d2['_json']['location']?_0x4c55d2[a1_0xdfe0('0x21')]['location'][a1_0xdfe0('0x1e')]:'';_0x2fe284['save'](_0x469463=>{_0x599add(_0x469463,_0x2fe284);});}});});}}));exports[a1_0xdfe0('0x2a')]=(_0x24139c,_0x5401c9,_0x1365b0)=>{if(_0x24139c['isAuthenticated']()){return _0x1365b0();}_0x5401c9[a1_0xdfe0('0x2b')](a1_0xdfe0('0x2c'));};exports[a1_0xdfe0('0x2d')]=(_0x5f0411,_0xbd1ee1,_0x2ee51a)=>{const _0x5eb699=_0x5f0411['path'][a1_0xdfe0('0x2e')]('/')[a1_0xdfe0('0x2f')](-0x1)[0x0];if(lodash_1[a1_0xdfe0('0x9')][a1_0xdfe0('0x30')](_0x5f0411[a1_0xdfe0('0x19')][a1_0xdfe0('0x28')],{'kind':_0x5eb699})){_0x2ee51a();}else{_0xbd1ee1[a1_0xdfe0('0x2b')]('/auth/'+_0x5eb699);}};