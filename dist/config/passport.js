var a1_0x1c3b=['/auth/facebook/callback','name','link','locale','timezone','user','facebook','tokens','push','profile','givenName','familyName','gender','_json','picture','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','errors','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-facebook','../models/User','default','Strategy','serializeUser','findById','use','email','findOne','toLowerCase','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET'];(function(_0x3ca7fc,_0x5c8de8){var _0x1a9152=function(_0xd2693b){while(--_0xd2693b){_0x3ca7fc['push'](_0x3ca7fc['shift']());}};_0x1a9152(++_0x5c8de8);}(a1_0x1c3b,0x1a8));var a1_0x2b57=function(_0x1df11b,_0x185f6b){_0x1df11b=_0x1df11b-0x0;var _0x48b6ca=a1_0x1c3b[_0x1df11b];return _0x48b6ca;};'use strict';var __importDefault=this&&this[a1_0x2b57('0x0')]||function(_0x4bb39f){return _0x4bb39f&&_0x4bb39f[a1_0x2b57('0x1')]?_0x4bb39f:{'default':_0x4bb39f};};Object[a1_0x2b57('0x2')](exports,a1_0x2b57('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2b57('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x2b57('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x2b57('0x5')));const LocalStrategy=passport_local_1[a1_0x2b57('0x6')][a1_0x2b57('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x2b57('0x6')][a1_0x2b57('0x7')];passport_1[a1_0x2b57('0x6')][a1_0x2b57('0x8')]((_0xe877ca,_0xd2c41)=>{_0xd2c41(undefined,_0xe877ca['id']);});passport_1[a1_0x2b57('0x6')]['deserializeUser']((_0x15fee6,_0x27d696)=>{User_1[a1_0x2b57('0x6')][a1_0x2b57('0x9')](_0x15fee6,(_0xa7d18c,_0x243d67)=>{_0x27d696(_0xa7d18c,_0x243d67);});});passport_1[a1_0x2b57('0x6')][a1_0x2b57('0xa')](new LocalStrategy({'usernameField':a1_0x2b57('0xb')},(_0x4cd0f4,_0x5e2ca1,_0x26185b)=>{User_1[a1_0x2b57('0x6')][a1_0x2b57('0xc')]({'email':_0x4cd0f4[a1_0x2b57('0xd')]()},(_0x3f5f1d,_0x226535)=>{if(_0x3f5f1d){return _0x26185b(_0x3f5f1d);}if(!_0x226535){return _0x26185b(undefined,![],{'message':'Email\x20'+_0x4cd0f4+'\x20not\x20found.'});}_0x226535['comparePassword'](_0x5e2ca1,(_0x3f5f1d,_0x361f4f)=>{if(_0x3f5f1d){return _0x26185b(_0x3f5f1d);}if(_0x361f4f){return _0x26185b(undefined,_0x226535);}return _0x26185b(undefined,![],{'message':a1_0x2b57('0xe')});});});}));passport_1['default']['use'](new FacebookStrategy({'clientID':process[a1_0x2b57('0xf')]['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x2b57('0x10')],'callbackURL':a1_0x2b57('0x11'),'profileFields':[a1_0x2b57('0x12'),a1_0x2b57('0xb'),a1_0x2b57('0x13'),a1_0x2b57('0x14'),a1_0x2b57('0x15')],'passReqToCallback':!![]},(_0x162b45,_0x53a088,_0x512132,_0x59c76c,_0x286bd1)=>{if(_0x162b45[a1_0x2b57('0x16')]){User_1[a1_0x2b57('0x6')][a1_0x2b57('0xc')]({'facebook':_0x59c76c['id']},(_0x1048b5,_0x332563)=>{if(_0x1048b5){return _0x286bd1(_0x1048b5);}if(_0x332563){_0x162b45['flash']('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x286bd1(_0x1048b5);}else{User_1[a1_0x2b57('0x6')][a1_0x2b57('0x9')](_0x162b45[a1_0x2b57('0x16')]['id'],(_0x1048b5,_0x207efd)=>{if(_0x1048b5){return _0x286bd1(_0x1048b5);}_0x207efd[a1_0x2b57('0x17')]=_0x59c76c['id'];_0x207efd[a1_0x2b57('0x18')][a1_0x2b57('0x19')]({'kind':a1_0x2b57('0x17'),'accessToken':_0x53a088});_0x207efd['profile'][a1_0x2b57('0x12')]=_0x207efd[a1_0x2b57('0x1a')][a1_0x2b57('0x12')]||_0x59c76c['name'][a1_0x2b57('0x1b')]+'\x20'+_0x59c76c['name'][a1_0x2b57('0x1c')];_0x207efd[a1_0x2b57('0x1a')][a1_0x2b57('0x1d')]=_0x207efd[a1_0x2b57('0x1a')][a1_0x2b57('0x1d')]||_0x59c76c[a1_0x2b57('0x1e')][a1_0x2b57('0x1d')];_0x207efd[a1_0x2b57('0x1a')][a1_0x2b57('0x1f')]=_0x207efd[a1_0x2b57('0x1a')][a1_0x2b57('0x1f')]||'https://graph.facebook.com/'+_0x59c76c['id']+a1_0x2b57('0x20');_0x207efd[a1_0x2b57('0x21')](_0x1048b5=>{_0x162b45[a1_0x2b57('0x22')](a1_0x2b57('0x23'),{'msg':a1_0x2b57('0x24')});_0x286bd1(_0x1048b5,_0x207efd);});});}});}else{User_1[a1_0x2b57('0x6')][a1_0x2b57('0xc')]({'facebook':_0x59c76c['id']},(_0x5094b4,_0x442abf)=>{if(_0x5094b4){return _0x286bd1(_0x5094b4);}if(_0x442abf){return _0x286bd1(undefined,_0x442abf);}User_1[a1_0x2b57('0x6')][a1_0x2b57('0xc')]({'email':_0x59c76c[a1_0x2b57('0x1e')]['email']},(_0x5094b4,_0x5065f4)=>{if(_0x5094b4){return _0x286bd1(_0x5094b4);}if(_0x5065f4){_0x162b45[a1_0x2b57('0x22')](a1_0x2b57('0x25'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x286bd1(_0x5094b4);}else{const _0x51cb3b=new User_1[(a1_0x2b57('0x6'))]();_0x51cb3b[a1_0x2b57('0xb')]=_0x59c76c['_json']['email'];_0x51cb3b[a1_0x2b57('0x17')]=_0x59c76c['id'];_0x51cb3b[a1_0x2b57('0x18')][a1_0x2b57('0x19')]({'kind':a1_0x2b57('0x17'),'accessToken':_0x53a088});_0x51cb3b[a1_0x2b57('0x1a')][a1_0x2b57('0x12')]=_0x59c76c[a1_0x2b57('0x12')]['givenName']+'\x20'+_0x59c76c[a1_0x2b57('0x12')][a1_0x2b57('0x1c')];_0x51cb3b[a1_0x2b57('0x1a')]['gender']=_0x59c76c['_json']['gender'];_0x51cb3b[a1_0x2b57('0x1a')][a1_0x2b57('0x1f')]=a1_0x2b57('0x26')+_0x59c76c['id']+'/picture?type=large';_0x51cb3b['profile'][a1_0x2b57('0x27')]=_0x59c76c[a1_0x2b57('0x1e')]['location']?_0x59c76c['_json']['location'][a1_0x2b57('0x12')]:'';_0x51cb3b[a1_0x2b57('0x21')](_0x5094b4=>{_0x286bd1(_0x5094b4,_0x51cb3b);});}});});}}));exports[a1_0x2b57('0x28')]=(_0x4ebe96,_0x4cbba1,_0x59f454)=>{if(_0x4ebe96['isAuthenticated']()){return _0x59f454();}_0x4cbba1[a1_0x2b57('0x29')](a1_0x2b57('0x2a'));};exports[a1_0x2b57('0x2b')]=(_0x41d715,_0x531cdb,_0xe3c16)=>{const _0x4ff8ee=_0x41d715[a1_0x2b57('0x2c')][a1_0x2b57('0x2d')]('/')[a1_0x2b57('0x2e')](-0x1)[0x0];if(lodash_1[a1_0x2b57('0x6')][a1_0x2b57('0x2f')](_0x41d715['user'][a1_0x2b57('0x18')],{'kind':_0x4ff8ee})){_0xe3c16();}else{_0x531cdb[a1_0x2b57('0x29')](a1_0x2b57('0x30')+_0x4ff8ee);}};