var a1_0x33bd=['passport-local','default','Strategy','serializeUser','deserializeUser','use','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','tokens','facebook','profile','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','push','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','slice','find','/auth/','__importDefault','defineProperty','__esModule','passport'];(function(_0x417e49,_0x6c206d){var _0x4105b3=function(_0x4a11bd){while(--_0x4a11bd){_0x417e49['push'](_0x417e49['shift']());}};_0x4105b3(++_0x6c206d);}(a1_0x33bd,0x66));var a1_0x13e7=function(_0x5dafd9,_0x4c9468){_0x5dafd9=_0x5dafd9-0x0;var _0x42531a=a1_0x33bd[_0x5dafd9];return _0x42531a;};'use strict';var __importDefault=this&&this[a1_0x13e7('0x0')]||function(_0x58af30){return _0x58af30&&_0x58af30['__esModule']?_0x58af30:{'default':_0x58af30};};Object[a1_0x13e7('0x1')](exports,a1_0x13e7('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x13e7('0x3')));const passport_local_1=__importDefault(require(a1_0x13e7('0x4')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x13e7('0x5')][a1_0x13e7('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x13e7('0x5')][a1_0x13e7('0x6')];passport_1[a1_0x13e7('0x5')][a1_0x13e7('0x7')]((_0x470bb8,_0x2534fb)=>{_0x2534fb(undefined,_0x470bb8['id']);});passport_1[a1_0x13e7('0x5')][a1_0x13e7('0x8')]((_0x442b74,_0x2d98ae)=>{User_1[a1_0x13e7('0x5')]['findById'](_0x442b74,(_0x194280,_0x5484c9)=>{_0x2d98ae(_0x194280,_0x5484c9);});});passport_1[a1_0x13e7('0x5')][a1_0x13e7('0x9')](new LocalStrategy({'usernameField':'email'},(_0x461306,_0x455ee7,_0x224f00)=>{User_1[a1_0x13e7('0x5')][a1_0x13e7('0xa')]({'email':_0x461306[a1_0x13e7('0xb')]()},(_0x11aa7e,_0x5c8a44)=>{if(_0x11aa7e){return _0x224f00(_0x11aa7e);}if(!_0x5c8a44){return _0x224f00(undefined,![],{'message':a1_0x13e7('0xc')+_0x461306+a1_0x13e7('0xd')});}_0x5c8a44[a1_0x13e7('0xe')](_0x455ee7,(_0x11aa7e,_0x2120ff)=>{if(_0x11aa7e){return _0x224f00(_0x11aa7e);}if(_0x2120ff){return _0x224f00(undefined,_0x5c8a44);}return _0x224f00(undefined,![],{'message':a1_0x13e7('0xf')});});});}));passport_1[a1_0x13e7('0x5')][a1_0x13e7('0x9')](new FacebookStrategy({'clientID':process['env'][a1_0x13e7('0x10')],'clientSecret':process[a1_0x13e7('0x11')][a1_0x13e7('0x12')],'callbackURL':a1_0x13e7('0x13'),'profileFields':[a1_0x13e7('0x14'),a1_0x13e7('0x15'),a1_0x13e7('0x16'),a1_0x13e7('0x17'),a1_0x13e7('0x18')],'passReqToCallback':!![]},(_0x3496b4,_0x12c8a4,_0x33250e,_0x543316,_0x1a0417)=>{if(_0x3496b4[a1_0x13e7('0x19')]){User_1[a1_0x13e7('0x5')][a1_0x13e7('0xa')]({'facebook':_0x543316['id']},(_0x2e00c4,_0x38ab39)=>{if(_0x2e00c4){return _0x1a0417(_0x2e00c4);}if(_0x38ab39){_0x3496b4[a1_0x13e7('0x1a')](a1_0x13e7('0x1b'),{'msg':a1_0x13e7('0x1c')});_0x1a0417(_0x2e00c4);}else{User_1[a1_0x13e7('0x5')][a1_0x13e7('0x1d')](_0x3496b4[a1_0x13e7('0x19')]['id'],(_0x2e00c4,_0x220893)=>{if(_0x2e00c4){return _0x1a0417(_0x2e00c4);}_0x220893['facebook']=_0x543316['id'];_0x220893[a1_0x13e7('0x1e')]['push']({'kind':a1_0x13e7('0x1f'),'accessToken':_0x12c8a4});_0x220893[a1_0x13e7('0x20')][a1_0x13e7('0x14')]=_0x220893[a1_0x13e7('0x20')][a1_0x13e7('0x14')]||_0x543316[a1_0x13e7('0x14')][a1_0x13e7('0x21')]+'\x20'+_0x543316[a1_0x13e7('0x14')][a1_0x13e7('0x22')];_0x220893['profile'][a1_0x13e7('0x23')]=_0x220893[a1_0x13e7('0x20')][a1_0x13e7('0x23')]||_0x543316[a1_0x13e7('0x24')][a1_0x13e7('0x23')];_0x220893[a1_0x13e7('0x20')][a1_0x13e7('0x25')]=_0x220893[a1_0x13e7('0x20')]['picture']||'https://graph.facebook.com/'+_0x543316['id']+a1_0x13e7('0x26');_0x220893[a1_0x13e7('0x27')](_0x2e00c4=>{_0x3496b4['flash'](a1_0x13e7('0x28'),{'msg':a1_0x13e7('0x29')});_0x1a0417(_0x2e00c4,_0x220893);});});}});}else{User_1[a1_0x13e7('0x5')][a1_0x13e7('0xa')]({'facebook':_0x543316['id']},(_0x3acc7f,_0x528a1f)=>{if(_0x3acc7f){return _0x1a0417(_0x3acc7f);}if(_0x528a1f){return _0x1a0417(undefined,_0x528a1f);}User_1['default']['findOne']({'email':_0x543316[a1_0x13e7('0x24')][a1_0x13e7('0x15')]},(_0x3acc7f,_0x41cb5e)=>{if(_0x3acc7f){return _0x1a0417(_0x3acc7f);}if(_0x41cb5e){_0x3496b4['flash']('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x1a0417(_0x3acc7f);}else{const _0x504992=new User_1[(a1_0x13e7('0x5'))]();_0x504992[a1_0x13e7('0x15')]=_0x543316[a1_0x13e7('0x24')][a1_0x13e7('0x15')];_0x504992[a1_0x13e7('0x1f')]=_0x543316['id'];_0x504992[a1_0x13e7('0x1e')][a1_0x13e7('0x2a')]({'kind':a1_0x13e7('0x1f'),'accessToken':_0x12c8a4});_0x504992['profile'][a1_0x13e7('0x14')]=_0x543316[a1_0x13e7('0x14')][a1_0x13e7('0x21')]+'\x20'+_0x543316['name'][a1_0x13e7('0x22')];_0x504992['profile'][a1_0x13e7('0x23')]=_0x543316[a1_0x13e7('0x24')][a1_0x13e7('0x23')];_0x504992['profile'][a1_0x13e7('0x25')]=a1_0x13e7('0x2b')+_0x543316['id']+a1_0x13e7('0x26');_0x504992[a1_0x13e7('0x20')][a1_0x13e7('0x2c')]=_0x543316[a1_0x13e7('0x24')]['location']?_0x543316[a1_0x13e7('0x24')]['location'][a1_0x13e7('0x14')]:'';_0x504992['save'](_0x3acc7f=>{_0x1a0417(_0x3acc7f,_0x504992);});}});});}}));exports[a1_0x13e7('0x2d')]=(_0x39f7a7,_0x521ede,_0x5e785b)=>{if(_0x39f7a7[a1_0x13e7('0x2d')]()){return _0x5e785b();}_0x521ede[a1_0x13e7('0x2e')](a1_0x13e7('0x2f'));};exports[a1_0x13e7('0x30')]=(_0x36b29b,_0x1e328f,_0x506181)=>{const _0x200087=_0x36b29b[a1_0x13e7('0x31')]['split']('/')[a1_0x13e7('0x32')](-0x1)[0x0];if(lodash_1[a1_0x13e7('0x5')][a1_0x13e7('0x33')](_0x36b29b[a1_0x13e7('0x19')][a1_0x13e7('0x1e')],{'kind':_0x200087})){_0x506181();}else{_0x1e328f[a1_0x13e7('0x2e')](a1_0x13e7('0x34')+_0x200087);}};