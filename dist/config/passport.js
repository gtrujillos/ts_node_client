var a1_0x4e11=['/login','path','split','__importDefault','__esModule','passport','lodash','default','Strategy','serializeUser','findById','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','use','env','/auth/facebook/callback','name','email','link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','tokens','profile','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','push','https://graph.facebook.com/','location','isAuthenticated','redirect'];(function(_0x19022b,_0x2ff41e){var _0x392043=function(_0x50b6fb){while(--_0x50b6fb){_0x19022b['push'](_0x19022b['shift']());}};_0x392043(++_0x2ff41e);}(a1_0x4e11,0x198));var a1_0x35f3=function(_0x502fd2,_0x551ada){_0x502fd2=_0x502fd2-0x0;var _0x5cbbaa=a1_0x4e11[_0x502fd2];return _0x5cbbaa;};'use strict';var __importDefault=this&&this[a1_0x35f3('0x0')]||function(_0x599aaf){return _0x599aaf&&_0x599aaf[a1_0x35f3('0x1')]?_0x599aaf:{'default':_0x599aaf};};Object['defineProperty'](exports,a1_0x35f3('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x35f3('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x35f3('0x3')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x35f3('0x4')][a1_0x35f3('0x5')];passport_1[a1_0x35f3('0x4')][a1_0x35f3('0x6')]((_0x367f8d,_0x41ac22)=>{_0x41ac22(undefined,_0x367f8d['id']);});passport_1[a1_0x35f3('0x4')]['deserializeUser']((_0x2949d7,_0x4c9fe4)=>{User_1[a1_0x35f3('0x4')][a1_0x35f3('0x7')](_0x2949d7,(_0x3b8d86,_0x4f6ee7)=>{_0x4c9fe4(_0x3b8d86,_0x4f6ee7);});});passport_1[a1_0x35f3('0x4')]['use'](new LocalStrategy({'usernameField':'email'},(_0x223758,_0x415676,_0x531ccc)=>{User_1['default'][a1_0x35f3('0x8')]({'email':_0x223758[a1_0x35f3('0x9')]()},(_0x3493a5,_0xe09628)=>{if(_0x3493a5){return _0x531ccc(_0x3493a5);}if(!_0xe09628){return _0x531ccc(undefined,![],{'message':a1_0x35f3('0xa')+_0x223758+a1_0x35f3('0xb')});}_0xe09628[a1_0x35f3('0xc')](_0x415676,(_0x3493a5,_0x1e210f)=>{if(_0x3493a5){return _0x531ccc(_0x3493a5);}if(_0x1e210f){return _0x531ccc(undefined,_0xe09628);}return _0x531ccc(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x35f3('0x4')][a1_0x35f3('0xd')](new FacebookStrategy({'clientID':process[a1_0x35f3('0xe')]['FACEBOOK_ID'],'clientSecret':process[a1_0x35f3('0xe')]['FACEBOOK_SECRET'],'callbackURL':a1_0x35f3('0xf'),'profileFields':[a1_0x35f3('0x10'),a1_0x35f3('0x11'),a1_0x35f3('0x12'),a1_0x35f3('0x13'),a1_0x35f3('0x14')],'passReqToCallback':!![]},(_0x49cffb,_0x13fc3b,_0x136125,_0x34dedd,_0x2fb131)=>{if(_0x49cffb['user']){User_1[a1_0x35f3('0x4')]['findOne']({'facebook':_0x34dedd['id']},(_0x29f938,_0xa5117f)=>{if(_0x29f938){return _0x2fb131(_0x29f938);}if(_0xa5117f){_0x49cffb[a1_0x35f3('0x15')](a1_0x35f3('0x16'),{'msg':a1_0x35f3('0x17')});_0x2fb131(_0x29f938);}else{User_1[a1_0x35f3('0x4')][a1_0x35f3('0x7')](_0x49cffb[a1_0x35f3('0x18')]['id'],(_0x29f938,_0x3864af)=>{if(_0x29f938){return _0x2fb131(_0x29f938);}_0x3864af[a1_0x35f3('0x19')]=_0x34dedd['id'];_0x3864af[a1_0x35f3('0x1a')]['push']({'kind':a1_0x35f3('0x19'),'accessToken':_0x13fc3b});_0x3864af[a1_0x35f3('0x1b')][a1_0x35f3('0x10')]=_0x3864af['profile'][a1_0x35f3('0x10')]||_0x34dedd[a1_0x35f3('0x10')][a1_0x35f3('0x1c')]+'\x20'+_0x34dedd[a1_0x35f3('0x10')][a1_0x35f3('0x1d')];_0x3864af[a1_0x35f3('0x1b')][a1_0x35f3('0x1e')]=_0x3864af[a1_0x35f3('0x1b')]['gender']||_0x34dedd[a1_0x35f3('0x1f')][a1_0x35f3('0x1e')];_0x3864af['profile']['picture']=_0x3864af['profile'][a1_0x35f3('0x20')]||'https://graph.facebook.com/'+_0x34dedd['id']+a1_0x35f3('0x21');_0x3864af[a1_0x35f3('0x22')](_0x29f938=>{_0x49cffb[a1_0x35f3('0x15')](a1_0x35f3('0x23'),{'msg':a1_0x35f3('0x24')});_0x2fb131(_0x29f938,_0x3864af);});});}});}else{User_1[a1_0x35f3('0x4')][a1_0x35f3('0x8')]({'facebook':_0x34dedd['id']},(_0x5da1f0,_0x3d4325)=>{if(_0x5da1f0){return _0x2fb131(_0x5da1f0);}if(_0x3d4325){return _0x2fb131(undefined,_0x3d4325);}User_1['default'][a1_0x35f3('0x8')]({'email':_0x34dedd[a1_0x35f3('0x1f')][a1_0x35f3('0x11')]},(_0x5da1f0,_0x5264d7)=>{if(_0x5da1f0){return _0x2fb131(_0x5da1f0);}if(_0x5264d7){_0x49cffb['flash'](a1_0x35f3('0x16'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x2fb131(_0x5da1f0);}else{const _0x3d66a7=new User_1[(a1_0x35f3('0x4'))]();_0x3d66a7[a1_0x35f3('0x11')]=_0x34dedd[a1_0x35f3('0x1f')][a1_0x35f3('0x11')];_0x3d66a7[a1_0x35f3('0x19')]=_0x34dedd['id'];_0x3d66a7[a1_0x35f3('0x1a')][a1_0x35f3('0x25')]({'kind':a1_0x35f3('0x19'),'accessToken':_0x13fc3b});_0x3d66a7['profile'][a1_0x35f3('0x10')]=_0x34dedd['name'][a1_0x35f3('0x1c')]+'\x20'+_0x34dedd[a1_0x35f3('0x10')][a1_0x35f3('0x1d')];_0x3d66a7[a1_0x35f3('0x1b')][a1_0x35f3('0x1e')]=_0x34dedd[a1_0x35f3('0x1f')][a1_0x35f3('0x1e')];_0x3d66a7[a1_0x35f3('0x1b')][a1_0x35f3('0x20')]=a1_0x35f3('0x26')+_0x34dedd['id']+a1_0x35f3('0x21');_0x3d66a7[a1_0x35f3('0x1b')][a1_0x35f3('0x27')]=_0x34dedd[a1_0x35f3('0x1f')]['location']?_0x34dedd[a1_0x35f3('0x1f')][a1_0x35f3('0x27')][a1_0x35f3('0x10')]:'';_0x3d66a7[a1_0x35f3('0x22')](_0x5da1f0=>{_0x2fb131(_0x5da1f0,_0x3d66a7);});}});});}}));exports[a1_0x35f3('0x28')]=(_0x2d09e9,_0x4e2b1d,_0x467525)=>{if(_0x2d09e9[a1_0x35f3('0x28')]()){return _0x467525();}_0x4e2b1d[a1_0x35f3('0x29')](a1_0x35f3('0x2a'));};exports['isAuthorized']=(_0x569565,_0x213e88,_0x32b858)=>{const _0x4e471b=_0x569565[a1_0x35f3('0x2b')][a1_0x35f3('0x2c')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x35f3('0x4')]['find'](_0x569565[a1_0x35f3('0x18')][a1_0x35f3('0x1a')],{'kind':_0x4e471b})){_0x32b858();}else{_0x213e88[a1_0x35f3('0x29')]('/auth/'+_0x4e471b);}};