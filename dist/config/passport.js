var a1_0x1050=['/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','location','save','isAuthenticated','redirect','/login','isAuthorized','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/'];(function(_0x51c3dd,_0x1f767b){var _0x50e952=function(_0x19aeb0){while(--_0x19aeb0){_0x51c3dd['push'](_0x51c3dd['shift']());}};_0x50e952(++_0x1f767b);}(a1_0x1050,0x16c));var a1_0x54c4=function(_0x3bb9f1,_0x2882b5){_0x3bb9f1=_0x3bb9f1-0x0;var _0x159d42=a1_0x1050[_0x3bb9f1];return _0x159d42;};'use strict';var __importDefault=this&&this[a1_0x54c4('0x0')]||function(_0x3cfb3e){return _0x3cfb3e&&_0x3cfb3e[a1_0x54c4('0x1')]?_0x3cfb3e:{'default':_0x3cfb3e};};Object[a1_0x54c4('0x2')](exports,a1_0x54c4('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x54c4('0x3')));const passport_facebook_1=__importDefault(require(a1_0x54c4('0x4')));const lodash_1=__importDefault(require(a1_0x54c4('0x5')));const User_1=__importDefault(require(a1_0x54c4('0x6')));const LocalStrategy=passport_local_1[a1_0x54c4('0x7')][a1_0x54c4('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x54c4('0x7')][a1_0x54c4('0x8')];passport_1[a1_0x54c4('0x7')][a1_0x54c4('0x9')]((_0x138c35,_0x490756)=>{_0x490756(undefined,_0x138c35['id']);});passport_1['default']['deserializeUser']((_0x59e84b,_0x2b676f)=>{User_1[a1_0x54c4('0x7')][a1_0x54c4('0xa')](_0x59e84b,(_0x63c10f,_0x4230d3)=>{_0x2b676f(_0x63c10f,_0x4230d3);});});passport_1['default'][a1_0x54c4('0xb')](new LocalStrategy({'usernameField':a1_0x54c4('0xc')},(_0x185265,_0x175b87,_0x43d19b)=>{User_1['default'][a1_0x54c4('0xd')]({'email':_0x185265['toLowerCase']()},(_0x2e9083,_0x5aed91)=>{if(_0x2e9083){return _0x43d19b(_0x2e9083);}if(!_0x5aed91){return _0x43d19b(undefined,![],{'message':a1_0x54c4('0xe')+_0x185265+a1_0x54c4('0xf')});}_0x5aed91[a1_0x54c4('0x10')](_0x175b87,(_0x2e9083,_0x3c3770)=>{if(_0x2e9083){return _0x43d19b(_0x2e9083);}if(_0x3c3770){return _0x43d19b(undefined,_0x5aed91);}return _0x43d19b(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x54c4('0x7')][a1_0x54c4('0xb')](new FacebookStrategy({'clientID':process[a1_0x54c4('0x11')][a1_0x54c4('0x12')],'clientSecret':process['env'][a1_0x54c4('0x13')],'callbackURL':a1_0x54c4('0x14'),'profileFields':[a1_0x54c4('0x15'),'email',a1_0x54c4('0x16'),a1_0x54c4('0x17'),a1_0x54c4('0x18')],'passReqToCallback':!![]},(_0x1d6042,_0x22ae9f,_0x836717,_0x37ff69,_0x2378e4)=>{if(_0x1d6042[a1_0x54c4('0x19')]){User_1[a1_0x54c4('0x7')][a1_0x54c4('0xd')]({'facebook':_0x37ff69['id']},(_0x489385,_0x1072a4)=>{if(_0x489385){return _0x2378e4(_0x489385);}if(_0x1072a4){_0x1d6042[a1_0x54c4('0x1a')]('errors',{'msg':a1_0x54c4('0x1b')});_0x2378e4(_0x489385);}else{User_1[a1_0x54c4('0x7')]['findById'](_0x1d6042['user']['id'],(_0x489385,_0x3fec81)=>{if(_0x489385){return _0x2378e4(_0x489385);}_0x3fec81['facebook']=_0x37ff69['id'];_0x3fec81[a1_0x54c4('0x1c')]['push']({'kind':'facebook','accessToken':_0x22ae9f});_0x3fec81[a1_0x54c4('0x1d')][a1_0x54c4('0x15')]=_0x3fec81[a1_0x54c4('0x1d')][a1_0x54c4('0x15')]||_0x37ff69[a1_0x54c4('0x15')][a1_0x54c4('0x1e')]+'\x20'+_0x37ff69[a1_0x54c4('0x15')][a1_0x54c4('0x1f')];_0x3fec81[a1_0x54c4('0x1d')][a1_0x54c4('0x20')]=_0x3fec81['profile']['gender']||_0x37ff69[a1_0x54c4('0x21')][a1_0x54c4('0x20')];_0x3fec81[a1_0x54c4('0x1d')][a1_0x54c4('0x22')]=_0x3fec81[a1_0x54c4('0x1d')][a1_0x54c4('0x22')]||a1_0x54c4('0x23')+_0x37ff69['id']+a1_0x54c4('0x24');_0x3fec81['save'](_0x489385=>{_0x1d6042['flash'](a1_0x54c4('0x25'),{'msg':a1_0x54c4('0x26')});_0x2378e4(_0x489385,_0x3fec81);});});}});}else{User_1['default'][a1_0x54c4('0xd')]({'facebook':_0x37ff69['id']},(_0x42708a,_0x532d13)=>{if(_0x42708a){return _0x2378e4(_0x42708a);}if(_0x532d13){return _0x2378e4(undefined,_0x532d13);}User_1['default'][a1_0x54c4('0xd')]({'email':_0x37ff69[a1_0x54c4('0x21')]['email']},(_0x42708a,_0x4d8029)=>{if(_0x42708a){return _0x2378e4(_0x42708a);}if(_0x4d8029){_0x1d6042[a1_0x54c4('0x1a')]('errors',{'msg':a1_0x54c4('0x27')});_0x2378e4(_0x42708a);}else{const _0x49ec2b=new User_1['default']();_0x49ec2b[a1_0x54c4('0xc')]=_0x37ff69[a1_0x54c4('0x21')][a1_0x54c4('0xc')];_0x49ec2b[a1_0x54c4('0x28')]=_0x37ff69['id'];_0x49ec2b[a1_0x54c4('0x1c')]['push']({'kind':'facebook','accessToken':_0x22ae9f});_0x49ec2b[a1_0x54c4('0x1d')][a1_0x54c4('0x15')]=_0x37ff69['name'][a1_0x54c4('0x1e')]+'\x20'+_0x37ff69['name'][a1_0x54c4('0x1f')];_0x49ec2b[a1_0x54c4('0x1d')][a1_0x54c4('0x20')]=_0x37ff69['_json'][a1_0x54c4('0x20')];_0x49ec2b[a1_0x54c4('0x1d')][a1_0x54c4('0x22')]=a1_0x54c4('0x23')+_0x37ff69['id']+a1_0x54c4('0x24');_0x49ec2b[a1_0x54c4('0x1d')]['location']=_0x37ff69[a1_0x54c4('0x21')][a1_0x54c4('0x29')]?_0x37ff69[a1_0x54c4('0x21')][a1_0x54c4('0x29')][a1_0x54c4('0x15')]:'';_0x49ec2b[a1_0x54c4('0x2a')](_0x42708a=>{_0x2378e4(_0x42708a,_0x49ec2b);});}});});}}));exports['isAuthenticated']=(_0x50601d,_0x5cd507,_0x16856a)=>{if(_0x50601d[a1_0x54c4('0x2b')]()){return _0x16856a();}_0x5cd507[a1_0x54c4('0x2c')](a1_0x54c4('0x2d'));};exports[a1_0x54c4('0x2e')]=(_0x32da95,_0x366ffe,_0x4fe0f7)=>{const _0x3ea0bd=_0x32da95['path']['split']('/')[a1_0x54c4('0x2f')](-0x1)[0x0];if(lodash_1['default'][a1_0x54c4('0x30')](_0x32da95['user'][a1_0x54c4('0x1c')],{'kind':_0x3ea0bd})){_0x4fe0f7();}else{_0x366ffe[a1_0x54c4('0x2c')](a1_0x54c4('0x31')+_0x3ea0bd);}};