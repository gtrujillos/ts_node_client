var a1_0x3260=['name','profile','givenName','gender','_json','picture','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','email','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','isAuthorized','split','slice','redirect','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','default','Strategy','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','link','user','flash','errors','facebook','push'];(function(_0x432349,_0xbacc4e){var _0x3e30de=function(_0x5bbf3e){while(--_0x5bbf3e){_0x432349['push'](_0x432349['shift']());}};_0x3e30de(++_0xbacc4e);}(a1_0x3260,0x13f));var a1_0x3b08=function(_0xa6f754,_0x4719f6){_0xa6f754=_0xa6f754-0x0;var _0x1d0ddc=a1_0x3260[_0xa6f754];return _0x1d0ddc;};'use strict';var __importDefault=this&&this[a1_0x3b08('0x0')]||function(_0x4da0d2){return _0x4da0d2&&_0x4da0d2[a1_0x3b08('0x1')]?_0x4da0d2:{'default':_0x4da0d2};};Object[a1_0x3b08('0x2')](exports,a1_0x3b08('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3b08('0x3')));const passport_local_1=__importDefault(require(a1_0x3b08('0x4')));const passport_facebook_1=__importDefault(require(a1_0x3b08('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x3b08('0x6')][a1_0x3b08('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x3b08('0x6')][a1_0x3b08('0x7')];passport_1[a1_0x3b08('0x6')]['serializeUser']((_0x5f3309,_0x291d9d)=>{_0x291d9d(undefined,_0x5f3309['id']);});passport_1[a1_0x3b08('0x6')][a1_0x3b08('0x8')]((_0x14f021,_0x35dfee)=>{User_1[a1_0x3b08('0x6')][a1_0x3b08('0x9')](_0x14f021,(_0x1125f2,_0x4335cd)=>{_0x35dfee(_0x1125f2,_0x4335cd);});});passport_1['default'][a1_0x3b08('0xa')](new LocalStrategy({'usernameField':'email'},(_0x12dd9e,_0x44a8f5,_0x4b594b)=>{User_1[a1_0x3b08('0x6')][a1_0x3b08('0xb')]({'email':_0x12dd9e[a1_0x3b08('0xc')]()},(_0x50c41b,_0x2c3fbd)=>{if(_0x50c41b){return _0x4b594b(_0x50c41b);}if(!_0x2c3fbd){return _0x4b594b(undefined,![],{'message':a1_0x3b08('0xd')+_0x12dd9e+a1_0x3b08('0xe')});}_0x2c3fbd[a1_0x3b08('0xf')](_0x44a8f5,(_0x50c41b,_0x100140)=>{if(_0x50c41b){return _0x4b594b(_0x50c41b);}if(_0x100140){return _0x4b594b(undefined,_0x2c3fbd);}return _0x4b594b(undefined,![],{'message':a1_0x3b08('0x10')});});});}));passport_1[a1_0x3b08('0x6')][a1_0x3b08('0xa')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x3b08('0x11')][a1_0x3b08('0x12')],'callbackURL':'/auth/facebook/callback','profileFields':['name','email',a1_0x3b08('0x13'),'locale','timezone'],'passReqToCallback':!![]},(_0x2aef32,_0x58a29c,_0x5c4d99,_0x5dc1c0,_0x481505)=>{if(_0x2aef32[a1_0x3b08('0x14')]){User_1['default'][a1_0x3b08('0xb')]({'facebook':_0x5dc1c0['id']},(_0x51d9b0,_0x15d0f9)=>{if(_0x51d9b0){return _0x481505(_0x51d9b0);}if(_0x15d0f9){_0x2aef32[a1_0x3b08('0x15')](a1_0x3b08('0x16'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x481505(_0x51d9b0);}else{User_1[a1_0x3b08('0x6')][a1_0x3b08('0x9')](_0x2aef32[a1_0x3b08('0x14')]['id'],(_0x51d9b0,_0x3e16a8)=>{if(_0x51d9b0){return _0x481505(_0x51d9b0);}_0x3e16a8[a1_0x3b08('0x17')]=_0x5dc1c0['id'];_0x3e16a8['tokens'][a1_0x3b08('0x18')]({'kind':a1_0x3b08('0x17'),'accessToken':_0x58a29c});_0x3e16a8['profile'][a1_0x3b08('0x19')]=_0x3e16a8[a1_0x3b08('0x1a')][a1_0x3b08('0x19')]||_0x5dc1c0[a1_0x3b08('0x19')][a1_0x3b08('0x1b')]+'\x20'+_0x5dc1c0[a1_0x3b08('0x19')]['familyName'];_0x3e16a8[a1_0x3b08('0x1a')][a1_0x3b08('0x1c')]=_0x3e16a8[a1_0x3b08('0x1a')]['gender']||_0x5dc1c0[a1_0x3b08('0x1d')]['gender'];_0x3e16a8[a1_0x3b08('0x1a')][a1_0x3b08('0x1e')]=_0x3e16a8[a1_0x3b08('0x1a')][a1_0x3b08('0x1e')]||'https://graph.facebook.com/'+_0x5dc1c0['id']+a1_0x3b08('0x1f');_0x3e16a8[a1_0x3b08('0x20')](_0x51d9b0=>{_0x2aef32[a1_0x3b08('0x15')]('info',{'msg':a1_0x3b08('0x21')});_0x481505(_0x51d9b0,_0x3e16a8);});});}});}else{User_1[a1_0x3b08('0x6')]['findOne']({'facebook':_0x5dc1c0['id']},(_0x24cfa6,_0x5de9ee)=>{if(_0x24cfa6){return _0x481505(_0x24cfa6);}if(_0x5de9ee){return _0x481505(undefined,_0x5de9ee);}User_1['default'][a1_0x3b08('0xb')]({'email':_0x5dc1c0[a1_0x3b08('0x1d')][a1_0x3b08('0x22')]},(_0x24cfa6,_0x51e701)=>{if(_0x24cfa6){return _0x481505(_0x24cfa6);}if(_0x51e701){_0x2aef32[a1_0x3b08('0x15')](a1_0x3b08('0x16'),{'msg':a1_0x3b08('0x23')});_0x481505(_0x24cfa6);}else{const _0x508aef=new User_1[(a1_0x3b08('0x6'))]();_0x508aef[a1_0x3b08('0x22')]=_0x5dc1c0[a1_0x3b08('0x1d')][a1_0x3b08('0x22')];_0x508aef[a1_0x3b08('0x17')]=_0x5dc1c0['id'];_0x508aef['tokens'][a1_0x3b08('0x18')]({'kind':a1_0x3b08('0x17'),'accessToken':_0x58a29c});_0x508aef[a1_0x3b08('0x1a')]['name']=_0x5dc1c0[a1_0x3b08('0x19')][a1_0x3b08('0x1b')]+'\x20'+_0x5dc1c0[a1_0x3b08('0x19')]['familyName'];_0x508aef[a1_0x3b08('0x1a')]['gender']=_0x5dc1c0[a1_0x3b08('0x1d')][a1_0x3b08('0x1c')];_0x508aef[a1_0x3b08('0x1a')][a1_0x3b08('0x1e')]='https://graph.facebook.com/'+_0x5dc1c0['id']+a1_0x3b08('0x1f');_0x508aef[a1_0x3b08('0x1a')][a1_0x3b08('0x24')]=_0x5dc1c0[a1_0x3b08('0x1d')][a1_0x3b08('0x24')]?_0x5dc1c0['_json'][a1_0x3b08('0x24')][a1_0x3b08('0x19')]:'';_0x508aef['save'](_0x24cfa6=>{_0x481505(_0x24cfa6,_0x508aef);});}});});}}));exports[a1_0x3b08('0x25')]=(_0x649326,_0x58c084,_0x4ab35a)=>{if(_0x649326['isAuthenticated']()){return _0x4ab35a();}_0x58c084['redirect']('/login');};exports[a1_0x3b08('0x26')]=(_0x427bfd,_0x54e1c8,_0x4ed118)=>{const _0x2d72b8=_0x427bfd['path'][a1_0x3b08('0x27')]('/')[a1_0x3b08('0x28')](-0x1)[0x0];if(lodash_1['default']['find'](_0x427bfd[a1_0x3b08('0x14')]['tokens'],{'kind':_0x2d72b8})){_0x4ed118();}else{_0x54e1c8[a1_0x3b08('0x29')](a1_0x3b08('0x2a')+_0x2d72b8);}};