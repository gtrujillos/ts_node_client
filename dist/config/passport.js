var a1_0x2682=['facebook','tokens','profile','gender','picture','https://graph.facebook.com/','/picture?type=large','Facebook\x20account\x20has\x20been\x20linked.','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','givenName','familyName','location','save','isAuthenticated','redirect','/login','isAuthorized','split','slice','find','/auth/','defineProperty','passport','passport-local','passport-facebook','lodash','default','Strategy','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'];(function(_0x4f4511,_0x27ad1b){var _0x252885=function(_0x17ea53){while(--_0x17ea53){_0x4f4511['push'](_0x4f4511['shift']());}};_0x252885(++_0x27ad1b);}(a1_0x2682,0x183));var a1_0x8b63=function(_0x3ee429,_0x2f145a){_0x3ee429=_0x3ee429-0x0;var _0x1f1c60=a1_0x2682[_0x3ee429];return _0x1f1c60;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3df9c1){return _0x3df9c1&&_0x3df9c1['__esModule']?_0x3df9c1:{'default':_0x3df9c1};};Object[a1_0x8b63('0x0')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x8b63('0x1')));const passport_local_1=__importDefault(require(a1_0x8b63('0x2')));const passport_facebook_1=__importDefault(require(a1_0x8b63('0x3')));const lodash_1=__importDefault(require(a1_0x8b63('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x8b63('0x5')][a1_0x8b63('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x8b63('0x5')][a1_0x8b63('0x6')];passport_1[a1_0x8b63('0x5')]['serializeUser']((_0xab08b7,_0x64fdf9)=>{_0x64fdf9(undefined,_0xab08b7['id']);});passport_1[a1_0x8b63('0x5')][a1_0x8b63('0x7')]((_0xffd209,_0x1c34e4)=>{User_1[a1_0x8b63('0x5')][a1_0x8b63('0x8')](_0xffd209,(_0x26b31c,_0x1283d0)=>{_0x1c34e4(_0x26b31c,_0x1283d0);});});passport_1[a1_0x8b63('0x5')][a1_0x8b63('0x9')](new LocalStrategy({'usernameField':a1_0x8b63('0xa')},(_0x31917f,_0x5fb993,_0x1a2d77)=>{User_1['default'][a1_0x8b63('0xb')]({'email':_0x31917f[a1_0x8b63('0xc')]()},(_0x579cc0,_0x2b5ded)=>{if(_0x579cc0){return _0x1a2d77(_0x579cc0);}if(!_0x2b5ded){return _0x1a2d77(undefined,![],{'message':a1_0x8b63('0xd')+_0x31917f+a1_0x8b63('0xe')});}_0x2b5ded[a1_0x8b63('0xf')](_0x5fb993,(_0x579cc0,_0x3609ee)=>{if(_0x579cc0){return _0x1a2d77(_0x579cc0);}if(_0x3609ee){return _0x1a2d77(undefined,_0x2b5ded);}return _0x1a2d77(undefined,![],{'message':a1_0x8b63('0x10')});});});}));passport_1[a1_0x8b63('0x5')]['use'](new FacebookStrategy({'clientID':process[a1_0x8b63('0x11')][a1_0x8b63('0x12')],'clientSecret':process[a1_0x8b63('0x11')][a1_0x8b63('0x13')],'callbackURL':a1_0x8b63('0x14'),'profileFields':[a1_0x8b63('0x15'),a1_0x8b63('0xa'),a1_0x8b63('0x16'),a1_0x8b63('0x17'),a1_0x8b63('0x18')],'passReqToCallback':!![]},(_0x3e445e,_0x268e5d,_0x557647,_0x3cea7f,_0x4e7b43)=>{if(_0x3e445e[a1_0x8b63('0x19')]){User_1[a1_0x8b63('0x5')][a1_0x8b63('0xb')]({'facebook':_0x3cea7f['id']},(_0xc47410,_0x34158a)=>{if(_0xc47410){return _0x4e7b43(_0xc47410);}if(_0x34158a){_0x3e445e[a1_0x8b63('0x1a')](a1_0x8b63('0x1b'),{'msg':a1_0x8b63('0x1c')});_0x4e7b43(_0xc47410);}else{User_1[a1_0x8b63('0x5')]['findById'](_0x3e445e['user']['id'],(_0xc47410,_0x36440d)=>{if(_0xc47410){return _0x4e7b43(_0xc47410);}_0x36440d[a1_0x8b63('0x1d')]=_0x3cea7f['id'];_0x36440d[a1_0x8b63('0x1e')]['push']({'kind':'facebook','accessToken':_0x268e5d});_0x36440d[a1_0x8b63('0x1f')][a1_0x8b63('0x15')]=_0x36440d['profile']['name']||_0x3cea7f[a1_0x8b63('0x15')]['givenName']+'\x20'+_0x3cea7f['name']['familyName'];_0x36440d['profile'][a1_0x8b63('0x20')]=_0x36440d[a1_0x8b63('0x1f')]['gender']||_0x3cea7f['_json'][a1_0x8b63('0x20')];_0x36440d[a1_0x8b63('0x1f')][a1_0x8b63('0x21')]=_0x36440d[a1_0x8b63('0x1f')]['picture']||a1_0x8b63('0x22')+_0x3cea7f['id']+a1_0x8b63('0x23');_0x36440d['save'](_0xc47410=>{_0x3e445e[a1_0x8b63('0x1a')]('info',{'msg':a1_0x8b63('0x24')});_0x4e7b43(_0xc47410,_0x36440d);});});}});}else{User_1[a1_0x8b63('0x5')][a1_0x8b63('0xb')]({'facebook':_0x3cea7f['id']},(_0x2e1f40,_0x473fd5)=>{if(_0x2e1f40){return _0x4e7b43(_0x2e1f40);}if(_0x473fd5){return _0x4e7b43(undefined,_0x473fd5);}User_1[a1_0x8b63('0x5')][a1_0x8b63('0xb')]({'email':_0x3cea7f[a1_0x8b63('0x25')][a1_0x8b63('0xa')]},(_0x2e1f40,_0x96537f)=>{if(_0x2e1f40){return _0x4e7b43(_0x2e1f40);}if(_0x96537f){_0x3e445e[a1_0x8b63('0x1a')](a1_0x8b63('0x1b'),{'msg':a1_0x8b63('0x26')});_0x4e7b43(_0x2e1f40);}else{const _0x34db0b=new User_1[(a1_0x8b63('0x5'))]();_0x34db0b[a1_0x8b63('0xa')]=_0x3cea7f[a1_0x8b63('0x25')][a1_0x8b63('0xa')];_0x34db0b[a1_0x8b63('0x1d')]=_0x3cea7f['id'];_0x34db0b[a1_0x8b63('0x1e')][a1_0x8b63('0x27')]({'kind':a1_0x8b63('0x1d'),'accessToken':_0x268e5d});_0x34db0b[a1_0x8b63('0x1f')][a1_0x8b63('0x15')]=_0x3cea7f[a1_0x8b63('0x15')][a1_0x8b63('0x28')]+'\x20'+_0x3cea7f[a1_0x8b63('0x15')][a1_0x8b63('0x29')];_0x34db0b[a1_0x8b63('0x1f')]['gender']=_0x3cea7f['_json'][a1_0x8b63('0x20')];_0x34db0b['profile'][a1_0x8b63('0x21')]=a1_0x8b63('0x22')+_0x3cea7f['id']+a1_0x8b63('0x23');_0x34db0b[a1_0x8b63('0x1f')][a1_0x8b63('0x2a')]=_0x3cea7f[a1_0x8b63('0x25')]['location']?_0x3cea7f[a1_0x8b63('0x25')][a1_0x8b63('0x2a')][a1_0x8b63('0x15')]:'';_0x34db0b[a1_0x8b63('0x2b')](_0x2e1f40=>{_0x4e7b43(_0x2e1f40,_0x34db0b);});}});});}}));exports[a1_0x8b63('0x2c')]=(_0x345ee9,_0x41b63a,_0x16c34b)=>{if(_0x345ee9[a1_0x8b63('0x2c')]()){return _0x16c34b();}_0x41b63a[a1_0x8b63('0x2d')](a1_0x8b63('0x2e'));};exports[a1_0x8b63('0x2f')]=(_0x20ea1b,_0x3bf5f8,_0x217c50)=>{const _0x2af64b=_0x20ea1b['path'][a1_0x8b63('0x30')]('/')[a1_0x8b63('0x31')](-0x1)[0x0];if(lodash_1[a1_0x8b63('0x5')][a1_0x8b63('0x32')](_0x20ea1b['user'][a1_0x8b63('0x1e')],{'kind':_0x2af64b})){_0x217c50();}else{_0x3bf5f8[a1_0x8b63('0x2d')](a1_0x8b63('0x33')+_0x2af64b);}};