var a1_0x558e=['deserializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','link','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','push','facebook','name','familyName','profile','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','location','isAuthenticated','redirect','/login','path','split','slice','tokens','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy'];(function(_0x4c478f,_0x110923){var _0x5f2bf8=function(_0x1427fd){while(--_0x1427fd){_0x4c478f['push'](_0x4c478f['shift']());}};_0x5f2bf8(++_0x110923);}(a1_0x558e,0x8c));var a1_0x4967=function(_0x307907,_0x31af3c){_0x307907=_0x307907-0x0;var _0x413810=a1_0x558e[_0x307907];return _0x413810;};'use strict';var __importDefault=this&&this[a1_0x4967('0x0')]||function(_0x1e71da){return _0x1e71da&&_0x1e71da[a1_0x4967('0x1')]?_0x1e71da:{'default':_0x1e71da};};Object[a1_0x4967('0x2')](exports,a1_0x4967('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4967('0x3')));const passport_local_1=__importDefault(require(a1_0x4967('0x4')));const passport_facebook_1=__importDefault(require(a1_0x4967('0x5')));const lodash_1=__importDefault(require(a1_0x4967('0x6')));const User_1=__importDefault(require(a1_0x4967('0x7')));const LocalStrategy=passport_local_1[a1_0x4967('0x8')][a1_0x4967('0x9')];const FacebookStrategy=passport_facebook_1[a1_0x4967('0x8')][a1_0x4967('0x9')];passport_1[a1_0x4967('0x8')]['serializeUser']((_0x20faa9,_0x166213)=>{_0x166213(undefined,_0x20faa9['id']);});passport_1['default'][a1_0x4967('0xa')]((_0x276d4b,_0x44bac3)=>{User_1[a1_0x4967('0x8')][a1_0x4967('0xb')](_0x276d4b,(_0x3fbae5,_0x143a95)=>{_0x44bac3(_0x3fbae5,_0x143a95);});});passport_1[a1_0x4967('0x8')][a1_0x4967('0xc')](new LocalStrategy({'usernameField':a1_0x4967('0xd')},(_0x23ff14,_0xf2287a,_0x2d9437)=>{User_1[a1_0x4967('0x8')][a1_0x4967('0xe')]({'email':_0x23ff14['toLowerCase']()},(_0x4f3cb6,_0x2558f1)=>{if(_0x4f3cb6){return _0x2d9437(_0x4f3cb6);}if(!_0x2558f1){return _0x2d9437(undefined,![],{'message':a1_0x4967('0xf')+_0x23ff14+a1_0x4967('0x10')});}_0x2558f1[a1_0x4967('0x11')](_0xf2287a,(_0x4f3cb6,_0x3ae343)=>{if(_0x4f3cb6){return _0x2d9437(_0x4f3cb6);}if(_0x3ae343){return _0x2d9437(undefined,_0x2558f1);}return _0x2d9437(undefined,![],{'message':a1_0x4967('0x12')});});});}));passport_1[a1_0x4967('0x8')]['use'](new FacebookStrategy({'clientID':process[a1_0x4967('0x13')][a1_0x4967('0x14')],'clientSecret':process[a1_0x4967('0x13')]['FACEBOOK_SECRET'],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x4967('0xd'),a1_0x4967('0x15'),'locale',a1_0x4967('0x16')],'passReqToCallback':!![]},(_0xaffda,_0x5496eb,_0x3585fd,_0x395e94,_0x930cf5)=>{if(_0xaffda[a1_0x4967('0x17')]){User_1['default']['findOne']({'facebook':_0x395e94['id']},(_0x5d58ca,_0x3df5b0)=>{if(_0x5d58ca){return _0x930cf5(_0x5d58ca);}if(_0x3df5b0){_0xaffda[a1_0x4967('0x18')](a1_0x4967('0x19'),{'msg':a1_0x4967('0x1a')});_0x930cf5(_0x5d58ca);}else{User_1[a1_0x4967('0x8')]['findById'](_0xaffda[a1_0x4967('0x17')]['id'],(_0x5d58ca,_0x1d4645)=>{if(_0x5d58ca){return _0x930cf5(_0x5d58ca);}_0x1d4645['facebook']=_0x395e94['id'];_0x1d4645['tokens'][a1_0x4967('0x1b')]({'kind':a1_0x4967('0x1c'),'accessToken':_0x5496eb});_0x1d4645['profile'][a1_0x4967('0x1d')]=_0x1d4645['profile'][a1_0x4967('0x1d')]||_0x395e94['name']['givenName']+'\x20'+_0x395e94[a1_0x4967('0x1d')][a1_0x4967('0x1e')];_0x1d4645[a1_0x4967('0x1f')][a1_0x4967('0x20')]=_0x1d4645['profile']['gender']||_0x395e94[a1_0x4967('0x21')][a1_0x4967('0x20')];_0x1d4645[a1_0x4967('0x1f')]['picture']=_0x1d4645['profile'][a1_0x4967('0x22')]||a1_0x4967('0x23')+_0x395e94['id']+a1_0x4967('0x24');_0x1d4645[a1_0x4967('0x25')](_0x5d58ca=>{_0xaffda['flash']('info',{'msg':a1_0x4967('0x26')});_0x930cf5(_0x5d58ca,_0x1d4645);});});}});}else{User_1['default'][a1_0x4967('0xe')]({'facebook':_0x395e94['id']},(_0x3fa080,_0x3dab78)=>{if(_0x3fa080){return _0x930cf5(_0x3fa080);}if(_0x3dab78){return _0x930cf5(undefined,_0x3dab78);}User_1['default'][a1_0x4967('0xe')]({'email':_0x395e94[a1_0x4967('0x21')][a1_0x4967('0xd')]},(_0x3fa080,_0x1e07c1)=>{if(_0x3fa080){return _0x930cf5(_0x3fa080);}if(_0x1e07c1){_0xaffda[a1_0x4967('0x18')]('errors',{'msg':a1_0x4967('0x27')});_0x930cf5(_0x3fa080);}else{const _0xe12b2d=new User_1[(a1_0x4967('0x8'))]();_0xe12b2d[a1_0x4967('0xd')]=_0x395e94[a1_0x4967('0x21')][a1_0x4967('0xd')];_0xe12b2d['facebook']=_0x395e94['id'];_0xe12b2d['tokens'][a1_0x4967('0x1b')]({'kind':a1_0x4967('0x1c'),'accessToken':_0x5496eb});_0xe12b2d[a1_0x4967('0x1f')][a1_0x4967('0x1d')]=_0x395e94['name'][a1_0x4967('0x28')]+'\x20'+_0x395e94[a1_0x4967('0x1d')][a1_0x4967('0x1e')];_0xe12b2d[a1_0x4967('0x1f')][a1_0x4967('0x20')]=_0x395e94[a1_0x4967('0x21')][a1_0x4967('0x20')];_0xe12b2d['profile'][a1_0x4967('0x22')]='https://graph.facebook.com/'+_0x395e94['id']+a1_0x4967('0x24');_0xe12b2d[a1_0x4967('0x1f')]['location']=_0x395e94[a1_0x4967('0x21')][a1_0x4967('0x29')]?_0x395e94[a1_0x4967('0x21')][a1_0x4967('0x29')][a1_0x4967('0x1d')]:'';_0xe12b2d[a1_0x4967('0x25')](_0x3fa080=>{_0x930cf5(_0x3fa080,_0xe12b2d);});}});});}}));exports[a1_0x4967('0x2a')]=(_0x29b0ee,_0x11b5e5,_0x612bd0)=>{if(_0x29b0ee[a1_0x4967('0x2a')]()){return _0x612bd0();}_0x11b5e5[a1_0x4967('0x2b')](a1_0x4967('0x2c'));};exports['isAuthorized']=(_0x15cc9e,_0x29e44e,_0x3c6306)=>{const _0x367283=_0x15cc9e[a1_0x4967('0x2d')][a1_0x4967('0x2e')]('/')[a1_0x4967('0x2f')](-0x1)[0x0];if(lodash_1['default']['find'](_0x15cc9e['user'][a1_0x4967('0x30')],{'kind':_0x367283})){_0x3c6306();}else{_0x29e44e[a1_0x4967('0x2b')](a1_0x4967('0x31')+_0x367283);}};