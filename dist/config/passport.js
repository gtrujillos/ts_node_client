var a1_0x12ef=['https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','location','save','isAuthenticated','redirect','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','../models/User','default','Strategy','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','tokens','push','profile','name','givenName','familyName','gender','_json','picture'];(function(_0x21ee6f,_0x3e246b){var _0x4f7147=function(_0x2ca784){while(--_0x2ca784){_0x21ee6f['push'](_0x21ee6f['shift']());}};_0x4f7147(++_0x3e246b);}(a1_0x12ef,0x15f));var a1_0x146b=function(_0x45658b,_0xa6ed42){_0x45658b=_0x45658b-0x0;var _0x51c273=a1_0x12ef[_0x45658b];return _0x51c273;};'use strict';var __importDefault=this&&this[a1_0x146b('0x0')]||function(_0x551f32){return _0x551f32&&_0x551f32[a1_0x146b('0x1')]?_0x551f32:{'default':_0x551f32};};Object[a1_0x146b('0x2')](exports,a1_0x146b('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x146b('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x146b('0x4')));const LocalStrategy=passport_local_1[a1_0x146b('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1['default'][a1_0x146b('0x6')];passport_1[a1_0x146b('0x5')]['serializeUser']((_0x567e3a,_0x521221)=>{_0x521221(undefined,_0x567e3a['id']);});passport_1[a1_0x146b('0x5')]['deserializeUser']((_0x5919d2,_0x5ed64c)=>{User_1[a1_0x146b('0x5')]['findById'](_0x5919d2,(_0x37d445,_0x352c00)=>{_0x5ed64c(_0x37d445,_0x352c00);});});passport_1[a1_0x146b('0x5')][a1_0x146b('0x7')](new LocalStrategy({'usernameField':a1_0x146b('0x8')},(_0xe1afc3,_0x2b5fa3,_0x248ea5)=>{User_1[a1_0x146b('0x5')][a1_0x146b('0x9')]({'email':_0xe1afc3[a1_0x146b('0xa')]()},(_0x5c751d,_0x3d6610)=>{if(_0x5c751d){return _0x248ea5(_0x5c751d);}if(!_0x3d6610){return _0x248ea5(undefined,![],{'message':a1_0x146b('0xb')+_0xe1afc3+a1_0x146b('0xc')});}_0x3d6610['comparePassword'](_0x2b5fa3,(_0x5c751d,_0x391b41)=>{if(_0x5c751d){return _0x248ea5(_0x5c751d);}if(_0x391b41){return _0x248ea5(undefined,_0x3d6610);}return _0x248ea5(undefined,![],{'message':a1_0x146b('0xd')});});});}));passport_1[a1_0x146b('0x5')][a1_0x146b('0x7')](new FacebookStrategy({'clientID':process[a1_0x146b('0xe')][a1_0x146b('0xf')],'clientSecret':process['env'][a1_0x146b('0x10')],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x146b('0x8'),a1_0x146b('0x11'),a1_0x146b('0x12'),a1_0x146b('0x13')],'passReqToCallback':!![]},(_0x25ac4e,_0x2451f3,_0x52c776,_0x1426f3,_0x4d3a73)=>{if(_0x25ac4e['user']){User_1['default'][a1_0x146b('0x9')]({'facebook':_0x1426f3['id']},(_0x3b10ae,_0x53ad4f)=>{if(_0x3b10ae){return _0x4d3a73(_0x3b10ae);}if(_0x53ad4f){_0x25ac4e[a1_0x146b('0x14')](a1_0x146b('0x15'),{'msg':a1_0x146b('0x16')});_0x4d3a73(_0x3b10ae);}else{User_1[a1_0x146b('0x5')]['findById'](_0x25ac4e[a1_0x146b('0x17')]['id'],(_0x3b10ae,_0x1b9120)=>{if(_0x3b10ae){return _0x4d3a73(_0x3b10ae);}_0x1b9120['facebook']=_0x1426f3['id'];_0x1b9120[a1_0x146b('0x18')][a1_0x146b('0x19')]({'kind':'facebook','accessToken':_0x2451f3});_0x1b9120['profile']['name']=_0x1b9120[a1_0x146b('0x1a')][a1_0x146b('0x1b')]||_0x1426f3[a1_0x146b('0x1b')][a1_0x146b('0x1c')]+'\x20'+_0x1426f3[a1_0x146b('0x1b')][a1_0x146b('0x1d')];_0x1b9120['profile'][a1_0x146b('0x1e')]=_0x1b9120[a1_0x146b('0x1a')][a1_0x146b('0x1e')]||_0x1426f3[a1_0x146b('0x1f')][a1_0x146b('0x1e')];_0x1b9120[a1_0x146b('0x1a')][a1_0x146b('0x20')]=_0x1b9120['profile']['picture']||a1_0x146b('0x21')+_0x1426f3['id']+a1_0x146b('0x22');_0x1b9120['save'](_0x3b10ae=>{_0x25ac4e['flash'](a1_0x146b('0x23'),{'msg':a1_0x146b('0x24')});_0x4d3a73(_0x3b10ae,_0x1b9120);});});}});}else{User_1['default'][a1_0x146b('0x9')]({'facebook':_0x1426f3['id']},(_0x3cd445,_0x29d8a0)=>{if(_0x3cd445){return _0x4d3a73(_0x3cd445);}if(_0x29d8a0){return _0x4d3a73(undefined,_0x29d8a0);}User_1[a1_0x146b('0x5')][a1_0x146b('0x9')]({'email':_0x1426f3[a1_0x146b('0x1f')]['email']},(_0x3cd445,_0x11b805)=>{if(_0x3cd445){return _0x4d3a73(_0x3cd445);}if(_0x11b805){_0x25ac4e[a1_0x146b('0x14')](a1_0x146b('0x15'),{'msg':a1_0x146b('0x25')});_0x4d3a73(_0x3cd445);}else{const _0x2c45e3=new User_1[(a1_0x146b('0x5'))]();_0x2c45e3[a1_0x146b('0x8')]=_0x1426f3[a1_0x146b('0x1f')][a1_0x146b('0x8')];_0x2c45e3[a1_0x146b('0x26')]=_0x1426f3['id'];_0x2c45e3[a1_0x146b('0x18')][a1_0x146b('0x19')]({'kind':a1_0x146b('0x26'),'accessToken':_0x2451f3});_0x2c45e3[a1_0x146b('0x1a')][a1_0x146b('0x1b')]=_0x1426f3[a1_0x146b('0x1b')][a1_0x146b('0x1c')]+'\x20'+_0x1426f3[a1_0x146b('0x1b')][a1_0x146b('0x1d')];_0x2c45e3['profile'][a1_0x146b('0x1e')]=_0x1426f3[a1_0x146b('0x1f')][a1_0x146b('0x1e')];_0x2c45e3[a1_0x146b('0x1a')][a1_0x146b('0x20')]='https://graph.facebook.com/'+_0x1426f3['id']+a1_0x146b('0x22');_0x2c45e3[a1_0x146b('0x1a')][a1_0x146b('0x27')]=_0x1426f3['_json'][a1_0x146b('0x27')]?_0x1426f3[a1_0x146b('0x1f')]['location'][a1_0x146b('0x1b')]:'';_0x2c45e3[a1_0x146b('0x28')](_0x3cd445=>{_0x4d3a73(_0x3cd445,_0x2c45e3);});}});});}}));exports['isAuthenticated']=(_0x516ba0,_0x41cd00,_0x285a2e)=>{if(_0x516ba0[a1_0x146b('0x29')]()){return _0x285a2e();}_0x41cd00[a1_0x146b('0x2a')]('/login');};exports['isAuthorized']=(_0x471696,_0x17d959,_0x4025d1)=>{const _0x228959=_0x471696[a1_0x146b('0x2b')][a1_0x146b('0x2c')]('/')[a1_0x146b('0x2d')](-0x1)[0x0];if(lodash_1['default'][a1_0x146b('0x2e')](_0x471696[a1_0x146b('0x17')][a1_0x146b('0x18')],{'kind':_0x228959})){_0x4025d1();}else{_0x17d959[a1_0x146b('0x2a')](a1_0x146b('0x2f')+_0x228959);}};