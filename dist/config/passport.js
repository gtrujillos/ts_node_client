var a1_0xc7a7=['passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','tokens','profile','givenName','familyName','gender','_json','picture','save','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','/login','isAuthorized','path','slice','find','/auth/','__importDefault','__esModule','passport-local'];(function(_0x2b351e,_0x56b0c7){var _0x1d438b=function(_0x2e2d67){while(--_0x2e2d67){_0x2b351e['push'](_0x2b351e['shift']());}};_0x1d438b(++_0x56b0c7);}(a1_0xc7a7,0x146));var a1_0x4f15=function(_0x2f6a6d,_0x3fd576){_0x2f6a6d=_0x2f6a6d-0x0;var _0xc1ff25=a1_0xc7a7[_0x2f6a6d];return _0xc1ff25;};'use strict';var __importDefault=this&&this[a1_0x4f15('0x0')]||function(_0x276d83){return _0x276d83&&_0x276d83[a1_0x4f15('0x1')]?_0x276d83:{'default':_0x276d83};};Object['defineProperty'](exports,a1_0x4f15('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x4f15('0x2')));const passport_facebook_1=__importDefault(require(a1_0x4f15('0x3')));const lodash_1=__importDefault(require(a1_0x4f15('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x4f15('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x4f15('0x5')][a1_0x4f15('0x6')];passport_1[a1_0x4f15('0x5')][a1_0x4f15('0x7')]((_0x113361,_0x4f0311)=>{_0x4f0311(undefined,_0x113361['id']);});passport_1[a1_0x4f15('0x5')][a1_0x4f15('0x8')]((_0x52a1a4,_0xdc0a2a)=>{User_1[a1_0x4f15('0x5')][a1_0x4f15('0x9')](_0x52a1a4,(_0x4c78b8,_0xebcd6)=>{_0xdc0a2a(_0x4c78b8,_0xebcd6);});});passport_1[a1_0x4f15('0x5')][a1_0x4f15('0xa')](new LocalStrategy({'usernameField':a1_0x4f15('0xb')},(_0x4c0ed9,_0x816c75,_0x213689)=>{User_1[a1_0x4f15('0x5')][a1_0x4f15('0xc')]({'email':_0x4c0ed9[a1_0x4f15('0xd')]()},(_0xe2aad1,_0x30ab30)=>{if(_0xe2aad1){return _0x213689(_0xe2aad1);}if(!_0x30ab30){return _0x213689(undefined,![],{'message':a1_0x4f15('0xe')+_0x4c0ed9+a1_0x4f15('0xf')});}_0x30ab30[a1_0x4f15('0x10')](_0x816c75,(_0xe2aad1,_0x4937d1)=>{if(_0xe2aad1){return _0x213689(_0xe2aad1);}if(_0x4937d1){return _0x213689(undefined,_0x30ab30);}return _0x213689(undefined,![],{'message':a1_0x4f15('0x11')});});});}));passport_1[a1_0x4f15('0x5')][a1_0x4f15('0xa')](new FacebookStrategy({'clientID':process[a1_0x4f15('0x12')]['FACEBOOK_ID'],'clientSecret':process[a1_0x4f15('0x12')][a1_0x4f15('0x13')],'callbackURL':a1_0x4f15('0x14'),'profileFields':[a1_0x4f15('0x15'),a1_0x4f15('0xb'),a1_0x4f15('0x16'),a1_0x4f15('0x17'),a1_0x4f15('0x18')],'passReqToCallback':!![]},(_0x46c193,_0x12eb94,_0x458070,_0x5a181e,_0x467893)=>{if(_0x46c193['user']){User_1[a1_0x4f15('0x5')][a1_0x4f15('0xc')]({'facebook':_0x5a181e['id']},(_0x3149c7,_0x2eaa09)=>{if(_0x3149c7){return _0x467893(_0x3149c7);}if(_0x2eaa09){_0x46c193[a1_0x4f15('0x19')](a1_0x4f15('0x1a'),{'msg':a1_0x4f15('0x1b')});_0x467893(_0x3149c7);}else{User_1['default'][a1_0x4f15('0x9')](_0x46c193[a1_0x4f15('0x1c')]['id'],(_0x3149c7,_0x2f124a)=>{if(_0x3149c7){return _0x467893(_0x3149c7);}_0x2f124a[a1_0x4f15('0x1d')]=_0x5a181e['id'];_0x2f124a[a1_0x4f15('0x1e')]['push']({'kind':a1_0x4f15('0x1d'),'accessToken':_0x12eb94});_0x2f124a[a1_0x4f15('0x1f')][a1_0x4f15('0x15')]=_0x2f124a[a1_0x4f15('0x1f')][a1_0x4f15('0x15')]||_0x5a181e[a1_0x4f15('0x15')][a1_0x4f15('0x20')]+'\x20'+_0x5a181e[a1_0x4f15('0x15')][a1_0x4f15('0x21')];_0x2f124a['profile'][a1_0x4f15('0x22')]=_0x2f124a[a1_0x4f15('0x1f')]['gender']||_0x5a181e[a1_0x4f15('0x23')][a1_0x4f15('0x22')];_0x2f124a['profile'][a1_0x4f15('0x24')]=_0x2f124a[a1_0x4f15('0x1f')][a1_0x4f15('0x24')]||'https://graph.facebook.com/'+_0x5a181e['id']+'/picture?type=large';_0x2f124a[a1_0x4f15('0x25')](_0x3149c7=>{_0x46c193[a1_0x4f15('0x19')]('info',{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x467893(_0x3149c7,_0x2f124a);});});}});}else{User_1['default'][a1_0x4f15('0xc')]({'facebook':_0x5a181e['id']},(_0x743e42,_0x32233b)=>{if(_0x743e42){return _0x467893(_0x743e42);}if(_0x32233b){return _0x467893(undefined,_0x32233b);}User_1[a1_0x4f15('0x5')]['findOne']({'email':_0x5a181e['_json'][a1_0x4f15('0xb')]},(_0x743e42,_0x3d3429)=>{if(_0x743e42){return _0x467893(_0x743e42);}if(_0x3d3429){_0x46c193[a1_0x4f15('0x19')](a1_0x4f15('0x1a'),{'msg':a1_0x4f15('0x26')});_0x467893(_0x743e42);}else{const _0x896dfa=new User_1['default']();_0x896dfa[a1_0x4f15('0xb')]=_0x5a181e[a1_0x4f15('0x23')][a1_0x4f15('0xb')];_0x896dfa['facebook']=_0x5a181e['id'];_0x896dfa['tokens']['push']({'kind':a1_0x4f15('0x1d'),'accessToken':_0x12eb94});_0x896dfa[a1_0x4f15('0x1f')][a1_0x4f15('0x15')]=_0x5a181e[a1_0x4f15('0x15')]['givenName']+'\x20'+_0x5a181e[a1_0x4f15('0x15')][a1_0x4f15('0x21')];_0x896dfa['profile'][a1_0x4f15('0x22')]=_0x5a181e[a1_0x4f15('0x23')]['gender'];_0x896dfa['profile']['picture']='https://graph.facebook.com/'+_0x5a181e['id']+'/picture?type=large';_0x896dfa[a1_0x4f15('0x1f')][a1_0x4f15('0x27')]=_0x5a181e[a1_0x4f15('0x23')]['location']?_0x5a181e[a1_0x4f15('0x23')][a1_0x4f15('0x27')][a1_0x4f15('0x15')]:'';_0x896dfa[a1_0x4f15('0x25')](_0x743e42=>{_0x467893(_0x743e42,_0x896dfa);});}});});}}));exports[a1_0x4f15('0x28')]=(_0x17961a,_0xdd2dd8,_0x891a19)=>{if(_0x17961a[a1_0x4f15('0x28')]()){return _0x891a19();}_0xdd2dd8['redirect'](a1_0x4f15('0x29'));};exports[a1_0x4f15('0x2a')]=(_0x4a7f32,_0x4f0895,_0x5c2a65)=>{const _0x1a5681=_0x4a7f32[a1_0x4f15('0x2b')]['split']('/')[a1_0x4f15('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x4f15('0x5')][a1_0x4f15('0x2d')](_0x4a7f32[a1_0x4f15('0x1c')][a1_0x4f15('0x1e')],{'kind':_0x1a5681})){_0x5c2a65();}else{_0x4f0895['redirect'](a1_0x4f15('0x2e')+_0x1a5681);}};