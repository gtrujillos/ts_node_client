var a1_0x5b94=['locale','timezone','flash','errors','user','facebook','tokens','profile','givenName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','_json','email','push','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','defineProperty','__esModule','passport','passport-local','passport-facebook','lodash','Strategy','default','serializeUser','deserializeUser','findById','findOne','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name'];(function(_0x431ebe,_0x47a036){var _0x289b7c=function(_0x17f8ab){while(--_0x17f8ab){_0x431ebe['push'](_0x431ebe['shift']());}};_0x289b7c(++_0x47a036);}(a1_0x5b94,0x84));var a1_0x240b=function(_0x1809f0,_0x11db59){_0x1809f0=_0x1809f0-0x0;var _0x122861=a1_0x5b94[_0x1809f0];return _0x122861;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2cd264){return _0x2cd264&&_0x2cd264['__esModule']?_0x2cd264:{'default':_0x2cd264};};Object[a1_0x240b('0x0')](exports,a1_0x240b('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x240b('0x2')));const passport_local_1=__importDefault(require(a1_0x240b('0x3')));const passport_facebook_1=__importDefault(require(a1_0x240b('0x4')));const lodash_1=__importDefault(require(a1_0x240b('0x5')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default'][a1_0x240b('0x6')];const FacebookStrategy=passport_facebook_1['default'][a1_0x240b('0x6')];passport_1[a1_0x240b('0x7')][a1_0x240b('0x8')]((_0x3b7ea6,_0x26e61f)=>{_0x26e61f(undefined,_0x3b7ea6['id']);});passport_1[a1_0x240b('0x7')][a1_0x240b('0x9')]((_0x4ed44e,_0x834ad7)=>{User_1[a1_0x240b('0x7')][a1_0x240b('0xa')](_0x4ed44e,(_0x2e92b1,_0xdd7d62)=>{_0x834ad7(_0x2e92b1,_0xdd7d62);});});passport_1[a1_0x240b('0x7')]['use'](new LocalStrategy({'usernameField':'email'},(_0x5d6b4c,_0x365432,_0x276dbb)=>{User_1['default'][a1_0x240b('0xb')]({'email':_0x5d6b4c[a1_0x240b('0xc')]()},(_0xb84a58,_0x10ce83)=>{if(_0xb84a58){return _0x276dbb(_0xb84a58);}if(!_0x10ce83){return _0x276dbb(undefined,![],{'message':'Email\x20'+_0x5d6b4c+a1_0x240b('0xd')});}_0x10ce83[a1_0x240b('0xe')](_0x365432,(_0xb84a58,_0x14b905)=>{if(_0xb84a58){return _0x276dbb(_0xb84a58);}if(_0x14b905){return _0x276dbb(undefined,_0x10ce83);}return _0x276dbb(undefined,![],{'message':a1_0x240b('0xf')});});});}));passport_1[a1_0x240b('0x7')][a1_0x240b('0x10')](new FacebookStrategy({'clientID':process['env'][a1_0x240b('0x11')],'clientSecret':process['env'][a1_0x240b('0x12')],'callbackURL':a1_0x240b('0x13'),'profileFields':[a1_0x240b('0x14'),'email','link',a1_0x240b('0x15'),a1_0x240b('0x16')],'passReqToCallback':!![]},(_0x5f5831,_0x37ebec,_0x11145d,_0x37d385,_0xc90292)=>{if(_0x5f5831['user']){User_1[a1_0x240b('0x7')][a1_0x240b('0xb')]({'facebook':_0x37d385['id']},(_0x4fe696,_0x10223d)=>{if(_0x4fe696){return _0xc90292(_0x4fe696);}if(_0x10223d){_0x5f5831[a1_0x240b('0x17')](a1_0x240b('0x18'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0xc90292(_0x4fe696);}else{User_1[a1_0x240b('0x7')][a1_0x240b('0xa')](_0x5f5831[a1_0x240b('0x19')]['id'],(_0x4fe696,_0x180427)=>{if(_0x4fe696){return _0xc90292(_0x4fe696);}_0x180427[a1_0x240b('0x1a')]=_0x37d385['id'];_0x180427[a1_0x240b('0x1b')]['push']({'kind':a1_0x240b('0x1a'),'accessToken':_0x37ebec});_0x180427[a1_0x240b('0x1c')][a1_0x240b('0x14')]=_0x180427[a1_0x240b('0x1c')][a1_0x240b('0x14')]||_0x37d385['name'][a1_0x240b('0x1d')]+'\x20'+_0x37d385[a1_0x240b('0x14')]['familyName'];_0x180427['profile'][a1_0x240b('0x1e')]=_0x180427[a1_0x240b('0x1c')][a1_0x240b('0x1e')]||_0x37d385['_json']['gender'];_0x180427['profile'][a1_0x240b('0x1f')]=_0x180427['profile'][a1_0x240b('0x1f')]||a1_0x240b('0x20')+_0x37d385['id']+a1_0x240b('0x21');_0x180427[a1_0x240b('0x22')](_0x4fe696=>{_0x5f5831[a1_0x240b('0x17')](a1_0x240b('0x23'),{'msg':a1_0x240b('0x24')});_0xc90292(_0x4fe696,_0x180427);});});}});}else{User_1[a1_0x240b('0x7')][a1_0x240b('0xb')]({'facebook':_0x37d385['id']},(_0x491821,_0x51cf5f)=>{if(_0x491821){return _0xc90292(_0x491821);}if(_0x51cf5f){return _0xc90292(undefined,_0x51cf5f);}User_1[a1_0x240b('0x7')][a1_0x240b('0xb')]({'email':_0x37d385[a1_0x240b('0x25')]['email']},(_0x491821,_0x197409)=>{if(_0x491821){return _0xc90292(_0x491821);}if(_0x197409){_0x5f5831[a1_0x240b('0x17')](a1_0x240b('0x18'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0xc90292(_0x491821);}else{const _0x41cef9=new User_1[(a1_0x240b('0x7'))]();_0x41cef9[a1_0x240b('0x26')]=_0x37d385['_json'][a1_0x240b('0x26')];_0x41cef9['facebook']=_0x37d385['id'];_0x41cef9[a1_0x240b('0x1b')][a1_0x240b('0x27')]({'kind':'facebook','accessToken':_0x37ebec});_0x41cef9['profile'][a1_0x240b('0x14')]=_0x37d385['name'][a1_0x240b('0x1d')]+'\x20'+_0x37d385[a1_0x240b('0x14')][a1_0x240b('0x28')];_0x41cef9['profile'][a1_0x240b('0x1e')]=_0x37d385[a1_0x240b('0x25')][a1_0x240b('0x1e')];_0x41cef9[a1_0x240b('0x1c')][a1_0x240b('0x1f')]=a1_0x240b('0x20')+_0x37d385['id']+'/picture?type=large';_0x41cef9[a1_0x240b('0x1c')]['location']=_0x37d385[a1_0x240b('0x25')][a1_0x240b('0x29')]?_0x37d385[a1_0x240b('0x25')][a1_0x240b('0x29')][a1_0x240b('0x14')]:'';_0x41cef9[a1_0x240b('0x22')](_0x491821=>{_0xc90292(_0x491821,_0x41cef9);});}});});}}));exports[a1_0x240b('0x2a')]=(_0x3f4047,_0x3240a2,_0x3e7347)=>{if(_0x3f4047[a1_0x240b('0x2a')]()){return _0x3e7347();}_0x3240a2[a1_0x240b('0x2b')](a1_0x240b('0x2c'));};exports[a1_0x240b('0x2d')]=(_0x3dbfd6,_0x7a8ba3,_0x496350)=>{const _0x57d995=_0x3dbfd6[a1_0x240b('0x2e')][a1_0x240b('0x2f')]('/')[a1_0x240b('0x30')](-0x1)[0x0];if(lodash_1[a1_0x240b('0x7')][a1_0x240b('0x31')](_0x3dbfd6[a1_0x240b('0x19')][a1_0x240b('0x1b')],{'kind':_0x57d995})){_0x496350();}else{_0x7a8ba3[a1_0x240b('0x2b')](a1_0x240b('0x32')+_0x57d995);}};