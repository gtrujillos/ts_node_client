var a1_0x11b2=['https://graph.facebook.com/','/picture?type=large','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','familyName','location','save','isAuthenticated','/login','isAuthorized','path','slice','find','redirect','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','facebook','profile','givenName','gender','_json','picture'];(function(_0x269dc5,_0x313bd9){var _0x52cea7=function(_0x2f5d9d){while(--_0x2f5d9d){_0x269dc5['push'](_0x269dc5['shift']());}};_0x52cea7(++_0x313bd9);}(a1_0x11b2,0x119));var a1_0x19ca=function(_0x414855,_0x159890){_0x414855=_0x414855-0x0;var _0x2c29a3=a1_0x11b2[_0x414855];return _0x2c29a3;};'use strict';var __importDefault=this&&this[a1_0x19ca('0x0')]||function(_0x3311cc){return _0x3311cc&&_0x3311cc[a1_0x19ca('0x1')]?_0x3311cc:{'default':_0x3311cc};};Object[a1_0x19ca('0x2')](exports,a1_0x19ca('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x19ca('0x3')));const passport_local_1=__importDefault(require(a1_0x19ca('0x4')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x19ca('0x5')));const User_1=__importDefault(require(a1_0x19ca('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x19ca('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x19ca('0x8')][a1_0x19ca('0x7')];passport_1[a1_0x19ca('0x8')][a1_0x19ca('0x9')]((_0x273f6d,_0x352abb)=>{_0x352abb(undefined,_0x273f6d['id']);});passport_1[a1_0x19ca('0x8')][a1_0x19ca('0xa')]((_0xf02c00,_0x1957d3)=>{User_1[a1_0x19ca('0x8')][a1_0x19ca('0xb')](_0xf02c00,(_0x39c5d7,_0x39b1d7)=>{_0x1957d3(_0x39c5d7,_0x39b1d7);});});passport_1[a1_0x19ca('0x8')][a1_0x19ca('0xc')](new LocalStrategy({'usernameField':a1_0x19ca('0xd')},(_0x513d24,_0xa2c91c,_0x4e9239)=>{User_1[a1_0x19ca('0x8')][a1_0x19ca('0xe')]({'email':_0x513d24[a1_0x19ca('0xf')]()},(_0x35034e,_0x46c37a)=>{if(_0x35034e){return _0x4e9239(_0x35034e);}if(!_0x46c37a){return _0x4e9239(undefined,![],{'message':a1_0x19ca('0x10')+_0x513d24+'\x20not\x20found.'});}_0x46c37a[a1_0x19ca('0x11')](_0xa2c91c,(_0x35034e,_0x6ac787)=>{if(_0x35034e){return _0x4e9239(_0x35034e);}if(_0x6ac787){return _0x4e9239(undefined,_0x46c37a);}return _0x4e9239(undefined,![],{'message':a1_0x19ca('0x12')});});});}));passport_1[a1_0x19ca('0x8')]['use'](new FacebookStrategy({'clientID':process[a1_0x19ca('0x13')][a1_0x19ca('0x14')],'clientSecret':process[a1_0x19ca('0x13')][a1_0x19ca('0x15')],'callbackURL':a1_0x19ca('0x16'),'profileFields':[a1_0x19ca('0x17'),a1_0x19ca('0xd'),a1_0x19ca('0x18'),a1_0x19ca('0x19'),'timezone'],'passReqToCallback':!![]},(_0x365483,_0x1a4c82,_0x185cd2,_0x3f1070,_0x1c736d)=>{if(_0x365483[a1_0x19ca('0x1a')]){User_1[a1_0x19ca('0x8')]['findOne']({'facebook':_0x3f1070['id']},(_0x3c3257,_0x2ab5ee)=>{if(_0x3c3257){return _0x1c736d(_0x3c3257);}if(_0x2ab5ee){_0x365483[a1_0x19ca('0x1b')](a1_0x19ca('0x1c'),{'msg':a1_0x19ca('0x1d')});_0x1c736d(_0x3c3257);}else{User_1[a1_0x19ca('0x8')][a1_0x19ca('0xb')](_0x365483['user']['id'],(_0x3c3257,_0x1368d4)=>{if(_0x3c3257){return _0x1c736d(_0x3c3257);}_0x1368d4['facebook']=_0x3f1070['id'];_0x1368d4[a1_0x19ca('0x1e')]['push']({'kind':a1_0x19ca('0x1f'),'accessToken':_0x1a4c82});_0x1368d4['profile'][a1_0x19ca('0x17')]=_0x1368d4[a1_0x19ca('0x20')]['name']||_0x3f1070['name'][a1_0x19ca('0x21')]+'\x20'+_0x3f1070['name']['familyName'];_0x1368d4['profile'][a1_0x19ca('0x22')]=_0x1368d4[a1_0x19ca('0x20')][a1_0x19ca('0x22')]||_0x3f1070[a1_0x19ca('0x23')]['gender'];_0x1368d4[a1_0x19ca('0x20')]['picture']=_0x1368d4[a1_0x19ca('0x20')][a1_0x19ca('0x24')]||a1_0x19ca('0x25')+_0x3f1070['id']+a1_0x19ca('0x26');_0x1368d4['save'](_0x3c3257=>{_0x365483['flash'](a1_0x19ca('0x27'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x1c736d(_0x3c3257,_0x1368d4);});});}});}else{User_1[a1_0x19ca('0x8')][a1_0x19ca('0xe')]({'facebook':_0x3f1070['id']},(_0x4644a4,_0x47181d)=>{if(_0x4644a4){return _0x1c736d(_0x4644a4);}if(_0x47181d){return _0x1c736d(undefined,_0x47181d);}User_1[a1_0x19ca('0x8')][a1_0x19ca('0xe')]({'email':_0x3f1070[a1_0x19ca('0x23')]['email']},(_0x4644a4,_0x104129)=>{if(_0x4644a4){return _0x1c736d(_0x4644a4);}if(_0x104129){_0x365483[a1_0x19ca('0x1b')](a1_0x19ca('0x1c'),{'msg':a1_0x19ca('0x28')});_0x1c736d(_0x4644a4);}else{const _0x4996b2=new User_1[(a1_0x19ca('0x8'))]();_0x4996b2['email']=_0x3f1070['_json'][a1_0x19ca('0xd')];_0x4996b2[a1_0x19ca('0x1f')]=_0x3f1070['id'];_0x4996b2['tokens'][a1_0x19ca('0x29')]({'kind':a1_0x19ca('0x1f'),'accessToken':_0x1a4c82});_0x4996b2[a1_0x19ca('0x20')][a1_0x19ca('0x17')]=_0x3f1070[a1_0x19ca('0x17')][a1_0x19ca('0x21')]+'\x20'+_0x3f1070[a1_0x19ca('0x17')][a1_0x19ca('0x2a')];_0x4996b2[a1_0x19ca('0x20')][a1_0x19ca('0x22')]=_0x3f1070['_json']['gender'];_0x4996b2['profile'][a1_0x19ca('0x24')]=a1_0x19ca('0x25')+_0x3f1070['id']+'/picture?type=large';_0x4996b2[a1_0x19ca('0x20')][a1_0x19ca('0x2b')]=_0x3f1070[a1_0x19ca('0x23')][a1_0x19ca('0x2b')]?_0x3f1070[a1_0x19ca('0x23')][a1_0x19ca('0x2b')][a1_0x19ca('0x17')]:'';_0x4996b2[a1_0x19ca('0x2c')](_0x4644a4=>{_0x1c736d(_0x4644a4,_0x4996b2);});}});});}}));exports[a1_0x19ca('0x2d')]=(_0x558b83,_0x3344a5,_0x153f14)=>{if(_0x558b83['isAuthenticated']()){return _0x153f14();}_0x3344a5['redirect'](a1_0x19ca('0x2e'));};exports[a1_0x19ca('0x2f')]=(_0x4dc7f4,_0x3dc5e6,_0x1a13c2)=>{const _0x53a572=_0x4dc7f4[a1_0x19ca('0x30')]['split']('/')[a1_0x19ca('0x31')](-0x1)[0x0];if(lodash_1[a1_0x19ca('0x8')][a1_0x19ca('0x32')](_0x4dc7f4[a1_0x19ca('0x1a')]['tokens'],{'kind':_0x53a572})){_0x1a13c2();}else{_0x3dc5e6[a1_0x19ca('0x33')](a1_0x19ca('0x34')+_0x53a572);}};