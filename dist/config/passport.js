var a1_0x3c29=['facebook','tokens','push','profile','givenName','gender','_json','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','familyName','picture','location','isAuthenticated','redirect','/login','path','split','slice','find','user','__importDefault','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','deserializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'];(function(_0x1ce3ff,_0x50f341){var _0x31cb44=function(_0x548ee1){while(--_0x548ee1){_0x1ce3ff['push'](_0x1ce3ff['shift']());}};_0x31cb44(++_0x50f341);}(a1_0x3c29,0xd8));var a1_0x3f70=function(_0x71f8a5,_0x158692){_0x71f8a5=_0x71f8a5-0x0;var _0x386439=a1_0x3c29[_0x71f8a5];return _0x386439;};'use strict';var __importDefault=this&&this[a1_0x3f70('0x0')]||function(_0x3274b8){return _0x3274b8&&_0x3274b8[a1_0x3f70('0x1')]?_0x3274b8:{'default':_0x3274b8};};Object['defineProperty'](exports,a1_0x3f70('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3f70('0x2')));const passport_local_1=__importDefault(require(a1_0x3f70('0x3')));const passport_facebook_1=__importDefault(require(a1_0x3f70('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x3f70('0x5')));const LocalStrategy=passport_local_1[a1_0x3f70('0x6')][a1_0x3f70('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x3f70('0x6')][a1_0x3f70('0x7')];passport_1[a1_0x3f70('0x6')]['serializeUser']((_0x24f6c5,_0xa7e063)=>{_0xa7e063(undefined,_0x24f6c5['id']);});passport_1['default'][a1_0x3f70('0x8')]((_0x205df8,_0x127587)=>{User_1['default'][a1_0x3f70('0x9')](_0x205df8,(_0x298a2b,_0xbae28c)=>{_0x127587(_0x298a2b,_0xbae28c);});});passport_1[a1_0x3f70('0x6')][a1_0x3f70('0xa')](new LocalStrategy({'usernameField':a1_0x3f70('0xb')},(_0x33f46d,_0x408442,_0x58a3fd)=>{User_1['default'][a1_0x3f70('0xc')]({'email':_0x33f46d['toLowerCase']()},(_0x4283be,_0x3242a8)=>{if(_0x4283be){return _0x58a3fd(_0x4283be);}if(!_0x3242a8){return _0x58a3fd(undefined,![],{'message':a1_0x3f70('0xd')+_0x33f46d+a1_0x3f70('0xe')});}_0x3242a8['comparePassword'](_0x408442,(_0x4283be,_0x544511)=>{if(_0x4283be){return _0x58a3fd(_0x4283be);}if(_0x544511){return _0x58a3fd(undefined,_0x3242a8);}return _0x58a3fd(undefined,![],{'message':a1_0x3f70('0xf')});});});}));passport_1[a1_0x3f70('0x6')][a1_0x3f70('0xa')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x3f70('0x10')],'callbackURL':a1_0x3f70('0x11'),'profileFields':[a1_0x3f70('0x12'),a1_0x3f70('0xb'),'link',a1_0x3f70('0x13'),a1_0x3f70('0x14')],'passReqToCallback':!![]},(_0x432967,_0x4f20ca,_0x1af31c,_0x386f3d,_0x5086cb)=>{if(_0x432967['user']){User_1[a1_0x3f70('0x6')][a1_0x3f70('0xc')]({'facebook':_0x386f3d['id']},(_0x26936e,_0x78076f)=>{if(_0x26936e){return _0x5086cb(_0x26936e);}if(_0x78076f){_0x432967[a1_0x3f70('0x15')](a1_0x3f70('0x16'),{'msg':a1_0x3f70('0x17')});_0x5086cb(_0x26936e);}else{User_1[a1_0x3f70('0x6')][a1_0x3f70('0x9')](_0x432967['user']['id'],(_0x26936e,_0x2958a8)=>{if(_0x26936e){return _0x5086cb(_0x26936e);}_0x2958a8[a1_0x3f70('0x18')]=_0x386f3d['id'];_0x2958a8[a1_0x3f70('0x19')][a1_0x3f70('0x1a')]({'kind':'facebook','accessToken':_0x4f20ca});_0x2958a8[a1_0x3f70('0x1b')]['name']=_0x2958a8[a1_0x3f70('0x1b')][a1_0x3f70('0x12')]||_0x386f3d['name'][a1_0x3f70('0x1c')]+'\x20'+_0x386f3d[a1_0x3f70('0x12')]['familyName'];_0x2958a8[a1_0x3f70('0x1b')][a1_0x3f70('0x1d')]=_0x2958a8[a1_0x3f70('0x1b')][a1_0x3f70('0x1d')]||_0x386f3d[a1_0x3f70('0x1e')][a1_0x3f70('0x1d')];_0x2958a8[a1_0x3f70('0x1b')]['picture']=_0x2958a8[a1_0x3f70('0x1b')]['picture']||a1_0x3f70('0x1f')+_0x386f3d['id']+a1_0x3f70('0x20');_0x2958a8[a1_0x3f70('0x21')](_0x26936e=>{_0x432967[a1_0x3f70('0x15')](a1_0x3f70('0x22'),{'msg':a1_0x3f70('0x23')});_0x5086cb(_0x26936e,_0x2958a8);});});}});}else{User_1[a1_0x3f70('0x6')][a1_0x3f70('0xc')]({'facebook':_0x386f3d['id']},(_0x5ae031,_0x651410)=>{if(_0x5ae031){return _0x5086cb(_0x5ae031);}if(_0x651410){return _0x5086cb(undefined,_0x651410);}User_1['default'][a1_0x3f70('0xc')]({'email':_0x386f3d[a1_0x3f70('0x1e')][a1_0x3f70('0xb')]},(_0x5ae031,_0x1ed07a)=>{if(_0x5ae031){return _0x5086cb(_0x5ae031);}if(_0x1ed07a){_0x432967['flash'](a1_0x3f70('0x16'),{'msg':a1_0x3f70('0x24')});_0x5086cb(_0x5ae031);}else{const _0x5d11ba=new User_1['default']();_0x5d11ba[a1_0x3f70('0xb')]=_0x386f3d[a1_0x3f70('0x1e')][a1_0x3f70('0xb')];_0x5d11ba['facebook']=_0x386f3d['id'];_0x5d11ba['tokens'][a1_0x3f70('0x1a')]({'kind':'facebook','accessToken':_0x4f20ca});_0x5d11ba[a1_0x3f70('0x1b')]['name']=_0x386f3d[a1_0x3f70('0x12')]['givenName']+'\x20'+_0x386f3d[a1_0x3f70('0x12')][a1_0x3f70('0x25')];_0x5d11ba['profile'][a1_0x3f70('0x1d')]=_0x386f3d[a1_0x3f70('0x1e')][a1_0x3f70('0x1d')];_0x5d11ba[a1_0x3f70('0x1b')][a1_0x3f70('0x26')]=a1_0x3f70('0x1f')+_0x386f3d['id']+a1_0x3f70('0x20');_0x5d11ba[a1_0x3f70('0x1b')][a1_0x3f70('0x27')]=_0x386f3d['_json'][a1_0x3f70('0x27')]?_0x386f3d[a1_0x3f70('0x1e')][a1_0x3f70('0x27')][a1_0x3f70('0x12')]:'';_0x5d11ba[a1_0x3f70('0x21')](_0x5ae031=>{_0x5086cb(_0x5ae031,_0x5d11ba);});}});});}}));exports['isAuthenticated']=(_0x31a2d1,_0x12f6a9,_0xaae8d)=>{if(_0x31a2d1[a1_0x3f70('0x28')]()){return _0xaae8d();}_0x12f6a9[a1_0x3f70('0x29')](a1_0x3f70('0x2a'));};exports['isAuthorized']=(_0x3b4a3c,_0x5e687b,_0x51ded8)=>{const _0x5029e7=_0x3b4a3c[a1_0x3f70('0x2b')][a1_0x3f70('0x2c')]('/')[a1_0x3f70('0x2d')](-0x1)[0x0];if(lodash_1[a1_0x3f70('0x6')][a1_0x3f70('0x2e')](_0x3b4a3c[a1_0x3f70('0x2f')]['tokens'],{'kind':_0x5029e7})){_0x51ded8();}else{_0x5e687b['redirect']('/auth/'+_0x5029e7);}};