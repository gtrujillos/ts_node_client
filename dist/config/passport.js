var a1_0x1ef3=['/auth/','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','timezone','user','flash','errors','facebook','tokens','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','_json','location','isAuthenticated','redirect','/login','isAuthorized','path'];(function(_0x45658b,_0xa6ed42){var _0x51c273=function(_0x5a2c04){while(--_0x5a2c04){_0x45658b['push'](_0x45658b['shift']());}};_0x51c273(++_0xa6ed42);}(a1_0x1ef3,0xf6));var a1_0x4df1=function(_0x534f8c,_0x2f6dd7){_0x534f8c=_0x534f8c-0x0;var _0x4983a3=a1_0x1ef3[_0x534f8c];return _0x4983a3;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4eb3cd){return _0x4eb3cd&&_0x4eb3cd[a1_0x4df1('0x0')]?_0x4eb3cd:{'default':_0x4eb3cd};};Object[a1_0x4df1('0x1')](exports,a1_0x4df1('0x0'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x4df1('0x2')));const passport_facebook_1=__importDefault(require(a1_0x4df1('0x3')));const lodash_1=__importDefault(require(a1_0x4df1('0x4')));const User_1=__importDefault(require(a1_0x4df1('0x5')));const LocalStrategy=passport_local_1[a1_0x4df1('0x6')][a1_0x4df1('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x4df1('0x6')][a1_0x4df1('0x7')];passport_1['default'][a1_0x4df1('0x8')]((_0x3b7cf0,_0x2ebb28)=>{_0x2ebb28(undefined,_0x3b7cf0['id']);});passport_1[a1_0x4df1('0x6')][a1_0x4df1('0x9')]((_0x3b83b8,_0x35f3e5)=>{User_1['default'][a1_0x4df1('0xa')](_0x3b83b8,(_0x130b23,_0x12c078)=>{_0x35f3e5(_0x130b23,_0x12c078);});});passport_1[a1_0x4df1('0x6')][a1_0x4df1('0xb')](new LocalStrategy({'usernameField':'email'},(_0x5803fc,_0x375b51,_0x480fd0)=>{User_1['default'][a1_0x4df1('0xc')]({'email':_0x5803fc[a1_0x4df1('0xd')]()},(_0x3c3634,_0x377801)=>{if(_0x3c3634){return _0x480fd0(_0x3c3634);}if(!_0x377801){return _0x480fd0(undefined,![],{'message':a1_0x4df1('0xe')+_0x5803fc+a1_0x4df1('0xf')});}_0x377801['comparePassword'](_0x375b51,(_0x3c3634,_0x259544)=>{if(_0x3c3634){return _0x480fd0(_0x3c3634);}if(_0x259544){return _0x480fd0(undefined,_0x377801);}return _0x480fd0(undefined,![],{'message':a1_0x4df1('0x10')});});});}));passport_1[a1_0x4df1('0x6')][a1_0x4df1('0xb')](new FacebookStrategy({'clientID':process[a1_0x4df1('0x11')][a1_0x4df1('0x12')],'clientSecret':process[a1_0x4df1('0x11')][a1_0x4df1('0x13')],'callbackURL':a1_0x4df1('0x14'),'profileFields':[a1_0x4df1('0x15'),a1_0x4df1('0x16'),a1_0x4df1('0x17'),'locale',a1_0x4df1('0x18')],'passReqToCallback':!![]},(_0x494983,_0x6ee137,_0x279659,_0x599ba7,_0x2b06dd)=>{if(_0x494983[a1_0x4df1('0x19')]){User_1['default'][a1_0x4df1('0xc')]({'facebook':_0x599ba7['id']},(_0x124fc0,_0x12846b)=>{if(_0x124fc0){return _0x2b06dd(_0x124fc0);}if(_0x12846b){_0x494983[a1_0x4df1('0x1a')](a1_0x4df1('0x1b'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x2b06dd(_0x124fc0);}else{User_1[a1_0x4df1('0x6')]['findById'](_0x494983[a1_0x4df1('0x19')]['id'],(_0x124fc0,_0x7755e4)=>{if(_0x124fc0){return _0x2b06dd(_0x124fc0);}_0x7755e4[a1_0x4df1('0x1c')]=_0x599ba7['id'];_0x7755e4[a1_0x4df1('0x1d')]['push']({'kind':a1_0x4df1('0x1c'),'accessToken':_0x6ee137});_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x15')]=_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x15')]||_0x599ba7['name'][a1_0x4df1('0x1f')]+'\x20'+_0x599ba7[a1_0x4df1('0x15')][a1_0x4df1('0x20')];_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x21')]=_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x21')]||_0x599ba7['_json'][a1_0x4df1('0x21')];_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x22')]=_0x7755e4[a1_0x4df1('0x1e')][a1_0x4df1('0x22')]||a1_0x4df1('0x23')+_0x599ba7['id']+a1_0x4df1('0x24');_0x7755e4[a1_0x4df1('0x25')](_0x124fc0=>{_0x494983[a1_0x4df1('0x1a')]('info',{'msg':a1_0x4df1('0x26')});_0x2b06dd(_0x124fc0,_0x7755e4);});});}});}else{User_1[a1_0x4df1('0x6')]['findOne']({'facebook':_0x599ba7['id']},(_0x28bf21,_0x15281a)=>{if(_0x28bf21){return _0x2b06dd(_0x28bf21);}if(_0x15281a){return _0x2b06dd(undefined,_0x15281a);}User_1[a1_0x4df1('0x6')][a1_0x4df1('0xc')]({'email':_0x599ba7['_json'][a1_0x4df1('0x16')]},(_0x28bf21,_0x1501a8)=>{if(_0x28bf21){return _0x2b06dd(_0x28bf21);}if(_0x1501a8){_0x494983[a1_0x4df1('0x1a')]('errors',{'msg':a1_0x4df1('0x27')});_0x2b06dd(_0x28bf21);}else{const _0x58cd63=new User_1[(a1_0x4df1('0x6'))]();_0x58cd63[a1_0x4df1('0x16')]=_0x599ba7['_json'][a1_0x4df1('0x16')];_0x58cd63[a1_0x4df1('0x1c')]=_0x599ba7['id'];_0x58cd63[a1_0x4df1('0x1d')][a1_0x4df1('0x28')]({'kind':a1_0x4df1('0x1c'),'accessToken':_0x6ee137});_0x58cd63[a1_0x4df1('0x1e')][a1_0x4df1('0x15')]=_0x599ba7['name'][a1_0x4df1('0x1f')]+'\x20'+_0x599ba7[a1_0x4df1('0x15')]['familyName'];_0x58cd63[a1_0x4df1('0x1e')][a1_0x4df1('0x21')]=_0x599ba7[a1_0x4df1('0x29')]['gender'];_0x58cd63[a1_0x4df1('0x1e')]['picture']=a1_0x4df1('0x23')+_0x599ba7['id']+'/picture?type=large';_0x58cd63[a1_0x4df1('0x1e')][a1_0x4df1('0x2a')]=_0x599ba7[a1_0x4df1('0x29')][a1_0x4df1('0x2a')]?_0x599ba7[a1_0x4df1('0x29')]['location']['name']:'';_0x58cd63['save'](_0x28bf21=>{_0x2b06dd(_0x28bf21,_0x58cd63);});}});});}}));exports['isAuthenticated']=(_0x7eda80,_0x3f1c66,_0x25ea63)=>{if(_0x7eda80[a1_0x4df1('0x2b')]()){return _0x25ea63();}_0x3f1c66[a1_0x4df1('0x2c')](a1_0x4df1('0x2d'));};exports[a1_0x4df1('0x2e')]=(_0x337d5f,_0x12e0c3,_0x3cb849)=>{const _0x55d88c=_0x337d5f[a1_0x4df1('0x2f')]['split']('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x4df1('0x6')]['find'](_0x337d5f[a1_0x4df1('0x19')][a1_0x4df1('0x1d')],{'kind':_0x55d88c})){_0x3cb849();}else{_0x12e0c3['redirect'](a1_0x4df1('0x30')+_0x55d88c);}};