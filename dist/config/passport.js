var a1_0x438d=['flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','profile','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','_json','push','givenName','location','save','isAuthenticated','redirect','path','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','lodash','../models/User','default','Strategy','serializeUser','findById','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','locale','user'];(function(_0x2602df,_0x5ecd6c){var _0x2f73de=function(_0x80ff5){while(--_0x80ff5){_0x2602df['push'](_0x2602df['shift']());}};_0x2f73de(++_0x5ecd6c);}(a1_0x438d,0x1c7));var a1_0x33b3=function(_0x2525cf,_0x3d2412){_0x2525cf=_0x2525cf-0x0;var _0x5e0e8a=a1_0x438d[_0x2525cf];return _0x5e0e8a;};'use strict';var __importDefault=this&&this[a1_0x33b3('0x0')]||function(_0x4cef00){return _0x4cef00&&_0x4cef00[a1_0x33b3('0x1')]?_0x4cef00:{'default':_0x4cef00};};Object[a1_0x33b3('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x33b3('0x3')));const passport_local_1=__importDefault(require(a1_0x33b3('0x4')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x33b3('0x5')));const User_1=__importDefault(require(a1_0x33b3('0x6')));const LocalStrategy=passport_local_1[a1_0x33b3('0x7')][a1_0x33b3('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x33b3('0x7')][a1_0x33b3('0x8')];passport_1[a1_0x33b3('0x7')][a1_0x33b3('0x9')]((_0x1f726c,_0x270b53)=>{_0x270b53(undefined,_0x1f726c['id']);});passport_1['default']['deserializeUser']((_0x20dbb7,_0x38e757)=>{User_1[a1_0x33b3('0x7')][a1_0x33b3('0xa')](_0x20dbb7,(_0x2d8377,_0x12616d)=>{_0x38e757(_0x2d8377,_0x12616d);});});passport_1[a1_0x33b3('0x7')]['use'](new LocalStrategy({'usernameField':'email'},(_0x19b9c1,_0xa4fcee,_0xa50547)=>{User_1[a1_0x33b3('0x7')][a1_0x33b3('0xb')]({'email':_0x19b9c1[a1_0x33b3('0xc')]()},(_0x14c1ec,_0x1ed53f)=>{if(_0x14c1ec){return _0xa50547(_0x14c1ec);}if(!_0x1ed53f){return _0xa50547(undefined,![],{'message':a1_0x33b3('0xd')+_0x19b9c1+a1_0x33b3('0xe')});}_0x1ed53f[a1_0x33b3('0xf')](_0xa4fcee,(_0x14c1ec,_0x56548a)=>{if(_0x14c1ec){return _0xa50547(_0x14c1ec);}if(_0x56548a){return _0xa50547(undefined,_0x1ed53f);}return _0xa50547(undefined,![],{'message':a1_0x33b3('0x10')});});});}));passport_1[a1_0x33b3('0x7')]['use'](new FacebookStrategy({'clientID':process[a1_0x33b3('0x11')]['FACEBOOK_ID'],'clientSecret':process[a1_0x33b3('0x11')][a1_0x33b3('0x12')],'callbackURL':a1_0x33b3('0x13'),'profileFields':[a1_0x33b3('0x14'),a1_0x33b3('0x15'),a1_0x33b3('0x16'),a1_0x33b3('0x17'),'timezone'],'passReqToCallback':!![]},(_0x1b6ac2,_0x4b0013,_0x35f0b8,_0x26868f,_0x1aa114)=>{if(_0x1b6ac2[a1_0x33b3('0x18')]){User_1[a1_0x33b3('0x7')]['findOne']({'facebook':_0x26868f['id']},(_0x17e1a0,_0x31d355)=>{if(_0x17e1a0){return _0x1aa114(_0x17e1a0);}if(_0x31d355){_0x1b6ac2[a1_0x33b3('0x19')](a1_0x33b3('0x1a'),{'msg':a1_0x33b3('0x1b')});_0x1aa114(_0x17e1a0);}else{User_1['default'][a1_0x33b3('0xa')](_0x1b6ac2['user']['id'],(_0x17e1a0,_0x3d8438)=>{if(_0x17e1a0){return _0x1aa114(_0x17e1a0);}_0x3d8438[a1_0x33b3('0x1c')]=_0x26868f['id'];_0x3d8438[a1_0x33b3('0x1d')]['push']({'kind':a1_0x33b3('0x1c'),'accessToken':_0x4b0013});_0x3d8438[a1_0x33b3('0x1e')][a1_0x33b3('0x14')]=_0x3d8438['profile'][a1_0x33b3('0x14')]||_0x26868f[a1_0x33b3('0x14')]['givenName']+'\x20'+_0x26868f['name'][a1_0x33b3('0x1f')];_0x3d8438[a1_0x33b3('0x1e')][a1_0x33b3('0x20')]=_0x3d8438[a1_0x33b3('0x1e')][a1_0x33b3('0x20')]||_0x26868f['_json'][a1_0x33b3('0x20')];_0x3d8438[a1_0x33b3('0x1e')][a1_0x33b3('0x21')]=_0x3d8438['profile'][a1_0x33b3('0x21')]||a1_0x33b3('0x22')+_0x26868f['id']+a1_0x33b3('0x23');_0x3d8438['save'](_0x17e1a0=>{_0x1b6ac2[a1_0x33b3('0x19')](a1_0x33b3('0x24'),{'msg':a1_0x33b3('0x25')});_0x1aa114(_0x17e1a0,_0x3d8438);});});}});}else{User_1[a1_0x33b3('0x7')]['findOne']({'facebook':_0x26868f['id']},(_0x359e0d,_0x4a1e10)=>{if(_0x359e0d){return _0x1aa114(_0x359e0d);}if(_0x4a1e10){return _0x1aa114(undefined,_0x4a1e10);}User_1[a1_0x33b3('0x7')]['findOne']({'email':_0x26868f[a1_0x33b3('0x26')]['email']},(_0x359e0d,_0x36f776)=>{if(_0x359e0d){return _0x1aa114(_0x359e0d);}if(_0x36f776){_0x1b6ac2[a1_0x33b3('0x19')](a1_0x33b3('0x1a'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x1aa114(_0x359e0d);}else{const _0x2e1d59=new User_1[(a1_0x33b3('0x7'))]();_0x2e1d59['email']=_0x26868f[a1_0x33b3('0x26')][a1_0x33b3('0x15')];_0x2e1d59[a1_0x33b3('0x1c')]=_0x26868f['id'];_0x2e1d59[a1_0x33b3('0x1d')][a1_0x33b3('0x27')]({'kind':a1_0x33b3('0x1c'),'accessToken':_0x4b0013});_0x2e1d59[a1_0x33b3('0x1e')][a1_0x33b3('0x14')]=_0x26868f[a1_0x33b3('0x14')][a1_0x33b3('0x28')]+'\x20'+_0x26868f[a1_0x33b3('0x14')][a1_0x33b3('0x1f')];_0x2e1d59[a1_0x33b3('0x1e')]['gender']=_0x26868f[a1_0x33b3('0x26')][a1_0x33b3('0x20')];_0x2e1d59[a1_0x33b3('0x1e')]['picture']=a1_0x33b3('0x22')+_0x26868f['id']+'/picture?type=large';_0x2e1d59[a1_0x33b3('0x1e')][a1_0x33b3('0x29')]=_0x26868f[a1_0x33b3('0x26')]['location']?_0x26868f[a1_0x33b3('0x26')][a1_0x33b3('0x29')]['name']:'';_0x2e1d59[a1_0x33b3('0x2a')](_0x359e0d=>{_0x1aa114(_0x359e0d,_0x2e1d59);});}});});}}));exports['isAuthenticated']=(_0x4b452e,_0x5ae6fd,_0x5d9b19)=>{if(_0x4b452e[a1_0x33b3('0x2b')]()){return _0x5d9b19();}_0x5ae6fd[a1_0x33b3('0x2c')]('/login');};exports['isAuthorized']=(_0x3e811c,_0x4dc109,_0x103187)=>{const _0xa8c045=_0x3e811c[a1_0x33b3('0x2d')]['split']('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x33b3('0x2e')](_0x3e811c[a1_0x33b3('0x18')][a1_0x33b3('0x1d')],{'kind':_0xa8c045})){_0x103187();}else{_0x4dc109[a1_0x33b3('0x2c')](a1_0x33b3('0x2f')+_0xa8c045);}};