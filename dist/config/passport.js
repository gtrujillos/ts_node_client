var a1_0x1365=['__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','/auth/facebook/callback','name','link','timezone','user','findOne','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','push','profile','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','__importDefault'];(function(_0x485be8,_0x3fea56){var _0x52c93e=function(_0x3823bb){while(--_0x3823bb){_0x485be8['push'](_0x485be8['shift']());}};_0x52c93e(++_0x3fea56);}(a1_0x1365,0x1d3));var a1_0x5eef=function(_0x226ee,_0x3d2dc2){_0x226ee=_0x226ee-0x0;var _0x5cc581=a1_0x1365[_0x226ee];return _0x5cc581;};'use strict';var __importDefault=this&&this[a1_0x5eef('0x0')]||function(_0x18b6d7){return _0x18b6d7&&_0x18b6d7[a1_0x5eef('0x1')]?_0x18b6d7:{'default':_0x18b6d7};};Object[a1_0x5eef('0x2')](exports,a1_0x5eef('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5eef('0x3')));const passport_local_1=__importDefault(require(a1_0x5eef('0x4')));const passport_facebook_1=__importDefault(require(a1_0x5eef('0x5')));const lodash_1=__importDefault(require(a1_0x5eef('0x6')));const User_1=__importDefault(require(a1_0x5eef('0x7')));const LocalStrategy=passport_local_1[a1_0x5eef('0x8')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5eef('0x8')][a1_0x5eef('0x9')];passport_1[a1_0x5eef('0x8')][a1_0x5eef('0xa')]((_0x3dfdce,_0x1dc0f8)=>{_0x1dc0f8(undefined,_0x3dfdce['id']);});passport_1[a1_0x5eef('0x8')][a1_0x5eef('0xb')]((_0x5b13a9,_0x367102)=>{User_1['default'][a1_0x5eef('0xc')](_0x5b13a9,(_0x5b750b,_0x782597)=>{_0x367102(_0x5b750b,_0x782597);});});passport_1[a1_0x5eef('0x8')][a1_0x5eef('0xd')](new LocalStrategy({'usernameField':a1_0x5eef('0xe')},(_0x312dfd,_0x3325a3,_0x2805f3)=>{User_1['default']['findOne']({'email':_0x312dfd[a1_0x5eef('0xf')]()},(_0x5a94a9,_0x2ba3d9)=>{if(_0x5a94a9){return _0x2805f3(_0x5a94a9);}if(!_0x2ba3d9){return _0x2805f3(undefined,![],{'message':a1_0x5eef('0x10')+_0x312dfd+a1_0x5eef('0x11')});}_0x2ba3d9[a1_0x5eef('0x12')](_0x3325a3,(_0x5a94a9,_0xf70952)=>{if(_0x5a94a9){return _0x2805f3(_0x5a94a9);}if(_0xf70952){return _0x2805f3(undefined,_0x2ba3d9);}return _0x2805f3(undefined,![],{'message':a1_0x5eef('0x13')});});});}));passport_1[a1_0x5eef('0x8')][a1_0x5eef('0xd')](new FacebookStrategy({'clientID':process[a1_0x5eef('0x14')]['FACEBOOK_ID'],'clientSecret':process['env']['FACEBOOK_SECRET'],'callbackURL':a1_0x5eef('0x15'),'profileFields':[a1_0x5eef('0x16'),'email',a1_0x5eef('0x17'),'locale',a1_0x5eef('0x18')],'passReqToCallback':!![]},(_0x62a873,_0x3bdcbb,_0x44ab4a,_0x162431,_0x13e159)=>{if(_0x62a873[a1_0x5eef('0x19')]){User_1[a1_0x5eef('0x8')][a1_0x5eef('0x1a')]({'facebook':_0x162431['id']},(_0x4bea3e,_0x103780)=>{if(_0x4bea3e){return _0x13e159(_0x4bea3e);}if(_0x103780){_0x62a873[a1_0x5eef('0x1b')]('errors',{'msg':a1_0x5eef('0x1c')});_0x13e159(_0x4bea3e);}else{User_1[a1_0x5eef('0x8')][a1_0x5eef('0xc')](_0x62a873[a1_0x5eef('0x19')]['id'],(_0x4bea3e,_0x2ab658)=>{if(_0x4bea3e){return _0x13e159(_0x4bea3e);}_0x2ab658[a1_0x5eef('0x1d')]=_0x162431['id'];_0x2ab658['tokens'][a1_0x5eef('0x1e')]({'kind':'facebook','accessToken':_0x3bdcbb});_0x2ab658[a1_0x5eef('0x1f')][a1_0x5eef('0x16')]=_0x2ab658[a1_0x5eef('0x1f')][a1_0x5eef('0x16')]||_0x162431[a1_0x5eef('0x16')][a1_0x5eef('0x20')]+'\x20'+_0x162431['name'][a1_0x5eef('0x21')];_0x2ab658['profile'][a1_0x5eef('0x22')]=_0x2ab658[a1_0x5eef('0x1f')][a1_0x5eef('0x22')]||_0x162431[a1_0x5eef('0x23')]['gender'];_0x2ab658['profile']['picture']=_0x2ab658[a1_0x5eef('0x1f')][a1_0x5eef('0x24')]||'https://graph.facebook.com/'+_0x162431['id']+a1_0x5eef('0x25');_0x2ab658[a1_0x5eef('0x26')](_0x4bea3e=>{_0x62a873[a1_0x5eef('0x1b')](a1_0x5eef('0x27'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x13e159(_0x4bea3e,_0x2ab658);});});}});}else{User_1[a1_0x5eef('0x8')][a1_0x5eef('0x1a')]({'facebook':_0x162431['id']},(_0x44e772,_0x2abc1d)=>{if(_0x44e772){return _0x13e159(_0x44e772);}if(_0x2abc1d){return _0x13e159(undefined,_0x2abc1d);}User_1['default'][a1_0x5eef('0x1a')]({'email':_0x162431[a1_0x5eef('0x23')]['email']},(_0x44e772,_0x240411)=>{if(_0x44e772){return _0x13e159(_0x44e772);}if(_0x240411){_0x62a873[a1_0x5eef('0x1b')](a1_0x5eef('0x28'),{'msg':a1_0x5eef('0x29')});_0x13e159(_0x44e772);}else{const _0x3a5881=new User_1['default']();_0x3a5881[a1_0x5eef('0xe')]=_0x162431[a1_0x5eef('0x23')][a1_0x5eef('0xe')];_0x3a5881[a1_0x5eef('0x1d')]=_0x162431['id'];_0x3a5881[a1_0x5eef('0x2a')][a1_0x5eef('0x1e')]({'kind':a1_0x5eef('0x1d'),'accessToken':_0x3bdcbb});_0x3a5881['profile'][a1_0x5eef('0x16')]=_0x162431[a1_0x5eef('0x16')]['givenName']+'\x20'+_0x162431[a1_0x5eef('0x16')]['familyName'];_0x3a5881[a1_0x5eef('0x1f')][a1_0x5eef('0x22')]=_0x162431['_json']['gender'];_0x3a5881[a1_0x5eef('0x1f')]['picture']=a1_0x5eef('0x2b')+_0x162431['id']+a1_0x5eef('0x25');_0x3a5881['profile'][a1_0x5eef('0x2c')]=_0x162431[a1_0x5eef('0x23')]['location']?_0x162431[a1_0x5eef('0x23')][a1_0x5eef('0x2c')]['name']:'';_0x3a5881[a1_0x5eef('0x26')](_0x44e772=>{_0x13e159(_0x44e772,_0x3a5881);});}});});}}));exports[a1_0x5eef('0x2d')]=(_0x51a7c2,_0x1fbd93,_0x3ae6f7)=>{if(_0x51a7c2[a1_0x5eef('0x2d')]()){return _0x3ae6f7();}_0x1fbd93[a1_0x5eef('0x2e')](a1_0x5eef('0x2f'));};exports[a1_0x5eef('0x30')]=(_0x2ac9ef,_0x1776c7,_0x2279cb)=>{const _0x229b5d=_0x2ac9ef[a1_0x5eef('0x31')][a1_0x5eef('0x32')]('/')['slice'](-0x1)[0x0];if(lodash_1['default'][a1_0x5eef('0x33')](_0x2ac9ef['user'][a1_0x5eef('0x2a')],{'kind':_0x229b5d})){_0x2279cb();}else{_0x1776c7['redirect']('/auth/'+_0x229b5d);}};