var a1_0xa11a=['isAuthenticated','redirect','path','split','slice','find','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','../models/User','Strategy','default','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','givenName','location'];(function(_0x50f826,_0x27c5bc){var _0x367806=function(_0x51b7f0){while(--_0x51b7f0){_0x50f826['push'](_0x50f826['shift']());}};_0x367806(++_0x27c5bc);}(a1_0xa11a,0x6a));var a1_0xfdb7=function(_0x627c1d,_0x5cd2ac){_0x627c1d=_0x627c1d-0x0;var _0x57d0ce=a1_0xa11a[_0x627c1d];return _0x57d0ce;};'use strict';var __importDefault=this&&this[a1_0xfdb7('0x0')]||function(_0x46ff8c){return _0x46ff8c&&_0x46ff8c[a1_0xfdb7('0x1')]?_0x46ff8c:{'default':_0x46ff8c};};Object[a1_0xfdb7('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0xfdb7('0x3')));const passport_facebook_1=__importDefault(require(a1_0xfdb7('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0xfdb7('0x5')));const LocalStrategy=passport_local_1['default'][a1_0xfdb7('0x6')];const FacebookStrategy=passport_facebook_1[a1_0xfdb7('0x7')][a1_0xfdb7('0x6')];passport_1[a1_0xfdb7('0x7')]['serializeUser']((_0x591a8e,_0x1da94e)=>{_0x1da94e(undefined,_0x591a8e['id']);});passport_1[a1_0xfdb7('0x7')]['deserializeUser']((_0x54d771,_0x17ccef)=>{User_1[a1_0xfdb7('0x7')][a1_0xfdb7('0x8')](_0x54d771,(_0x2fcef5,_0x42a8b1)=>{_0x17ccef(_0x2fcef5,_0x42a8b1);});});passport_1['default'][a1_0xfdb7('0x9')](new LocalStrategy({'usernameField':a1_0xfdb7('0xa')},(_0xb1b05a,_0x5d5737,_0x5e2ef7)=>{User_1[a1_0xfdb7('0x7')][a1_0xfdb7('0xb')]({'email':_0xb1b05a[a1_0xfdb7('0xc')]()},(_0x3040ac,_0x4833da)=>{if(_0x3040ac){return _0x5e2ef7(_0x3040ac);}if(!_0x4833da){return _0x5e2ef7(undefined,![],{'message':a1_0xfdb7('0xd')+_0xb1b05a+'\x20not\x20found.'});}_0x4833da[a1_0xfdb7('0xe')](_0x5d5737,(_0x3040ac,_0x172d3b)=>{if(_0x3040ac){return _0x5e2ef7(_0x3040ac);}if(_0x172d3b){return _0x5e2ef7(undefined,_0x4833da);}return _0x5e2ef7(undefined,![],{'message':a1_0xfdb7('0xf')});});});}));passport_1[a1_0xfdb7('0x7')][a1_0xfdb7('0x9')](new FacebookStrategy({'clientID':process[a1_0xfdb7('0x10')][a1_0xfdb7('0x11')],'clientSecret':process[a1_0xfdb7('0x10')][a1_0xfdb7('0x12')],'callbackURL':a1_0xfdb7('0x13'),'profileFields':[a1_0xfdb7('0x14'),a1_0xfdb7('0xa'),a1_0xfdb7('0x15'),a1_0xfdb7('0x16'),a1_0xfdb7('0x17')],'passReqToCallback':!![]},(_0x4d6796,_0x190fe2,_0x30983c,_0xcbceab,_0x5b93fd)=>{if(_0x4d6796[a1_0xfdb7('0x18')]){User_1[a1_0xfdb7('0x7')][a1_0xfdb7('0xb')]({'facebook':_0xcbceab['id']},(_0x449594,_0x5b9068)=>{if(_0x449594){return _0x5b93fd(_0x449594);}if(_0x5b9068){_0x4d6796[a1_0xfdb7('0x19')](a1_0xfdb7('0x1a'),{'msg':a1_0xfdb7('0x1b')});_0x5b93fd(_0x449594);}else{User_1[a1_0xfdb7('0x7')][a1_0xfdb7('0x8')](_0x4d6796[a1_0xfdb7('0x18')]['id'],(_0x449594,_0x3f4fed)=>{if(_0x449594){return _0x5b93fd(_0x449594);}_0x3f4fed[a1_0xfdb7('0x1c')]=_0xcbceab['id'];_0x3f4fed[a1_0xfdb7('0x1d')][a1_0xfdb7('0x1e')]({'kind':a1_0xfdb7('0x1c'),'accessToken':_0x190fe2});_0x3f4fed['profile']['name']=_0x3f4fed[a1_0xfdb7('0x1f')][a1_0xfdb7('0x14')]||_0xcbceab[a1_0xfdb7('0x14')]['givenName']+'\x20'+_0xcbceab['name'][a1_0xfdb7('0x20')];_0x3f4fed['profile'][a1_0xfdb7('0x21')]=_0x3f4fed[a1_0xfdb7('0x1f')]['gender']||_0xcbceab[a1_0xfdb7('0x22')][a1_0xfdb7('0x21')];_0x3f4fed[a1_0xfdb7('0x1f')][a1_0xfdb7('0x23')]=_0x3f4fed[a1_0xfdb7('0x1f')][a1_0xfdb7('0x23')]||a1_0xfdb7('0x24')+_0xcbceab['id']+a1_0xfdb7('0x25');_0x3f4fed[a1_0xfdb7('0x26')](_0x449594=>{_0x4d6796[a1_0xfdb7('0x19')](a1_0xfdb7('0x27'),{'msg':a1_0xfdb7('0x28')});_0x5b93fd(_0x449594,_0x3f4fed);});});}});}else{User_1['default']['findOne']({'facebook':_0xcbceab['id']},(_0x1e09ea,_0xa9e9e)=>{if(_0x1e09ea){return _0x5b93fd(_0x1e09ea);}if(_0xa9e9e){return _0x5b93fd(undefined,_0xa9e9e);}User_1[a1_0xfdb7('0x7')][a1_0xfdb7('0xb')]({'email':_0xcbceab[a1_0xfdb7('0x22')][a1_0xfdb7('0xa')]},(_0x1e09ea,_0x15759b)=>{if(_0x1e09ea){return _0x5b93fd(_0x1e09ea);}if(_0x15759b){_0x4d6796[a1_0xfdb7('0x19')](a1_0xfdb7('0x1a'),{'msg':a1_0xfdb7('0x29')});_0x5b93fd(_0x1e09ea);}else{const _0x49b551=new User_1[(a1_0xfdb7('0x7'))]();_0x49b551[a1_0xfdb7('0xa')]=_0xcbceab[a1_0xfdb7('0x22')][a1_0xfdb7('0xa')];_0x49b551['facebook']=_0xcbceab['id'];_0x49b551[a1_0xfdb7('0x1d')][a1_0xfdb7('0x1e')]({'kind':'facebook','accessToken':_0x190fe2});_0x49b551['profile']['name']=_0xcbceab[a1_0xfdb7('0x14')][a1_0xfdb7('0x2a')]+'\x20'+_0xcbceab[a1_0xfdb7('0x14')][a1_0xfdb7('0x20')];_0x49b551[a1_0xfdb7('0x1f')]['gender']=_0xcbceab['_json'][a1_0xfdb7('0x21')];_0x49b551[a1_0xfdb7('0x1f')][a1_0xfdb7('0x23')]=a1_0xfdb7('0x24')+_0xcbceab['id']+a1_0xfdb7('0x25');_0x49b551[a1_0xfdb7('0x1f')]['location']=_0xcbceab[a1_0xfdb7('0x22')][a1_0xfdb7('0x2b')]?_0xcbceab[a1_0xfdb7('0x22')][a1_0xfdb7('0x2b')]['name']:'';_0x49b551[a1_0xfdb7('0x26')](_0x1e09ea=>{_0x5b93fd(_0x1e09ea,_0x49b551);});}});});}}));exports[a1_0xfdb7('0x2c')]=(_0x38c64c,_0x47ebac,_0xc24a29)=>{if(_0x38c64c[a1_0xfdb7('0x2c')]()){return _0xc24a29();}_0x47ebac[a1_0xfdb7('0x2d')]('/login');};exports['isAuthorized']=(_0x831b28,_0x44e1e4,_0x5386da)=>{const _0x5e09a4=_0x831b28[a1_0xfdb7('0x2e')][a1_0xfdb7('0x2f')]('/')[a1_0xfdb7('0x30')](-0x1)[0x0];if(lodash_1['default'][a1_0xfdb7('0x31')](_0x831b28['user'][a1_0xfdb7('0x1d')],{'kind':_0x5e09a4})){_0x5386da();}else{_0x44e1e4[a1_0xfdb7('0x2d')]('/auth/'+_0x5e09a4);}};