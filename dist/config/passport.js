var a1_0x2fd8=['env','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','push','profile','familyName','gender','_json','picture','https://graph.facebook.com/','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','__importDefault','__esModule','passport-local','lodash','default','Strategy','deserializeUser','findById','use','findOne','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.'];(function(_0x5c21ed,_0x18e5a1){var _0x36bfc1=function(_0x53add2){while(--_0x53add2){_0x5c21ed['push'](_0x5c21ed['shift']());}};_0x36bfc1(++_0x18e5a1);}(a1_0x2fd8,0x17e));var a1_0x2e26=function(_0xf8203b,_0x502b66){_0xf8203b=_0xf8203b-0x0;var _0x126d4f=a1_0x2fd8[_0xf8203b];return _0x126d4f;};'use strict';var __importDefault=this&&this[a1_0x2e26('0x0')]||function(_0xa66bfc){return _0xa66bfc&&_0xa66bfc[a1_0x2e26('0x1')]?_0xa66bfc:{'default':_0xa66bfc};};Object['defineProperty'](exports,a1_0x2e26('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x2e26('0x2')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x2e26('0x3')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x2e26('0x4')][a1_0x2e26('0x5')];const FacebookStrategy=passport_facebook_1['default'][a1_0x2e26('0x5')];passport_1[a1_0x2e26('0x4')]['serializeUser']((_0xf7ebfc,_0x2272bb)=>{_0x2272bb(undefined,_0xf7ebfc['id']);});passport_1[a1_0x2e26('0x4')][a1_0x2e26('0x6')]((_0x265501,_0x5b80aa)=>{User_1[a1_0x2e26('0x4')][a1_0x2e26('0x7')](_0x265501,(_0x448b46,_0x3ac487)=>{_0x5b80aa(_0x448b46,_0x3ac487);});});passport_1[a1_0x2e26('0x4')][a1_0x2e26('0x8')](new LocalStrategy({'usernameField':'email'},(_0x515548,_0x575c9d,_0x3c5d8e)=>{User_1[a1_0x2e26('0x4')][a1_0x2e26('0x9')]({'email':_0x515548[a1_0x2e26('0xa')]()},(_0x4a81c3,_0x5f391e)=>{if(_0x4a81c3){return _0x3c5d8e(_0x4a81c3);}if(!_0x5f391e){return _0x3c5d8e(undefined,![],{'message':'Email\x20'+_0x515548+a1_0x2e26('0xb')});}_0x5f391e[a1_0x2e26('0xc')](_0x575c9d,(_0x4a81c3,_0x16c62f)=>{if(_0x4a81c3){return _0x3c5d8e(_0x4a81c3);}if(_0x16c62f){return _0x3c5d8e(undefined,_0x5f391e);}return _0x3c5d8e(undefined,![],{'message':a1_0x2e26('0xd')});});});}));passport_1['default'][a1_0x2e26('0x8')](new FacebookStrategy({'clientID':process[a1_0x2e26('0xe')]['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x2e26('0xf')],'callbackURL':a1_0x2e26('0x10'),'profileFields':[a1_0x2e26('0x11'),a1_0x2e26('0x12'),a1_0x2e26('0x13'),'locale','timezone'],'passReqToCallback':!![]},(_0x382408,_0x540f10,_0x273ab0,_0x55c140,_0x1a5682)=>{if(_0x382408[a1_0x2e26('0x14')]){User_1['default'][a1_0x2e26('0x9')]({'facebook':_0x55c140['id']},(_0x43be66,_0xbf65c6)=>{if(_0x43be66){return _0x1a5682(_0x43be66);}if(_0xbf65c6){_0x382408[a1_0x2e26('0x15')](a1_0x2e26('0x16'),{'msg':a1_0x2e26('0x17')});_0x1a5682(_0x43be66);}else{User_1['default']['findById'](_0x382408[a1_0x2e26('0x14')]['id'],(_0x43be66,_0x5b704a)=>{if(_0x43be66){return _0x1a5682(_0x43be66);}_0x5b704a[a1_0x2e26('0x18')]=_0x55c140['id'];_0x5b704a['tokens'][a1_0x2e26('0x19')]({'kind':a1_0x2e26('0x18'),'accessToken':_0x540f10});_0x5b704a['profile']['name']=_0x5b704a[a1_0x2e26('0x1a')][a1_0x2e26('0x11')]||_0x55c140[a1_0x2e26('0x11')]['givenName']+'\x20'+_0x55c140[a1_0x2e26('0x11')][a1_0x2e26('0x1b')];_0x5b704a[a1_0x2e26('0x1a')]['gender']=_0x5b704a[a1_0x2e26('0x1a')][a1_0x2e26('0x1c')]||_0x55c140[a1_0x2e26('0x1d')][a1_0x2e26('0x1c')];_0x5b704a['profile'][a1_0x2e26('0x1e')]=_0x5b704a[a1_0x2e26('0x1a')][a1_0x2e26('0x1e')]||a1_0x2e26('0x1f')+_0x55c140['id']+'/picture?type=large';_0x5b704a[a1_0x2e26('0x20')](_0x43be66=>{_0x382408[a1_0x2e26('0x15')](a1_0x2e26('0x21'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x1a5682(_0x43be66,_0x5b704a);});});}});}else{User_1[a1_0x2e26('0x4')][a1_0x2e26('0x9')]({'facebook':_0x55c140['id']},(_0x2154db,_0x1c71a2)=>{if(_0x2154db){return _0x1a5682(_0x2154db);}if(_0x1c71a2){return _0x1a5682(undefined,_0x1c71a2);}User_1['default']['findOne']({'email':_0x55c140[a1_0x2e26('0x1d')]['email']},(_0x2154db,_0x2029dd)=>{if(_0x2154db){return _0x1a5682(_0x2154db);}if(_0x2029dd){_0x382408[a1_0x2e26('0x15')](a1_0x2e26('0x16'),{'msg':a1_0x2e26('0x22')});_0x1a5682(_0x2154db);}else{const _0x559fad=new User_1[(a1_0x2e26('0x4'))]();_0x559fad['email']=_0x55c140['_json'][a1_0x2e26('0x12')];_0x559fad[a1_0x2e26('0x18')]=_0x55c140['id'];_0x559fad[a1_0x2e26('0x23')][a1_0x2e26('0x19')]({'kind':a1_0x2e26('0x18'),'accessToken':_0x540f10});_0x559fad['profile'][a1_0x2e26('0x11')]=_0x55c140[a1_0x2e26('0x11')]['givenName']+'\x20'+_0x55c140[a1_0x2e26('0x11')]['familyName'];_0x559fad[a1_0x2e26('0x1a')][a1_0x2e26('0x1c')]=_0x55c140['_json'][a1_0x2e26('0x1c')];_0x559fad[a1_0x2e26('0x1a')][a1_0x2e26('0x1e')]=a1_0x2e26('0x1f')+_0x55c140['id']+'/picture?type=large';_0x559fad[a1_0x2e26('0x1a')][a1_0x2e26('0x24')]=_0x55c140[a1_0x2e26('0x1d')][a1_0x2e26('0x24')]?_0x55c140['_json'][a1_0x2e26('0x24')][a1_0x2e26('0x11')]:'';_0x559fad[a1_0x2e26('0x20')](_0x2154db=>{_0x1a5682(_0x2154db,_0x559fad);});}});});}}));exports['isAuthenticated']=(_0x4e1b25,_0x3b563b,_0x4ef895)=>{if(_0x4e1b25[a1_0x2e26('0x25')]()){return _0x4ef895();}_0x3b563b[a1_0x2e26('0x26')](a1_0x2e26('0x27'));};exports[a1_0x2e26('0x28')]=(_0x1eae40,_0xdb05e9,_0x120a66)=>{const _0x190da3=_0x1eae40[a1_0x2e26('0x29')][a1_0x2e26('0x2a')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x2e26('0x4')][a1_0x2e26('0x2b')](_0x1eae40[a1_0x2e26('0x14')][a1_0x2e26('0x23')],{'kind':_0x190da3})){_0x120a66();}else{_0xdb05e9[a1_0x2e26('0x26')]('/auth/'+_0x190da3);}};