var a1_0x4770=['toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','user','flash','facebook','tokens','push','givenName','familyName','gender','profile','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','errors','location','isAuthenticated','/login','isAuthorized','path','split','slice','find','__importDefault','__esModule','defineProperty','lodash','../models/User','default','Strategy','serializeUser','findById','email','findOne'];(function(_0x4adfd8,_0x263243){var _0x43c35a=function(_0x45030c){while(--_0x45030c){_0x4adfd8['push'](_0x4adfd8['shift']());}};_0x43c35a(++_0x263243);}(a1_0x4770,0x1cb));var a1_0x5a20=function(_0x4ce66d,_0x22b5c5){_0x4ce66d=_0x4ce66d-0x0;var _0xf5fe3=a1_0x4770[_0x4ce66d];return _0xf5fe3;};'use strict';var __importDefault=this&&this[a1_0x5a20('0x0')]||function(_0x4016df){return _0x4016df&&_0x4016df[a1_0x5a20('0x1')]?_0x4016df:{'default':_0x4016df};};Object[a1_0x5a20('0x2')](exports,a1_0x5a20('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x5a20('0x3')));const User_1=__importDefault(require(a1_0x5a20('0x4')));const LocalStrategy=passport_local_1[a1_0x5a20('0x5')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5a20('0x5')][a1_0x5a20('0x6')];passport_1['default'][a1_0x5a20('0x7')]((_0xa5765e,_0x10e37d)=>{_0x10e37d(undefined,_0xa5765e['id']);});passport_1[a1_0x5a20('0x5')]['deserializeUser']((_0x1af1bf,_0x4a78de)=>{User_1[a1_0x5a20('0x5')][a1_0x5a20('0x8')](_0x1af1bf,(_0x13df5f,_0x38efef)=>{_0x4a78de(_0x13df5f,_0x38efef);});});passport_1[a1_0x5a20('0x5')]['use'](new LocalStrategy({'usernameField':a1_0x5a20('0x9')},(_0x2c220f,_0x1cab39,_0x51500e)=>{User_1[a1_0x5a20('0x5')][a1_0x5a20('0xa')]({'email':_0x2c220f[a1_0x5a20('0xb')]()},(_0x1eb3b9,_0x3f42ff)=>{if(_0x1eb3b9){return _0x51500e(_0x1eb3b9);}if(!_0x3f42ff){return _0x51500e(undefined,![],{'message':a1_0x5a20('0xc')+_0x2c220f+'\x20not\x20found.'});}_0x3f42ff[a1_0x5a20('0xd')](_0x1cab39,(_0x1eb3b9,_0x4d6647)=>{if(_0x1eb3b9){return _0x51500e(_0x1eb3b9);}if(_0x4d6647){return _0x51500e(undefined,_0x3f42ff);}return _0x51500e(undefined,![],{'message':a1_0x5a20('0xe')});});});}));passport_1[a1_0x5a20('0x5')][a1_0x5a20('0xf')](new FacebookStrategy({'clientID':process['env'][a1_0x5a20('0x10')],'clientSecret':process['env'][a1_0x5a20('0x11')],'callbackURL':a1_0x5a20('0x12'),'profileFields':[a1_0x5a20('0x13'),a1_0x5a20('0x9'),'link',a1_0x5a20('0x14'),a1_0x5a20('0x15')],'passReqToCallback':!![]},(_0x3a9822,_0x3db628,_0xfa5fd4,_0x2479ac,_0x271f8f)=>{if(_0x3a9822[a1_0x5a20('0x16')]){User_1[a1_0x5a20('0x5')][a1_0x5a20('0xa')]({'facebook':_0x2479ac['id']},(_0x80dcf4,_0x331524)=>{if(_0x80dcf4){return _0x271f8f(_0x80dcf4);}if(_0x331524){_0x3a9822[a1_0x5a20('0x17')]('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x271f8f(_0x80dcf4);}else{User_1['default'][a1_0x5a20('0x8')](_0x3a9822[a1_0x5a20('0x16')]['id'],(_0x80dcf4,_0x47a534)=>{if(_0x80dcf4){return _0x271f8f(_0x80dcf4);}_0x47a534[a1_0x5a20('0x18')]=_0x2479ac['id'];_0x47a534[a1_0x5a20('0x19')][a1_0x5a20('0x1a')]({'kind':a1_0x5a20('0x18'),'accessToken':_0x3db628});_0x47a534['profile'][a1_0x5a20('0x13')]=_0x47a534['profile'][a1_0x5a20('0x13')]||_0x2479ac[a1_0x5a20('0x13')][a1_0x5a20('0x1b')]+'\x20'+_0x2479ac[a1_0x5a20('0x13')][a1_0x5a20('0x1c')];_0x47a534['profile'][a1_0x5a20('0x1d')]=_0x47a534[a1_0x5a20('0x1e')][a1_0x5a20('0x1d')]||_0x2479ac[a1_0x5a20('0x1f')]['gender'];_0x47a534['profile']['picture']=_0x47a534['profile'][a1_0x5a20('0x20')]||a1_0x5a20('0x21')+_0x2479ac['id']+a1_0x5a20('0x22');_0x47a534[a1_0x5a20('0x23')](_0x80dcf4=>{_0x3a9822[a1_0x5a20('0x17')](a1_0x5a20('0x24'),{'msg':a1_0x5a20('0x25')});_0x271f8f(_0x80dcf4,_0x47a534);});});}});}else{User_1[a1_0x5a20('0x5')][a1_0x5a20('0xa')]({'facebook':_0x2479ac['id']},(_0x166211,_0x4bb058)=>{if(_0x166211){return _0x271f8f(_0x166211);}if(_0x4bb058){return _0x271f8f(undefined,_0x4bb058);}User_1[a1_0x5a20('0x5')][a1_0x5a20('0xa')]({'email':_0x2479ac['_json']['email']},(_0x166211,_0x2dbbb3)=>{if(_0x166211){return _0x271f8f(_0x166211);}if(_0x2dbbb3){_0x3a9822['flash'](a1_0x5a20('0x26'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x271f8f(_0x166211);}else{const _0x19ede6=new User_1['default']();_0x19ede6[a1_0x5a20('0x9')]=_0x2479ac[a1_0x5a20('0x1f')][a1_0x5a20('0x9')];_0x19ede6['facebook']=_0x2479ac['id'];_0x19ede6[a1_0x5a20('0x19')]['push']({'kind':a1_0x5a20('0x18'),'accessToken':_0x3db628});_0x19ede6[a1_0x5a20('0x1e')][a1_0x5a20('0x13')]=_0x2479ac['name'][a1_0x5a20('0x1b')]+'\x20'+_0x2479ac[a1_0x5a20('0x13')]['familyName'];_0x19ede6[a1_0x5a20('0x1e')][a1_0x5a20('0x1d')]=_0x2479ac[a1_0x5a20('0x1f')][a1_0x5a20('0x1d')];_0x19ede6['profile'][a1_0x5a20('0x20')]=a1_0x5a20('0x21')+_0x2479ac['id']+a1_0x5a20('0x22');_0x19ede6[a1_0x5a20('0x1e')][a1_0x5a20('0x27')]=_0x2479ac['_json'][a1_0x5a20('0x27')]?_0x2479ac['_json'][a1_0x5a20('0x27')][a1_0x5a20('0x13')]:'';_0x19ede6[a1_0x5a20('0x23')](_0x166211=>{_0x271f8f(_0x166211,_0x19ede6);});}});});}}));exports[a1_0x5a20('0x28')]=(_0x182f54,_0x128580,_0x42b42d)=>{if(_0x182f54[a1_0x5a20('0x28')]()){return _0x42b42d();}_0x128580['redirect'](a1_0x5a20('0x29'));};exports[a1_0x5a20('0x2a')]=(_0x1fc157,_0xe99b70,_0x103ea4)=>{const _0x3d697c=_0x1fc157[a1_0x5a20('0x2b')][a1_0x5a20('0x2c')]('/')[a1_0x5a20('0x2d')](-0x1)[0x0];if(lodash_1[a1_0x5a20('0x5')][a1_0x5a20('0x2e')](_0x1fc157['user'][a1_0x5a20('0x19')],{'kind':_0x3d697c})){_0x103ea4();}else{_0xe99b70['redirect']('/auth/'+_0x3d697c);}};