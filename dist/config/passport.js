var a1_0x34a8=['errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','facebook','tokens','push','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','save','isAuthenticated','redirect','path','slice','find','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','default','Strategy','serializeUser','deserializeUser','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','user','flash'];(function(_0x18547a,_0x58a5dc){var _0x2fc7f8=function(_0x3905cc){while(--_0x3905cc){_0x18547a['push'](_0x18547a['shift']());}};_0x2fc7f8(++_0x58a5dc);}(a1_0x34a8,0x1e3));var a1_0x483a=function(_0x18ef9d,_0x23f864){_0x18ef9d=_0x18ef9d-0x0;var _0x4976cc=a1_0x34a8[_0x18ef9d];return _0x4976cc;};'use strict';var __importDefault=this&&this[a1_0x483a('0x0')]||function(_0x3ad057){return _0x3ad057&&_0x3ad057['__esModule']?_0x3ad057:{'default':_0x3ad057};};Object[a1_0x483a('0x1')](exports,a1_0x483a('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x483a('0x3')));const passport_local_1=__importDefault(require(a1_0x483a('0x4')));const passport_facebook_1=__importDefault(require(a1_0x483a('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x483a('0x6')][a1_0x483a('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x483a('0x6')]['Strategy'];passport_1[a1_0x483a('0x6')][a1_0x483a('0x8')]((_0x4593d0,_0xc6855f)=>{_0xc6855f(undefined,_0x4593d0['id']);});passport_1[a1_0x483a('0x6')][a1_0x483a('0x9')]((_0xa32dcd,_0x5d68d5)=>{User_1['default']['findById'](_0xa32dcd,(_0x142248,_0x14ab65)=>{_0x5d68d5(_0x142248,_0x14ab65);});});passport_1[a1_0x483a('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x483a('0xa')},(_0x398cfb,_0x4b9b9e,_0x11b9ef)=>{User_1[a1_0x483a('0x6')][a1_0x483a('0xb')]({'email':_0x398cfb[a1_0x483a('0xc')]()},(_0x241d9a,_0x2e3e7c)=>{if(_0x241d9a){return _0x11b9ef(_0x241d9a);}if(!_0x2e3e7c){return _0x11b9ef(undefined,![],{'message':a1_0x483a('0xd')+_0x398cfb+a1_0x483a('0xe')});}_0x2e3e7c[a1_0x483a('0xf')](_0x4b9b9e,(_0x241d9a,_0x54da01)=>{if(_0x241d9a){return _0x11b9ef(_0x241d9a);}if(_0x54da01){return _0x11b9ef(undefined,_0x2e3e7c);}return _0x11b9ef(undefined,![],{'message':a1_0x483a('0x10')});});});}));passport_1[a1_0x483a('0x6')][a1_0x483a('0x11')](new FacebookStrategy({'clientID':process['env'][a1_0x483a('0x12')],'clientSecret':process[a1_0x483a('0x13')][a1_0x483a('0x14')],'callbackURL':a1_0x483a('0x15'),'profileFields':[a1_0x483a('0x16'),a1_0x483a('0xa'),'link',a1_0x483a('0x17'),a1_0x483a('0x18')],'passReqToCallback':!![]},(_0x5c986b,_0x569e7b,_0x1caf23,_0x2fa200,_0x5f3334)=>{if(_0x5c986b[a1_0x483a('0x19')]){User_1[a1_0x483a('0x6')][a1_0x483a('0xb')]({'facebook':_0x2fa200['id']},(_0x20ae14,_0x2e02e1)=>{if(_0x20ae14){return _0x5f3334(_0x20ae14);}if(_0x2e02e1){_0x5c986b[a1_0x483a('0x1a')](a1_0x483a('0x1b'),{'msg':a1_0x483a('0x1c')});_0x5f3334(_0x20ae14);}else{User_1[a1_0x483a('0x6')][a1_0x483a('0x1d')](_0x5c986b['user']['id'],(_0x20ae14,_0x1f5da0)=>{if(_0x20ae14){return _0x5f3334(_0x20ae14);}_0x1f5da0[a1_0x483a('0x1e')]=_0x2fa200['id'];_0x1f5da0[a1_0x483a('0x1f')][a1_0x483a('0x20')]({'kind':a1_0x483a('0x1e'),'accessToken':_0x569e7b});_0x1f5da0[a1_0x483a('0x21')][a1_0x483a('0x16')]=_0x1f5da0[a1_0x483a('0x21')]['name']||_0x2fa200['name'][a1_0x483a('0x22')]+'\x20'+_0x2fa200[a1_0x483a('0x16')][a1_0x483a('0x23')];_0x1f5da0[a1_0x483a('0x21')][a1_0x483a('0x24')]=_0x1f5da0[a1_0x483a('0x21')]['gender']||_0x2fa200[a1_0x483a('0x25')][a1_0x483a('0x24')];_0x1f5da0[a1_0x483a('0x21')][a1_0x483a('0x26')]=_0x1f5da0[a1_0x483a('0x21')][a1_0x483a('0x26')]||a1_0x483a('0x27')+_0x2fa200['id']+'/picture?type=large';_0x1f5da0['save'](_0x20ae14=>{_0x5c986b['flash'](a1_0x483a('0x28'),{'msg':a1_0x483a('0x29')});_0x5f3334(_0x20ae14,_0x1f5da0);});});}});}else{User_1[a1_0x483a('0x6')][a1_0x483a('0xb')]({'facebook':_0x2fa200['id']},(_0x476421,_0x32ea9d)=>{if(_0x476421){return _0x5f3334(_0x476421);}if(_0x32ea9d){return _0x5f3334(undefined,_0x32ea9d);}User_1[a1_0x483a('0x6')][a1_0x483a('0xb')]({'email':_0x2fa200[a1_0x483a('0x25')][a1_0x483a('0xa')]},(_0x476421,_0x3c1f81)=>{if(_0x476421){return _0x5f3334(_0x476421);}if(_0x3c1f81){_0x5c986b[a1_0x483a('0x1a')](a1_0x483a('0x1b'),{'msg':a1_0x483a('0x2a')});_0x5f3334(_0x476421);}else{const _0x3a5124=new User_1[(a1_0x483a('0x6'))]();_0x3a5124[a1_0x483a('0xa')]=_0x2fa200[a1_0x483a('0x25')][a1_0x483a('0xa')];_0x3a5124[a1_0x483a('0x1e')]=_0x2fa200['id'];_0x3a5124[a1_0x483a('0x1f')]['push']({'kind':a1_0x483a('0x1e'),'accessToken':_0x569e7b});_0x3a5124[a1_0x483a('0x21')][a1_0x483a('0x16')]=_0x2fa200[a1_0x483a('0x16')][a1_0x483a('0x22')]+'\x20'+_0x2fa200['name']['familyName'];_0x3a5124[a1_0x483a('0x21')][a1_0x483a('0x24')]=_0x2fa200[a1_0x483a('0x25')][a1_0x483a('0x24')];_0x3a5124['profile'][a1_0x483a('0x26')]=a1_0x483a('0x27')+_0x2fa200['id']+'/picture?type=large';_0x3a5124[a1_0x483a('0x21')][a1_0x483a('0x2b')]=_0x2fa200['_json'][a1_0x483a('0x2b')]?_0x2fa200[a1_0x483a('0x25')]['location'][a1_0x483a('0x16')]:'';_0x3a5124[a1_0x483a('0x2c')](_0x476421=>{_0x5f3334(_0x476421,_0x3a5124);});}});});}}));exports[a1_0x483a('0x2d')]=(_0x2dc956,_0x325bda,_0xd1f2ce)=>{if(_0x2dc956[a1_0x483a('0x2d')]()){return _0xd1f2ce();}_0x325bda[a1_0x483a('0x2e')]('/login');};exports['isAuthorized']=(_0x1b84e8,_0x3f244d,_0x526fe9)=>{const _0x2a7668=_0x1b84e8[a1_0x483a('0x2f')]['split']('/')[a1_0x483a('0x30')](-0x1)[0x0];if(lodash_1[a1_0x483a('0x6')][a1_0x483a('0x31')](_0x1b84e8['user']['tokens'],{'kind':_0x2a7668})){_0x526fe9();}else{_0x3f244d['redirect'](a1_0x483a('0x32')+_0x2a7668);}};