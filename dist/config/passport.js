var a1_0x66d8=['_json','picture','https://graph.facebook.com/','save','flash','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','/picture?type=large','location','path','split','slice','find','/auth/','__importDefault','__esModule','passport','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','email','link','locale','timezone','user','errors','facebook','tokens','push','name','givenName','familyName','profile','gender'];(function(_0x31fabf,_0x5246ec){var _0x481da6=function(_0x116c74){while(--_0x116c74){_0x31fabf['push'](_0x31fabf['shift']());}};_0x481da6(++_0x5246ec);}(a1_0x66d8,0x1be));var a1_0x5603=function(_0x562ed7,_0x308626){_0x562ed7=_0x562ed7-0x0;var _0x46557e=a1_0x66d8[_0x562ed7];return _0x46557e;};'use strict';var __importDefault=this&&this[a1_0x5603('0x0')]||function(_0xf98d54){return _0xf98d54&&_0xf98d54[a1_0x5603('0x1')]?_0xf98d54:{'default':_0xf98d54};};Object['defineProperty'](exports,a1_0x5603('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5603('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x5603('0x3')));const lodash_1=__importDefault(require(a1_0x5603('0x4')));const User_1=__importDefault(require(a1_0x5603('0x5')));const LocalStrategy=passport_local_1[a1_0x5603('0x6')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5603('0x6')][a1_0x5603('0x7')];passport_1['default']['serializeUser']((_0x1f364c,_0x2ac9f8)=>{_0x2ac9f8(undefined,_0x1f364c['id']);});passport_1['default'][a1_0x5603('0x8')]((_0x43d257,_0x208938)=>{User_1[a1_0x5603('0x6')][a1_0x5603('0x9')](_0x43d257,(_0x12e7e2,_0x789f47)=>{_0x208938(_0x12e7e2,_0x789f47);});});passport_1['default'][a1_0x5603('0xa')](new LocalStrategy({'usernameField':'email'},(_0x156a55,_0x1802de,_0x3b2084)=>{User_1[a1_0x5603('0x6')][a1_0x5603('0xb')]({'email':_0x156a55['toLowerCase']()},(_0x5da051,_0x35045e)=>{if(_0x5da051){return _0x3b2084(_0x5da051);}if(!_0x35045e){return _0x3b2084(undefined,![],{'message':a1_0x5603('0xc')+_0x156a55+a1_0x5603('0xd')});}_0x35045e[a1_0x5603('0xe')](_0x1802de,(_0x5da051,_0x5d08fb)=>{if(_0x5da051){return _0x3b2084(_0x5da051);}if(_0x5d08fb){return _0x3b2084(undefined,_0x35045e);}return _0x3b2084(undefined,![],{'message':a1_0x5603('0xf')});});});}));passport_1[a1_0x5603('0x6')][a1_0x5603('0xa')](new FacebookStrategy({'clientID':process[a1_0x5603('0x10')][a1_0x5603('0x11')],'clientSecret':process[a1_0x5603('0x10')][a1_0x5603('0x12')],'callbackURL':a1_0x5603('0x13'),'profileFields':['name',a1_0x5603('0x14'),a1_0x5603('0x15'),a1_0x5603('0x16'),a1_0x5603('0x17')],'passReqToCallback':!![]},(_0x312799,_0x4ee450,_0x1c7b24,_0x132812,_0x13f986)=>{if(_0x312799[a1_0x5603('0x18')]){User_1[a1_0x5603('0x6')][a1_0x5603('0xb')]({'facebook':_0x132812['id']},(_0x3e6d0d,_0x2dcce5)=>{if(_0x3e6d0d){return _0x13f986(_0x3e6d0d);}if(_0x2dcce5){_0x312799['flash'](a1_0x5603('0x19'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x13f986(_0x3e6d0d);}else{User_1[a1_0x5603('0x6')]['findById'](_0x312799[a1_0x5603('0x18')]['id'],(_0x3e6d0d,_0x6de6d1)=>{if(_0x3e6d0d){return _0x13f986(_0x3e6d0d);}_0x6de6d1[a1_0x5603('0x1a')]=_0x132812['id'];_0x6de6d1[a1_0x5603('0x1b')][a1_0x5603('0x1c')]({'kind':a1_0x5603('0x1a'),'accessToken':_0x4ee450});_0x6de6d1['profile']['name']=_0x6de6d1['profile'][a1_0x5603('0x1d')]||_0x132812[a1_0x5603('0x1d')][a1_0x5603('0x1e')]+'\x20'+_0x132812[a1_0x5603('0x1d')][a1_0x5603('0x1f')];_0x6de6d1[a1_0x5603('0x20')]['gender']=_0x6de6d1['profile'][a1_0x5603('0x21')]||_0x132812[a1_0x5603('0x22')]['gender'];_0x6de6d1[a1_0x5603('0x20')][a1_0x5603('0x23')]=_0x6de6d1[a1_0x5603('0x20')][a1_0x5603('0x23')]||a1_0x5603('0x24')+_0x132812['id']+'/picture?type=large';_0x6de6d1[a1_0x5603('0x25')](_0x3e6d0d=>{_0x312799[a1_0x5603('0x26')]('info',{'msg':a1_0x5603('0x27')});_0x13f986(_0x3e6d0d,_0x6de6d1);});});}});}else{User_1[a1_0x5603('0x6')][a1_0x5603('0xb')]({'facebook':_0x132812['id']},(_0x3a1fe3,_0x10fcfa)=>{if(_0x3a1fe3){return _0x13f986(_0x3a1fe3);}if(_0x10fcfa){return _0x13f986(undefined,_0x10fcfa);}User_1['default'][a1_0x5603('0xb')]({'email':_0x132812[a1_0x5603('0x22')]['email']},(_0x3a1fe3,_0x35fb30)=>{if(_0x3a1fe3){return _0x13f986(_0x3a1fe3);}if(_0x35fb30){_0x312799[a1_0x5603('0x26')]('errors',{'msg':a1_0x5603('0x28')});_0x13f986(_0x3a1fe3);}else{const _0x3376db=new User_1[(a1_0x5603('0x6'))]();_0x3376db[a1_0x5603('0x14')]=_0x132812[a1_0x5603('0x22')][a1_0x5603('0x14')];_0x3376db['facebook']=_0x132812['id'];_0x3376db[a1_0x5603('0x1b')][a1_0x5603('0x1c')]({'kind':a1_0x5603('0x1a'),'accessToken':_0x4ee450});_0x3376db['profile'][a1_0x5603('0x1d')]=_0x132812[a1_0x5603('0x1d')]['givenName']+'\x20'+_0x132812['name'][a1_0x5603('0x1f')];_0x3376db[a1_0x5603('0x20')][a1_0x5603('0x21')]=_0x132812[a1_0x5603('0x22')][a1_0x5603('0x21')];_0x3376db[a1_0x5603('0x20')]['picture']=a1_0x5603('0x24')+_0x132812['id']+a1_0x5603('0x29');_0x3376db[a1_0x5603('0x20')][a1_0x5603('0x2a')]=_0x132812[a1_0x5603('0x22')]['location']?_0x132812['_json']['location']['name']:'';_0x3376db[a1_0x5603('0x25')](_0x3a1fe3=>{_0x13f986(_0x3a1fe3,_0x3376db);});}});});}}));exports['isAuthenticated']=(_0x3bed5a,_0x41d37e,_0x524db4)=>{if(_0x3bed5a['isAuthenticated']()){return _0x524db4();}_0x41d37e['redirect']('/login');};exports['isAuthorized']=(_0x2b692c,_0x267c79,_0x1a2448)=>{const _0x5cbba3=_0x2b692c[a1_0x5603('0x2b')][a1_0x5603('0x2c')]('/')[a1_0x5603('0x2d')](-0x1)[0x0];if(lodash_1['default'][a1_0x5603('0x2e')](_0x2b692c[a1_0x5603('0x18')][a1_0x5603('0x1b')],{'kind':_0x5cbba3})){_0x1a2448();}else{_0x267c79['redirect'](a1_0x5603('0x2f')+_0x5cbba3);}};