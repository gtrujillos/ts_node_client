var a1_0x5b6f=['user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','familyName','gender','profile','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','slice','find','redirect','/auth/','__importDefault','__esModule','passport-local','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone'];(function(_0x5d4cac,_0x1ec44a){var _0x1f5dc7=function(_0x5cdf16){while(--_0x5cdf16){_0x5d4cac['push'](_0x5d4cac['shift']());}};_0x1f5dc7(++_0x1ec44a);}(a1_0x5b6f,0xf7));var a1_0x2c69=function(_0x587216,_0x4ff990){_0x587216=_0x587216-0x0;var _0x309a00=a1_0x5b6f[_0x587216];return _0x309a00;};'use strict';var __importDefault=this&&this[a1_0x2c69('0x0')]||function(_0x3f59ad){return _0x3f59ad&&_0x3f59ad[a1_0x2c69('0x1')]?_0x3f59ad:{'default':_0x3f59ad};};Object['defineProperty'](exports,a1_0x2c69('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x2c69('0x2')));const passport_facebook_1=__importDefault(require(a1_0x2c69('0x3')));const lodash_1=__importDefault(require(a1_0x2c69('0x4')));const User_1=__importDefault(require(a1_0x2c69('0x5')));const LocalStrategy=passport_local_1[a1_0x2c69('0x6')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x2c69('0x6')][a1_0x2c69('0x7')];passport_1[a1_0x2c69('0x6')]['serializeUser']((_0x1d5168,_0x28fb04)=>{_0x28fb04(undefined,_0x1d5168['id']);});passport_1[a1_0x2c69('0x6')][a1_0x2c69('0x8')]((_0x197f35,_0x2e880d)=>{User_1[a1_0x2c69('0x6')][a1_0x2c69('0x9')](_0x197f35,(_0x4e0e1e,_0x32bf18)=>{_0x2e880d(_0x4e0e1e,_0x32bf18);});});passport_1[a1_0x2c69('0x6')][a1_0x2c69('0xa')](new LocalStrategy({'usernameField':a1_0x2c69('0xb')},(_0x448ff3,_0x31c04f,_0x2e587a)=>{User_1['default'][a1_0x2c69('0xc')]({'email':_0x448ff3[a1_0x2c69('0xd')]()},(_0x48c381,_0x50f825)=>{if(_0x48c381){return _0x2e587a(_0x48c381);}if(!_0x50f825){return _0x2e587a(undefined,![],{'message':a1_0x2c69('0xe')+_0x448ff3+'\x20not\x20found.'});}_0x50f825[a1_0x2c69('0xf')](_0x31c04f,(_0x48c381,_0x3859ac)=>{if(_0x48c381){return _0x2e587a(_0x48c381);}if(_0x3859ac){return _0x2e587a(undefined,_0x50f825);}return _0x2e587a(undefined,![],{'message':a1_0x2c69('0x10')});});});}));passport_1[a1_0x2c69('0x6')][a1_0x2c69('0xa')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x2c69('0x11')],'callbackURL':a1_0x2c69('0x12'),'profileFields':[a1_0x2c69('0x13'),a1_0x2c69('0xb'),a1_0x2c69('0x14'),a1_0x2c69('0x15'),a1_0x2c69('0x16')],'passReqToCallback':!![]},(_0x54a6fd,_0x42c72c,_0x420b6d,_0x132984,_0x5e9f00)=>{if(_0x54a6fd[a1_0x2c69('0x17')]){User_1[a1_0x2c69('0x6')][a1_0x2c69('0xc')]({'facebook':_0x132984['id']},(_0x2d4865,_0x118e65)=>{if(_0x2d4865){return _0x5e9f00(_0x2d4865);}if(_0x118e65){_0x54a6fd[a1_0x2c69('0x18')]('errors',{'msg':a1_0x2c69('0x19')});_0x5e9f00(_0x2d4865);}else{User_1[a1_0x2c69('0x6')]['findById'](_0x54a6fd[a1_0x2c69('0x17')]['id'],(_0x2d4865,_0x451ed6)=>{if(_0x2d4865){return _0x5e9f00(_0x2d4865);}_0x451ed6[a1_0x2c69('0x1a')]=_0x132984['id'];_0x451ed6[a1_0x2c69('0x1b')][a1_0x2c69('0x1c')]({'kind':a1_0x2c69('0x1a'),'accessToken':_0x42c72c});_0x451ed6['profile'][a1_0x2c69('0x13')]=_0x451ed6['profile'][a1_0x2c69('0x13')]||_0x132984[a1_0x2c69('0x13')]['givenName']+'\x20'+_0x132984[a1_0x2c69('0x13')][a1_0x2c69('0x1d')];_0x451ed6['profile'][a1_0x2c69('0x1e')]=_0x451ed6[a1_0x2c69('0x1f')][a1_0x2c69('0x1e')]||_0x132984[a1_0x2c69('0x20')]['gender'];_0x451ed6[a1_0x2c69('0x1f')]['picture']=_0x451ed6['profile'][a1_0x2c69('0x21')]||'https://graph.facebook.com/'+_0x132984['id']+a1_0x2c69('0x22');_0x451ed6[a1_0x2c69('0x23')](_0x2d4865=>{_0x54a6fd[a1_0x2c69('0x18')](a1_0x2c69('0x24'),{'msg':a1_0x2c69('0x25')});_0x5e9f00(_0x2d4865,_0x451ed6);});});}});}else{User_1['default'][a1_0x2c69('0xc')]({'facebook':_0x132984['id']},(_0x50e5c6,_0x4dd534)=>{if(_0x50e5c6){return _0x5e9f00(_0x50e5c6);}if(_0x4dd534){return _0x5e9f00(undefined,_0x4dd534);}User_1[a1_0x2c69('0x6')][a1_0x2c69('0xc')]({'email':_0x132984[a1_0x2c69('0x20')][a1_0x2c69('0xb')]},(_0x50e5c6,_0x1a6ac9)=>{if(_0x50e5c6){return _0x5e9f00(_0x50e5c6);}if(_0x1a6ac9){_0x54a6fd[a1_0x2c69('0x18')]('errors',{'msg':a1_0x2c69('0x26')});_0x5e9f00(_0x50e5c6);}else{const _0x5e4793=new User_1[(a1_0x2c69('0x6'))]();_0x5e4793[a1_0x2c69('0xb')]=_0x132984[a1_0x2c69('0x20')][a1_0x2c69('0xb')];_0x5e4793[a1_0x2c69('0x1a')]=_0x132984['id'];_0x5e4793[a1_0x2c69('0x1b')][a1_0x2c69('0x1c')]({'kind':'facebook','accessToken':_0x42c72c});_0x5e4793[a1_0x2c69('0x1f')]['name']=_0x132984[a1_0x2c69('0x13')]['givenName']+'\x20'+_0x132984[a1_0x2c69('0x13')][a1_0x2c69('0x1d')];_0x5e4793['profile']['gender']=_0x132984[a1_0x2c69('0x20')][a1_0x2c69('0x1e')];_0x5e4793[a1_0x2c69('0x1f')]['picture']=a1_0x2c69('0x27')+_0x132984['id']+'/picture?type=large';_0x5e4793[a1_0x2c69('0x1f')][a1_0x2c69('0x28')]=_0x132984[a1_0x2c69('0x20')][a1_0x2c69('0x28')]?_0x132984[a1_0x2c69('0x20')][a1_0x2c69('0x28')][a1_0x2c69('0x13')]:'';_0x5e4793[a1_0x2c69('0x23')](_0x50e5c6=>{_0x5e9f00(_0x50e5c6,_0x5e4793);});}});});}}));exports['isAuthenticated']=(_0x467d20,_0x5cc3fb,_0x209f19)=>{if(_0x467d20['isAuthenticated']()){return _0x209f19();}_0x5cc3fb['redirect']('/login');};exports['isAuthorized']=(_0x3588b6,_0x4d40c5,_0x1c14af)=>{const _0x21da57=_0x3588b6['path']['split']('/')[a1_0x2c69('0x29')](-0x1)[0x0];if(lodash_1[a1_0x2c69('0x6')][a1_0x2c69('0x2a')](_0x3588b6['user'][a1_0x2c69('0x1b')],{'kind':_0x21da57})){_0x1c14af();}else{_0x4d40c5[a1_0x2c69('0x2b')](a1_0x2c69('0x2c')+_0x21da57);}};