var a1_0x4f28=['user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','_json','location','save','isAuthenticated','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone'];(function(_0x58bd96,_0x349adb){var _0x5e329c=function(_0x2c8e92){while(--_0x2c8e92){_0x58bd96['push'](_0x58bd96['shift']());}};_0x5e329c(++_0x349adb);}(a1_0x4f28,0x166));var a1_0x2dc7=function(_0x338144,_0xb25cd6){_0x338144=_0x338144-0x0;var _0x4e2f77=a1_0x4f28[_0x338144];return _0x4e2f77;};'use strict';var __importDefault=this&&this[a1_0x2dc7('0x0')]||function(_0x8ee744){return _0x8ee744&&_0x8ee744['__esModule']?_0x8ee744:{'default':_0x8ee744};};Object[a1_0x2dc7('0x1')](exports,a1_0x2dc7('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2dc7('0x3')));const passport_local_1=__importDefault(require(a1_0x2dc7('0x4')));const passport_facebook_1=__importDefault(require(a1_0x2dc7('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x2dc7('0x6')));const LocalStrategy=passport_local_1[a1_0x2dc7('0x7')][a1_0x2dc7('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x2dc7('0x7')][a1_0x2dc7('0x8')];passport_1[a1_0x2dc7('0x7')][a1_0x2dc7('0x9')]((_0x4b082b,_0xdaa24f)=>{_0xdaa24f(undefined,_0x4b082b['id']);});passport_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xa')]((_0x4db559,_0x41c3ac)=>{User_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xb')](_0x4db559,(_0x5e1665,_0x454113)=>{_0x41c3ac(_0x5e1665,_0x454113);});});passport_1['default'][a1_0x2dc7('0xc')](new LocalStrategy({'usernameField':a1_0x2dc7('0xd')},(_0x596610,_0x1b5a99,_0x3c4ac8)=>{User_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xe')]({'email':_0x596610[a1_0x2dc7('0xf')]()},(_0x1cf821,_0x2cdc43)=>{if(_0x1cf821){return _0x3c4ac8(_0x1cf821);}if(!_0x2cdc43){return _0x3c4ac8(undefined,![],{'message':a1_0x2dc7('0x10')+_0x596610+a1_0x2dc7('0x11')});}_0x2cdc43[a1_0x2dc7('0x12')](_0x1b5a99,(_0x1cf821,_0x562dc8)=>{if(_0x1cf821){return _0x3c4ac8(_0x1cf821);}if(_0x562dc8){return _0x3c4ac8(undefined,_0x2cdc43);}return _0x3c4ac8(undefined,![],{'message':a1_0x2dc7('0x13')});});});}));passport_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xc')](new FacebookStrategy({'clientID':process['env'][a1_0x2dc7('0x14')],'clientSecret':process[a1_0x2dc7('0x15')][a1_0x2dc7('0x16')],'callbackURL':a1_0x2dc7('0x17'),'profileFields':[a1_0x2dc7('0x18'),'email',a1_0x2dc7('0x19'),'locale',a1_0x2dc7('0x1a')],'passReqToCallback':!![]},(_0x272449,_0xc8fe5f,_0x3e7012,_0xaea765,_0x20aa40)=>{if(_0x272449[a1_0x2dc7('0x1b')]){User_1[a1_0x2dc7('0x7')]['findOne']({'facebook':_0xaea765['id']},(_0x34abb8,_0x2a4fdc)=>{if(_0x34abb8){return _0x20aa40(_0x34abb8);}if(_0x2a4fdc){_0x272449[a1_0x2dc7('0x1c')](a1_0x2dc7('0x1d'),{'msg':a1_0x2dc7('0x1e')});_0x20aa40(_0x34abb8);}else{User_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xb')](_0x272449['user']['id'],(_0x34abb8,_0x292990)=>{if(_0x34abb8){return _0x20aa40(_0x34abb8);}_0x292990[a1_0x2dc7('0x1f')]=_0xaea765['id'];_0x292990[a1_0x2dc7('0x20')][a1_0x2dc7('0x21')]({'kind':a1_0x2dc7('0x1f'),'accessToken':_0xc8fe5f});_0x292990[a1_0x2dc7('0x22')][a1_0x2dc7('0x18')]=_0x292990[a1_0x2dc7('0x22')][a1_0x2dc7('0x18')]||_0xaea765['name'][a1_0x2dc7('0x23')]+'\x20'+_0xaea765['name'][a1_0x2dc7('0x24')];_0x292990[a1_0x2dc7('0x22')][a1_0x2dc7('0x25')]=_0x292990[a1_0x2dc7('0x22')][a1_0x2dc7('0x25')]||_0xaea765['_json']['gender'];_0x292990['profile'][a1_0x2dc7('0x26')]=_0x292990['profile']['picture']||a1_0x2dc7('0x27')+_0xaea765['id']+a1_0x2dc7('0x28');_0x292990['save'](_0x34abb8=>{_0x272449[a1_0x2dc7('0x1c')](a1_0x2dc7('0x29'),{'msg':a1_0x2dc7('0x2a')});_0x20aa40(_0x34abb8,_0x292990);});});}});}else{User_1[a1_0x2dc7('0x7')][a1_0x2dc7('0xe')]({'facebook':_0xaea765['id']},(_0x596ac6,_0x208636)=>{if(_0x596ac6){return _0x20aa40(_0x596ac6);}if(_0x208636){return _0x20aa40(undefined,_0x208636);}User_1['default'][a1_0x2dc7('0xe')]({'email':_0xaea765['_json']['email']},(_0x596ac6,_0x555073)=>{if(_0x596ac6){return _0x20aa40(_0x596ac6);}if(_0x555073){_0x272449['flash']('errors',{'msg':a1_0x2dc7('0x2b')});_0x20aa40(_0x596ac6);}else{const _0x2097d5=new User_1[(a1_0x2dc7('0x7'))]();_0x2097d5[a1_0x2dc7('0xd')]=_0xaea765[a1_0x2dc7('0x2c')][a1_0x2dc7('0xd')];_0x2097d5[a1_0x2dc7('0x1f')]=_0xaea765['id'];_0x2097d5[a1_0x2dc7('0x20')]['push']({'kind':a1_0x2dc7('0x1f'),'accessToken':_0xc8fe5f});_0x2097d5[a1_0x2dc7('0x22')]['name']=_0xaea765['name'][a1_0x2dc7('0x23')]+'\x20'+_0xaea765[a1_0x2dc7('0x18')][a1_0x2dc7('0x24')];_0x2097d5['profile'][a1_0x2dc7('0x25')]=_0xaea765['_json'][a1_0x2dc7('0x25')];_0x2097d5['profile']['picture']=a1_0x2dc7('0x27')+_0xaea765['id']+a1_0x2dc7('0x28');_0x2097d5['profile']['location']=_0xaea765[a1_0x2dc7('0x2c')][a1_0x2dc7('0x2d')]?_0xaea765[a1_0x2dc7('0x2c')]['location'][a1_0x2dc7('0x18')]:'';_0x2097d5[a1_0x2dc7('0x2e')](_0x596ac6=>{_0x20aa40(_0x596ac6,_0x2097d5);});}});});}}));exports[a1_0x2dc7('0x2f')]=(_0x15cc46,_0x1470f1,_0x18308a)=>{if(_0x15cc46[a1_0x2dc7('0x2f')]()){return _0x18308a();}_0x1470f1['redirect'](a1_0x2dc7('0x30'));};exports[a1_0x2dc7('0x31')]=(_0x539dff,_0x5bc86d,_0x15bd56)=>{const _0x103cea=_0x539dff[a1_0x2dc7('0x32')][a1_0x2dc7('0x33')]('/')[a1_0x2dc7('0x34')](-0x1)[0x0];if(lodash_1[a1_0x2dc7('0x7')][a1_0x2dc7('0x35')](_0x539dff[a1_0x2dc7('0x1b')][a1_0x2dc7('0x20')],{'kind':_0x103cea})){_0x15bd56();}else{_0x5bc86d['redirect'](a1_0x2dc7('0x36')+_0x103cea);}};