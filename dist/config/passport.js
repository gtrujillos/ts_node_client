var a1_0x17b6=['/auth/facebook/callback','name','link','locale','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','push','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','location','isAuthenticated','/login','path','split','slice','find','redirect','__importDefault','__esModule','passport-facebook','default','Strategy','serializeUser','findById','email','findOne','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env'];(function(_0x2d158c,_0x5267c3){var _0x228c42=function(_0x247644){while(--_0x247644){_0x2d158c['push'](_0x2d158c['shift']());}};_0x228c42(++_0x5267c3);}(a1_0x17b6,0x76));var a1_0x3311=function(_0x59d012,_0x566008){_0x59d012=_0x59d012-0x0;var _0x1f844b=a1_0x17b6[_0x59d012];return _0x1f844b;};'use strict';var __importDefault=this&&this[a1_0x3311('0x0')]||function(_0x5f20d0){return _0x5f20d0&&_0x5f20d0[a1_0x3311('0x1')]?_0x5f20d0:{'default':_0x5f20d0};};Object['defineProperty'](exports,a1_0x3311('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x3311('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x3311('0x3')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x3311('0x3')][a1_0x3311('0x4')];passport_1[a1_0x3311('0x3')][a1_0x3311('0x5')]((_0x210d5b,_0x5cfd37)=>{_0x5cfd37(undefined,_0x210d5b['id']);});passport_1['default']['deserializeUser']((_0x10ba8f,_0x2daca9)=>{User_1[a1_0x3311('0x3')][a1_0x3311('0x6')](_0x10ba8f,(_0x5d420c,_0x2d9a88)=>{_0x2daca9(_0x5d420c,_0x2d9a88);});});passport_1[a1_0x3311('0x3')]['use'](new LocalStrategy({'usernameField':a1_0x3311('0x7')},(_0x58a49d,_0x57ebf9,_0x1373ba)=>{User_1['default'][a1_0x3311('0x8')]({'email':_0x58a49d['toLowerCase']()},(_0x44df1f,_0x266448)=>{if(_0x44df1f){return _0x1373ba(_0x44df1f);}if(!_0x266448){return _0x1373ba(undefined,![],{'message':'Email\x20'+_0x58a49d+a1_0x3311('0x9')});}_0x266448[a1_0x3311('0xa')](_0x57ebf9,(_0x44df1f,_0x46eba)=>{if(_0x44df1f){return _0x1373ba(_0x44df1f);}if(_0x46eba){return _0x1373ba(undefined,_0x266448);}return _0x1373ba(undefined,![],{'message':a1_0x3311('0xb')});});});}));passport_1[a1_0x3311('0x3')]['use'](new FacebookStrategy({'clientID':process['env'][a1_0x3311('0xc')],'clientSecret':process[a1_0x3311('0xd')]['FACEBOOK_SECRET'],'callbackURL':a1_0x3311('0xe'),'profileFields':[a1_0x3311('0xf'),a1_0x3311('0x7'),a1_0x3311('0x10'),a1_0x3311('0x11'),'timezone'],'passReqToCallback':!![]},(_0x1c8b4e,_0x223a3c,_0x11cfbb,_0x405c3d,_0x761be2)=>{if(_0x1c8b4e[a1_0x3311('0x12')]){User_1[a1_0x3311('0x3')]['findOne']({'facebook':_0x405c3d['id']},(_0x474127,_0x2aa7b7)=>{if(_0x474127){return _0x761be2(_0x474127);}if(_0x2aa7b7){_0x1c8b4e[a1_0x3311('0x13')](a1_0x3311('0x14'),{'msg':a1_0x3311('0x15')});_0x761be2(_0x474127);}else{User_1[a1_0x3311('0x3')][a1_0x3311('0x6')](_0x1c8b4e[a1_0x3311('0x12')]['id'],(_0x474127,_0xdfa522)=>{if(_0x474127){return _0x761be2(_0x474127);}_0xdfa522[a1_0x3311('0x16')]=_0x405c3d['id'];_0xdfa522['tokens'][a1_0x3311('0x17')]({'kind':a1_0x3311('0x16'),'accessToken':_0x223a3c});_0xdfa522[a1_0x3311('0x18')]['name']=_0xdfa522[a1_0x3311('0x18')][a1_0x3311('0xf')]||_0x405c3d[a1_0x3311('0xf')][a1_0x3311('0x19')]+'\x20'+_0x405c3d[a1_0x3311('0xf')][a1_0x3311('0x1a')];_0xdfa522[a1_0x3311('0x18')][a1_0x3311('0x1b')]=_0xdfa522[a1_0x3311('0x18')]['gender']||_0x405c3d['_json']['gender'];_0xdfa522['profile'][a1_0x3311('0x1c')]=_0xdfa522[a1_0x3311('0x18')]['picture']||a1_0x3311('0x1d')+_0x405c3d['id']+a1_0x3311('0x1e');_0xdfa522[a1_0x3311('0x1f')](_0x474127=>{_0x1c8b4e[a1_0x3311('0x13')](a1_0x3311('0x20'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x761be2(_0x474127,_0xdfa522);});});}});}else{User_1[a1_0x3311('0x3')][a1_0x3311('0x8')]({'facebook':_0x405c3d['id']},(_0x2e6690,_0x2d00f1)=>{if(_0x2e6690){return _0x761be2(_0x2e6690);}if(_0x2d00f1){return _0x761be2(undefined,_0x2d00f1);}User_1[a1_0x3311('0x3')][a1_0x3311('0x8')]({'email':_0x405c3d[a1_0x3311('0x21')][a1_0x3311('0x7')]},(_0x2e6690,_0x5a73e0)=>{if(_0x2e6690){return _0x761be2(_0x2e6690);}if(_0x5a73e0){_0x1c8b4e[a1_0x3311('0x13')]('errors',{'msg':a1_0x3311('0x22')});_0x761be2(_0x2e6690);}else{const _0x15f0e7=new User_1[(a1_0x3311('0x3'))]();_0x15f0e7[a1_0x3311('0x7')]=_0x405c3d[a1_0x3311('0x21')][a1_0x3311('0x7')];_0x15f0e7['facebook']=_0x405c3d['id'];_0x15f0e7[a1_0x3311('0x23')]['push']({'kind':a1_0x3311('0x16'),'accessToken':_0x223a3c});_0x15f0e7[a1_0x3311('0x18')][a1_0x3311('0xf')]=_0x405c3d['name']['givenName']+'\x20'+_0x405c3d['name'][a1_0x3311('0x1a')];_0x15f0e7[a1_0x3311('0x18')]['gender']=_0x405c3d[a1_0x3311('0x21')][a1_0x3311('0x1b')];_0x15f0e7['profile']['picture']='https://graph.facebook.com/'+_0x405c3d['id']+a1_0x3311('0x1e');_0x15f0e7[a1_0x3311('0x18')][a1_0x3311('0x24')]=_0x405c3d[a1_0x3311('0x21')][a1_0x3311('0x24')]?_0x405c3d[a1_0x3311('0x21')]['location'][a1_0x3311('0xf')]:'';_0x15f0e7[a1_0x3311('0x1f')](_0x2e6690=>{_0x761be2(_0x2e6690,_0x15f0e7);});}});});}}));exports[a1_0x3311('0x25')]=(_0x337c54,_0x4d0aa4,_0xe9ef64)=>{if(_0x337c54[a1_0x3311('0x25')]()){return _0xe9ef64();}_0x4d0aa4['redirect'](a1_0x3311('0x26'));};exports['isAuthorized']=(_0xb83b2a,_0x44d594,_0x10a6f7)=>{const _0x5a555b=_0xb83b2a[a1_0x3311('0x27')][a1_0x3311('0x28')]('/')[a1_0x3311('0x29')](-0x1)[0x0];if(lodash_1[a1_0x3311('0x3')][a1_0x3311('0x2a')](_0xb83b2a['user'][a1_0x3311('0x23')],{'kind':_0x5a555b})){_0x10a6f7();}else{_0x44d594[a1_0x3311('0x2b')]('/auth/'+_0x5a555b);}};