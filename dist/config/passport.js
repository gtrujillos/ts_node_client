var a1_0x37a9=['/auth/facebook/callback','name','link','locale','timezone','user','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','save','flash','info','push','/picture?type=large','location','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__esModule','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','FACEBOOK_SECRET'];(function(_0x136b4f,_0xe370e5){var _0x54e08c=function(_0x5a325e){while(--_0x5a325e){_0x136b4f['push'](_0x136b4f['shift']());}};_0x54e08c(++_0xe370e5);}(a1_0x37a9,0x14b));var a1_0x3ca3=function(_0x22ed46,_0x59fe94){_0x22ed46=_0x22ed46-0x0;var _0x15208b=a1_0x37a9[_0x22ed46];return _0x15208b;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3b20e6){return _0x3b20e6&&_0x3b20e6[a1_0x3ca3('0x0')]?_0x3b20e6:{'default':_0x3b20e6};};Object['defineProperty'](exports,a1_0x3ca3('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3ca3('0x1')));const passport_local_1=__importDefault(require(a1_0x3ca3('0x2')));const passport_facebook_1=__importDefault(require(a1_0x3ca3('0x3')));const lodash_1=__importDefault(require(a1_0x3ca3('0x4')));const User_1=__importDefault(require(a1_0x3ca3('0x5')));const LocalStrategy=passport_local_1[a1_0x3ca3('0x6')]['Strategy'];const FacebookStrategy=passport_facebook_1['default'][a1_0x3ca3('0x7')];passport_1[a1_0x3ca3('0x6')]['serializeUser']((_0x4438c4,_0x277cff)=>{_0x277cff(undefined,_0x4438c4['id']);});passport_1[a1_0x3ca3('0x6')][a1_0x3ca3('0x8')]((_0x765b47,_0x16b379)=>{User_1[a1_0x3ca3('0x6')][a1_0x3ca3('0x9')](_0x765b47,(_0x1340d3,_0xafdc3d)=>{_0x16b379(_0x1340d3,_0xafdc3d);});});passport_1['default'][a1_0x3ca3('0xa')](new LocalStrategy({'usernameField':a1_0x3ca3('0xb')},(_0x38050b,_0x441f48,_0x105279)=>{User_1[a1_0x3ca3('0x6')][a1_0x3ca3('0xc')]({'email':_0x38050b[a1_0x3ca3('0xd')]()},(_0x24ee87,_0x4bd128)=>{if(_0x24ee87){return _0x105279(_0x24ee87);}if(!_0x4bd128){return _0x105279(undefined,![],{'message':a1_0x3ca3('0xe')+_0x38050b+a1_0x3ca3('0xf')});}_0x4bd128['comparePassword'](_0x441f48,(_0x24ee87,_0x4eeb91)=>{if(_0x24ee87){return _0x105279(_0x24ee87);}if(_0x4eeb91){return _0x105279(undefined,_0x4bd128);}return _0x105279(undefined,![],{'message':a1_0x3ca3('0x10')});});});}));passport_1[a1_0x3ca3('0x6')][a1_0x3ca3('0xa')](new FacebookStrategy({'clientID':process['env'][a1_0x3ca3('0x11')],'clientSecret':process['env'][a1_0x3ca3('0x12')],'callbackURL':a1_0x3ca3('0x13'),'profileFields':[a1_0x3ca3('0x14'),'email',a1_0x3ca3('0x15'),a1_0x3ca3('0x16'),a1_0x3ca3('0x17')],'passReqToCallback':!![]},(_0x570c8d,_0x12c01e,_0x28996c,_0x34c202,_0x2d99c8)=>{if(_0x570c8d[a1_0x3ca3('0x18')]){User_1['default'][a1_0x3ca3('0xc')]({'facebook':_0x34c202['id']},(_0x207d6d,_0x26a29a)=>{if(_0x207d6d){return _0x2d99c8(_0x207d6d);}if(_0x26a29a){_0x570c8d['flash'](a1_0x3ca3('0x19'),{'msg':a1_0x3ca3('0x1a')});_0x2d99c8(_0x207d6d);}else{User_1[a1_0x3ca3('0x6')][a1_0x3ca3('0x9')](_0x570c8d[a1_0x3ca3('0x18')]['id'],(_0x207d6d,_0x48abc1)=>{if(_0x207d6d){return _0x2d99c8(_0x207d6d);}_0x48abc1[a1_0x3ca3('0x1b')]=_0x34c202['id'];_0x48abc1[a1_0x3ca3('0x1c')]['push']({'kind':a1_0x3ca3('0x1b'),'accessToken':_0x12c01e});_0x48abc1['profile'][a1_0x3ca3('0x14')]=_0x48abc1[a1_0x3ca3('0x1d')][a1_0x3ca3('0x14')]||_0x34c202['name'][a1_0x3ca3('0x1e')]+'\x20'+_0x34c202[a1_0x3ca3('0x14')][a1_0x3ca3('0x1f')];_0x48abc1['profile'][a1_0x3ca3('0x20')]=_0x48abc1['profile']['gender']||_0x34c202[a1_0x3ca3('0x21')][a1_0x3ca3('0x20')];_0x48abc1[a1_0x3ca3('0x1d')][a1_0x3ca3('0x22')]=_0x48abc1[a1_0x3ca3('0x1d')]['picture']||a1_0x3ca3('0x23')+_0x34c202['id']+'/picture?type=large';_0x48abc1[a1_0x3ca3('0x24')](_0x207d6d=>{_0x570c8d[a1_0x3ca3('0x25')](a1_0x3ca3('0x26'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x2d99c8(_0x207d6d,_0x48abc1);});});}});}else{User_1[a1_0x3ca3('0x6')][a1_0x3ca3('0xc')]({'facebook':_0x34c202['id']},(_0x1817a1,_0x26a30c)=>{if(_0x1817a1){return _0x2d99c8(_0x1817a1);}if(_0x26a30c){return _0x2d99c8(undefined,_0x26a30c);}User_1[a1_0x3ca3('0x6')][a1_0x3ca3('0xc')]({'email':_0x34c202[a1_0x3ca3('0x21')][a1_0x3ca3('0xb')]},(_0x1817a1,_0x2acc85)=>{if(_0x1817a1){return _0x2d99c8(_0x1817a1);}if(_0x2acc85){_0x570c8d[a1_0x3ca3('0x25')](a1_0x3ca3('0x19'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x2d99c8(_0x1817a1);}else{const _0x5169e4=new User_1[(a1_0x3ca3('0x6'))]();_0x5169e4['email']=_0x34c202[a1_0x3ca3('0x21')][a1_0x3ca3('0xb')];_0x5169e4['facebook']=_0x34c202['id'];_0x5169e4[a1_0x3ca3('0x1c')][a1_0x3ca3('0x27')]({'kind':'facebook','accessToken':_0x12c01e});_0x5169e4['profile'][a1_0x3ca3('0x14')]=_0x34c202[a1_0x3ca3('0x14')][a1_0x3ca3('0x1e')]+'\x20'+_0x34c202['name'][a1_0x3ca3('0x1f')];_0x5169e4[a1_0x3ca3('0x1d')][a1_0x3ca3('0x20')]=_0x34c202[a1_0x3ca3('0x21')]['gender'];_0x5169e4[a1_0x3ca3('0x1d')]['picture']=a1_0x3ca3('0x23')+_0x34c202['id']+a1_0x3ca3('0x28');_0x5169e4['profile']['location']=_0x34c202[a1_0x3ca3('0x21')][a1_0x3ca3('0x29')]?_0x34c202[a1_0x3ca3('0x21')][a1_0x3ca3('0x29')][a1_0x3ca3('0x14')]:'';_0x5169e4[a1_0x3ca3('0x24')](_0x1817a1=>{_0x2d99c8(_0x1817a1,_0x5169e4);});}});});}}));exports['isAuthenticated']=(_0x39e210,_0x2bcfca,_0x4db7fd)=>{if(_0x39e210['isAuthenticated']()){return _0x4db7fd();}_0x2bcfca[a1_0x3ca3('0x2a')](a1_0x3ca3('0x2b'));};exports[a1_0x3ca3('0x2c')]=(_0x44e26f,_0x538a4b,_0x5bf155)=>{const _0x2f258d=_0x44e26f[a1_0x3ca3('0x2d')][a1_0x3ca3('0x2e')]('/')[a1_0x3ca3('0x2f')](-0x1)[0x0];if(lodash_1['default'][a1_0x3ca3('0x30')](_0x44e26f[a1_0x3ca3('0x18')]['tokens'],{'kind':_0x2f258d})){_0x5bf155();}else{_0x538a4b['redirect'](a1_0x3ca3('0x31')+_0x2f258d);}};