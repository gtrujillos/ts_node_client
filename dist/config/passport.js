var a1_0x7521=['profile','givenName','familyName','gender','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','flash','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','/login','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-facebook','../models/User','default','Strategy','findOne','toLowerCase','Email\x20','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_SECRET','/auth/facebook/callback','name','email','locale','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','user','tokens','push','facebook'];(function(_0x149ffe,_0x3967f6){var _0x474345=function(_0xc4d07a){while(--_0xc4d07a){_0x149ffe['push'](_0x149ffe['shift']());}};_0x474345(++_0x3967f6);}(a1_0x7521,0xa2));var a1_0x4911=function(_0x1903fc,_0x404e67){_0x1903fc=_0x1903fc-0x0;var _0x564c0d=a1_0x7521[_0x1903fc];return _0x564c0d;};'use strict';var __importDefault=this&&this[a1_0x4911('0x0')]||function(_0x59073c){return _0x59073c&&_0x59073c[a1_0x4911('0x1')]?_0x59073c:{'default':_0x59073c};};Object[a1_0x4911('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4911('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4911('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4911('0x5')));const LocalStrategy=passport_local_1[a1_0x4911('0x6')][a1_0x4911('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x4911('0x6')]['Strategy'];passport_1[a1_0x4911('0x6')]['serializeUser']((_0x3dd739,_0x133d12)=>{_0x133d12(undefined,_0x3dd739['id']);});passport_1[a1_0x4911('0x6')]['deserializeUser']((_0x4d98d5,_0x33bba5)=>{User_1[a1_0x4911('0x6')]['findById'](_0x4d98d5,(_0x43013a,_0x5a558a)=>{_0x33bba5(_0x43013a,_0x5a558a);});});passport_1['default']['use'](new LocalStrategy({'usernameField':'email'},(_0xd247db,_0x12225a,_0x2f0415)=>{User_1['default'][a1_0x4911('0x8')]({'email':_0xd247db[a1_0x4911('0x9')]()},(_0x4af15a,_0x52b911)=>{if(_0x4af15a){return _0x2f0415(_0x4af15a);}if(!_0x52b911){return _0x2f0415(undefined,![],{'message':a1_0x4911('0xa')+_0xd247db+'\x20not\x20found.'});}_0x52b911['comparePassword'](_0x12225a,(_0x4af15a,_0x4e16cb)=>{if(_0x4af15a){return _0x2f0415(_0x4af15a);}if(_0x4e16cb){return _0x2f0415(undefined,_0x52b911);}return _0x2f0415(undefined,![],{'message':a1_0x4911('0xb')});});});}));passport_1['default'][a1_0x4911('0xc')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x4911('0xd')][a1_0x4911('0xe')],'callbackURL':a1_0x4911('0xf'),'profileFields':[a1_0x4911('0x10'),a1_0x4911('0x11'),'link',a1_0x4911('0x12'),'timezone'],'passReqToCallback':!![]},(_0x45bf34,_0x25e11f,_0x1156e3,_0xd455ac,_0x485ebe)=>{if(_0x45bf34['user']){User_1[a1_0x4911('0x6')][a1_0x4911('0x8')]({'facebook':_0xd455ac['id']},(_0x19bd56,_0x27d489)=>{if(_0x19bd56){return _0x485ebe(_0x19bd56);}if(_0x27d489){_0x45bf34['flash'](a1_0x4911('0x13'),{'msg':a1_0x4911('0x14')});_0x485ebe(_0x19bd56);}else{User_1[a1_0x4911('0x6')][a1_0x4911('0x15')](_0x45bf34[a1_0x4911('0x16')]['id'],(_0x19bd56,_0x33449d)=>{if(_0x19bd56){return _0x485ebe(_0x19bd56);}_0x33449d['facebook']=_0xd455ac['id'];_0x33449d[a1_0x4911('0x17')][a1_0x4911('0x18')]({'kind':a1_0x4911('0x19'),'accessToken':_0x25e11f});_0x33449d[a1_0x4911('0x1a')][a1_0x4911('0x10')]=_0x33449d[a1_0x4911('0x1a')]['name']||_0xd455ac[a1_0x4911('0x10')][a1_0x4911('0x1b')]+'\x20'+_0xd455ac[a1_0x4911('0x10')][a1_0x4911('0x1c')];_0x33449d[a1_0x4911('0x1a')][a1_0x4911('0x1d')]=_0x33449d[a1_0x4911('0x1a')][a1_0x4911('0x1d')]||_0xd455ac[a1_0x4911('0x1e')][a1_0x4911('0x1d')];_0x33449d['profile'][a1_0x4911('0x1f')]=_0x33449d[a1_0x4911('0x1a')][a1_0x4911('0x1f')]||'https://graph.facebook.com/'+_0xd455ac['id']+a1_0x4911('0x20');_0x33449d[a1_0x4911('0x21')](_0x19bd56=>{_0x45bf34['flash'](a1_0x4911('0x22'),{'msg':a1_0x4911('0x23')});_0x485ebe(_0x19bd56,_0x33449d);});});}});}else{User_1[a1_0x4911('0x6')]['findOne']({'facebook':_0xd455ac['id']},(_0x2633a9,_0x21635d)=>{if(_0x2633a9){return _0x485ebe(_0x2633a9);}if(_0x21635d){return _0x485ebe(undefined,_0x21635d);}User_1[a1_0x4911('0x6')]['findOne']({'email':_0xd455ac[a1_0x4911('0x1e')][a1_0x4911('0x11')]},(_0x2633a9,_0x4dcf95)=>{if(_0x2633a9){return _0x485ebe(_0x2633a9);}if(_0x4dcf95){_0x45bf34[a1_0x4911('0x24')]('errors',{'msg':a1_0x4911('0x25')});_0x485ebe(_0x2633a9);}else{const _0x31d569=new User_1['default']();_0x31d569[a1_0x4911('0x11')]=_0xd455ac['_json']['email'];_0x31d569[a1_0x4911('0x19')]=_0xd455ac['id'];_0x31d569[a1_0x4911('0x17')]['push']({'kind':a1_0x4911('0x19'),'accessToken':_0x25e11f});_0x31d569[a1_0x4911('0x1a')]['name']=_0xd455ac[a1_0x4911('0x10')][a1_0x4911('0x1b')]+'\x20'+_0xd455ac['name'][a1_0x4911('0x1c')];_0x31d569['profile']['gender']=_0xd455ac[a1_0x4911('0x1e')][a1_0x4911('0x1d')];_0x31d569[a1_0x4911('0x1a')][a1_0x4911('0x1f')]='https://graph.facebook.com/'+_0xd455ac['id']+'/picture?type=large';_0x31d569[a1_0x4911('0x1a')][a1_0x4911('0x26')]=_0xd455ac[a1_0x4911('0x1e')][a1_0x4911('0x26')]?_0xd455ac['_json']['location'][a1_0x4911('0x10')]:'';_0x31d569[a1_0x4911('0x21')](_0x2633a9=>{_0x485ebe(_0x2633a9,_0x31d569);});}});});}}));exports[a1_0x4911('0x27')]=(_0x11a018,_0x197c50,_0x181764)=>{if(_0x11a018[a1_0x4911('0x27')]()){return _0x181764();}_0x197c50[a1_0x4911('0x28')](a1_0x4911('0x29'));};exports['isAuthorized']=(_0x18f086,_0x48464d,_0x4eb37e)=>{const _0x1d0a56=_0x18f086[a1_0x4911('0x2a')][a1_0x4911('0x2b')]('/')[a1_0x4911('0x2c')](-0x1)[0x0];if(lodash_1['default'][a1_0x4911('0x2d')](_0x18f086[a1_0x4911('0x16')][a1_0x4911('0x17')],{'kind':_0x1d0a56})){_0x4eb37e();}else{_0x48464d[a1_0x4911('0x28')](a1_0x4911('0x2e')+_0x1d0a56);}};