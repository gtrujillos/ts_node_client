var a1_0x1d75=['save','info','Facebook\x20account\x20has\x20been\x20linked.','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','default','Strategy','serializeUser','deserializeUser','findById','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','timezone','flash','errors','user','facebook','tokens','push','profile','name','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large'];(function(_0x3b569d,_0x310f48){var _0x49a2e5=function(_0x5d3c63){while(--_0x5d3c63){_0x3b569d['push'](_0x3b569d['shift']());}};_0x49a2e5(++_0x310f48);}(a1_0x1d75,0x74));var a1_0x9b2a=function(_0x1e4aca,_0x2227cf){_0x1e4aca=_0x1e4aca-0x0;var _0x4a2f11=a1_0x1d75[_0x1e4aca];return _0x4a2f11;};'use strict';var __importDefault=this&&this[a1_0x9b2a('0x0')]||function(_0x2dc4f9){return _0x2dc4f9&&_0x2dc4f9[a1_0x9b2a('0x1')]?_0x2dc4f9:{'default':_0x2dc4f9};};Object[a1_0x9b2a('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x9b2a('0x3')));const passport_local_1=__importDefault(require(a1_0x9b2a('0x4')));const passport_facebook_1=__importDefault(require(a1_0x9b2a('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x9b2a('0x6')][a1_0x9b2a('0x7')];passport_1[a1_0x9b2a('0x6')][a1_0x9b2a('0x8')]((_0x47a292,_0x48211c)=>{_0x48211c(undefined,_0x47a292['id']);});passport_1['default'][a1_0x9b2a('0x9')]((_0x42a772,_0x26816e)=>{User_1[a1_0x9b2a('0x6')][a1_0x9b2a('0xa')](_0x42a772,(_0x49cb34,_0x471a7d)=>{_0x26816e(_0x49cb34,_0x471a7d);});});passport_1['default']['use'](new LocalStrategy({'usernameField':a1_0x9b2a('0xb')},(_0x549038,_0x814e0b,_0x51e7d8)=>{User_1[a1_0x9b2a('0x6')][a1_0x9b2a('0xc')]({'email':_0x549038[a1_0x9b2a('0xd')]()},(_0x3c3f78,_0x19384a)=>{if(_0x3c3f78){return _0x51e7d8(_0x3c3f78);}if(!_0x19384a){return _0x51e7d8(undefined,![],{'message':a1_0x9b2a('0xe')+_0x549038+'\x20not\x20found.'});}_0x19384a[a1_0x9b2a('0xf')](_0x814e0b,(_0x3c3f78,_0x31e5f6)=>{if(_0x3c3f78){return _0x51e7d8(_0x3c3f78);}if(_0x31e5f6){return _0x51e7d8(undefined,_0x19384a);}return _0x51e7d8(undefined,![],{'message':a1_0x9b2a('0x10')});});});}));passport_1['default'][a1_0x9b2a('0x11')](new FacebookStrategy({'clientID':process[a1_0x9b2a('0x12')][a1_0x9b2a('0x13')],'clientSecret':process[a1_0x9b2a('0x12')][a1_0x9b2a('0x14')],'callbackURL':a1_0x9b2a('0x15'),'profileFields':['name','email',a1_0x9b2a('0x16'),a1_0x9b2a('0x17'),a1_0x9b2a('0x18')],'passReqToCallback':!![]},(_0x2e03fb,_0x22889d,_0x3724be,_0x2996c6,_0x2303d1)=>{if(_0x2e03fb['user']){User_1[a1_0x9b2a('0x6')][a1_0x9b2a('0xc')]({'facebook':_0x2996c6['id']},(_0x39cc0e,_0xb57615)=>{if(_0x39cc0e){return _0x2303d1(_0x39cc0e);}if(_0xb57615){_0x2e03fb[a1_0x9b2a('0x19')](a1_0x9b2a('0x1a'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x2303d1(_0x39cc0e);}else{User_1[a1_0x9b2a('0x6')][a1_0x9b2a('0xa')](_0x2e03fb[a1_0x9b2a('0x1b')]['id'],(_0x39cc0e,_0x3199c5)=>{if(_0x39cc0e){return _0x2303d1(_0x39cc0e);}_0x3199c5[a1_0x9b2a('0x1c')]=_0x2996c6['id'];_0x3199c5[a1_0x9b2a('0x1d')][a1_0x9b2a('0x1e')]({'kind':a1_0x9b2a('0x1c'),'accessToken':_0x22889d});_0x3199c5[a1_0x9b2a('0x1f')][a1_0x9b2a('0x20')]=_0x3199c5['profile']['name']||_0x2996c6[a1_0x9b2a('0x20')][a1_0x9b2a('0x21')]+'\x20'+_0x2996c6['name'][a1_0x9b2a('0x22')];_0x3199c5[a1_0x9b2a('0x1f')]['gender']=_0x3199c5['profile'][a1_0x9b2a('0x23')]||_0x2996c6[a1_0x9b2a('0x24')][a1_0x9b2a('0x23')];_0x3199c5[a1_0x9b2a('0x1f')][a1_0x9b2a('0x25')]=_0x3199c5[a1_0x9b2a('0x1f')]['picture']||a1_0x9b2a('0x26')+_0x2996c6['id']+a1_0x9b2a('0x27');_0x3199c5[a1_0x9b2a('0x28')](_0x39cc0e=>{_0x2e03fb[a1_0x9b2a('0x19')](a1_0x9b2a('0x29'),{'msg':a1_0x9b2a('0x2a')});_0x2303d1(_0x39cc0e,_0x3199c5);});});}});}else{User_1['default'][a1_0x9b2a('0xc')]({'facebook':_0x2996c6['id']},(_0x27e83b,_0x4f2529)=>{if(_0x27e83b){return _0x2303d1(_0x27e83b);}if(_0x4f2529){return _0x2303d1(undefined,_0x4f2529);}User_1[a1_0x9b2a('0x6')]['findOne']({'email':_0x2996c6['_json']['email']},(_0x27e83b,_0x599170)=>{if(_0x27e83b){return _0x2303d1(_0x27e83b);}if(_0x599170){_0x2e03fb['flash'](a1_0x9b2a('0x1a'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x2303d1(_0x27e83b);}else{const _0x24aaaa=new User_1[(a1_0x9b2a('0x6'))]();_0x24aaaa[a1_0x9b2a('0xb')]=_0x2996c6[a1_0x9b2a('0x24')][a1_0x9b2a('0xb')];_0x24aaaa[a1_0x9b2a('0x1c')]=_0x2996c6['id'];_0x24aaaa[a1_0x9b2a('0x1d')][a1_0x9b2a('0x1e')]({'kind':a1_0x9b2a('0x1c'),'accessToken':_0x22889d});_0x24aaaa['profile'][a1_0x9b2a('0x20')]=_0x2996c6[a1_0x9b2a('0x20')][a1_0x9b2a('0x21')]+'\x20'+_0x2996c6[a1_0x9b2a('0x20')]['familyName'];_0x24aaaa[a1_0x9b2a('0x1f')][a1_0x9b2a('0x23')]=_0x2996c6[a1_0x9b2a('0x24')][a1_0x9b2a('0x23')];_0x24aaaa['profile'][a1_0x9b2a('0x25')]=a1_0x9b2a('0x26')+_0x2996c6['id']+a1_0x9b2a('0x27');_0x24aaaa[a1_0x9b2a('0x1f')][a1_0x9b2a('0x2b')]=_0x2996c6[a1_0x9b2a('0x24')]['location']?_0x2996c6['_json'][a1_0x9b2a('0x2b')][a1_0x9b2a('0x20')]:'';_0x24aaaa['save'](_0x27e83b=>{_0x2303d1(_0x27e83b,_0x24aaaa);});}});});}}));exports[a1_0x9b2a('0x2c')]=(_0x335525,_0x3d3eee,_0x3e1cb8)=>{if(_0x335525[a1_0x9b2a('0x2c')]()){return _0x3e1cb8();}_0x3d3eee[a1_0x9b2a('0x2d')](a1_0x9b2a('0x2e'));};exports[a1_0x9b2a('0x2f')]=(_0x163eaa,_0x49fb8c,_0x1bad77)=>{const _0x2eb03f=_0x163eaa[a1_0x9b2a('0x30')][a1_0x9b2a('0x31')]('/')[a1_0x9b2a('0x32')](-0x1)[0x0];if(lodash_1[a1_0x9b2a('0x6')]['find'](_0x163eaa['user'][a1_0x9b2a('0x1d')],{'kind':_0x2eb03f})){_0x1bad77();}else{_0x49fb8c[a1_0x9b2a('0x2d')](a1_0x9b2a('0x33')+_0x2eb03f);}};