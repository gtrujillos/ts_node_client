var a1_0x370e=['__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','env','/auth/facebook/callback','name','link','timezone','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','tokens','push','facebook','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','info','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','/picture?type=large','location','isAuthenticated','redirect','/login','isAuthorized','path','split','/auth/','__importDefault'];(function(_0x1e8454,_0x503f5d){var _0x177472=function(_0x51ba19){while(--_0x51ba19){_0x1e8454['push'](_0x1e8454['shift']());}};_0x177472(++_0x503f5d);}(a1_0x370e,0x125));var a1_0x3cc7=function(_0x469fae,_0x13284d){_0x469fae=_0x469fae-0x0;var _0x40b95f=a1_0x370e[_0x469fae];return _0x40b95f;};'use strict';var __importDefault=this&&this[a1_0x3cc7('0x0')]||function(_0x5157e1){return _0x5157e1&&_0x5157e1[a1_0x3cc7('0x1')]?_0x5157e1:{'default':_0x5157e1};};Object[a1_0x3cc7('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x3cc7('0x3')));const passport_local_1=__importDefault(require(a1_0x3cc7('0x4')));const passport_facebook_1=__importDefault(require(a1_0x3cc7('0x5')));const lodash_1=__importDefault(require(a1_0x3cc7('0x6')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x3cc7('0x7')][a1_0x3cc7('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x3cc7('0x7')]['Strategy'];passport_1[a1_0x3cc7('0x7')][a1_0x3cc7('0x9')]((_0x3107c5,_0x19a530)=>{_0x19a530(undefined,_0x3107c5['id']);});passport_1[a1_0x3cc7('0x7')][a1_0x3cc7('0xa')]((_0x1ac4cc,_0x2655df)=>{User_1[a1_0x3cc7('0x7')][a1_0x3cc7('0xb')](_0x1ac4cc,(_0x31c94a,_0x319c60)=>{_0x2655df(_0x31c94a,_0x319c60);});});passport_1[a1_0x3cc7('0x7')][a1_0x3cc7('0xc')](new LocalStrategy({'usernameField':a1_0x3cc7('0xd')},(_0x3daef3,_0x23d1f6,_0x5f547e)=>{User_1[a1_0x3cc7('0x7')][a1_0x3cc7('0xe')]({'email':_0x3daef3[a1_0x3cc7('0xf')]()},(_0x10fbcc,_0x329c2e)=>{if(_0x10fbcc){return _0x5f547e(_0x10fbcc);}if(!_0x329c2e){return _0x5f547e(undefined,![],{'message':a1_0x3cc7('0x10')+_0x3daef3+a1_0x3cc7('0x11')});}_0x329c2e[a1_0x3cc7('0x12')](_0x23d1f6,(_0x10fbcc,_0x1ecbab)=>{if(_0x10fbcc){return _0x5f547e(_0x10fbcc);}if(_0x1ecbab){return _0x5f547e(undefined,_0x329c2e);}return _0x5f547e(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1['default'][a1_0x3cc7('0xc')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x3cc7('0x13')]['FACEBOOK_SECRET'],'callbackURL':a1_0x3cc7('0x14'),'profileFields':[a1_0x3cc7('0x15'),a1_0x3cc7('0xd'),a1_0x3cc7('0x16'),'locale',a1_0x3cc7('0x17')],'passReqToCallback':!![]},(_0x11a472,_0x583048,_0xef4bdd,_0x5978bf,_0x434571)=>{if(_0x11a472['user']){User_1['default'][a1_0x3cc7('0xe')]({'facebook':_0x5978bf['id']},(_0x4ae31c,_0x412441)=>{if(_0x4ae31c){return _0x434571(_0x4ae31c);}if(_0x412441){_0x11a472[a1_0x3cc7('0x18')]('errors',{'msg':a1_0x3cc7('0x19')});_0x434571(_0x4ae31c);}else{User_1[a1_0x3cc7('0x7')]['findById'](_0x11a472[a1_0x3cc7('0x1a')]['id'],(_0x4ae31c,_0x58b1dc)=>{if(_0x4ae31c){return _0x434571(_0x4ae31c);}_0x58b1dc['facebook']=_0x5978bf['id'];_0x58b1dc[a1_0x3cc7('0x1b')][a1_0x3cc7('0x1c')]({'kind':a1_0x3cc7('0x1d'),'accessToken':_0x583048});_0x58b1dc[a1_0x3cc7('0x1e')][a1_0x3cc7('0x15')]=_0x58b1dc[a1_0x3cc7('0x1e')][a1_0x3cc7('0x15')]||_0x5978bf[a1_0x3cc7('0x15')][a1_0x3cc7('0x1f')]+'\x20'+_0x5978bf[a1_0x3cc7('0x15')][a1_0x3cc7('0x20')];_0x58b1dc[a1_0x3cc7('0x1e')][a1_0x3cc7('0x21')]=_0x58b1dc['profile'][a1_0x3cc7('0x21')]||_0x5978bf[a1_0x3cc7('0x22')][a1_0x3cc7('0x21')];_0x58b1dc['profile'][a1_0x3cc7('0x23')]=_0x58b1dc[a1_0x3cc7('0x1e')][a1_0x3cc7('0x23')]||a1_0x3cc7('0x24')+_0x5978bf['id']+'/picture?type=large';_0x58b1dc['save'](_0x4ae31c=>{_0x11a472[a1_0x3cc7('0x18')](a1_0x3cc7('0x25'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x434571(_0x4ae31c,_0x58b1dc);});});}});}else{User_1[a1_0x3cc7('0x7')][a1_0x3cc7('0xe')]({'facebook':_0x5978bf['id']},(_0x475a2e,_0x188ec7)=>{if(_0x475a2e){return _0x434571(_0x475a2e);}if(_0x188ec7){return _0x434571(undefined,_0x188ec7);}User_1[a1_0x3cc7('0x7')]['findOne']({'email':_0x5978bf[a1_0x3cc7('0x22')][a1_0x3cc7('0xd')]},(_0x475a2e,_0x5dda48)=>{if(_0x475a2e){return _0x434571(_0x475a2e);}if(_0x5dda48){_0x11a472[a1_0x3cc7('0x18')](a1_0x3cc7('0x26'),{'msg':a1_0x3cc7('0x27')});_0x434571(_0x475a2e);}else{const _0xc304b=new User_1[(a1_0x3cc7('0x7'))]();_0xc304b[a1_0x3cc7('0xd')]=_0x5978bf[a1_0x3cc7('0x22')]['email'];_0xc304b[a1_0x3cc7('0x1d')]=_0x5978bf['id'];_0xc304b[a1_0x3cc7('0x1b')][a1_0x3cc7('0x1c')]({'kind':'facebook','accessToken':_0x583048});_0xc304b[a1_0x3cc7('0x1e')][a1_0x3cc7('0x15')]=_0x5978bf[a1_0x3cc7('0x15')]['givenName']+'\x20'+_0x5978bf[a1_0x3cc7('0x15')][a1_0x3cc7('0x20')];_0xc304b[a1_0x3cc7('0x1e')][a1_0x3cc7('0x21')]=_0x5978bf[a1_0x3cc7('0x22')][a1_0x3cc7('0x21')];_0xc304b[a1_0x3cc7('0x1e')][a1_0x3cc7('0x23')]=a1_0x3cc7('0x24')+_0x5978bf['id']+a1_0x3cc7('0x28');_0xc304b[a1_0x3cc7('0x1e')][a1_0x3cc7('0x29')]=_0x5978bf[a1_0x3cc7('0x22')][a1_0x3cc7('0x29')]?_0x5978bf['_json']['location'][a1_0x3cc7('0x15')]:'';_0xc304b['save'](_0x475a2e=>{_0x434571(_0x475a2e,_0xc304b);});}});});}}));exports[a1_0x3cc7('0x2a')]=(_0x13680e,_0x20d8bc,_0x25d187)=>{if(_0x13680e[a1_0x3cc7('0x2a')]()){return _0x25d187();}_0x20d8bc[a1_0x3cc7('0x2b')](a1_0x3cc7('0x2c'));};exports[a1_0x3cc7('0x2d')]=(_0x5922d7,_0x16b1ba,_0x54243b)=>{const _0x432686=_0x5922d7[a1_0x3cc7('0x2e')][a1_0x3cc7('0x2f')]('/')['slice'](-0x1)[0x0];if(lodash_1['default']['find'](_0x5922d7[a1_0x3cc7('0x1a')]['tokens'],{'kind':_0x432686})){_0x54243b();}else{_0x16b1ba[a1_0x3cc7('0x2b')](a1_0x3cc7('0x30')+_0x432686);}};