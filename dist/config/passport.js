var a1_0x4a3f=['profile','name','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','findOne','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','location','isAuthenticated','/login','isAuthorized','path','split','find','redirect','/auth/','__importDefault','__esModule','passport-local','lodash','default','Strategy','serializeUser','findById','use','email','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','locale','timezone','user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens'];(function(_0x170a6d,_0xd24b19){var _0x56f989=function(_0x12a05e){while(--_0x12a05e){_0x170a6d['push'](_0x170a6d['shift']());}};_0x56f989(++_0xd24b19);}(a1_0x4a3f,0x198));var a1_0x597f=function(_0x3e88c7,_0x1c4d1a){_0x3e88c7=_0x3e88c7-0x0;var _0x31aaad=a1_0x4a3f[_0x3e88c7];return _0x31aaad;};'use strict';var __importDefault=this&&this[a1_0x597f('0x0')]||function(_0x22e9ce){return _0x22e9ce&&_0x22e9ce[a1_0x597f('0x1')]?_0x22e9ce:{'default':_0x22e9ce};};Object['defineProperty'](exports,a1_0x597f('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x597f('0x2')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x597f('0x3')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x597f('0x4')][a1_0x597f('0x5')];const FacebookStrategy=passport_facebook_1[a1_0x597f('0x4')][a1_0x597f('0x5')];passport_1[a1_0x597f('0x4')][a1_0x597f('0x6')]((_0x21e6db,_0x324cea)=>{_0x324cea(undefined,_0x21e6db['id']);});passport_1[a1_0x597f('0x4')]['deserializeUser']((_0x2097f2,_0x5f4990)=>{User_1[a1_0x597f('0x4')][a1_0x597f('0x7')](_0x2097f2,(_0x3f806b,_0xc286d5)=>{_0x5f4990(_0x3f806b,_0xc286d5);});});passport_1[a1_0x597f('0x4')][a1_0x597f('0x8')](new LocalStrategy({'usernameField':a1_0x597f('0x9')},(_0x234af7,_0x917f63,_0x3ad2a5)=>{User_1[a1_0x597f('0x4')]['findOne']({'email':_0x234af7['toLowerCase']()},(_0x323564,_0x3a2202)=>{if(_0x323564){return _0x3ad2a5(_0x323564);}if(!_0x3a2202){return _0x3ad2a5(undefined,![],{'message':a1_0x597f('0xa')+_0x234af7+'\x20not\x20found.'});}_0x3a2202[a1_0x597f('0xb')](_0x917f63,(_0x323564,_0x3b64fe)=>{if(_0x323564){return _0x3ad2a5(_0x323564);}if(_0x3b64fe){return _0x3ad2a5(undefined,_0x3a2202);}return _0x3ad2a5(undefined,![],{'message':a1_0x597f('0xc')});});});}));passport_1[a1_0x597f('0x4')]['use'](new FacebookStrategy({'clientID':process[a1_0x597f('0xd')][a1_0x597f('0xe')],'clientSecret':process[a1_0x597f('0xd')][a1_0x597f('0xf')],'callbackURL':a1_0x597f('0x10'),'profileFields':['name',a1_0x597f('0x9'),'link',a1_0x597f('0x11'),a1_0x597f('0x12')],'passReqToCallback':!![]},(_0x22901f,_0x31b350,_0x4336b3,_0x470750,_0x30bb98)=>{if(_0x22901f[a1_0x597f('0x13')]){User_1[a1_0x597f('0x4')]['findOne']({'facebook':_0x470750['id']},(_0x2c2cc1,_0x32e062)=>{if(_0x2c2cc1){return _0x30bb98(_0x2c2cc1);}if(_0x32e062){_0x22901f[a1_0x597f('0x14')]('errors',{'msg':a1_0x597f('0x15')});_0x30bb98(_0x2c2cc1);}else{User_1[a1_0x597f('0x4')][a1_0x597f('0x7')](_0x22901f[a1_0x597f('0x13')]['id'],(_0x2c2cc1,_0x14d6dc)=>{if(_0x2c2cc1){return _0x30bb98(_0x2c2cc1);}_0x14d6dc[a1_0x597f('0x16')]=_0x470750['id'];_0x14d6dc[a1_0x597f('0x17')]['push']({'kind':a1_0x597f('0x16'),'accessToken':_0x31b350});_0x14d6dc[a1_0x597f('0x18')]['name']=_0x14d6dc[a1_0x597f('0x18')][a1_0x597f('0x19')]||_0x470750[a1_0x597f('0x19')][a1_0x597f('0x1a')]+'\x20'+_0x470750[a1_0x597f('0x19')][a1_0x597f('0x1b')];_0x14d6dc['profile'][a1_0x597f('0x1c')]=_0x14d6dc[a1_0x597f('0x18')]['gender']||_0x470750[a1_0x597f('0x1d')][a1_0x597f('0x1c')];_0x14d6dc[a1_0x597f('0x18')][a1_0x597f('0x1e')]=_0x14d6dc['profile'][a1_0x597f('0x1e')]||a1_0x597f('0x1f')+_0x470750['id']+a1_0x597f('0x20');_0x14d6dc[a1_0x597f('0x21')](_0x2c2cc1=>{_0x22901f[a1_0x597f('0x14')](a1_0x597f('0x22'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x30bb98(_0x2c2cc1,_0x14d6dc);});});}});}else{User_1[a1_0x597f('0x4')][a1_0x597f('0x23')]({'facebook':_0x470750['id']},(_0x1c2177,_0x38d882)=>{if(_0x1c2177){return _0x30bb98(_0x1c2177);}if(_0x38d882){return _0x30bb98(undefined,_0x38d882);}User_1['default'][a1_0x597f('0x23')]({'email':_0x470750['_json'][a1_0x597f('0x9')]},(_0x1c2177,_0x3b766f)=>{if(_0x1c2177){return _0x30bb98(_0x1c2177);}if(_0x3b766f){_0x22901f[a1_0x597f('0x14')](a1_0x597f('0x24'),{'msg':a1_0x597f('0x25')});_0x30bb98(_0x1c2177);}else{const _0x5f44e8=new User_1[(a1_0x597f('0x4'))]();_0x5f44e8['email']=_0x470750[a1_0x597f('0x1d')][a1_0x597f('0x9')];_0x5f44e8[a1_0x597f('0x16')]=_0x470750['id'];_0x5f44e8['tokens'][a1_0x597f('0x26')]({'kind':a1_0x597f('0x16'),'accessToken':_0x31b350});_0x5f44e8[a1_0x597f('0x18')]['name']=_0x470750['name'][a1_0x597f('0x1a')]+'\x20'+_0x470750[a1_0x597f('0x19')]['familyName'];_0x5f44e8[a1_0x597f('0x18')][a1_0x597f('0x1c')]=_0x470750[a1_0x597f('0x1d')][a1_0x597f('0x1c')];_0x5f44e8[a1_0x597f('0x18')][a1_0x597f('0x1e')]=a1_0x597f('0x1f')+_0x470750['id']+a1_0x597f('0x20');_0x5f44e8['profile'][a1_0x597f('0x27')]=_0x470750[a1_0x597f('0x1d')]['location']?_0x470750[a1_0x597f('0x1d')][a1_0x597f('0x27')][a1_0x597f('0x19')]:'';_0x5f44e8[a1_0x597f('0x21')](_0x1c2177=>{_0x30bb98(_0x1c2177,_0x5f44e8);});}});});}}));exports['isAuthenticated']=(_0x166e38,_0x3ad5dc,_0x38a6d1)=>{if(_0x166e38[a1_0x597f('0x28')]()){return _0x38a6d1();}_0x3ad5dc['redirect'](a1_0x597f('0x29'));};exports[a1_0x597f('0x2a')]=(_0x27f1d5,_0x2aabd3,_0x581610)=>{const _0x4dbf2c=_0x27f1d5[a1_0x597f('0x2b')][a1_0x597f('0x2c')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x597f('0x4')][a1_0x597f('0x2d')](_0x27f1d5['user'][a1_0x597f('0x17')],{'kind':_0x4dbf2c})){_0x581610();}else{_0x2aabd3[a1_0x597f('0x2e')](a1_0x597f('0x2f')+_0x4dbf2c);}};