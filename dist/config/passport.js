var a1_0x2e84=['info','Facebook\x20account\x20has\x20been\x20linked.','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','familyName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','slice','find','__esModule','defineProperty','passport','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser','email','findOne','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','user','tokens','push','profile','givenName','gender','_json','picture','/picture?type=large','save'];(function(_0x323005,_0x9758f4){var _0x3ac29b=function(_0x519040){while(--_0x519040){_0x323005['push'](_0x323005['shift']());}};_0x3ac29b(++_0x9758f4);}(a1_0x2e84,0x147));var a1_0x3334=function(_0x2202ea,_0x758f9a){_0x2202ea=_0x2202ea-0x0;var _0x545f65=a1_0x2e84[_0x2202ea];return _0x545f65;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2c4bdc){return _0x2c4bdc&&_0x2c4bdc[a1_0x3334('0x0')]?_0x2c4bdc:{'default':_0x2c4bdc};};Object[a1_0x3334('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x3334('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x3334('0x3')));const lodash_1=__importDefault(require(a1_0x3334('0x4')));const User_1=__importDefault(require(a1_0x3334('0x5')));const LocalStrategy=passport_local_1[a1_0x3334('0x6')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x3334('0x6')][a1_0x3334('0x7')];passport_1[a1_0x3334('0x6')][a1_0x3334('0x8')]((_0x303e31,_0x5b4aaf)=>{_0x5b4aaf(undefined,_0x303e31['id']);});passport_1['default'][a1_0x3334('0x9')]((_0x4adf5e,_0xd533ed)=>{User_1[a1_0x3334('0x6')]['findById'](_0x4adf5e,(_0x506de8,_0x1f2818)=>{_0xd533ed(_0x506de8,_0x1f2818);});});passport_1[a1_0x3334('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x3334('0xa')},(_0x4945e3,_0x4f3b17,_0x184813)=>{User_1[a1_0x3334('0x6')][a1_0x3334('0xb')]({'email':_0x4945e3[a1_0x3334('0xc')]()},(_0x5a6d16,_0x48db91)=>{if(_0x5a6d16){return _0x184813(_0x5a6d16);}if(!_0x48db91){return _0x184813(undefined,![],{'message':'Email\x20'+_0x4945e3+a1_0x3334('0xd')});}_0x48db91[a1_0x3334('0xe')](_0x4f3b17,(_0x5a6d16,_0x2b155e)=>{if(_0x5a6d16){return _0x184813(_0x5a6d16);}if(_0x2b155e){return _0x184813(undefined,_0x48db91);}return _0x184813(undefined,![],{'message':a1_0x3334('0xf')});});});}));passport_1['default'][a1_0x3334('0x10')](new FacebookStrategy({'clientID':process['env'][a1_0x3334('0x11')],'clientSecret':process[a1_0x3334('0x12')][a1_0x3334('0x13')],'callbackURL':a1_0x3334('0x14'),'profileFields':[a1_0x3334('0x15'),a1_0x3334('0xa'),a1_0x3334('0x16'),a1_0x3334('0x17'),a1_0x3334('0x18')],'passReqToCallback':!![]},(_0x42e1fb,_0x145bf6,_0x59b19f,_0x3efaca,_0x47a1cb)=>{if(_0x42e1fb['user']){User_1[a1_0x3334('0x6')][a1_0x3334('0xb')]({'facebook':_0x3efaca['id']},(_0x2b912b,_0xf7a08b)=>{if(_0x2b912b){return _0x47a1cb(_0x2b912b);}if(_0xf7a08b){_0x42e1fb['flash']('errors',{'msg':a1_0x3334('0x19')});_0x47a1cb(_0x2b912b);}else{User_1[a1_0x3334('0x6')][a1_0x3334('0x1a')](_0x42e1fb[a1_0x3334('0x1b')]['id'],(_0x2b912b,_0x166619)=>{if(_0x2b912b){return _0x47a1cb(_0x2b912b);}_0x166619['facebook']=_0x3efaca['id'];_0x166619[a1_0x3334('0x1c')][a1_0x3334('0x1d')]({'kind':'facebook','accessToken':_0x145bf6});_0x166619[a1_0x3334('0x1e')][a1_0x3334('0x15')]=_0x166619[a1_0x3334('0x1e')][a1_0x3334('0x15')]||_0x3efaca[a1_0x3334('0x15')][a1_0x3334('0x1f')]+'\x20'+_0x3efaca[a1_0x3334('0x15')]['familyName'];_0x166619['profile'][a1_0x3334('0x20')]=_0x166619['profile']['gender']||_0x3efaca[a1_0x3334('0x21')]['gender'];_0x166619[a1_0x3334('0x1e')][a1_0x3334('0x22')]=_0x166619['profile'][a1_0x3334('0x22')]||'https://graph.facebook.com/'+_0x3efaca['id']+a1_0x3334('0x23');_0x166619[a1_0x3334('0x24')](_0x2b912b=>{_0x42e1fb['flash'](a1_0x3334('0x25'),{'msg':a1_0x3334('0x26')});_0x47a1cb(_0x2b912b,_0x166619);});});}});}else{User_1[a1_0x3334('0x6')]['findOne']({'facebook':_0x3efaca['id']},(_0x27e6a3,_0x321e7a)=>{if(_0x27e6a3){return _0x47a1cb(_0x27e6a3);}if(_0x321e7a){return _0x47a1cb(undefined,_0x321e7a);}User_1[a1_0x3334('0x6')]['findOne']({'email':_0x3efaca['_json']['email']},(_0x27e6a3,_0x24f683)=>{if(_0x27e6a3){return _0x47a1cb(_0x27e6a3);}if(_0x24f683){_0x42e1fb['flash'](a1_0x3334('0x27'),{'msg':a1_0x3334('0x28')});_0x47a1cb(_0x27e6a3);}else{const _0x11e4ce=new User_1['default']();_0x11e4ce['email']=_0x3efaca['_json'][a1_0x3334('0xa')];_0x11e4ce[a1_0x3334('0x29')]=_0x3efaca['id'];_0x11e4ce[a1_0x3334('0x1c')][a1_0x3334('0x1d')]({'kind':a1_0x3334('0x29'),'accessToken':_0x145bf6});_0x11e4ce[a1_0x3334('0x1e')][a1_0x3334('0x15')]=_0x3efaca[a1_0x3334('0x15')]['givenName']+'\x20'+_0x3efaca[a1_0x3334('0x15')][a1_0x3334('0x2a')];_0x11e4ce[a1_0x3334('0x1e')][a1_0x3334('0x20')]=_0x3efaca['_json'][a1_0x3334('0x20')];_0x11e4ce['profile'][a1_0x3334('0x22')]=a1_0x3334('0x2b')+_0x3efaca['id']+a1_0x3334('0x23');_0x11e4ce[a1_0x3334('0x1e')][a1_0x3334('0x2c')]=_0x3efaca['_json'][a1_0x3334('0x2c')]?_0x3efaca[a1_0x3334('0x21')][a1_0x3334('0x2c')][a1_0x3334('0x15')]:'';_0x11e4ce[a1_0x3334('0x24')](_0x27e6a3=>{_0x47a1cb(_0x27e6a3,_0x11e4ce);});}});});}}));exports[a1_0x3334('0x2d')]=(_0xd77c59,_0x10c2c3,_0x3c4598)=>{if(_0xd77c59['isAuthenticated']()){return _0x3c4598();}_0x10c2c3[a1_0x3334('0x2e')](a1_0x3334('0x2f'));};exports[a1_0x3334('0x30')]=(_0x116c02,_0x12177e,_0x3645a2)=>{const _0x3f5211=_0x116c02[a1_0x3334('0x31')]['split']('/')[a1_0x3334('0x32')](-0x1)[0x0];if(lodash_1['default'][a1_0x3334('0x33')](_0x116c02[a1_0x3334('0x1b')][a1_0x3334('0x1c')],{'kind':_0x3f5211})){_0x3645a2();}else{_0x12177e[a1_0x3334('0x2e')]('/auth/'+_0x3f5211);}};