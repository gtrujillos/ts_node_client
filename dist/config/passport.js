var a1_0x5114=['Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','name','locale','timezone','user','errors','facebook','tokens','push','profile','givenName','gender','picture','https://graph.facebook.com/','save','flash','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','/picture?type=large','location','isAuthenticated','isAuthorized','path','slice','find','redirect','/auth/','__importDefault','__esModule','defineProperty','passport-local','passport-facebook','lodash','../models/User','default','Strategy','deserializeUser','findById','use','email','findOne','toLowerCase','\x20not\x20found.','comparePassword'];(function(_0x227e3a,_0x3fc6f7){var _0xc9db96=function(_0x14573d){while(--_0x14573d){_0x227e3a['push'](_0x227e3a['shift']());}};_0xc9db96(++_0x3fc6f7);}(a1_0x5114,0x138));var a1_0x90d6=function(_0x5af745,_0x467ac5){_0x5af745=_0x5af745-0x0;var _0x58d4f5=a1_0x5114[_0x5af745];return _0x58d4f5;};'use strict';var __importDefault=this&&this[a1_0x90d6('0x0')]||function(_0x513c84){return _0x513c84&&_0x513c84[a1_0x90d6('0x1')]?_0x513c84:{'default':_0x513c84};};Object[a1_0x90d6('0x2')](exports,a1_0x90d6('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x90d6('0x3')));const passport_facebook_1=__importDefault(require(a1_0x90d6('0x4')));const lodash_1=__importDefault(require(a1_0x90d6('0x5')));const User_1=__importDefault(require(a1_0x90d6('0x6')));const LocalStrategy=passport_local_1[a1_0x90d6('0x7')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x90d6('0x7')][a1_0x90d6('0x8')];passport_1[a1_0x90d6('0x7')]['serializeUser']((_0x2b2aa9,_0x59f0bc)=>{_0x59f0bc(undefined,_0x2b2aa9['id']);});passport_1[a1_0x90d6('0x7')][a1_0x90d6('0x9')]((_0x6d8a73,_0x3cf2e1)=>{User_1[a1_0x90d6('0x7')][a1_0x90d6('0xa')](_0x6d8a73,(_0x368fb0,_0x3c3013)=>{_0x3cf2e1(_0x368fb0,_0x3c3013);});});passport_1[a1_0x90d6('0x7')][a1_0x90d6('0xb')](new LocalStrategy({'usernameField':a1_0x90d6('0xc')},(_0x45bb35,_0x13d970,_0x92cca2)=>{User_1[a1_0x90d6('0x7')][a1_0x90d6('0xd')]({'email':_0x45bb35[a1_0x90d6('0xe')]()},(_0x1e6ddf,_0x294fd8)=>{if(_0x1e6ddf){return _0x92cca2(_0x1e6ddf);}if(!_0x294fd8){return _0x92cca2(undefined,![],{'message':'Email\x20'+_0x45bb35+a1_0x90d6('0xf')});}_0x294fd8[a1_0x90d6('0x10')](_0x13d970,(_0x1e6ddf,_0x2a1821)=>{if(_0x1e6ddf){return _0x92cca2(_0x1e6ddf);}if(_0x2a1821){return _0x92cca2(undefined,_0x294fd8);}return _0x92cca2(undefined,![],{'message':a1_0x90d6('0x11')});});});}));passport_1[a1_0x90d6('0x7')]['use'](new FacebookStrategy({'clientID':process[a1_0x90d6('0x12')][a1_0x90d6('0x13')],'clientSecret':process['env'][a1_0x90d6('0x14')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x90d6('0x15'),'email','link',a1_0x90d6('0x16'),a1_0x90d6('0x17')],'passReqToCallback':!![]},(_0x50eb14,_0x1b2e4d,_0x551bc2,_0x147b9a,_0x2d48ca)=>{if(_0x50eb14[a1_0x90d6('0x18')]){User_1[a1_0x90d6('0x7')][a1_0x90d6('0xd')]({'facebook':_0x147b9a['id']},(_0x9bf6b,_0x2cf6d0)=>{if(_0x9bf6b){return _0x2d48ca(_0x9bf6b);}if(_0x2cf6d0){_0x50eb14['flash'](a1_0x90d6('0x19'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x2d48ca(_0x9bf6b);}else{User_1[a1_0x90d6('0x7')]['findById'](_0x50eb14[a1_0x90d6('0x18')]['id'],(_0x9bf6b,_0x2f65e8)=>{if(_0x9bf6b){return _0x2d48ca(_0x9bf6b);}_0x2f65e8[a1_0x90d6('0x1a')]=_0x147b9a['id'];_0x2f65e8[a1_0x90d6('0x1b')][a1_0x90d6('0x1c')]({'kind':a1_0x90d6('0x1a'),'accessToken':_0x1b2e4d});_0x2f65e8['profile'][a1_0x90d6('0x15')]=_0x2f65e8[a1_0x90d6('0x1d')][a1_0x90d6('0x15')]||_0x147b9a['name'][a1_0x90d6('0x1e')]+'\x20'+_0x147b9a['name']['familyName'];_0x2f65e8[a1_0x90d6('0x1d')]['gender']=_0x2f65e8[a1_0x90d6('0x1d')]['gender']||_0x147b9a['_json'][a1_0x90d6('0x1f')];_0x2f65e8[a1_0x90d6('0x1d')][a1_0x90d6('0x20')]=_0x2f65e8['profile'][a1_0x90d6('0x20')]||a1_0x90d6('0x21')+_0x147b9a['id']+'/picture?type=large';_0x2f65e8[a1_0x90d6('0x22')](_0x9bf6b=>{_0x50eb14[a1_0x90d6('0x23')]('info',{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x2d48ca(_0x9bf6b,_0x2f65e8);});});}});}else{User_1['default']['findOne']({'facebook':_0x147b9a['id']},(_0x4cc7ec,_0x2b30e9)=>{if(_0x4cc7ec){return _0x2d48ca(_0x4cc7ec);}if(_0x2b30e9){return _0x2d48ca(undefined,_0x2b30e9);}User_1[a1_0x90d6('0x7')][a1_0x90d6('0xd')]({'email':_0x147b9a[a1_0x90d6('0x24')][a1_0x90d6('0xc')]},(_0x4cc7ec,_0xf881e6)=>{if(_0x4cc7ec){return _0x2d48ca(_0x4cc7ec);}if(_0xf881e6){_0x50eb14[a1_0x90d6('0x23')](a1_0x90d6('0x19'),{'msg':a1_0x90d6('0x25')});_0x2d48ca(_0x4cc7ec);}else{const _0x1e6183=new User_1['default']();_0x1e6183['email']=_0x147b9a['_json'][a1_0x90d6('0xc')];_0x1e6183[a1_0x90d6('0x1a')]=_0x147b9a['id'];_0x1e6183[a1_0x90d6('0x1b')][a1_0x90d6('0x1c')]({'kind':a1_0x90d6('0x1a'),'accessToken':_0x1b2e4d});_0x1e6183[a1_0x90d6('0x1d')][a1_0x90d6('0x15')]=_0x147b9a['name'][a1_0x90d6('0x1e')]+'\x20'+_0x147b9a[a1_0x90d6('0x15')]['familyName'];_0x1e6183[a1_0x90d6('0x1d')][a1_0x90d6('0x1f')]=_0x147b9a['_json']['gender'];_0x1e6183[a1_0x90d6('0x1d')]['picture']=a1_0x90d6('0x21')+_0x147b9a['id']+a1_0x90d6('0x26');_0x1e6183[a1_0x90d6('0x1d')]['location']=_0x147b9a[a1_0x90d6('0x24')][a1_0x90d6('0x27')]?_0x147b9a[a1_0x90d6('0x24')][a1_0x90d6('0x27')]['name']:'';_0x1e6183['save'](_0x4cc7ec=>{_0x2d48ca(_0x4cc7ec,_0x1e6183);});}});});}}));exports[a1_0x90d6('0x28')]=(_0x5af6a5,_0xb129c4,_0x1c25a5)=>{if(_0x5af6a5[a1_0x90d6('0x28')]()){return _0x1c25a5();}_0xb129c4['redirect']('/login');};exports[a1_0x90d6('0x29')]=(_0xe3d9d3,_0x426e9d,_0x4513c2)=>{const _0x2f4b47=_0xe3d9d3[a1_0x90d6('0x2a')]['split']('/')[a1_0x90d6('0x2b')](-0x1)[0x0];if(lodash_1[a1_0x90d6('0x7')][a1_0x90d6('0x2c')](_0xe3d9d3[a1_0x90d6('0x18')][a1_0x90d6('0x1b')],{'kind':_0x2f4b47})){_0x4513c2();}else{_0x426e9d[a1_0x90d6('0x2d')](a1_0x90d6('0x2e')+_0x2f4b47);}};