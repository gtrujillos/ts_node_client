var a1_0x2ba8=['env','FACEBOOK_ID','FACEBOOK_SECRET','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','push','profile','name','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','_json','tokens','location','isAuthenticated','redirect','/login','isAuthorized','path','slice','find','__importDefault','__esModule','passport','passport-facebook','../models/User','Strategy','default','deserializeUser','findById','email','findOne','toLowerCase','\x20not\x20found.','Invalid\x20email\x20or\x20password.','use'];(function(_0x4b5383,_0x4a630d){var _0x195d98=function(_0xd6f591){while(--_0xd6f591){_0x4b5383['push'](_0x4b5383['shift']());}};_0x195d98(++_0x4a630d);}(a1_0x2ba8,0x171));var a1_0x4f11=function(_0x1c3508,_0x4cd224){_0x1c3508=_0x1c3508-0x0;var _0x28920a=a1_0x2ba8[_0x1c3508];return _0x28920a;};'use strict';var __importDefault=this&&this[a1_0x4f11('0x0')]||function(_0x150f90){return _0x150f90&&_0x150f90[a1_0x4f11('0x1')]?_0x150f90:{'default':_0x150f90};};Object['defineProperty'](exports,a1_0x4f11('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4f11('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4f11('0x3')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4f11('0x4')));const LocalStrategy=passport_local_1['default'][a1_0x4f11('0x5')];const FacebookStrategy=passport_facebook_1['default'][a1_0x4f11('0x5')];passport_1['default']['serializeUser']((_0x8ab52b,_0x511639)=>{_0x511639(undefined,_0x8ab52b['id']);});passport_1[a1_0x4f11('0x6')][a1_0x4f11('0x7')]((_0x2ca405,_0x398e05)=>{User_1[a1_0x4f11('0x6')][a1_0x4f11('0x8')](_0x2ca405,(_0x375d3f,_0x3e5721)=>{_0x398e05(_0x375d3f,_0x3e5721);});});passport_1[a1_0x4f11('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x4f11('0x9')},(_0x161fc8,_0x1e5c14,_0x52cf86)=>{User_1[a1_0x4f11('0x6')][a1_0x4f11('0xa')]({'email':_0x161fc8[a1_0x4f11('0xb')]()},(_0x1b0883,_0x1347e1)=>{if(_0x1b0883){return _0x52cf86(_0x1b0883);}if(!_0x1347e1){return _0x52cf86(undefined,![],{'message':'Email\x20'+_0x161fc8+a1_0x4f11('0xc')});}_0x1347e1['comparePassword'](_0x1e5c14,(_0x1b0883,_0x2058a0)=>{if(_0x1b0883){return _0x52cf86(_0x1b0883);}if(_0x2058a0){return _0x52cf86(undefined,_0x1347e1);}return _0x52cf86(undefined,![],{'message':a1_0x4f11('0xd')});});});}));passport_1[a1_0x4f11('0x6')][a1_0x4f11('0xe')](new FacebookStrategy({'clientID':process[a1_0x4f11('0xf')][a1_0x4f11('0x10')],'clientSecret':process[a1_0x4f11('0xf')][a1_0x4f11('0x11')],'callbackURL':'/auth/facebook/callback','profileFields':['name',a1_0x4f11('0x9'),'link',a1_0x4f11('0x12'),a1_0x4f11('0x13')],'passReqToCallback':!![]},(_0x305f0d,_0x540176,_0xa0af2f,_0x46a995,_0x323f5d)=>{if(_0x305f0d[a1_0x4f11('0x14')]){User_1['default'][a1_0x4f11('0xa')]({'facebook':_0x46a995['id']},(_0x2d1c2e,_0x5e656e)=>{if(_0x2d1c2e){return _0x323f5d(_0x2d1c2e);}if(_0x5e656e){_0x305f0d[a1_0x4f11('0x15')](a1_0x4f11('0x16'),{'msg':a1_0x4f11('0x17')});_0x323f5d(_0x2d1c2e);}else{User_1[a1_0x4f11('0x6')][a1_0x4f11('0x8')](_0x305f0d[a1_0x4f11('0x14')]['id'],(_0x2d1c2e,_0x31856f)=>{if(_0x2d1c2e){return _0x323f5d(_0x2d1c2e);}_0x31856f[a1_0x4f11('0x18')]=_0x46a995['id'];_0x31856f['tokens'][a1_0x4f11('0x19')]({'kind':'facebook','accessToken':_0x540176});_0x31856f[a1_0x4f11('0x1a')]['name']=_0x31856f[a1_0x4f11('0x1a')][a1_0x4f11('0x1b')]||_0x46a995[a1_0x4f11('0x1b')][a1_0x4f11('0x1c')]+'\x20'+_0x46a995['name'][a1_0x4f11('0x1d')];_0x31856f[a1_0x4f11('0x1a')]['gender']=_0x31856f[a1_0x4f11('0x1a')]['gender']||_0x46a995['_json'][a1_0x4f11('0x1e')];_0x31856f[a1_0x4f11('0x1a')][a1_0x4f11('0x1f')]=_0x31856f['profile'][a1_0x4f11('0x1f')]||a1_0x4f11('0x20')+_0x46a995['id']+a1_0x4f11('0x21');_0x31856f[a1_0x4f11('0x22')](_0x2d1c2e=>{_0x305f0d[a1_0x4f11('0x15')](a1_0x4f11('0x23'),{'msg':a1_0x4f11('0x24')});_0x323f5d(_0x2d1c2e,_0x31856f);});});}});}else{User_1[a1_0x4f11('0x6')][a1_0x4f11('0xa')]({'facebook':_0x46a995['id']},(_0x543f51,_0x2ddd36)=>{if(_0x543f51){return _0x323f5d(_0x543f51);}if(_0x2ddd36){return _0x323f5d(undefined,_0x2ddd36);}User_1[a1_0x4f11('0x6')][a1_0x4f11('0xa')]({'email':_0x46a995['_json'][a1_0x4f11('0x9')]},(_0x543f51,_0x49fa5b)=>{if(_0x543f51){return _0x323f5d(_0x543f51);}if(_0x49fa5b){_0x305f0d['flash']('errors',{'msg':a1_0x4f11('0x25')});_0x323f5d(_0x543f51);}else{const _0x321259=new User_1[(a1_0x4f11('0x6'))]();_0x321259[a1_0x4f11('0x9')]=_0x46a995[a1_0x4f11('0x26')][a1_0x4f11('0x9')];_0x321259[a1_0x4f11('0x18')]=_0x46a995['id'];_0x321259[a1_0x4f11('0x27')][a1_0x4f11('0x19')]({'kind':a1_0x4f11('0x18'),'accessToken':_0x540176});_0x321259[a1_0x4f11('0x1a')][a1_0x4f11('0x1b')]=_0x46a995[a1_0x4f11('0x1b')][a1_0x4f11('0x1c')]+'\x20'+_0x46a995[a1_0x4f11('0x1b')][a1_0x4f11('0x1d')];_0x321259[a1_0x4f11('0x1a')]['gender']=_0x46a995[a1_0x4f11('0x26')][a1_0x4f11('0x1e')];_0x321259[a1_0x4f11('0x1a')][a1_0x4f11('0x1f')]=a1_0x4f11('0x20')+_0x46a995['id']+a1_0x4f11('0x21');_0x321259[a1_0x4f11('0x1a')]['location']=_0x46a995['_json'][a1_0x4f11('0x28')]?_0x46a995[a1_0x4f11('0x26')][a1_0x4f11('0x28')][a1_0x4f11('0x1b')]:'';_0x321259['save'](_0x543f51=>{_0x323f5d(_0x543f51,_0x321259);});}});});}}));exports[a1_0x4f11('0x29')]=(_0x539cf1,_0x2a4828,_0x22ca0b)=>{if(_0x539cf1['isAuthenticated']()){return _0x22ca0b();}_0x2a4828[a1_0x4f11('0x2a')](a1_0x4f11('0x2b'));};exports[a1_0x4f11('0x2c')]=(_0x32fd9d,_0x11916e,_0x26a318)=>{const _0x7937c3=_0x32fd9d[a1_0x4f11('0x2d')]['split']('/')[a1_0x4f11('0x2e')](-0x1)[0x0];if(lodash_1['default'][a1_0x4f11('0x2f')](_0x32fd9d['user']['tokens'],{'kind':_0x7937c3})){_0x26a318();}else{_0x11916e[a1_0x4f11('0x2a')]('/auth/'+_0x7937c3);}};