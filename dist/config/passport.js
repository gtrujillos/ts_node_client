var a1_0xf442=['find','/auth/','__importDefault','__esModule','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','deserializeUser','findById','use','email','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','link','timezone','user','findOne','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','name','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','save','isAuthenticated','redirect','/login','isAuthorized','path','slice'];(function(_0x31fa8d,_0xdaa038){var _0x15a675=function(_0x1b25b3){while(--_0x1b25b3){_0x31fa8d['push'](_0x31fa8d['shift']());}};_0x15a675(++_0xdaa038);}(a1_0xf442,0xd2));var a1_0x3931=function(_0x1de7c8,_0x3d059b){_0x1de7c8=_0x1de7c8-0x0;var _0x5b6b44=a1_0xf442[_0x1de7c8];return _0x5b6b44;};'use strict';var __importDefault=this&&this[a1_0x3931('0x0')]||function(_0x12f2c5){return _0x12f2c5&&_0x12f2c5[a1_0x3931('0x1')]?_0x12f2c5:{'default':_0x12f2c5};};Object['defineProperty'](exports,a1_0x3931('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3931('0x2')));const passport_local_1=__importDefault(require(a1_0x3931('0x3')));const passport_facebook_1=__importDefault(require(a1_0x3931('0x4')));const lodash_1=__importDefault(require(a1_0x3931('0x5')));const User_1=__importDefault(require(a1_0x3931('0x6')));const LocalStrategy=passport_local_1['default'][a1_0x3931('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x3931('0x8')][a1_0x3931('0x7')];passport_1[a1_0x3931('0x8')]['serializeUser']((_0x539655,_0x4df5d3)=>{_0x4df5d3(undefined,_0x539655['id']);});passport_1['default'][a1_0x3931('0x9')]((_0x276842,_0x188912)=>{User_1[a1_0x3931('0x8')][a1_0x3931('0xa')](_0x276842,(_0xb7ddeb,_0xfbcc9b)=>{_0x188912(_0xb7ddeb,_0xfbcc9b);});});passport_1[a1_0x3931('0x8')][a1_0x3931('0xb')](new LocalStrategy({'usernameField':a1_0x3931('0xc')},(_0x4fd967,_0x4ffcfb,_0x4c1b29)=>{User_1['default']['findOne']({'email':_0x4fd967['toLowerCase']()},(_0x38c8f9,_0x28d1ee)=>{if(_0x38c8f9){return _0x4c1b29(_0x38c8f9);}if(!_0x28d1ee){return _0x4c1b29(undefined,![],{'message':a1_0x3931('0xd')+_0x4fd967+a1_0x3931('0xe')});}_0x28d1ee['comparePassword'](_0x4ffcfb,(_0x38c8f9,_0x37c56d)=>{if(_0x38c8f9){return _0x4c1b29(_0x38c8f9);}if(_0x37c56d){return _0x4c1b29(undefined,_0x28d1ee);}return _0x4c1b29(undefined,![],{'message':a1_0x3931('0xf')});});});}));passport_1[a1_0x3931('0x8')][a1_0x3931('0xb')](new FacebookStrategy({'clientID':process[a1_0x3931('0x10')][a1_0x3931('0x11')],'clientSecret':process['env'][a1_0x3931('0x12')],'callbackURL':a1_0x3931('0x13'),'profileFields':['name','email',a1_0x3931('0x14'),'locale',a1_0x3931('0x15')],'passReqToCallback':!![]},(_0x18be8a,_0x3013da,_0x1a9a24,_0x129ee7,_0x4d70f3)=>{if(_0x18be8a[a1_0x3931('0x16')]){User_1[a1_0x3931('0x8')][a1_0x3931('0x17')]({'facebook':_0x129ee7['id']},(_0x3a8aeb,_0x63ee4f)=>{if(_0x3a8aeb){return _0x4d70f3(_0x3a8aeb);}if(_0x63ee4f){_0x18be8a[a1_0x3931('0x18')]('errors',{'msg':a1_0x3931('0x19')});_0x4d70f3(_0x3a8aeb);}else{User_1['default']['findById'](_0x18be8a[a1_0x3931('0x16')]['id'],(_0x3a8aeb,_0x51ee13)=>{if(_0x3a8aeb){return _0x4d70f3(_0x3a8aeb);}_0x51ee13[a1_0x3931('0x1a')]=_0x129ee7['id'];_0x51ee13[a1_0x3931('0x1b')][a1_0x3931('0x1c')]({'kind':a1_0x3931('0x1a'),'accessToken':_0x3013da});_0x51ee13[a1_0x3931('0x1d')]['name']=_0x51ee13['profile']['name']||_0x129ee7[a1_0x3931('0x1e')][a1_0x3931('0x1f')]+'\x20'+_0x129ee7[a1_0x3931('0x1e')][a1_0x3931('0x20')];_0x51ee13['profile'][a1_0x3931('0x21')]=_0x51ee13[a1_0x3931('0x1d')]['gender']||_0x129ee7[a1_0x3931('0x22')][a1_0x3931('0x21')];_0x51ee13['profile']['picture']=_0x51ee13['profile'][a1_0x3931('0x23')]||a1_0x3931('0x24')+_0x129ee7['id']+a1_0x3931('0x25');_0x51ee13['save'](_0x3a8aeb=>{_0x18be8a[a1_0x3931('0x18')](a1_0x3931('0x26'),{'msg':a1_0x3931('0x27')});_0x4d70f3(_0x3a8aeb,_0x51ee13);});});}});}else{User_1['default']['findOne']({'facebook':_0x129ee7['id']},(_0x35e273,_0x142d1b)=>{if(_0x35e273){return _0x4d70f3(_0x35e273);}if(_0x142d1b){return _0x4d70f3(undefined,_0x142d1b);}User_1[a1_0x3931('0x8')][a1_0x3931('0x17')]({'email':_0x129ee7[a1_0x3931('0x22')][a1_0x3931('0xc')]},(_0x35e273,_0x507ae9)=>{if(_0x35e273){return _0x4d70f3(_0x35e273);}if(_0x507ae9){_0x18be8a['flash'](a1_0x3931('0x28'),{'msg':a1_0x3931('0x29')});_0x4d70f3(_0x35e273);}else{const _0x59dd2a=new User_1['default']();_0x59dd2a[a1_0x3931('0xc')]=_0x129ee7[a1_0x3931('0x22')][a1_0x3931('0xc')];_0x59dd2a[a1_0x3931('0x1a')]=_0x129ee7['id'];_0x59dd2a[a1_0x3931('0x1b')][a1_0x3931('0x1c')]({'kind':'facebook','accessToken':_0x3013da});_0x59dd2a[a1_0x3931('0x1d')][a1_0x3931('0x1e')]=_0x129ee7['name']['givenName']+'\x20'+_0x129ee7[a1_0x3931('0x1e')][a1_0x3931('0x20')];_0x59dd2a[a1_0x3931('0x1d')][a1_0x3931('0x21')]=_0x129ee7[a1_0x3931('0x22')][a1_0x3931('0x21')];_0x59dd2a[a1_0x3931('0x1d')][a1_0x3931('0x23')]=a1_0x3931('0x24')+_0x129ee7['id']+'/picture?type=large';_0x59dd2a[a1_0x3931('0x1d')][a1_0x3931('0x2a')]=_0x129ee7[a1_0x3931('0x22')][a1_0x3931('0x2a')]?_0x129ee7['_json'][a1_0x3931('0x2a')][a1_0x3931('0x1e')]:'';_0x59dd2a[a1_0x3931('0x2b')](_0x35e273=>{_0x4d70f3(_0x35e273,_0x59dd2a);});}});});}}));exports[a1_0x3931('0x2c')]=(_0x571326,_0x5d9263,_0xb210d2)=>{if(_0x571326[a1_0x3931('0x2c')]()){return _0xb210d2();}_0x5d9263[a1_0x3931('0x2d')](a1_0x3931('0x2e'));};exports[a1_0x3931('0x2f')]=(_0x599e98,_0x176f34,_0x18971e)=>{const _0x1a5eaa=_0x599e98[a1_0x3931('0x30')]['split']('/')[a1_0x3931('0x31')](-0x1)[0x0];if(lodash_1[a1_0x3931('0x8')][a1_0x3931('0x32')](_0x599e98[a1_0x3931('0x16')][a1_0x3931('0x1b')],{'kind':_0x1a5eaa})){_0x18971e();}else{_0x176f34[a1_0x3931('0x2d')](a1_0x3931('0x33')+_0x1a5eaa);}};