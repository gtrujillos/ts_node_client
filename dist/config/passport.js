var a1_0x2b08=['isAuthenticated','redirect','/login','isAuthorized','path','split','find','/auth/','defineProperty','__esModule','passport','passport-local','lodash','Strategy','default','serializeUser','deserializeUser','use','email','findOne','Email\x20','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','timezone','user','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','facebook','push','profile','familyName','gender','_json','picture','https://graph.facebook.com/','flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','givenName','/picture?type=large','location','save'];(function(_0xa69a5d,_0x566035){var _0x3842f6=function(_0x40fe16){while(--_0x40fe16){_0xa69a5d['push'](_0xa69a5d['shift']());}};_0x3842f6(++_0x566035);}(a1_0x2b08,0x166));var a1_0x423c=function(_0x51cfa5,_0x511303){_0x51cfa5=_0x51cfa5-0x0;var _0x2316fc=a1_0x2b08[_0x51cfa5];return _0x2316fc;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x39838b){return _0x39838b&&_0x39838b['__esModule']?_0x39838b:{'default':_0x39838b};};Object[a1_0x423c('0x0')](exports,a1_0x423c('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x423c('0x2')));const passport_local_1=__importDefault(require(a1_0x423c('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0x423c('0x4')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default'][a1_0x423c('0x5')];const FacebookStrategy=passport_facebook_1['default'][a1_0x423c('0x5')];passport_1[a1_0x423c('0x6')][a1_0x423c('0x7')]((_0x39ca06,_0x1bf30f)=>{_0x1bf30f(undefined,_0x39ca06['id']);});passport_1[a1_0x423c('0x6')][a1_0x423c('0x8')]((_0x4ef0d9,_0x4f0caa)=>{User_1[a1_0x423c('0x6')]['findById'](_0x4ef0d9,(_0x27ab47,_0x46d8df)=>{_0x4f0caa(_0x27ab47,_0x46d8df);});});passport_1[a1_0x423c('0x6')][a1_0x423c('0x9')](new LocalStrategy({'usernameField':a1_0x423c('0xa')},(_0x1fa39b,_0x1231d7,_0x3efa1c)=>{User_1[a1_0x423c('0x6')][a1_0x423c('0xb')]({'email':_0x1fa39b['toLowerCase']()},(_0x4fbf74,_0x3ba04f)=>{if(_0x4fbf74){return _0x3efa1c(_0x4fbf74);}if(!_0x3ba04f){return _0x3efa1c(undefined,![],{'message':a1_0x423c('0xc')+_0x1fa39b+'\x20not\x20found.'});}_0x3ba04f['comparePassword'](_0x1231d7,(_0x4fbf74,_0x27d832)=>{if(_0x4fbf74){return _0x3efa1c(_0x4fbf74);}if(_0x27d832){return _0x3efa1c(undefined,_0x3ba04f);}return _0x3efa1c(undefined,![],{'message':a1_0x423c('0xd')});});});}));passport_1[a1_0x423c('0x6')][a1_0x423c('0x9')](new FacebookStrategy({'clientID':process[a1_0x423c('0xe')][a1_0x423c('0xf')],'clientSecret':process['env'][a1_0x423c('0x10')],'callbackURL':a1_0x423c('0x11'),'profileFields':[a1_0x423c('0x12'),a1_0x423c('0xa'),a1_0x423c('0x13'),'locale',a1_0x423c('0x14')],'passReqToCallback':!![]},(_0x522413,_0x184052,_0x393d96,_0x5ce2d2,_0x446658)=>{if(_0x522413[a1_0x423c('0x15')]){User_1[a1_0x423c('0x6')][a1_0x423c('0xb')]({'facebook':_0x5ce2d2['id']},(_0x349483,_0x62cb41)=>{if(_0x349483){return _0x446658(_0x349483);}if(_0x62cb41){_0x522413['flash'](a1_0x423c('0x16'),{'msg':a1_0x423c('0x17')});_0x446658(_0x349483);}else{User_1[a1_0x423c('0x6')][a1_0x423c('0x18')](_0x522413[a1_0x423c('0x15')]['id'],(_0x349483,_0x2798fb)=>{if(_0x349483){return _0x446658(_0x349483);}_0x2798fb[a1_0x423c('0x19')]=_0x5ce2d2['id'];_0x2798fb['tokens'][a1_0x423c('0x1a')]({'kind':a1_0x423c('0x19'),'accessToken':_0x184052});_0x2798fb[a1_0x423c('0x1b')]['name']=_0x2798fb['profile']['name']||_0x5ce2d2[a1_0x423c('0x12')]['givenName']+'\x20'+_0x5ce2d2[a1_0x423c('0x12')][a1_0x423c('0x1c')];_0x2798fb[a1_0x423c('0x1b')]['gender']=_0x2798fb[a1_0x423c('0x1b')][a1_0x423c('0x1d')]||_0x5ce2d2[a1_0x423c('0x1e')][a1_0x423c('0x1d')];_0x2798fb[a1_0x423c('0x1b')][a1_0x423c('0x1f')]=_0x2798fb[a1_0x423c('0x1b')][a1_0x423c('0x1f')]||a1_0x423c('0x20')+_0x5ce2d2['id']+'/picture?type=large';_0x2798fb['save'](_0x349483=>{_0x522413[a1_0x423c('0x21')](a1_0x423c('0x22'),{'msg':a1_0x423c('0x23')});_0x446658(_0x349483,_0x2798fb);});});}});}else{User_1[a1_0x423c('0x6')][a1_0x423c('0xb')]({'facebook':_0x5ce2d2['id']},(_0x316dc1,_0x5f5d7f)=>{if(_0x316dc1){return _0x446658(_0x316dc1);}if(_0x5f5d7f){return _0x446658(undefined,_0x5f5d7f);}User_1[a1_0x423c('0x6')][a1_0x423c('0xb')]({'email':_0x5ce2d2[a1_0x423c('0x1e')][a1_0x423c('0xa')]},(_0x316dc1,_0x2d6f7f)=>{if(_0x316dc1){return _0x446658(_0x316dc1);}if(_0x2d6f7f){_0x522413[a1_0x423c('0x21')]('errors',{'msg':a1_0x423c('0x24')});_0x446658(_0x316dc1);}else{const _0x1aa788=new User_1[(a1_0x423c('0x6'))]();_0x1aa788[a1_0x423c('0xa')]=_0x5ce2d2[a1_0x423c('0x1e')][a1_0x423c('0xa')];_0x1aa788[a1_0x423c('0x19')]=_0x5ce2d2['id'];_0x1aa788[a1_0x423c('0x25')]['push']({'kind':a1_0x423c('0x19'),'accessToken':_0x184052});_0x1aa788['profile'][a1_0x423c('0x12')]=_0x5ce2d2[a1_0x423c('0x12')][a1_0x423c('0x26')]+'\x20'+_0x5ce2d2[a1_0x423c('0x12')][a1_0x423c('0x1c')];_0x1aa788['profile']['gender']=_0x5ce2d2[a1_0x423c('0x1e')][a1_0x423c('0x1d')];_0x1aa788[a1_0x423c('0x1b')]['picture']=a1_0x423c('0x20')+_0x5ce2d2['id']+a1_0x423c('0x27');_0x1aa788[a1_0x423c('0x1b')][a1_0x423c('0x28')]=_0x5ce2d2['_json'][a1_0x423c('0x28')]?_0x5ce2d2[a1_0x423c('0x1e')]['location']['name']:'';_0x1aa788[a1_0x423c('0x29')](_0x316dc1=>{_0x446658(_0x316dc1,_0x1aa788);});}});});}}));exports[a1_0x423c('0x2a')]=(_0x506f6f,_0x2e5a2e,_0x3e06df)=>{if(_0x506f6f[a1_0x423c('0x2a')]()){return _0x3e06df();}_0x2e5a2e[a1_0x423c('0x2b')](a1_0x423c('0x2c'));};exports[a1_0x423c('0x2d')]=(_0x29b23e,_0x2ff7b7,_0x4f3886)=>{const _0xfce562=_0x29b23e[a1_0x423c('0x2e')][a1_0x423c('0x2f')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x423c('0x6')][a1_0x423c('0x30')](_0x29b23e['user'][a1_0x423c('0x25')],{'kind':_0xfce562})){_0x4f3886();}else{_0x2ff7b7['redirect'](a1_0x423c('0x31')+_0xfce562);}};