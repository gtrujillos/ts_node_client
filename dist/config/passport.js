var a1_0x10d0=['use','findOne','Email\x20','\x20not\x20found.','comparePassword','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','findById','user','facebook','tokens','push','profile','givenName','gender','picture','https://graph.facebook.com/','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','_json','email','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','familyName','location','isAuthenticated','/login','isAuthorized','path','split','slice','find','redirect','/auth/','__esModule','passport','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','deserializeUser'];(function(_0x5619a9,_0x3fe88b){var _0x3dabac=function(_0x188437){while(--_0x188437){_0x5619a9['push'](_0x5619a9['shift']());}};_0x3dabac(++_0x3fe88b);}(a1_0x10d0,0x15b));var a1_0x4561=function(_0xda527,_0x4226ce){_0xda527=_0xda527-0x0;var _0x342fb5=a1_0x10d0[_0xda527];return _0x342fb5;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2db5c3){return _0x2db5c3&&_0x2db5c3[a1_0x4561('0x0')]?_0x2db5c3:{'default':_0x2db5c3};};Object['defineProperty'](exports,a1_0x4561('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4561('0x1')));const passport_local_1=__importDefault(require(a1_0x4561('0x2')));const passport_facebook_1=__importDefault(require(a1_0x4561('0x3')));const lodash_1=__importDefault(require(a1_0x4561('0x4')));const User_1=__importDefault(require(a1_0x4561('0x5')));const LocalStrategy=passport_local_1[a1_0x4561('0x6')][a1_0x4561('0x7')];const FacebookStrategy=passport_facebook_1['default']['Strategy'];passport_1[a1_0x4561('0x6')][a1_0x4561('0x8')]((_0x248e6b,_0x1c3190)=>{_0x1c3190(undefined,_0x248e6b['id']);});passport_1[a1_0x4561('0x6')][a1_0x4561('0x9')]((_0x5d1c1f,_0x1e08b0)=>{User_1[a1_0x4561('0x6')]['findById'](_0x5d1c1f,(_0x575395,_0x4279a3)=>{_0x1e08b0(_0x575395,_0x4279a3);});});passport_1[a1_0x4561('0x6')][a1_0x4561('0xa')](new LocalStrategy({'usernameField':'email'},(_0x1fd99d,_0x5725d7,_0xb669e2)=>{User_1['default'][a1_0x4561('0xb')]({'email':_0x1fd99d['toLowerCase']()},(_0x170888,_0x4ee331)=>{if(_0x170888){return _0xb669e2(_0x170888);}if(!_0x4ee331){return _0xb669e2(undefined,![],{'message':a1_0x4561('0xc')+_0x1fd99d+a1_0x4561('0xd')});}_0x4ee331[a1_0x4561('0xe')](_0x5725d7,(_0x170888,_0x29dd7e)=>{if(_0x170888){return _0xb669e2(_0x170888);}if(_0x29dd7e){return _0xb669e2(undefined,_0x4ee331);}return _0xb669e2(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x4561('0x6')][a1_0x4561('0xa')](new FacebookStrategy({'clientID':process['env'][a1_0x4561('0xf')],'clientSecret':process[a1_0x4561('0x10')][a1_0x4561('0x11')],'callbackURL':a1_0x4561('0x12'),'profileFields':[a1_0x4561('0x13'),'email','link',a1_0x4561('0x14'),a1_0x4561('0x15')],'passReqToCallback':!![]},(_0x4bdfd0,_0x123375,_0x26e2f3,_0x10c232,_0x59c9bf)=>{if(_0x4bdfd0['user']){User_1[a1_0x4561('0x6')]['findOne']({'facebook':_0x10c232['id']},(_0x5765cc,_0x270fb9)=>{if(_0x5765cc){return _0x59c9bf(_0x5765cc);}if(_0x270fb9){_0x4bdfd0['flash']('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x59c9bf(_0x5765cc);}else{User_1['default'][a1_0x4561('0x16')](_0x4bdfd0[a1_0x4561('0x17')]['id'],(_0x5765cc,_0x429102)=>{if(_0x5765cc){return _0x59c9bf(_0x5765cc);}_0x429102[a1_0x4561('0x18')]=_0x10c232['id'];_0x429102[a1_0x4561('0x19')][a1_0x4561('0x1a')]({'kind':'facebook','accessToken':_0x123375});_0x429102[a1_0x4561('0x1b')][a1_0x4561('0x13')]=_0x429102[a1_0x4561('0x1b')][a1_0x4561('0x13')]||_0x10c232[a1_0x4561('0x13')][a1_0x4561('0x1c')]+'\x20'+_0x10c232[a1_0x4561('0x13')]['familyName'];_0x429102['profile'][a1_0x4561('0x1d')]=_0x429102[a1_0x4561('0x1b')][a1_0x4561('0x1d')]||_0x10c232['_json'][a1_0x4561('0x1d')];_0x429102['profile'][a1_0x4561('0x1e')]=_0x429102[a1_0x4561('0x1b')]['picture']||a1_0x4561('0x1f')+_0x10c232['id']+'/picture?type=large';_0x429102[a1_0x4561('0x20')](_0x5765cc=>{_0x4bdfd0[a1_0x4561('0x21')](a1_0x4561('0x22'),{'msg':a1_0x4561('0x23')});_0x59c9bf(_0x5765cc,_0x429102);});});}});}else{User_1[a1_0x4561('0x6')][a1_0x4561('0xb')]({'facebook':_0x10c232['id']},(_0x531438,_0x28351d)=>{if(_0x531438){return _0x59c9bf(_0x531438);}if(_0x28351d){return _0x59c9bf(undefined,_0x28351d);}User_1[a1_0x4561('0x6')][a1_0x4561('0xb')]({'email':_0x10c232[a1_0x4561('0x24')][a1_0x4561('0x25')]},(_0x531438,_0x5705a9)=>{if(_0x531438){return _0x59c9bf(_0x531438);}if(_0x5705a9){_0x4bdfd0[a1_0x4561('0x21')](a1_0x4561('0x26'),{'msg':a1_0x4561('0x27')});_0x59c9bf(_0x531438);}else{const _0x569648=new User_1[(a1_0x4561('0x6'))]();_0x569648['email']=_0x10c232[a1_0x4561('0x24')]['email'];_0x569648['facebook']=_0x10c232['id'];_0x569648['tokens'][a1_0x4561('0x1a')]({'kind':a1_0x4561('0x18'),'accessToken':_0x123375});_0x569648[a1_0x4561('0x1b')][a1_0x4561('0x13')]=_0x10c232[a1_0x4561('0x13')]['givenName']+'\x20'+_0x10c232[a1_0x4561('0x13')][a1_0x4561('0x28')];_0x569648[a1_0x4561('0x1b')][a1_0x4561('0x1d')]=_0x10c232[a1_0x4561('0x24')][a1_0x4561('0x1d')];_0x569648[a1_0x4561('0x1b')][a1_0x4561('0x1e')]=a1_0x4561('0x1f')+_0x10c232['id']+'/picture?type=large';_0x569648[a1_0x4561('0x1b')][a1_0x4561('0x29')]=_0x10c232['_json'][a1_0x4561('0x29')]?_0x10c232['_json'][a1_0x4561('0x29')]['name']:'';_0x569648['save'](_0x531438=>{_0x59c9bf(_0x531438,_0x569648);});}});});}}));exports[a1_0x4561('0x2a')]=(_0x271899,_0x9f64e0,_0x371b9f)=>{if(_0x271899[a1_0x4561('0x2a')]()){return _0x371b9f();}_0x9f64e0['redirect'](a1_0x4561('0x2b'));};exports[a1_0x4561('0x2c')]=(_0x37fbed,_0x366aaa,_0x3c390e)=>{const _0x23086b=_0x37fbed[a1_0x4561('0x2d')][a1_0x4561('0x2e')]('/')[a1_0x4561('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x4561('0x6')][a1_0x4561('0x30')](_0x37fbed['user'][a1_0x4561('0x19')],{'kind':_0x23086b})){_0x3c390e();}else{_0x366aaa[a1_0x4561('0x31')](a1_0x4561('0x32')+_0x23086b);}};