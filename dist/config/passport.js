var a1_0x3101=['passport','../models/User','default','Strategy','deserializeUser','email','findOne','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_SECRET','/auth/facebook/callback','link','locale','timezone','user','flash','errors','findById','facebook','tokens','profile','name','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','givenName','location','isAuthenticated','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule'];(function(_0x204992,_0x46163c){var _0x3dadea=function(_0x11aa5a){while(--_0x11aa5a){_0x204992['push'](_0x204992['shift']());}};_0x3dadea(++_0x46163c);}(a1_0x3101,0xee));var a1_0x28be=function(_0x366fe4,_0x37fde7){_0x366fe4=_0x366fe4-0x0;var _0x5c8ee2=a1_0x3101[_0x366fe4];return _0x5c8ee2;};'use strict';var __importDefault=this&&this[a1_0x28be('0x0')]||function(_0x6b7a67){return _0x6b7a67&&_0x6b7a67[a1_0x28be('0x1')]?_0x6b7a67:{'default':_0x6b7a67};};Object['defineProperty'](exports,a1_0x28be('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x28be('0x2')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x28be('0x3')));const LocalStrategy=passport_local_1[a1_0x28be('0x4')]['Strategy'];const FacebookStrategy=passport_facebook_1['default'][a1_0x28be('0x5')];passport_1[a1_0x28be('0x4')]['serializeUser']((_0xa18761,_0x10bb62)=>{_0x10bb62(undefined,_0xa18761['id']);});passport_1[a1_0x28be('0x4')][a1_0x28be('0x6')]((_0x59d2fd,_0x3ccf99)=>{User_1['default']['findById'](_0x59d2fd,(_0x424844,_0x518c65)=>{_0x3ccf99(_0x424844,_0x518c65);});});passport_1[a1_0x28be('0x4')]['use'](new LocalStrategy({'usernameField':a1_0x28be('0x7')},(_0x466d95,_0x110167,_0x36305e)=>{User_1[a1_0x28be('0x4')][a1_0x28be('0x8')]({'email':_0x466d95['toLowerCase']()},(_0x4597d8,_0x2b4e10)=>{if(_0x4597d8){return _0x36305e(_0x4597d8);}if(!_0x2b4e10){return _0x36305e(undefined,![],{'message':'Email\x20'+_0x466d95+a1_0x28be('0x9')});}_0x2b4e10[a1_0x28be('0xa')](_0x110167,(_0x4597d8,_0x3d2d56)=>{if(_0x4597d8){return _0x36305e(_0x4597d8);}if(_0x3d2d56){return _0x36305e(undefined,_0x2b4e10);}return _0x36305e(undefined,![],{'message':a1_0x28be('0xb')});});});}));passport_1[a1_0x28be('0x4')][a1_0x28be('0xc')](new FacebookStrategy({'clientID':process[a1_0x28be('0xd')]['FACEBOOK_ID'],'clientSecret':process['env'][a1_0x28be('0xe')],'callbackURL':a1_0x28be('0xf'),'profileFields':['name',a1_0x28be('0x7'),a1_0x28be('0x10'),a1_0x28be('0x11'),a1_0x28be('0x12')],'passReqToCallback':!![]},(_0x40a0bd,_0x23312d,_0x3fa89f,_0x4bb4af,_0x577d7b)=>{if(_0x40a0bd[a1_0x28be('0x13')]){User_1['default']['findOne']({'facebook':_0x4bb4af['id']},(_0x4156a4,_0x30c54a)=>{if(_0x4156a4){return _0x577d7b(_0x4156a4);}if(_0x30c54a){_0x40a0bd[a1_0x28be('0x14')](a1_0x28be('0x15'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x577d7b(_0x4156a4);}else{User_1[a1_0x28be('0x4')][a1_0x28be('0x16')](_0x40a0bd[a1_0x28be('0x13')]['id'],(_0x4156a4,_0x5db52f)=>{if(_0x4156a4){return _0x577d7b(_0x4156a4);}_0x5db52f[a1_0x28be('0x17')]=_0x4bb4af['id'];_0x5db52f[a1_0x28be('0x18')]['push']({'kind':a1_0x28be('0x17'),'accessToken':_0x23312d});_0x5db52f[a1_0x28be('0x19')][a1_0x28be('0x1a')]=_0x5db52f['profile'][a1_0x28be('0x1a')]||_0x4bb4af['name']['givenName']+'\x20'+_0x4bb4af[a1_0x28be('0x1a')][a1_0x28be('0x1b')];_0x5db52f[a1_0x28be('0x19')][a1_0x28be('0x1c')]=_0x5db52f[a1_0x28be('0x19')][a1_0x28be('0x1c')]||_0x4bb4af[a1_0x28be('0x1d')][a1_0x28be('0x1c')];_0x5db52f[a1_0x28be('0x19')][a1_0x28be('0x1e')]=_0x5db52f[a1_0x28be('0x19')][a1_0x28be('0x1e')]||a1_0x28be('0x1f')+_0x4bb4af['id']+a1_0x28be('0x20');_0x5db52f[a1_0x28be('0x21')](_0x4156a4=>{_0x40a0bd['flash'](a1_0x28be('0x22'),{'msg':a1_0x28be('0x23')});_0x577d7b(_0x4156a4,_0x5db52f);});});}});}else{User_1[a1_0x28be('0x4')][a1_0x28be('0x8')]({'facebook':_0x4bb4af['id']},(_0x46d01d,_0x5b84da)=>{if(_0x46d01d){return _0x577d7b(_0x46d01d);}if(_0x5b84da){return _0x577d7b(undefined,_0x5b84da);}User_1[a1_0x28be('0x4')][a1_0x28be('0x8')]({'email':_0x4bb4af[a1_0x28be('0x1d')][a1_0x28be('0x7')]},(_0x46d01d,_0x41c3ed)=>{if(_0x46d01d){return _0x577d7b(_0x46d01d);}if(_0x41c3ed){_0x40a0bd[a1_0x28be('0x14')](a1_0x28be('0x15'),{'msg':a1_0x28be('0x24')});_0x577d7b(_0x46d01d);}else{const _0x339bbc=new User_1[(a1_0x28be('0x4'))]();_0x339bbc[a1_0x28be('0x7')]=_0x4bb4af[a1_0x28be('0x1d')][a1_0x28be('0x7')];_0x339bbc[a1_0x28be('0x17')]=_0x4bb4af['id'];_0x339bbc[a1_0x28be('0x18')][a1_0x28be('0x25')]({'kind':a1_0x28be('0x17'),'accessToken':_0x23312d});_0x339bbc['profile'][a1_0x28be('0x1a')]=_0x4bb4af[a1_0x28be('0x1a')][a1_0x28be('0x26')]+'\x20'+_0x4bb4af[a1_0x28be('0x1a')][a1_0x28be('0x1b')];_0x339bbc['profile']['gender']=_0x4bb4af[a1_0x28be('0x1d')]['gender'];_0x339bbc['profile'][a1_0x28be('0x1e')]=a1_0x28be('0x1f')+_0x4bb4af['id']+'/picture?type=large';_0x339bbc['profile']['location']=_0x4bb4af[a1_0x28be('0x1d')][a1_0x28be('0x27')]?_0x4bb4af[a1_0x28be('0x1d')]['location'][a1_0x28be('0x1a')]:'';_0x339bbc[a1_0x28be('0x21')](_0x46d01d=>{_0x577d7b(_0x46d01d,_0x339bbc);});}});});}}));exports[a1_0x28be('0x28')]=(_0x9aefa4,_0x5f1258,_0x3400e1)=>{if(_0x9aefa4[a1_0x28be('0x28')]()){return _0x3400e1();}_0x5f1258['redirect'](a1_0x28be('0x29'));};exports[a1_0x28be('0x2a')]=(_0x232e3d,_0x12a9f9,_0x2cc31b)=>{const _0x15a63f=_0x232e3d[a1_0x28be('0x2b')][a1_0x28be('0x2c')]('/')[a1_0x28be('0x2d')](-0x1)[0x0];if(lodash_1[a1_0x28be('0x4')][a1_0x28be('0x2e')](_0x232e3d['user'][a1_0x28be('0x18')],{'kind':_0x15a63f})){_0x2cc31b();}else{_0x12a9f9['redirect'](a1_0x28be('0x2f')+_0x15a63f);}};