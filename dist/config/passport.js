var a1_0x5b09=['/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','/auth/','__importDefault','__esModule','passport','passport-local','lodash','../models/User','Strategy','default','serializeUser','use','toLowerCase','\x20not\x20found.','comparePassword','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','timezone','user','findOne','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','facebook','tokens','push','profile','givenName','gender','_json','picture','https://graph.facebook.com/'];(function(_0x47c32a,_0x1c0679){var _0x3eeaaa=function(_0x5c8029){while(--_0x5c8029){_0x47c32a['push'](_0x47c32a['shift']());}};_0x3eeaaa(++_0x1c0679);}(a1_0x5b09,0xa0));var a1_0xb91b=function(_0x106765,_0x1277b7){_0x106765=_0x106765-0x0;var _0x19f13e=a1_0x5b09[_0x106765];return _0x19f13e;};'use strict';var __importDefault=this&&this[a1_0xb91b('0x0')]||function(_0x485a24){return _0x485a24&&_0x485a24[a1_0xb91b('0x1')]?_0x485a24:{'default':_0x485a24};};Object['defineProperty'](exports,a1_0xb91b('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0xb91b('0x2')));const passport_local_1=__importDefault(require(a1_0xb91b('0x3')));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require(a1_0xb91b('0x4')));const User_1=__importDefault(require(a1_0xb91b('0x5')));const LocalStrategy=passport_local_1['default'][a1_0xb91b('0x6')];const FacebookStrategy=passport_facebook_1[a1_0xb91b('0x7')]['Strategy'];passport_1[a1_0xb91b('0x7')][a1_0xb91b('0x8')]((_0x54f31a,_0x411160)=>{_0x411160(undefined,_0x54f31a['id']);});passport_1['default']['deserializeUser']((_0x241924,_0x50edd3)=>{User_1[a1_0xb91b('0x7')]['findById'](_0x241924,(_0x1fe02e,_0x31db35)=>{_0x50edd3(_0x1fe02e,_0x31db35);});});passport_1[a1_0xb91b('0x7')][a1_0xb91b('0x9')](new LocalStrategy({'usernameField':'email'},(_0x63cad6,_0x352106,_0x1f0843)=>{User_1[a1_0xb91b('0x7')]['findOne']({'email':_0x63cad6[a1_0xb91b('0xa')]()},(_0x2abb0d,_0x3216f0)=>{if(_0x2abb0d){return _0x1f0843(_0x2abb0d);}if(!_0x3216f0){return _0x1f0843(undefined,![],{'message':'Email\x20'+_0x63cad6+a1_0xb91b('0xb')});}_0x3216f0[a1_0xb91b('0xc')](_0x352106,(_0x2abb0d,_0x405be9)=>{if(_0x2abb0d){return _0x1f0843(_0x2abb0d);}if(_0x405be9){return _0x1f0843(undefined,_0x3216f0);}return _0x1f0843(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0xb91b('0x7')]['use'](new FacebookStrategy({'clientID':process[a1_0xb91b('0xd')][a1_0xb91b('0xe')],'clientSecret':process[a1_0xb91b('0xd')][a1_0xb91b('0xf')],'callbackURL':a1_0xb91b('0x10'),'profileFields':[a1_0xb91b('0x11'),a1_0xb91b('0x12'),a1_0xb91b('0x13'),'locale',a1_0xb91b('0x14')],'passReqToCallback':!![]},(_0x3a2c8b,_0x20b6d8,_0x2461a6,_0x54a696,_0x5a2573)=>{if(_0x3a2c8b[a1_0xb91b('0x15')]){User_1[a1_0xb91b('0x7')][a1_0xb91b('0x16')]({'facebook':_0x54a696['id']},(_0x2d5dc1,_0x1e44be)=>{if(_0x2d5dc1){return _0x5a2573(_0x2d5dc1);}if(_0x1e44be){_0x3a2c8b[a1_0xb91b('0x17')](a1_0xb91b('0x18'),{'msg':a1_0xb91b('0x19')});_0x5a2573(_0x2d5dc1);}else{User_1[a1_0xb91b('0x7')][a1_0xb91b('0x1a')](_0x3a2c8b[a1_0xb91b('0x15')]['id'],(_0x2d5dc1,_0x34310f)=>{if(_0x2d5dc1){return _0x5a2573(_0x2d5dc1);}_0x34310f[a1_0xb91b('0x1b')]=_0x54a696['id'];_0x34310f[a1_0xb91b('0x1c')][a1_0xb91b('0x1d')]({'kind':a1_0xb91b('0x1b'),'accessToken':_0x20b6d8});_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x11')]=_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x11')]||_0x54a696['name'][a1_0xb91b('0x1f')]+'\x20'+_0x54a696[a1_0xb91b('0x11')]['familyName'];_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x20')]=_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x20')]||_0x54a696[a1_0xb91b('0x21')][a1_0xb91b('0x20')];_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x22')]=_0x34310f[a1_0xb91b('0x1e')][a1_0xb91b('0x22')]||a1_0xb91b('0x23')+_0x54a696['id']+a1_0xb91b('0x24');_0x34310f[a1_0xb91b('0x25')](_0x2d5dc1=>{_0x3a2c8b[a1_0xb91b('0x17')]('info',{'msg':a1_0xb91b('0x26')});_0x5a2573(_0x2d5dc1,_0x34310f);});});}});}else{User_1[a1_0xb91b('0x7')]['findOne']({'facebook':_0x54a696['id']},(_0x50d1dd,_0x36eef3)=>{if(_0x50d1dd){return _0x5a2573(_0x50d1dd);}if(_0x36eef3){return _0x5a2573(undefined,_0x36eef3);}User_1[a1_0xb91b('0x7')][a1_0xb91b('0x16')]({'email':_0x54a696['_json'][a1_0xb91b('0x12')]},(_0x50d1dd,_0x54d3fa)=>{if(_0x50d1dd){return _0x5a2573(_0x50d1dd);}if(_0x54d3fa){_0x3a2c8b[a1_0xb91b('0x17')](a1_0xb91b('0x18'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x5a2573(_0x50d1dd);}else{const _0x182a06=new User_1[(a1_0xb91b('0x7'))]();_0x182a06[a1_0xb91b('0x12')]=_0x54a696[a1_0xb91b('0x21')][a1_0xb91b('0x12')];_0x182a06[a1_0xb91b('0x1b')]=_0x54a696['id'];_0x182a06[a1_0xb91b('0x1c')][a1_0xb91b('0x1d')]({'kind':a1_0xb91b('0x1b'),'accessToken':_0x20b6d8});_0x182a06[a1_0xb91b('0x1e')][a1_0xb91b('0x11')]=_0x54a696['name'][a1_0xb91b('0x1f')]+'\x20'+_0x54a696['name'][a1_0xb91b('0x27')];_0x182a06[a1_0xb91b('0x1e')][a1_0xb91b('0x20')]=_0x54a696[a1_0xb91b('0x21')][a1_0xb91b('0x20')];_0x182a06[a1_0xb91b('0x1e')]['picture']='https://graph.facebook.com/'+_0x54a696['id']+a1_0xb91b('0x24');_0x182a06[a1_0xb91b('0x1e')][a1_0xb91b('0x28')]=_0x54a696[a1_0xb91b('0x21')][a1_0xb91b('0x28')]?_0x54a696[a1_0xb91b('0x21')][a1_0xb91b('0x28')][a1_0xb91b('0x11')]:'';_0x182a06[a1_0xb91b('0x25')](_0x50d1dd=>{_0x5a2573(_0x50d1dd,_0x182a06);});}});});}}));exports[a1_0xb91b('0x29')]=(_0x38a47d,_0x498679,_0x26ab36)=>{if(_0x38a47d[a1_0xb91b('0x29')]()){return _0x26ab36();}_0x498679[a1_0xb91b('0x2a')](a1_0xb91b('0x2b'));};exports[a1_0xb91b('0x2c')]=(_0x1281aa,_0x3c9799,_0x56a151)=>{const _0x3c1cc4=_0x1281aa[a1_0xb91b('0x2d')][a1_0xb91b('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0xb91b('0x7')][a1_0xb91b('0x2f')](_0x1281aa[a1_0xb91b('0x15')][a1_0xb91b('0x1c')],{'kind':_0x3c1cc4})){_0x56a151();}else{_0x3c9799['redirect'](a1_0xb91b('0x30')+_0x3c1cc4);}};