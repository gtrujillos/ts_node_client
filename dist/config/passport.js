var a1_0x3511=['Strategy','default','deserializeUser','findById','use','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','/auth/facebook/callback','name','email','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','familyName','gender','_json','picture','save','info','Facebook\x20account\x20has\x20been\x20linked.','givenName','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','path','split','slice','__esModule','defineProperty','passport','passport-local','passport-facebook','../models/User'];(function(_0x485597,_0x4cda6c){var _0xe951b2=function(_0x3385ac){while(--_0x3385ac){_0x485597['push'](_0x485597['shift']());}};_0xe951b2(++_0x4cda6c);}(a1_0x3511,0x17a));var a1_0x39c1=function(_0x980c92,_0x1fb404){_0x980c92=_0x980c92-0x0;var _0x760f37=a1_0x3511[_0x980c92];return _0x760f37;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x45088e){return _0x45088e&&_0x45088e[a1_0x39c1('0x0')]?_0x45088e:{'default':_0x45088e};};Object[a1_0x39c1('0x1')](exports,a1_0x39c1('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x39c1('0x2')));const passport_local_1=__importDefault(require(a1_0x39c1('0x3')));const passport_facebook_1=__importDefault(require(a1_0x39c1('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x39c1('0x5')));const LocalStrategy=passport_local_1['default'][a1_0x39c1('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x39c1('0x7')][a1_0x39c1('0x6')];passport_1['default']['serializeUser']((_0x25a625,_0x5ccf6f)=>{_0x5ccf6f(undefined,_0x25a625['id']);});passport_1[a1_0x39c1('0x7')][a1_0x39c1('0x8')]((_0x1be738,_0x2700b8)=>{User_1['default'][a1_0x39c1('0x9')](_0x1be738,(_0x4429c0,_0x973161)=>{_0x2700b8(_0x4429c0,_0x973161);});});passport_1[a1_0x39c1('0x7')][a1_0x39c1('0xa')](new LocalStrategy({'usernameField':'email'},(_0x4b3e92,_0x2dca45,_0x4f4dbe)=>{User_1[a1_0x39c1('0x7')][a1_0x39c1('0xb')]({'email':_0x4b3e92[a1_0x39c1('0xc')]()},(_0x1112ce,_0x5aa604)=>{if(_0x1112ce){return _0x4f4dbe(_0x1112ce);}if(!_0x5aa604){return _0x4f4dbe(undefined,![],{'message':a1_0x39c1('0xd')+_0x4b3e92+a1_0x39c1('0xe')});}_0x5aa604['comparePassword'](_0x2dca45,(_0x1112ce,_0x153750)=>{if(_0x1112ce){return _0x4f4dbe(_0x1112ce);}if(_0x153750){return _0x4f4dbe(undefined,_0x5aa604);}return _0x4f4dbe(undefined,![],{'message':a1_0x39c1('0xf')});});});}));passport_1[a1_0x39c1('0x7')][a1_0x39c1('0xa')](new FacebookStrategy({'clientID':process[a1_0x39c1('0x10')][a1_0x39c1('0x11')],'clientSecret':process['env']['FACEBOOK_SECRET'],'callbackURL':a1_0x39c1('0x12'),'profileFields':[a1_0x39c1('0x13'),a1_0x39c1('0x14'),a1_0x39c1('0x15'),a1_0x39c1('0x16'),a1_0x39c1('0x17')],'passReqToCallback':!![]},(_0x1207e0,_0x2b7583,_0x5dd9ce,_0x34446a,_0x419870)=>{if(_0x1207e0[a1_0x39c1('0x18')]){User_1[a1_0x39c1('0x7')][a1_0x39c1('0xb')]({'facebook':_0x34446a['id']},(_0x1a4baa,_0x1721d3)=>{if(_0x1a4baa){return _0x419870(_0x1a4baa);}if(_0x1721d3){_0x1207e0[a1_0x39c1('0x19')](a1_0x39c1('0x1a'),{'msg':a1_0x39c1('0x1b')});_0x419870(_0x1a4baa);}else{User_1[a1_0x39c1('0x7')][a1_0x39c1('0x9')](_0x1207e0[a1_0x39c1('0x18')]['id'],(_0x1a4baa,_0x55bf70)=>{if(_0x1a4baa){return _0x419870(_0x1a4baa);}_0x55bf70[a1_0x39c1('0x1c')]=_0x34446a['id'];_0x55bf70[a1_0x39c1('0x1d')][a1_0x39c1('0x1e')]({'kind':a1_0x39c1('0x1c'),'accessToken':_0x2b7583});_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x13')]=_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x13')]||_0x34446a['name']['givenName']+'\x20'+_0x34446a[a1_0x39c1('0x13')][a1_0x39c1('0x20')];_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x21')]=_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x21')]||_0x34446a[a1_0x39c1('0x22')][a1_0x39c1('0x21')];_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x23')]=_0x55bf70[a1_0x39c1('0x1f')][a1_0x39c1('0x23')]||'https://graph.facebook.com/'+_0x34446a['id']+'/picture?type=large';_0x55bf70[a1_0x39c1('0x24')](_0x1a4baa=>{_0x1207e0[a1_0x39c1('0x19')](a1_0x39c1('0x25'),{'msg':a1_0x39c1('0x26')});_0x419870(_0x1a4baa,_0x55bf70);});});}});}else{User_1[a1_0x39c1('0x7')][a1_0x39c1('0xb')]({'facebook':_0x34446a['id']},(_0x2da28c,_0x37c439)=>{if(_0x2da28c){return _0x419870(_0x2da28c);}if(_0x37c439){return _0x419870(undefined,_0x37c439);}User_1['default']['findOne']({'email':_0x34446a[a1_0x39c1('0x22')]['email']},(_0x2da28c,_0x22bf1b)=>{if(_0x2da28c){return _0x419870(_0x2da28c);}if(_0x22bf1b){_0x1207e0['flash']('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x419870(_0x2da28c);}else{const _0x5b944c=new User_1['default']();_0x5b944c[a1_0x39c1('0x14')]=_0x34446a[a1_0x39c1('0x22')][a1_0x39c1('0x14')];_0x5b944c['facebook']=_0x34446a['id'];_0x5b944c[a1_0x39c1('0x1d')][a1_0x39c1('0x1e')]({'kind':'facebook','accessToken':_0x2b7583});_0x5b944c[a1_0x39c1('0x1f')]['name']=_0x34446a[a1_0x39c1('0x13')][a1_0x39c1('0x27')]+'\x20'+_0x34446a[a1_0x39c1('0x13')]['familyName'];_0x5b944c[a1_0x39c1('0x1f')][a1_0x39c1('0x21')]=_0x34446a[a1_0x39c1('0x22')][a1_0x39c1('0x21')];_0x5b944c[a1_0x39c1('0x1f')][a1_0x39c1('0x23')]=a1_0x39c1('0x28')+_0x34446a['id']+'/picture?type=large';_0x5b944c[a1_0x39c1('0x1f')][a1_0x39c1('0x29')]=_0x34446a[a1_0x39c1('0x22')][a1_0x39c1('0x29')]?_0x34446a['_json']['location'][a1_0x39c1('0x13')]:'';_0x5b944c['save'](_0x2da28c=>{_0x419870(_0x2da28c,_0x5b944c);});}});});}}));exports[a1_0x39c1('0x2a')]=(_0x4adec4,_0x242adc,_0x1fb5c9)=>{if(_0x4adec4['isAuthenticated']()){return _0x1fb5c9();}_0x242adc[a1_0x39c1('0x2b')](a1_0x39c1('0x2c'));};exports['isAuthorized']=(_0x37e2c1,_0xe7445d,_0x3cc0d5)=>{const _0x290af3=_0x37e2c1[a1_0x39c1('0x2d')][a1_0x39c1('0x2e')]('/')[a1_0x39c1('0x2f')](-0x1)[0x0];if(lodash_1[a1_0x39c1('0x7')]['find'](_0x37e2c1['user'][a1_0x39c1('0x1d')],{'kind':_0x290af3})){_0x3cc0d5();}else{_0xe7445d['redirect']('/auth/'+_0x290af3);}};