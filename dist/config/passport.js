var a1_0xe561=['push','name','profile','givenName','gender','_json','picture','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','facebook','familyName','https://graph.facebook.com/','/picture?type=large','location','save','isAuthenticated','/login','split','slice','find','__esModule','passport','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','comparePassword','Invalid\x20email\x20or\x20password.','env','/auth/facebook/callback','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens'];(function(_0x4bd822,_0x2bd6f7){var _0xb4bdb3=function(_0x1d68f6){while(--_0x1d68f6){_0x4bd822['push'](_0x4bd822['shift']());}};_0xb4bdb3(++_0x2bd6f7);}(a1_0xe561,0xfb));var a1_0x2e64=function(_0x35e6a6,_0x5850be){_0x35e6a6=_0x35e6a6-0x0;var _0x42deeb=a1_0xe561[_0x35e6a6];return _0x42deeb;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2d33a6){return _0x2d33a6&&_0x2d33a6[a1_0x2e64('0x0')]?_0x2d33a6:{'default':_0x2d33a6};};Object['defineProperty'](exports,a1_0x2e64('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x2e64('0x1')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x2e64('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x2e64('0x3')));const LocalStrategy=passport_local_1[a1_0x2e64('0x4')][a1_0x2e64('0x5')];const FacebookStrategy=passport_facebook_1[a1_0x2e64('0x4')]['Strategy'];passport_1['default'][a1_0x2e64('0x6')]((_0x3bfb0a,_0x24eebb)=>{_0x24eebb(undefined,_0x3bfb0a['id']);});passport_1[a1_0x2e64('0x4')][a1_0x2e64('0x7')]((_0x598ce3,_0xcffabc)=>{User_1[a1_0x2e64('0x4')][a1_0x2e64('0x8')](_0x598ce3,(_0xb5bb8b,_0x497f28)=>{_0xcffabc(_0xb5bb8b,_0x497f28);});});passport_1[a1_0x2e64('0x4')][a1_0x2e64('0x9')](new LocalStrategy({'usernameField':a1_0x2e64('0xa')},(_0x2eba15,_0x4da7cd,_0x1f43a6)=>{User_1[a1_0x2e64('0x4')][a1_0x2e64('0xb')]({'email':_0x2eba15[a1_0x2e64('0xc')]()},(_0xfa3271,_0x5425b7)=>{if(_0xfa3271){return _0x1f43a6(_0xfa3271);}if(!_0x5425b7){return _0x1f43a6(undefined,![],{'message':'Email\x20'+_0x2eba15+'\x20not\x20found.'});}_0x5425b7[a1_0x2e64('0xd')](_0x4da7cd,(_0xfa3271,_0x19ea49)=>{if(_0xfa3271){return _0x1f43a6(_0xfa3271);}if(_0x19ea49){return _0x1f43a6(undefined,_0x5425b7);}return _0x1f43a6(undefined,![],{'message':a1_0x2e64('0xe')});});});}));passport_1[a1_0x2e64('0x4')]['use'](new FacebookStrategy({'clientID':process[a1_0x2e64('0xf')]['FACEBOOK_ID'],'clientSecret':process[a1_0x2e64('0xf')]['FACEBOOK_SECRET'],'callbackURL':a1_0x2e64('0x10'),'profileFields':['name','email',a1_0x2e64('0x11'),a1_0x2e64('0x12'),a1_0x2e64('0x13')],'passReqToCallback':!![]},(_0x5f3add,_0x1f6625,_0x32166f,_0x3d749c,_0x48d0ab)=>{if(_0x5f3add[a1_0x2e64('0x14')]){User_1[a1_0x2e64('0x4')][a1_0x2e64('0xb')]({'facebook':_0x3d749c['id']},(_0x4355d9,_0x40fa57)=>{if(_0x4355d9){return _0x48d0ab(_0x4355d9);}if(_0x40fa57){_0x5f3add[a1_0x2e64('0x15')](a1_0x2e64('0x16'),{'msg':a1_0x2e64('0x17')});_0x48d0ab(_0x4355d9);}else{User_1[a1_0x2e64('0x4')][a1_0x2e64('0x8')](_0x5f3add[a1_0x2e64('0x14')]['id'],(_0x4355d9,_0x396c00)=>{if(_0x4355d9){return _0x48d0ab(_0x4355d9);}_0x396c00['facebook']=_0x3d749c['id'];_0x396c00[a1_0x2e64('0x18')][a1_0x2e64('0x19')]({'kind':'facebook','accessToken':_0x1f6625});_0x396c00['profile'][a1_0x2e64('0x1a')]=_0x396c00[a1_0x2e64('0x1b')]['name']||_0x3d749c[a1_0x2e64('0x1a')][a1_0x2e64('0x1c')]+'\x20'+_0x3d749c['name']['familyName'];_0x396c00[a1_0x2e64('0x1b')][a1_0x2e64('0x1d')]=_0x396c00[a1_0x2e64('0x1b')][a1_0x2e64('0x1d')]||_0x3d749c[a1_0x2e64('0x1e')][a1_0x2e64('0x1d')];_0x396c00[a1_0x2e64('0x1b')][a1_0x2e64('0x1f')]=_0x396c00[a1_0x2e64('0x1b')][a1_0x2e64('0x1f')]||'https://graph.facebook.com/'+_0x3d749c['id']+'/picture?type=large';_0x396c00['save'](_0x4355d9=>{_0x5f3add[a1_0x2e64('0x15')](a1_0x2e64('0x20'),{'msg':a1_0x2e64('0x21')});_0x48d0ab(_0x4355d9,_0x396c00);});});}});}else{User_1[a1_0x2e64('0x4')][a1_0x2e64('0xb')]({'facebook':_0x3d749c['id']},(_0x569e44,_0x2095a1)=>{if(_0x569e44){return _0x48d0ab(_0x569e44);}if(_0x2095a1){return _0x48d0ab(undefined,_0x2095a1);}User_1[a1_0x2e64('0x4')][a1_0x2e64('0xb')]({'email':_0x3d749c[a1_0x2e64('0x1e')][a1_0x2e64('0xa')]},(_0x569e44,_0x2f5d82)=>{if(_0x569e44){return _0x48d0ab(_0x569e44);}if(_0x2f5d82){_0x5f3add['flash']('errors',{'msg':a1_0x2e64('0x22')});_0x48d0ab(_0x569e44);}else{const _0x2ce671=new User_1['default']();_0x2ce671[a1_0x2e64('0xa')]=_0x3d749c['_json'][a1_0x2e64('0xa')];_0x2ce671['facebook']=_0x3d749c['id'];_0x2ce671['tokens'][a1_0x2e64('0x19')]({'kind':a1_0x2e64('0x23'),'accessToken':_0x1f6625});_0x2ce671[a1_0x2e64('0x1b')][a1_0x2e64('0x1a')]=_0x3d749c[a1_0x2e64('0x1a')][a1_0x2e64('0x1c')]+'\x20'+_0x3d749c[a1_0x2e64('0x1a')][a1_0x2e64('0x24')];_0x2ce671[a1_0x2e64('0x1b')]['gender']=_0x3d749c[a1_0x2e64('0x1e')]['gender'];_0x2ce671[a1_0x2e64('0x1b')]['picture']=a1_0x2e64('0x25')+_0x3d749c['id']+a1_0x2e64('0x26');_0x2ce671[a1_0x2e64('0x1b')][a1_0x2e64('0x27')]=_0x3d749c[a1_0x2e64('0x1e')][a1_0x2e64('0x27')]?_0x3d749c[a1_0x2e64('0x1e')][a1_0x2e64('0x27')][a1_0x2e64('0x1a')]:'';_0x2ce671[a1_0x2e64('0x28')](_0x569e44=>{_0x48d0ab(_0x569e44,_0x2ce671);});}});});}}));exports['isAuthenticated']=(_0x2567b0,_0x5d5bac,_0x255e49)=>{if(_0x2567b0[a1_0x2e64('0x29')]()){return _0x255e49();}_0x5d5bac['redirect'](a1_0x2e64('0x2a'));};exports['isAuthorized']=(_0x344a4e,_0x2ee6f2,_0x4ce2dc)=>{const _0x5f3f24=_0x344a4e['path'][a1_0x2e64('0x2b')]('/')[a1_0x2e64('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x2e64('0x4')][a1_0x2e64('0x2d')](_0x344a4e[a1_0x2e64('0x14')][a1_0x2e64('0x18')],{'kind':_0x5f3f24})){_0x4ce2dc();}else{_0x2ee6f2['redirect']('/auth/'+_0x5f3f24);}};