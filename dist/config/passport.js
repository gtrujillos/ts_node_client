var a1_0x5285=['defineProperty','passport','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','email','findOne','Email\x20','\x20not\x20found.','comparePassword','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','findById','user','facebook','push','profile','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','familyName','location','save','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule'];(function(_0x5b1465,_0x267331){var _0x3135e2=function(_0x3f2a20){while(--_0x3f2a20){_0x5b1465['push'](_0x5b1465['shift']());}};_0x3135e2(++_0x267331);}(a1_0x5285,0x136));var a1_0x5d8b=function(_0x22d3a7,_0x466e6c){_0x22d3a7=_0x22d3a7-0x0;var _0x202322=a1_0x5285[_0x22d3a7];return _0x202322;};'use strict';var __importDefault=this&&this[a1_0x5d8b('0x0')]||function(_0x298f22){return _0x298f22&&_0x298f22[a1_0x5d8b('0x1')]?_0x298f22:{'default':_0x298f22};};Object[a1_0x5d8b('0x2')](exports,a1_0x5d8b('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5d8b('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x5d8b('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x5d8b('0x5')));const LocalStrategy=passport_local_1[a1_0x5d8b('0x6')][a1_0x5d8b('0x7')];const FacebookStrategy=passport_facebook_1[a1_0x5d8b('0x6')][a1_0x5d8b('0x7')];passport_1['default'][a1_0x5d8b('0x8')]((_0x143002,_0x4c4631)=>{_0x4c4631(undefined,_0x143002['id']);});passport_1['default'][a1_0x5d8b('0x9')]((_0x552355,_0x1c1fb4)=>{User_1[a1_0x5d8b('0x6')]['findById'](_0x552355,(_0x1595a0,_0x31cfb4)=>{_0x1c1fb4(_0x1595a0,_0x31cfb4);});});passport_1[a1_0x5d8b('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x5d8b('0xa')},(_0x1baeea,_0x51ad5f,_0x43374a)=>{User_1[a1_0x5d8b('0x6')][a1_0x5d8b('0xb')]({'email':_0x1baeea['toLowerCase']()},(_0x4321c4,_0x2c1f3a)=>{if(_0x4321c4){return _0x43374a(_0x4321c4);}if(!_0x2c1f3a){return _0x43374a(undefined,![],{'message':a1_0x5d8b('0xc')+_0x1baeea+a1_0x5d8b('0xd')});}_0x2c1f3a[a1_0x5d8b('0xe')](_0x51ad5f,(_0x4321c4,_0x2d8f60)=>{if(_0x4321c4){return _0x43374a(_0x4321c4);}if(_0x2d8f60){return _0x43374a(undefined,_0x2c1f3a);}return _0x43374a(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1['default']['use'](new FacebookStrategy({'clientID':process[a1_0x5d8b('0xf')][a1_0x5d8b('0x10')],'clientSecret':process[a1_0x5d8b('0xf')][a1_0x5d8b('0x11')],'callbackURL':a1_0x5d8b('0x12'),'profileFields':[a1_0x5d8b('0x13'),'email',a1_0x5d8b('0x14'),a1_0x5d8b('0x15'),a1_0x5d8b('0x16')],'passReqToCallback':!![]},(_0x80158c,_0x703b2a,_0x54d1c9,_0x37ce23,_0x148a88)=>{if(_0x80158c['user']){User_1[a1_0x5d8b('0x6')][a1_0x5d8b('0xb')]({'facebook':_0x37ce23['id']},(_0x3a23e9,_0x4fb728)=>{if(_0x3a23e9){return _0x148a88(_0x3a23e9);}if(_0x4fb728){_0x80158c[a1_0x5d8b('0x17')](a1_0x5d8b('0x18'),{'msg':a1_0x5d8b('0x19')});_0x148a88(_0x3a23e9);}else{User_1[a1_0x5d8b('0x6')][a1_0x5d8b('0x1a')](_0x80158c[a1_0x5d8b('0x1b')]['id'],(_0x3a23e9,_0x1fc0b2)=>{if(_0x3a23e9){return _0x148a88(_0x3a23e9);}_0x1fc0b2[a1_0x5d8b('0x1c')]=_0x37ce23['id'];_0x1fc0b2['tokens'][a1_0x5d8b('0x1d')]({'kind':a1_0x5d8b('0x1c'),'accessToken':_0x703b2a});_0x1fc0b2[a1_0x5d8b('0x1e')]['name']=_0x1fc0b2[a1_0x5d8b('0x1e')]['name']||_0x37ce23[a1_0x5d8b('0x13')][a1_0x5d8b('0x1f')]+'\x20'+_0x37ce23[a1_0x5d8b('0x13')]['familyName'];_0x1fc0b2[a1_0x5d8b('0x1e')][a1_0x5d8b('0x20')]=_0x1fc0b2[a1_0x5d8b('0x1e')]['gender']||_0x37ce23[a1_0x5d8b('0x21')][a1_0x5d8b('0x20')];_0x1fc0b2[a1_0x5d8b('0x1e')][a1_0x5d8b('0x22')]=_0x1fc0b2[a1_0x5d8b('0x1e')][a1_0x5d8b('0x22')]||a1_0x5d8b('0x23')+_0x37ce23['id']+a1_0x5d8b('0x24');_0x1fc0b2['save'](_0x3a23e9=>{_0x80158c['flash']('info',{'msg':a1_0x5d8b('0x25')});_0x148a88(_0x3a23e9,_0x1fc0b2);});});}});}else{User_1[a1_0x5d8b('0x6')][a1_0x5d8b('0xb')]({'facebook':_0x37ce23['id']},(_0x2537da,_0x4dcbbc)=>{if(_0x2537da){return _0x148a88(_0x2537da);}if(_0x4dcbbc){return _0x148a88(undefined,_0x4dcbbc);}User_1[a1_0x5d8b('0x6')][a1_0x5d8b('0xb')]({'email':_0x37ce23[a1_0x5d8b('0x21')][a1_0x5d8b('0xa')]},(_0x2537da,_0x4c143c)=>{if(_0x2537da){return _0x148a88(_0x2537da);}if(_0x4c143c){_0x80158c[a1_0x5d8b('0x17')](a1_0x5d8b('0x18'),{'msg':a1_0x5d8b('0x26')});_0x148a88(_0x2537da);}else{const _0x3617f2=new User_1['default']();_0x3617f2[a1_0x5d8b('0xa')]=_0x37ce23[a1_0x5d8b('0x21')][a1_0x5d8b('0xa')];_0x3617f2['facebook']=_0x37ce23['id'];_0x3617f2[a1_0x5d8b('0x27')][a1_0x5d8b('0x1d')]({'kind':a1_0x5d8b('0x1c'),'accessToken':_0x703b2a});_0x3617f2[a1_0x5d8b('0x1e')][a1_0x5d8b('0x13')]=_0x37ce23[a1_0x5d8b('0x13')]['givenName']+'\x20'+_0x37ce23[a1_0x5d8b('0x13')][a1_0x5d8b('0x28')];_0x3617f2[a1_0x5d8b('0x1e')]['gender']=_0x37ce23[a1_0x5d8b('0x21')][a1_0x5d8b('0x20')];_0x3617f2[a1_0x5d8b('0x1e')][a1_0x5d8b('0x22')]=a1_0x5d8b('0x23')+_0x37ce23['id']+a1_0x5d8b('0x24');_0x3617f2['profile'][a1_0x5d8b('0x29')]=_0x37ce23[a1_0x5d8b('0x21')][a1_0x5d8b('0x29')]?_0x37ce23['_json']['location']['name']:'';_0x3617f2[a1_0x5d8b('0x2a')](_0x2537da=>{_0x148a88(_0x2537da,_0x3617f2);});}});});}}));exports[a1_0x5d8b('0x2b')]=(_0x1329db,_0x922ed8,_0x20add9)=>{if(_0x1329db[a1_0x5d8b('0x2b')]()){return _0x20add9();}_0x922ed8[a1_0x5d8b('0x2c')](a1_0x5d8b('0x2d'));};exports[a1_0x5d8b('0x2e')]=(_0x9bb3c4,_0x2f988d,_0x1b9f6b)=>{const _0x4b7af1=_0x9bb3c4[a1_0x5d8b('0x2f')][a1_0x5d8b('0x30')]('/')[a1_0x5d8b('0x31')](-0x1)[0x0];if(lodash_1[a1_0x5d8b('0x6')][a1_0x5d8b('0x32')](_0x9bb3c4[a1_0x5d8b('0x1b')]['tokens'],{'kind':_0x4b7af1})){_0x1b9f6b();}else{_0x2f988d[a1_0x5d8b('0x2c')](a1_0x5d8b('0x33')+_0x4b7af1);}};