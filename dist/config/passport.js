var a1_0x59ef=['gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','__esModule','defineProperty','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','email','findOne','\x20not\x20found.','env','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','locale','timezone','flash','errors','push','facebook','profile','name','givenName','familyName'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a1_0x59ef,0x99));var a1_0x4b41=function(_0x2d8bfd,_0x2689d3){_0x2d8bfd=_0x2d8bfd-0x0;var _0x26de9c=a1_0x59ef[_0x2d8bfd];return _0x26de9c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4d3b3d){return _0x4d3b3d&&_0x4d3b3d[a1_0x4b41('0x0')]?_0x4d3b3d:{'default':_0x4d3b3d};};Object[a1_0x4b41('0x1')](exports,a1_0x4b41('0x0'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4b41('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4b41('0x3')));const LocalStrategy=passport_local_1['default'][a1_0x4b41('0x4')];const FacebookStrategy=passport_facebook_1[a1_0x4b41('0x5')][a1_0x4b41('0x4')];passport_1[a1_0x4b41('0x5')][a1_0x4b41('0x6')]((_0xd29a62,_0x321aeb)=>{_0x321aeb(undefined,_0xd29a62['id']);});passport_1[a1_0x4b41('0x5')][a1_0x4b41('0x7')]((_0x5be0cd,_0x2b9f7d)=>{User_1[a1_0x4b41('0x5')][a1_0x4b41('0x8')](_0x5be0cd,(_0x43bcae,_0x12f64d)=>{_0x2b9f7d(_0x43bcae,_0x12f64d);});});passport_1[a1_0x4b41('0x5')][a1_0x4b41('0x9')](new LocalStrategy({'usernameField':a1_0x4b41('0xa')},(_0x41f418,_0x1cc21d,_0xfc89ca)=>{User_1[a1_0x4b41('0x5')][a1_0x4b41('0xb')]({'email':_0x41f418['toLowerCase']()},(_0xb4bc7b,_0x3fbd76)=>{if(_0xb4bc7b){return _0xfc89ca(_0xb4bc7b);}if(!_0x3fbd76){return _0xfc89ca(undefined,![],{'message':'Email\x20'+_0x41f418+a1_0x4b41('0xc')});}_0x3fbd76['comparePassword'](_0x1cc21d,(_0xb4bc7b,_0x3b582e)=>{if(_0xb4bc7b){return _0xfc89ca(_0xb4bc7b);}if(_0x3b582e){return _0xfc89ca(undefined,_0x3fbd76);}return _0xfc89ca(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x4b41('0x5')][a1_0x4b41('0x9')](new FacebookStrategy({'clientID':process[a1_0x4b41('0xd')][a1_0x4b41('0xe')],'clientSecret':process[a1_0x4b41('0xd')][a1_0x4b41('0xf')],'callbackURL':a1_0x4b41('0x10'),'profileFields':['name',a1_0x4b41('0xa'),'link',a1_0x4b41('0x11'),a1_0x4b41('0x12')],'passReqToCallback':!![]},(_0x2c1108,_0x664b4c,_0x130c55,_0x34e544,_0x25ff8d)=>{if(_0x2c1108['user']){User_1[a1_0x4b41('0x5')]['findOne']({'facebook':_0x34e544['id']},(_0x52489b,_0x492bcd)=>{if(_0x52489b){return _0x25ff8d(_0x52489b);}if(_0x492bcd){_0x2c1108[a1_0x4b41('0x13')](a1_0x4b41('0x14'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x25ff8d(_0x52489b);}else{User_1['default'][a1_0x4b41('0x8')](_0x2c1108['user']['id'],(_0x52489b,_0x4668d0)=>{if(_0x52489b){return _0x25ff8d(_0x52489b);}_0x4668d0['facebook']=_0x34e544['id'];_0x4668d0['tokens'][a1_0x4b41('0x15')]({'kind':a1_0x4b41('0x16'),'accessToken':_0x664b4c});_0x4668d0[a1_0x4b41('0x17')][a1_0x4b41('0x18')]=_0x4668d0[a1_0x4b41('0x17')][a1_0x4b41('0x18')]||_0x34e544[a1_0x4b41('0x18')][a1_0x4b41('0x19')]+'\x20'+_0x34e544[a1_0x4b41('0x18')][a1_0x4b41('0x1a')];_0x4668d0['profile']['gender']=_0x4668d0['profile'][a1_0x4b41('0x1b')]||_0x34e544[a1_0x4b41('0x1c')][a1_0x4b41('0x1b')];_0x4668d0[a1_0x4b41('0x17')][a1_0x4b41('0x1d')]=_0x4668d0[a1_0x4b41('0x17')][a1_0x4b41('0x1d')]||a1_0x4b41('0x1e')+_0x34e544['id']+a1_0x4b41('0x1f');_0x4668d0[a1_0x4b41('0x20')](_0x52489b=>{_0x2c1108[a1_0x4b41('0x13')]('info',{'msg':a1_0x4b41('0x21')});_0x25ff8d(_0x52489b,_0x4668d0);});});}});}else{User_1[a1_0x4b41('0x5')][a1_0x4b41('0xb')]({'facebook':_0x34e544['id']},(_0x3de129,_0x375558)=>{if(_0x3de129){return _0x25ff8d(_0x3de129);}if(_0x375558){return _0x25ff8d(undefined,_0x375558);}User_1[a1_0x4b41('0x5')][a1_0x4b41('0xb')]({'email':_0x34e544[a1_0x4b41('0x1c')][a1_0x4b41('0xa')]},(_0x3de129,_0x7fa30a)=>{if(_0x3de129){return _0x25ff8d(_0x3de129);}if(_0x7fa30a){_0x2c1108[a1_0x4b41('0x13')](a1_0x4b41('0x14'),{'msg':a1_0x4b41('0x22')});_0x25ff8d(_0x3de129);}else{const _0x2d042c=new User_1[(a1_0x4b41('0x5'))]();_0x2d042c[a1_0x4b41('0xa')]=_0x34e544[a1_0x4b41('0x1c')][a1_0x4b41('0xa')];_0x2d042c['facebook']=_0x34e544['id'];_0x2d042c[a1_0x4b41('0x23')][a1_0x4b41('0x15')]({'kind':a1_0x4b41('0x16'),'accessToken':_0x664b4c});_0x2d042c[a1_0x4b41('0x17')][a1_0x4b41('0x18')]=_0x34e544[a1_0x4b41('0x18')][a1_0x4b41('0x19')]+'\x20'+_0x34e544[a1_0x4b41('0x18')][a1_0x4b41('0x1a')];_0x2d042c[a1_0x4b41('0x17')][a1_0x4b41('0x1b')]=_0x34e544[a1_0x4b41('0x1c')]['gender'];_0x2d042c[a1_0x4b41('0x17')][a1_0x4b41('0x1d')]=a1_0x4b41('0x1e')+_0x34e544['id']+a1_0x4b41('0x1f');_0x2d042c[a1_0x4b41('0x17')][a1_0x4b41('0x24')]=_0x34e544['_json'][a1_0x4b41('0x24')]?_0x34e544[a1_0x4b41('0x1c')][a1_0x4b41('0x24')]['name']:'';_0x2d042c[a1_0x4b41('0x20')](_0x3de129=>{_0x25ff8d(_0x3de129,_0x2d042c);});}});});}}));exports[a1_0x4b41('0x25')]=(_0x359c46,_0x1b1c3f,_0x3e2092)=>{if(_0x359c46[a1_0x4b41('0x25')]()){return _0x3e2092();}_0x1b1c3f[a1_0x4b41('0x26')](a1_0x4b41('0x27'));};exports[a1_0x4b41('0x28')]=(_0x6049e2,_0x238e3b,_0x35689f)=>{const _0x52c8ef=_0x6049e2[a1_0x4b41('0x29')][a1_0x4b41('0x2a')]('/')[a1_0x4b41('0x2b')](-0x1)[0x0];if(lodash_1[a1_0x4b41('0x5')][a1_0x4b41('0x2c')](_0x6049e2['user'][a1_0x4b41('0x23')],{'kind':_0x52c8ef})){_0x35689f();}else{_0x238e3b[a1_0x4b41('0x26')]('/auth/'+_0x52c8ef);}};