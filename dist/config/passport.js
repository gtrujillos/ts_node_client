var a1_0x124e=['givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','_json','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','/login','isAuthorized','path','split','slice','redirect','__importDefault','__esModule','passport-facebook','../models/User','Strategy','default','serializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','FACEBOOK_ID','env','name','link','locale','timezone','user','flash','errors','tokens','push','facebook','profile'];(function(_0x4bcf86,_0x2bbfbe){var _0x3eca39=function(_0x2f1864){while(--_0x2f1864){_0x4bcf86['push'](_0x4bcf86['shift']());}};_0x3eca39(++_0x2bbfbe);}(a1_0x124e,0x1ea));var a1_0x1ec8=function(_0x528392,_0x2347a7){_0x528392=_0x528392-0x0;var _0x47428d=a1_0x124e[_0x528392];return _0x47428d;};'use strict';var __importDefault=this&&this[a1_0x1ec8('0x0')]||function(_0x477082){return _0x477082&&_0x477082['__esModule']?_0x477082:{'default':_0x477082};};Object['defineProperty'](exports,a1_0x1ec8('0x1'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x1ec8('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x1ec8('0x3')));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1['default'][a1_0x1ec8('0x4')];passport_1[a1_0x1ec8('0x5')][a1_0x1ec8('0x6')]((_0x546bcf,_0x101866)=>{_0x101866(undefined,_0x546bcf['id']);});passport_1[a1_0x1ec8('0x5')]['deserializeUser']((_0x52b5e5,_0xbe3fd0)=>{User_1[a1_0x1ec8('0x5')][a1_0x1ec8('0x7')](_0x52b5e5,(_0x3d2515,_0x14fc06)=>{_0xbe3fd0(_0x3d2515,_0x14fc06);});});passport_1[a1_0x1ec8('0x5')][a1_0x1ec8('0x8')](new LocalStrategy({'usernameField':a1_0x1ec8('0x9')},(_0x89794b,_0x3f3df1,_0x1c75f7)=>{User_1[a1_0x1ec8('0x5')][a1_0x1ec8('0xa')]({'email':_0x89794b['toLowerCase']()},(_0x14c3a7,_0x266640)=>{if(_0x14c3a7){return _0x1c75f7(_0x14c3a7);}if(!_0x266640){return _0x1c75f7(undefined,![],{'message':a1_0x1ec8('0xb')+_0x89794b+a1_0x1ec8('0xc')});}_0x266640['comparePassword'](_0x3f3df1,(_0x14c3a7,_0x2ae0d5)=>{if(_0x14c3a7){return _0x1c75f7(_0x14c3a7);}if(_0x2ae0d5){return _0x1c75f7(undefined,_0x266640);}return _0x1c75f7(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1[a1_0x1ec8('0x5')][a1_0x1ec8('0x8')](new FacebookStrategy({'clientID':process['env'][a1_0x1ec8('0xd')],'clientSecret':process[a1_0x1ec8('0xe')]['FACEBOOK_SECRET'],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x1ec8('0xf'),a1_0x1ec8('0x9'),a1_0x1ec8('0x10'),a1_0x1ec8('0x11'),a1_0x1ec8('0x12')],'passReqToCallback':!![]},(_0x17a961,_0x8fee23,_0x474461,_0x1b31eb,_0x37f964)=>{if(_0x17a961[a1_0x1ec8('0x13')]){User_1[a1_0x1ec8('0x5')][a1_0x1ec8('0xa')]({'facebook':_0x1b31eb['id']},(_0xd73622,_0x36d047)=>{if(_0xd73622){return _0x37f964(_0xd73622);}if(_0x36d047){_0x17a961[a1_0x1ec8('0x14')](a1_0x1ec8('0x15'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x37f964(_0xd73622);}else{User_1[a1_0x1ec8('0x5')]['findById'](_0x17a961[a1_0x1ec8('0x13')]['id'],(_0xd73622,_0x3b6e87)=>{if(_0xd73622){return _0x37f964(_0xd73622);}_0x3b6e87['facebook']=_0x1b31eb['id'];_0x3b6e87[a1_0x1ec8('0x16')][a1_0x1ec8('0x17')]({'kind':a1_0x1ec8('0x18'),'accessToken':_0x8fee23});_0x3b6e87['profile'][a1_0x1ec8('0xf')]=_0x3b6e87[a1_0x1ec8('0x19')]['name']||_0x1b31eb[a1_0x1ec8('0xf')][a1_0x1ec8('0x1a')]+'\x20'+_0x1b31eb[a1_0x1ec8('0xf')][a1_0x1ec8('0x1b')];_0x3b6e87[a1_0x1ec8('0x19')][a1_0x1ec8('0x1c')]=_0x3b6e87[a1_0x1ec8('0x19')][a1_0x1ec8('0x1c')]||_0x1b31eb['_json'][a1_0x1ec8('0x1c')];_0x3b6e87[a1_0x1ec8('0x19')][a1_0x1ec8('0x1d')]=_0x3b6e87['profile'][a1_0x1ec8('0x1d')]||a1_0x1ec8('0x1e')+_0x1b31eb['id']+a1_0x1ec8('0x1f');_0x3b6e87['save'](_0xd73622=>{_0x17a961['flash'](a1_0x1ec8('0x20'),{'msg':a1_0x1ec8('0x21')});_0x37f964(_0xd73622,_0x3b6e87);});});}});}else{User_1[a1_0x1ec8('0x5')][a1_0x1ec8('0xa')]({'facebook':_0x1b31eb['id']},(_0x1fc404,_0x1f963c)=>{if(_0x1fc404){return _0x37f964(_0x1fc404);}if(_0x1f963c){return _0x37f964(undefined,_0x1f963c);}User_1[a1_0x1ec8('0x5')][a1_0x1ec8('0xa')]({'email':_0x1b31eb[a1_0x1ec8('0x22')][a1_0x1ec8('0x9')]},(_0x1fc404,_0x4ada0f)=>{if(_0x1fc404){return _0x37f964(_0x1fc404);}if(_0x4ada0f){_0x17a961[a1_0x1ec8('0x14')](a1_0x1ec8('0x15'),{'msg':a1_0x1ec8('0x23')});_0x37f964(_0x1fc404);}else{const _0x1dc6a1=new User_1[(a1_0x1ec8('0x5'))]();_0x1dc6a1['email']=_0x1b31eb[a1_0x1ec8('0x22')][a1_0x1ec8('0x9')];_0x1dc6a1[a1_0x1ec8('0x18')]=_0x1b31eb['id'];_0x1dc6a1['tokens']['push']({'kind':a1_0x1ec8('0x18'),'accessToken':_0x8fee23});_0x1dc6a1[a1_0x1ec8('0x19')]['name']=_0x1b31eb[a1_0x1ec8('0xf')]['givenName']+'\x20'+_0x1b31eb[a1_0x1ec8('0xf')][a1_0x1ec8('0x1b')];_0x1dc6a1['profile'][a1_0x1ec8('0x1c')]=_0x1b31eb[a1_0x1ec8('0x22')][a1_0x1ec8('0x1c')];_0x1dc6a1[a1_0x1ec8('0x19')][a1_0x1ec8('0x1d')]='https://graph.facebook.com/'+_0x1b31eb['id']+'/picture?type=large';_0x1dc6a1[a1_0x1ec8('0x19')][a1_0x1ec8('0x24')]=_0x1b31eb[a1_0x1ec8('0x22')][a1_0x1ec8('0x24')]?_0x1b31eb[a1_0x1ec8('0x22')]['location'][a1_0x1ec8('0xf')]:'';_0x1dc6a1['save'](_0x1fc404=>{_0x37f964(_0x1fc404,_0x1dc6a1);});}});});}}));exports['isAuthenticated']=(_0x517040,_0x5bd077,_0xf3472e)=>{if(_0x517040['isAuthenticated']()){return _0xf3472e();}_0x5bd077['redirect'](a1_0x1ec8('0x25'));};exports[a1_0x1ec8('0x26')]=(_0x344edf,_0x58b05f,_0x2e6254)=>{const _0x27831e=_0x344edf[a1_0x1ec8('0x27')][a1_0x1ec8('0x28')]('/')[a1_0x1ec8('0x29')](-0x1)[0x0];if(lodash_1['default']['find'](_0x344edf['user']['tokens'],{'kind':_0x27831e})){_0x2e6254();}else{_0x58b05f[a1_0x1ec8('0x2a')]('/auth/'+_0x27831e);}};