var a1_0x3083=['__esModule','defineProperty','passport','passport-local','passport-facebook','../models/User','default','serializeUser','findById','use','email','findOne','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','name','link','locale','timezone','user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','familyName','_json','gender','picture','/picture?type=large','save','Facebook\x20account\x20has\x20been\x20linked.','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','__importDefault'];(function(_0x4d63bc,_0x5d5be2){var _0x529d0a=function(_0x4b2f36){while(--_0x4b2f36){_0x4d63bc['push'](_0x4d63bc['shift']());}};_0x529d0a(++_0x5d5be2);}(a1_0x3083,0xbb));var a1_0x4f50=function(_0x26ce89,_0x1dc49c){_0x26ce89=_0x26ce89-0x0;var _0x1800b2=a1_0x3083[_0x26ce89];return _0x1800b2;};'use strict';var __importDefault=this&&this[a1_0x4f50('0x0')]||function(_0x49ad20){return _0x49ad20&&_0x49ad20[a1_0x4f50('0x1')]?_0x49ad20:{'default':_0x49ad20};};Object[a1_0x4f50('0x2')](exports,a1_0x4f50('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4f50('0x3')));const passport_local_1=__importDefault(require(a1_0x4f50('0x4')));const passport_facebook_1=__importDefault(require(a1_0x4f50('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4f50('0x6')));const LocalStrategy=passport_local_1[a1_0x4f50('0x7')]['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x4f50('0x7')]['Strategy'];passport_1[a1_0x4f50('0x7')][a1_0x4f50('0x8')]((_0x512067,_0x59cbc3)=>{_0x59cbc3(undefined,_0x512067['id']);});passport_1[a1_0x4f50('0x7')]['deserializeUser']((_0x150c94,_0x23001f)=>{User_1[a1_0x4f50('0x7')][a1_0x4f50('0x9')](_0x150c94,(_0x1e1ce8,_0x9a7690)=>{_0x23001f(_0x1e1ce8,_0x9a7690);});});passport_1[a1_0x4f50('0x7')][a1_0x4f50('0xa')](new LocalStrategy({'usernameField':a1_0x4f50('0xb')},(_0x4f9822,_0x456b32,_0x428875)=>{User_1['default'][a1_0x4f50('0xc')]({'email':_0x4f9822['toLowerCase']()},(_0x5a9c4d,_0x51a7de)=>{if(_0x5a9c4d){return _0x428875(_0x5a9c4d);}if(!_0x51a7de){return _0x428875(undefined,![],{'message':'Email\x20'+_0x4f9822+'\x20not\x20found.'});}_0x51a7de[a1_0x4f50('0xd')](_0x456b32,(_0x5a9c4d,_0x23d587)=>{if(_0x5a9c4d){return _0x428875(_0x5a9c4d);}if(_0x23d587){return _0x428875(undefined,_0x51a7de);}return _0x428875(undefined,![],{'message':a1_0x4f50('0xe')});});});}));passport_1['default'][a1_0x4f50('0xa')](new FacebookStrategy({'clientID':process[a1_0x4f50('0xf')]['FACEBOOK_ID'],'clientSecret':process[a1_0x4f50('0xf')][a1_0x4f50('0x10')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x4f50('0x11'),a1_0x4f50('0xb'),a1_0x4f50('0x12'),a1_0x4f50('0x13'),a1_0x4f50('0x14')],'passReqToCallback':!![]},(_0x5b1d8a,_0x2b791a,_0x2c1ced,_0x5431a6,_0x4f7103)=>{if(_0x5b1d8a[a1_0x4f50('0x15')]){User_1[a1_0x4f50('0x7')][a1_0x4f50('0xc')]({'facebook':_0x5431a6['id']},(_0x5a14d0,_0x25ade2)=>{if(_0x5a14d0){return _0x4f7103(_0x5a14d0);}if(_0x25ade2){_0x5b1d8a[a1_0x4f50('0x16')]('errors',{'msg':a1_0x4f50('0x17')});_0x4f7103(_0x5a14d0);}else{User_1[a1_0x4f50('0x7')][a1_0x4f50('0x9')](_0x5b1d8a[a1_0x4f50('0x15')]['id'],(_0x5a14d0,_0x6a90dc)=>{if(_0x5a14d0){return _0x4f7103(_0x5a14d0);}_0x6a90dc[a1_0x4f50('0x18')]=_0x5431a6['id'];_0x6a90dc[a1_0x4f50('0x19')][a1_0x4f50('0x1a')]({'kind':a1_0x4f50('0x18'),'accessToken':_0x2b791a});_0x6a90dc[a1_0x4f50('0x1b')][a1_0x4f50('0x11')]=_0x6a90dc[a1_0x4f50('0x1b')]['name']||_0x5431a6[a1_0x4f50('0x11')][a1_0x4f50('0x1c')]+'\x20'+_0x5431a6[a1_0x4f50('0x11')][a1_0x4f50('0x1d')];_0x6a90dc['profile']['gender']=_0x6a90dc[a1_0x4f50('0x1b')]['gender']||_0x5431a6[a1_0x4f50('0x1e')][a1_0x4f50('0x1f')];_0x6a90dc[a1_0x4f50('0x1b')][a1_0x4f50('0x20')]=_0x6a90dc[a1_0x4f50('0x1b')][a1_0x4f50('0x20')]||'https://graph.facebook.com/'+_0x5431a6['id']+a1_0x4f50('0x21');_0x6a90dc[a1_0x4f50('0x22')](_0x5a14d0=>{_0x5b1d8a['flash']('info',{'msg':a1_0x4f50('0x23')});_0x4f7103(_0x5a14d0,_0x6a90dc);});});}});}else{User_1[a1_0x4f50('0x7')][a1_0x4f50('0xc')]({'facebook':_0x5431a6['id']},(_0x29912c,_0xeef8b7)=>{if(_0x29912c){return _0x4f7103(_0x29912c);}if(_0xeef8b7){return _0x4f7103(undefined,_0xeef8b7);}User_1[a1_0x4f50('0x7')][a1_0x4f50('0xc')]({'email':_0x5431a6['_json']['email']},(_0x29912c,_0x46229a)=>{if(_0x29912c){return _0x4f7103(_0x29912c);}if(_0x46229a){_0x5b1d8a['flash'](a1_0x4f50('0x24'),{'msg':a1_0x4f50('0x25')});_0x4f7103(_0x29912c);}else{const _0x3c8299=new User_1[(a1_0x4f50('0x7'))]();_0x3c8299[a1_0x4f50('0xb')]=_0x5431a6[a1_0x4f50('0x1e')]['email'];_0x3c8299[a1_0x4f50('0x18')]=_0x5431a6['id'];_0x3c8299[a1_0x4f50('0x19')][a1_0x4f50('0x1a')]({'kind':a1_0x4f50('0x18'),'accessToken':_0x2b791a});_0x3c8299[a1_0x4f50('0x1b')][a1_0x4f50('0x11')]=_0x5431a6[a1_0x4f50('0x11')]['givenName']+'\x20'+_0x5431a6[a1_0x4f50('0x11')][a1_0x4f50('0x1d')];_0x3c8299['profile']['gender']=_0x5431a6['_json'][a1_0x4f50('0x1f')];_0x3c8299['profile'][a1_0x4f50('0x20')]=a1_0x4f50('0x26')+_0x5431a6['id']+a1_0x4f50('0x21');_0x3c8299[a1_0x4f50('0x1b')][a1_0x4f50('0x27')]=_0x5431a6['_json']['location']?_0x5431a6[a1_0x4f50('0x1e')][a1_0x4f50('0x27')][a1_0x4f50('0x11')]:'';_0x3c8299['save'](_0x29912c=>{_0x4f7103(_0x29912c,_0x3c8299);});}});});}}));exports[a1_0x4f50('0x28')]=(_0x4758bc,_0x36a492,_0x4b1d68)=>{if(_0x4758bc['isAuthenticated']()){return _0x4b1d68();}_0x36a492[a1_0x4f50('0x29')](a1_0x4f50('0x2a'));};exports[a1_0x4f50('0x2b')]=(_0x52ca9e,_0x5c1653,_0x5df4f1)=>{const _0x2ee9a9=_0x52ca9e[a1_0x4f50('0x2c')][a1_0x4f50('0x2d')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x4f50('0x7')][a1_0x4f50('0x2e')](_0x52ca9e[a1_0x4f50('0x15')]['tokens'],{'kind':_0x2ee9a9})){_0x5df4f1();}else{_0x5c1653[a1_0x4f50('0x29')]('/auth/'+_0x2ee9a9);}};