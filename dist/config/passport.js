var a1_0x2a03=['FACEBOOK_ID','/auth/facebook/callback','name','email','link','locale','user','flash','facebook','tokens','push','profile','givenName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','_json','familyName','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','/auth/','__importDefault','passport-local','passport-facebook','lodash','../models/User','default','Strategy','serializeUser','findById','use','findOne','toLowerCase','Email\x20','comparePassword','env'];(function(_0x3351a6,_0x251ed2){var _0x3185b3=function(_0x3b4cee){while(--_0x3b4cee){_0x3351a6['push'](_0x3351a6['shift']());}};_0x3185b3(++_0x251ed2);}(a1_0x2a03,0x161));var a1_0x33e4=function(_0x1f10c2,_0x508806){_0x1f10c2=_0x1f10c2-0x0;var _0xf340e8=a1_0x2a03[_0x1f10c2];return _0xf340e8;};'use strict';var __importDefault=this&&this[a1_0x33e4('0x0')]||function(_0x281dc6){return _0x281dc6&&_0x281dc6['__esModule']?_0x281dc6:{'default':_0x281dc6};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0x33e4('0x1')));const passport_facebook_1=__importDefault(require(a1_0x33e4('0x2')));const lodash_1=__importDefault(require(a1_0x33e4('0x3')));const User_1=__importDefault(require(a1_0x33e4('0x4')));const LocalStrategy=passport_local_1[a1_0x33e4('0x5')][a1_0x33e4('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x33e4('0x5')][a1_0x33e4('0x6')];passport_1[a1_0x33e4('0x5')][a1_0x33e4('0x7')]((_0x25192b,_0x2fcf00)=>{_0x2fcf00(undefined,_0x25192b['id']);});passport_1[a1_0x33e4('0x5')]['deserializeUser']((_0x5a56fe,_0x533680)=>{User_1[a1_0x33e4('0x5')][a1_0x33e4('0x8')](_0x5a56fe,(_0x595c44,_0xe08142)=>{_0x533680(_0x595c44,_0xe08142);});});passport_1[a1_0x33e4('0x5')][a1_0x33e4('0x9')](new LocalStrategy({'usernameField':'email'},(_0xaefd66,_0x14ed26,_0x4b49cf)=>{User_1[a1_0x33e4('0x5')][a1_0x33e4('0xa')]({'email':_0xaefd66[a1_0x33e4('0xb')]()},(_0x21246b,_0x354121)=>{if(_0x21246b){return _0x4b49cf(_0x21246b);}if(!_0x354121){return _0x4b49cf(undefined,![],{'message':a1_0x33e4('0xc')+_0xaefd66+'\x20not\x20found.'});}_0x354121[a1_0x33e4('0xd')](_0x14ed26,(_0x21246b,_0xb511db)=>{if(_0x21246b){return _0x4b49cf(_0x21246b);}if(_0xb511db){return _0x4b49cf(undefined,_0x354121);}return _0x4b49cf(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1['default'][a1_0x33e4('0x9')](new FacebookStrategy({'clientID':process[a1_0x33e4('0xe')][a1_0x33e4('0xf')],'clientSecret':process[a1_0x33e4('0xe')]['FACEBOOK_SECRET'],'callbackURL':a1_0x33e4('0x10'),'profileFields':[a1_0x33e4('0x11'),a1_0x33e4('0x12'),a1_0x33e4('0x13'),a1_0x33e4('0x14'),'timezone'],'passReqToCallback':!![]},(_0x46fed7,_0x3c496a,_0x3ccc8a,_0x27934b,_0x2f3d11)=>{if(_0x46fed7[a1_0x33e4('0x15')]){User_1[a1_0x33e4('0x5')]['findOne']({'facebook':_0x27934b['id']},(_0x1b05ec,_0x23ab85)=>{if(_0x1b05ec){return _0x2f3d11(_0x1b05ec);}if(_0x23ab85){_0x46fed7[a1_0x33e4('0x16')]('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x2f3d11(_0x1b05ec);}else{User_1[a1_0x33e4('0x5')]['findById'](_0x46fed7[a1_0x33e4('0x15')]['id'],(_0x1b05ec,_0x596f69)=>{if(_0x1b05ec){return _0x2f3d11(_0x1b05ec);}_0x596f69[a1_0x33e4('0x17')]=_0x27934b['id'];_0x596f69[a1_0x33e4('0x18')][a1_0x33e4('0x19')]({'kind':a1_0x33e4('0x17'),'accessToken':_0x3c496a});_0x596f69['profile'][a1_0x33e4('0x11')]=_0x596f69[a1_0x33e4('0x1a')][a1_0x33e4('0x11')]||_0x27934b[a1_0x33e4('0x11')][a1_0x33e4('0x1b')]+'\x20'+_0x27934b[a1_0x33e4('0x11')]['familyName'];_0x596f69[a1_0x33e4('0x1a')][a1_0x33e4('0x1c')]=_0x596f69['profile'][a1_0x33e4('0x1c')]||_0x27934b['_json'][a1_0x33e4('0x1c')];_0x596f69[a1_0x33e4('0x1a')][a1_0x33e4('0x1d')]=_0x596f69[a1_0x33e4('0x1a')][a1_0x33e4('0x1d')]||a1_0x33e4('0x1e')+_0x27934b['id']+a1_0x33e4('0x1f');_0x596f69[a1_0x33e4('0x20')](_0x1b05ec=>{_0x46fed7[a1_0x33e4('0x16')](a1_0x33e4('0x21'),{'msg':a1_0x33e4('0x22')});_0x2f3d11(_0x1b05ec,_0x596f69);});});}});}else{User_1[a1_0x33e4('0x5')][a1_0x33e4('0xa')]({'facebook':_0x27934b['id']},(_0x4e9d31,_0x288919)=>{if(_0x4e9d31){return _0x2f3d11(_0x4e9d31);}if(_0x288919){return _0x2f3d11(undefined,_0x288919);}User_1[a1_0x33e4('0x5')][a1_0x33e4('0xa')]({'email':_0x27934b[a1_0x33e4('0x23')][a1_0x33e4('0x12')]},(_0x4e9d31,_0x2a1b61)=>{if(_0x4e9d31){return _0x2f3d11(_0x4e9d31);}if(_0x2a1b61){_0x46fed7[a1_0x33e4('0x16')]('errors',{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x2f3d11(_0x4e9d31);}else{const _0x1ecad3=new User_1[(a1_0x33e4('0x5'))]();_0x1ecad3['email']=_0x27934b[a1_0x33e4('0x23')]['email'];_0x1ecad3[a1_0x33e4('0x17')]=_0x27934b['id'];_0x1ecad3['tokens'][a1_0x33e4('0x19')]({'kind':a1_0x33e4('0x17'),'accessToken':_0x3c496a});_0x1ecad3[a1_0x33e4('0x1a')][a1_0x33e4('0x11')]=_0x27934b[a1_0x33e4('0x11')][a1_0x33e4('0x1b')]+'\x20'+_0x27934b[a1_0x33e4('0x11')][a1_0x33e4('0x24')];_0x1ecad3['profile'][a1_0x33e4('0x1c')]=_0x27934b['_json'][a1_0x33e4('0x1c')];_0x1ecad3[a1_0x33e4('0x1a')]['picture']='https://graph.facebook.com/'+_0x27934b['id']+a1_0x33e4('0x1f');_0x1ecad3['profile'][a1_0x33e4('0x25')]=_0x27934b[a1_0x33e4('0x23')][a1_0x33e4('0x25')]?_0x27934b[a1_0x33e4('0x23')][a1_0x33e4('0x25')][a1_0x33e4('0x11')]:'';_0x1ecad3[a1_0x33e4('0x20')](_0x4e9d31=>{_0x2f3d11(_0x4e9d31,_0x1ecad3);});}});});}}));exports[a1_0x33e4('0x26')]=(_0x516f1d,_0x58616e,_0x163b49)=>{if(_0x516f1d[a1_0x33e4('0x26')]()){return _0x163b49();}_0x58616e[a1_0x33e4('0x27')](a1_0x33e4('0x28'));};exports[a1_0x33e4('0x29')]=(_0x32f265,_0x544982,_0x4dd19e)=>{const _0x14c411=_0x32f265[a1_0x33e4('0x2a')][a1_0x33e4('0x2b')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x33e4('0x5')][a1_0x33e4('0x2c')](_0x32f265[a1_0x33e4('0x15')][a1_0x33e4('0x18')],{'kind':_0x14c411})){_0x4dd19e();}else{_0x544982[a1_0x33e4('0x27')](a1_0x33e4('0x2d')+_0x14c411);}};