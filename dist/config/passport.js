var a1_0x2bf7=['gender','_json','picture','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','errors','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','https://graph.facebook.com/','location','isAuthenticated','redirect','/login','path','split','slice','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','FACEBOOK_SECRET','/auth/facebook/callback','name','email','link','locale','timezone','user','flash','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','push','facebook','profile','givenName','familyName'];(function(_0x44a383,_0x1e7964){var _0x40c387=function(_0x4f584a){while(--_0x4f584a){_0x44a383['push'](_0x44a383['shift']());}};_0x40c387(++_0x1e7964);}(a1_0x2bf7,0x11a));var a1_0x59c9=function(_0x224d92,_0xba68){_0x224d92=_0x224d92-0x0;var _0x3d7b5e=a1_0x2bf7[_0x224d92];return _0x3d7b5e;};'use strict';var __importDefault=this&&this[a1_0x59c9('0x0')]||function(_0x452674){return _0x452674&&_0x452674[a1_0x59c9('0x1')]?_0x452674:{'default':_0x452674};};Object[a1_0x59c9('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x59c9('0x3')));const passport_local_1=__importDefault(require(a1_0x59c9('0x4')));const passport_facebook_1=__importDefault(require(a1_0x59c9('0x5')));const lodash_1=__importDefault(require(a1_0x59c9('0x6')));const User_1=__importDefault(require(a1_0x59c9('0x7')));const LocalStrategy=passport_local_1['default'][a1_0x59c9('0x8')];const FacebookStrategy=passport_facebook_1['default'][a1_0x59c9('0x8')];passport_1[a1_0x59c9('0x9')][a1_0x59c9('0xa')]((_0x3b7ed6,_0x3ed603)=>{_0x3ed603(undefined,_0x3b7ed6['id']);});passport_1[a1_0x59c9('0x9')][a1_0x59c9('0xb')]((_0xd6c3d8,_0x4d8e59)=>{User_1[a1_0x59c9('0x9')][a1_0x59c9('0xc')](_0xd6c3d8,(_0x1838d2,_0x1cd3d3)=>{_0x4d8e59(_0x1838d2,_0x1cd3d3);});});passport_1[a1_0x59c9('0x9')]['use'](new LocalStrategy({'usernameField':'email'},(_0x58e0ab,_0xd5aba3,_0x5edd4d)=>{User_1[a1_0x59c9('0x9')][a1_0x59c9('0xd')]({'email':_0x58e0ab[a1_0x59c9('0xe')]()},(_0x2b6432,_0x2cd547)=>{if(_0x2b6432){return _0x5edd4d(_0x2b6432);}if(!_0x2cd547){return _0x5edd4d(undefined,![],{'message':a1_0x59c9('0xf')+_0x58e0ab+a1_0x59c9('0x10')});}_0x2cd547['comparePassword'](_0xd5aba3,(_0x2b6432,_0x3ca1d6)=>{if(_0x2b6432){return _0x5edd4d(_0x2b6432);}if(_0x3ca1d6){return _0x5edd4d(undefined,_0x2cd547);}return _0x5edd4d(undefined,![],{'message':a1_0x59c9('0x11')});});});}));passport_1[a1_0x59c9('0x9')][a1_0x59c9('0x12')](new FacebookStrategy({'clientID':process['env'][a1_0x59c9('0x13')],'clientSecret':process['env'][a1_0x59c9('0x14')],'callbackURL':a1_0x59c9('0x15'),'profileFields':[a1_0x59c9('0x16'),a1_0x59c9('0x17'),a1_0x59c9('0x18'),a1_0x59c9('0x19'),a1_0x59c9('0x1a')],'passReqToCallback':!![]},(_0x5bb21b,_0x293715,_0x174029,_0xb9690e,_0x51cf10)=>{if(_0x5bb21b[a1_0x59c9('0x1b')]){User_1[a1_0x59c9('0x9')][a1_0x59c9('0xd')]({'facebook':_0xb9690e['id']},(_0x45288c,_0x29ca99)=>{if(_0x45288c){return _0x51cf10(_0x45288c);}if(_0x29ca99){_0x5bb21b[a1_0x59c9('0x1c')]('errors',{'msg':a1_0x59c9('0x1d')});_0x51cf10(_0x45288c);}else{User_1['default'][a1_0x59c9('0xc')](_0x5bb21b[a1_0x59c9('0x1b')]['id'],(_0x45288c,_0x3ed823)=>{if(_0x45288c){return _0x51cf10(_0x45288c);}_0x3ed823['facebook']=_0xb9690e['id'];_0x3ed823[a1_0x59c9('0x1e')][a1_0x59c9('0x1f')]({'kind':a1_0x59c9('0x20'),'accessToken':_0x293715});_0x3ed823[a1_0x59c9('0x21')]['name']=_0x3ed823[a1_0x59c9('0x21')][a1_0x59c9('0x16')]||_0xb9690e[a1_0x59c9('0x16')][a1_0x59c9('0x22')]+'\x20'+_0xb9690e[a1_0x59c9('0x16')][a1_0x59c9('0x23')];_0x3ed823[a1_0x59c9('0x21')][a1_0x59c9('0x24')]=_0x3ed823[a1_0x59c9('0x21')][a1_0x59c9('0x24')]||_0xb9690e[a1_0x59c9('0x25')][a1_0x59c9('0x24')];_0x3ed823[a1_0x59c9('0x21')]['picture']=_0x3ed823[a1_0x59c9('0x21')][a1_0x59c9('0x26')]||'https://graph.facebook.com/'+_0xb9690e['id']+a1_0x59c9('0x27');_0x3ed823[a1_0x59c9('0x28')](_0x45288c=>{_0x5bb21b['flash'](a1_0x59c9('0x29'),{'msg':a1_0x59c9('0x2a')});_0x51cf10(_0x45288c,_0x3ed823);});});}});}else{User_1[a1_0x59c9('0x9')][a1_0x59c9('0xd')]({'facebook':_0xb9690e['id']},(_0x30c9a1,_0x5cccdb)=>{if(_0x30c9a1){return _0x51cf10(_0x30c9a1);}if(_0x5cccdb){return _0x51cf10(undefined,_0x5cccdb);}User_1[a1_0x59c9('0x9')][a1_0x59c9('0xd')]({'email':_0xb9690e[a1_0x59c9('0x25')][a1_0x59c9('0x17')]},(_0x30c9a1,_0x926196)=>{if(_0x30c9a1){return _0x51cf10(_0x30c9a1);}if(_0x926196){_0x5bb21b['flash'](a1_0x59c9('0x2b'),{'msg':a1_0x59c9('0x2c')});_0x51cf10(_0x30c9a1);}else{const _0x496e31=new User_1['default']();_0x496e31[a1_0x59c9('0x17')]=_0xb9690e[a1_0x59c9('0x25')][a1_0x59c9('0x17')];_0x496e31[a1_0x59c9('0x20')]=_0xb9690e['id'];_0x496e31[a1_0x59c9('0x1e')][a1_0x59c9('0x1f')]({'kind':a1_0x59c9('0x20'),'accessToken':_0x293715});_0x496e31[a1_0x59c9('0x21')]['name']=_0xb9690e[a1_0x59c9('0x16')][a1_0x59c9('0x22')]+'\x20'+_0xb9690e[a1_0x59c9('0x16')][a1_0x59c9('0x23')];_0x496e31['profile'][a1_0x59c9('0x24')]=_0xb9690e[a1_0x59c9('0x25')][a1_0x59c9('0x24')];_0x496e31[a1_0x59c9('0x21')][a1_0x59c9('0x26')]=a1_0x59c9('0x2d')+_0xb9690e['id']+a1_0x59c9('0x27');_0x496e31['profile'][a1_0x59c9('0x2e')]=_0xb9690e['_json'][a1_0x59c9('0x2e')]?_0xb9690e[a1_0x59c9('0x25')]['location'][a1_0x59c9('0x16')]:'';_0x496e31[a1_0x59c9('0x28')](_0x30c9a1=>{_0x51cf10(_0x30c9a1,_0x496e31);});}});});}}));exports[a1_0x59c9('0x2f')]=(_0x2b7fa9,_0x33be7f,_0x1e3739)=>{if(_0x2b7fa9[a1_0x59c9('0x2f')]()){return _0x1e3739();}_0x33be7f[a1_0x59c9('0x30')](a1_0x59c9('0x31'));};exports['isAuthorized']=(_0x285650,_0x256448,_0x2bdc01)=>{const _0x201532=_0x285650[a1_0x59c9('0x32')][a1_0x59c9('0x33')]('/')[a1_0x59c9('0x34')](-0x1)[0x0];if(lodash_1['default']['find'](_0x285650['user'][a1_0x59c9('0x1e')],{'kind':_0x201532})){_0x2bdc01();}else{_0x256448[a1_0x59c9('0x30')]('/auth/'+_0x201532);}};