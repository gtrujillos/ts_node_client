var a1_0x49c8=['save','isAuthenticated','/login','isAuthorized','split','slice','find','tokens','redirect','/auth/','__importDefault','defineProperty','default','Strategy','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','/auth/facebook/callback','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','push','profile','name','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location'];(function(_0x41c432,_0x2398fc){var _0x2324d5=function(_0x18fe73){while(--_0x18fe73){_0x41c432['push'](_0x41c432['shift']());}};_0x2324d5(++_0x2398fc);}(a1_0x49c8,0x1a8));var a1_0x2667=function(_0x4786e0,_0x21ea33){_0x4786e0=_0x4786e0-0x0;var _0x3f016c=a1_0x49c8[_0x4786e0];return _0x3f016c;};'use strict';var __importDefault=this&&this[a1_0x2667('0x0')]||function(_0x14317a){return _0x14317a&&_0x14317a['__esModule']?_0x14317a:{'default':_0x14317a};};Object[a1_0x2667('0x1')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x2667('0x2')][a1_0x2667('0x3')];const FacebookStrategy=passport_facebook_1['default'][a1_0x2667('0x3')];passport_1[a1_0x2667('0x2')]['serializeUser']((_0x14ec9f,_0x295a8d)=>{_0x295a8d(undefined,_0x14ec9f['id']);});passport_1[a1_0x2667('0x2')]['deserializeUser']((_0x31885c,_0x54cdc9)=>{User_1[a1_0x2667('0x2')][a1_0x2667('0x4')](_0x31885c,(_0x5678e7,_0x2c9c06)=>{_0x54cdc9(_0x5678e7,_0x2c9c06);});});passport_1[a1_0x2667('0x2')][a1_0x2667('0x5')](new LocalStrategy({'usernameField':a1_0x2667('0x6')},(_0x1782ab,_0x18c6cb,_0x2394dc)=>{User_1[a1_0x2667('0x2')][a1_0x2667('0x7')]({'email':_0x1782ab[a1_0x2667('0x8')]()},(_0x4d408d,_0x9b7791)=>{if(_0x4d408d){return _0x2394dc(_0x4d408d);}if(!_0x9b7791){return _0x2394dc(undefined,![],{'message':a1_0x2667('0x9')+_0x1782ab+a1_0x2667('0xa')});}_0x9b7791['comparePassword'](_0x18c6cb,(_0x4d408d,_0x313406)=>{if(_0x4d408d){return _0x2394dc(_0x4d408d);}if(_0x313406){return _0x2394dc(undefined,_0x9b7791);}return _0x2394dc(undefined,![],{'message':a1_0x2667('0xb')});});});}));passport_1[a1_0x2667('0x2')][a1_0x2667('0x5')](new FacebookStrategy({'clientID':process['env'][a1_0x2667('0xc')],'clientSecret':process[a1_0x2667('0xd')]['FACEBOOK_SECRET'],'callbackURL':a1_0x2667('0xe'),'profileFields':['name','email','link',a1_0x2667('0xf'),a1_0x2667('0x10')],'passReqToCallback':!![]},(_0x38dfce,_0xfef1ab,_0x384562,_0x15b244,_0x2b2918)=>{if(_0x38dfce[a1_0x2667('0x11')]){User_1[a1_0x2667('0x2')][a1_0x2667('0x7')]({'facebook':_0x15b244['id']},(_0x56a232,_0x3e1b64)=>{if(_0x56a232){return _0x2b2918(_0x56a232);}if(_0x3e1b64){_0x38dfce[a1_0x2667('0x12')](a1_0x2667('0x13'),{'msg':a1_0x2667('0x14')});_0x2b2918(_0x56a232);}else{User_1[a1_0x2667('0x2')][a1_0x2667('0x4')](_0x38dfce[a1_0x2667('0x11')]['id'],(_0x56a232,_0x4763a7)=>{if(_0x56a232){return _0x2b2918(_0x56a232);}_0x4763a7[a1_0x2667('0x15')]=_0x15b244['id'];_0x4763a7['tokens'][a1_0x2667('0x16')]({'kind':a1_0x2667('0x15'),'accessToken':_0xfef1ab});_0x4763a7[a1_0x2667('0x17')][a1_0x2667('0x18')]=_0x4763a7['profile'][a1_0x2667('0x18')]||_0x15b244[a1_0x2667('0x18')][a1_0x2667('0x19')]+'\x20'+_0x15b244[a1_0x2667('0x18')][a1_0x2667('0x1a')];_0x4763a7[a1_0x2667('0x17')][a1_0x2667('0x1b')]=_0x4763a7[a1_0x2667('0x17')][a1_0x2667('0x1b')]||_0x15b244[a1_0x2667('0x1c')]['gender'];_0x4763a7[a1_0x2667('0x17')][a1_0x2667('0x1d')]=_0x4763a7[a1_0x2667('0x17')]['picture']||a1_0x2667('0x1e')+_0x15b244['id']+a1_0x2667('0x1f');_0x4763a7['save'](_0x56a232=>{_0x38dfce[a1_0x2667('0x12')](a1_0x2667('0x20'),{'msg':a1_0x2667('0x21')});_0x2b2918(_0x56a232,_0x4763a7);});});}});}else{User_1[a1_0x2667('0x2')][a1_0x2667('0x7')]({'facebook':_0x15b244['id']},(_0x27ebfa,_0x4301d0)=>{if(_0x27ebfa){return _0x2b2918(_0x27ebfa);}if(_0x4301d0){return _0x2b2918(undefined,_0x4301d0);}User_1[a1_0x2667('0x2')][a1_0x2667('0x7')]({'email':_0x15b244['_json'][a1_0x2667('0x6')]},(_0x27ebfa,_0x65a0b4)=>{if(_0x27ebfa){return _0x2b2918(_0x27ebfa);}if(_0x65a0b4){_0x38dfce[a1_0x2667('0x12')](a1_0x2667('0x13'),{'msg':a1_0x2667('0x22')});_0x2b2918(_0x27ebfa);}else{const _0x7525a1=new User_1[(a1_0x2667('0x2'))]();_0x7525a1[a1_0x2667('0x6')]=_0x15b244[a1_0x2667('0x1c')][a1_0x2667('0x6')];_0x7525a1['facebook']=_0x15b244['id'];_0x7525a1['tokens']['push']({'kind':a1_0x2667('0x15'),'accessToken':_0xfef1ab});_0x7525a1['profile'][a1_0x2667('0x18')]=_0x15b244[a1_0x2667('0x18')][a1_0x2667('0x19')]+'\x20'+_0x15b244[a1_0x2667('0x18')]['familyName'];_0x7525a1['profile'][a1_0x2667('0x1b')]=_0x15b244['_json']['gender'];_0x7525a1['profile']['picture']=a1_0x2667('0x1e')+_0x15b244['id']+a1_0x2667('0x1f');_0x7525a1[a1_0x2667('0x17')][a1_0x2667('0x23')]=_0x15b244[a1_0x2667('0x1c')][a1_0x2667('0x23')]?_0x15b244[a1_0x2667('0x1c')]['location'][a1_0x2667('0x18')]:'';_0x7525a1[a1_0x2667('0x24')](_0x27ebfa=>{_0x2b2918(_0x27ebfa,_0x7525a1);});}});});}}));exports[a1_0x2667('0x25')]=(_0x1edaf6,_0x11f0df,_0x140a16)=>{if(_0x1edaf6['isAuthenticated']()){return _0x140a16();}_0x11f0df['redirect'](a1_0x2667('0x26'));};exports[a1_0x2667('0x27')]=(_0x40fd4b,_0x4f8f5f,_0xb6ddd)=>{const _0x55588d=_0x40fd4b['path'][a1_0x2667('0x28')]('/')[a1_0x2667('0x29')](-0x1)[0x0];if(lodash_1[a1_0x2667('0x2')][a1_0x2667('0x2a')](_0x40fd4b['user'][a1_0x2667('0x2b')],{'kind':_0x55588d})){_0xb6ddd();}else{_0x4f8f5f[a1_0x2667('0x2c')](a1_0x2667('0x2d')+_0x55588d);}};