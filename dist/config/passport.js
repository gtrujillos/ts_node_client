var a1_0x33f3=['flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','redirect','/login','isAuthorized','path','split','slice','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','default','Strategy','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','errors','tokens','push','facebook','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save'];(function(_0x37a19e,_0x19c23b){var _0x1a88e4=function(_0x447eee){while(--_0x447eee){_0x37a19e['push'](_0x37a19e['shift']());}};_0x1a88e4(++_0x19c23b);}(a1_0x33f3,0xe6));var a1_0x5c37=function(_0x3387a0,_0x273b16){_0x3387a0=_0x3387a0-0x0;var _0x20b752=a1_0x33f3[_0x3387a0];return _0x20b752;};'use strict';var __importDefault=this&&this[a1_0x5c37('0x0')]||function(_0x656669){return _0x656669&&_0x656669[a1_0x5c37('0x1')]?_0x656669:{'default':_0x656669};};Object[a1_0x5c37('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x5c37('0x3')));const passport_local_1=__importDefault(require(a1_0x5c37('0x4')));const passport_facebook_1=__importDefault(require(a1_0x5c37('0x5')));const lodash_1=__importDefault(require(a1_0x5c37('0x6')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1[a1_0x5c37('0x7')][a1_0x5c37('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x5c37('0x7')][a1_0x5c37('0x8')];passport_1[a1_0x5c37('0x7')][a1_0x5c37('0x9')]((_0x1faf44,_0x46aa19)=>{_0x46aa19(undefined,_0x1faf44['id']);});passport_1[a1_0x5c37('0x7')][a1_0x5c37('0xa')]((_0x541ce9,_0x4066e5)=>{User_1['default'][a1_0x5c37('0xb')](_0x541ce9,(_0x4a48ed,_0x3fd9c6)=>{_0x4066e5(_0x4a48ed,_0x3fd9c6);});});passport_1[a1_0x5c37('0x7')][a1_0x5c37('0xc')](new LocalStrategy({'usernameField':a1_0x5c37('0xd')},(_0x3955b4,_0x354c83,_0xe07514)=>{User_1['default'][a1_0x5c37('0xe')]({'email':_0x3955b4[a1_0x5c37('0xf')]()},(_0x4ba75b,_0x467575)=>{if(_0x4ba75b){return _0xe07514(_0x4ba75b);}if(!_0x467575){return _0xe07514(undefined,![],{'message':a1_0x5c37('0x10')+_0x3955b4+'\x20not\x20found.'});}_0x467575[a1_0x5c37('0x11')](_0x354c83,(_0x4ba75b,_0x9bf6a2)=>{if(_0x4ba75b){return _0xe07514(_0x4ba75b);}if(_0x9bf6a2){return _0xe07514(undefined,_0x467575);}return _0xe07514(undefined,![],{'message':a1_0x5c37('0x12')});});});}));passport_1['default'][a1_0x5c37('0xc')](new FacebookStrategy({'clientID':process[a1_0x5c37('0x13')]['FACEBOOK_ID'],'clientSecret':process[a1_0x5c37('0x13')][a1_0x5c37('0x14')],'callbackURL':a1_0x5c37('0x15'),'profileFields':[a1_0x5c37('0x16'),a1_0x5c37('0xd'),a1_0x5c37('0x17'),a1_0x5c37('0x18'),a1_0x5c37('0x19')],'passReqToCallback':!![]},(_0x5dadee,_0x445842,_0x2edf5b,_0x103de9,_0x39585a)=>{if(_0x5dadee[a1_0x5c37('0x1a')]){User_1['default'][a1_0x5c37('0xe')]({'facebook':_0x103de9['id']},(_0x4576ba,_0x3af717)=>{if(_0x4576ba){return _0x39585a(_0x4576ba);}if(_0x3af717){_0x5dadee['flash'](a1_0x5c37('0x1b'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x39585a(_0x4576ba);}else{User_1['default'][a1_0x5c37('0xb')](_0x5dadee[a1_0x5c37('0x1a')]['id'],(_0x4576ba,_0x4fbdbb)=>{if(_0x4576ba){return _0x39585a(_0x4576ba);}_0x4fbdbb['facebook']=_0x103de9['id'];_0x4fbdbb[a1_0x5c37('0x1c')][a1_0x5c37('0x1d')]({'kind':a1_0x5c37('0x1e'),'accessToken':_0x445842});_0x4fbdbb['profile'][a1_0x5c37('0x16')]=_0x4fbdbb[a1_0x5c37('0x1f')]['name']||_0x103de9[a1_0x5c37('0x16')][a1_0x5c37('0x20')]+'\x20'+_0x103de9[a1_0x5c37('0x16')][a1_0x5c37('0x21')];_0x4fbdbb[a1_0x5c37('0x1f')][a1_0x5c37('0x22')]=_0x4fbdbb[a1_0x5c37('0x1f')][a1_0x5c37('0x22')]||_0x103de9[a1_0x5c37('0x23')][a1_0x5c37('0x22')];_0x4fbdbb[a1_0x5c37('0x1f')][a1_0x5c37('0x24')]=_0x4fbdbb[a1_0x5c37('0x1f')]['picture']||a1_0x5c37('0x25')+_0x103de9['id']+a1_0x5c37('0x26');_0x4fbdbb[a1_0x5c37('0x27')](_0x4576ba=>{_0x5dadee[a1_0x5c37('0x28')](a1_0x5c37('0x29'),{'msg':a1_0x5c37('0x2a')});_0x39585a(_0x4576ba,_0x4fbdbb);});});}});}else{User_1[a1_0x5c37('0x7')][a1_0x5c37('0xe')]({'facebook':_0x103de9['id']},(_0x26da9c,_0x4b9326)=>{if(_0x26da9c){return _0x39585a(_0x26da9c);}if(_0x4b9326){return _0x39585a(undefined,_0x4b9326);}User_1[a1_0x5c37('0x7')][a1_0x5c37('0xe')]({'email':_0x103de9[a1_0x5c37('0x23')][a1_0x5c37('0xd')]},(_0x26da9c,_0x2b6c19)=>{if(_0x26da9c){return _0x39585a(_0x26da9c);}if(_0x2b6c19){_0x5dadee['flash'](a1_0x5c37('0x1b'),{'msg':a1_0x5c37('0x2b')});_0x39585a(_0x26da9c);}else{const _0x16cc64=new User_1[(a1_0x5c37('0x7'))]();_0x16cc64[a1_0x5c37('0xd')]=_0x103de9[a1_0x5c37('0x23')][a1_0x5c37('0xd')];_0x16cc64[a1_0x5c37('0x1e')]=_0x103de9['id'];_0x16cc64[a1_0x5c37('0x1c')][a1_0x5c37('0x1d')]({'kind':a1_0x5c37('0x1e'),'accessToken':_0x445842});_0x16cc64[a1_0x5c37('0x1f')][a1_0x5c37('0x16')]=_0x103de9[a1_0x5c37('0x16')][a1_0x5c37('0x20')]+'\x20'+_0x103de9['name'][a1_0x5c37('0x21')];_0x16cc64['profile'][a1_0x5c37('0x22')]=_0x103de9[a1_0x5c37('0x23')]['gender'];_0x16cc64[a1_0x5c37('0x1f')]['picture']=a1_0x5c37('0x25')+_0x103de9['id']+a1_0x5c37('0x26');_0x16cc64[a1_0x5c37('0x1f')][a1_0x5c37('0x2c')]=_0x103de9[a1_0x5c37('0x23')][a1_0x5c37('0x2c')]?_0x103de9[a1_0x5c37('0x23')][a1_0x5c37('0x2c')][a1_0x5c37('0x16')]:'';_0x16cc64[a1_0x5c37('0x27')](_0x26da9c=>{_0x39585a(_0x26da9c,_0x16cc64);});}});});}}));exports[a1_0x5c37('0x2d')]=(_0x601146,_0x3a04c8,_0x5a69ff)=>{if(_0x601146['isAuthenticated']()){return _0x5a69ff();}_0x3a04c8[a1_0x5c37('0x2e')](a1_0x5c37('0x2f'));};exports[a1_0x5c37('0x30')]=(_0x11ba1f,_0x3b9c0b,_0x41c729)=>{const _0x37a718=_0x11ba1f[a1_0x5c37('0x31')][a1_0x5c37('0x32')]('/')[a1_0x5c37('0x33')](-0x1)[0x0];if(lodash_1['default'][a1_0x5c37('0x34')](_0x11ba1f['user'][a1_0x5c37('0x1c')],{'kind':_0x37a718})){_0x41c729();}else{_0x3b9c0b[a1_0x5c37('0x2e')](a1_0x5c37('0x35')+_0x37a718);}};