var a1_0x32c1=['user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','givenName','location','isAuthenticated','/login','isAuthorized','path','split','redirect','__esModule','passport','passport-facebook','lodash','../models/User','Strategy','default','serializeUser','deserializeUser','findById','email','findOne','Email\x20','comparePassword','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','FACEBOOK_SECRET','name','link'];(function(_0x242ecc,_0x528af0){var _0x1e1be8=function(_0x1efd91){while(--_0x1efd91){_0x242ecc['push'](_0x242ecc['shift']());}};_0x1e1be8(++_0x528af0);}(a1_0x32c1,0xff));var a1_0x4b23=function(_0x37723f,_0x27d2b5){_0x37723f=_0x37723f-0x0;var _0x1f321f=a1_0x32c1[_0x37723f];return _0x1f321f;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x845e70){return _0x845e70&&_0x845e70[a1_0x4b23('0x0')]?_0x845e70:{'default':_0x845e70};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4b23('0x1')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4b23('0x2')));const lodash_1=__importDefault(require(a1_0x4b23('0x3')));const User_1=__importDefault(require(a1_0x4b23('0x4')));const LocalStrategy=passport_local_1['default'][a1_0x4b23('0x5')];const FacebookStrategy=passport_facebook_1[a1_0x4b23('0x6')][a1_0x4b23('0x5')];passport_1[a1_0x4b23('0x6')][a1_0x4b23('0x7')]((_0x4f6d71,_0x2a3d90)=>{_0x2a3d90(undefined,_0x4f6d71['id']);});passport_1['default'][a1_0x4b23('0x8')]((_0x2cdaa2,_0x55abcd)=>{User_1[a1_0x4b23('0x6')][a1_0x4b23('0x9')](_0x2cdaa2,(_0x5874ca,_0x37093b)=>{_0x55abcd(_0x5874ca,_0x37093b);});});passport_1[a1_0x4b23('0x6')]['use'](new LocalStrategy({'usernameField':a1_0x4b23('0xa')},(_0x33971d,_0x28a172,_0x536cc4)=>{User_1[a1_0x4b23('0x6')][a1_0x4b23('0xb')]({'email':_0x33971d['toLowerCase']()},(_0x231d4d,_0x5f37ba)=>{if(_0x231d4d){return _0x536cc4(_0x231d4d);}if(!_0x5f37ba){return _0x536cc4(undefined,![],{'message':a1_0x4b23('0xc')+_0x33971d+'\x20not\x20found.'});}_0x5f37ba[a1_0x4b23('0xd')](_0x28a172,(_0x231d4d,_0x33567b)=>{if(_0x231d4d){return _0x536cc4(_0x231d4d);}if(_0x33567b){return _0x536cc4(undefined,_0x5f37ba);}return _0x536cc4(undefined,![],{'message':a1_0x4b23('0xe')});});});}));passport_1[a1_0x4b23('0x6')][a1_0x4b23('0xf')](new FacebookStrategy({'clientID':process[a1_0x4b23('0x10')][a1_0x4b23('0x11')],'clientSecret':process['env'][a1_0x4b23('0x12')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x4b23('0x13'),a1_0x4b23('0xa'),a1_0x4b23('0x14'),'locale','timezone'],'passReqToCallback':!![]},(_0x8a557b,_0x5ead17,_0x524bad,_0x1ccd82,_0x35b9b8)=>{if(_0x8a557b[a1_0x4b23('0x15')]){User_1[a1_0x4b23('0x6')]['findOne']({'facebook':_0x1ccd82['id']},(_0x1348c8,_0x592182)=>{if(_0x1348c8){return _0x35b9b8(_0x1348c8);}if(_0x592182){_0x8a557b[a1_0x4b23('0x16')](a1_0x4b23('0x17'),{'msg':a1_0x4b23('0x18')});_0x35b9b8(_0x1348c8);}else{User_1[a1_0x4b23('0x6')][a1_0x4b23('0x9')](_0x8a557b[a1_0x4b23('0x15')]['id'],(_0x1348c8,_0x2311da)=>{if(_0x1348c8){return _0x35b9b8(_0x1348c8);}_0x2311da[a1_0x4b23('0x19')]=_0x1ccd82['id'];_0x2311da[a1_0x4b23('0x1a')][a1_0x4b23('0x1b')]({'kind':a1_0x4b23('0x19'),'accessToken':_0x5ead17});_0x2311da['profile'][a1_0x4b23('0x13')]=_0x2311da[a1_0x4b23('0x1c')][a1_0x4b23('0x13')]||_0x1ccd82['name']['givenName']+'\x20'+_0x1ccd82['name'][a1_0x4b23('0x1d')];_0x2311da['profile'][a1_0x4b23('0x1e')]=_0x2311da['profile'][a1_0x4b23('0x1e')]||_0x1ccd82[a1_0x4b23('0x1f')][a1_0x4b23('0x1e')];_0x2311da['profile']['picture']=_0x2311da[a1_0x4b23('0x1c')][a1_0x4b23('0x20')]||a1_0x4b23('0x21')+_0x1ccd82['id']+a1_0x4b23('0x22');_0x2311da[a1_0x4b23('0x23')](_0x1348c8=>{_0x8a557b['flash'](a1_0x4b23('0x24'),{'msg':a1_0x4b23('0x25')});_0x35b9b8(_0x1348c8,_0x2311da);});});}});}else{User_1[a1_0x4b23('0x6')][a1_0x4b23('0xb')]({'facebook':_0x1ccd82['id']},(_0x3cc5e8,_0xdf243d)=>{if(_0x3cc5e8){return _0x35b9b8(_0x3cc5e8);}if(_0xdf243d){return _0x35b9b8(undefined,_0xdf243d);}User_1[a1_0x4b23('0x6')][a1_0x4b23('0xb')]({'email':_0x1ccd82[a1_0x4b23('0x1f')]['email']},(_0x3cc5e8,_0x1c02b4)=>{if(_0x3cc5e8){return _0x35b9b8(_0x3cc5e8);}if(_0x1c02b4){_0x8a557b[a1_0x4b23('0x16')](a1_0x4b23('0x17'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x35b9b8(_0x3cc5e8);}else{const _0x4d30cb=new User_1[(a1_0x4b23('0x6'))]();_0x4d30cb[a1_0x4b23('0xa')]=_0x1ccd82[a1_0x4b23('0x1f')]['email'];_0x4d30cb['facebook']=_0x1ccd82['id'];_0x4d30cb[a1_0x4b23('0x1a')][a1_0x4b23('0x1b')]({'kind':'facebook','accessToken':_0x5ead17});_0x4d30cb[a1_0x4b23('0x1c')][a1_0x4b23('0x13')]=_0x1ccd82[a1_0x4b23('0x13')][a1_0x4b23('0x26')]+'\x20'+_0x1ccd82[a1_0x4b23('0x13')][a1_0x4b23('0x1d')];_0x4d30cb[a1_0x4b23('0x1c')][a1_0x4b23('0x1e')]=_0x1ccd82[a1_0x4b23('0x1f')]['gender'];_0x4d30cb[a1_0x4b23('0x1c')][a1_0x4b23('0x20')]='https://graph.facebook.com/'+_0x1ccd82['id']+a1_0x4b23('0x22');_0x4d30cb[a1_0x4b23('0x1c')][a1_0x4b23('0x27')]=_0x1ccd82['_json'][a1_0x4b23('0x27')]?_0x1ccd82['_json'][a1_0x4b23('0x27')][a1_0x4b23('0x13')]:'';_0x4d30cb[a1_0x4b23('0x23')](_0x3cc5e8=>{_0x35b9b8(_0x3cc5e8,_0x4d30cb);});}});});}}));exports[a1_0x4b23('0x28')]=(_0x3f65ce,_0x12ffa2,_0x1efd78)=>{if(_0x3f65ce[a1_0x4b23('0x28')]()){return _0x1efd78();}_0x12ffa2['redirect'](a1_0x4b23('0x29'));};exports[a1_0x4b23('0x2a')]=(_0x3ff22a,_0x4f0781,_0x37c9f1)=>{const _0xf7d185=_0x3ff22a[a1_0x4b23('0x2b')][a1_0x4b23('0x2c')]('/')['slice'](-0x1)[0x0];if(lodash_1['default']['find'](_0x3ff22a['user'][a1_0x4b23('0x1a')],{'kind':_0xf7d185})){_0x37c9f1();}else{_0x4f0781[a1_0x4b23('0x2d')]('/auth/'+_0xf7d185);}};