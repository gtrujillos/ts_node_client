var a1_0x5123=['FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','findOne','flash','errors','findById','user','facebook','push','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','tokens','location','isAuthenticated','/login','isAuthorized','path','split','slice','find','/auth/','__esModule','defineProperty','passport','passport-local','passport-facebook','lodash','default','Strategy','deserializeUser','use','email','toLowerCase','Email\x20','\x20not\x20found.','env'];(function(_0xc0128e,_0x44cfe3){var _0x5a8adf=function(_0xe548c){while(--_0xe548c){_0xc0128e['push'](_0xc0128e['shift']());}};_0x5a8adf(++_0x44cfe3);}(a1_0x5123,0xdc));var a1_0x5989=function(_0x5081b2,_0x286e47){_0x5081b2=_0x5081b2-0x0;var _0x2098c0=a1_0x5123[_0x5081b2];return _0x2098c0;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x26924c){return _0x26924c&&_0x26924c[a1_0x5989('0x0')]?_0x26924c:{'default':_0x26924c};};Object[a1_0x5989('0x1')](exports,a1_0x5989('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x5989('0x2')));const passport_local_1=__importDefault(require(a1_0x5989('0x3')));const passport_facebook_1=__importDefault(require(a1_0x5989('0x4')));const lodash_1=__importDefault(require(a1_0x5989('0x5')));const User_1=__importDefault(require('../models/User'));const LocalStrategy=passport_local_1['default']['Strategy'];const FacebookStrategy=passport_facebook_1[a1_0x5989('0x6')][a1_0x5989('0x7')];passport_1[a1_0x5989('0x6')]['serializeUser']((_0x48b4c0,_0xea0563)=>{_0xea0563(undefined,_0x48b4c0['id']);});passport_1[a1_0x5989('0x6')][a1_0x5989('0x8')]((_0x10bbf3,_0x517ebc)=>{User_1['default']['findById'](_0x10bbf3,(_0x25bf33,_0x102389)=>{_0x517ebc(_0x25bf33,_0x102389);});});passport_1[a1_0x5989('0x6')][a1_0x5989('0x9')](new LocalStrategy({'usernameField':a1_0x5989('0xa')},(_0x4553a5,_0x23ee32,_0x345bd8)=>{User_1[a1_0x5989('0x6')]['findOne']({'email':_0x4553a5[a1_0x5989('0xb')]()},(_0x1c55b8,_0x2a547c)=>{if(_0x1c55b8){return _0x345bd8(_0x1c55b8);}if(!_0x2a547c){return _0x345bd8(undefined,![],{'message':a1_0x5989('0xc')+_0x4553a5+a1_0x5989('0xd')});}_0x2a547c['comparePassword'](_0x23ee32,(_0x1c55b8,_0x472ac5)=>{if(_0x1c55b8){return _0x345bd8(_0x1c55b8);}if(_0x472ac5){return _0x345bd8(undefined,_0x2a547c);}return _0x345bd8(undefined,![],{'message':'Invalid\x20email\x20or\x20password.'});});});}));passport_1['default'][a1_0x5989('0x9')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x5989('0xe')][a1_0x5989('0xf')],'callbackURL':a1_0x5989('0x10'),'profileFields':[a1_0x5989('0x11'),'email','link',a1_0x5989('0x12'),a1_0x5989('0x13')],'passReqToCallback':!![]},(_0x816722,_0x32dad0,_0x54cdd9,_0x1ceb31,_0x207b95)=>{if(_0x816722['user']){User_1[a1_0x5989('0x6')][a1_0x5989('0x14')]({'facebook':_0x1ceb31['id']},(_0x428197,_0x33a1b5)=>{if(_0x428197){return _0x207b95(_0x428197);}if(_0x33a1b5){_0x816722[a1_0x5989('0x15')](a1_0x5989('0x16'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x207b95(_0x428197);}else{User_1[a1_0x5989('0x6')][a1_0x5989('0x17')](_0x816722[a1_0x5989('0x18')]['id'],(_0x428197,_0x18b69d)=>{if(_0x428197){return _0x207b95(_0x428197);}_0x18b69d[a1_0x5989('0x19')]=_0x1ceb31['id'];_0x18b69d['tokens'][a1_0x5989('0x1a')]({'kind':a1_0x5989('0x19'),'accessToken':_0x32dad0});_0x18b69d[a1_0x5989('0x1b')][a1_0x5989('0x11')]=_0x18b69d[a1_0x5989('0x1b')]['name']||_0x1ceb31[a1_0x5989('0x11')][a1_0x5989('0x1c')]+'\x20'+_0x1ceb31[a1_0x5989('0x11')][a1_0x5989('0x1d')];_0x18b69d[a1_0x5989('0x1b')][a1_0x5989('0x1e')]=_0x18b69d[a1_0x5989('0x1b')][a1_0x5989('0x1e')]||_0x1ceb31[a1_0x5989('0x1f')][a1_0x5989('0x1e')];_0x18b69d['profile'][a1_0x5989('0x20')]=_0x18b69d['profile'][a1_0x5989('0x20')]||a1_0x5989('0x21')+_0x1ceb31['id']+a1_0x5989('0x22');_0x18b69d[a1_0x5989('0x23')](_0x428197=>{_0x816722['flash'](a1_0x5989('0x24'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x207b95(_0x428197,_0x18b69d);});});}});}else{User_1[a1_0x5989('0x6')][a1_0x5989('0x14')]({'facebook':_0x1ceb31['id']},(_0x4173fb,_0x1fa80f)=>{if(_0x4173fb){return _0x207b95(_0x4173fb);}if(_0x1fa80f){return _0x207b95(undefined,_0x1fa80f);}User_1[a1_0x5989('0x6')][a1_0x5989('0x14')]({'email':_0x1ceb31[a1_0x5989('0x1f')]['email']},(_0x4173fb,_0x195f21)=>{if(_0x4173fb){return _0x207b95(_0x4173fb);}if(_0x195f21){_0x816722[a1_0x5989('0x15')](a1_0x5989('0x16'),{'msg':'There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'});_0x207b95(_0x4173fb);}else{const _0x1342a1=new User_1['default']();_0x1342a1[a1_0x5989('0xa')]=_0x1ceb31['_json'][a1_0x5989('0xa')];_0x1342a1['facebook']=_0x1ceb31['id'];_0x1342a1[a1_0x5989('0x25')][a1_0x5989('0x1a')]({'kind':a1_0x5989('0x19'),'accessToken':_0x32dad0});_0x1342a1['profile'][a1_0x5989('0x11')]=_0x1ceb31[a1_0x5989('0x11')][a1_0x5989('0x1c')]+'\x20'+_0x1ceb31[a1_0x5989('0x11')][a1_0x5989('0x1d')];_0x1342a1[a1_0x5989('0x1b')][a1_0x5989('0x1e')]=_0x1ceb31[a1_0x5989('0x1f')][a1_0x5989('0x1e')];_0x1342a1[a1_0x5989('0x1b')][a1_0x5989('0x20')]='https://graph.facebook.com/'+_0x1ceb31['id']+a1_0x5989('0x22');_0x1342a1[a1_0x5989('0x1b')]['location']=_0x1ceb31['_json'][a1_0x5989('0x26')]?_0x1ceb31[a1_0x5989('0x1f')][a1_0x5989('0x26')][a1_0x5989('0x11')]:'';_0x1342a1[a1_0x5989('0x23')](_0x4173fb=>{_0x207b95(_0x4173fb,_0x1342a1);});}});});}}));exports[a1_0x5989('0x27')]=(_0x1a5c0f,_0x4498d8,_0x1785fb)=>{if(_0x1a5c0f[a1_0x5989('0x27')]()){return _0x1785fb();}_0x4498d8['redirect'](a1_0x5989('0x28'));};exports[a1_0x5989('0x29')]=(_0x3cf367,_0x2060a9,_0x334913)=>{const _0x46f610=_0x3cf367[a1_0x5989('0x2a')][a1_0x5989('0x2b')]('/')[a1_0x5989('0x2c')](-0x1)[0x0];if(lodash_1[a1_0x5989('0x6')][a1_0x5989('0x2d')](_0x3cf367[a1_0x5989('0x18')][a1_0x5989('0x25')],{'kind':_0x46f610})){_0x334913();}else{_0x2060a9['redirect'](a1_0x5989('0x2e')+_0x46f610);}};