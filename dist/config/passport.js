var a1_0x1ebf=['gender','_json','picture','https://graph.facebook.com/','/picture?type=large','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','push','location','isAuthenticated','redirect','/login','isAuthorized','path','split','find','/auth/','__importDefault','__esModule','defineProperty','passport','passport-local','passport-facebook','../models/User','default','serializeUser','deserializeUser','findById','use','email','findOne','toLowerCase','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','FACEBOOK_SECRET','/auth/facebook/callback','name','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','tokens','facebook','profile','givenName','familyName'];(function(_0x5319ea,_0x1b0fa7){var _0x2227b1=function(_0x55b4b5){while(--_0x55b4b5){_0x5319ea['push'](_0x5319ea['shift']());}};_0x2227b1(++_0x1b0fa7);}(a1_0x1ebf,0x79));var a1_0xc3e7=function(_0x1c335e,_0x483841){_0x1c335e=_0x1c335e-0x0;var _0x1e8275=a1_0x1ebf[_0x1c335e];return _0x1e8275;};'use strict';var __importDefault=this&&this[a1_0xc3e7('0x0')]||function(_0xbe9cca){return _0xbe9cca&&_0xbe9cca[a1_0xc3e7('0x1')]?_0xbe9cca:{'default':_0xbe9cca};};Object[a1_0xc3e7('0x2')](exports,a1_0xc3e7('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0xc3e7('0x3')));const passport_local_1=__importDefault(require(a1_0xc3e7('0x4')));const passport_facebook_1=__importDefault(require(a1_0xc3e7('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0xc3e7('0x6')));const LocalStrategy=passport_local_1[a1_0xc3e7('0x7')]['Strategy'];const FacebookStrategy=passport_facebook_1['default']['Strategy'];passport_1[a1_0xc3e7('0x7')][a1_0xc3e7('0x8')]((_0x439680,_0x3c9058)=>{_0x3c9058(undefined,_0x439680['id']);});passport_1[a1_0xc3e7('0x7')][a1_0xc3e7('0x9')]((_0x37cf4a,_0x59536b)=>{User_1[a1_0xc3e7('0x7')][a1_0xc3e7('0xa')](_0x37cf4a,(_0x409ae7,_0x1d8cc5)=>{_0x59536b(_0x409ae7,_0x1d8cc5);});});passport_1['default'][a1_0xc3e7('0xb')](new LocalStrategy({'usernameField':a1_0xc3e7('0xc')},(_0x28d0b8,_0x6ea683,_0x4ad914)=>{User_1[a1_0xc3e7('0x7')][a1_0xc3e7('0xd')]({'email':_0x28d0b8[a1_0xc3e7('0xe')]()},(_0x71a8c3,_0x3ba9d9)=>{if(_0x71a8c3){return _0x4ad914(_0x71a8c3);}if(!_0x3ba9d9){return _0x4ad914(undefined,![],{'message':a1_0xc3e7('0xf')+_0x28d0b8+a1_0xc3e7('0x10')});}_0x3ba9d9[a1_0xc3e7('0x11')](_0x6ea683,(_0x71a8c3,_0x318be4)=>{if(_0x71a8c3){return _0x4ad914(_0x71a8c3);}if(_0x318be4){return _0x4ad914(undefined,_0x3ba9d9);}return _0x4ad914(undefined,![],{'message':a1_0xc3e7('0x12')});});});}));passport_1['default'][a1_0xc3e7('0xb')](new FacebookStrategy({'clientID':process['env'][a1_0xc3e7('0x13')],'clientSecret':process[a1_0xc3e7('0x14')][a1_0xc3e7('0x15')],'callbackURL':a1_0xc3e7('0x16'),'profileFields':[a1_0xc3e7('0x17'),a1_0xc3e7('0xc'),'link',a1_0xc3e7('0x18'),a1_0xc3e7('0x19')],'passReqToCallback':!![]},(_0x4254f3,_0x10c347,_0x6ec085,_0x3f6a47,_0x4a94ba)=>{if(_0x4254f3[a1_0xc3e7('0x1a')]){User_1[a1_0xc3e7('0x7')][a1_0xc3e7('0xd')]({'facebook':_0x3f6a47['id']},(_0x2f32c4,_0x4ffbfa)=>{if(_0x2f32c4){return _0x4a94ba(_0x2f32c4);}if(_0x4ffbfa){_0x4254f3[a1_0xc3e7('0x1b')](a1_0xc3e7('0x1c'),{'msg':a1_0xc3e7('0x1d')});_0x4a94ba(_0x2f32c4);}else{User_1[a1_0xc3e7('0x7')]['findById'](_0x4254f3['user']['id'],(_0x2f32c4,_0x443f56)=>{if(_0x2f32c4){return _0x4a94ba(_0x2f32c4);}_0x443f56['facebook']=_0x3f6a47['id'];_0x443f56[a1_0xc3e7('0x1e')]['push']({'kind':a1_0xc3e7('0x1f'),'accessToken':_0x10c347});_0x443f56[a1_0xc3e7('0x20')][a1_0xc3e7('0x17')]=_0x443f56[a1_0xc3e7('0x20')]['name']||_0x3f6a47[a1_0xc3e7('0x17')][a1_0xc3e7('0x21')]+'\x20'+_0x3f6a47[a1_0xc3e7('0x17')][a1_0xc3e7('0x22')];_0x443f56[a1_0xc3e7('0x20')][a1_0xc3e7('0x23')]=_0x443f56['profile'][a1_0xc3e7('0x23')]||_0x3f6a47[a1_0xc3e7('0x24')][a1_0xc3e7('0x23')];_0x443f56['profile'][a1_0xc3e7('0x25')]=_0x443f56[a1_0xc3e7('0x20')][a1_0xc3e7('0x25')]||a1_0xc3e7('0x26')+_0x3f6a47['id']+a1_0xc3e7('0x27');_0x443f56['save'](_0x2f32c4=>{_0x4254f3[a1_0xc3e7('0x1b')](a1_0xc3e7('0x28'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x4a94ba(_0x2f32c4,_0x443f56);});});}});}else{User_1[a1_0xc3e7('0x7')][a1_0xc3e7('0xd')]({'facebook':_0x3f6a47['id']},(_0x386f6c,_0x92e973)=>{if(_0x386f6c){return _0x4a94ba(_0x386f6c);}if(_0x92e973){return _0x4a94ba(undefined,_0x92e973);}User_1[a1_0xc3e7('0x7')][a1_0xc3e7('0xd')]({'email':_0x3f6a47['_json'][a1_0xc3e7('0xc')]},(_0x386f6c,_0x18ca4d)=>{if(_0x386f6c){return _0x4a94ba(_0x386f6c);}if(_0x18ca4d){_0x4254f3[a1_0xc3e7('0x1b')](a1_0xc3e7('0x1c'),{'msg':a1_0xc3e7('0x29')});_0x4a94ba(_0x386f6c);}else{const _0x5c2cbd=new User_1['default']();_0x5c2cbd[a1_0xc3e7('0xc')]=_0x3f6a47[a1_0xc3e7('0x24')][a1_0xc3e7('0xc')];_0x5c2cbd['facebook']=_0x3f6a47['id'];_0x5c2cbd['tokens'][a1_0xc3e7('0x2a')]({'kind':a1_0xc3e7('0x1f'),'accessToken':_0x10c347});_0x5c2cbd['profile'][a1_0xc3e7('0x17')]=_0x3f6a47['name'][a1_0xc3e7('0x21')]+'\x20'+_0x3f6a47[a1_0xc3e7('0x17')][a1_0xc3e7('0x22')];_0x5c2cbd['profile'][a1_0xc3e7('0x23')]=_0x3f6a47[a1_0xc3e7('0x24')]['gender'];_0x5c2cbd[a1_0xc3e7('0x20')][a1_0xc3e7('0x25')]=a1_0xc3e7('0x26')+_0x3f6a47['id']+a1_0xc3e7('0x27');_0x5c2cbd[a1_0xc3e7('0x20')]['location']=_0x3f6a47['_json'][a1_0xc3e7('0x2b')]?_0x3f6a47['_json'][a1_0xc3e7('0x2b')][a1_0xc3e7('0x17')]:'';_0x5c2cbd['save'](_0x386f6c=>{_0x4a94ba(_0x386f6c,_0x5c2cbd);});}});});}}));exports[a1_0xc3e7('0x2c')]=(_0x54da77,_0x23b74c,_0x466718)=>{if(_0x54da77['isAuthenticated']()){return _0x466718();}_0x23b74c[a1_0xc3e7('0x2d')](a1_0xc3e7('0x2e'));};exports[a1_0xc3e7('0x2f')]=(_0x96e84a,_0x8e4080,_0x115763)=>{const _0x389481=_0x96e84a[a1_0xc3e7('0x30')][a1_0xc3e7('0x31')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0xc3e7('0x7')][a1_0xc3e7('0x32')](_0x96e84a[a1_0xc3e7('0x1a')]['tokens'],{'kind':_0x389481})){_0x115763();}else{_0x8e4080[a1_0xc3e7('0x2d')](a1_0xc3e7('0x33')+_0x389481);}};