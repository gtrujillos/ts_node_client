var a1_0x2989=['There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','facebook','tokens','push','profile','givenName','familyName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','flash','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','location','isAuthenticated','/login','find','/auth/','__importDefault','defineProperty','__esModule','passport','passport-local','passport-facebook','../models/User','default','Strategy','deserializeUser','use','email','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','FACEBOOK_ID','env','/auth/facebook/callback','name','link','locale','timezone','user','findOne','errors'];(function(_0x53c281,_0x563f09){var _0x2a793d=function(_0x36a11e){while(--_0x36a11e){_0x53c281['push'](_0x53c281['shift']());}};_0x2a793d(++_0x563f09);}(a1_0x2989,0x166));var a1_0x434c=function(_0x3d20ec,_0x1a592d){_0x3d20ec=_0x3d20ec-0x0;var _0x5027ff=a1_0x2989[_0x3d20ec];return _0x5027ff;};'use strict';var __importDefault=this&&this[a1_0x434c('0x0')]||function(_0x28fe16){return _0x28fe16&&_0x28fe16['__esModule']?_0x28fe16:{'default':_0x28fe16};};Object[a1_0x434c('0x1')](exports,a1_0x434c('0x2'),{'value':!![]});const passport_1=__importDefault(require(a1_0x434c('0x3')));const passport_local_1=__importDefault(require(a1_0x434c('0x4')));const passport_facebook_1=__importDefault(require(a1_0x434c('0x5')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x434c('0x6')));const LocalStrategy=passport_local_1[a1_0x434c('0x7')][a1_0x434c('0x8')];const FacebookStrategy=passport_facebook_1[a1_0x434c('0x7')][a1_0x434c('0x8')];passport_1[a1_0x434c('0x7')]['serializeUser']((_0x4f9767,_0x263ffb)=>{_0x263ffb(undefined,_0x4f9767['id']);});passport_1[a1_0x434c('0x7')][a1_0x434c('0x9')]((_0x2198bb,_0x45a9e3)=>{User_1['default']['findById'](_0x2198bb,(_0x2c50e9,_0x49b763)=>{_0x45a9e3(_0x2c50e9,_0x49b763);});});passport_1[a1_0x434c('0x7')][a1_0x434c('0xa')](new LocalStrategy({'usernameField':a1_0x434c('0xb')},(_0x1aaa26,_0x2758b0,_0x55c12c)=>{User_1[a1_0x434c('0x7')]['findOne']({'email':_0x1aaa26[a1_0x434c('0xc')]()},(_0x3a963e,_0x3ce6bd)=>{if(_0x3a963e){return _0x55c12c(_0x3a963e);}if(!_0x3ce6bd){return _0x55c12c(undefined,![],{'message':a1_0x434c('0xd')+_0x1aaa26+a1_0x434c('0xe')});}_0x3ce6bd['comparePassword'](_0x2758b0,(_0x3a963e,_0x347320)=>{if(_0x3a963e){return _0x55c12c(_0x3a963e);}if(_0x347320){return _0x55c12c(undefined,_0x3ce6bd);}return _0x55c12c(undefined,![],{'message':a1_0x434c('0xf')});});});}));passport_1[a1_0x434c('0x7')][a1_0x434c('0xa')](new FacebookStrategy({'clientID':process['env'][a1_0x434c('0x10')],'clientSecret':process[a1_0x434c('0x11')]['FACEBOOK_SECRET'],'callbackURL':a1_0x434c('0x12'),'profileFields':[a1_0x434c('0x13'),'email',a1_0x434c('0x14'),a1_0x434c('0x15'),a1_0x434c('0x16')],'passReqToCallback':!![]},(_0x3dcbf2,_0x13247d,_0x575106,_0x3d9963,_0x3933ea)=>{if(_0x3dcbf2[a1_0x434c('0x17')]){User_1[a1_0x434c('0x7')][a1_0x434c('0x18')]({'facebook':_0x3d9963['id']},(_0x51aab1,_0x699234)=>{if(_0x51aab1){return _0x3933ea(_0x51aab1);}if(_0x699234){_0x3dcbf2['flash'](a1_0x434c('0x19'),{'msg':a1_0x434c('0x1a')});_0x3933ea(_0x51aab1);}else{User_1[a1_0x434c('0x7')]['findById'](_0x3dcbf2['user']['id'],(_0x51aab1,_0x26ec07)=>{if(_0x51aab1){return _0x3933ea(_0x51aab1);}_0x26ec07[a1_0x434c('0x1b')]=_0x3d9963['id'];_0x26ec07[a1_0x434c('0x1c')][a1_0x434c('0x1d')]({'kind':'facebook','accessToken':_0x13247d});_0x26ec07[a1_0x434c('0x1e')][a1_0x434c('0x13')]=_0x26ec07[a1_0x434c('0x1e')]['name']||_0x3d9963[a1_0x434c('0x13')][a1_0x434c('0x1f')]+'\x20'+_0x3d9963[a1_0x434c('0x13')][a1_0x434c('0x20')];_0x26ec07[a1_0x434c('0x1e')][a1_0x434c('0x21')]=_0x26ec07['profile'][a1_0x434c('0x21')]||_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0x21')];_0x26ec07[a1_0x434c('0x1e')][a1_0x434c('0x23')]=_0x26ec07['profile'][a1_0x434c('0x23')]||a1_0x434c('0x24')+_0x3d9963['id']+a1_0x434c('0x25');_0x26ec07[a1_0x434c('0x26')](_0x51aab1=>{_0x3dcbf2[a1_0x434c('0x27')](a1_0x434c('0x28'),{'msg':a1_0x434c('0x29')});_0x3933ea(_0x51aab1,_0x26ec07);});});}});}else{User_1[a1_0x434c('0x7')][a1_0x434c('0x18')]({'facebook':_0x3d9963['id']},(_0x3597e6,_0x505ecb)=>{if(_0x3597e6){return _0x3933ea(_0x3597e6);}if(_0x505ecb){return _0x3933ea(undefined,_0x505ecb);}User_1[a1_0x434c('0x7')][a1_0x434c('0x18')]({'email':_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0xb')]},(_0x3597e6,_0x370e21)=>{if(_0x3597e6){return _0x3933ea(_0x3597e6);}if(_0x370e21){_0x3dcbf2['flash']('errors',{'msg':a1_0x434c('0x2a')});_0x3933ea(_0x3597e6);}else{const _0x10449f=new User_1[(a1_0x434c('0x7'))]();_0x10449f[a1_0x434c('0xb')]=_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0xb')];_0x10449f[a1_0x434c('0x1b')]=_0x3d9963['id'];_0x10449f[a1_0x434c('0x1c')][a1_0x434c('0x1d')]({'kind':a1_0x434c('0x1b'),'accessToken':_0x13247d});_0x10449f[a1_0x434c('0x1e')]['name']=_0x3d9963[a1_0x434c('0x13')][a1_0x434c('0x1f')]+'\x20'+_0x3d9963[a1_0x434c('0x13')][a1_0x434c('0x20')];_0x10449f[a1_0x434c('0x1e')][a1_0x434c('0x21')]=_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0x21')];_0x10449f[a1_0x434c('0x1e')]['picture']='https://graph.facebook.com/'+_0x3d9963['id']+'/picture?type=large';_0x10449f[a1_0x434c('0x1e')][a1_0x434c('0x2b')]=_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0x2b')]?_0x3d9963[a1_0x434c('0x22')][a1_0x434c('0x2b')][a1_0x434c('0x13')]:'';_0x10449f['save'](_0x3597e6=>{_0x3933ea(_0x3597e6,_0x10449f);});}});});}}));exports[a1_0x434c('0x2c')]=(_0x56182a,_0x31c37d,_0x180167)=>{if(_0x56182a['isAuthenticated']()){return _0x180167();}_0x31c37d['redirect'](a1_0x434c('0x2d'));};exports['isAuthorized']=(_0x25f9b4,_0x2819fc,_0x514eb8)=>{const _0xfa15f7=_0x25f9b4['path']['split']('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x434c('0x7')][a1_0x434c('0x2e')](_0x25f9b4[a1_0x434c('0x17')][a1_0x434c('0x1c')],{'kind':_0xfa15f7})){_0x514eb8();}else{_0x2819fc['redirect'](a1_0x434c('0x2f')+_0xfa15f7);}};