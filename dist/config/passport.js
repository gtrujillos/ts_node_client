var a1_0x2afa=['isAuthenticated','redirect','/login','slice','/auth/','__importDefault','__esModule','defineProperty','passport','passport-facebook','../models/User','Strategy','default','serializeUser','deserializeUser','findById','use','email','findOne','Email\x20','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','env','FACEBOOK_SECRET','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','facebook','tokens','push','profile','givenName','familyName','gender','picture','https://graph.facebook.com/','/picture?type=large','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','_json','location'];(function(_0x4fa8ca,_0x23830a){var _0x35fc6e=function(_0x3994fe){while(--_0x3994fe){_0x4fa8ca['push'](_0x4fa8ca['shift']());}};_0x35fc6e(++_0x23830a);}(a1_0x2afa,0x65));var a1_0x4a97=function(_0x10bb95,_0x1e7160){_0x10bb95=_0x10bb95-0x0;var _0x25ce11=a1_0x2afa[_0x10bb95];return _0x25ce11;};'use strict';var __importDefault=this&&this[a1_0x4a97('0x0')]||function(_0x284abf){return _0x284abf&&_0x284abf[a1_0x4a97('0x1')]?_0x284abf:{'default':_0x284abf};};Object[a1_0x4a97('0x2')](exports,'__esModule',{'value':!![]});const passport_1=__importDefault(require(a1_0x4a97('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x4a97('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4a97('0x5')));const LocalStrategy=passport_local_1['default'][a1_0x4a97('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x4a97('0x7')][a1_0x4a97('0x6')];passport_1['default'][a1_0x4a97('0x8')]((_0x167d72,_0x16d762)=>{_0x16d762(undefined,_0x167d72['id']);});passport_1[a1_0x4a97('0x7')][a1_0x4a97('0x9')]((_0x50178b,_0x2d6906)=>{User_1[a1_0x4a97('0x7')][a1_0x4a97('0xa')](_0x50178b,(_0x56fc74,_0x5b8b3b)=>{_0x2d6906(_0x56fc74,_0x5b8b3b);});});passport_1[a1_0x4a97('0x7')][a1_0x4a97('0xb')](new LocalStrategy({'usernameField':a1_0x4a97('0xc')},(_0xc186cf,_0x5a487c,_0x4eaa8d)=>{User_1[a1_0x4a97('0x7')][a1_0x4a97('0xd')]({'email':_0xc186cf['toLowerCase']()},(_0x3f4e90,_0x1cf0ab)=>{if(_0x3f4e90){return _0x4eaa8d(_0x3f4e90);}if(!_0x1cf0ab){return _0x4eaa8d(undefined,![],{'message':a1_0x4a97('0xe')+_0xc186cf+a1_0x4a97('0xf')});}_0x1cf0ab[a1_0x4a97('0x10')](_0x5a487c,(_0x3f4e90,_0x2dec20)=>{if(_0x3f4e90){return _0x4eaa8d(_0x3f4e90);}if(_0x2dec20){return _0x4eaa8d(undefined,_0x1cf0ab);}return _0x4eaa8d(undefined,![],{'message':a1_0x4a97('0x11')});});});}));passport_1[a1_0x4a97('0x7')][a1_0x4a97('0xb')](new FacebookStrategy({'clientID':process['env']['FACEBOOK_ID'],'clientSecret':process[a1_0x4a97('0x12')][a1_0x4a97('0x13')],'callbackURL':a1_0x4a97('0x14'),'profileFields':[a1_0x4a97('0x15'),a1_0x4a97('0xc'),a1_0x4a97('0x16'),a1_0x4a97('0x17'),a1_0x4a97('0x18')],'passReqToCallback':!![]},(_0x7e624a,_0x37de4e,_0x29f36a,_0xc3290f,_0x9c98a1)=>{if(_0x7e624a[a1_0x4a97('0x19')]){User_1[a1_0x4a97('0x7')]['findOne']({'facebook':_0xc3290f['id']},(_0x4a5953,_0x1197a3)=>{if(_0x4a5953){return _0x9c98a1(_0x4a5953);}if(_0x1197a3){_0x7e624a[a1_0x4a97('0x1a')](a1_0x4a97('0x1b'),{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x9c98a1(_0x4a5953);}else{User_1[a1_0x4a97('0x7')]['findById'](_0x7e624a[a1_0x4a97('0x19')]['id'],(_0x4a5953,_0x49f42b)=>{if(_0x4a5953){return _0x9c98a1(_0x4a5953);}_0x49f42b[a1_0x4a97('0x1c')]=_0xc3290f['id'];_0x49f42b[a1_0x4a97('0x1d')][a1_0x4a97('0x1e')]({'kind':a1_0x4a97('0x1c'),'accessToken':_0x37de4e});_0x49f42b[a1_0x4a97('0x1f')][a1_0x4a97('0x15')]=_0x49f42b['profile'][a1_0x4a97('0x15')]||_0xc3290f[a1_0x4a97('0x15')][a1_0x4a97('0x20')]+'\x20'+_0xc3290f[a1_0x4a97('0x15')][a1_0x4a97('0x21')];_0x49f42b['profile'][a1_0x4a97('0x22')]=_0x49f42b[a1_0x4a97('0x1f')]['gender']||_0xc3290f['_json'][a1_0x4a97('0x22')];_0x49f42b[a1_0x4a97('0x1f')][a1_0x4a97('0x23')]=_0x49f42b[a1_0x4a97('0x1f')][a1_0x4a97('0x23')]||a1_0x4a97('0x24')+_0xc3290f['id']+a1_0x4a97('0x25');_0x49f42b[a1_0x4a97('0x26')](_0x4a5953=>{_0x7e624a['flash'](a1_0x4a97('0x27'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x9c98a1(_0x4a5953,_0x49f42b);});});}});}else{User_1[a1_0x4a97('0x7')][a1_0x4a97('0xd')]({'facebook':_0xc3290f['id']},(_0x2845d9,_0x540aed)=>{if(_0x2845d9){return _0x9c98a1(_0x2845d9);}if(_0x540aed){return _0x9c98a1(undefined,_0x540aed);}User_1[a1_0x4a97('0x7')][a1_0x4a97('0xd')]({'email':_0xc3290f['_json'][a1_0x4a97('0xc')]},(_0x2845d9,_0x54ff06)=>{if(_0x2845d9){return _0x9c98a1(_0x2845d9);}if(_0x54ff06){_0x7e624a['flash'](a1_0x4a97('0x1b'),{'msg':a1_0x4a97('0x28')});_0x9c98a1(_0x2845d9);}else{const _0x4b8109=new User_1[(a1_0x4a97('0x7'))]();_0x4b8109[a1_0x4a97('0xc')]=_0xc3290f[a1_0x4a97('0x29')][a1_0x4a97('0xc')];_0x4b8109[a1_0x4a97('0x1c')]=_0xc3290f['id'];_0x4b8109[a1_0x4a97('0x1d')][a1_0x4a97('0x1e')]({'kind':'facebook','accessToken':_0x37de4e});_0x4b8109[a1_0x4a97('0x1f')]['name']=_0xc3290f[a1_0x4a97('0x15')][a1_0x4a97('0x20')]+'\x20'+_0xc3290f[a1_0x4a97('0x15')][a1_0x4a97('0x21')];_0x4b8109[a1_0x4a97('0x1f')][a1_0x4a97('0x22')]=_0xc3290f[a1_0x4a97('0x29')][a1_0x4a97('0x22')];_0x4b8109[a1_0x4a97('0x1f')][a1_0x4a97('0x23')]='https://graph.facebook.com/'+_0xc3290f['id']+a1_0x4a97('0x25');_0x4b8109[a1_0x4a97('0x1f')][a1_0x4a97('0x2a')]=_0xc3290f[a1_0x4a97('0x29')][a1_0x4a97('0x2a')]?_0xc3290f[a1_0x4a97('0x29')][a1_0x4a97('0x2a')][a1_0x4a97('0x15')]:'';_0x4b8109[a1_0x4a97('0x26')](_0x2845d9=>{_0x9c98a1(_0x2845d9,_0x4b8109);});}});});}}));exports['isAuthenticated']=(_0x19954d,_0x4de4e1,_0x1f0d0e)=>{if(_0x19954d[a1_0x4a97('0x2b')]()){return _0x1f0d0e();}_0x4de4e1[a1_0x4a97('0x2c')](a1_0x4a97('0x2d'));};exports['isAuthorized']=(_0x6a1daa,_0x303c37,_0x50a3ff)=>{const _0x4076d3=_0x6a1daa['path']['split']('/')[a1_0x4a97('0x2e')](-0x1)[0x0];if(lodash_1['default']['find'](_0x6a1daa['user'][a1_0x4a97('0x1d')],{'kind':_0x4076d3})){_0x50a3ff();}else{_0x303c37[a1_0x4a97('0x2c')](a1_0x4a97('0x2f')+_0x4076d3);}};