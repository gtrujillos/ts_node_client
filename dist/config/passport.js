var a1_0x2792=['serializeUser','findById','use','email','toLowerCase','Email\x20','\x20not\x20found.','Invalid\x20email\x20or\x20password.','env','FACEBOOK_ID','/auth/facebook/callback','locale','timezone','user','findOne','flash','facebook','push','profile','name','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','tokens','familyName','location','isAuthenticated','redirect','/login','isAuthorized','split','slice','/auth/','__importDefault','defineProperty','__esModule','passport-local','passport-facebook','../models/User','default','Strategy'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a1_0x2792,0x141));var a1_0xda8d=function(_0x16be82,_0x3ce5d1){_0x16be82=_0x16be82-0x0;var _0x18361d=a1_0x2792[_0x16be82];return _0x18361d;};'use strict';var __importDefault=this&&this[a1_0xda8d('0x0')]||function(_0x3cd1b5){return _0x3cd1b5&&_0x3cd1b5['__esModule']?_0x3cd1b5:{'default':_0x3cd1b5};};Object[a1_0xda8d('0x1')](exports,a1_0xda8d('0x2'),{'value':!![]});const passport_1=__importDefault(require('passport'));const passport_local_1=__importDefault(require(a1_0xda8d('0x3')));const passport_facebook_1=__importDefault(require(a1_0xda8d('0x4')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0xda8d('0x5')));const LocalStrategy=passport_local_1[a1_0xda8d('0x6')][a1_0xda8d('0x7')];const FacebookStrategy=passport_facebook_1[a1_0xda8d('0x6')][a1_0xda8d('0x7')];passport_1[a1_0xda8d('0x6')][a1_0xda8d('0x8')]((_0x577685,_0x2a871e)=>{_0x2a871e(undefined,_0x577685['id']);});passport_1[a1_0xda8d('0x6')]['deserializeUser']((_0x2e3130,_0x5d562f)=>{User_1[a1_0xda8d('0x6')][a1_0xda8d('0x9')](_0x2e3130,(_0x2defb6,_0x2d3021)=>{_0x5d562f(_0x2defb6,_0x2d3021);});});passport_1[a1_0xda8d('0x6')][a1_0xda8d('0xa')](new LocalStrategy({'usernameField':a1_0xda8d('0xb')},(_0x360877,_0x2299c5,_0x3d2346)=>{User_1['default']['findOne']({'email':_0x360877[a1_0xda8d('0xc')]()},(_0x3ba93d,_0x55ea01)=>{if(_0x3ba93d){return _0x3d2346(_0x3ba93d);}if(!_0x55ea01){return _0x3d2346(undefined,![],{'message':a1_0xda8d('0xd')+_0x360877+a1_0xda8d('0xe')});}_0x55ea01['comparePassword'](_0x2299c5,(_0x3ba93d,_0xc6e1f)=>{if(_0x3ba93d){return _0x3d2346(_0x3ba93d);}if(_0xc6e1f){return _0x3d2346(undefined,_0x55ea01);}return _0x3d2346(undefined,![],{'message':a1_0xda8d('0xf')});});});}));passport_1[a1_0xda8d('0x6')][a1_0xda8d('0xa')](new FacebookStrategy({'clientID':process[a1_0xda8d('0x10')][a1_0xda8d('0x11')],'clientSecret':process[a1_0xda8d('0x10')]['FACEBOOK_SECRET'],'callbackURL':a1_0xda8d('0x12'),'profileFields':['name','email','link',a1_0xda8d('0x13'),a1_0xda8d('0x14')],'passReqToCallback':!![]},(_0x46ba76,_0x2be1f0,_0x39848f,_0x3fcc5a,_0x40cc9c)=>{if(_0x46ba76[a1_0xda8d('0x15')]){User_1[a1_0xda8d('0x6')][a1_0xda8d('0x16')]({'facebook':_0x3fcc5a['id']},(_0x573ea7,_0x4295d3)=>{if(_0x573ea7){return _0x40cc9c(_0x573ea7);}if(_0x4295d3){_0x46ba76[a1_0xda8d('0x17')]('errors',{'msg':'There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.'});_0x40cc9c(_0x573ea7);}else{User_1[a1_0xda8d('0x6')][a1_0xda8d('0x9')](_0x46ba76[a1_0xda8d('0x15')]['id'],(_0x573ea7,_0x3fc18e)=>{if(_0x573ea7){return _0x40cc9c(_0x573ea7);}_0x3fc18e[a1_0xda8d('0x18')]=_0x3fcc5a['id'];_0x3fc18e['tokens'][a1_0xda8d('0x19')]({'kind':a1_0xda8d('0x18'),'accessToken':_0x2be1f0});_0x3fc18e[a1_0xda8d('0x1a')][a1_0xda8d('0x1b')]=_0x3fc18e[a1_0xda8d('0x1a')]['name']||_0x3fcc5a['name'][a1_0xda8d('0x1c')]+'\x20'+_0x3fcc5a[a1_0xda8d('0x1b')]['familyName'];_0x3fc18e[a1_0xda8d('0x1a')][a1_0xda8d('0x1d')]=_0x3fc18e[a1_0xda8d('0x1a')]['gender']||_0x3fcc5a[a1_0xda8d('0x1e')][a1_0xda8d('0x1d')];_0x3fc18e[a1_0xda8d('0x1a')]['picture']=_0x3fc18e[a1_0xda8d('0x1a')][a1_0xda8d('0x1f')]||a1_0xda8d('0x20')+_0x3fcc5a['id']+a1_0xda8d('0x21');_0x3fc18e[a1_0xda8d('0x22')](_0x573ea7=>{_0x46ba76[a1_0xda8d('0x17')](a1_0xda8d('0x23'),{'msg':'Facebook\x20account\x20has\x20been\x20linked.'});_0x40cc9c(_0x573ea7,_0x3fc18e);});});}});}else{User_1[a1_0xda8d('0x6')][a1_0xda8d('0x16')]({'facebook':_0x3fcc5a['id']},(_0x36afdd,_0x4d73f2)=>{if(_0x36afdd){return _0x40cc9c(_0x36afdd);}if(_0x4d73f2){return _0x40cc9c(undefined,_0x4d73f2);}User_1['default'][a1_0xda8d('0x16')]({'email':_0x3fcc5a[a1_0xda8d('0x1e')][a1_0xda8d('0xb')]},(_0x36afdd,_0x50a087)=>{if(_0x36afdd){return _0x40cc9c(_0x36afdd);}if(_0x50a087){_0x46ba76[a1_0xda8d('0x17')]('errors',{'msg':a1_0xda8d('0x24')});_0x40cc9c(_0x36afdd);}else{const _0x233276=new User_1['default']();_0x233276[a1_0xda8d('0xb')]=_0x3fcc5a[a1_0xda8d('0x1e')][a1_0xda8d('0xb')];_0x233276[a1_0xda8d('0x18')]=_0x3fcc5a['id'];_0x233276[a1_0xda8d('0x25')][a1_0xda8d('0x19')]({'kind':'facebook','accessToken':_0x2be1f0});_0x233276['profile'][a1_0xda8d('0x1b')]=_0x3fcc5a[a1_0xda8d('0x1b')][a1_0xda8d('0x1c')]+'\x20'+_0x3fcc5a[a1_0xda8d('0x1b')][a1_0xda8d('0x26')];_0x233276[a1_0xda8d('0x1a')][a1_0xda8d('0x1d')]=_0x3fcc5a[a1_0xda8d('0x1e')][a1_0xda8d('0x1d')];_0x233276['profile'][a1_0xda8d('0x1f')]=a1_0xda8d('0x20')+_0x3fcc5a['id']+a1_0xda8d('0x21');_0x233276[a1_0xda8d('0x1a')]['location']=_0x3fcc5a['_json']['location']?_0x3fcc5a['_json'][a1_0xda8d('0x27')][a1_0xda8d('0x1b')]:'';_0x233276[a1_0xda8d('0x22')](_0x36afdd=>{_0x40cc9c(_0x36afdd,_0x233276);});}});});}}));exports[a1_0xda8d('0x28')]=(_0x2e5fb9,_0x1a55c6,_0x45bd44)=>{if(_0x2e5fb9['isAuthenticated']()){return _0x45bd44();}_0x1a55c6[a1_0xda8d('0x29')](a1_0xda8d('0x2a'));};exports[a1_0xda8d('0x2b')]=(_0x3e103c,_0x3fff6c,_0x2b54f3)=>{const _0x2ce393=_0x3e103c['path'][a1_0xda8d('0x2c')]('/')[a1_0xda8d('0x2d')](-0x1)[0x0];if(lodash_1['default']['find'](_0x3e103c[a1_0xda8d('0x15')][a1_0xda8d('0x25')],{'kind':_0x2ce393})){_0x2b54f3();}else{_0x3fff6c['redirect'](a1_0xda8d('0x2e')+_0x2ce393);}};