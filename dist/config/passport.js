var a1_0x2f7a=['familyName','gender','_json','picture','save','flash','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.','/picture?type=large','location','isAuthenticated','redirect','/login','path','split','slice','__esModule','passport','passport-facebook','../models/User','default','Strategy','serializeUser','deserializeUser','findById','email','toLowerCase','\x20not\x20found.','comparePassword','Invalid\x20email\x20or\x20password.','use','FACEBOOK_ID','env','FACEBOOK_SECRET','name','locale','timezone','findOne','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','user','facebook','tokens','push','profile','givenName'];(function(_0x129e64,_0x5dfe45){var _0x19a433=function(_0x3ec5ef){while(--_0x3ec5ef){_0x129e64['push'](_0x129e64['shift']());}};_0x19a433(++_0x5dfe45);}(a1_0x2f7a,0x1dc));var a1_0x3e8b=function(_0x47a121,_0x52ea9f){_0x47a121=_0x47a121-0x0;var _0x3fef56=a1_0x2f7a[_0x47a121];return _0x3fef56;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x32dfa1){return _0x32dfa1&&_0x32dfa1[a1_0x3e8b('0x0')]?_0x32dfa1:{'default':_0x32dfa1};};Object['defineProperty'](exports,a1_0x3e8b('0x0'),{'value':!![]});const passport_1=__importDefault(require(a1_0x3e8b('0x1')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require(a1_0x3e8b('0x2')));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x3e8b('0x3')));const LocalStrategy=passport_local_1[a1_0x3e8b('0x4')][a1_0x3e8b('0x5')];const FacebookStrategy=passport_facebook_1['default']['Strategy'];passport_1[a1_0x3e8b('0x4')][a1_0x3e8b('0x6')]((_0x2dcc83,_0x57aa07)=>{_0x57aa07(undefined,_0x2dcc83['id']);});passport_1[a1_0x3e8b('0x4')][a1_0x3e8b('0x7')]((_0x404018,_0x1de414)=>{User_1['default'][a1_0x3e8b('0x8')](_0x404018,(_0x3741c6,_0x27417e)=>{_0x1de414(_0x3741c6,_0x27417e);});});passport_1['default']['use'](new LocalStrategy({'usernameField':a1_0x3e8b('0x9')},(_0x4fb366,_0xf3b49a,_0x478a0f)=>{User_1[a1_0x3e8b('0x4')]['findOne']({'email':_0x4fb366[a1_0x3e8b('0xa')]()},(_0xd40114,_0x37d9ca)=>{if(_0xd40114){return _0x478a0f(_0xd40114);}if(!_0x37d9ca){return _0x478a0f(undefined,![],{'message':'Email\x20'+_0x4fb366+a1_0x3e8b('0xb')});}_0x37d9ca[a1_0x3e8b('0xc')](_0xf3b49a,(_0xd40114,_0x8b4a4f)=>{if(_0xd40114){return _0x478a0f(_0xd40114);}if(_0x8b4a4f){return _0x478a0f(undefined,_0x37d9ca);}return _0x478a0f(undefined,![],{'message':a1_0x3e8b('0xd')});});});}));passport_1['default'][a1_0x3e8b('0xe')](new FacebookStrategy({'clientID':process['env'][a1_0x3e8b('0xf')],'clientSecret':process[a1_0x3e8b('0x10')][a1_0x3e8b('0x11')],'callbackURL':'/auth/facebook/callback','profileFields':[a1_0x3e8b('0x12'),'email','link',a1_0x3e8b('0x13'),a1_0x3e8b('0x14')],'passReqToCallback':!![]},(_0x3304ba,_0x5814f8,_0x477e3b,_0x29309b,_0x4e018e)=>{if(_0x3304ba['user']){User_1[a1_0x3e8b('0x4')][a1_0x3e8b('0x15')]({'facebook':_0x29309b['id']},(_0x52b3ea,_0x405f78)=>{if(_0x52b3ea){return _0x4e018e(_0x52b3ea);}if(_0x405f78){_0x3304ba['flash'](a1_0x3e8b('0x16'),{'msg':a1_0x3e8b('0x17')});_0x4e018e(_0x52b3ea);}else{User_1[a1_0x3e8b('0x4')]['findById'](_0x3304ba[a1_0x3e8b('0x18')]['id'],(_0x52b3ea,_0x4892bd)=>{if(_0x52b3ea){return _0x4e018e(_0x52b3ea);}_0x4892bd[a1_0x3e8b('0x19')]=_0x29309b['id'];_0x4892bd[a1_0x3e8b('0x1a')][a1_0x3e8b('0x1b')]({'kind':'facebook','accessToken':_0x5814f8});_0x4892bd[a1_0x3e8b('0x1c')][a1_0x3e8b('0x12')]=_0x4892bd['profile'][a1_0x3e8b('0x12')]||_0x29309b[a1_0x3e8b('0x12')][a1_0x3e8b('0x1d')]+'\x20'+_0x29309b[a1_0x3e8b('0x12')][a1_0x3e8b('0x1e')];_0x4892bd['profile'][a1_0x3e8b('0x1f')]=_0x4892bd[a1_0x3e8b('0x1c')][a1_0x3e8b('0x1f')]||_0x29309b[a1_0x3e8b('0x20')]['gender'];_0x4892bd[a1_0x3e8b('0x1c')][a1_0x3e8b('0x21')]=_0x4892bd['profile']['picture']||'https://graph.facebook.com/'+_0x29309b['id']+'/picture?type=large';_0x4892bd[a1_0x3e8b('0x22')](_0x52b3ea=>{_0x3304ba[a1_0x3e8b('0x23')]('info',{'msg':a1_0x3e8b('0x24')});_0x4e018e(_0x52b3ea,_0x4892bd);});});}});}else{User_1[a1_0x3e8b('0x4')][a1_0x3e8b('0x15')]({'facebook':_0x29309b['id']},(_0x37be7e,_0x8aeb12)=>{if(_0x37be7e){return _0x4e018e(_0x37be7e);}if(_0x8aeb12){return _0x4e018e(undefined,_0x8aeb12);}User_1[a1_0x3e8b('0x4')]['findOne']({'email':_0x29309b['_json'][a1_0x3e8b('0x9')]},(_0x37be7e,_0x513182)=>{if(_0x37be7e){return _0x4e018e(_0x37be7e);}if(_0x513182){_0x3304ba[a1_0x3e8b('0x23')]('errors',{'msg':a1_0x3e8b('0x25')});_0x4e018e(_0x37be7e);}else{const _0x16bb83=new User_1[(a1_0x3e8b('0x4'))]();_0x16bb83[a1_0x3e8b('0x9')]=_0x29309b[a1_0x3e8b('0x20')][a1_0x3e8b('0x9')];_0x16bb83[a1_0x3e8b('0x19')]=_0x29309b['id'];_0x16bb83[a1_0x3e8b('0x1a')][a1_0x3e8b('0x1b')]({'kind':a1_0x3e8b('0x19'),'accessToken':_0x5814f8});_0x16bb83[a1_0x3e8b('0x1c')][a1_0x3e8b('0x12')]=_0x29309b[a1_0x3e8b('0x12')][a1_0x3e8b('0x1d')]+'\x20'+_0x29309b[a1_0x3e8b('0x12')][a1_0x3e8b('0x1e')];_0x16bb83[a1_0x3e8b('0x1c')][a1_0x3e8b('0x1f')]=_0x29309b[a1_0x3e8b('0x20')][a1_0x3e8b('0x1f')];_0x16bb83[a1_0x3e8b('0x1c')]['picture']='https://graph.facebook.com/'+_0x29309b['id']+a1_0x3e8b('0x26');_0x16bb83['profile']['location']=_0x29309b[a1_0x3e8b('0x20')][a1_0x3e8b('0x27')]?_0x29309b[a1_0x3e8b('0x20')][a1_0x3e8b('0x27')][a1_0x3e8b('0x12')]:'';_0x16bb83[a1_0x3e8b('0x22')](_0x37be7e=>{_0x4e018e(_0x37be7e,_0x16bb83);});}});});}}));exports[a1_0x3e8b('0x28')]=(_0x578e29,_0xe9f93a,_0x3f6a65)=>{if(_0x578e29[a1_0x3e8b('0x28')]()){return _0x3f6a65();}_0xe9f93a[a1_0x3e8b('0x29')](a1_0x3e8b('0x2a'));};exports['isAuthorized']=(_0x3453e3,_0x3683dc,_0x4b1e3e)=>{const _0x4512a9=_0x3453e3[a1_0x3e8b('0x2b')][a1_0x3e8b('0x2c')]('/')[a1_0x3e8b('0x2d')](-0x1)[0x0];if(lodash_1[a1_0x3e8b('0x4')]['find'](_0x3453e3['user'][a1_0x3e8b('0x1a')],{'kind':_0x4512a9})){_0x4b1e3e();}else{_0x3683dc[a1_0x3e8b('0x29')]('/auth/'+_0x4512a9);}};