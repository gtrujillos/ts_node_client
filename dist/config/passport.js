var a1_0x5b11=['tokens','location','isAuthenticated','redirect','/login','path','split','/auth/','__importDefault','__esModule','defineProperty','passport','../models/User','default','Strategy','serializeUser','deserializeUser','findById','email','findOne','toLowerCase','\x20not\x20found.','Invalid\x20email\x20or\x20password.','use','env','FACEBOOK_ID','/auth/facebook/callback','name','link','locale','timezone','user','flash','errors','There\x20is\x20already\x20a\x20Facebook\x20account\x20that\x20belongs\x20to\x20you.\x20Sign\x20in\x20with\x20that\x20account\x20or\x20delete\x20it,\x20then\x20link\x20it\x20with\x20your\x20current\x20account.','push','facebook','profile','givenName','gender','_json','picture','https://graph.facebook.com/','/picture?type=large','save','info','Facebook\x20account\x20has\x20been\x20linked.','There\x20is\x20already\x20an\x20account\x20using\x20this\x20email\x20address.\x20Sign\x20in\x20to\x20that\x20account\x20and\x20link\x20it\x20with\x20Facebook\x20manually\x20from\x20Account\x20Settings.'];(function(_0x4b8884,_0x2a2bac){var _0x93ddb7=function(_0x4ddf9c){while(--_0x4ddf9c){_0x4b8884['push'](_0x4b8884['shift']());}};_0x93ddb7(++_0x2a2bac);}(a1_0x5b11,0xf8));var a1_0x4f81=function(_0x3aeed3,_0x3650c3){_0x3aeed3=_0x3aeed3-0x0;var _0x259d43=a1_0x5b11[_0x3aeed3];return _0x259d43;};'use strict';var __importDefault=this&&this[a1_0x4f81('0x0')]||function(_0x449dc0){return _0x449dc0&&_0x449dc0[a1_0x4f81('0x1')]?_0x449dc0:{'default':_0x449dc0};};Object[a1_0x4f81('0x2')](exports,a1_0x4f81('0x1'),{'value':!![]});const passport_1=__importDefault(require(a1_0x4f81('0x3')));const passport_local_1=__importDefault(require('passport-local'));const passport_facebook_1=__importDefault(require('passport-facebook'));const lodash_1=__importDefault(require('lodash'));const User_1=__importDefault(require(a1_0x4f81('0x4')));const LocalStrategy=passport_local_1[a1_0x4f81('0x5')][a1_0x4f81('0x6')];const FacebookStrategy=passport_facebook_1[a1_0x4f81('0x5')][a1_0x4f81('0x6')];passport_1['default'][a1_0x4f81('0x7')]((_0x1af69b,_0x5ed231)=>{_0x5ed231(undefined,_0x1af69b['id']);});passport_1[a1_0x4f81('0x5')][a1_0x4f81('0x8')]((_0x231abc,_0x599a77)=>{User_1[a1_0x4f81('0x5')][a1_0x4f81('0x9')](_0x231abc,(_0x4f607a,_0x3f7289)=>{_0x599a77(_0x4f607a,_0x3f7289);});});passport_1[a1_0x4f81('0x5')]['use'](new LocalStrategy({'usernameField':a1_0x4f81('0xa')},(_0xa6fcc0,_0x21c430,_0x383406)=>{User_1[a1_0x4f81('0x5')][a1_0x4f81('0xb')]({'email':_0xa6fcc0[a1_0x4f81('0xc')]()},(_0x1af15,_0x47cfc5)=>{if(_0x1af15){return _0x383406(_0x1af15);}if(!_0x47cfc5){return _0x383406(undefined,![],{'message':'Email\x20'+_0xa6fcc0+a1_0x4f81('0xd')});}_0x47cfc5['comparePassword'](_0x21c430,(_0x1af15,_0x428aca)=>{if(_0x1af15){return _0x383406(_0x1af15);}if(_0x428aca){return _0x383406(undefined,_0x47cfc5);}return _0x383406(undefined,![],{'message':a1_0x4f81('0xe')});});});}));passport_1['default'][a1_0x4f81('0xf')](new FacebookStrategy({'clientID':process[a1_0x4f81('0x10')][a1_0x4f81('0x11')],'clientSecret':process[a1_0x4f81('0x10')]['FACEBOOK_SECRET'],'callbackURL':a1_0x4f81('0x12'),'profileFields':[a1_0x4f81('0x13'),a1_0x4f81('0xa'),a1_0x4f81('0x14'),a1_0x4f81('0x15'),a1_0x4f81('0x16')],'passReqToCallback':!![]},(_0x4d62ea,_0x476123,_0x528817,_0x2766d1,_0x2077b1)=>{if(_0x4d62ea[a1_0x4f81('0x17')]){User_1[a1_0x4f81('0x5')][a1_0x4f81('0xb')]({'facebook':_0x2766d1['id']},(_0x1b88b8,_0xee5f9f)=>{if(_0x1b88b8){return _0x2077b1(_0x1b88b8);}if(_0xee5f9f){_0x4d62ea[a1_0x4f81('0x18')](a1_0x4f81('0x19'),{'msg':a1_0x4f81('0x1a')});_0x2077b1(_0x1b88b8);}else{User_1[a1_0x4f81('0x5')][a1_0x4f81('0x9')](_0x4d62ea[a1_0x4f81('0x17')]['id'],(_0x1b88b8,_0x2fa1c4)=>{if(_0x1b88b8){return _0x2077b1(_0x1b88b8);}_0x2fa1c4['facebook']=_0x2766d1['id'];_0x2fa1c4['tokens'][a1_0x4f81('0x1b')]({'kind':a1_0x4f81('0x1c'),'accessToken':_0x476123});_0x2fa1c4[a1_0x4f81('0x1d')]['name']=_0x2fa1c4[a1_0x4f81('0x1d')][a1_0x4f81('0x13')]||_0x2766d1[a1_0x4f81('0x13')][a1_0x4f81('0x1e')]+'\x20'+_0x2766d1[a1_0x4f81('0x13')]['familyName'];_0x2fa1c4[a1_0x4f81('0x1d')][a1_0x4f81('0x1f')]=_0x2fa1c4[a1_0x4f81('0x1d')]['gender']||_0x2766d1[a1_0x4f81('0x20')][a1_0x4f81('0x1f')];_0x2fa1c4[a1_0x4f81('0x1d')][a1_0x4f81('0x21')]=_0x2fa1c4[a1_0x4f81('0x1d')]['picture']||a1_0x4f81('0x22')+_0x2766d1['id']+a1_0x4f81('0x23');_0x2fa1c4[a1_0x4f81('0x24')](_0x1b88b8=>{_0x4d62ea[a1_0x4f81('0x18')](a1_0x4f81('0x25'),{'msg':a1_0x4f81('0x26')});_0x2077b1(_0x1b88b8,_0x2fa1c4);});});}});}else{User_1[a1_0x4f81('0x5')][a1_0x4f81('0xb')]({'facebook':_0x2766d1['id']},(_0x49da5a,_0x35a5af)=>{if(_0x49da5a){return _0x2077b1(_0x49da5a);}if(_0x35a5af){return _0x2077b1(undefined,_0x35a5af);}User_1[a1_0x4f81('0x5')][a1_0x4f81('0xb')]({'email':_0x2766d1['_json'][a1_0x4f81('0xa')]},(_0x49da5a,_0x59a428)=>{if(_0x49da5a){return _0x2077b1(_0x49da5a);}if(_0x59a428){_0x4d62ea[a1_0x4f81('0x18')](a1_0x4f81('0x19'),{'msg':a1_0x4f81('0x27')});_0x2077b1(_0x49da5a);}else{const _0x2bacee=new User_1['default']();_0x2bacee[a1_0x4f81('0xa')]=_0x2766d1[a1_0x4f81('0x20')][a1_0x4f81('0xa')];_0x2bacee['facebook']=_0x2766d1['id'];_0x2bacee[a1_0x4f81('0x28')]['push']({'kind':a1_0x4f81('0x1c'),'accessToken':_0x476123});_0x2bacee[a1_0x4f81('0x1d')][a1_0x4f81('0x13')]=_0x2766d1[a1_0x4f81('0x13')][a1_0x4f81('0x1e')]+'\x20'+_0x2766d1[a1_0x4f81('0x13')]['familyName'];_0x2bacee['profile'][a1_0x4f81('0x1f')]=_0x2766d1[a1_0x4f81('0x20')][a1_0x4f81('0x1f')];_0x2bacee[a1_0x4f81('0x1d')]['picture']=a1_0x4f81('0x22')+_0x2766d1['id']+a1_0x4f81('0x23');_0x2bacee['profile'][a1_0x4f81('0x29')]=_0x2766d1['_json'][a1_0x4f81('0x29')]?_0x2766d1[a1_0x4f81('0x20')][a1_0x4f81('0x29')][a1_0x4f81('0x13')]:'';_0x2bacee['save'](_0x49da5a=>{_0x2077b1(_0x49da5a,_0x2bacee);});}});});}}));exports[a1_0x4f81('0x2a')]=(_0x49cfe8,_0x35bc21,_0x5eb55d)=>{if(_0x49cfe8[a1_0x4f81('0x2a')]()){return _0x5eb55d();}_0x35bc21[a1_0x4f81('0x2b')](a1_0x4f81('0x2c'));};exports['isAuthorized']=(_0x39b740,_0x5d2f47,_0x1cab5d)=>{const _0x111a03=_0x39b740[a1_0x4f81('0x2d')][a1_0x4f81('0x2e')]('/')['slice'](-0x1)[0x0];if(lodash_1[a1_0x4f81('0x5')]['find'](_0x39b740[a1_0x4f81('0x17')]['tokens'],{'kind':_0x111a03})){_0x1cab5d();}else{_0x5d2f47[a1_0x4f81('0x2b')](a1_0x4f81('0x2f')+_0x111a03);}};