var a2_0xecd3=['query','pass_counting','amount','total','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','startDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','col','gte','HOUR','DAY','MONTH','ASC','user','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','log','connecting','default','ready','connected','colombia','Downloading:\x20','name','json','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','models','report_files','findOne','then','connected:','fileName','get','colombia/','end','media/','createWriteStream','status','save','processFtp','.txt','readFile','utf8','parse','CountingInfo','Out','EndTime','create','findAll','countingDate','getPassCountingByDay','month'];(function(_0x3328d6,_0xd76ff1){var _0x37c3f9=function(_0x264db3){while(--_0x264db3){_0x3328d6['push'](_0x3328d6['shift']());}};_0x37c3f9(++_0xd76ff1);}(a2_0xecd3,0x1e0));var a2_0x50fe=function(_0x4ee7d9,_0x11b52d){_0x4ee7d9=_0x4ee7d9-0x0;var _0x25d58c=a2_0xecd3[_0x4ee7d9];return _0x25d58c;};'use strict';var __importDefault=this&&this[a2_0x50fe('0x0')]||function(_0x3cba91){return _0x3cba91&&_0x3cba91[a2_0x50fe('0x1')]?_0x3cba91:{'default':_0x3cba91};};Object['defineProperty'](exports,a2_0x50fe('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x50fe('0x2')));const ftp_1=__importDefault(require(a2_0x50fe('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x50fe('0x4')]='';function setSequelize(_0x24f9f1){exports['sequelize']=_0x24f9f1;}exports[a2_0x50fe('0x5')]=setSequelize;exports[a2_0x50fe('0x6')]=(_0x30965f,_0x5295eb)=>{_0x5295eb[a2_0x50fe('0x7')](a2_0x50fe('0x8'),{'title':a2_0x50fe('0x9')});};exports['syncFtp']=(_0x27630f,_0x49b7c0)=>{console[a2_0x50fe('0xa')](a2_0x50fe('0xb'));const _0x2ea85e=[];const _0x129757=new ftp_1[(a2_0x50fe('0xc'))]();_0x129757['on'](a2_0x50fe('0xd'),function(){console[a2_0x50fe('0xa')](a2_0x50fe('0xe'));_0x129757['list'](a2_0x50fe('0xf'),![],function(_0x5cb5c9,_0x445079){if(_0x5cb5c9){}else{for(const _0x2182a3 of _0x445079){console['log'](a2_0x50fe('0x10')+_0x2182a3[a2_0x50fe('0x11')]);if(_0x2182a3[a2_0x50fe('0x11')]['endsWith'](a2_0x50fe('0x12'))){exports[a2_0x50fe('0x4')]['models']['report_files'][a2_0x50fe('0x13')]({'where':{'fileName':_0x2182a3[a2_0x50fe('0x11')]}})[a2_0x50fe('0x14')]((_0x320115,_0x54a9b6)=>{if(_0x54a9b6){console[a2_0x50fe('0xa')](_0x2182a3[a2_0x50fe('0x11')]);_0x2ea85e[a2_0x50fe('0x15')](_0x320115);}});}}}_0x49b7c0[a2_0x50fe('0x12')]({'data':_0x2ea85e});});});_0x129757['on'](a2_0x50fe('0x16'),function(_0x1c2853){_0x49b7c0[a2_0x50fe('0x12')]({'message':_0x1c2853});});_0x129757[a2_0x50fe('0x17')]({'host':a2_0x50fe('0x18'),'port':0x15,'user':a2_0x50fe('0x19'),'password':'ipd'});};exports['downloadFtp']=(_0x3b8680,_0x1c1f08)=>{exports['sequelize'][a2_0x50fe('0x1a')][a2_0x50fe('0x1b')][a2_0x50fe('0x1c')]({'where':{'status':null}})[a2_0x50fe('0x1d')](_0x32d9f5=>{if(_0x32d9f5){const _0x61427a=new ftp_1[(a2_0x50fe('0xc'))]();_0x61427a['on'](a2_0x50fe('0xd'),function(){console[a2_0x50fe('0xa')](a2_0x50fe('0x1e')+_0x32d9f5[a2_0x50fe('0x1f')]);_0x61427a[a2_0x50fe('0x20')](a2_0x50fe('0x21')+_0x32d9f5[a2_0x50fe('0x1f')],function(_0x5aeb90,_0x830b36){_0x61427a[a2_0x50fe('0x22')]();if(_0x5aeb90){}else{const _0x4a8adf=a2_0x50fe('0x23')+_0x32d9f5[a2_0x50fe('0x1f')]+'.txt';_0x830b36['pipe'](fs_1['default'][a2_0x50fe('0x24')](_0x4a8adf));_0x32d9f5[a2_0x50fe('0x25')]=0x1;_0x32d9f5[a2_0x50fe('0x26')]();console[a2_0x50fe('0xa')]('Downloaded:\x20'+_0x32d9f5['fileName']);}});});_0x61427a['on'](a2_0x50fe('0x16'),function(_0x1be65f){_0x1c1f08[a2_0x50fe('0x12')]({'message':_0x1be65f});});_0x61427a[a2_0x50fe('0x17')]({'host':a2_0x50fe('0x18'),'port':0x15,'user':a2_0x50fe('0x19'),'password':a2_0x50fe('0x19')});_0x1c1f08[a2_0x50fe('0x12')]({'data':_0x32d9f5[a2_0x50fe('0x1f')]});}else{_0x1c1f08[a2_0x50fe('0x12')]({'data':[]});}});};exports[a2_0x50fe('0x27')]=(_0x3510cc,_0x18c10f)=>{exports['sequelize'][a2_0x50fe('0x1a')][a2_0x50fe('0x1b')][a2_0x50fe('0x1c')]({'where':{'status':0x1}})[a2_0x50fe('0x1d')](_0x20b1d5=>{if(_0x20b1d5){const _0x3030e0=a2_0x50fe('0x23')+_0x20b1d5[a2_0x50fe('0x1f')]+a2_0x50fe('0x28');fs_1[a2_0x50fe('0xc')][a2_0x50fe('0x29')](_0x3030e0,a2_0x50fe('0x2a'),function(_0x18f002,_0x355f66){if(_0x18f002){_0x20b1d5[a2_0x50fe('0x25')]=null;}else{try{const _0x26902c=JSON[a2_0x50fe('0x2b')](_0x355f66);for(const _0x93790b of _0x26902c['Data'][0x0][a2_0x50fe('0x2c')]){const _0x579a7d=_0x93790b['In'];const _0x3ac306=_0x93790b[a2_0x50fe('0x2d')];const _0x1a0358=Date['parse'](_0x93790b[a2_0x50fe('0x2e')]);if(_0x579a7d>0x0){exports['sequelize']['models']['pass_counting']['create']({'reportFileId':_0x20b1d5['id'],'amount':_0x579a7d,'countingDate':_0x1a0358});}if(_0x3ac306>0x0){exports[a2_0x50fe('0x4')][a2_0x50fe('0x1a')]['pass_counting'][a2_0x50fe('0x2f')]({'reportFileId':_0x20b1d5['id'],'amount':_0x3ac306*-0x1,'countingDate':_0x1a0358});}}_0x20b1d5[a2_0x50fe('0x25')]=0x2;}catch(_0x146fbc){_0x20b1d5['status']=null;}}_0x20b1d5[a2_0x50fe('0x26')]();});_0x18c10f[a2_0x50fe('0x12')]({'data':_0x20b1d5[a2_0x50fe('0x1f')]});}else{_0x18c10f[a2_0x50fe('0x12')]({'data':[]});}});};exports['getPassCounting']=(_0x38bc4f,_0x236766)=>{exports[a2_0x50fe('0x4')][a2_0x50fe('0x1a')]['pass_counting'][a2_0x50fe('0x30')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x50fe('0x31'),'ASC']]})[a2_0x50fe('0x1d')](_0x34b867=>{_0x236766['json']({'data':_0x34b867});});};exports[a2_0x50fe('0x32')]=(_0x2faa98,_0x2988e4)=>{const _0x22c7c3=_0x2faa98['query'][a2_0x50fe('0x33')];const _0x3e2867=_0x2faa98[a2_0x50fe('0x34')]['startDate'];const _0x4f48ed=_0x2faa98['query']['endDate'];exports['sequelize'][a2_0x50fe('0x1a')][a2_0x50fe('0x35')][a2_0x50fe('0x30')]({'attributes':['countingDate',[exports['sequelize']['fn']('sum',exports[a2_0x50fe('0x4')]['col'](a2_0x50fe('0x36'))),a2_0x50fe('0x37')]],'where':{'countingDate':{[exports[a2_0x50fe('0x4')]['Op']['gte']]:_0x3e2867,[exports['sequelize']['Op']['lt']]:_0x4f48ed},'amount':_0x2faa98[a2_0x50fe('0x38')]['direction']=='in'?{[exports[a2_0x50fe('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x50fe('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x50fe('0x39')](a2_0x50fe('0x3a'))],'order':[[a2_0x50fe('0x31'),'ASC']]})[a2_0x50fe('0x1d')](_0x153db8=>{_0x2988e4['json']({'data':_0x153db8});});};exports[a2_0x50fe('0x3b')]=(_0x2456a4,_0x4dedfe)=>{const _0x14f8e7=_0x2456a4[a2_0x50fe('0x34')][a2_0x50fe('0x33')];const _0x52d040=_0x2456a4['query'][a2_0x50fe('0x3c')];const _0x53d262=_0x2456a4[a2_0x50fe('0x34')]['endDate'];exports[a2_0x50fe('0x4')]['models'][a2_0x50fe('0x35')][a2_0x50fe('0x30')]({'attributes':[a2_0x50fe('0x31'),[exports[a2_0x50fe('0x4')]['fn'](a2_0x50fe('0x3d'),exports[a2_0x50fe('0x4')]['col'](a2_0x50fe('0x31')),a2_0x50fe('0x3e')),a2_0x50fe('0x3f')],[exports['sequelize']['fn'](a2_0x50fe('0x40'),exports[a2_0x50fe('0x4')][a2_0x50fe('0x41')]('amount')),a2_0x50fe('0x37')]],'where':{'countingDate':{[exports[a2_0x50fe('0x4')]['Op'][a2_0x50fe('0x42')]]:_0x52d040,[exports[a2_0x50fe('0x4')]['Op']['lt']]:_0x53d262},'amount':_0x2456a4['params']['direction']=='in'?{[exports[a2_0x50fe('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x50fe('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x50fe('0x43'),exports[a2_0x50fe('0x4')]['col'](a2_0x50fe('0x31'))),exports[a2_0x50fe('0x4')]['fn'](a2_0x50fe('0x44'),exports[a2_0x50fe('0x4')]['col'](a2_0x50fe('0x31'))),exports[a2_0x50fe('0x4')]['fn'](a2_0x50fe('0x45'),exports['sequelize']['col'](a2_0x50fe('0x31'))),exports[a2_0x50fe('0x4')]['fn']('YEAR',exports[a2_0x50fe('0x4')][a2_0x50fe('0x41')](a2_0x50fe('0x31')))],'order':[['countingDate',a2_0x50fe('0x46')]]})[a2_0x50fe('0x1d')](_0xc1c234=>{_0x4dedfe[a2_0x50fe('0x12')]({'data':_0xc1c234});});};exports['getFacebook']=(_0x3ca83c,_0xa21ac4,_0x5562b0)=>{const _0x395983=_0x3ca83c[a2_0x50fe('0x47')]['tokens']['find'](_0x395983=>_0x395983['kind']==='facebook');fbgraph_1[a2_0x50fe('0xc')][a2_0x50fe('0x48')](_0x395983['accessToken']);fbgraph_1[a2_0x50fe('0xc')][a2_0x50fe('0x20')](_0x3ca83c[a2_0x50fe('0x47')]['facebook']+a2_0x50fe('0x49'),(_0x2e1fb8,_0x401036)=>{if(_0x2e1fb8){return _0x5562b0(_0x2e1fb8);}_0xa21ac4[a2_0x50fe('0x7')](a2_0x50fe('0x4a'),{'title':a2_0x50fe('0x4b'),'profile':_0x401036});});};