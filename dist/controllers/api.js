var a2_0x3c85=['status','save','Downloaded:\x20','error','connect','processFtp','report_files','readFile','utf8','parse','Data','Out','EndTime','pass_counting','create','getPassCounting','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','findAll','sum','col','amount','total','gte','literal','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','HOUR','MONTH','YEAR','getFacebook','user','find','kind','facebook','setAccessToken','accessToken','get','render','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','Downloading:\x20','name','endsWith','models','push','json','ftp.vivotek.com','ipd','downloadFtp','findOne','then','colombia/','fileName','end','media/','.txt','pipe','createWriteStream'];(function(_0x1bedd3,_0x119bb3){var _0x23f794=function(_0x4b44fb){while(--_0x4b44fb){_0x1bedd3['push'](_0x1bedd3['shift']());}};_0x23f794(++_0x119bb3);}(a2_0x3c85,0x7e));var a2_0x1547=function(_0x4d3f9d,_0x358fa5){_0x4d3f9d=_0x4d3f9d-0x0;var _0x4c720d=a2_0x3c85[_0x4d3f9d];return _0x4c720d;};'use strict';var __importDefault=this&&this[a2_0x1547('0x0')]||function(_0x4a536e){return _0x4a536e&&_0x4a536e[a2_0x1547('0x1')]?_0x4a536e:{'default':_0x4a536e};};Object[a2_0x1547('0x2')](exports,a2_0x1547('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1547('0x3')));const ftp_1=__importDefault(require(a2_0x1547('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x1547('0x5')]='';function setSequelize(_0x39d790){exports[a2_0x1547('0x5')]=_0x39d790;}exports[a2_0x1547('0x6')]=setSequelize;exports[a2_0x1547('0x7')]=(_0x584862,_0x432725)=>{_0x432725['render']('api/index',{'title':a2_0x1547('0x8')});};exports[a2_0x1547('0x9')]=(_0x32ec6b,_0x3afe14)=>{console[a2_0x1547('0xa')](a2_0x1547('0xb'));const _0x776036=[];const _0x1decd2=new ftp_1[(a2_0x1547('0xc'))]();_0x1decd2['on'](a2_0x1547('0xd'),function(){console[a2_0x1547('0xa')](a2_0x1547('0xe'));_0x1decd2[a2_0x1547('0xf')]('colombia',![],function(_0x134810,_0x501cb1){if(_0x134810){}else{for(const _0x1f9510 of _0x501cb1){console[a2_0x1547('0xa')](a2_0x1547('0x10')+_0x1f9510[a2_0x1547('0x11')]);if(_0x1f9510['name'][a2_0x1547('0x12')]('json')){exports['sequelize'][a2_0x1547('0x13')]['report_files']['findOrCreate']({'where':{'fileName':_0x1f9510[a2_0x1547('0x11')]}})['spread']((_0x182cec,_0x2bb7ed)=>{if(_0x2bb7ed){console[a2_0x1547('0xa')](_0x1f9510[a2_0x1547('0x11')]);_0x776036[a2_0x1547('0x14')](_0x182cec);}});}}}_0x3afe14['json']({'data':_0x776036});});});_0x1decd2['on']('error',function(_0x2b4e1c){_0x3afe14[a2_0x1547('0x15')]({'message':_0x2b4e1c});});_0x1decd2['connect']({'host':a2_0x1547('0x16'),'port':0x15,'user':a2_0x1547('0x17'),'password':a2_0x1547('0x17')});};exports[a2_0x1547('0x18')]=(_0x181816,_0x472eb9)=>{exports[a2_0x1547('0x5')]['models']['report_files'][a2_0x1547('0x19')]({'where':{'status':null}})[a2_0x1547('0x1a')](_0x39c7aa=>{if(_0x39c7aa){const _0x14abf7=new ftp_1[(a2_0x1547('0xc'))]();_0x14abf7['on']('ready',function(){console[a2_0x1547('0xa')]('connected:'+_0x39c7aa['fileName']);_0x14abf7['get'](a2_0x1547('0x1b')+_0x39c7aa[a2_0x1547('0x1c')],function(_0x358d46,_0x2ab57c){_0x14abf7[a2_0x1547('0x1d')]();if(_0x358d46){}else{const _0x5b2518=a2_0x1547('0x1e')+_0x39c7aa['fileName']+a2_0x1547('0x1f');_0x2ab57c[a2_0x1547('0x20')](fs_1[a2_0x1547('0xc')][a2_0x1547('0x21')](_0x5b2518));_0x39c7aa[a2_0x1547('0x22')]=0x1;_0x39c7aa[a2_0x1547('0x23')]();console['log'](a2_0x1547('0x24')+_0x39c7aa[a2_0x1547('0x1c')]);}});});_0x14abf7['on'](a2_0x1547('0x25'),function(_0x2079fc){_0x472eb9[a2_0x1547('0x15')]({'message':_0x2079fc});});_0x14abf7[a2_0x1547('0x26')]({'host':a2_0x1547('0x16'),'port':0x15,'user':a2_0x1547('0x17'),'password':a2_0x1547('0x17')});_0x472eb9[a2_0x1547('0x15')]({'data':_0x39c7aa[a2_0x1547('0x1c')]});}else{_0x472eb9[a2_0x1547('0x15')]({'data':[]});}});};exports[a2_0x1547('0x27')]=(_0x407741,_0x729d8f)=>{exports[a2_0x1547('0x5')][a2_0x1547('0x13')][a2_0x1547('0x28')][a2_0x1547('0x19')]({'where':{'status':0x1}})[a2_0x1547('0x1a')](_0x6a9757=>{if(_0x6a9757){const _0x471027=a2_0x1547('0x1e')+_0x6a9757['fileName']+a2_0x1547('0x1f');fs_1[a2_0x1547('0xc')][a2_0x1547('0x29')](_0x471027,a2_0x1547('0x2a'),function(_0x38825a,_0x6a276d){if(_0x38825a){_0x6a9757[a2_0x1547('0x22')]=null;}else{try{const _0x31d57a=JSON[a2_0x1547('0x2b')](_0x6a276d);for(const _0x273b63 of _0x31d57a[a2_0x1547('0x2c')][0x0]['CountingInfo']){const _0x4c1587=_0x273b63['In'];const _0xf429ae=_0x273b63[a2_0x1547('0x2d')];const _0x2cb2dc=Date[a2_0x1547('0x2b')](_0x273b63[a2_0x1547('0x2e')]);if(_0x4c1587>0x0){exports['sequelize']['models'][a2_0x1547('0x2f')][a2_0x1547('0x30')]({'reportFileId':_0x6a9757['id'],'amount':_0x4c1587,'countingDate':_0x2cb2dc});}if(_0xf429ae>0x0){exports['sequelize'][a2_0x1547('0x13')][a2_0x1547('0x2f')][a2_0x1547('0x30')]({'reportFileId':_0x6a9757['id'],'amount':_0xf429ae*-0x1,'countingDate':_0x2cb2dc});}}_0x6a9757[a2_0x1547('0x22')]=0x2;}catch(_0x27e058){_0x6a9757['status']=null;}}_0x6a9757[a2_0x1547('0x23')]();});_0x729d8f[a2_0x1547('0x15')]({'data':_0x6a9757[a2_0x1547('0x1c')]});}else{_0x729d8f[a2_0x1547('0x15')]({'data':[]});}});};exports[a2_0x1547('0x31')]=(_0x4e4518,_0x252d54)=>{exports[a2_0x1547('0x5')][a2_0x1547('0x13')][a2_0x1547('0x2f')]['findAll']({'where':{'amount':{[exports[a2_0x1547('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x1547('0x32'),a2_0x1547('0x33')]]})[a2_0x1547('0x1a')](_0x3e309a=>{_0x252d54[a2_0x1547('0x15')]({'data':_0x3e309a});});};exports[a2_0x1547('0x34')]=(_0x2af9d1,_0x272a6e)=>{const _0x462d69=_0x2af9d1[a2_0x1547('0x35')]['month'];const _0x37f4c0=_0x2af9d1[a2_0x1547('0x35')][a2_0x1547('0x36')];const _0x57523f=_0x2af9d1[a2_0x1547('0x35')][a2_0x1547('0x37')];exports[a2_0x1547('0x5')]['models'][a2_0x1547('0x2f')][a2_0x1547('0x38')]({'attributes':[a2_0x1547('0x32'),[exports['sequelize']['fn'](a2_0x1547('0x39'),exports[a2_0x1547('0x5')][a2_0x1547('0x3a')](a2_0x1547('0x3b'))),a2_0x1547('0x3c')]],'where':{'countingDate':{[exports[a2_0x1547('0x5')]['Op'][a2_0x1547('0x3d')]]:_0x37f4c0,[exports[a2_0x1547('0x5')]['Op']['lt']]:_0x57523f},'amount':_0x2af9d1['params']['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x1547('0x5')][a2_0x1547('0x3e')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x1547('0x32'),a2_0x1547('0x33')]]})['then'](_0x1a7ea9=>{_0x272a6e[a2_0x1547('0x15')]({'data':_0x1a7ea9});});};exports[a2_0x1547('0x3f')]=(_0x2ee6b9,_0x21ae10)=>{const _0x7c390d=_0x2ee6b9[a2_0x1547('0x35')][a2_0x1547('0x40')];const _0xf5bdc5=_0x2ee6b9[a2_0x1547('0x35')]['startDate'];const _0x78aef3=_0x2ee6b9[a2_0x1547('0x35')][a2_0x1547('0x37')];exports['sequelize'][a2_0x1547('0x13')][a2_0x1547('0x2f')][a2_0x1547('0x38')]({'attributes':[a2_0x1547('0x32'),[exports['sequelize']['fn'](a2_0x1547('0x41'),exports['sequelize'][a2_0x1547('0x3a')](a2_0x1547('0x32')),a2_0x1547('0x42')),a2_0x1547('0x43')],[exports['sequelize']['fn']('sum',exports[a2_0x1547('0x5')][a2_0x1547('0x3a')](a2_0x1547('0x3b'))),'total']],'where':{'countingDate':{[exports[a2_0x1547('0x5')]['Op']['gte']]:_0xf5bdc5,[exports['sequelize']['Op']['lt']]:_0x78aef3},'amount':_0x2ee6b9['params']['direction']=='in'?{[exports[a2_0x1547('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x1547('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x1547('0x44'),exports[a2_0x1547('0x5')]['col'](a2_0x1547('0x32'))),exports[a2_0x1547('0x5')]['fn']('DAY',exports[a2_0x1547('0x5')]['col']('countingDate')),exports[a2_0x1547('0x5')]['fn'](a2_0x1547('0x45'),exports[a2_0x1547('0x5')]['col']('countingDate')),exports[a2_0x1547('0x5')]['fn'](a2_0x1547('0x46'),exports[a2_0x1547('0x5')][a2_0x1547('0x3a')](a2_0x1547('0x32')))],'order':[[a2_0x1547('0x32'),a2_0x1547('0x33')]]})[a2_0x1547('0x1a')](_0x4bc7eb=>{_0x21ae10[a2_0x1547('0x15')]({'data':_0x4bc7eb});});};exports[a2_0x1547('0x47')]=(_0x2927a3,_0x31c300,_0x22ed82)=>{const _0x3cc286=_0x2927a3[a2_0x1547('0x48')]['tokens'][a2_0x1547('0x49')](_0x3cc286=>_0x3cc286[a2_0x1547('0x4a')]===a2_0x1547('0x4b'));fbgraph_1[a2_0x1547('0xc')][a2_0x1547('0x4c')](_0x3cc286[a2_0x1547('0x4d')]);fbgraph_1[a2_0x1547('0xc')][a2_0x1547('0x4e')](_0x2927a3['user']['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x1e1876,_0xfdacc7)=>{if(_0x1e1876){return _0x22ed82(_0x1e1876);}_0x31c300[a2_0x1547('0x4f')]('api/facebook',{'title':'Facebook\x20API','profile':_0xfdacc7});});};