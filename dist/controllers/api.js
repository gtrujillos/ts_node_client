var a2_0x3e55=['end','media/','.txt','pipe','createWriteStream','status','save','processFtp','then','readFile','parse','Data','CountingInfo','Out','EndTime','pass_counting','create','findAll','countingDate','ASC','query','month','startDate','endDate','col','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','sum','params','HOUR','MONTH','YEAR','user','tokens','find','kind','facebook','accessToken','get','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','report_files','findOrCreate','spread','push','json','error','connect','ftp.vivotek.com','ipd','downloadFtp','models','findOne','fileName'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a2_0x3e55,0x127));var a2_0x4c07=function(_0x5398f5,_0x1ff037){_0x5398f5=_0x5398f5-0x0;var _0x395cd8=a2_0x3e55[_0x5398f5];return _0x395cd8;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4afaaf){return _0x4afaaf&&_0x4afaaf['__esModule']?_0x4afaaf:{'default':_0x4afaaf};};Object[a2_0x4c07('0x0')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x4c07('0x1')));const ftp_1=__importDefault(require(a2_0x4c07('0x2')));const fs_1=__importDefault(require('fs'));exports[a2_0x4c07('0x3')]='';function setSequelize(_0xee3267){exports[a2_0x4c07('0x3')]=_0xee3267;}exports[a2_0x4c07('0x4')]=setSequelize;exports[a2_0x4c07('0x5')]=(_0xd27b11,_0x538af3)=>{_0x538af3[a2_0x4c07('0x6')](a2_0x4c07('0x7'),{'title':a2_0x4c07('0x8')});};exports[a2_0x4c07('0x9')]=(_0x29ccea,_0x58f636)=>{console[a2_0x4c07('0xa')](a2_0x4c07('0xb'));const _0x5b9ca9=[];const _0x18902a=new ftp_1[(a2_0x4c07('0xc'))]();_0x18902a['on'](a2_0x4c07('0xd'),function(){console[a2_0x4c07('0xa')](a2_0x4c07('0xe'));_0x18902a[a2_0x4c07('0xf')](a2_0x4c07('0x10'),![],function(_0x4db87f,_0x3db11c){if(_0x4db87f){}else{for(const _0x52563e of _0x3db11c){console[a2_0x4c07('0xa')](a2_0x4c07('0x11')+_0x52563e['name']);if(_0x52563e[a2_0x4c07('0x12')][a2_0x4c07('0x13')]('json')){exports[a2_0x4c07('0x3')]['models'][a2_0x4c07('0x14')][a2_0x4c07('0x15')]({'where':{'fileName':_0x52563e[a2_0x4c07('0x12')]}})[a2_0x4c07('0x16')]((_0x2777c6,_0x3dfa9f)=>{if(_0x3dfa9f){console[a2_0x4c07('0xa')](_0x52563e[a2_0x4c07('0x12')]);_0x5b9ca9[a2_0x4c07('0x17')](_0x2777c6);}});}}}_0x58f636[a2_0x4c07('0x18')]({'data':_0x5b9ca9});});});_0x18902a['on'](a2_0x4c07('0x19'),function(_0x28638b){_0x58f636['json']({'message':_0x28638b});});_0x18902a[a2_0x4c07('0x1a')]({'host':a2_0x4c07('0x1b'),'port':0x15,'user':a2_0x4c07('0x1c'),'password':a2_0x4c07('0x1c')});};exports[a2_0x4c07('0x1d')]=(_0x28ad8b,_0x3d91be)=>{exports[a2_0x4c07('0x3')][a2_0x4c07('0x1e')][a2_0x4c07('0x14')][a2_0x4c07('0x1f')]({'where':{'status':null}})['then'](_0x43c5aa=>{if(_0x43c5aa){const _0x190057=new ftp_1['default']();_0x190057['on'](a2_0x4c07('0xd'),function(){console[a2_0x4c07('0xa')]('connected:'+_0x43c5aa[a2_0x4c07('0x20')]);_0x190057['get']('colombia/'+_0x43c5aa[a2_0x4c07('0x20')],function(_0xb023e6,_0x5ca8e9){_0x190057[a2_0x4c07('0x21')]();if(_0xb023e6){}else{const _0x88b2b5=a2_0x4c07('0x22')+_0x43c5aa[a2_0x4c07('0x20')]+a2_0x4c07('0x23');_0x5ca8e9[a2_0x4c07('0x24')](fs_1['default'][a2_0x4c07('0x25')](_0x88b2b5));_0x43c5aa[a2_0x4c07('0x26')]=0x1;_0x43c5aa[a2_0x4c07('0x27')]();console['log']('Downloaded:\x20'+_0x43c5aa[a2_0x4c07('0x20')]);}});});_0x190057['on'](a2_0x4c07('0x19'),function(_0x27afb3){_0x3d91be[a2_0x4c07('0x18')]({'message':_0x27afb3});});_0x190057[a2_0x4c07('0x1a')]({'host':a2_0x4c07('0x1b'),'port':0x15,'user':a2_0x4c07('0x1c'),'password':a2_0x4c07('0x1c')});_0x3d91be['json']({'data':_0x43c5aa['fileName']});}else{_0x3d91be[a2_0x4c07('0x18')]({'data':[]});}});};exports[a2_0x4c07('0x28')]=(_0x986172,_0x45dd89)=>{exports['sequelize'][a2_0x4c07('0x1e')][a2_0x4c07('0x14')][a2_0x4c07('0x1f')]({'where':{'status':0x1}})[a2_0x4c07('0x29')](_0x3bdfa9=>{if(_0x3bdfa9){const _0x47f93a=a2_0x4c07('0x22')+_0x3bdfa9[a2_0x4c07('0x20')]+'.txt';fs_1[a2_0x4c07('0xc')][a2_0x4c07('0x2a')](_0x47f93a,'utf8',function(_0x2a147d,_0x591737){if(_0x2a147d){_0x3bdfa9['status']=null;}else{try{const _0x3633d2=JSON[a2_0x4c07('0x2b')](_0x591737);for(const _0x4e0042 of _0x3633d2[a2_0x4c07('0x2c')][0x0][a2_0x4c07('0x2d')]){const _0x200eaa=_0x4e0042['In'];const _0x278c7e=_0x4e0042[a2_0x4c07('0x2e')];const _0xbb2ae8=Date[a2_0x4c07('0x2b')](_0x4e0042[a2_0x4c07('0x2f')]);if(_0x200eaa>0x0){exports['sequelize'][a2_0x4c07('0x1e')][a2_0x4c07('0x30')][a2_0x4c07('0x31')]({'reportFileId':_0x3bdfa9['id'],'amount':_0x200eaa,'countingDate':_0xbb2ae8});}if(_0x278c7e>0x0){exports[a2_0x4c07('0x3')][a2_0x4c07('0x1e')]['pass_counting'][a2_0x4c07('0x31')]({'reportFileId':_0x3bdfa9['id'],'amount':_0x278c7e*-0x1,'countingDate':_0xbb2ae8});}}_0x3bdfa9[a2_0x4c07('0x26')]=0x2;}catch(_0x2d0063){_0x3bdfa9[a2_0x4c07('0x26')]=null;}}_0x3bdfa9['save']();});_0x45dd89[a2_0x4c07('0x18')]({'data':_0x3bdfa9[a2_0x4c07('0x20')]});}else{_0x45dd89[a2_0x4c07('0x18')]({'data':[]});}});};exports['getPassCounting']=(_0x47df2c,_0x3bf14f)=>{exports['sequelize']['models']['pass_counting'][a2_0x4c07('0x32')]({'where':{'amount':{[exports[a2_0x4c07('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0x4c07('0x33'),a2_0x4c07('0x34')]]})[a2_0x4c07('0x29')](_0x1e6417=>{_0x3bf14f['json']({'data':_0x1e6417});});};exports['getPassCountingByDay']=(_0x1252f8,_0x1e7c4f)=>{const _0x2e4770=_0x1252f8[a2_0x4c07('0x35')][a2_0x4c07('0x36')];const _0xd857c6=_0x1252f8[a2_0x4c07('0x35')][a2_0x4c07('0x37')];const _0x5865c7=_0x1252f8[a2_0x4c07('0x35')][a2_0x4c07('0x38')];exports[a2_0x4c07('0x3')][a2_0x4c07('0x1e')]['pass_counting'][a2_0x4c07('0x32')]({'attributes':[a2_0x4c07('0x33'),[exports[a2_0x4c07('0x3')]['fn']('sum',exports[a2_0x4c07('0x3')][a2_0x4c07('0x39')](a2_0x4c07('0x3a'))),a2_0x4c07('0x3b')]],'where':{'countingDate':{[exports[a2_0x4c07('0x3')]['Op'][a2_0x4c07('0x3c')]]:_0xd857c6,[exports[a2_0x4c07('0x3')]['Op']['lt']]:_0x5865c7},'amount':_0x1252f8['params'][a2_0x4c07('0x3d')]=='in'?{[exports[a2_0x4c07('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x4c07('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4c07('0x3')][a2_0x4c07('0x3e')](a2_0x4c07('0x3f'))],'order':[['countingDate',a2_0x4c07('0x34')]]})[a2_0x4c07('0x29')](_0x3f0f44=>{_0x1e7c4f[a2_0x4c07('0x18')]({'data':_0x3f0f44});});};exports[a2_0x4c07('0x40')]=(_0x295adc,_0x293e11)=>{const _0x32f8bd=_0x295adc[a2_0x4c07('0x35')]['month'];const _0x344d90=_0x295adc[a2_0x4c07('0x35')]['startDate'];const _0x2eda67=_0x295adc['query'][a2_0x4c07('0x38')];exports[a2_0x4c07('0x3')][a2_0x4c07('0x1e')][a2_0x4c07('0x30')][a2_0x4c07('0x32')]({'attributes':['countingDate',[exports[a2_0x4c07('0x3')]['fn'](a2_0x4c07('0x41'),exports[a2_0x4c07('0x3')][a2_0x4c07('0x39')](a2_0x4c07('0x33')),a2_0x4c07('0x42')),'countingDateShort'],[exports['sequelize']['fn'](a2_0x4c07('0x43'),exports['sequelize']['col']('amount')),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x4c07('0x3c')]]:_0x344d90,[exports[a2_0x4c07('0x3')]['Op']['lt']]:_0x2eda67},'amount':_0x295adc[a2_0x4c07('0x44')]['direction']=='in'?{[exports[a2_0x4c07('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x4c07('0x45'),exports[a2_0x4c07('0x3')][a2_0x4c07('0x39')]('countingDate')),exports[a2_0x4c07('0x3')]['fn']('DAY',exports[a2_0x4c07('0x3')]['col'](a2_0x4c07('0x33'))),exports[a2_0x4c07('0x3')]['fn'](a2_0x4c07('0x46'),exports[a2_0x4c07('0x3')][a2_0x4c07('0x39')](a2_0x4c07('0x33'))),exports[a2_0x4c07('0x3')]['fn'](a2_0x4c07('0x47'),exports[a2_0x4c07('0x3')]['col'](a2_0x4c07('0x33')))],'order':[[a2_0x4c07('0x33'),a2_0x4c07('0x34')]]})['then'](_0x14fe1b=>{_0x293e11[a2_0x4c07('0x18')]({'data':_0x14fe1b});});};exports['getFacebook']=(_0x44a89c,_0x99dc7f,_0x701cc)=>{const _0x535335=_0x44a89c[a2_0x4c07('0x48')][a2_0x4c07('0x49')][a2_0x4c07('0x4a')](_0x535335=>_0x535335[a2_0x4c07('0x4b')]===a2_0x4c07('0x4c'));fbgraph_1[a2_0x4c07('0xc')]['setAccessToken'](_0x535335[a2_0x4c07('0x4d')]);fbgraph_1[a2_0x4c07('0xc')][a2_0x4c07('0x4e')](_0x44a89c[a2_0x4c07('0x48')][a2_0x4c07('0x4c')]+a2_0x4c07('0x4f'),(_0x3b0a93,_0x5783af)=>{if(_0x3b0a93){return _0x701cc(_0x3b0a93);}_0x99dc7f[a2_0x4c07('0x6')](a2_0x4c07('0x50'),{'title':a2_0x4c07('0x51'),'profile':_0x5783af});});};