var a2_0xe2c2=['facebook','setAccessToken','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','__importDefault','__esModule','defineProperty','ftp','sequelize','setSequelize','render','api/index','API\x20Examples','default','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','error','ipd','downloadFtp','ready','connected:','fileName','get','colombia/','end','media/','.txt','pipe','createWriteStream','save','Downloaded:\x20','connect','ftp.vivotek.com','findOne','then','utf8','status','parse','Data','CountingInfo','Out','EndTime','pass_counting','create','getPassCounting','countingDate','ASC','query','month','startDate','sum','col','amount','total','params','literal','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','gte','DAY','MONTH','YEAR','find'];(function(_0x38e6b2,_0x488ec9){var _0xa66021=function(_0x2b25ab){while(--_0x2b25ab){_0x38e6b2['push'](_0x38e6b2['shift']());}};_0xa66021(++_0x488ec9);}(a2_0xe2c2,0xe9));var a2_0x34d1=function(_0x2699a9,_0x501e82){_0x2699a9=_0x2699a9-0x0;var _0x5b6c40=a2_0xe2c2[_0x2699a9];return _0x5b6c40;};'use strict';var __importDefault=this&&this[a2_0x34d1('0x0')]||function(_0x3757ba){return _0x3757ba&&_0x3757ba[a2_0x34d1('0x1')]?_0x3757ba:{'default':_0x3757ba};};Object[a2_0x34d1('0x2')](exports,a2_0x34d1('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a2_0x34d1('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x34d1('0x4')]='';function setSequelize(_0x94e9a4){exports[a2_0x34d1('0x4')]=_0x94e9a4;}exports[a2_0x34d1('0x5')]=setSequelize;exports['getApi']=(_0x1bc15c,_0x184351)=>{_0x184351[a2_0x34d1('0x6')](a2_0x34d1('0x7'),{'title':a2_0x34d1('0x8')});};exports['syncFtp']=(_0x3c9206,_0x20b497)=>{console['log']('connecting');const _0x4b1f94=[];const _0x24ba90=new ftp_1[(a2_0x34d1('0x9'))]();_0x24ba90['on']('ready',function(){console[a2_0x34d1('0xa')](a2_0x34d1('0xb'));_0x24ba90[a2_0x34d1('0xc')](a2_0x34d1('0xd'),![],function(_0x47996a,_0x1ab034){if(_0x47996a){}else{for(const _0x107546 of _0x1ab034){console[a2_0x34d1('0xa')](a2_0x34d1('0xe')+_0x107546[a2_0x34d1('0xf')]);if(_0x107546[a2_0x34d1('0xf')][a2_0x34d1('0x10')](a2_0x34d1('0x11'))){exports[a2_0x34d1('0x4')][a2_0x34d1('0x12')][a2_0x34d1('0x13')][a2_0x34d1('0x14')]({'where':{'fileName':_0x107546[a2_0x34d1('0xf')]}})[a2_0x34d1('0x15')]((_0x72f7e0,_0x2431da)=>{if(_0x2431da){console[a2_0x34d1('0xa')](_0x107546[a2_0x34d1('0xf')]);_0x4b1f94['push'](_0x72f7e0);}});}}}_0x20b497[a2_0x34d1('0x11')]({'data':_0x4b1f94});});});_0x24ba90['on'](a2_0x34d1('0x16'),function(_0x2a9355){_0x20b497['json']({'message':_0x2a9355});});_0x24ba90['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x34d1('0x17'),'password':'ipd'});};exports[a2_0x34d1('0x18')]=(_0x3085b4,_0x3d9bf9)=>{exports[a2_0x34d1('0x4')][a2_0x34d1('0x12')][a2_0x34d1('0x13')]['findOne']({'where':{'status':null}})['then'](_0xe958a0=>{if(_0xe958a0){const _0x40162f=new ftp_1['default']();_0x40162f['on'](a2_0x34d1('0x19'),function(){console[a2_0x34d1('0xa')](a2_0x34d1('0x1a')+_0xe958a0[a2_0x34d1('0x1b')]);_0x40162f[a2_0x34d1('0x1c')](a2_0x34d1('0x1d')+_0xe958a0[a2_0x34d1('0x1b')],function(_0x2c6722,_0x194749){_0x40162f[a2_0x34d1('0x1e')]();if(_0x2c6722){}else{const _0x56b5cc=a2_0x34d1('0x1f')+_0xe958a0['fileName']+a2_0x34d1('0x20');_0x194749[a2_0x34d1('0x21')](fs_1[a2_0x34d1('0x9')][a2_0x34d1('0x22')](_0x56b5cc));_0xe958a0['status']=0x1;_0xe958a0[a2_0x34d1('0x23')]();console['log'](a2_0x34d1('0x24')+_0xe958a0[a2_0x34d1('0x1b')]);}});});_0x40162f['on'](a2_0x34d1('0x16'),function(_0x5a8047){_0x3d9bf9['json']({'message':_0x5a8047});});_0x40162f[a2_0x34d1('0x25')]({'host':a2_0x34d1('0x26'),'port':0x15,'user':a2_0x34d1('0x17'),'password':a2_0x34d1('0x17')});_0x3d9bf9[a2_0x34d1('0x11')]({'data':_0xe958a0['fileName']});}else{_0x3d9bf9['json']({'data':[]});}});};exports['processFtp']=(_0x39e20a,_0x1ba638)=>{exports[a2_0x34d1('0x4')][a2_0x34d1('0x12')]['report_files'][a2_0x34d1('0x27')]({'where':{'status':0x1}})[a2_0x34d1('0x28')](_0x293364=>{if(_0x293364){const _0x6bba0d='media/'+_0x293364[a2_0x34d1('0x1b')]+a2_0x34d1('0x20');fs_1[a2_0x34d1('0x9')]['readFile'](_0x6bba0d,a2_0x34d1('0x29'),function(_0xf8ade5,_0x32ad72){if(_0xf8ade5){_0x293364[a2_0x34d1('0x2a')]=null;}else{try{const _0x5c14dd=JSON[a2_0x34d1('0x2b')](_0x32ad72);for(const _0x328089 of _0x5c14dd[a2_0x34d1('0x2c')][0x0][a2_0x34d1('0x2d')]){const _0x4d2f8b=_0x328089['In'];const _0x36d50a=_0x328089[a2_0x34d1('0x2e')];const _0x1b4812=Date[a2_0x34d1('0x2b')](_0x328089[a2_0x34d1('0x2f')]);if(_0x4d2f8b>0x0){exports[a2_0x34d1('0x4')]['models'][a2_0x34d1('0x30')][a2_0x34d1('0x31')]({'reportFileId':_0x293364['id'],'amount':_0x4d2f8b,'countingDate':_0x1b4812});}if(_0x36d50a>0x0){exports['sequelize'][a2_0x34d1('0x12')][a2_0x34d1('0x30')][a2_0x34d1('0x31')]({'reportFileId':_0x293364['id'],'amount':_0x36d50a*-0x1,'countingDate':_0x1b4812});}}_0x293364['status']=0x2;}catch(_0x4523e6){_0x293364[a2_0x34d1('0x2a')]=null;}}_0x293364['save']();});_0x1ba638[a2_0x34d1('0x11')]({'data':_0x293364[a2_0x34d1('0x1b')]});}else{_0x1ba638[a2_0x34d1('0x11')]({'data':[]});}});};exports[a2_0x34d1('0x32')]=(_0x351ab3,_0xaaf366)=>{exports['sequelize']['models'][a2_0x34d1('0x30')]['findAll']({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x34d1('0x33'),a2_0x34d1('0x34')]]})[a2_0x34d1('0x28')](_0x101ba2=>{_0xaaf366[a2_0x34d1('0x11')]({'data':_0x101ba2});});};exports['getPassCountingByDay']=(_0x3daff0,_0x5d915c)=>{const _0x5366ed=_0x3daff0[a2_0x34d1('0x35')][a2_0x34d1('0x36')];const _0x23c4e8=_0x3daff0[a2_0x34d1('0x35')][a2_0x34d1('0x37')];const _0x2a8540=_0x3daff0[a2_0x34d1('0x35')]['endDate'];exports[a2_0x34d1('0x4')][a2_0x34d1('0x12')][a2_0x34d1('0x30')]['findAll']({'attributes':['countingDate',[exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x38'),exports[a2_0x34d1('0x4')][a2_0x34d1('0x39')](a2_0x34d1('0x3a'))),a2_0x34d1('0x3b')]],'where':{'countingDate':{[exports[a2_0x34d1('0x4')]['Op']['gte']]:_0x23c4e8,[exports[a2_0x34d1('0x4')]['Op']['lt']]:_0x2a8540},'amount':_0x3daff0[a2_0x34d1('0x3c')]['direction']=='in'?{[exports[a2_0x34d1('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x34d1('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x34d1('0x4')][a2_0x34d1('0x3d')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x34d1('0x33'),a2_0x34d1('0x34')]]})[a2_0x34d1('0x28')](_0x332df9=>{_0x5d915c['json']({'data':_0x332df9});});};exports[a2_0x34d1('0x3e')]=(_0x12a60c,_0x475de3)=>{const _0x48d9c2=_0x12a60c[a2_0x34d1('0x35')][a2_0x34d1('0x36')];const _0x382334=_0x12a60c['query'][a2_0x34d1('0x37')];const _0x1ba6de=_0x12a60c['query']['endDate'];exports['sequelize'][a2_0x34d1('0x12')][a2_0x34d1('0x30')]['findAll']({'attributes':[a2_0x34d1('0x33'),[exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x3f'),exports['sequelize'][a2_0x34d1('0x39')](a2_0x34d1('0x33')),a2_0x34d1('0x40')),a2_0x34d1('0x41')],[exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x38'),exports[a2_0x34d1('0x4')]['col'](a2_0x34d1('0x3a'))),a2_0x34d1('0x3b')]],'where':{'countingDate':{[exports[a2_0x34d1('0x4')]['Op'][a2_0x34d1('0x42')]]:_0x382334,[exports[a2_0x34d1('0x4')]['Op']['lt']]:_0x1ba6de},'amount':_0x12a60c['params']['direction']=='in'?{[exports[a2_0x34d1('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x34d1('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x34d1('0x4')]['fn']('HOUR',exports['sequelize'][a2_0x34d1('0x39')](a2_0x34d1('0x33'))),exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x43'),exports[a2_0x34d1('0x4')][a2_0x34d1('0x39')](a2_0x34d1('0x33'))),exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x44'),exports[a2_0x34d1('0x4')][a2_0x34d1('0x39')]('countingDate')),exports[a2_0x34d1('0x4')]['fn'](a2_0x34d1('0x45'),exports[a2_0x34d1('0x4')]['col'](a2_0x34d1('0x33')))],'order':[['countingDate','ASC']]})[a2_0x34d1('0x28')](_0x4a9393=>{_0x475de3[a2_0x34d1('0x11')]({'data':_0x4a9393});});};exports['getFacebook']=(_0x3b0eb5,_0x5a54ab,_0x297666)=>{const _0x25ff06=_0x3b0eb5['user']['tokens'][a2_0x34d1('0x46')](_0x25ff06=>_0x25ff06['kind']===a2_0x34d1('0x47'));fbgraph_1[a2_0x34d1('0x9')][a2_0x34d1('0x48')](_0x25ff06['accessToken']);fbgraph_1['default']['get'](_0x3b0eb5[a2_0x34d1('0x49')]['facebook']+a2_0x34d1('0x4a'),(_0x64e36e,_0x45232e)=>{if(_0x64e36e){return _0x297666(_0x64e36e);}_0x5a54ab[a2_0x34d1('0x6')](a2_0x34d1('0x4b'),{'title':'Facebook\x20API','profile':_0x45232e});});};