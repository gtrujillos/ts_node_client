var a2_0xe601=['defineProperty','ftp','sequelize','setSequelize','getApi','api/index','API\x20Examples','default','ready','log','list','Downloading:\x20','name','endsWith','models','report_files','findOrCreate','push','json','connect','ipd','downloadFtp','findOne','connected:','colombia/','fileName','end','createWriteStream','status','save','Downloaded:\x20','error','ftp.vivotek.com','processFtp','then','media/','.txt','readFile','utf8','CountingInfo','Out','parse','EndTime','pass_counting','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','col','gte','direction','literal','getPassCountingByHour','DATE_FORMAT','countingDateShort','amount','params','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','facebook','setAccessToken','accessToken','render','Facebook\x20API','__importDefault','__esModule'];(function(_0x4ec493,_0x2c7ccf){var _0x1fbf26=function(_0x1700a0){while(--_0x1700a0){_0x4ec493['push'](_0x4ec493['shift']());}};_0x1fbf26(++_0x2c7ccf);}(a2_0xe601,0x136));var a2_0x25fe=function(_0x33eed0,_0x30a5c2){_0x33eed0=_0x33eed0-0x0;var _0x31e36b=a2_0xe601[_0x33eed0];return _0x31e36b;};'use strict';var __importDefault=this&&this[a2_0x25fe('0x0')]||function(_0x7400a2){return _0x7400a2&&_0x7400a2[a2_0x25fe('0x1')]?_0x7400a2:{'default':_0x7400a2};};Object[a2_0x25fe('0x2')](exports,a2_0x25fe('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a2_0x25fe('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x25fe('0x4')]='';function setSequelize(_0x26cb0a){exports[a2_0x25fe('0x4')]=_0x26cb0a;}exports[a2_0x25fe('0x5')]=setSequelize;exports[a2_0x25fe('0x6')]=(_0x2432c9,_0xabfc96)=>{_0xabfc96['render'](a2_0x25fe('0x7'),{'title':a2_0x25fe('0x8')});};exports['syncFtp']=(_0x41cdc7,_0xd6ac43)=>{console['log']('connecting');const _0x9620bd=[];const _0x3f8fe4=new ftp_1[(a2_0x25fe('0x9'))]();_0x3f8fe4['on'](a2_0x25fe('0xa'),function(){console[a2_0x25fe('0xb')]('connected');_0x3f8fe4[a2_0x25fe('0xc')]('colombia',![],function(_0x3fffd9,_0x480ead){if(_0x3fffd9){}else{for(const _0x2c3772 of _0x480ead){console['log'](a2_0x25fe('0xd')+_0x2c3772['name']);if(_0x2c3772[a2_0x25fe('0xe')][a2_0x25fe('0xf')]('json')){exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x11')][a2_0x25fe('0x12')]({'where':{'fileName':_0x2c3772[a2_0x25fe('0xe')]}})['spread']((_0x13c87c,_0x4b6202)=>{if(_0x4b6202){console[a2_0x25fe('0xb')](_0x2c3772[a2_0x25fe('0xe')]);_0x9620bd[a2_0x25fe('0x13')](_0x13c87c);}});}}}_0xd6ac43[a2_0x25fe('0x14')]({'data':_0x9620bd});});});_0x3f8fe4['on']('error',function(_0x337ab5){_0xd6ac43[a2_0x25fe('0x14')]({'message':_0x337ab5});});_0x3f8fe4[a2_0x25fe('0x15')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x25fe('0x16'),'password':a2_0x25fe('0x16')});};exports[a2_0x25fe('0x17')]=(_0x3434cf,_0x138573)=>{exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x11')][a2_0x25fe('0x18')]({'where':{'status':null}})['then'](_0x58fbe7=>{if(_0x58fbe7){const _0xa79ca=new ftp_1['default']();_0xa79ca['on'](a2_0x25fe('0xa'),function(){console[a2_0x25fe('0xb')](a2_0x25fe('0x19')+_0x58fbe7['fileName']);_0xa79ca['get'](a2_0x25fe('0x1a')+_0x58fbe7[a2_0x25fe('0x1b')],function(_0x4c583,_0x3381b2){_0xa79ca[a2_0x25fe('0x1c')]();if(_0x4c583){}else{const _0xad23b2='media/'+_0x58fbe7['fileName']+'.txt';_0x3381b2['pipe'](fs_1[a2_0x25fe('0x9')][a2_0x25fe('0x1d')](_0xad23b2));_0x58fbe7[a2_0x25fe('0x1e')]=0x1;_0x58fbe7[a2_0x25fe('0x1f')]();console['log'](a2_0x25fe('0x20')+_0x58fbe7[a2_0x25fe('0x1b')]);}});});_0xa79ca['on'](a2_0x25fe('0x21'),function(_0x8116f9){_0x138573[a2_0x25fe('0x14')]({'message':_0x8116f9});});_0xa79ca[a2_0x25fe('0x15')]({'host':a2_0x25fe('0x22'),'port':0x15,'user':a2_0x25fe('0x16'),'password':a2_0x25fe('0x16')});_0x138573[a2_0x25fe('0x14')]({'data':_0x58fbe7[a2_0x25fe('0x1b')]});}else{_0x138573[a2_0x25fe('0x14')]({'data':[]});}});};exports[a2_0x25fe('0x23')]=(_0x599a14,_0x457a24)=>{exports[a2_0x25fe('0x4')]['models']['report_files'][a2_0x25fe('0x18')]({'where':{'status':0x1}})[a2_0x25fe('0x24')](_0x334ce6=>{if(_0x334ce6){const _0x45cb0c=a2_0x25fe('0x25')+_0x334ce6['fileName']+a2_0x25fe('0x26');fs_1['default'][a2_0x25fe('0x27')](_0x45cb0c,a2_0x25fe('0x28'),function(_0x3381a2,_0x599bf1){if(_0x3381a2){_0x334ce6[a2_0x25fe('0x1e')]=null;}else{try{const _0x237d28=JSON['parse'](_0x599bf1);for(const _0x236217 of _0x237d28['Data'][0x0][a2_0x25fe('0x29')]){const _0x5be69c=_0x236217['In'];const _0x88a69b=_0x236217[a2_0x25fe('0x2a')];const _0x392d0f=Date[a2_0x25fe('0x2b')](_0x236217[a2_0x25fe('0x2c')]);if(_0x5be69c>0x0){exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x2d')]['create']({'reportFileId':_0x334ce6['id'],'amount':_0x5be69c,'countingDate':_0x392d0f});}if(_0x88a69b>0x0){exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x2d')]['create']({'reportFileId':_0x334ce6['id'],'amount':_0x88a69b*-0x1,'countingDate':_0x392d0f});}}_0x334ce6[a2_0x25fe('0x1e')]=0x2;}catch(_0x2b0f6b){_0x334ce6['status']=null;}}_0x334ce6[a2_0x25fe('0x1f')]();});_0x457a24['json']({'data':_0x334ce6[a2_0x25fe('0x1b')]});}else{_0x457a24['json']({'data':[]});}});};exports[a2_0x25fe('0x2e')]=(_0x42f980,_0x43bf36)=>{exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x2d')][a2_0x25fe('0x2f')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x25fe('0x30'),a2_0x25fe('0x31')]]})['then'](_0x38f4eb=>{_0x43bf36[a2_0x25fe('0x14')]({'data':_0x38f4eb});});};exports[a2_0x25fe('0x32')]=(_0x320867,_0x5a92cd)=>{const _0x9102b6=_0x320867[a2_0x25fe('0x33')][a2_0x25fe('0x34')];const _0x4cf6ac=_0x320867[a2_0x25fe('0x33')][a2_0x25fe('0x35')];const _0x326f2e=_0x320867[a2_0x25fe('0x33')][a2_0x25fe('0x36')];exports[a2_0x25fe('0x4')][a2_0x25fe('0x10')][a2_0x25fe('0x2d')][a2_0x25fe('0x2f')]({'attributes':[a2_0x25fe('0x30'),[exports['sequelize']['fn'](a2_0x25fe('0x37'),exports[a2_0x25fe('0x4')][a2_0x25fe('0x38')]('amount')),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x25fe('0x39')]]:_0x4cf6ac,[exports[a2_0x25fe('0x4')]['Op']['lt']]:_0x326f2e},'amount':_0x320867['params'][a2_0x25fe('0x3a')]=='in'?{[exports[a2_0x25fe('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x25fe('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x25fe('0x4')][a2_0x25fe('0x3b')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x25fe('0x30'),a2_0x25fe('0x31')]]})['then'](_0x2edce2=>{_0x5a92cd[a2_0x25fe('0x14')]({'data':_0x2edce2});});};exports[a2_0x25fe('0x3c')]=(_0x56a470,_0x100680)=>{const _0x72212c=_0x56a470['query']['month'];const _0x4310f7=_0x56a470[a2_0x25fe('0x33')][a2_0x25fe('0x35')];const _0x41fbb2=_0x56a470['query']['endDate'];exports[a2_0x25fe('0x4')]['models'][a2_0x25fe('0x2d')]['findAll']({'attributes':[a2_0x25fe('0x30'),[exports[a2_0x25fe('0x4')]['fn'](a2_0x25fe('0x3d'),exports[a2_0x25fe('0x4')][a2_0x25fe('0x38')](a2_0x25fe('0x30')),'%Y-%m-%d\x20%H:00'),a2_0x25fe('0x3e')],[exports['sequelize']['fn']('sum',exports[a2_0x25fe('0x4')]['col'](a2_0x25fe('0x3f'))),'total']],'where':{'countingDate':{[exports[a2_0x25fe('0x4')]['Op'][a2_0x25fe('0x39')]]:_0x4310f7,[exports[a2_0x25fe('0x4')]['Op']['lt']]:_0x41fbb2},'amount':_0x56a470[a2_0x25fe('0x40')]['direction']=='in'?{[exports[a2_0x25fe('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x25fe('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x25fe('0x4')]['fn'](a2_0x25fe('0x41'),exports[a2_0x25fe('0x4')][a2_0x25fe('0x38')](a2_0x25fe('0x30'))),exports[a2_0x25fe('0x4')]['fn'](a2_0x25fe('0x42'),exports[a2_0x25fe('0x4')]['col'](a2_0x25fe('0x30'))),exports[a2_0x25fe('0x4')]['fn'](a2_0x25fe('0x43'),exports[a2_0x25fe('0x4')]['col'](a2_0x25fe('0x30'))),exports['sequelize']['fn'](a2_0x25fe('0x44'),exports[a2_0x25fe('0x4')][a2_0x25fe('0x38')](a2_0x25fe('0x30')))],'order':[[a2_0x25fe('0x30'),'ASC']]})['then'](_0x35b25e=>{_0x100680[a2_0x25fe('0x14')]({'data':_0x35b25e});});};exports[a2_0x25fe('0x45')]=(_0x46615f,_0x207559,_0x32cceb)=>{const _0x505538=_0x46615f[a2_0x25fe('0x46')][a2_0x25fe('0x47')][a2_0x25fe('0x48')](_0x505538=>_0x505538['kind']===a2_0x25fe('0x49'));fbgraph_1['default'][a2_0x25fe('0x4a')](_0x505538[a2_0x25fe('0x4b')]);fbgraph_1[a2_0x25fe('0x9')]['get'](_0x46615f[a2_0x25fe('0x46')][a2_0x25fe('0x49')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x1903f6,_0x1b5a5b)=>{if(_0x1903f6){return _0x32cceb(_0x1903f6);}_0x207559[a2_0x25fe('0x4c')]('api/facebook',{'title':a2_0x25fe('0x4d'),'profile':_0x1b5a5b});});};