var a2_0x31fe=['Data','CountingInfo','Out','EndTime','pass_counting','create','getPassCounting','findAll','ASC','getPassCountingByDay','query','month','startDate','endDate','countingDate','sum','col','total','gte','direction','literal','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','HOUR','DAY','MONTH','getFacebook','user','tokens','kind','facebook','accessToken','get','Facebook\x20API','__importDefault','__esModule','fbgraph','sequelize','setSequelize','getApi','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','list','name','models','findOrCreate','spread','push','json','connect','ftp.vivotek.com','ipd','report_files','findOne','then','connected:','fileName','colombia/','end','media/','.txt','status','save','Downloaded:\x20','error','processFtp','readFile','utf8','parse'];(function(_0x3e75df,_0x349d45){var _0x1d0a14=function(_0x306be2){while(--_0x306be2){_0x3e75df['push'](_0x3e75df['shift']());}};_0x1d0a14(++_0x349d45);}(a2_0x31fe,0x70));var a2_0x258b=function(_0x4f9a8f,_0x76b3f8){_0x4f9a8f=_0x4f9a8f-0x0;var _0x42d99d=a2_0x31fe[_0x4f9a8f];return _0x42d99d;};'use strict';var __importDefault=this&&this[a2_0x258b('0x0')]||function(_0x1f46bf){return _0x1f46bf&&_0x1f46bf[a2_0x258b('0x1')]?_0x1f46bf:{'default':_0x1f46bf};};Object['defineProperty'](exports,a2_0x258b('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x258b('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x8e77c){exports[a2_0x258b('0x3')]=_0x8e77c;}exports[a2_0x258b('0x4')]=setSequelize;exports[a2_0x258b('0x5')]=(_0x533bec,_0x10583b)=>{_0x10583b['render'](a2_0x258b('0x6'),{'title':a2_0x258b('0x7')});};exports[a2_0x258b('0x8')]=(_0x49162f,_0x4ba993)=>{console[a2_0x258b('0x9')](a2_0x258b('0xa'));const _0x50ea50=[];const _0x425c3c=new ftp_1[(a2_0x258b('0xb'))]();_0x425c3c['on'](a2_0x258b('0xc'),function(){console[a2_0x258b('0x9')]('connected');_0x425c3c[a2_0x258b('0xd')]('colombia',![],function(_0x10aa8a,_0x221072){if(_0x10aa8a){}else{for(const _0x12ce8a of _0x221072){console[a2_0x258b('0x9')]('Downloading:\x20'+_0x12ce8a[a2_0x258b('0xe')]);if(_0x12ce8a[a2_0x258b('0xe')]['endsWith']('json')){exports[a2_0x258b('0x3')][a2_0x258b('0xf')]['report_files'][a2_0x258b('0x10')]({'where':{'fileName':_0x12ce8a['name']}})[a2_0x258b('0x11')]((_0x4b7913,_0xb87a94)=>{if(_0xb87a94){console[a2_0x258b('0x9')](_0x12ce8a[a2_0x258b('0xe')]);_0x50ea50[a2_0x258b('0x12')](_0x4b7913);}});}}}_0x4ba993[a2_0x258b('0x13')]({'data':_0x50ea50});});});_0x425c3c['on']('error',function(_0x1f3f23){_0x4ba993[a2_0x258b('0x13')]({'message':_0x1f3f23});});_0x425c3c[a2_0x258b('0x14')]({'host':a2_0x258b('0x15'),'port':0x15,'user':a2_0x258b('0x16'),'password':a2_0x258b('0x16')});};exports['downloadFtp']=(_0x176faa,_0x48c315)=>{exports['sequelize'][a2_0x258b('0xf')][a2_0x258b('0x17')][a2_0x258b('0x18')]({'where':{'status':null}})[a2_0x258b('0x19')](_0x568409=>{if(_0x568409){const _0x320735=new ftp_1[(a2_0x258b('0xb'))]();_0x320735['on'](a2_0x258b('0xc'),function(){console[a2_0x258b('0x9')](a2_0x258b('0x1a')+_0x568409[a2_0x258b('0x1b')]);_0x320735['get'](a2_0x258b('0x1c')+_0x568409[a2_0x258b('0x1b')],function(_0x4a8e80,_0x53b99d){_0x320735[a2_0x258b('0x1d')]();if(_0x4a8e80){}else{const _0x1f6955=a2_0x258b('0x1e')+_0x568409['fileName']+a2_0x258b('0x1f');_0x53b99d['pipe'](fs_1[a2_0x258b('0xb')]['createWriteStream'](_0x1f6955));_0x568409[a2_0x258b('0x20')]=0x1;_0x568409[a2_0x258b('0x21')]();console[a2_0x258b('0x9')](a2_0x258b('0x22')+_0x568409['fileName']);}});});_0x320735['on'](a2_0x258b('0x23'),function(_0x4fb909){_0x48c315[a2_0x258b('0x13')]({'message':_0x4fb909});});_0x320735[a2_0x258b('0x14')]({'host':a2_0x258b('0x15'),'port':0x15,'user':a2_0x258b('0x16'),'password':'ipd'});_0x48c315[a2_0x258b('0x13')]({'data':_0x568409[a2_0x258b('0x1b')]});}else{_0x48c315[a2_0x258b('0x13')]({'data':[]});}});};exports[a2_0x258b('0x24')]=(_0x526dd1,_0x35a915)=>{exports[a2_0x258b('0x3')][a2_0x258b('0xf')]['report_files']['findOne']({'where':{'status':0x1}})[a2_0x258b('0x19')](_0x3ba07e=>{if(_0x3ba07e){const _0x10bbfd=a2_0x258b('0x1e')+_0x3ba07e[a2_0x258b('0x1b')]+a2_0x258b('0x1f');fs_1[a2_0x258b('0xb')][a2_0x258b('0x25')](_0x10bbfd,a2_0x258b('0x26'),function(_0x42024c,_0x41e994){if(_0x42024c){_0x3ba07e['status']=null;}else{try{const _0x1f6178=JSON[a2_0x258b('0x27')](_0x41e994);for(const _0x4fc94a of _0x1f6178[a2_0x258b('0x28')][0x0][a2_0x258b('0x29')]){const _0x49c3d4=_0x4fc94a['In'];const _0x47c19b=_0x4fc94a[a2_0x258b('0x2a')];const _0x5291e3=Date['parse'](_0x4fc94a[a2_0x258b('0x2b')]);if(_0x49c3d4>0x0){exports[a2_0x258b('0x3')][a2_0x258b('0xf')][a2_0x258b('0x2c')][a2_0x258b('0x2d')]({'reportFileId':_0x3ba07e['id'],'amount':_0x49c3d4,'countingDate':_0x5291e3});}if(_0x47c19b>0x0){exports[a2_0x258b('0x3')][a2_0x258b('0xf')]['pass_counting'][a2_0x258b('0x2d')]({'reportFileId':_0x3ba07e['id'],'amount':_0x47c19b*-0x1,'countingDate':_0x5291e3});}}_0x3ba07e[a2_0x258b('0x20')]=0x2;}catch(_0x539807){_0x3ba07e[a2_0x258b('0x20')]=null;}}_0x3ba07e[a2_0x258b('0x21')]();});_0x35a915[a2_0x258b('0x13')]({'data':_0x3ba07e['fileName']});}else{_0x35a915['json']({'data':[]});}});};exports[a2_0x258b('0x2e')]=(_0x210ddb,_0x2cab58)=>{exports[a2_0x258b('0x3')]['models'][a2_0x258b('0x2c')][a2_0x258b('0x2f')]({'where':{'amount':{[exports[a2_0x258b('0x3')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x258b('0x30')]]})[a2_0x258b('0x19')](_0x4e121e=>{_0x2cab58['json']({'data':_0x4e121e});});};exports[a2_0x258b('0x31')]=(_0x2ed673,_0x41c056)=>{const _0x3206a2=_0x2ed673[a2_0x258b('0x32')][a2_0x258b('0x33')];const _0x3cfca5=_0x2ed673[a2_0x258b('0x32')][a2_0x258b('0x34')];const _0x2ea301=_0x2ed673[a2_0x258b('0x32')][a2_0x258b('0x35')];exports[a2_0x258b('0x3')][a2_0x258b('0xf')][a2_0x258b('0x2c')][a2_0x258b('0x2f')]({'attributes':[a2_0x258b('0x36'),[exports['sequelize']['fn'](a2_0x258b('0x37'),exports[a2_0x258b('0x3')][a2_0x258b('0x38')]('amount')),a2_0x258b('0x39')]],'where':{'countingDate':{[exports[a2_0x258b('0x3')]['Op'][a2_0x258b('0x3a')]]:_0x3cfca5,[exports[a2_0x258b('0x3')]['Op']['lt']]:_0x2ea301},'amount':_0x2ed673['params'][a2_0x258b('0x3b')]=='in'?{[exports[a2_0x258b('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x258b('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x258b('0x3')][a2_0x258b('0x3c')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x258b('0x36'),a2_0x258b('0x30')]]})[a2_0x258b('0x19')](_0x32d926=>{_0x41c056[a2_0x258b('0x13')]({'data':_0x32d926});});};exports['getPassCountingByHour']=(_0x2c2754,_0x11c130)=>{const _0x27358c=_0x2c2754[a2_0x258b('0x32')][a2_0x258b('0x33')];const _0x56c3bf=_0x2c2754[a2_0x258b('0x32')][a2_0x258b('0x34')];const _0x5081cf=_0x2c2754['query'][a2_0x258b('0x35')];exports[a2_0x258b('0x3')][a2_0x258b('0xf')][a2_0x258b('0x2c')]['findAll']({'attributes':[a2_0x258b('0x36'),[exports[a2_0x258b('0x3')]['fn'](a2_0x258b('0x3d'),exports[a2_0x258b('0x3')][a2_0x258b('0x38')](a2_0x258b('0x36')),a2_0x258b('0x3e')),a2_0x258b('0x3f')],[exports[a2_0x258b('0x3')]['fn'](a2_0x258b('0x37'),exports[a2_0x258b('0x3')][a2_0x258b('0x38')](a2_0x258b('0x40'))),a2_0x258b('0x39')]],'where':{'countingDate':{[exports[a2_0x258b('0x3')]['Op'][a2_0x258b('0x3a')]]:_0x56c3bf,[exports[a2_0x258b('0x3')]['Op']['lt']]:_0x5081cf},'amount':_0x2c2754['params'][a2_0x258b('0x3b')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x258b('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x258b('0x3')]['fn'](a2_0x258b('0x41'),exports[a2_0x258b('0x3')][a2_0x258b('0x38')](a2_0x258b('0x36'))),exports[a2_0x258b('0x3')]['fn'](a2_0x258b('0x42'),exports[a2_0x258b('0x3')]['col'](a2_0x258b('0x36'))),exports[a2_0x258b('0x3')]['fn'](a2_0x258b('0x43'),exports['sequelize'][a2_0x258b('0x38')](a2_0x258b('0x36'))),exports[a2_0x258b('0x3')]['fn']('YEAR',exports[a2_0x258b('0x3')][a2_0x258b('0x38')](a2_0x258b('0x36')))],'order':[[a2_0x258b('0x36'),'ASC']]})[a2_0x258b('0x19')](_0x45db88=>{_0x11c130[a2_0x258b('0x13')]({'data':_0x45db88});});};exports[a2_0x258b('0x44')]=(_0x3593dc,_0x41128b,_0x19e0d8)=>{const _0x4cf7fa=_0x3593dc[a2_0x258b('0x45')][a2_0x258b('0x46')]['find'](_0x4cf7fa=>_0x4cf7fa[a2_0x258b('0x47')]===a2_0x258b('0x48'));fbgraph_1['default']['setAccessToken'](_0x4cf7fa[a2_0x258b('0x49')]);fbgraph_1[a2_0x258b('0xb')][a2_0x258b('0x4a')](_0x3593dc[a2_0x258b('0x45')]['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x2121a0,_0x1f0e30)=>{if(_0x2121a0){return _0x19e0d8(_0x2121a0);}_0x41128b['render']('api/facebook',{'title':a2_0x258b('0x4b'),'profile':_0x1f0e30});});};