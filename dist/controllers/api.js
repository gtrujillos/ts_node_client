var a2_0x4832=['json','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','models','report_files','readFile','Data','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','month','query','startDate','endDate','sum','col','amount','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','DATE_FORMAT','countingDateShort','total','gte','direction','DAY','MONTH','YEAR','getFacebook','user','find','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','default','ready','log','list','colombia','Downloading:\x20','name','endsWith'];(function(_0x417d16,_0x4a5f0f){var _0x2d056f=function(_0x25076e){while(--_0x25076e){_0x417d16['push'](_0x417d16['shift']());}};_0x2d056f(++_0x4a5f0f);}(a2_0x4832,0x169));var a2_0x34c6=function(_0x27fab5,_0x38616a){_0x27fab5=_0x27fab5-0x0;var _0x35ab34=a2_0x4832[_0x27fab5];return _0x35ab34;};'use strict';var __importDefault=this&&this[a2_0x34c6('0x0')]||function(_0x3744e0){return _0x3744e0&&_0x3744e0[a2_0x34c6('0x1')]?_0x3744e0:{'default':_0x3744e0};};Object[a2_0x34c6('0x2')](exports,a2_0x34c6('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x34c6('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x34c6('0x4')]='';function setSequelize(_0x4f0f0e){exports[a2_0x34c6('0x4')]=_0x4f0f0e;}exports[a2_0x34c6('0x5')]=setSequelize;exports[a2_0x34c6('0x6')]=(_0x525728,_0x59962f)=>{_0x59962f[a2_0x34c6('0x7')](a2_0x34c6('0x8'),{'title':a2_0x34c6('0x9')});};exports[a2_0x34c6('0xa')]=(_0x161e6b,_0x3fbecf)=>{console['log']('connecting');const _0x3d42fb=[];const _0x49ac67=new ftp_1[(a2_0x34c6('0xb'))]();_0x49ac67['on'](a2_0x34c6('0xc'),function(){console[a2_0x34c6('0xd')]('connected');_0x49ac67[a2_0x34c6('0xe')](a2_0x34c6('0xf'),![],function(_0x21060d,_0x58529b){if(_0x21060d){}else{for(const _0x495a2c of _0x58529b){console[a2_0x34c6('0xd')](a2_0x34c6('0x10')+_0x495a2c[a2_0x34c6('0x11')]);if(_0x495a2c[a2_0x34c6('0x11')][a2_0x34c6('0x12')](a2_0x34c6('0x13'))){exports[a2_0x34c6('0x4')]['models']['report_files'][a2_0x34c6('0x14')]({'where':{'fileName':_0x495a2c['name']}})[a2_0x34c6('0x15')]((_0x40b7ac,_0x57c3c7)=>{if(_0x57c3c7){console[a2_0x34c6('0xd')](_0x495a2c[a2_0x34c6('0x11')]);_0x3d42fb['push'](_0x40b7ac);}});}}}_0x3fbecf[a2_0x34c6('0x13')]({'data':_0x3d42fb});});});_0x49ac67['on'](a2_0x34c6('0x16'),function(_0x2348f7){_0x3fbecf[a2_0x34c6('0x13')]({'message':_0x2348f7});});_0x49ac67[a2_0x34c6('0x17')]({'host':a2_0x34c6('0x18'),'port':0x15,'user':'ipd','password':a2_0x34c6('0x19')});};exports[a2_0x34c6('0x1a')]=(_0x58ebd9,_0x1a455)=>{exports['sequelize']['models']['report_files'][a2_0x34c6('0x1b')]({'where':{'status':null}})[a2_0x34c6('0x1c')](_0x1dbb4d=>{if(_0x1dbb4d){const _0x3de35b=new ftp_1[(a2_0x34c6('0xb'))]();_0x3de35b['on']('ready',function(){console['log'](a2_0x34c6('0x1d')+_0x1dbb4d[a2_0x34c6('0x1e')]);_0x3de35b[a2_0x34c6('0x1f')]('colombia/'+_0x1dbb4d[a2_0x34c6('0x1e')],function(_0x352f3e,_0x4e5208){_0x3de35b[a2_0x34c6('0x20')]();if(_0x352f3e){}else{const _0x48330d=a2_0x34c6('0x21')+_0x1dbb4d[a2_0x34c6('0x1e')]+a2_0x34c6('0x22');_0x4e5208[a2_0x34c6('0x23')](fs_1[a2_0x34c6('0xb')][a2_0x34c6('0x24')](_0x48330d));_0x1dbb4d[a2_0x34c6('0x25')]=0x1;_0x1dbb4d[a2_0x34c6('0x26')]();console[a2_0x34c6('0xd')](a2_0x34c6('0x27')+_0x1dbb4d[a2_0x34c6('0x1e')]);}});});_0x3de35b['on'](a2_0x34c6('0x16'),function(_0x1a2a0e){_0x1a455[a2_0x34c6('0x13')]({'message':_0x1a2a0e});});_0x3de35b[a2_0x34c6('0x17')]({'host':a2_0x34c6('0x18'),'port':0x15,'user':a2_0x34c6('0x19'),'password':a2_0x34c6('0x19')});_0x1a455[a2_0x34c6('0x13')]({'data':_0x1dbb4d[a2_0x34c6('0x1e')]});}else{_0x1a455[a2_0x34c6('0x13')]({'data':[]});}});};exports[a2_0x34c6('0x28')]=(_0x4ce9af,_0x242162)=>{exports[a2_0x34c6('0x4')][a2_0x34c6('0x29')][a2_0x34c6('0x2a')]['findOne']({'where':{'status':0x1}})[a2_0x34c6('0x1c')](_0x4e7d77=>{if(_0x4e7d77){const _0x2dbac8=a2_0x34c6('0x21')+_0x4e7d77[a2_0x34c6('0x1e')]+'.txt';fs_1[a2_0x34c6('0xb')][a2_0x34c6('0x2b')](_0x2dbac8,'utf8',function(_0x8fe5cb,_0x544b28){if(_0x8fe5cb){_0x4e7d77['status']=null;}else{try{const _0x47882f=JSON['parse'](_0x544b28);for(const _0x2f51c0 of _0x47882f[a2_0x34c6('0x2c')][0x0]['CountingInfo']){const _0x168194=_0x2f51c0['In'];const _0x42d96a=_0x2f51c0['Out'];const _0x2f67b2=Date['parse'](_0x2f51c0['EndTime']);if(_0x168194>0x0){exports[a2_0x34c6('0x4')][a2_0x34c6('0x29')][a2_0x34c6('0x2d')]['create']({'reportFileId':_0x4e7d77['id'],'amount':_0x168194,'countingDate':_0x2f67b2});}if(_0x42d96a>0x0){exports[a2_0x34c6('0x4')]['models']['pass_counting'][a2_0x34c6('0x2e')]({'reportFileId':_0x4e7d77['id'],'amount':_0x42d96a*-0x1,'countingDate':_0x2f67b2});}}_0x4e7d77[a2_0x34c6('0x25')]=0x2;}catch(_0x563ac0){_0x4e7d77['status']=null;}}_0x4e7d77[a2_0x34c6('0x26')]();});_0x242162[a2_0x34c6('0x13')]({'data':_0x4e7d77[a2_0x34c6('0x1e')]});}else{_0x242162[a2_0x34c6('0x13')]({'data':[]});}});};exports[a2_0x34c6('0x2f')]=(_0x386de7,_0x12cc53)=>{exports[a2_0x34c6('0x4')][a2_0x34c6('0x29')][a2_0x34c6('0x2d')][a2_0x34c6('0x30')]({'where':{'amount':{[exports[a2_0x34c6('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x34c6('0x31'),a2_0x34c6('0x32')]]})[a2_0x34c6('0x1c')](_0x581fdc=>{_0x12cc53['json']({'data':_0x581fdc});});};exports[a2_0x34c6('0x33')]=(_0x3687cb,_0xacf33c)=>{const _0xb6791=_0x3687cb['query'][a2_0x34c6('0x34')];const _0x393a60=_0x3687cb[a2_0x34c6('0x35')][a2_0x34c6('0x36')];const _0x40b167=_0x3687cb[a2_0x34c6('0x35')][a2_0x34c6('0x37')];exports[a2_0x34c6('0x4')][a2_0x34c6('0x29')][a2_0x34c6('0x2d')]['findAll']({'attributes':['countingDate',[exports['sequelize']['fn'](a2_0x34c6('0x38'),exports[a2_0x34c6('0x4')][a2_0x34c6('0x39')](a2_0x34c6('0x3a'))),'total']],'where':{'countingDate':{[exports[a2_0x34c6('0x4')]['Op']['gte']]:_0x393a60,[exports[a2_0x34c6('0x4')]['Op']['lt']]:_0x40b167},'amount':_0x3687cb[a2_0x34c6('0x3b')]['direction']=='in'?{[exports[a2_0x34c6('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x34c6('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x34c6('0x4')][a2_0x34c6('0x3c')](a2_0x34c6('0x3d'))],'order':[[a2_0x34c6('0x31'),a2_0x34c6('0x32')]]})[a2_0x34c6('0x1c')](_0x1303a3=>{_0xacf33c[a2_0x34c6('0x13')]({'data':_0x1303a3});});};exports['getPassCountingByHour']=(_0x1f73a0,_0x3d30eb)=>{const _0x2e08b4=_0x1f73a0[a2_0x34c6('0x35')][a2_0x34c6('0x34')];const _0x308918=_0x1f73a0[a2_0x34c6('0x35')][a2_0x34c6('0x36')];const _0xcc7edb=_0x1f73a0[a2_0x34c6('0x35')][a2_0x34c6('0x37')];exports['sequelize'][a2_0x34c6('0x29')][a2_0x34c6('0x2d')][a2_0x34c6('0x30')]({'attributes':[a2_0x34c6('0x31'),[exports[a2_0x34c6('0x4')]['fn'](a2_0x34c6('0x3e'),exports['sequelize'][a2_0x34c6('0x39')](a2_0x34c6('0x31')),'%Y-%m-%d\x20%H:00'),a2_0x34c6('0x3f')],[exports[a2_0x34c6('0x4')]['fn']('sum',exports[a2_0x34c6('0x4')]['col']('amount')),a2_0x34c6('0x40')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x34c6('0x41')]]:_0x308918,[exports[a2_0x34c6('0x4')]['Op']['lt']]:_0xcc7edb},'amount':_0x1f73a0[a2_0x34c6('0x3b')][a2_0x34c6('0x42')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x34c6('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x34c6('0x4')]['fn']('HOUR',exports[a2_0x34c6('0x4')][a2_0x34c6('0x39')](a2_0x34c6('0x31'))),exports[a2_0x34c6('0x4')]['fn'](a2_0x34c6('0x43'),exports[a2_0x34c6('0x4')][a2_0x34c6('0x39')](a2_0x34c6('0x31'))),exports[a2_0x34c6('0x4')]['fn'](a2_0x34c6('0x44'),exports[a2_0x34c6('0x4')]['col'](a2_0x34c6('0x31'))),exports[a2_0x34c6('0x4')]['fn'](a2_0x34c6('0x45'),exports[a2_0x34c6('0x4')]['col']('countingDate'))],'order':[[a2_0x34c6('0x31'),a2_0x34c6('0x32')]]})[a2_0x34c6('0x1c')](_0x36a67f=>{_0x3d30eb[a2_0x34c6('0x13')]({'data':_0x36a67f});});};exports[a2_0x34c6('0x46')]=(_0x4d7cdd,_0x4f02d3,_0x473613)=>{const _0x54d53d=_0x4d7cdd[a2_0x34c6('0x47')]['tokens'][a2_0x34c6('0x48')](_0x54d53d=>_0x54d53d['kind']===a2_0x34c6('0x49'));fbgraph_1[a2_0x34c6('0xb')]['setAccessToken'](_0x54d53d['accessToken']);fbgraph_1['default']['get'](_0x4d7cdd[a2_0x34c6('0x47')][a2_0x34c6('0x49')]+a2_0x34c6('0x4a'),(_0x13a7f0,_0x1e6fc1)=>{if(_0x13a7f0){return _0x473613(_0x13a7f0);}_0x4f02d3[a2_0x34c6('0x7')](a2_0x34c6('0x4b'),{'title':'Facebook\x20API','profile':_0x1e6fc1});});};