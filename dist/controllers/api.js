var a2_0x20a1=['query','month','startDate','sum','col','amount','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','endDate','DATE_FORMAT','countingDateShort','HOUR','DAY','YEAR','getFacebook','user','tokens','facebook','setAccessToken','api/facebook','defineProperty','__esModule','fbgraph','ftp','setSequelize','getApi','render','API\x20Examples','log','connecting','ready','connected','colombia','name','endsWith','models','report_files','findOrCreate','spread','json','error','ftp.vivotek.com','ipd','downloadFtp','sequelize','findOne','then','default','connected:','fileName','get','colombia/','end','media/','.txt','status','save','Downloaded:\x20','processFtp','readFile','parse','Data','Out','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay'];(function(_0x544860,_0x50601c){var _0x1436a0=function(_0x87b8fd){while(--_0x87b8fd){_0x544860['push'](_0x544860['shift']());}};_0x1436a0(++_0x50601c);}(a2_0x20a1,0xf5));var a2_0x4c81=function(_0x1ed4c5,_0x15f736){_0x1ed4c5=_0x1ed4c5-0x0;var _0x51e59b=a2_0x20a1[_0x1ed4c5];return _0x51e59b;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1b99a1){return _0x1b99a1&&_0x1b99a1['__esModule']?_0x1b99a1:{'default':_0x1b99a1};};Object[a2_0x4c81('0x0')](exports,a2_0x4c81('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x4c81('0x2')));const ftp_1=__importDefault(require(a2_0x4c81('0x3')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x30f57b){exports['sequelize']=_0x30f57b;}exports[a2_0x4c81('0x4')]=setSequelize;exports[a2_0x4c81('0x5')]=(_0x558aea,_0x2f9d6b)=>{_0x2f9d6b[a2_0x4c81('0x6')]('api/index',{'title':a2_0x4c81('0x7')});};exports['syncFtp']=(_0x698b39,_0x47d3e1)=>{console[a2_0x4c81('0x8')](a2_0x4c81('0x9'));const _0x2795ee=[];const _0x2523ba=new ftp_1['default']();_0x2523ba['on'](a2_0x4c81('0xa'),function(){console[a2_0x4c81('0x8')](a2_0x4c81('0xb'));_0x2523ba['list'](a2_0x4c81('0xc'),![],function(_0x25656d,_0x65d2c7){if(_0x25656d){}else{for(const _0xf9b468 of _0x65d2c7){console[a2_0x4c81('0x8')]('Downloading:\x20'+_0xf9b468['name']);if(_0xf9b468[a2_0x4c81('0xd')][a2_0x4c81('0xe')]('json')){exports['sequelize'][a2_0x4c81('0xf')][a2_0x4c81('0x10')][a2_0x4c81('0x11')]({'where':{'fileName':_0xf9b468[a2_0x4c81('0xd')]}})[a2_0x4c81('0x12')]((_0xafd21e,_0xf7e347)=>{if(_0xf7e347){console[a2_0x4c81('0x8')](_0xf9b468[a2_0x4c81('0xd')]);_0x2795ee['push'](_0xafd21e);}});}}}_0x47d3e1[a2_0x4c81('0x13')]({'data':_0x2795ee});});});_0x2523ba['on'](a2_0x4c81('0x14'),function(_0x5da1ff){_0x47d3e1['json']({'message':_0x5da1ff});});_0x2523ba['connect']({'host':a2_0x4c81('0x15'),'port':0x15,'user':a2_0x4c81('0x16'),'password':a2_0x4c81('0x16')});};exports[a2_0x4c81('0x17')]=(_0x3d8f5a,_0x2b5e23)=>{exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x10')][a2_0x4c81('0x19')]({'where':{'status':null}})[a2_0x4c81('0x1a')](_0x2d4bd1=>{if(_0x2d4bd1){const _0x214bef=new ftp_1[(a2_0x4c81('0x1b'))]();_0x214bef['on'](a2_0x4c81('0xa'),function(){console[a2_0x4c81('0x8')](a2_0x4c81('0x1c')+_0x2d4bd1[a2_0x4c81('0x1d')]);_0x214bef[a2_0x4c81('0x1e')](a2_0x4c81('0x1f')+_0x2d4bd1[a2_0x4c81('0x1d')],function(_0x285232,_0x5bf3d5){_0x214bef[a2_0x4c81('0x20')]();if(_0x285232){}else{const _0x4dad9b=a2_0x4c81('0x21')+_0x2d4bd1[a2_0x4c81('0x1d')]+a2_0x4c81('0x22');_0x5bf3d5['pipe'](fs_1['default']['createWriteStream'](_0x4dad9b));_0x2d4bd1[a2_0x4c81('0x23')]=0x1;_0x2d4bd1[a2_0x4c81('0x24')]();console[a2_0x4c81('0x8')](a2_0x4c81('0x25')+_0x2d4bd1[a2_0x4c81('0x1d')]);}});});_0x214bef['on'](a2_0x4c81('0x14'),function(_0x3f4d11){_0x2b5e23['json']({'message':_0x3f4d11});});_0x214bef['connect']({'host':a2_0x4c81('0x15'),'port':0x15,'user':'ipd','password':a2_0x4c81('0x16')});_0x2b5e23['json']({'data':_0x2d4bd1['fileName']});}else{_0x2b5e23['json']({'data':[]});}});};exports[a2_0x4c81('0x26')]=(_0x38300d,_0xd368a2)=>{exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x10')]['findOne']({'where':{'status':0x1}})[a2_0x4c81('0x1a')](_0x59d133=>{if(_0x59d133){const _0x5346be='media/'+_0x59d133[a2_0x4c81('0x1d')]+a2_0x4c81('0x22');fs_1[a2_0x4c81('0x1b')][a2_0x4c81('0x27')](_0x5346be,'utf8',function(_0x431b33,_0x4f6f3a){if(_0x431b33){_0x59d133[a2_0x4c81('0x23')]=null;}else{try{const _0x3c7513=JSON[a2_0x4c81('0x28')](_0x4f6f3a);for(const _0x1c2c5c of _0x3c7513[a2_0x4c81('0x29')][0x0]['CountingInfo']){const _0x51019e=_0x1c2c5c['In'];const _0x55cc6d=_0x1c2c5c[a2_0x4c81('0x2a')];const _0x36c360=Date[a2_0x4c81('0x28')](_0x1c2c5c[a2_0x4c81('0x2b')]);if(_0x51019e>0x0){exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x2c')][a2_0x4c81('0x2d')]({'reportFileId':_0x59d133['id'],'amount':_0x51019e,'countingDate':_0x36c360});}if(_0x55cc6d>0x0){exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x2c')]['create']({'reportFileId':_0x59d133['id'],'amount':_0x55cc6d*-0x1,'countingDate':_0x36c360});}}_0x59d133['status']=0x2;}catch(_0x5c8ecc){_0x59d133['status']=null;}}_0x59d133[a2_0x4c81('0x24')]();});_0xd368a2[a2_0x4c81('0x13')]({'data':_0x59d133[a2_0x4c81('0x1d')]});}else{_0xd368a2[a2_0x4c81('0x13')]({'data':[]});}});};exports[a2_0x4c81('0x2e')]=(_0x51aa36,_0x20c4b2)=>{exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x2c')][a2_0x4c81('0x2f')]({'where':{'amount':{[exports[a2_0x4c81('0x18')]['Op']['gt']]:0x0}},'order':[[a2_0x4c81('0x30'),a2_0x4c81('0x31')]]})[a2_0x4c81('0x1a')](_0xdce828=>{_0x20c4b2[a2_0x4c81('0x13')]({'data':_0xdce828});});};exports[a2_0x4c81('0x32')]=(_0x2d744e,_0x33b825)=>{const _0x112192=_0x2d744e[a2_0x4c81('0x33')][a2_0x4c81('0x34')];const _0x336b5e=_0x2d744e['query'][a2_0x4c81('0x35')];const _0x3267b2=_0x2d744e[a2_0x4c81('0x33')]['endDate'];exports['sequelize'][a2_0x4c81('0xf')]['pass_counting'][a2_0x4c81('0x2f')]({'attributes':['countingDate',[exports[a2_0x4c81('0x18')]['fn'](a2_0x4c81('0x36'),exports[a2_0x4c81('0x18')][a2_0x4c81('0x37')](a2_0x4c81('0x38'))),a2_0x4c81('0x39')]],'where':{'countingDate':{[exports[a2_0x4c81('0x18')]['Op'][a2_0x4c81('0x3a')]]:_0x336b5e,[exports[a2_0x4c81('0x18')]['Op']['lt']]:_0x3267b2},'amount':_0x2d744e[a2_0x4c81('0x3b')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x4c81('0x18')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4c81('0x18')][a2_0x4c81('0x3c')](a2_0x4c81('0x3d'))],'order':[[a2_0x4c81('0x30'),a2_0x4c81('0x31')]]})[a2_0x4c81('0x1a')](_0x122856=>{_0x33b825[a2_0x4c81('0x13')]({'data':_0x122856});});};exports['getPassCountingByHour']=(_0xbc3d7e,_0xe744af)=>{const _0x4f0d1a=_0xbc3d7e['query'][a2_0x4c81('0x34')];const _0x3e03fa=_0xbc3d7e[a2_0x4c81('0x33')][a2_0x4c81('0x35')];const _0x212f50=_0xbc3d7e['query'][a2_0x4c81('0x3e')];exports[a2_0x4c81('0x18')][a2_0x4c81('0xf')][a2_0x4c81('0x2c')][a2_0x4c81('0x2f')]({'attributes':[a2_0x4c81('0x30'),[exports['sequelize']['fn'](a2_0x4c81('0x3f'),exports[a2_0x4c81('0x18')][a2_0x4c81('0x37')]('countingDate'),'%Y-%m-%d\x20%H:00'),a2_0x4c81('0x40')],[exports[a2_0x4c81('0x18')]['fn'](a2_0x4c81('0x36'),exports[a2_0x4c81('0x18')][a2_0x4c81('0x37')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x4c81('0x18')]['Op']['gte']]:_0x3e03fa,[exports[a2_0x4c81('0x18')]['Op']['lt']]:_0x212f50},'amount':_0xbc3d7e[a2_0x4c81('0x3b')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x4c81('0x18')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4c81('0x18')]['fn'](a2_0x4c81('0x41'),exports[a2_0x4c81('0x18')]['col'](a2_0x4c81('0x30'))),exports[a2_0x4c81('0x18')]['fn'](a2_0x4c81('0x42'),exports['sequelize'][a2_0x4c81('0x37')](a2_0x4c81('0x30'))),exports['sequelize']['fn']('MONTH',exports[a2_0x4c81('0x18')][a2_0x4c81('0x37')](a2_0x4c81('0x30'))),exports[a2_0x4c81('0x18')]['fn'](a2_0x4c81('0x43'),exports['sequelize'][a2_0x4c81('0x37')]('countingDate'))],'order':[[a2_0x4c81('0x30'),a2_0x4c81('0x31')]]})[a2_0x4c81('0x1a')](_0x5e9a45=>{_0xe744af[a2_0x4c81('0x13')]({'data':_0x5e9a45});});};exports[a2_0x4c81('0x44')]=(_0x48030c,_0xb151db,_0xc4f07c)=>{const _0x30f687=_0x48030c[a2_0x4c81('0x45')][a2_0x4c81('0x46')]['find'](_0x30f687=>_0x30f687['kind']===a2_0x4c81('0x47'));fbgraph_1[a2_0x4c81('0x1b')][a2_0x4c81('0x48')](_0x30f687['accessToken']);fbgraph_1[a2_0x4c81('0x1b')][a2_0x4c81('0x1e')](_0x48030c[a2_0x4c81('0x45')][a2_0x4c81('0x47')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x2028e9,_0xf11e07)=>{if(_0x2028e9){return _0xc4f07c(_0x2028e9);}_0xb151db[a2_0x4c81('0x6')](a2_0x4c81('0x49'),{'title':'Facebook\x20API','profile':_0xf11e07});});};