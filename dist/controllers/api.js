var a2_0x4b66=['Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','setSequelize','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','list','colombia','name','endsWith','json','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','sequelize','models','findOne','connected:','fileName','get','colombia/','end','media/','pipe','createWriteStream','Downloaded:\x20','processFtp','then','.txt','utf8','status','parse','Data','EndTime','pass_counting','create','countingDate','ASC','query','month','startDate','endDate','findAll','sum','col','amount','total','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','gte','params','DAY','YEAR','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook'];(function(_0x4a8acc,_0x4088db){var _0x4739e6=function(_0x142b6d){while(--_0x142b6d){_0x4a8acc['push'](_0x4a8acc['shift']());}};_0x4739e6(++_0x4088db);}(a2_0x4b66,0x141));var a2_0x1df4=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a2_0x4b66[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a2_0x1df4('0x0')]||function(_0x4a0afb){return _0x4a0afb&&_0x4a0afb['__esModule']?_0x4a0afb:{'default':_0x4a0afb};};Object[a2_0x1df4('0x1')](exports,a2_0x1df4('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1df4('0x3')));const ftp_1=__importDefault(require(a2_0x1df4('0x4')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x114b10){exports['sequelize']=_0x114b10;}exports[a2_0x1df4('0x5')]=setSequelize;exports[a2_0x1df4('0x6')]=(_0x3290a5,_0x46da33)=>{_0x46da33[a2_0x1df4('0x7')]('api/index',{'title':a2_0x1df4('0x8')});};exports[a2_0x1df4('0x9')]=(_0x1271a9,_0x219511)=>{console[a2_0x1df4('0xa')](a2_0x1df4('0xb'));const _0x5b8c81=[];const _0x1fd101=new ftp_1[(a2_0x1df4('0xc'))]();_0x1fd101['on'](a2_0x1df4('0xd'),function(){console[a2_0x1df4('0xa')]('connected');_0x1fd101[a2_0x1df4('0xe')](a2_0x1df4('0xf'),![],function(_0x4a7397,_0x2a011d){if(_0x4a7397){}else{for(const _0x4ba0a2 of _0x2a011d){console[a2_0x1df4('0xa')]('Downloading:\x20'+_0x4ba0a2[a2_0x1df4('0x10')]);if(_0x4ba0a2[a2_0x1df4('0x10')][a2_0x1df4('0x11')](a2_0x1df4('0x12'))){exports['sequelize']['models'][a2_0x1df4('0x13')][a2_0x1df4('0x14')]({'where':{'fileName':_0x4ba0a2[a2_0x1df4('0x10')]}})[a2_0x1df4('0x15')]((_0x285dac,_0x59a59b)=>{if(_0x59a59b){console['log'](_0x4ba0a2[a2_0x1df4('0x10')]);_0x5b8c81[a2_0x1df4('0x16')](_0x285dac);}});}}}_0x219511[a2_0x1df4('0x12')]({'data':_0x5b8c81});});});_0x1fd101['on'](a2_0x1df4('0x17'),function(_0x293ca6){_0x219511[a2_0x1df4('0x12')]({'message':_0x293ca6});});_0x1fd101[a2_0x1df4('0x18')]({'host':a2_0x1df4('0x19'),'port':0x15,'user':a2_0x1df4('0x1a'),'password':a2_0x1df4('0x1a')});};exports[a2_0x1df4('0x1b')]=(_0x2b4d13,_0x26bf7b)=>{exports[a2_0x1df4('0x1c')][a2_0x1df4('0x1d')]['report_files'][a2_0x1df4('0x1e')]({'where':{'status':null}})['then'](_0x278a28=>{if(_0x278a28){const _0x474c80=new ftp_1[(a2_0x1df4('0xc'))]();_0x474c80['on']('ready',function(){console[a2_0x1df4('0xa')](a2_0x1df4('0x1f')+_0x278a28[a2_0x1df4('0x20')]);_0x474c80[a2_0x1df4('0x21')](a2_0x1df4('0x22')+_0x278a28[a2_0x1df4('0x20')],function(_0x531609,_0x35e712){_0x474c80[a2_0x1df4('0x23')]();if(_0x531609){}else{const _0x8ffe13=a2_0x1df4('0x24')+_0x278a28[a2_0x1df4('0x20')]+'.txt';_0x35e712[a2_0x1df4('0x25')](fs_1[a2_0x1df4('0xc')][a2_0x1df4('0x26')](_0x8ffe13));_0x278a28['status']=0x1;_0x278a28['save']();console[a2_0x1df4('0xa')](a2_0x1df4('0x27')+_0x278a28[a2_0x1df4('0x20')]);}});});_0x474c80['on'](a2_0x1df4('0x17'),function(_0x591aff){_0x26bf7b[a2_0x1df4('0x12')]({'message':_0x591aff});});_0x474c80[a2_0x1df4('0x18')]({'host':a2_0x1df4('0x19'),'port':0x15,'user':a2_0x1df4('0x1a'),'password':a2_0x1df4('0x1a')});_0x26bf7b[a2_0x1df4('0x12')]({'data':_0x278a28[a2_0x1df4('0x20')]});}else{_0x26bf7b['json']({'data':[]});}});};exports[a2_0x1df4('0x28')]=(_0x2051be,_0x36f37c)=>{exports[a2_0x1df4('0x1c')]['models'][a2_0x1df4('0x13')]['findOne']({'where':{'status':0x1}})[a2_0x1df4('0x29')](_0x42f980=>{if(_0x42f980){const _0x15466b='media/'+_0x42f980[a2_0x1df4('0x20')]+a2_0x1df4('0x2a');fs_1[a2_0x1df4('0xc')]['readFile'](_0x15466b,a2_0x1df4('0x2b'),function(_0x32d95c,_0x42e2a5){if(_0x32d95c){_0x42f980[a2_0x1df4('0x2c')]=null;}else{try{const _0x59d858=JSON[a2_0x1df4('0x2d')](_0x42e2a5);for(const _0x4072ff of _0x59d858[a2_0x1df4('0x2e')][0x0]['CountingInfo']){const _0x52dd8b=_0x4072ff['In'];const _0x359cab=_0x4072ff['Out'];const _0x39c0ed=Date['parse'](_0x4072ff[a2_0x1df4('0x2f')]);if(_0x52dd8b>0x0){exports[a2_0x1df4('0x1c')]['models'][a2_0x1df4('0x30')][a2_0x1df4('0x31')]({'reportFileId':_0x42f980['id'],'amount':_0x52dd8b,'countingDate':_0x39c0ed});}if(_0x359cab>0x0){exports['sequelize'][a2_0x1df4('0x1d')][a2_0x1df4('0x30')][a2_0x1df4('0x31')]({'reportFileId':_0x42f980['id'],'amount':_0x359cab*-0x1,'countingDate':_0x39c0ed});}}_0x42f980[a2_0x1df4('0x2c')]=0x2;}catch(_0x2d6ed7){_0x42f980[a2_0x1df4('0x2c')]=null;}}_0x42f980['save']();});_0x36f37c[a2_0x1df4('0x12')]({'data':_0x42f980['fileName']});}else{_0x36f37c[a2_0x1df4('0x12')]({'data':[]});}});};exports['getPassCounting']=(_0x3781f3,_0x59f686)=>{exports[a2_0x1df4('0x1c')]['models'][a2_0x1df4('0x30')]['findAll']({'where':{'amount':{[exports[a2_0x1df4('0x1c')]['Op']['gt']]:0x0}},'order':[[a2_0x1df4('0x32'),a2_0x1df4('0x33')]]})[a2_0x1df4('0x29')](_0x470aff=>{_0x59f686['json']({'data':_0x470aff});});};exports['getPassCountingByDay']=(_0x6f428d,_0x7f69fc)=>{const _0x409700=_0x6f428d[a2_0x1df4('0x34')][a2_0x1df4('0x35')];const _0x316238=_0x6f428d['query'][a2_0x1df4('0x36')];const _0x1a080d=_0x6f428d['query'][a2_0x1df4('0x37')];exports[a2_0x1df4('0x1c')][a2_0x1df4('0x1d')][a2_0x1df4('0x30')][a2_0x1df4('0x38')]({'attributes':[a2_0x1df4('0x32'),[exports[a2_0x1df4('0x1c')]['fn'](a2_0x1df4('0x39'),exports[a2_0x1df4('0x1c')][a2_0x1df4('0x3a')](a2_0x1df4('0x3b'))),a2_0x1df4('0x3c')]],'where':{'countingDate':{[exports[a2_0x1df4('0x1c')]['Op']['gte']]:_0x316238,[exports['sequelize']['Op']['lt']]:_0x1a080d},'amount':_0x6f428d['params'][a2_0x1df4('0x3d')]=='in'?{[exports[a2_0x1df4('0x1c')]['Op']['gt']]:0x0}:{[exports[a2_0x1df4('0x1c')]['Op']['lt']]:0x0}},'group':[exports[a2_0x1df4('0x1c')][a2_0x1df4('0x3e')](a2_0x1df4('0x3f'))],'order':[['countingDate',a2_0x1df4('0x33')]]})[a2_0x1df4('0x29')](_0xc59393=>{_0x7f69fc['json']({'data':_0xc59393});});};exports['getPassCountingByHour']=(_0x4ac61a,_0x4f8440)=>{const _0x181787=_0x4ac61a[a2_0x1df4('0x34')][a2_0x1df4('0x35')];const _0xd851d=_0x4ac61a['query'][a2_0x1df4('0x36')];const _0x532d5f=_0x4ac61a[a2_0x1df4('0x34')][a2_0x1df4('0x37')];exports['sequelize'][a2_0x1df4('0x1d')]['pass_counting'][a2_0x1df4('0x38')]({'attributes':[a2_0x1df4('0x32'),[exports[a2_0x1df4('0x1c')]['fn'](a2_0x1df4('0x40'),exports[a2_0x1df4('0x1c')][a2_0x1df4('0x3a')](a2_0x1df4('0x32')),a2_0x1df4('0x41')),a2_0x1df4('0x42')],[exports['sequelize']['fn']('sum',exports[a2_0x1df4('0x1c')]['col']('amount')),'total']],'where':{'countingDate':{[exports[a2_0x1df4('0x1c')]['Op'][a2_0x1df4('0x43')]]:_0xd851d,[exports[a2_0x1df4('0x1c')]['Op']['lt']]:_0x532d5f},'amount':_0x4ac61a[a2_0x1df4('0x44')]['direction']=='in'?{[exports[a2_0x1df4('0x1c')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x1df4('0x1c')]['fn']('HOUR',exports[a2_0x1df4('0x1c')][a2_0x1df4('0x3a')](a2_0x1df4('0x32'))),exports[a2_0x1df4('0x1c')]['fn'](a2_0x1df4('0x45'),exports['sequelize'][a2_0x1df4('0x3a')](a2_0x1df4('0x32'))),exports['sequelize']['fn']('MONTH',exports[a2_0x1df4('0x1c')]['col'](a2_0x1df4('0x32'))),exports[a2_0x1df4('0x1c')]['fn'](a2_0x1df4('0x46'),exports[a2_0x1df4('0x1c')][a2_0x1df4('0x3a')](a2_0x1df4('0x32')))],'order':[[a2_0x1df4('0x32'),a2_0x1df4('0x33')]]})[a2_0x1df4('0x29')](_0x1e72b0=>{_0x4f8440[a2_0x1df4('0x12')]({'data':_0x1e72b0});});};exports['getFacebook']=(_0x22919a,_0x57547e,_0x5021f4)=>{const _0x5175f8=_0x22919a['user'][a2_0x1df4('0x47')][a2_0x1df4('0x48')](_0x5175f8=>_0x5175f8[a2_0x1df4('0x49')]===a2_0x1df4('0x4a'));fbgraph_1[a2_0x1df4('0xc')][a2_0x1df4('0x4b')](_0x5175f8[a2_0x1df4('0x4c')]);fbgraph_1[a2_0x1df4('0xc')][a2_0x1df4('0x21')](_0x22919a['user'][a2_0x1df4('0x4a')]+a2_0x1df4('0x4d'),(_0x5771e5,_0x245797)=>{if(_0x5771e5){return _0x5021f4(_0x5771e5);}_0x57547e[a2_0x1df4('0x7')](a2_0x1df4('0x4e'),{'title':a2_0x1df4('0x4f'),'profile':_0x245797});});};