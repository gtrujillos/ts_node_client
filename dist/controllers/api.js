var a2_0x1c7f=['api/index','syncFtp','log','connected','Downloading:\x20','name','endsWith','json','models','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','ready','connected:','fileName','get','end','media/','.txt','default','createWriteStream','status','save','Downloaded:\x20','processFtp','report_files','readFile','parse','Data','CountingInfo','Out','EndTime','pass_counting','findAll','countingDate','ASC','getPassCountingByDay','month','startDate','query','endDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','HOUR','DAY','MONTH','user','tokens','find','kind','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','sequelize','setSequelize'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a2_0x1c7f,0x132));var a2_0x4743=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a2_0x1c7f[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a2_0x4743('0x0')]||function(_0x213367){return _0x213367&&_0x213367['__esModule']?_0x213367:{'default':_0x213367};};Object[a2_0x4743('0x1')](exports,a2_0x4743('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x4743('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x4743('0x4')]='';function setSequelize(_0xbf0ae7){exports['sequelize']=_0xbf0ae7;}exports[a2_0x4743('0x5')]=setSequelize;exports['getApi']=(_0x1625fa,_0xe58af3)=>{_0xe58af3['render'](a2_0x4743('0x6'),{'title':'API\x20Examples'});};exports[a2_0x4743('0x7')]=(_0x2b088,_0x29576c)=>{console[a2_0x4743('0x8')]('connecting');const _0x28c08d=[];const _0x482dba=new ftp_1['default']();_0x482dba['on']('ready',function(){console[a2_0x4743('0x8')](a2_0x4743('0x9'));_0x482dba['list']('colombia',![],function(_0x395ba9,_0x2a0306){if(_0x395ba9){}else{for(const _0x5850a7 of _0x2a0306){console[a2_0x4743('0x8')](a2_0x4743('0xa')+_0x5850a7[a2_0x4743('0xb')]);if(_0x5850a7[a2_0x4743('0xb')][a2_0x4743('0xc')](a2_0x4743('0xd'))){exports[a2_0x4743('0x4')][a2_0x4743('0xe')]['report_files'][a2_0x4743('0xf')]({'where':{'fileName':_0x5850a7[a2_0x4743('0xb')]}})['spread']((_0xe333c9,_0x23bfaf)=>{if(_0x23bfaf){console[a2_0x4743('0x8')](_0x5850a7[a2_0x4743('0xb')]);_0x28c08d[a2_0x4743('0x10')](_0xe333c9);}});}}}_0x29576c[a2_0x4743('0xd')]({'data':_0x28c08d});});});_0x482dba['on'](a2_0x4743('0x11'),function(_0x5245cf){_0x29576c[a2_0x4743('0xd')]({'message':_0x5245cf});});_0x482dba[a2_0x4743('0x12')]({'host':a2_0x4743('0x13'),'port':0x15,'user':a2_0x4743('0x14'),'password':a2_0x4743('0x14')});};exports[a2_0x4743('0x15')]=(_0x1a1ccc,_0xf10dfb)=>{exports['sequelize'][a2_0x4743('0xe')]['report_files'][a2_0x4743('0x16')]({'where':{'status':null}})[a2_0x4743('0x17')](_0x89be58=>{if(_0x89be58){const _0x49aa27=new ftp_1['default']();_0x49aa27['on'](a2_0x4743('0x18'),function(){console[a2_0x4743('0x8')](a2_0x4743('0x19')+_0x89be58[a2_0x4743('0x1a')]);_0x49aa27[a2_0x4743('0x1b')]('colombia/'+_0x89be58[a2_0x4743('0x1a')],function(_0x34aafd,_0x1ca15f){_0x49aa27[a2_0x4743('0x1c')]();if(_0x34aafd){}else{const _0x51a021=a2_0x4743('0x1d')+_0x89be58[a2_0x4743('0x1a')]+a2_0x4743('0x1e');_0x1ca15f['pipe'](fs_1[a2_0x4743('0x1f')][a2_0x4743('0x20')](_0x51a021));_0x89be58[a2_0x4743('0x21')]=0x1;_0x89be58[a2_0x4743('0x22')]();console['log'](a2_0x4743('0x23')+_0x89be58[a2_0x4743('0x1a')]);}});});_0x49aa27['on'](a2_0x4743('0x11'),function(_0x175960){_0xf10dfb[a2_0x4743('0xd')]({'message':_0x175960});});_0x49aa27[a2_0x4743('0x12')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a2_0x4743('0x14')});_0xf10dfb[a2_0x4743('0xd')]({'data':_0x89be58[a2_0x4743('0x1a')]});}else{_0xf10dfb[a2_0x4743('0xd')]({'data':[]});}});};exports[a2_0x4743('0x24')]=(_0x2a8371,_0x22ceec)=>{exports[a2_0x4743('0x4')][a2_0x4743('0xe')][a2_0x4743('0x25')]['findOne']({'where':{'status':0x1}})[a2_0x4743('0x17')](_0x6d26cb=>{if(_0x6d26cb){const _0x4dd0fb=a2_0x4743('0x1d')+_0x6d26cb[a2_0x4743('0x1a')]+'.txt';fs_1[a2_0x4743('0x1f')][a2_0x4743('0x26')](_0x4dd0fb,'utf8',function(_0x3094c8,_0x1f2934){if(_0x3094c8){_0x6d26cb['status']=null;}else{try{const _0x96bd62=JSON[a2_0x4743('0x27')](_0x1f2934);for(const _0x3c2dba of _0x96bd62[a2_0x4743('0x28')][0x0][a2_0x4743('0x29')]){const _0x48ad7c=_0x3c2dba['In'];const _0x3d3b14=_0x3c2dba[a2_0x4743('0x2a')];const _0x35e7db=Date[a2_0x4743('0x27')](_0x3c2dba[a2_0x4743('0x2b')]);if(_0x48ad7c>0x0){exports[a2_0x4743('0x4')][a2_0x4743('0xe')]['pass_counting']['create']({'reportFileId':_0x6d26cb['id'],'amount':_0x48ad7c,'countingDate':_0x35e7db});}if(_0x3d3b14>0x0){exports[a2_0x4743('0x4')]['models'][a2_0x4743('0x2c')]['create']({'reportFileId':_0x6d26cb['id'],'amount':_0x3d3b14*-0x1,'countingDate':_0x35e7db});}}_0x6d26cb['status']=0x2;}catch(_0x543ac5){_0x6d26cb[a2_0x4743('0x21')]=null;}}_0x6d26cb[a2_0x4743('0x22')]();});_0x22ceec[a2_0x4743('0xd')]({'data':_0x6d26cb['fileName']});}else{_0x22ceec[a2_0x4743('0xd')]({'data':[]});}});};exports['getPassCounting']=(_0x585ab5,_0x4b3c15)=>{exports[a2_0x4743('0x4')][a2_0x4743('0xe')][a2_0x4743('0x2c')][a2_0x4743('0x2d')]({'where':{'amount':{[exports[a2_0x4743('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x4743('0x2e'),a2_0x4743('0x2f')]]})[a2_0x4743('0x17')](_0xd6e419=>{_0x4b3c15[a2_0x4743('0xd')]({'data':_0xd6e419});});};exports[a2_0x4743('0x30')]=(_0x2ac868,_0x935115)=>{const _0x5bb300=_0x2ac868['query'][a2_0x4743('0x31')];const _0x1a44fb=_0x2ac868['query'][a2_0x4743('0x32')];const _0x18b4c1=_0x2ac868[a2_0x4743('0x33')][a2_0x4743('0x34')];exports[a2_0x4743('0x4')][a2_0x4743('0xe')][a2_0x4743('0x2c')]['findAll']({'attributes':[a2_0x4743('0x2e'),[exports[a2_0x4743('0x4')]['fn'](a2_0x4743('0x35'),exports['sequelize'][a2_0x4743('0x36')](a2_0x4743('0x37'))),a2_0x4743('0x38')]],'where':{'countingDate':{[exports[a2_0x4743('0x4')]['Op'][a2_0x4743('0x39')]]:_0x1a44fb,[exports[a2_0x4743('0x4')]['Op']['lt']]:_0x18b4c1},'amount':_0x2ac868[a2_0x4743('0x3a')][a2_0x4743('0x3b')]=='in'?{[exports[a2_0x4743('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x4743('0x4')][a2_0x4743('0x3c')](a2_0x4743('0x3d'))],'order':[[a2_0x4743('0x2e'),a2_0x4743('0x2f')]]})[a2_0x4743('0x17')](_0x327dde=>{_0x935115['json']({'data':_0x327dde});});};exports[a2_0x4743('0x3e')]=(_0x33a13e,_0x3f76e8)=>{const _0x2aaecb=_0x33a13e[a2_0x4743('0x33')]['month'];const _0x46a06f=_0x33a13e[a2_0x4743('0x33')][a2_0x4743('0x32')];const _0xaa6da6=_0x33a13e[a2_0x4743('0x33')][a2_0x4743('0x34')];exports['sequelize']['models']['pass_counting']['findAll']({'attributes':[a2_0x4743('0x2e'),[exports['sequelize']['fn'](a2_0x4743('0x3f'),exports[a2_0x4743('0x4')][a2_0x4743('0x36')](a2_0x4743('0x2e')),a2_0x4743('0x40')),'countingDateShort'],[exports[a2_0x4743('0x4')]['fn']('sum',exports[a2_0x4743('0x4')]['col'](a2_0x4743('0x37'))),'total']],'where':{'countingDate':{[exports[a2_0x4743('0x4')]['Op'][a2_0x4743('0x39')]]:_0x46a06f,[exports['sequelize']['Op']['lt']]:_0xaa6da6},'amount':_0x33a13e[a2_0x4743('0x3a')]['direction']=='in'?{[exports[a2_0x4743('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x4743('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4743('0x4')]['fn'](a2_0x4743('0x41'),exports[a2_0x4743('0x4')][a2_0x4743('0x36')](a2_0x4743('0x2e'))),exports[a2_0x4743('0x4')]['fn'](a2_0x4743('0x42'),exports['sequelize']['col'](a2_0x4743('0x2e'))),exports[a2_0x4743('0x4')]['fn'](a2_0x4743('0x43'),exports[a2_0x4743('0x4')]['col']('countingDate')),exports[a2_0x4743('0x4')]['fn']('YEAR',exports[a2_0x4743('0x4')][a2_0x4743('0x36')](a2_0x4743('0x2e')))],'order':[[a2_0x4743('0x2e'),a2_0x4743('0x2f')]]})[a2_0x4743('0x17')](_0x4583ba=>{_0x3f76e8[a2_0x4743('0xd')]({'data':_0x4583ba});});};exports['getFacebook']=(_0x5ad307,_0x23d123,_0xeef7cb)=>{const _0x6edd9b=_0x5ad307[a2_0x4743('0x44')][a2_0x4743('0x45')][a2_0x4743('0x46')](_0x6edd9b=>_0x6edd9b[a2_0x4743('0x47')]===a2_0x4743('0x48'));fbgraph_1[a2_0x4743('0x1f')][a2_0x4743('0x49')](_0x6edd9b['accessToken']);fbgraph_1['default'][a2_0x4743('0x1b')](_0x5ad307[a2_0x4743('0x44')]['facebook']+a2_0x4743('0x4a'),(_0x3c9948,_0x4f9cfa)=>{if(_0x3c9948){return _0xeef7cb(_0x3c9948);}_0x23d123[a2_0x4743('0x4b')](a2_0x4743('0x4c'),{'title':a2_0x4743('0x4d'),'profile':_0x4f9cfa});});};