var a2_0x35bc=['processFtp','readFile','parse','EndTime','pass_counting','create','save','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','sum','col','total','gte','direction','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','kind','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','render','api/index','API\x20Examples','syncFtp','default','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','report_files','spread','push','connect','ftp.vivotek.com','downloadFtp','models','findOne','then','ready','connected:','fileName','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','error','ipd'];(function(_0x1e7192,_0x2bf367){var _0x46c20b=function(_0x4cfac7){while(--_0x4cfac7){_0x1e7192['push'](_0x1e7192['shift']());}};_0x46c20b(++_0x2bf367);}(a2_0x35bc,0xc1));var a2_0xa016=function(_0x5e59ad,_0x6a7bc7){_0x5e59ad=_0x5e59ad-0x0;var _0x4c5750=a2_0x35bc[_0x5e59ad];return _0x4c5750;};'use strict';var __importDefault=this&&this[a2_0xa016('0x0')]||function(_0x23acaa){return _0x23acaa&&_0x23acaa[a2_0xa016('0x1')]?_0x23acaa:{'default':_0x23acaa};};Object[a2_0xa016('0x2')](exports,a2_0xa016('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0xa016('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0xa016('0x4')]='';function setSequelize(_0x59810f){exports[a2_0xa016('0x4')]=_0x59810f;}exports[a2_0xa016('0x5')]=setSequelize;exports['getApi']=(_0x113a7a,_0x488497)=>{_0x488497[a2_0xa016('0x6')](a2_0xa016('0x7'),{'title':a2_0xa016('0x8')});};exports[a2_0xa016('0x9')]=(_0x545aac,_0x4d1bba)=>{console['log']('connecting');const _0x3bce00=[];const _0x362b24=new ftp_1[(a2_0xa016('0xa'))]();_0x362b24['on']('ready',function(){console[a2_0xa016('0xb')](a2_0xa016('0xc'));_0x362b24[a2_0xa016('0xd')](a2_0xa016('0xe'),![],function(_0xd8418f,_0x4a7f90){if(_0xd8418f){}else{for(const _0x36ef1a of _0x4a7f90){console['log'](a2_0xa016('0xf')+_0x36ef1a[a2_0xa016('0x10')]);if(_0x36ef1a[a2_0xa016('0x10')][a2_0xa016('0x11')](a2_0xa016('0x12'))){exports[a2_0xa016('0x4')]['models'][a2_0xa016('0x13')]['findOrCreate']({'where':{'fileName':_0x36ef1a[a2_0xa016('0x10')]}})[a2_0xa016('0x14')]((_0x37e8e1,_0x14606b)=>{if(_0x14606b){console[a2_0xa016('0xb')](_0x36ef1a[a2_0xa016('0x10')]);_0x3bce00[a2_0xa016('0x15')](_0x37e8e1);}});}}}_0x4d1bba['json']({'data':_0x3bce00});});});_0x362b24['on']('error',function(_0x8b2390){_0x4d1bba[a2_0xa016('0x12')]({'message':_0x8b2390});});_0x362b24[a2_0xa016('0x16')]({'host':a2_0xa016('0x17'),'port':0x15,'user':'ipd','password':'ipd'});};exports[a2_0xa016('0x18')]=(_0xc7277e,_0x2b2c57)=>{exports[a2_0xa016('0x4')][a2_0xa016('0x19')][a2_0xa016('0x13')][a2_0xa016('0x1a')]({'where':{'status':null}})[a2_0xa016('0x1b')](_0x4670b5=>{if(_0x4670b5){const _0x4c1e84=new ftp_1['default']();_0x4c1e84['on'](a2_0xa016('0x1c'),function(){console[a2_0xa016('0xb')](a2_0xa016('0x1d')+_0x4670b5[a2_0xa016('0x1e')]);_0x4c1e84[a2_0xa016('0x1f')](a2_0xa016('0x20')+_0x4670b5[a2_0xa016('0x1e')],function(_0x2a746d,_0x456051){_0x4c1e84[a2_0xa016('0x21')]();if(_0x2a746d){}else{const _0x34bd6a=a2_0xa016('0x22')+_0x4670b5[a2_0xa016('0x1e')]+a2_0xa016('0x23');_0x456051[a2_0xa016('0x24')](fs_1[a2_0xa016('0xa')][a2_0xa016('0x25')](_0x34bd6a));_0x4670b5[a2_0xa016('0x26')]=0x1;_0x4670b5['save']();console[a2_0xa016('0xb')]('Downloaded:\x20'+_0x4670b5[a2_0xa016('0x1e')]);}});});_0x4c1e84['on'](a2_0xa016('0x27'),function(_0x3b6eb8){_0x2b2c57['json']({'message':_0x3b6eb8});});_0x4c1e84[a2_0xa016('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0xa016('0x28'),'password':a2_0xa016('0x28')});_0x2b2c57[a2_0xa016('0x12')]({'data':_0x4670b5[a2_0xa016('0x1e')]});}else{_0x2b2c57['json']({'data':[]});}});};exports[a2_0xa016('0x29')]=(_0x69bb17,_0x20245c)=>{exports[a2_0xa016('0x4')]['models'][a2_0xa016('0x13')][a2_0xa016('0x1a')]({'where':{'status':0x1}})[a2_0xa016('0x1b')](_0x369b88=>{if(_0x369b88){const _0xe54b9f=a2_0xa016('0x22')+_0x369b88['fileName']+a2_0xa016('0x23');fs_1[a2_0xa016('0xa')][a2_0xa016('0x2a')](_0xe54b9f,'utf8',function(_0x176a33,_0x32748e){if(_0x176a33){_0x369b88[a2_0xa016('0x26')]=null;}else{try{const _0x3430bf=JSON[a2_0xa016('0x2b')](_0x32748e);for(const _0x1d612b of _0x3430bf['Data'][0x0]['CountingInfo']){const _0x26be8e=_0x1d612b['In'];const _0x305126=_0x1d612b['Out'];const _0x36649d=Date[a2_0xa016('0x2b')](_0x1d612b[a2_0xa016('0x2c')]);if(_0x26be8e>0x0){exports[a2_0xa016('0x4')]['models'][a2_0xa016('0x2d')][a2_0xa016('0x2e')]({'reportFileId':_0x369b88['id'],'amount':_0x26be8e,'countingDate':_0x36649d});}if(_0x305126>0x0){exports[a2_0xa016('0x4')][a2_0xa016('0x19')][a2_0xa016('0x2d')][a2_0xa016('0x2e')]({'reportFileId':_0x369b88['id'],'amount':_0x305126*-0x1,'countingDate':_0x36649d});}}_0x369b88[a2_0xa016('0x26')]=0x2;}catch(_0x21df80){_0x369b88['status']=null;}}_0x369b88[a2_0xa016('0x2f')]();});_0x20245c[a2_0xa016('0x12')]({'data':_0x369b88[a2_0xa016('0x1e')]});}else{_0x20245c[a2_0xa016('0x12')]({'data':[]});}});};exports[a2_0xa016('0x30')]=(_0x18a9db,_0x41ca8c)=>{exports['sequelize'][a2_0xa016('0x19')][a2_0xa016('0x2d')][a2_0xa016('0x31')]({'where':{'amount':{[exports[a2_0xa016('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0xa016('0x32'),a2_0xa016('0x33')]]})[a2_0xa016('0x1b')](_0x4cc9ba=>{_0x41ca8c['json']({'data':_0x4cc9ba});});};exports[a2_0xa016('0x34')]=(_0x2f8897,_0x2f3f2e)=>{const _0x4b3978=_0x2f8897[a2_0xa016('0x35')]['month'];const _0x3b5cb8=_0x2f8897[a2_0xa016('0x35')][a2_0xa016('0x36')];const _0x3b8dab=_0x2f8897[a2_0xa016('0x35')][a2_0xa016('0x37')];exports[a2_0xa016('0x4')][a2_0xa016('0x19')]['pass_counting'][a2_0xa016('0x31')]({'attributes':[a2_0xa016('0x32'),[exports['sequelize']['fn'](a2_0xa016('0x38'),exports[a2_0xa016('0x4')][a2_0xa016('0x39')]('amount')),a2_0xa016('0x3a')]],'where':{'countingDate':{[exports[a2_0xa016('0x4')]['Op'][a2_0xa016('0x3b')]]:_0x3b5cb8,[exports[a2_0xa016('0x4')]['Op']['lt']]:_0x3b8dab},'amount':_0x2f8897['params'][a2_0xa016('0x3c')]=='in'?{[exports[a2_0xa016('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0xa016('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0xa016('0x4')]['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0xa016('0x32'),a2_0xa016('0x33')]]})[a2_0xa016('0x1b')](_0x561b3b=>{_0x2f3f2e[a2_0xa016('0x12')]({'data':_0x561b3b});});};exports[a2_0xa016('0x3d')]=(_0x574d95,_0x1eacac)=>{const _0x5761b8=_0x574d95[a2_0xa016('0x35')][a2_0xa016('0x3e')];const _0x53ad5c=_0x574d95[a2_0xa016('0x35')][a2_0xa016('0x36')];const _0x617f97=_0x574d95[a2_0xa016('0x35')][a2_0xa016('0x37')];exports[a2_0xa016('0x4')][a2_0xa016('0x19')][a2_0xa016('0x2d')][a2_0xa016('0x31')]({'attributes':[a2_0xa016('0x32'),[exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x3f'),exports['sequelize'][a2_0xa016('0x39')](a2_0xa016('0x32')),a2_0xa016('0x40')),'countingDateShort'],[exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x38'),exports['sequelize'][a2_0xa016('0x39')]('amount')),a2_0xa016('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0xa016('0x3b')]]:_0x53ad5c,[exports[a2_0xa016('0x4')]['Op']['lt']]:_0x617f97},'amount':_0x574d95['params'][a2_0xa016('0x3c')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0xa016('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x41'),exports[a2_0xa016('0x4')][a2_0xa016('0x39')](a2_0xa016('0x32'))),exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x42'),exports['sequelize'][a2_0xa016('0x39')](a2_0xa016('0x32'))),exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x43'),exports[a2_0xa016('0x4')][a2_0xa016('0x39')]('countingDate')),exports[a2_0xa016('0x4')]['fn'](a2_0xa016('0x44'),exports[a2_0xa016('0x4')][a2_0xa016('0x39')](a2_0xa016('0x32')))],'order':[[a2_0xa016('0x32'),a2_0xa016('0x33')]]})['then'](_0x587c46=>{_0x1eacac[a2_0xa016('0x12')]({'data':_0x587c46});});};exports[a2_0xa016('0x45')]=(_0x441e77,_0x47c477,_0x281c87)=>{const _0x1bb55b=_0x441e77[a2_0xa016('0x46')][a2_0xa016('0x47')][a2_0xa016('0x48')](_0x1bb55b=>_0x1bb55b[a2_0xa016('0x49')]==='facebook');fbgraph_1[a2_0xa016('0xa')][a2_0xa016('0x4a')](_0x1bb55b['accessToken']);fbgraph_1[a2_0xa016('0xa')]['get'](_0x441e77[a2_0xa016('0x46')]['facebook']+a2_0xa016('0x4b'),(_0x555ba1,_0x5a011e)=>{if(_0x555ba1){return _0x281c87(_0x555ba1);}_0x47c477[a2_0xa016('0x6')](a2_0xa016('0x4c'),{'title':a2_0xa016('0x4d'),'profile':_0x5a011e});});};