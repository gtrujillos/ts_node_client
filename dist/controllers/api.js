var a2_0x289b=['col','total','gte','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','amount','direction','HOUR','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','sequelize','setSequelize','getApi','render','API\x20Examples','log','connecting','default','ready','connected','list','colombia','name','endsWith','json','models','report_files','spread','push','error','connect','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','end','media/','.txt','createWriteStream','status','save','Downloaded:\x20','ftp.vivotek.com','processFtp','readFile','utf8','parse','Data','CountingInfo','Out','pass_counting','create','findAll','countingDate','ASC','getPassCountingByDay','month','query','startDate','endDate'];(function(_0x148bed,_0x40ad15){var _0x5998f4=function(_0x267ecf){while(--_0x267ecf){_0x148bed['push'](_0x148bed['shift']());}};_0x5998f4(++_0x40ad15);}(a2_0x289b,0x6a));var a2_0x12a9=function(_0xdb5837,_0xb973cf){_0xdb5837=_0xdb5837-0x0;var _0x46b3f8=a2_0x289b[_0xdb5837];return _0x46b3f8;};'use strict';var __importDefault=this&&this[a2_0x12a9('0x0')]||function(_0x31941b){return _0x31941b&&_0x31941b[a2_0x12a9('0x1')]?_0x31941b:{'default':_0x31941b};};Object['defineProperty'](exports,a2_0x12a9('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x12a9('0x2')]='';function setSequelize(_0x3ba2b8){exports['sequelize']=_0x3ba2b8;}exports[a2_0x12a9('0x3')]=setSequelize;exports[a2_0x12a9('0x4')]=(_0x58ee5c,_0x2e2d5f)=>{_0x2e2d5f[a2_0x12a9('0x5')]('api/index',{'title':a2_0x12a9('0x6')});};exports['syncFtp']=(_0x435076,_0x4c9c86)=>{console[a2_0x12a9('0x7')](a2_0x12a9('0x8'));const _0x3c5f54=[];const _0x470043=new ftp_1[(a2_0x12a9('0x9'))]();_0x470043['on'](a2_0x12a9('0xa'),function(){console[a2_0x12a9('0x7')](a2_0x12a9('0xb'));_0x470043[a2_0x12a9('0xc')](a2_0x12a9('0xd'),![],function(_0x47df89,_0x55f66b){if(_0x47df89){}else{for(const _0x4cb9f7 of _0x55f66b){console[a2_0x12a9('0x7')]('Downloading:\x20'+_0x4cb9f7[a2_0x12a9('0xe')]);if(_0x4cb9f7[a2_0x12a9('0xe')][a2_0x12a9('0xf')](a2_0x12a9('0x10'))){exports[a2_0x12a9('0x2')][a2_0x12a9('0x11')][a2_0x12a9('0x12')]['findOrCreate']({'where':{'fileName':_0x4cb9f7['name']}})[a2_0x12a9('0x13')]((_0x596b6b,_0x4735c7)=>{if(_0x4735c7){console[a2_0x12a9('0x7')](_0x4cb9f7[a2_0x12a9('0xe')]);_0x3c5f54[a2_0x12a9('0x14')](_0x596b6b);}});}}}_0x4c9c86['json']({'data':_0x3c5f54});});});_0x470043['on'](a2_0x12a9('0x15'),function(_0x535a13){_0x4c9c86['json']({'message':_0x535a13});});_0x470043[a2_0x12a9('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x12a9('0x17'),'password':a2_0x12a9('0x17')});};exports[a2_0x12a9('0x18')]=(_0x1a1a6b,_0x7f1a64)=>{exports['sequelize'][a2_0x12a9('0x11')][a2_0x12a9('0x12')][a2_0x12a9('0x19')]({'where':{'status':null}})[a2_0x12a9('0x1a')](_0xfb278d=>{if(_0xfb278d){const _0x42a9c7=new ftp_1['default']();_0x42a9c7['on']('ready',function(){console[a2_0x12a9('0x7')](a2_0x12a9('0x1b')+_0xfb278d[a2_0x12a9('0x1c')]);_0x42a9c7[a2_0x12a9('0x1d')](a2_0x12a9('0x1e')+_0xfb278d[a2_0x12a9('0x1c')],function(_0xe56279,_0x47e5cf){_0x42a9c7[a2_0x12a9('0x1f')]();if(_0xe56279){}else{const _0x554845=a2_0x12a9('0x20')+_0xfb278d[a2_0x12a9('0x1c')]+a2_0x12a9('0x21');_0x47e5cf['pipe'](fs_1['default'][a2_0x12a9('0x22')](_0x554845));_0xfb278d[a2_0x12a9('0x23')]=0x1;_0xfb278d[a2_0x12a9('0x24')]();console[a2_0x12a9('0x7')](a2_0x12a9('0x25')+_0xfb278d[a2_0x12a9('0x1c')]);}});});_0x42a9c7['on']('error',function(_0x2413fe){_0x7f1a64[a2_0x12a9('0x10')]({'message':_0x2413fe});});_0x42a9c7['connect']({'host':a2_0x12a9('0x26'),'port':0x15,'user':a2_0x12a9('0x17'),'password':'ipd'});_0x7f1a64[a2_0x12a9('0x10')]({'data':_0xfb278d[a2_0x12a9('0x1c')]});}else{_0x7f1a64['json']({'data':[]});}});};exports[a2_0x12a9('0x27')]=(_0x1d6af5,_0x55cd3d)=>{exports['sequelize'][a2_0x12a9('0x11')][a2_0x12a9('0x12')]['findOne']({'where':{'status':0x1}})[a2_0x12a9('0x1a')](_0x5db5c2=>{if(_0x5db5c2){const _0x5a6f2d='media/'+_0x5db5c2[a2_0x12a9('0x1c')]+a2_0x12a9('0x21');fs_1[a2_0x12a9('0x9')][a2_0x12a9('0x28')](_0x5a6f2d,a2_0x12a9('0x29'),function(_0x4c0ade,_0x269628){if(_0x4c0ade){_0x5db5c2['status']=null;}else{try{const _0x1feae0=JSON[a2_0x12a9('0x2a')](_0x269628);for(const _0x5b38b3 of _0x1feae0[a2_0x12a9('0x2b')][0x0][a2_0x12a9('0x2c')]){const _0x4f318b=_0x5b38b3['In'];const _0x1a0771=_0x5b38b3[a2_0x12a9('0x2d')];const _0x1802e0=Date[a2_0x12a9('0x2a')](_0x5b38b3['EndTime']);if(_0x4f318b>0x0){exports['sequelize'][a2_0x12a9('0x11')][a2_0x12a9('0x2e')][a2_0x12a9('0x2f')]({'reportFileId':_0x5db5c2['id'],'amount':_0x4f318b,'countingDate':_0x1802e0});}if(_0x1a0771>0x0){exports[a2_0x12a9('0x2')][a2_0x12a9('0x11')]['pass_counting'][a2_0x12a9('0x2f')]({'reportFileId':_0x5db5c2['id'],'amount':_0x1a0771*-0x1,'countingDate':_0x1802e0});}}_0x5db5c2[a2_0x12a9('0x23')]=0x2;}catch(_0xd7f28f){_0x5db5c2[a2_0x12a9('0x23')]=null;}}_0x5db5c2[a2_0x12a9('0x24')]();});_0x55cd3d[a2_0x12a9('0x10')]({'data':_0x5db5c2['fileName']});}else{_0x55cd3d[a2_0x12a9('0x10')]({'data':[]});}});};exports['getPassCounting']=(_0x4dd43b,_0x3e62e1)=>{exports['sequelize'][a2_0x12a9('0x11')][a2_0x12a9('0x2e')][a2_0x12a9('0x30')]({'where':{'amount':{[exports[a2_0x12a9('0x2')]['Op']['gt']]:0x0}},'order':[[a2_0x12a9('0x31'),a2_0x12a9('0x32')]]})[a2_0x12a9('0x1a')](_0x1d6c77=>{_0x3e62e1['json']({'data':_0x1d6c77});});};exports[a2_0x12a9('0x33')]=(_0x4c78af,_0x22a42f)=>{const _0x5d7365=_0x4c78af['query'][a2_0x12a9('0x34')];const _0x4d1d2e=_0x4c78af[a2_0x12a9('0x35')][a2_0x12a9('0x36')];const _0x5dea20=_0x4c78af[a2_0x12a9('0x35')][a2_0x12a9('0x37')];exports[a2_0x12a9('0x2')][a2_0x12a9('0x11')]['pass_counting'][a2_0x12a9('0x30')]({'attributes':['countingDate',[exports[a2_0x12a9('0x2')]['fn']('sum',exports[a2_0x12a9('0x2')][a2_0x12a9('0x38')]('amount')),a2_0x12a9('0x39')]],'where':{'countingDate':{[exports[a2_0x12a9('0x2')]['Op'][a2_0x12a9('0x3a')]]:_0x4d1d2e,[exports['sequelize']['Op']['lt']]:_0x5dea20},'amount':_0x4c78af['params']['direction']=='in'?{[exports[a2_0x12a9('0x2')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x12a9('0x2')][a2_0x12a9('0x3b')](a2_0x12a9('0x3c'))],'order':[[a2_0x12a9('0x31'),'ASC']]})[a2_0x12a9('0x1a')](_0x2e1b8b=>{_0x22a42f[a2_0x12a9('0x10')]({'data':_0x2e1b8b});});};exports[a2_0x12a9('0x3d')]=(_0x28fc88,_0x26c225)=>{const _0x28e0b2=_0x28fc88['query'][a2_0x12a9('0x34')];const _0x515f3f=_0x28fc88[a2_0x12a9('0x35')]['startDate'];const _0x5e8ebe=_0x28fc88[a2_0x12a9('0x35')]['endDate'];exports[a2_0x12a9('0x2')][a2_0x12a9('0x11')]['pass_counting'][a2_0x12a9('0x30')]({'attributes':['countingDate',[exports[a2_0x12a9('0x2')]['fn'](a2_0x12a9('0x3e'),exports['sequelize']['col'](a2_0x12a9('0x31')),a2_0x12a9('0x3f')),a2_0x12a9('0x40')],[exports[a2_0x12a9('0x2')]['fn'](a2_0x12a9('0x41'),exports[a2_0x12a9('0x2')][a2_0x12a9('0x38')](a2_0x12a9('0x42'))),'total']],'where':{'countingDate':{[exports[a2_0x12a9('0x2')]['Op'][a2_0x12a9('0x3a')]]:_0x515f3f,[exports[a2_0x12a9('0x2')]['Op']['lt']]:_0x5e8ebe},'amount':_0x28fc88['params'][a2_0x12a9('0x43')]=='in'?{[exports[a2_0x12a9('0x2')]['Op']['gt']]:0x0}:{[exports[a2_0x12a9('0x2')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x12a9('0x44'),exports[a2_0x12a9('0x2')][a2_0x12a9('0x38')]('countingDate')),exports[a2_0x12a9('0x2')]['fn']('DAY',exports['sequelize'][a2_0x12a9('0x38')](a2_0x12a9('0x31'))),exports['sequelize']['fn'](a2_0x12a9('0x45'),exports[a2_0x12a9('0x2')]['col'](a2_0x12a9('0x31'))),exports[a2_0x12a9('0x2')]['fn'](a2_0x12a9('0x46'),exports[a2_0x12a9('0x2')][a2_0x12a9('0x38')](a2_0x12a9('0x31')))],'order':[[a2_0x12a9('0x31'),a2_0x12a9('0x32')]]})[a2_0x12a9('0x1a')](_0x5c9b46=>{_0x26c225[a2_0x12a9('0x10')]({'data':_0x5c9b46});});};exports[a2_0x12a9('0x47')]=(_0x34a203,_0x181270,_0x5c96b2)=>{const _0x59c6da=_0x34a203[a2_0x12a9('0x48')][a2_0x12a9('0x49')][a2_0x12a9('0x4a')](_0x59c6da=>_0x59c6da[a2_0x12a9('0x4b')]===a2_0x12a9('0x4c'));fbgraph_1[a2_0x12a9('0x9')][a2_0x12a9('0x4d')](_0x59c6da[a2_0x12a9('0x4e')]);fbgraph_1[a2_0x12a9('0x9')][a2_0x12a9('0x1d')](_0x34a203[a2_0x12a9('0x48')][a2_0x12a9('0x4c')]+a2_0x12a9('0x4f'),(_0x4c99e8,_0x26ecdb)=>{if(_0x4c99e8){return _0x5c96b2(_0x4c99e8);}_0x181270[a2_0x12a9('0x5')]('api/facebook',{'title':a2_0x12a9('0x50'),'profile':_0x26ecdb});});};