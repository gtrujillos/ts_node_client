var a2_0x5db5=['countingDateShort','HOUR','DAY','MONTH','user','kind','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','defineProperty','__esModule','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','connected','list','colombia','name','endsWith','json','models','report_files','findOrCreate','spread','push','error','connect','ipd','findOne','connected:','fileName','get','colombia/','end','media/','pipe','status','save','Downloaded:\x20','processFtp','then','.txt','utf8','parse','Data','CountingInfo','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','month','query','startDate','sum','col','amount','total','gte','params','direction','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','%Y-%m-%d\x20%H:00'];(function(_0x3effec,_0x21a9e3){var _0x4b62a6=function(_0x5bd7c4){while(--_0x5bd7c4){_0x3effec['push'](_0x3effec['shift']());}};_0x4b62a6(++_0x21a9e3);}(a2_0x5db5,0x1d1));var a2_0x3f0e=function(_0x181846,_0x50aa39){_0x181846=_0x181846-0x0;var _0x36517c=a2_0x5db5[_0x181846];return _0x36517c;};'use strict';var __importDefault=this&&this[a2_0x3f0e('0x0')]||function(_0x217829){return _0x217829&&_0x217829['__esModule']?_0x217829:{'default':_0x217829};};Object[a2_0x3f0e('0x1')](exports,a2_0x3f0e('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x3f0e('0x3')]='';function setSequelize(_0x2501ba){exports[a2_0x3f0e('0x3')]=_0x2501ba;}exports[a2_0x3f0e('0x4')]=setSequelize;exports[a2_0x3f0e('0x5')]=(_0x47cc10,_0x148035)=>{_0x148035[a2_0x3f0e('0x6')](a2_0x3f0e('0x7'),{'title':a2_0x3f0e('0x8')});};exports[a2_0x3f0e('0x9')]=(_0xfb4034,_0x40a703)=>{console[a2_0x3f0e('0xa')](a2_0x3f0e('0xb'));const _0x16c617=[];const _0x5ac51c=new ftp_1[(a2_0x3f0e('0xc'))]();_0x5ac51c['on']('ready',function(){console['log'](a2_0x3f0e('0xd'));_0x5ac51c[a2_0x3f0e('0xe')](a2_0x3f0e('0xf'),![],function(_0x3278ff,_0x15d895){if(_0x3278ff){}else{for(const _0x4c7d9c of _0x15d895){console[a2_0x3f0e('0xa')]('Downloading:\x20'+_0x4c7d9c[a2_0x3f0e('0x10')]);if(_0x4c7d9c['name'][a2_0x3f0e('0x11')](a2_0x3f0e('0x12'))){exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x13')][a2_0x3f0e('0x14')][a2_0x3f0e('0x15')]({'where':{'fileName':_0x4c7d9c[a2_0x3f0e('0x10')]}})[a2_0x3f0e('0x16')]((_0xed8e9,_0x499b87)=>{if(_0x499b87){console['log'](_0x4c7d9c[a2_0x3f0e('0x10')]);_0x16c617[a2_0x3f0e('0x17')](_0xed8e9);}});}}}_0x40a703[a2_0x3f0e('0x12')]({'data':_0x16c617});});});_0x5ac51c['on'](a2_0x3f0e('0x18'),function(_0x3d23c2){_0x40a703[a2_0x3f0e('0x12')]({'message':_0x3d23c2});});_0x5ac51c[a2_0x3f0e('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x3f0e('0x1a'),'password':a2_0x3f0e('0x1a')});};exports['downloadFtp']=(_0x2266d5,_0x518150)=>{exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x13')][a2_0x3f0e('0x14')][a2_0x3f0e('0x1b')]({'where':{'status':null}})['then'](_0x5eda66=>{if(_0x5eda66){const _0x20473d=new ftp_1['default']();_0x20473d['on']('ready',function(){console[a2_0x3f0e('0xa')](a2_0x3f0e('0x1c')+_0x5eda66[a2_0x3f0e('0x1d')]);_0x20473d[a2_0x3f0e('0x1e')](a2_0x3f0e('0x1f')+_0x5eda66[a2_0x3f0e('0x1d')],function(_0x55a1bd,_0x2cf1aa){_0x20473d[a2_0x3f0e('0x20')]();if(_0x55a1bd){}else{const _0x45f9df=a2_0x3f0e('0x21')+_0x5eda66[a2_0x3f0e('0x1d')]+'.txt';_0x2cf1aa[a2_0x3f0e('0x22')](fs_1[a2_0x3f0e('0xc')]['createWriteStream'](_0x45f9df));_0x5eda66[a2_0x3f0e('0x23')]=0x1;_0x5eda66[a2_0x3f0e('0x24')]();console[a2_0x3f0e('0xa')](a2_0x3f0e('0x25')+_0x5eda66[a2_0x3f0e('0x1d')]);}});});_0x20473d['on']('error',function(_0x91e3d9){_0x518150[a2_0x3f0e('0x12')]({'message':_0x91e3d9});});_0x20473d['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x3f0e('0x1a'),'password':a2_0x3f0e('0x1a')});_0x518150['json']({'data':_0x5eda66[a2_0x3f0e('0x1d')]});}else{_0x518150[a2_0x3f0e('0x12')]({'data':[]});}});};exports[a2_0x3f0e('0x26')]=(_0x28ae1b,_0x5a1300)=>{exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x13')][a2_0x3f0e('0x14')]['findOne']({'where':{'status':0x1}})[a2_0x3f0e('0x27')](_0x56e944=>{if(_0x56e944){const _0x2e1eff=a2_0x3f0e('0x21')+_0x56e944[a2_0x3f0e('0x1d')]+a2_0x3f0e('0x28');fs_1[a2_0x3f0e('0xc')]['readFile'](_0x2e1eff,a2_0x3f0e('0x29'),function(_0x469a80,_0x46e4ab){if(_0x469a80){_0x56e944['status']=null;}else{try{const _0x56752e=JSON[a2_0x3f0e('0x2a')](_0x46e4ab);for(const _0x427c25 of _0x56752e[a2_0x3f0e('0x2b')][0x0][a2_0x3f0e('0x2c')]){const _0x5d9926=_0x427c25['In'];const _0x5163e3=_0x427c25['Out'];const _0x29e6b6=Date['parse'](_0x427c25[a2_0x3f0e('0x2d')]);if(_0x5d9926>0x0){exports['sequelize'][a2_0x3f0e('0x13')][a2_0x3f0e('0x2e')][a2_0x3f0e('0x2f')]({'reportFileId':_0x56e944['id'],'amount':_0x5d9926,'countingDate':_0x29e6b6});}if(_0x5163e3>0x0){exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x13')]['pass_counting'][a2_0x3f0e('0x2f')]({'reportFileId':_0x56e944['id'],'amount':_0x5163e3*-0x1,'countingDate':_0x29e6b6});}}_0x56e944[a2_0x3f0e('0x23')]=0x2;}catch(_0x2323c7){_0x56e944['status']=null;}}_0x56e944[a2_0x3f0e('0x24')]();});_0x5a1300[a2_0x3f0e('0x12')]({'data':_0x56e944[a2_0x3f0e('0x1d')]});}else{_0x5a1300[a2_0x3f0e('0x12')]({'data':[]});}});};exports[a2_0x3f0e('0x30')]=(_0x26bfb2,_0x5d7299)=>{exports[a2_0x3f0e('0x3')]['models'][a2_0x3f0e('0x2e')][a2_0x3f0e('0x31')]({'where':{'amount':{[exports[a2_0x3f0e('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0x3f0e('0x32'),a2_0x3f0e('0x33')]]})[a2_0x3f0e('0x27')](_0x541d8b=>{_0x5d7299[a2_0x3f0e('0x12')]({'data':_0x541d8b});});};exports[a2_0x3f0e('0x34')]=(_0x4ed991,_0x5e00ad)=>{const _0x31ea6a=_0x4ed991['query'][a2_0x3f0e('0x35')];const _0x18fb05=_0x4ed991[a2_0x3f0e('0x36')][a2_0x3f0e('0x37')];const _0x50667a=_0x4ed991[a2_0x3f0e('0x36')]['endDate'];exports[a2_0x3f0e('0x3')]['models'][a2_0x3f0e('0x2e')]['findAll']({'attributes':[a2_0x3f0e('0x32'),[exports[a2_0x3f0e('0x3')]['fn'](a2_0x3f0e('0x38'),exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x39')](a2_0x3f0e('0x3a'))),a2_0x3f0e('0x3b')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x3f0e('0x3c')]]:_0x18fb05,[exports[a2_0x3f0e('0x3')]['Op']['lt']]:_0x50667a},'amount':_0x4ed991[a2_0x3f0e('0x3d')][a2_0x3f0e('0x3e')]=='in'?{[exports[a2_0x3f0e('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x3f0e('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x3f0e('0x3')]['literal'](a2_0x3f0e('0x3f'))],'order':[[a2_0x3f0e('0x32'),'ASC']]})[a2_0x3f0e('0x27')](_0x1a699e=>{_0x5e00ad[a2_0x3f0e('0x12')]({'data':_0x1a699e});});};exports[a2_0x3f0e('0x40')]=(_0x29a8e9,_0x5a8ffd)=>{const _0x304791=_0x29a8e9['query'][a2_0x3f0e('0x35')];const _0xcc7f31=_0x29a8e9['query']['startDate'];const _0x398d8d=_0x29a8e9[a2_0x3f0e('0x36')][a2_0x3f0e('0x41')];exports['sequelize'][a2_0x3f0e('0x13')][a2_0x3f0e('0x2e')]['findAll']({'attributes':['countingDate',[exports[a2_0x3f0e('0x3')]['fn']('DATE_FORMAT',exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x39')](a2_0x3f0e('0x32')),a2_0x3f0e('0x42')),a2_0x3f0e('0x43')],[exports['sequelize']['fn'](a2_0x3f0e('0x38'),exports[a2_0x3f0e('0x3')]['col'](a2_0x3f0e('0x3a'))),a2_0x3f0e('0x3b')]],'where':{'countingDate':{[exports[a2_0x3f0e('0x3')]['Op'][a2_0x3f0e('0x3c')]]:_0xcc7f31,[exports[a2_0x3f0e('0x3')]['Op']['lt']]:_0x398d8d},'amount':_0x29a8e9[a2_0x3f0e('0x3d')][a2_0x3f0e('0x3e')]=='in'?{[exports[a2_0x3f0e('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x3f0e('0x3')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x3f0e('0x44'),exports['sequelize']['col'](a2_0x3f0e('0x32'))),exports['sequelize']['fn'](a2_0x3f0e('0x45'),exports[a2_0x3f0e('0x3')]['col'](a2_0x3f0e('0x32'))),exports[a2_0x3f0e('0x3')]['fn'](a2_0x3f0e('0x46'),exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x39')](a2_0x3f0e('0x32'))),exports['sequelize']['fn']('YEAR',exports[a2_0x3f0e('0x3')][a2_0x3f0e('0x39')](a2_0x3f0e('0x32')))],'order':[[a2_0x3f0e('0x32'),a2_0x3f0e('0x33')]]})[a2_0x3f0e('0x27')](_0x1c070c=>{_0x5a8ffd[a2_0x3f0e('0x12')]({'data':_0x1c070c});});};exports['getFacebook']=(_0x3972c1,_0x143c80,_0x54a755)=>{const _0x3b29bc=_0x3972c1[a2_0x3f0e('0x47')]['tokens']['find'](_0x3b29bc=>_0x3b29bc[a2_0x3f0e('0x48')]===a2_0x3f0e('0x49'));fbgraph_1['default']['setAccessToken'](_0x3b29bc['accessToken']);fbgraph_1['default']['get'](_0x3972c1['user']['facebook']+a2_0x3f0e('0x4a'),(_0x136bd8,_0x588f7a)=>{if(_0x136bd8){return _0x54a755(_0x136bd8);}_0x143c80[a2_0x3f0e('0x6')]('api/facebook',{'title':a2_0x3f0e('0x4b'),'profile':_0x588f7a});});};