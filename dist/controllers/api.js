var a2_0x3589=['getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','colombia','name','endsWith','json','models','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','connected:','get','fileName','media/','.txt','pipe','status','save','processFtp','then','readFile','utf8','parse','Out','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','col','amount','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','total','HOUR','DAY','MONTH','YEAR','getFacebook','tokens','find','kind','facebook','setAccessToken','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize'];(function(_0x585621,_0x4b800b){var _0x37fd8d=function(_0x2ad0c5){while(--_0x2ad0c5){_0x585621['push'](_0x585621['shift']());}};_0x37fd8d(++_0x4b800b);}(a2_0x3589,0xec));var a2_0x50c1=function(_0x3a034e,_0x42782b){_0x3a034e=_0x3a034e-0x0;var _0x57a9e8=a2_0x3589[_0x3a034e];return _0x57a9e8;};'use strict';var __importDefault=this&&this[a2_0x50c1('0x0')]||function(_0x3fb601){return _0x3fb601&&_0x3fb601[a2_0x50c1('0x1')]?_0x3fb601:{'default':_0x3fb601};};Object[a2_0x50c1('0x2')](exports,a2_0x50c1('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x50c1('0x3')));const ftp_1=__importDefault(require(a2_0x50c1('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x50c1('0x5')]='';function setSequelize(_0x18fd9c){exports['sequelize']=_0x18fd9c;}exports[a2_0x50c1('0x6')]=setSequelize;exports[a2_0x50c1('0x7')]=(_0x50a728,_0x559e71)=>{_0x559e71[a2_0x50c1('0x8')](a2_0x50c1('0x9'),{'title':a2_0x50c1('0xa')});};exports[a2_0x50c1('0xb')]=(_0x517d3a,_0x47625b)=>{console[a2_0x50c1('0xc')](a2_0x50c1('0xd'));const _0x36ab90=[];const _0x5dbf04=new ftp_1[(a2_0x50c1('0xe'))]();_0x5dbf04['on'](a2_0x50c1('0xf'),function(){console[a2_0x50c1('0xc')](a2_0x50c1('0x10'));_0x5dbf04['list'](a2_0x50c1('0x11'),![],function(_0x228f6b,_0x1d0741){if(_0x228f6b){}else{for(const _0x190a7a of _0x1d0741){console['log']('Downloading:\x20'+_0x190a7a[a2_0x50c1('0x12')]);if(_0x190a7a[a2_0x50c1('0x12')][a2_0x50c1('0x13')](a2_0x50c1('0x14'))){exports[a2_0x50c1('0x5')][a2_0x50c1('0x15')][a2_0x50c1('0x16')][a2_0x50c1('0x17')]({'where':{'fileName':_0x190a7a[a2_0x50c1('0x12')]}})[a2_0x50c1('0x18')]((_0x2437d4,_0x188e1d)=>{if(_0x188e1d){console[a2_0x50c1('0xc')](_0x190a7a[a2_0x50c1('0x12')]);_0x36ab90[a2_0x50c1('0x19')](_0x2437d4);}});}}}_0x47625b['json']({'data':_0x36ab90});});});_0x5dbf04['on'](a2_0x50c1('0x1a'),function(_0x2225e5){_0x47625b['json']({'message':_0x2225e5});});_0x5dbf04[a2_0x50c1('0x1b')]({'host':a2_0x50c1('0x1c'),'port':0x15,'user':'ipd','password':a2_0x50c1('0x1d')});};exports['downloadFtp']=(_0x12fff6,_0x18d23c)=>{exports[a2_0x50c1('0x5')][a2_0x50c1('0x15')]['report_files'][a2_0x50c1('0x1e')]({'where':{'status':null}})['then'](_0x293a47=>{if(_0x293a47){const _0x546463=new ftp_1[(a2_0x50c1('0xe'))]();_0x546463['on'](a2_0x50c1('0xf'),function(){console[a2_0x50c1('0xc')](a2_0x50c1('0x1f')+_0x293a47['fileName']);_0x546463[a2_0x50c1('0x20')]('colombia/'+_0x293a47[a2_0x50c1('0x21')],function(_0x51f01f,_0x15f7a4){_0x546463['end']();if(_0x51f01f){}else{const _0xa5af01=a2_0x50c1('0x22')+_0x293a47['fileName']+a2_0x50c1('0x23');_0x15f7a4[a2_0x50c1('0x24')](fs_1[a2_0x50c1('0xe')]['createWriteStream'](_0xa5af01));_0x293a47[a2_0x50c1('0x25')]=0x1;_0x293a47[a2_0x50c1('0x26')]();console['log']('Downloaded:\x20'+_0x293a47['fileName']);}});});_0x546463['on'](a2_0x50c1('0x1a'),function(_0x53c43a){_0x18d23c['json']({'message':_0x53c43a});});_0x546463[a2_0x50c1('0x1b')]({'host':a2_0x50c1('0x1c'),'port':0x15,'user':a2_0x50c1('0x1d'),'password':'ipd'});_0x18d23c[a2_0x50c1('0x14')]({'data':_0x293a47[a2_0x50c1('0x21')]});}else{_0x18d23c[a2_0x50c1('0x14')]({'data':[]});}});};exports[a2_0x50c1('0x27')]=(_0x392d75,_0x16237a)=>{exports[a2_0x50c1('0x5')]['models']['report_files'][a2_0x50c1('0x1e')]({'where':{'status':0x1}})[a2_0x50c1('0x28')](_0xead63=>{if(_0xead63){const _0x4fd290=a2_0x50c1('0x22')+_0xead63[a2_0x50c1('0x21')]+a2_0x50c1('0x23');fs_1[a2_0x50c1('0xe')][a2_0x50c1('0x29')](_0x4fd290,a2_0x50c1('0x2a'),function(_0x1d57a7,_0x3dd0be){if(_0x1d57a7){_0xead63['status']=null;}else{try{const _0x3d1fb5=JSON[a2_0x50c1('0x2b')](_0x3dd0be);for(const _0x29d1ca of _0x3d1fb5['Data'][0x0]['CountingInfo']){const _0xf5cd9a=_0x29d1ca['In'];const _0x4a9fea=_0x29d1ca[a2_0x50c1('0x2c')];const _0x2f8774=Date[a2_0x50c1('0x2b')](_0x29d1ca[a2_0x50c1('0x2d')]);if(_0xf5cd9a>0x0){exports['sequelize'][a2_0x50c1('0x15')][a2_0x50c1('0x2e')][a2_0x50c1('0x2f')]({'reportFileId':_0xead63['id'],'amount':_0xf5cd9a,'countingDate':_0x2f8774});}if(_0x4a9fea>0x0){exports[a2_0x50c1('0x5')][a2_0x50c1('0x15')]['pass_counting'][a2_0x50c1('0x2f')]({'reportFileId':_0xead63['id'],'amount':_0x4a9fea*-0x1,'countingDate':_0x2f8774});}}_0xead63[a2_0x50c1('0x25')]=0x2;}catch(_0x209eaa){_0xead63[a2_0x50c1('0x25')]=null;}}_0xead63[a2_0x50c1('0x26')]();});_0x16237a[a2_0x50c1('0x14')]({'data':_0xead63[a2_0x50c1('0x21')]});}else{_0x16237a[a2_0x50c1('0x14')]({'data':[]});}});};exports[a2_0x50c1('0x30')]=(_0x59f9df,_0x44d8cf)=>{exports[a2_0x50c1('0x5')][a2_0x50c1('0x15')]['pass_counting'][a2_0x50c1('0x31')]({'where':{'amount':{[exports[a2_0x50c1('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x50c1('0x32'),a2_0x50c1('0x33')]]})[a2_0x50c1('0x28')](_0x35b828=>{_0x44d8cf[a2_0x50c1('0x14')]({'data':_0x35b828});});};exports[a2_0x50c1('0x34')]=(_0x195c35,_0xebfe1d)=>{const _0x29c34a=_0x195c35[a2_0x50c1('0x35')][a2_0x50c1('0x36')];const _0x1c81fe=_0x195c35[a2_0x50c1('0x35')][a2_0x50c1('0x37')];const _0x30dd5b=_0x195c35[a2_0x50c1('0x35')][a2_0x50c1('0x38')];exports['sequelize'][a2_0x50c1('0x15')][a2_0x50c1('0x2e')][a2_0x50c1('0x31')]({'attributes':[a2_0x50c1('0x32'),[exports['sequelize']['fn'](a2_0x50c1('0x39'),exports[a2_0x50c1('0x5')][a2_0x50c1('0x3a')](a2_0x50c1('0x3b'))),'total']],'where':{'countingDate':{[exports[a2_0x50c1('0x5')]['Op'][a2_0x50c1('0x3c')]]:_0x1c81fe,[exports[a2_0x50c1('0x5')]['Op']['lt']]:_0x30dd5b},'amount':_0x195c35[a2_0x50c1('0x3d')][a2_0x50c1('0x3e')]=='in'?{[exports[a2_0x50c1('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x50c1('0x5')][a2_0x50c1('0x3f')](a2_0x50c1('0x40'))],'order':[['countingDate',a2_0x50c1('0x33')]]})[a2_0x50c1('0x28')](_0x5d42ac=>{_0xebfe1d['json']({'data':_0x5d42ac});});};exports['getPassCountingByHour']=(_0x5ed3d4,_0x5e0153)=>{const _0x900d67=_0x5ed3d4[a2_0x50c1('0x35')][a2_0x50c1('0x36')];const _0x492f0f=_0x5ed3d4[a2_0x50c1('0x35')]['startDate'];const _0x19277f=_0x5ed3d4[a2_0x50c1('0x35')]['endDate'];exports[a2_0x50c1('0x5')][a2_0x50c1('0x15')][a2_0x50c1('0x2e')][a2_0x50c1('0x31')]({'attributes':['countingDate',[exports[a2_0x50c1('0x5')]['fn'](a2_0x50c1('0x41'),exports[a2_0x50c1('0x5')]['col'](a2_0x50c1('0x32')),a2_0x50c1('0x42')),a2_0x50c1('0x43')],[exports[a2_0x50c1('0x5')]['fn'](a2_0x50c1('0x39'),exports['sequelize'][a2_0x50c1('0x3a')]('amount')),a2_0x50c1('0x44')]],'where':{'countingDate':{[exports[a2_0x50c1('0x5')]['Op'][a2_0x50c1('0x3c')]]:_0x492f0f,[exports[a2_0x50c1('0x5')]['Op']['lt']]:_0x19277f},'amount':_0x5ed3d4[a2_0x50c1('0x3d')]['direction']=='in'?{[exports[a2_0x50c1('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x50c1('0x45'),exports[a2_0x50c1('0x5')][a2_0x50c1('0x3a')]('countingDate')),exports[a2_0x50c1('0x5')]['fn'](a2_0x50c1('0x46'),exports['sequelize']['col'](a2_0x50c1('0x32'))),exports[a2_0x50c1('0x5')]['fn'](a2_0x50c1('0x47'),exports[a2_0x50c1('0x5')][a2_0x50c1('0x3a')](a2_0x50c1('0x32'))),exports[a2_0x50c1('0x5')]['fn'](a2_0x50c1('0x48'),exports['sequelize'][a2_0x50c1('0x3a')]('countingDate'))],'order':[[a2_0x50c1('0x32'),a2_0x50c1('0x33')]]})['then'](_0x25347b=>{_0x5e0153['json']({'data':_0x25347b});});};exports[a2_0x50c1('0x49')]=(_0x484bd8,_0x68e723,_0x533e91)=>{const _0x467c5a=_0x484bd8['user'][a2_0x50c1('0x4a')][a2_0x50c1('0x4b')](_0x467c5a=>_0x467c5a[a2_0x50c1('0x4c')]===a2_0x50c1('0x4d'));fbgraph_1[a2_0x50c1('0xe')][a2_0x50c1('0x4e')](_0x467c5a['accessToken']);fbgraph_1['default'][a2_0x50c1('0x20')](_0x484bd8['user']['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x50b8df,_0x539252)=>{if(_0x50b8df){return _0x533e91(_0x50b8df);}_0x68e723[a2_0x50c1('0x8')](a2_0x50c1('0x4f'),{'title':a2_0x50c1('0x50'),'profile':_0x539252});});};