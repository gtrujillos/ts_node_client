var a2_0x50de=['spread','push','ftp.vivotek.com','ipd','downloadFtp','models','findOne','then','connected:','fileName','get','end','media/','.txt','pipe','status','save','Downloaded:\x20','connect','readFile','utf8','parse','Data','Out','EndTime','pass_counting','create','getPassCounting','countingDate','ASC','query','findAll','col','amount','total','gte','params','literal','endDate','%Y-%m-%d\x20%H:00','sum','direction','DAY','MONTH','getFacebook','user','tokens','find','kind','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','api/facebook','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','log','connecting','default','ready','connected','list','Downloading:\x20','name','endsWith','json','report_files','findOrCreate'];(function(_0x4a2562,_0x3770c4){var _0x4b85e3=function(_0x1b0ef8){while(--_0x1b0ef8){_0x4a2562['push'](_0x4a2562['shift']());}};_0x4b85e3(++_0x3770c4);}(a2_0x50de,0x1ec));var a2_0x5887=function(_0x557367,_0x5032bd){_0x557367=_0x557367-0x0;var _0x225cb5=a2_0x50de[_0x557367];return _0x225cb5;};'use strict';var __importDefault=this&&this[a2_0x5887('0x0')]||function(_0x2d8adb){return _0x2d8adb&&_0x2d8adb[a2_0x5887('0x1')]?_0x2d8adb:{'default':_0x2d8adb};};Object['defineProperty'](exports,a2_0x5887('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x5887('0x2')));const ftp_1=__importDefault(require(a2_0x5887('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x5887('0x4')]='';function setSequelize(_0x4d4b42){exports[a2_0x5887('0x4')]=_0x4d4b42;}exports[a2_0x5887('0x5')]=setSequelize;exports[a2_0x5887('0x6')]=(_0x50a52c,_0x3ab80e)=>{_0x3ab80e['render']('api/index',{'title':'API\x20Examples'});};exports['syncFtp']=(_0x418b66,_0x56e738)=>{console[a2_0x5887('0x7')](a2_0x5887('0x8'));const _0x26d8e3=[];const _0x59e641=new ftp_1[(a2_0x5887('0x9'))]();_0x59e641['on'](a2_0x5887('0xa'),function(){console[a2_0x5887('0x7')](a2_0x5887('0xb'));_0x59e641[a2_0x5887('0xc')]('colombia',![],function(_0xe018b8,_0xc2be9f){if(_0xe018b8){}else{for(const _0x408d4b of _0xc2be9f){console[a2_0x5887('0x7')](a2_0x5887('0xd')+_0x408d4b[a2_0x5887('0xe')]);if(_0x408d4b[a2_0x5887('0xe')][a2_0x5887('0xf')](a2_0x5887('0x10'))){exports[a2_0x5887('0x4')]['models'][a2_0x5887('0x11')][a2_0x5887('0x12')]({'where':{'fileName':_0x408d4b[a2_0x5887('0xe')]}})[a2_0x5887('0x13')]((_0x446e1a,_0xaf93bc)=>{if(_0xaf93bc){console['log'](_0x408d4b[a2_0x5887('0xe')]);_0x26d8e3[a2_0x5887('0x14')](_0x446e1a);}});}}}_0x56e738[a2_0x5887('0x10')]({'data':_0x26d8e3});});});_0x59e641['on']('error',function(_0x47b9fe){_0x56e738[a2_0x5887('0x10')]({'message':_0x47b9fe});});_0x59e641['connect']({'host':a2_0x5887('0x15'),'port':0x15,'user':a2_0x5887('0x16'),'password':a2_0x5887('0x16')});};exports[a2_0x5887('0x17')]=(_0x2c9d40,_0x5b4c2e)=>{exports[a2_0x5887('0x4')][a2_0x5887('0x18')][a2_0x5887('0x11')][a2_0x5887('0x19')]({'where':{'status':null}})[a2_0x5887('0x1a')](_0x1b5c82=>{if(_0x1b5c82){const _0x304be6=new ftp_1[(a2_0x5887('0x9'))]();_0x304be6['on'](a2_0x5887('0xa'),function(){console[a2_0x5887('0x7')](a2_0x5887('0x1b')+_0x1b5c82[a2_0x5887('0x1c')]);_0x304be6[a2_0x5887('0x1d')]('colombia/'+_0x1b5c82['fileName'],function(_0x4fcbc3,_0x3daf43){_0x304be6[a2_0x5887('0x1e')]();if(_0x4fcbc3){}else{const _0x2d189c=a2_0x5887('0x1f')+_0x1b5c82[a2_0x5887('0x1c')]+a2_0x5887('0x20');_0x3daf43[a2_0x5887('0x21')](fs_1[a2_0x5887('0x9')]['createWriteStream'](_0x2d189c));_0x1b5c82[a2_0x5887('0x22')]=0x1;_0x1b5c82[a2_0x5887('0x23')]();console[a2_0x5887('0x7')](a2_0x5887('0x24')+_0x1b5c82[a2_0x5887('0x1c')]);}});});_0x304be6['on']('error',function(_0x5d354a){_0x5b4c2e[a2_0x5887('0x10')]({'message':_0x5d354a});});_0x304be6[a2_0x5887('0x25')]({'host':a2_0x5887('0x15'),'port':0x15,'user':a2_0x5887('0x16'),'password':'ipd'});_0x5b4c2e[a2_0x5887('0x10')]({'data':_0x1b5c82[a2_0x5887('0x1c')]});}else{_0x5b4c2e[a2_0x5887('0x10')]({'data':[]});}});};exports['processFtp']=(_0x4aee03,_0x78b57)=>{exports['sequelize'][a2_0x5887('0x18')][a2_0x5887('0x11')][a2_0x5887('0x19')]({'where':{'status':0x1}})[a2_0x5887('0x1a')](_0x153220=>{if(_0x153220){const _0x5c03ea='media/'+_0x153220[a2_0x5887('0x1c')]+a2_0x5887('0x20');fs_1[a2_0x5887('0x9')][a2_0x5887('0x26')](_0x5c03ea,a2_0x5887('0x27'),function(_0x560b93,_0x4ce759){if(_0x560b93){_0x153220[a2_0x5887('0x22')]=null;}else{try{const _0x848a11=JSON[a2_0x5887('0x28')](_0x4ce759);for(const _0x29f565 of _0x848a11[a2_0x5887('0x29')][0x0]['CountingInfo']){const _0x1da939=_0x29f565['In'];const _0x5d2f33=_0x29f565[a2_0x5887('0x2a')];const _0x5b2b19=Date[a2_0x5887('0x28')](_0x29f565[a2_0x5887('0x2b')]);if(_0x1da939>0x0){exports[a2_0x5887('0x4')][a2_0x5887('0x18')][a2_0x5887('0x2c')]['create']({'reportFileId':_0x153220['id'],'amount':_0x1da939,'countingDate':_0x5b2b19});}if(_0x5d2f33>0x0){exports[a2_0x5887('0x4')][a2_0x5887('0x18')][a2_0x5887('0x2c')][a2_0x5887('0x2d')]({'reportFileId':_0x153220['id'],'amount':_0x5d2f33*-0x1,'countingDate':_0x5b2b19});}}_0x153220[a2_0x5887('0x22')]=0x2;}catch(_0x574f0e){_0x153220[a2_0x5887('0x22')]=null;}}_0x153220['save']();});_0x78b57[a2_0x5887('0x10')]({'data':_0x153220['fileName']});}else{_0x78b57[a2_0x5887('0x10')]({'data':[]});}});};exports[a2_0x5887('0x2e')]=(_0x20907a,_0x418e53)=>{exports[a2_0x5887('0x4')]['models'][a2_0x5887('0x2c')]['findAll']({'where':{'amount':{[exports[a2_0x5887('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x5887('0x2f'),a2_0x5887('0x30')]]})[a2_0x5887('0x1a')](_0x25fa39=>{_0x418e53[a2_0x5887('0x10')]({'data':_0x25fa39});});};exports['getPassCountingByDay']=(_0x23e30c,_0x1eff9e)=>{const _0x528cbb=_0x23e30c[a2_0x5887('0x31')]['month'];const _0x134d5c=_0x23e30c[a2_0x5887('0x31')]['startDate'];const _0xa01540=_0x23e30c[a2_0x5887('0x31')]['endDate'];exports['sequelize'][a2_0x5887('0x18')][a2_0x5887('0x2c')][a2_0x5887('0x32')]({'attributes':[a2_0x5887('0x2f'),[exports[a2_0x5887('0x4')]['fn']('sum',exports[a2_0x5887('0x4')][a2_0x5887('0x33')](a2_0x5887('0x34'))),a2_0x5887('0x35')]],'where':{'countingDate':{[exports[a2_0x5887('0x4')]['Op'][a2_0x5887('0x36')]]:_0x134d5c,[exports['sequelize']['Op']['lt']]:_0xa01540},'amount':_0x23e30c[a2_0x5887('0x37')]['direction']=='in'?{[exports[a2_0x5887('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x5887('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x5887('0x38')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x5887('0x2f'),'ASC']]})['then'](_0x51277b=>{_0x1eff9e['json']({'data':_0x51277b});});};exports['getPassCountingByHour']=(_0x47cf10,_0x447ed6)=>{const _0x206f57=_0x47cf10['query']['month'];const _0x261bb1=_0x47cf10[a2_0x5887('0x31')]['startDate'];const _0xb44bec=_0x47cf10[a2_0x5887('0x31')][a2_0x5887('0x39')];exports[a2_0x5887('0x4')][a2_0x5887('0x18')]['pass_counting']['findAll']({'attributes':['countingDate',[exports[a2_0x5887('0x4')]['fn']('DATE_FORMAT',exports[a2_0x5887('0x4')][a2_0x5887('0x33')](a2_0x5887('0x2f')),a2_0x5887('0x3a')),'countingDateShort'],[exports[a2_0x5887('0x4')]['fn'](a2_0x5887('0x3b'),exports[a2_0x5887('0x4')][a2_0x5887('0x33')](a2_0x5887('0x34'))),a2_0x5887('0x35')]],'where':{'countingDate':{[exports[a2_0x5887('0x4')]['Op'][a2_0x5887('0x36')]]:_0x261bb1,[exports['sequelize']['Op']['lt']]:_0xb44bec},'amount':_0x47cf10[a2_0x5887('0x37')][a2_0x5887('0x3c')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x5887('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn']('HOUR',exports[a2_0x5887('0x4')][a2_0x5887('0x33')](a2_0x5887('0x2f'))),exports['sequelize']['fn'](a2_0x5887('0x3d'),exports['sequelize'][a2_0x5887('0x33')](a2_0x5887('0x2f'))),exports[a2_0x5887('0x4')]['fn'](a2_0x5887('0x3e'),exports[a2_0x5887('0x4')][a2_0x5887('0x33')](a2_0x5887('0x2f'))),exports['sequelize']['fn']('YEAR',exports[a2_0x5887('0x4')][a2_0x5887('0x33')]('countingDate'))],'order':[[a2_0x5887('0x2f'),'ASC']]})['then'](_0x2daafe=>{_0x447ed6['json']({'data':_0x2daafe});});};exports[a2_0x5887('0x3f')]=(_0x2c2979,_0x43aada,_0x459e1a)=>{const _0x2714d3=_0x2c2979[a2_0x5887('0x40')][a2_0x5887('0x41')][a2_0x5887('0x42')](_0x2714d3=>_0x2714d3[a2_0x5887('0x43')]===a2_0x5887('0x44'));fbgraph_1[a2_0x5887('0x9')]['setAccessToken'](_0x2714d3[a2_0x5887('0x45')]);fbgraph_1[a2_0x5887('0x9')][a2_0x5887('0x1d')](_0x2c2979[a2_0x5887('0x40')][a2_0x5887('0x44')]+a2_0x5887('0x46'),(_0x434ab8,_0x216e6e)=>{if(_0x434ab8){return _0x459e1a(_0x434ab8);}_0x43aada[a2_0x5887('0x47')](a2_0x5887('0x48'),{'title':'Facebook\x20API','profile':_0x216e6e});});};