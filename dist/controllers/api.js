var a2_0x4158=['YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','sum','direction','HOUR','DAY','MONTH','getFacebook','user','tokens','find','kind','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','syncFtp','log','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','report_files','then','default','connected:','fileName','get','colombia/','end','media/','pipe','createWriteStream','save','Downloaded:\x20','.txt','readFile','utf8','CountingInfo','Out','parse','EndTime','pass_counting','create','status','getPassCounting','countingDate','ASC','query','month','startDate','findAll','amount','total','gte','params'];(function(_0x2490be,_0x4d02a8){var _0x483025=function(_0x3f5aa9){while(--_0x3f5aa9){_0x2490be['push'](_0x2490be['shift']());}};_0x483025(++_0x4d02a8);}(a2_0x4158,0x10b));var a2_0x5d8a=function(_0x25f6e2,_0x4998f0){_0x25f6e2=_0x25f6e2-0x0;var _0x1862ca=a2_0x4158[_0x25f6e2];return _0x1862ca;};'use strict';var __importDefault=this&&this[a2_0x5d8a('0x0')]||function(_0x12fbc6){return _0x12fbc6&&_0x12fbc6['__esModule']?_0x12fbc6:{'default':_0x12fbc6};};Object[a2_0x5d8a('0x1')](exports,a2_0x5d8a('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x5d8a('0x3')));const ftp_1=__importDefault(require(a2_0x5d8a('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x5d8a('0x5')]='';function setSequelize(_0xe0d245){exports['sequelize']=_0xe0d245;}exports[a2_0x5d8a('0x6')]=setSequelize;exports[a2_0x5d8a('0x7')]=(_0x1469b8,_0x12d3b9)=>{_0x12d3b9[a2_0x5d8a('0x8')]('api/index',{'title':'API\x20Examples'});};exports[a2_0x5d8a('0x9')]=(_0x44ca85,_0xa05468)=>{console[a2_0x5d8a('0xa')]('connecting');const _0x4c355f=[];const _0x5cbebb=new ftp_1['default']();_0x5cbebb['on'](a2_0x5d8a('0xb'),function(){console[a2_0x5d8a('0xa')](a2_0x5d8a('0xc'));_0x5cbebb[a2_0x5d8a('0xd')](a2_0x5d8a('0xe'),![],function(_0x802924,_0x32c30c){if(_0x802924){}else{for(const _0x5cf2b4 of _0x32c30c){console[a2_0x5d8a('0xa')](a2_0x5d8a('0xf')+_0x5cf2b4[a2_0x5d8a('0x10')]);if(_0x5cf2b4[a2_0x5d8a('0x10')][a2_0x5d8a('0x11')](a2_0x5d8a('0x12'))){exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x13')]['report_files'][a2_0x5d8a('0x14')]({'where':{'fileName':_0x5cf2b4[a2_0x5d8a('0x10')]}})['spread']((_0x4d63ac,_0x596c48)=>{if(_0x596c48){console[a2_0x5d8a('0xa')](_0x5cf2b4[a2_0x5d8a('0x10')]);_0x4c355f[a2_0x5d8a('0x15')](_0x4d63ac);}});}}}_0xa05468[a2_0x5d8a('0x12')]({'data':_0x4c355f});});});_0x5cbebb['on'](a2_0x5d8a('0x16'),function(_0x13544c){_0xa05468[a2_0x5d8a('0x12')]({'message':_0x13544c});});_0x5cbebb[a2_0x5d8a('0x17')]({'host':a2_0x5d8a('0x18'),'port':0x15,'user':a2_0x5d8a('0x19'),'password':a2_0x5d8a('0x19')});};exports[a2_0x5d8a('0x1a')]=(_0x3fbfc3,_0x121867)=>{exports[a2_0x5d8a('0x5')]['models'][a2_0x5d8a('0x1b')]['findOne']({'where':{'status':null}})[a2_0x5d8a('0x1c')](_0x21e458=>{if(_0x21e458){const _0x56d07a=new ftp_1[(a2_0x5d8a('0x1d'))]();_0x56d07a['on']('ready',function(){console[a2_0x5d8a('0xa')](a2_0x5d8a('0x1e')+_0x21e458[a2_0x5d8a('0x1f')]);_0x56d07a[a2_0x5d8a('0x20')](a2_0x5d8a('0x21')+_0x21e458[a2_0x5d8a('0x1f')],function(_0x47d704,_0x3ed24c){_0x56d07a[a2_0x5d8a('0x22')]();if(_0x47d704){}else{const _0x5092dd=a2_0x5d8a('0x23')+_0x21e458['fileName']+'.txt';_0x3ed24c[a2_0x5d8a('0x24')](fs_1[a2_0x5d8a('0x1d')][a2_0x5d8a('0x25')](_0x5092dd));_0x21e458['status']=0x1;_0x21e458[a2_0x5d8a('0x26')]();console[a2_0x5d8a('0xa')](a2_0x5d8a('0x27')+_0x21e458[a2_0x5d8a('0x1f')]);}});});_0x56d07a['on'](a2_0x5d8a('0x16'),function(_0x3ad3a5){_0x121867[a2_0x5d8a('0x12')]({'message':_0x3ad3a5});});_0x56d07a['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x5d8a('0x19'),'password':a2_0x5d8a('0x19')});_0x121867['json']({'data':_0x21e458['fileName']});}else{_0x121867[a2_0x5d8a('0x12')]({'data':[]});}});};exports['processFtp']=(_0x328e5e,_0x3b6aaf)=>{exports['sequelize'][a2_0x5d8a('0x13')][a2_0x5d8a('0x1b')]['findOne']({'where':{'status':0x1}})[a2_0x5d8a('0x1c')](_0x2c47ae=>{if(_0x2c47ae){const _0x359b4a='media/'+_0x2c47ae['fileName']+a2_0x5d8a('0x28');fs_1['default'][a2_0x5d8a('0x29')](_0x359b4a,a2_0x5d8a('0x2a'),function(_0x5b9cb6,_0x29775f){if(_0x5b9cb6){_0x2c47ae['status']=null;}else{try{const _0x40d060=JSON['parse'](_0x29775f);for(const _0x19600d of _0x40d060['Data'][0x0][a2_0x5d8a('0x2b')]){const _0x5c6ff3=_0x19600d['In'];const _0x5cf164=_0x19600d[a2_0x5d8a('0x2c')];const _0x15fed4=Date[a2_0x5d8a('0x2d')](_0x19600d[a2_0x5d8a('0x2e')]);if(_0x5c6ff3>0x0){exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x13')][a2_0x5d8a('0x2f')][a2_0x5d8a('0x30')]({'reportFileId':_0x2c47ae['id'],'amount':_0x5c6ff3,'countingDate':_0x15fed4});}if(_0x5cf164>0x0){exports['sequelize']['models'][a2_0x5d8a('0x2f')][a2_0x5d8a('0x30')]({'reportFileId':_0x2c47ae['id'],'amount':_0x5cf164*-0x1,'countingDate':_0x15fed4});}}_0x2c47ae['status']=0x2;}catch(_0x51dea7){_0x2c47ae[a2_0x5d8a('0x31')]=null;}}_0x2c47ae[a2_0x5d8a('0x26')]();});_0x3b6aaf[a2_0x5d8a('0x12')]({'data':_0x2c47ae[a2_0x5d8a('0x1f')]});}else{_0x3b6aaf[a2_0x5d8a('0x12')]({'data':[]});}});};exports[a2_0x5d8a('0x32')]=(_0x5492b0,_0x5f3b45)=>{exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x13')][a2_0x5d8a('0x2f')]['findAll']({'where':{'amount':{[exports[a2_0x5d8a('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x5d8a('0x33'),a2_0x5d8a('0x34')]]})['then'](_0x2a8260=>{_0x5f3b45['json']({'data':_0x2a8260});});};exports['getPassCountingByDay']=(_0x1368b2,_0x1a84f3)=>{const _0x5dcaa8=_0x1368b2[a2_0x5d8a('0x35')][a2_0x5d8a('0x36')];const _0x161756=_0x1368b2['query'][a2_0x5d8a('0x37')];const _0x39036d=_0x1368b2['query']['endDate'];exports[a2_0x5d8a('0x5')]['models'][a2_0x5d8a('0x2f')][a2_0x5d8a('0x38')]({'attributes':[a2_0x5d8a('0x33'),[exports[a2_0x5d8a('0x5')]['fn']('sum',exports[a2_0x5d8a('0x5')]['col'](a2_0x5d8a('0x39'))),a2_0x5d8a('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x5d8a('0x3b')]]:_0x161756,[exports[a2_0x5d8a('0x5')]['Op']['lt']]:_0x39036d},'amount':_0x1368b2[a2_0x5d8a('0x3c')]['direction']=='in'?{[exports[a2_0x5d8a('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['literal'](a2_0x5d8a('0x3d'))],'order':[[a2_0x5d8a('0x33'),a2_0x5d8a('0x34')]]})[a2_0x5d8a('0x1c')](_0x48b2fa=>{_0x1a84f3['json']({'data':_0x48b2fa});});};exports[a2_0x5d8a('0x3e')]=(_0x492240,_0x110891)=>{const _0x3d67f0=_0x492240['query'][a2_0x5d8a('0x36')];const _0x36db47=_0x492240[a2_0x5d8a('0x35')]['startDate'];const _0x4b6584=_0x492240[a2_0x5d8a('0x35')]['endDate'];exports[a2_0x5d8a('0x5')]['models'][a2_0x5d8a('0x2f')][a2_0x5d8a('0x38')]({'attributes':[a2_0x5d8a('0x33'),[exports['sequelize']['fn'](a2_0x5d8a('0x3f'),exports['sequelize'][a2_0x5d8a('0x40')](a2_0x5d8a('0x33')),a2_0x5d8a('0x41')),a2_0x5d8a('0x42')],[exports[a2_0x5d8a('0x5')]['fn'](a2_0x5d8a('0x43'),exports[a2_0x5d8a('0x5')]['col'](a2_0x5d8a('0x39'))),a2_0x5d8a('0x3a')]],'where':{'countingDate':{[exports[a2_0x5d8a('0x5')]['Op']['gte']]:_0x36db47,[exports[a2_0x5d8a('0x5')]['Op']['lt']]:_0x4b6584},'amount':_0x492240[a2_0x5d8a('0x3c')][a2_0x5d8a('0x44')]=='in'?{[exports[a2_0x5d8a('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x5d8a('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x5d8a('0x45'),exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x40')]('countingDate')),exports[a2_0x5d8a('0x5')]['fn'](a2_0x5d8a('0x46'),exports[a2_0x5d8a('0x5')]['col']('countingDate')),exports[a2_0x5d8a('0x5')]['fn'](a2_0x5d8a('0x47'),exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x40')](a2_0x5d8a('0x33'))),exports[a2_0x5d8a('0x5')]['fn']('YEAR',exports[a2_0x5d8a('0x5')][a2_0x5d8a('0x40')](a2_0x5d8a('0x33')))],'order':[['countingDate',a2_0x5d8a('0x34')]]})[a2_0x5d8a('0x1c')](_0x215ab6=>{_0x110891['json']({'data':_0x215ab6});});};exports[a2_0x5d8a('0x48')]=(_0x13781a,_0x181c53,_0x3256c0)=>{const _0x416533=_0x13781a[a2_0x5d8a('0x49')][a2_0x5d8a('0x4a')][a2_0x5d8a('0x4b')](_0x416533=>_0x416533[a2_0x5d8a('0x4c')]===a2_0x5d8a('0x4d'));fbgraph_1['default'][a2_0x5d8a('0x4e')](_0x416533['accessToken']);fbgraph_1[a2_0x5d8a('0x1d')][a2_0x5d8a('0x20')](_0x13781a['user'][a2_0x5d8a('0x4d')]+a2_0x5d8a('0x4f'),(_0x306a4f,_0x347a23)=>{if(_0x306a4f){return _0x3256c0(_0x306a4f);}_0x181c53[a2_0x5d8a('0x8')](a2_0x5d8a('0x50'),{'title':a2_0x5d8a('0x51'),'profile':_0x347a23});});};