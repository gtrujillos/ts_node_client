var a2_0x47fd=['default','get','fileName','end','.txt','pipe','status','then','media/','readFile','utf8','parse','CountingInfo','pass_counting','create','save','getPassCounting','findAll','countingDate','ASC','query','month','startDate','endDate','amount','total','gte','params','literal','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','col','MONTH','YEAR','getFacebook','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','api/index','API\x20Examples','log','connecting','ready','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne'];(function(_0x4c42bb,_0x46a7da){var _0x2efb53=function(_0x142504){while(--_0x142504){_0x4c42bb['push'](_0x4c42bb['shift']());}};_0x2efb53(++_0x46a7da);}(a2_0x47fd,0x1a5));var a2_0x430d=function(_0x15d9f5,_0xefd543){_0x15d9f5=_0x15d9f5-0x0;var _0x9725b2=a2_0x47fd[_0x15d9f5];return _0x9725b2;};'use strict';var __importDefault=this&&this[a2_0x430d('0x0')]||function(_0x1a9ea5){return _0x1a9ea5&&_0x1a9ea5[a2_0x430d('0x1')]?_0x1a9ea5:{'default':_0x1a9ea5};};Object[a2_0x430d('0x2')](exports,a2_0x430d('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x430d('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x430d('0x4')]='';function setSequelize(_0x30725f){exports[a2_0x430d('0x4')]=_0x30725f;}exports[a2_0x430d('0x5')]=setSequelize;exports[a2_0x430d('0x6')]=(_0x1c5296,_0x3c6316)=>{_0x3c6316['render'](a2_0x430d('0x7'),{'title':a2_0x430d('0x8')});};exports['syncFtp']=(_0x478cac,_0x26a7c6)=>{console[a2_0x430d('0x9')](a2_0x430d('0xa'));const _0x1c904=[];const _0x4773f0=new ftp_1['default']();_0x4773f0['on'](a2_0x430d('0xb'),function(){console['log']('connected');_0x4773f0[a2_0x430d('0xc')](a2_0x430d('0xd'),![],function(_0x37f1b4,_0x4c4e05){if(_0x37f1b4){}else{for(const _0x3c8dc5 of _0x4c4e05){console['log'](a2_0x430d('0xe')+_0x3c8dc5[a2_0x430d('0xf')]);if(_0x3c8dc5[a2_0x430d('0xf')][a2_0x430d('0x10')](a2_0x430d('0x11'))){exports[a2_0x430d('0x4')][a2_0x430d('0x12')][a2_0x430d('0x13')][a2_0x430d('0x14')]({'where':{'fileName':_0x3c8dc5[a2_0x430d('0xf')]}})[a2_0x430d('0x15')]((_0x479993,_0x2f4b75)=>{if(_0x2f4b75){console['log'](_0x3c8dc5['name']);_0x1c904[a2_0x430d('0x16')](_0x479993);}});}}}_0x26a7c6[a2_0x430d('0x11')]({'data':_0x1c904});});});_0x4773f0['on'](a2_0x430d('0x17'),function(_0xc01cbb){_0x26a7c6['json']({'message':_0xc01cbb});});_0x4773f0[a2_0x430d('0x18')]({'host':a2_0x430d('0x19'),'port':0x15,'user':a2_0x430d('0x1a'),'password':a2_0x430d('0x1a')});};exports[a2_0x430d('0x1b')]=(_0x108ead,_0x4d6fce)=>{exports[a2_0x430d('0x4')][a2_0x430d('0x12')][a2_0x430d('0x13')][a2_0x430d('0x1c')]({'where':{'status':null}})['then'](_0x200eda=>{if(_0x200eda){const _0x448fd6=new ftp_1[(a2_0x430d('0x1d'))]();_0x448fd6['on']('ready',function(){console[a2_0x430d('0x9')]('connected:'+_0x200eda['fileName']);_0x448fd6[a2_0x430d('0x1e')]('colombia/'+_0x200eda[a2_0x430d('0x1f')],function(_0x4b48bf,_0x962b6d){_0x448fd6[a2_0x430d('0x20')]();if(_0x4b48bf){}else{const _0x55054e='media/'+_0x200eda['fileName']+a2_0x430d('0x21');_0x962b6d[a2_0x430d('0x22')](fs_1[a2_0x430d('0x1d')]['createWriteStream'](_0x55054e));_0x200eda[a2_0x430d('0x23')]=0x1;_0x200eda['save']();console['log']('Downloaded:\x20'+_0x200eda[a2_0x430d('0x1f')]);}});});_0x448fd6['on'](a2_0x430d('0x17'),function(_0xebb240){_0x4d6fce['json']({'message':_0xebb240});});_0x448fd6[a2_0x430d('0x18')]({'host':a2_0x430d('0x19'),'port':0x15,'user':'ipd','password':a2_0x430d('0x1a')});_0x4d6fce['json']({'data':_0x200eda['fileName']});}else{_0x4d6fce[a2_0x430d('0x11')]({'data':[]});}});};exports['processFtp']=(_0x3ec309,_0x5e6de5)=>{exports[a2_0x430d('0x4')][a2_0x430d('0x12')][a2_0x430d('0x13')][a2_0x430d('0x1c')]({'where':{'status':0x1}})[a2_0x430d('0x24')](_0x3036e4=>{if(_0x3036e4){const _0x46f3b3=a2_0x430d('0x25')+_0x3036e4['fileName']+'.txt';fs_1['default'][a2_0x430d('0x26')](_0x46f3b3,a2_0x430d('0x27'),function(_0x564301,_0x28437d){if(_0x564301){_0x3036e4[a2_0x430d('0x23')]=null;}else{try{const _0x160e64=JSON[a2_0x430d('0x28')](_0x28437d);for(const _0x257d18 of _0x160e64['Data'][0x0][a2_0x430d('0x29')]){const _0x3e8ee3=_0x257d18['In'];const _0x546513=_0x257d18['Out'];const _0x2f5088=Date[a2_0x430d('0x28')](_0x257d18['EndTime']);if(_0x3e8ee3>0x0){exports[a2_0x430d('0x4')][a2_0x430d('0x12')][a2_0x430d('0x2a')][a2_0x430d('0x2b')]({'reportFileId':_0x3036e4['id'],'amount':_0x3e8ee3,'countingDate':_0x2f5088});}if(_0x546513>0x0){exports[a2_0x430d('0x4')]['models'][a2_0x430d('0x2a')][a2_0x430d('0x2b')]({'reportFileId':_0x3036e4['id'],'amount':_0x546513*-0x1,'countingDate':_0x2f5088});}}_0x3036e4[a2_0x430d('0x23')]=0x2;}catch(_0x4820f7){_0x3036e4['status']=null;}}_0x3036e4[a2_0x430d('0x2c')]();});_0x5e6de5['json']({'data':_0x3036e4['fileName']});}else{_0x5e6de5['json']({'data':[]});}});};exports[a2_0x430d('0x2d')]=(_0x7f1a33,_0x425055)=>{exports[a2_0x430d('0x4')]['models'][a2_0x430d('0x2a')][a2_0x430d('0x2e')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x430d('0x2f'),a2_0x430d('0x30')]]})[a2_0x430d('0x24')](_0x289c99=>{_0x425055[a2_0x430d('0x11')]({'data':_0x289c99});});};exports['getPassCountingByDay']=(_0x41d36d,_0x207fbd)=>{const _0x524a4c=_0x41d36d[a2_0x430d('0x31')][a2_0x430d('0x32')];const _0x239932=_0x41d36d[a2_0x430d('0x31')][a2_0x430d('0x33')];const _0x342423=_0x41d36d[a2_0x430d('0x31')][a2_0x430d('0x34')];exports['sequelize'][a2_0x430d('0x12')][a2_0x430d('0x2a')][a2_0x430d('0x2e')]({'attributes':[a2_0x430d('0x2f'),[exports[a2_0x430d('0x4')]['fn']('sum',exports[a2_0x430d('0x4')]['col'](a2_0x430d('0x35'))),a2_0x430d('0x36')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x430d('0x37')]]:_0x239932,[exports[a2_0x430d('0x4')]['Op']['lt']]:_0x342423},'amount':_0x41d36d[a2_0x430d('0x38')]['direction']=='in'?{[exports[a2_0x430d('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x430d('0x39')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x430d('0x2f'),a2_0x430d('0x30')]]})['then'](_0x442da9=>{_0x207fbd[a2_0x430d('0x11')]({'data':_0x442da9});});};exports[a2_0x430d('0x3a')]=(_0x16ccaa,_0x355ae8)=>{const _0x341310=_0x16ccaa['query'][a2_0x430d('0x32')];const _0x4f7c38=_0x16ccaa[a2_0x430d('0x31')][a2_0x430d('0x33')];const _0x3db9b7=_0x16ccaa[a2_0x430d('0x31')][a2_0x430d('0x34')];exports['sequelize'][a2_0x430d('0x12')][a2_0x430d('0x2a')][a2_0x430d('0x2e')]({'attributes':[a2_0x430d('0x2f'),[exports[a2_0x430d('0x4')]['fn'](a2_0x430d('0x3b'),exports[a2_0x430d('0x4')]['col'](a2_0x430d('0x2f')),a2_0x430d('0x3c')),a2_0x430d('0x3d')],[exports[a2_0x430d('0x4')]['fn'](a2_0x430d('0x3e'),exports['sequelize'][a2_0x430d('0x3f')](a2_0x430d('0x35'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x430d('0x37')]]:_0x4f7c38,[exports['sequelize']['Op']['lt']]:_0x3db9b7},'amount':_0x16ccaa[a2_0x430d('0x38')]['direction']=='in'?{[exports[a2_0x430d('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x430d('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn']('HOUR',exports['sequelize'][a2_0x430d('0x3f')](a2_0x430d('0x2f'))),exports['sequelize']['fn']('DAY',exports[a2_0x430d('0x4')]['col'](a2_0x430d('0x2f'))),exports[a2_0x430d('0x4')]['fn'](a2_0x430d('0x40'),exports['sequelize']['col']('countingDate')),exports[a2_0x430d('0x4')]['fn'](a2_0x430d('0x41'),exports[a2_0x430d('0x4')]['col'](a2_0x430d('0x2f')))],'order':[[a2_0x430d('0x2f'),a2_0x430d('0x30')]]})[a2_0x430d('0x24')](_0x1506ba=>{_0x355ae8[a2_0x430d('0x11')]({'data':_0x1506ba});});};exports[a2_0x430d('0x42')]=(_0x1a7ffe,_0x5c72e8,_0x3f539e)=>{const _0x2a3f7f=_0x1a7ffe['user'][a2_0x430d('0x43')][a2_0x430d('0x44')](_0x2a3f7f=>_0x2a3f7f[a2_0x430d('0x45')]===a2_0x430d('0x46'));fbgraph_1['default'][a2_0x430d('0x47')](_0x2a3f7f[a2_0x430d('0x48')]);fbgraph_1[a2_0x430d('0x1d')][a2_0x430d('0x1e')](_0x1a7ffe['user']['facebook']+a2_0x430d('0x49'),(_0x4d1035,_0xcd1864)=>{if(_0x4d1035){return _0x3f539e(_0x4d1035);}_0x5c72e8[a2_0x430d('0x4a')]('api/facebook',{'title':'Facebook\x20API','profile':_0xcd1864});});};