var a2_0x2d57=['error','connect','ftp.vivotek.com','ipd','downloadFtp','report_files','findOne','then','get','fileName','end','.txt','pipe','status','save','Downloaded:\x20','processFtp','media/','readFile','parse','Data','CountingInfo','Out','EndTime','pass_counting','create','countingDate','ASC','getPassCountingByDay','query','month','startDate','findAll','sum','col','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','%Y-%m-%d\x20%H:00','countingDateShort','amount','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','syncFtp','default','ready','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','findOrCreate','push'];(function(_0xcc1598,_0xb8f70a){var _0x1fbd4d=function(_0x1ba692){while(--_0x1ba692){_0xcc1598['push'](_0xcc1598['shift']());}};_0x1fbd4d(++_0xb8f70a);}(a2_0x2d57,0x18c));var a2_0x3216=function(_0x365d20,_0x3fea43){_0x365d20=_0x365d20-0x0;var _0x37d617=a2_0x2d57[_0x365d20];return _0x37d617;};'use strict';var __importDefault=this&&this[a2_0x3216('0x0')]||function(_0x43cba4){return _0x43cba4&&_0x43cba4[a2_0x3216('0x1')]?_0x43cba4:{'default':_0x43cba4};};Object[a2_0x3216('0x2')](exports,a2_0x3216('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x3216('0x3')));const ftp_1=__importDefault(require(a2_0x3216('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x3216('0x5')]='';function setSequelize(_0x2191bd){exports[a2_0x3216('0x5')]=_0x2191bd;}exports[a2_0x3216('0x6')]=setSequelize;exports[a2_0x3216('0x7')]=(_0x2f45cd,_0x49d5dc)=>{_0x49d5dc[a2_0x3216('0x8')](a2_0x3216('0x9'),{'title':'API\x20Examples'});};exports[a2_0x3216('0xa')]=(_0xb88bd8,_0x256155)=>{console['log']('connecting');const _0x2e8499=[];const _0x50dafc=new ftp_1[(a2_0x3216('0xb'))]();_0x50dafc['on'](a2_0x3216('0xc'),function(){console[a2_0x3216('0xd')](a2_0x3216('0xe'));_0x50dafc[a2_0x3216('0xf')](a2_0x3216('0x10'),![],function(_0x64bbbf,_0x25445a){if(_0x64bbbf){}else{for(const _0xa27a42 of _0x25445a){console['log'](a2_0x3216('0x11')+_0xa27a42[a2_0x3216('0x12')]);if(_0xa27a42['name'][a2_0x3216('0x13')](a2_0x3216('0x14'))){exports[a2_0x3216('0x5')][a2_0x3216('0x15')]['report_files'][a2_0x3216('0x16')]({'where':{'fileName':_0xa27a42[a2_0x3216('0x12')]}})['spread']((_0x3e970c,_0x465e41)=>{if(_0x465e41){console['log'](_0xa27a42[a2_0x3216('0x12')]);_0x2e8499[a2_0x3216('0x17')](_0x3e970c);}});}}}_0x256155[a2_0x3216('0x14')]({'data':_0x2e8499});});});_0x50dafc['on'](a2_0x3216('0x18'),function(_0x199e18){_0x256155[a2_0x3216('0x14')]({'message':_0x199e18});});_0x50dafc[a2_0x3216('0x19')]({'host':a2_0x3216('0x1a'),'port':0x15,'user':a2_0x3216('0x1b'),'password':a2_0x3216('0x1b')});};exports[a2_0x3216('0x1c')]=(_0x1859ba,_0x57ada6)=>{exports[a2_0x3216('0x5')][a2_0x3216('0x15')][a2_0x3216('0x1d')][a2_0x3216('0x1e')]({'where':{'status':null}})[a2_0x3216('0x1f')](_0x427105=>{if(_0x427105){const _0x4a4805=new ftp_1[(a2_0x3216('0xb'))]();_0x4a4805['on']('ready',function(){console[a2_0x3216('0xd')]('connected:'+_0x427105['fileName']);_0x4a4805[a2_0x3216('0x20')]('colombia/'+_0x427105[a2_0x3216('0x21')],function(_0x131c68,_0x2aaf3a){_0x4a4805[a2_0x3216('0x22')]();if(_0x131c68){}else{const _0x21d035='media/'+_0x427105[a2_0x3216('0x21')]+a2_0x3216('0x23');_0x2aaf3a[a2_0x3216('0x24')](fs_1[a2_0x3216('0xb')]['createWriteStream'](_0x21d035));_0x427105[a2_0x3216('0x25')]=0x1;_0x427105[a2_0x3216('0x26')]();console[a2_0x3216('0xd')](a2_0x3216('0x27')+_0x427105['fileName']);}});});_0x4a4805['on'](a2_0x3216('0x18'),function(_0x906388){_0x57ada6[a2_0x3216('0x14')]({'message':_0x906388});});_0x4a4805[a2_0x3216('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x3216('0x1b'),'password':a2_0x3216('0x1b')});_0x57ada6['json']({'data':_0x427105[a2_0x3216('0x21')]});}else{_0x57ada6['json']({'data':[]});}});};exports[a2_0x3216('0x28')]=(_0x4eb7b7,_0x1e1fbd)=>{exports[a2_0x3216('0x5')]['models'][a2_0x3216('0x1d')][a2_0x3216('0x1e')]({'where':{'status':0x1}})['then'](_0x471e7c=>{if(_0x471e7c){const _0x5d39c7=a2_0x3216('0x29')+_0x471e7c[a2_0x3216('0x21')]+a2_0x3216('0x23');fs_1[a2_0x3216('0xb')][a2_0x3216('0x2a')](_0x5d39c7,'utf8',function(_0x24e358,_0x28d84e){if(_0x24e358){_0x471e7c[a2_0x3216('0x25')]=null;}else{try{const _0x245684=JSON[a2_0x3216('0x2b')](_0x28d84e);for(const _0x501372 of _0x245684[a2_0x3216('0x2c')][0x0][a2_0x3216('0x2d')]){const _0x10cc65=_0x501372['In'];const _0x1a6005=_0x501372[a2_0x3216('0x2e')];const _0x3e7868=Date[a2_0x3216('0x2b')](_0x501372[a2_0x3216('0x2f')]);if(_0x10cc65>0x0){exports[a2_0x3216('0x5')]['models']['pass_counting']['create']({'reportFileId':_0x471e7c['id'],'amount':_0x10cc65,'countingDate':_0x3e7868});}if(_0x1a6005>0x0){exports[a2_0x3216('0x5')][a2_0x3216('0x15')][a2_0x3216('0x30')][a2_0x3216('0x31')]({'reportFileId':_0x471e7c['id'],'amount':_0x1a6005*-0x1,'countingDate':_0x3e7868});}}_0x471e7c[a2_0x3216('0x25')]=0x2;}catch(_0xaefd9){_0x471e7c[a2_0x3216('0x25')]=null;}}_0x471e7c[a2_0x3216('0x26')]();});_0x1e1fbd[a2_0x3216('0x14')]({'data':_0x471e7c[a2_0x3216('0x21')]});}else{_0x1e1fbd[a2_0x3216('0x14')]({'data':[]});}});};exports['getPassCounting']=(_0x58ee76,_0xeb44b1)=>{exports[a2_0x3216('0x5')][a2_0x3216('0x15')]['pass_counting']['findAll']({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x3216('0x32'),a2_0x3216('0x33')]]})[a2_0x3216('0x1f')](_0x4a334b=>{_0xeb44b1['json']({'data':_0x4a334b});});};exports[a2_0x3216('0x34')]=(_0x4433f3,_0x550412)=>{const _0x55223e=_0x4433f3[a2_0x3216('0x35')][a2_0x3216('0x36')];const _0x8c753=_0x4433f3['query'][a2_0x3216('0x37')];const _0x21c4d6=_0x4433f3[a2_0x3216('0x35')]['endDate'];exports['sequelize'][a2_0x3216('0x15')][a2_0x3216('0x30')][a2_0x3216('0x38')]({'attributes':[a2_0x3216('0x32'),[exports[a2_0x3216('0x5')]['fn'](a2_0x3216('0x39'),exports[a2_0x3216('0x5')][a2_0x3216('0x3a')]('amount')),a2_0x3216('0x3b')]],'where':{'countingDate':{[exports[a2_0x3216('0x5')]['Op'][a2_0x3216('0x3c')]]:_0x8c753,[exports[a2_0x3216('0x5')]['Op']['lt']]:_0x21c4d6},'amount':_0x4433f3[a2_0x3216('0x3d')][a2_0x3216('0x3e')]=='in'?{[exports[a2_0x3216('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x3216('0x5')]['Op']['lt']]:0x0}},'group':[exports[a2_0x3216('0x5')][a2_0x3216('0x3f')](a2_0x3216('0x40'))],'order':[[a2_0x3216('0x32'),a2_0x3216('0x33')]]})['then'](_0x20400d=>{_0x550412['json']({'data':_0x20400d});});};exports[a2_0x3216('0x41')]=(_0x320119,_0x36afe4)=>{const _0x559874=_0x320119[a2_0x3216('0x35')][a2_0x3216('0x36')];const _0x37d94d=_0x320119[a2_0x3216('0x35')]['startDate'];const _0x18df2c=_0x320119[a2_0x3216('0x35')][a2_0x3216('0x42')];exports[a2_0x3216('0x5')][a2_0x3216('0x15')][a2_0x3216('0x30')]['findAll']({'attributes':[a2_0x3216('0x32'),[exports[a2_0x3216('0x5')]['fn']('DATE_FORMAT',exports[a2_0x3216('0x5')][a2_0x3216('0x3a')](a2_0x3216('0x32')),a2_0x3216('0x43')),a2_0x3216('0x44')],[exports[a2_0x3216('0x5')]['fn'](a2_0x3216('0x39'),exports[a2_0x3216('0x5')][a2_0x3216('0x3a')](a2_0x3216('0x45'))),a2_0x3216('0x3b')]],'where':{'countingDate':{[exports[a2_0x3216('0x5')]['Op'][a2_0x3216('0x3c')]]:_0x37d94d,[exports['sequelize']['Op']['lt']]:_0x18df2c},'amount':_0x320119[a2_0x3216('0x3d')][a2_0x3216('0x3e')]=='in'?{[exports[a2_0x3216('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x3216('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x3216('0x46'),exports[a2_0x3216('0x5')][a2_0x3216('0x3a')]('countingDate')),exports[a2_0x3216('0x5')]['fn'](a2_0x3216('0x47'),exports[a2_0x3216('0x5')][a2_0x3216('0x3a')](a2_0x3216('0x32'))),exports[a2_0x3216('0x5')]['fn'](a2_0x3216('0x48'),exports[a2_0x3216('0x5')]['col'](a2_0x3216('0x32'))),exports[a2_0x3216('0x5')]['fn'](a2_0x3216('0x49'),exports[a2_0x3216('0x5')][a2_0x3216('0x3a')](a2_0x3216('0x32')))],'order':[[a2_0x3216('0x32'),a2_0x3216('0x33')]]})[a2_0x3216('0x1f')](_0xe04d67=>{_0x36afe4[a2_0x3216('0x14')]({'data':_0xe04d67});});};exports[a2_0x3216('0x4a')]=(_0x365e04,_0x31a0ea,_0x8249db)=>{const _0x22ab7f=_0x365e04[a2_0x3216('0x4b')][a2_0x3216('0x4c')][a2_0x3216('0x4d')](_0x22ab7f=>_0x22ab7f[a2_0x3216('0x4e')]===a2_0x3216('0x4f'));fbgraph_1['default'][a2_0x3216('0x50')](_0x22ab7f[a2_0x3216('0x51')]);fbgraph_1[a2_0x3216('0xb')][a2_0x3216('0x20')](_0x365e04['user'][a2_0x3216('0x4f')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x8ebcbe,_0x53d2ef)=>{if(_0x8ebcbe){return _0x8249db(_0x8ebcbe);}_0x31a0ea['render'](a2_0x3216('0x52'),{'title':a2_0x3216('0x53'),'profile':_0x53d2ef});});};