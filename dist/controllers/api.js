var a2_0x555e=['utf8','status','parse','Data','CountingInfo','EndTime','create','models','pass_counting','getPassCounting','findAll','countingDate','month','startDate','query','endDate','col','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','countingDateShort','sum','params','HOUR','DAY','MONTH','YEAR','ASC','user','tokens','kind','facebook','setAccessToken','accessToken','get','Facebook\x20API','__importDefault','__esModule','defineProperty','ftp','sequelize','setSequelize','render','API\x20Examples','log','default','ready','colombia','name','endsWith','report_files','spread','push','json','error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','fileName','media/','.txt','createWriteStream','save','Downloaded:\x20','processFtp','readFile'];(function(_0x2f4d0b,_0x331ef4){var _0x218d38=function(_0x496827){while(--_0x496827){_0x2f4d0b['push'](_0x2f4d0b['shift']());}};_0x218d38(++_0x331ef4);}(a2_0x555e,0xbd));var a2_0x207b=function(_0x2be9f1,_0x3e91ce){_0x2be9f1=_0x2be9f1-0x0;var _0x3fbb94=a2_0x555e[_0x2be9f1];return _0x3fbb94;};'use strict';var __importDefault=this&&this[a2_0x207b('0x0')]||function(_0x4c8462){return _0x4c8462&&_0x4c8462[a2_0x207b('0x1')]?_0x4c8462:{'default':_0x4c8462};};Object[a2_0x207b('0x2')](exports,a2_0x207b('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a2_0x207b('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x207b('0x4')]='';function setSequelize(_0x100b3f){exports['sequelize']=_0x100b3f;}exports[a2_0x207b('0x5')]=setSequelize;exports['getApi']=(_0x59477d,_0x405b95)=>{_0x405b95[a2_0x207b('0x6')]('api/index',{'title':a2_0x207b('0x7')});};exports['syncFtp']=(_0x37baf5,_0xf7417d)=>{console[a2_0x207b('0x8')]('connecting');const _0x155f46=[];const _0x2f694f=new ftp_1[(a2_0x207b('0x9'))]();_0x2f694f['on'](a2_0x207b('0xa'),function(){console[a2_0x207b('0x8')]('connected');_0x2f694f['list'](a2_0x207b('0xb'),![],function(_0x466c3d,_0x5c7e16){if(_0x466c3d){}else{for(const _0x4d794a of _0x5c7e16){console[a2_0x207b('0x8')]('Downloading:\x20'+_0x4d794a[a2_0x207b('0xc')]);if(_0x4d794a['name'][a2_0x207b('0xd')]('json')){exports[a2_0x207b('0x4')]['models'][a2_0x207b('0xe')]['findOrCreate']({'where':{'fileName':_0x4d794a[a2_0x207b('0xc')]}})[a2_0x207b('0xf')]((_0xfd78d,_0xa6d7ca)=>{if(_0xa6d7ca){console[a2_0x207b('0x8')](_0x4d794a[a2_0x207b('0xc')]);_0x155f46[a2_0x207b('0x10')](_0xfd78d);}});}}}_0xf7417d[a2_0x207b('0x11')]({'data':_0x155f46});});});_0x2f694f['on'](a2_0x207b('0x12'),function(_0x2b4611){_0xf7417d[a2_0x207b('0x11')]({'message':_0x2b4611});});_0x2f694f[a2_0x207b('0x13')]({'host':a2_0x207b('0x14'),'port':0x15,'user':a2_0x207b('0x15'),'password':a2_0x207b('0x15')});};exports['downloadFtp']=(_0x20daca,_0x5ef478)=>{exports['sequelize']['models'][a2_0x207b('0xe')][a2_0x207b('0x16')]({'where':{'status':null}})[a2_0x207b('0x17')](_0x12e8a3=>{if(_0x12e8a3){const _0x5c8b3c=new ftp_1[(a2_0x207b('0x9'))]();_0x5c8b3c['on'](a2_0x207b('0xa'),function(){console[a2_0x207b('0x8')](a2_0x207b('0x18')+_0x12e8a3[a2_0x207b('0x19')]);_0x5c8b3c['get']('colombia/'+_0x12e8a3[a2_0x207b('0x19')],function(_0x4a2002,_0x3c03de){_0x5c8b3c['end']();if(_0x4a2002){}else{const _0x1631c6=a2_0x207b('0x1a')+_0x12e8a3['fileName']+a2_0x207b('0x1b');_0x3c03de['pipe'](fs_1[a2_0x207b('0x9')][a2_0x207b('0x1c')](_0x1631c6));_0x12e8a3['status']=0x1;_0x12e8a3[a2_0x207b('0x1d')]();console[a2_0x207b('0x8')](a2_0x207b('0x1e')+_0x12e8a3['fileName']);}});});_0x5c8b3c['on'](a2_0x207b('0x12'),function(_0x3b9e2f){_0x5ef478[a2_0x207b('0x11')]({'message':_0x3b9e2f});});_0x5c8b3c[a2_0x207b('0x13')]({'host':a2_0x207b('0x14'),'port':0x15,'user':a2_0x207b('0x15'),'password':a2_0x207b('0x15')});_0x5ef478[a2_0x207b('0x11')]({'data':_0x12e8a3[a2_0x207b('0x19')]});}else{_0x5ef478[a2_0x207b('0x11')]({'data':[]});}});};exports[a2_0x207b('0x1f')]=(_0x1f3237,_0x3f16a3)=>{exports['sequelize']['models'][a2_0x207b('0xe')][a2_0x207b('0x16')]({'where':{'status':0x1}})[a2_0x207b('0x17')](_0x56f294=>{if(_0x56f294){const _0x2f26ae=a2_0x207b('0x1a')+_0x56f294[a2_0x207b('0x19')]+a2_0x207b('0x1b');fs_1[a2_0x207b('0x9')][a2_0x207b('0x20')](_0x2f26ae,a2_0x207b('0x21'),function(_0x5bfaa4,_0xe76676){if(_0x5bfaa4){_0x56f294[a2_0x207b('0x22')]=null;}else{try{const _0x818f61=JSON[a2_0x207b('0x23')](_0xe76676);for(const _0x313902 of _0x818f61[a2_0x207b('0x24')][0x0][a2_0x207b('0x25')]){const _0x4f6b7b=_0x313902['In'];const _0x5b992a=_0x313902['Out'];const _0x422f3c=Date[a2_0x207b('0x23')](_0x313902[a2_0x207b('0x26')]);if(_0x4f6b7b>0x0){exports[a2_0x207b('0x4')]['models']['pass_counting'][a2_0x207b('0x27')]({'reportFileId':_0x56f294['id'],'amount':_0x4f6b7b,'countingDate':_0x422f3c});}if(_0x5b992a>0x0){exports[a2_0x207b('0x4')][a2_0x207b('0x28')][a2_0x207b('0x29')][a2_0x207b('0x27')]({'reportFileId':_0x56f294['id'],'amount':_0x5b992a*-0x1,'countingDate':_0x422f3c});}}_0x56f294['status']=0x2;}catch(_0x328964){_0x56f294['status']=null;}}_0x56f294[a2_0x207b('0x1d')]();});_0x3f16a3['json']({'data':_0x56f294[a2_0x207b('0x19')]});}else{_0x3f16a3['json']({'data':[]});}});};exports[a2_0x207b('0x2a')]=(_0x3449b1,_0x39092e)=>{exports['sequelize'][a2_0x207b('0x28')]['pass_counting'][a2_0x207b('0x2b')]({'where':{'amount':{[exports[a2_0x207b('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x207b('0x2c'),'ASC']]})[a2_0x207b('0x17')](_0x199a85=>{_0x39092e[a2_0x207b('0x11')]({'data':_0x199a85});});};exports['getPassCountingByDay']=(_0x11ef3b,_0x1f4428)=>{const _0x3e9a67=_0x11ef3b['query'][a2_0x207b('0x2d')];const _0x3d3ec6=_0x11ef3b['query'][a2_0x207b('0x2e')];const _0x130072=_0x11ef3b[a2_0x207b('0x2f')][a2_0x207b('0x30')];exports[a2_0x207b('0x4')][a2_0x207b('0x28')][a2_0x207b('0x29')]['findAll']({'attributes':[a2_0x207b('0x2c'),[exports['sequelize']['fn']('sum',exports[a2_0x207b('0x4')][a2_0x207b('0x31')](a2_0x207b('0x32'))),a2_0x207b('0x33')]],'where':{'countingDate':{[exports[a2_0x207b('0x4')]['Op'][a2_0x207b('0x34')]]:_0x3d3ec6,[exports['sequelize']['Op']['lt']]:_0x130072},'amount':_0x11ef3b['params'][a2_0x207b('0x35')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x207b('0x4')][a2_0x207b('0x36')](a2_0x207b('0x37'))],'order':[[a2_0x207b('0x2c'),'ASC']]})[a2_0x207b('0x17')](_0x1d5458=>{_0x1f4428[a2_0x207b('0x11')]({'data':_0x1d5458});});};exports[a2_0x207b('0x38')]=(_0x14e2f2,_0x1de9aa)=>{const _0xb1938a=_0x14e2f2['query'][a2_0x207b('0x2d')];const _0x62a8ce=_0x14e2f2[a2_0x207b('0x2f')][a2_0x207b('0x2e')];const _0xde7e1=_0x14e2f2[a2_0x207b('0x2f')][a2_0x207b('0x30')];exports['sequelize'][a2_0x207b('0x28')][a2_0x207b('0x29')][a2_0x207b('0x2b')]({'attributes':[a2_0x207b('0x2c'),[exports[a2_0x207b('0x4')]['fn'](a2_0x207b('0x39'),exports[a2_0x207b('0x4')]['col'](a2_0x207b('0x2c')),'%Y-%m-%d\x20%H:00'),a2_0x207b('0x3a')],[exports['sequelize']['fn'](a2_0x207b('0x3b'),exports[a2_0x207b('0x4')][a2_0x207b('0x31')]('amount')),a2_0x207b('0x33')]],'where':{'countingDate':{[exports[a2_0x207b('0x4')]['Op'][a2_0x207b('0x34')]]:_0x62a8ce,[exports['sequelize']['Op']['lt']]:_0xde7e1},'amount':_0x14e2f2[a2_0x207b('0x3c')]['direction']=='in'?{[exports[a2_0x207b('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x207b('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x207b('0x4')]['fn'](a2_0x207b('0x3d'),exports[a2_0x207b('0x4')][a2_0x207b('0x31')](a2_0x207b('0x2c'))),exports[a2_0x207b('0x4')]['fn'](a2_0x207b('0x3e'),exports[a2_0x207b('0x4')][a2_0x207b('0x31')](a2_0x207b('0x2c'))),exports[a2_0x207b('0x4')]['fn'](a2_0x207b('0x3f'),exports[a2_0x207b('0x4')][a2_0x207b('0x31')](a2_0x207b('0x2c'))),exports[a2_0x207b('0x4')]['fn'](a2_0x207b('0x40'),exports['sequelize']['col'](a2_0x207b('0x2c')))],'order':[[a2_0x207b('0x2c'),a2_0x207b('0x41')]]})['then'](_0x4d5b81=>{_0x1de9aa[a2_0x207b('0x11')]({'data':_0x4d5b81});});};exports['getFacebook']=(_0x2f61a5,_0x1295c4,_0xa537c9)=>{const _0x5dc643=_0x2f61a5[a2_0x207b('0x42')][a2_0x207b('0x43')]['find'](_0x5dc643=>_0x5dc643[a2_0x207b('0x44')]===a2_0x207b('0x45'));fbgraph_1['default'][a2_0x207b('0x46')](_0x5dc643[a2_0x207b('0x47')]);fbgraph_1[a2_0x207b('0x9')][a2_0x207b('0x48')](_0x2f61a5[a2_0x207b('0x42')][a2_0x207b('0x45')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x4d5340,_0x46a1a1)=>{if(_0x4d5340){return _0xa537c9(_0x4d5340);}_0x1295c4[a2_0x207b('0x6')]('api/facebook',{'title':a2_0x207b('0x49'),'profile':_0x46a1a1});});};