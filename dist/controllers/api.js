var a2_0x2c96=['__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','colombia','name','endsWith','json','report_files','findOrCreate','spread','connect','ftp.vivotek.com','ipd','downloadFtp','models','get','colombia/','fileName','end','media/','createWriteStream','status','save','Downloaded:\x20','error','processFtp','findOne','then','readFile','utf8','parse','CountingInfo','Out','EndTime','create','pass_counting','findAll','countingDate','ASC','getPassCountingByDay','query','month','sum','col','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','startDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','HOUR','DAY','getFacebook','user','tokens','facebook','setAccessToken','accessToken','api/facebook','Facebook\x20API','__importDefault'];(function(_0x6a0eee,_0x2443bc){var _0x216442=function(_0x422b17){while(--_0x422b17){_0x6a0eee['push'](_0x6a0eee['shift']());}};_0x216442(++_0x2443bc);}(a2_0x2c96,0x9b));var a2_0x474d=function(_0x58b5a8,_0x47715c){_0x58b5a8=_0x58b5a8-0x0;var _0x169e1f=a2_0x2c96[_0x58b5a8];return _0x169e1f;};'use strict';var __importDefault=this&&this[a2_0x474d('0x0')]||function(_0x4705f2){return _0x4705f2&&_0x4705f2[a2_0x474d('0x1')]?_0x4705f2:{'default':_0x4705f2};};Object[a2_0x474d('0x2')](exports,a2_0x474d('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x474d('0x3')));const ftp_1=__importDefault(require(a2_0x474d('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x474d('0x5')]='';function setSequelize(_0x26c4e6){exports[a2_0x474d('0x5')]=_0x26c4e6;}exports[a2_0x474d('0x6')]=setSequelize;exports[a2_0x474d('0x7')]=(_0x4cf4b7,_0x41f3d0)=>{_0x41f3d0[a2_0x474d('0x8')]('api/index',{'title':a2_0x474d('0x9')});};exports[a2_0x474d('0xa')]=(_0x4042fe,_0x10f10c)=>{console[a2_0x474d('0xb')](a2_0x474d('0xc'));const _0x3f0f35=[];const _0x5d1516=new ftp_1[(a2_0x474d('0xd'))]();_0x5d1516['on'](a2_0x474d('0xe'),function(){console[a2_0x474d('0xb')]('connected');_0x5d1516['list'](a2_0x474d('0xf'),![],function(_0x3b69ba,_0x449014){if(_0x3b69ba){}else{for(const _0x22a7b0 of _0x449014){console[a2_0x474d('0xb')]('Downloading:\x20'+_0x22a7b0[a2_0x474d('0x10')]);if(_0x22a7b0[a2_0x474d('0x10')][a2_0x474d('0x11')](a2_0x474d('0x12'))){exports[a2_0x474d('0x5')]['models'][a2_0x474d('0x13')][a2_0x474d('0x14')]({'where':{'fileName':_0x22a7b0['name']}})[a2_0x474d('0x15')]((_0x209af5,_0x323d3c)=>{if(_0x323d3c){console[a2_0x474d('0xb')](_0x22a7b0['name']);_0x3f0f35['push'](_0x209af5);}});}}}_0x10f10c['json']({'data':_0x3f0f35});});});_0x5d1516['on']('error',function(_0x3ef429){_0x10f10c[a2_0x474d('0x12')]({'message':_0x3ef429});});_0x5d1516[a2_0x474d('0x16')]({'host':a2_0x474d('0x17'),'port':0x15,'user':a2_0x474d('0x18'),'password':'ipd'});};exports[a2_0x474d('0x19')]=(_0x55b62d,_0x5d631e)=>{exports['sequelize'][a2_0x474d('0x1a')][a2_0x474d('0x13')]['findOne']({'where':{'status':null}})['then'](_0x61a29f=>{if(_0x61a29f){const _0x4c0d49=new ftp_1[(a2_0x474d('0xd'))]();_0x4c0d49['on'](a2_0x474d('0xe'),function(){console['log']('connected:'+_0x61a29f['fileName']);_0x4c0d49[a2_0x474d('0x1b')](a2_0x474d('0x1c')+_0x61a29f[a2_0x474d('0x1d')],function(_0x1bf95d,_0x481c12){_0x4c0d49[a2_0x474d('0x1e')]();if(_0x1bf95d){}else{const _0x9f54e3=a2_0x474d('0x1f')+_0x61a29f[a2_0x474d('0x1d')]+'.txt';_0x481c12['pipe'](fs_1[a2_0x474d('0xd')][a2_0x474d('0x20')](_0x9f54e3));_0x61a29f[a2_0x474d('0x21')]=0x1;_0x61a29f[a2_0x474d('0x22')]();console[a2_0x474d('0xb')](a2_0x474d('0x23')+_0x61a29f[a2_0x474d('0x1d')]);}});});_0x4c0d49['on'](a2_0x474d('0x24'),function(_0x14ffd9){_0x5d631e[a2_0x474d('0x12')]({'message':_0x14ffd9});});_0x4c0d49[a2_0x474d('0x16')]({'host':a2_0x474d('0x17'),'port':0x15,'user':a2_0x474d('0x18'),'password':'ipd'});_0x5d631e[a2_0x474d('0x12')]({'data':_0x61a29f[a2_0x474d('0x1d')]});}else{_0x5d631e[a2_0x474d('0x12')]({'data':[]});}});};exports[a2_0x474d('0x25')]=(_0x21fdb8,_0x326a5f)=>{exports['sequelize'][a2_0x474d('0x1a')][a2_0x474d('0x13')][a2_0x474d('0x26')]({'where':{'status':0x1}})[a2_0x474d('0x27')](_0x11c0ae=>{if(_0x11c0ae){const _0x193a68='media/'+_0x11c0ae[a2_0x474d('0x1d')]+'.txt';fs_1[a2_0x474d('0xd')][a2_0x474d('0x28')](_0x193a68,a2_0x474d('0x29'),function(_0x41bc82,_0x2e80b5){if(_0x41bc82){_0x11c0ae[a2_0x474d('0x21')]=null;}else{try{const _0x1fd4e3=JSON[a2_0x474d('0x2a')](_0x2e80b5);for(const _0x402f32 of _0x1fd4e3['Data'][0x0][a2_0x474d('0x2b')]){const _0x47f959=_0x402f32['In'];const _0x492715=_0x402f32[a2_0x474d('0x2c')];const _0x1dc3a7=Date['parse'](_0x402f32[a2_0x474d('0x2d')]);if(_0x47f959>0x0){exports['sequelize'][a2_0x474d('0x1a')]['pass_counting'][a2_0x474d('0x2e')]({'reportFileId':_0x11c0ae['id'],'amount':_0x47f959,'countingDate':_0x1dc3a7});}if(_0x492715>0x0){exports[a2_0x474d('0x5')][a2_0x474d('0x1a')][a2_0x474d('0x2f')][a2_0x474d('0x2e')]({'reportFileId':_0x11c0ae['id'],'amount':_0x492715*-0x1,'countingDate':_0x1dc3a7});}}_0x11c0ae[a2_0x474d('0x21')]=0x2;}catch(_0x461d23){_0x11c0ae[a2_0x474d('0x21')]=null;}}_0x11c0ae['save']();});_0x326a5f[a2_0x474d('0x12')]({'data':_0x11c0ae['fileName']});}else{_0x326a5f[a2_0x474d('0x12')]({'data':[]});}});};exports['getPassCounting']=(_0x439056,_0x1917e6)=>{exports[a2_0x474d('0x5')][a2_0x474d('0x1a')][a2_0x474d('0x2f')][a2_0x474d('0x30')]({'where':{'amount':{[exports[a2_0x474d('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x474d('0x31'),a2_0x474d('0x32')]]})[a2_0x474d('0x27')](_0x26ed98=>{_0x1917e6[a2_0x474d('0x12')]({'data':_0x26ed98});});};exports[a2_0x474d('0x33')]=(_0x1b6e92,_0x266f3b)=>{const _0x14288b=_0x1b6e92[a2_0x474d('0x34')][a2_0x474d('0x35')];const _0x12cdee=_0x1b6e92[a2_0x474d('0x34')]['startDate'];const _0x32cc49=_0x1b6e92[a2_0x474d('0x34')]['endDate'];exports[a2_0x474d('0x5')]['models'][a2_0x474d('0x2f')]['findAll']({'attributes':[a2_0x474d('0x31'),[exports[a2_0x474d('0x5')]['fn'](a2_0x474d('0x36'),exports[a2_0x474d('0x5')][a2_0x474d('0x37')]('amount')),a2_0x474d('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x474d('0x39')]]:_0x12cdee,[exports[a2_0x474d('0x5')]['Op']['lt']]:_0x32cc49},'amount':_0x1b6e92[a2_0x474d('0x3a')][a2_0x474d('0x3b')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x474d('0x3c')](a2_0x474d('0x3d'))],'order':[['countingDate',a2_0x474d('0x32')]]})['then'](_0x3d5172=>{_0x266f3b[a2_0x474d('0x12')]({'data':_0x3d5172});});};exports[a2_0x474d('0x3e')]=(_0x4967a6,_0x5502c1)=>{const _0x53f87b=_0x4967a6[a2_0x474d('0x34')][a2_0x474d('0x35')];const _0x4f9f73=_0x4967a6[a2_0x474d('0x34')][a2_0x474d('0x3f')];const _0x46cbb9=_0x4967a6['query']['endDate'];exports['sequelize']['models'][a2_0x474d('0x2f')][a2_0x474d('0x30')]({'attributes':['countingDate',[exports[a2_0x474d('0x5')]['fn'](a2_0x474d('0x40'),exports[a2_0x474d('0x5')][a2_0x474d('0x37')](a2_0x474d('0x31')),a2_0x474d('0x41')),a2_0x474d('0x42')],[exports['sequelize']['fn']('sum',exports[a2_0x474d('0x5')][a2_0x474d('0x37')](a2_0x474d('0x43'))),'total']],'where':{'countingDate':{[exports[a2_0x474d('0x5')]['Op'][a2_0x474d('0x39')]]:_0x4f9f73,[exports[a2_0x474d('0x5')]['Op']['lt']]:_0x46cbb9},'amount':_0x4967a6[a2_0x474d('0x3a')]['direction']=='in'?{[exports[a2_0x474d('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x474d('0x5')]['Op']['lt']]:0x0}},'group':[exports[a2_0x474d('0x5')]['fn'](a2_0x474d('0x44'),exports['sequelize']['col'](a2_0x474d('0x31'))),exports[a2_0x474d('0x5')]['fn'](a2_0x474d('0x45'),exports[a2_0x474d('0x5')]['col'](a2_0x474d('0x31'))),exports[a2_0x474d('0x5')]['fn']('MONTH',exports[a2_0x474d('0x5')][a2_0x474d('0x37')](a2_0x474d('0x31'))),exports[a2_0x474d('0x5')]['fn']('YEAR',exports['sequelize'][a2_0x474d('0x37')](a2_0x474d('0x31')))],'order':[[a2_0x474d('0x31'),'ASC']]})[a2_0x474d('0x27')](_0x2d874b=>{_0x5502c1['json']({'data':_0x2d874b});});};exports[a2_0x474d('0x46')]=(_0x1b938e,_0x2b58a3,_0x2b3bcb)=>{const _0x3c5afb=_0x1b938e[a2_0x474d('0x47')][a2_0x474d('0x48')]['find'](_0x3c5afb=>_0x3c5afb['kind']===a2_0x474d('0x49'));fbgraph_1['default'][a2_0x474d('0x4a')](_0x3c5afb[a2_0x474d('0x4b')]);fbgraph_1[a2_0x474d('0xd')][a2_0x474d('0x1b')](_0x1b938e[a2_0x474d('0x47')][a2_0x474d('0x49')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x4a876b,_0x68e295)=>{if(_0x4a876b){return _0x2b3bcb(_0x4a876b);}_0x2b58a3[a2_0x474d('0x8')](a2_0x474d('0x4c'),{'title':a2_0x474d('0x4d'),'profile':_0x68e295});});};