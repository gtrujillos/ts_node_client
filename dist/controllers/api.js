var a2_0x5e7a=['error','connect','ftp.vivotek.com','models','report_files','findOne','then','default','fileName','end','.txt','pipe','createWriteStream','save','ipd','processFtp','media/','readFile','status','parse','Data','Out','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','col','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','%Y-%m-%d\x20%H:00','countingDateShort','params','HOUR','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','accessToken','get','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','connected','list','colombia','Downloading:\x20','name','endsWith','json','spread','push'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a2_0x5e7a,0x8b));var a2_0xdb9d=function(_0x4ff99d,_0x100af4){_0x4ff99d=_0x4ff99d-0x0;var _0x298682=a2_0x5e7a[_0x4ff99d];return _0x298682;};'use strict';var __importDefault=this&&this[a2_0xdb9d('0x0')]||function(_0x437352){return _0x437352&&_0x437352[a2_0xdb9d('0x1')]?_0x437352:{'default':_0x437352};};Object['defineProperty'](exports,a2_0xdb9d('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0xdb9d('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0xdb9d('0x3')]='';function setSequelize(_0x4ab65b){exports[a2_0xdb9d('0x3')]=_0x4ab65b;}exports[a2_0xdb9d('0x4')]=setSequelize;exports[a2_0xdb9d('0x5')]=(_0x5b632d,_0x470cc5)=>{_0x470cc5[a2_0xdb9d('0x6')](a2_0xdb9d('0x7'),{'title':a2_0xdb9d('0x8')});};exports[a2_0xdb9d('0x9')]=(_0x56618a,_0xe996ed)=>{console[a2_0xdb9d('0xa')](a2_0xdb9d('0xb'));const _0xa166ce=[];const _0x16bb9d=new ftp_1['default']();_0x16bb9d['on']('ready',function(){console[a2_0xdb9d('0xa')](a2_0xdb9d('0xc'));_0x16bb9d[a2_0xdb9d('0xd')](a2_0xdb9d('0xe'),![],function(_0x1d0ee9,_0x4298d2){if(_0x1d0ee9){}else{for(const _0x3a5927 of _0x4298d2){console[a2_0xdb9d('0xa')](a2_0xdb9d('0xf')+_0x3a5927[a2_0xdb9d('0x10')]);if(_0x3a5927[a2_0xdb9d('0x10')][a2_0xdb9d('0x11')](a2_0xdb9d('0x12'))){exports['sequelize']['models']['report_files']['findOrCreate']({'where':{'fileName':_0x3a5927[a2_0xdb9d('0x10')]}})[a2_0xdb9d('0x13')]((_0xad49d9,_0x2604e7)=>{if(_0x2604e7){console['log'](_0x3a5927[a2_0xdb9d('0x10')]);_0xa166ce[a2_0xdb9d('0x14')](_0xad49d9);}});}}}_0xe996ed['json']({'data':_0xa166ce});});});_0x16bb9d['on'](a2_0xdb9d('0x15'),function(_0x14a581){_0xe996ed['json']({'message':_0x14a581});});_0x16bb9d[a2_0xdb9d('0x16')]({'host':a2_0xdb9d('0x17'),'port':0x15,'user':'ipd','password':'ipd'});};exports['downloadFtp']=(_0x5dd4cd,_0x380edc)=>{exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x18')][a2_0xdb9d('0x19')][a2_0xdb9d('0x1a')]({'where':{'status':null}})[a2_0xdb9d('0x1b')](_0x5b8a17=>{if(_0x5b8a17){const _0x1e8b7e=new ftp_1[(a2_0xdb9d('0x1c'))]();_0x1e8b7e['on']('ready',function(){console['log']('connected:'+_0x5b8a17['fileName']);_0x1e8b7e['get']('colombia/'+_0x5b8a17[a2_0xdb9d('0x1d')],function(_0xcd1afa,_0x407455){_0x1e8b7e[a2_0xdb9d('0x1e')]();if(_0xcd1afa){}else{const _0xc5dea0='media/'+_0x5b8a17['fileName']+a2_0xdb9d('0x1f');_0x407455[a2_0xdb9d('0x20')](fs_1[a2_0xdb9d('0x1c')][a2_0xdb9d('0x21')](_0xc5dea0));_0x5b8a17['status']=0x1;_0x5b8a17[a2_0xdb9d('0x22')]();console[a2_0xdb9d('0xa')]('Downloaded:\x20'+_0x5b8a17['fileName']);}});});_0x1e8b7e['on'](a2_0xdb9d('0x15'),function(_0x524f42){_0x380edc[a2_0xdb9d('0x12')]({'message':_0x524f42});});_0x1e8b7e[a2_0xdb9d('0x16')]({'host':a2_0xdb9d('0x17'),'port':0x15,'user':a2_0xdb9d('0x23'),'password':a2_0xdb9d('0x23')});_0x380edc[a2_0xdb9d('0x12')]({'data':_0x5b8a17[a2_0xdb9d('0x1d')]});}else{_0x380edc[a2_0xdb9d('0x12')]({'data':[]});}});};exports[a2_0xdb9d('0x24')]=(_0x112e47,_0x47a81b)=>{exports['sequelize']['models'][a2_0xdb9d('0x19')][a2_0xdb9d('0x1a')]({'where':{'status':0x1}})[a2_0xdb9d('0x1b')](_0x151c69=>{if(_0x151c69){const _0x1f8c9d=a2_0xdb9d('0x25')+_0x151c69['fileName']+a2_0xdb9d('0x1f');fs_1['default'][a2_0xdb9d('0x26')](_0x1f8c9d,'utf8',function(_0x13126c,_0x1f59cd){if(_0x13126c){_0x151c69[a2_0xdb9d('0x27')]=null;}else{try{const _0x59b26e=JSON[a2_0xdb9d('0x28')](_0x1f59cd);for(const _0x1b7428 of _0x59b26e[a2_0xdb9d('0x29')][0x0]['CountingInfo']){const _0x1c4942=_0x1b7428['In'];const _0x4cf934=_0x1b7428[a2_0xdb9d('0x2a')];const _0x573135=Date[a2_0xdb9d('0x28')](_0x1b7428[a2_0xdb9d('0x2b')]);if(_0x1c4942>0x0){exports['sequelize'][a2_0xdb9d('0x18')][a2_0xdb9d('0x2c')][a2_0xdb9d('0x2d')]({'reportFileId':_0x151c69['id'],'amount':_0x1c4942,'countingDate':_0x573135});}if(_0x4cf934>0x0){exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x18')][a2_0xdb9d('0x2c')][a2_0xdb9d('0x2d')]({'reportFileId':_0x151c69['id'],'amount':_0x4cf934*-0x1,'countingDate':_0x573135});}}_0x151c69[a2_0xdb9d('0x27')]=0x2;}catch(_0x40030e){_0x151c69[a2_0xdb9d('0x27')]=null;}}_0x151c69['save']();});_0x47a81b[a2_0xdb9d('0x12')]({'data':_0x151c69[a2_0xdb9d('0x1d')]});}else{_0x47a81b[a2_0xdb9d('0x12')]({'data':[]});}});};exports[a2_0xdb9d('0x2e')]=(_0x586cf9,_0x558494)=>{exports['sequelize'][a2_0xdb9d('0x18')][a2_0xdb9d('0x2c')][a2_0xdb9d('0x2f')]({'where':{'amount':{[exports[a2_0xdb9d('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0xdb9d('0x30'),a2_0xdb9d('0x31')]]})[a2_0xdb9d('0x1b')](_0x950248=>{_0x558494['json']({'data':_0x950248});});};exports[a2_0xdb9d('0x32')]=(_0x559b1d,_0x549368)=>{const _0x32ee15=_0x559b1d[a2_0xdb9d('0x33')][a2_0xdb9d('0x34')];const _0xb09374=_0x559b1d[a2_0xdb9d('0x33')][a2_0xdb9d('0x35')];const _0x5becea=_0x559b1d[a2_0xdb9d('0x33')]['endDate'];exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x18')][a2_0xdb9d('0x2c')]['findAll']({'attributes':['countingDate',[exports[a2_0xdb9d('0x3')]['fn']('sum',exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x36')](a2_0xdb9d('0x37'))),a2_0xdb9d('0x38')]],'where':{'countingDate':{[exports[a2_0xdb9d('0x3')]['Op'][a2_0xdb9d('0x39')]]:_0xb09374,[exports[a2_0xdb9d('0x3')]['Op']['lt']]:_0x5becea},'amount':_0x559b1d['params'][a2_0xdb9d('0x3a')]=='in'?{[exports[a2_0xdb9d('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x3b')](a2_0xdb9d('0x3c'))],'order':[[a2_0xdb9d('0x30'),a2_0xdb9d('0x31')]]})[a2_0xdb9d('0x1b')](_0x571cba=>{_0x549368['json']({'data':_0x571cba});});};exports[a2_0xdb9d('0x3d')]=(_0x5d3770,_0x588ea4)=>{const _0x605673=_0x5d3770['query'][a2_0xdb9d('0x34')];const _0x7bd70d=_0x5d3770['query']['startDate'];const _0x2978af=_0x5d3770['query'][a2_0xdb9d('0x3e')];exports[a2_0xdb9d('0x3')]['models'][a2_0xdb9d('0x2c')][a2_0xdb9d('0x2f')]({'attributes':['countingDate',[exports[a2_0xdb9d('0x3')]['fn']('DATE_FORMAT',exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x36')]('countingDate'),a2_0xdb9d('0x3f')),a2_0xdb9d('0x40')],[exports['sequelize']['fn']('sum',exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x36')](a2_0xdb9d('0x37'))),'total']],'where':{'countingDate':{[exports[a2_0xdb9d('0x3')]['Op'][a2_0xdb9d('0x39')]]:_0x7bd70d,[exports['sequelize']['Op']['lt']]:_0x2978af},'amount':_0x5d3770[a2_0xdb9d('0x41')][a2_0xdb9d('0x3a')]=='in'?{[exports[a2_0xdb9d('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0xdb9d('0x3')]['fn'](a2_0xdb9d('0x42'),exports[a2_0xdb9d('0x3')][a2_0xdb9d('0x36')](a2_0xdb9d('0x30'))),exports[a2_0xdb9d('0x3')]['fn']('DAY',exports[a2_0xdb9d('0x3')]['col']('countingDate')),exports[a2_0xdb9d('0x3')]['fn'](a2_0xdb9d('0x43'),exports['sequelize'][a2_0xdb9d('0x36')]('countingDate')),exports[a2_0xdb9d('0x3')]['fn'](a2_0xdb9d('0x44'),exports[a2_0xdb9d('0x3')]['col'](a2_0xdb9d('0x30')))],'order':[[a2_0xdb9d('0x30'),a2_0xdb9d('0x31')]]})['then'](_0x2668a3=>{_0x588ea4['json']({'data':_0x2668a3});});};exports[a2_0xdb9d('0x45')]=(_0x2684bb,_0x1bb142,_0x5da497)=>{const _0x5e795c=_0x2684bb[a2_0xdb9d('0x46')][a2_0xdb9d('0x47')][a2_0xdb9d('0x48')](_0x5e795c=>_0x5e795c[a2_0xdb9d('0x49')]===a2_0xdb9d('0x4a'));fbgraph_1[a2_0xdb9d('0x1c')]['setAccessToken'](_0x5e795c[a2_0xdb9d('0x4b')]);fbgraph_1[a2_0xdb9d('0x1c')][a2_0xdb9d('0x4c')](_0x2684bb['user'][a2_0xdb9d('0x4a')]+a2_0xdb9d('0x4d'),(_0x1f6fba,_0x122177)=>{if(_0x1f6fba){return _0x5da497(_0x1f6fba);}_0x1bb142[a2_0xdb9d('0x6')](a2_0xdb9d('0x4e'),{'title':a2_0xdb9d('0x4f'),'profile':_0x122177});});};