var a2_0x3205=['colombia/','end','media/','.txt','pipe','createWriteStream','status','Downloaded:\x20','ipd','processFtp','then','readFile','utf8','Data','Out','create','pass_counting','save','getPassCounting','countingDate','ASC','getPassCountingByDay','month','query','startDate','endDate','sum','amount','total','gte','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','col','%Y-%m-%d\x20%H:00','countingDateShort','params','direction','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','facebook','setAccessToken','accessToken','get','render','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','sequelize','setSequelize','api/index','API\x20Examples','log','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','spread','push','error','connect','ftp.vivotek.com','downloadFtp','connected:','fileName'];(function(_0x11595f,_0x250f49){var _0x1c0ecb=function(_0x331f95){while(--_0x331f95){_0x11595f['push'](_0x11595f['shift']());}};_0x1c0ecb(++_0x250f49);}(a2_0x3205,0xd7));var a2_0x28cb=function(_0x1ca04c,_0x4f7565){_0x1ca04c=_0x1ca04c-0x0;var _0x1725f2=a2_0x3205[_0x1ca04c];return _0x1725f2;};'use strict';var __importDefault=this&&this[a2_0x28cb('0x0')]||function(_0x2beecb){return _0x2beecb&&_0x2beecb['__esModule']?_0x2beecb:{'default':_0x2beecb};};Object[a2_0x28cb('0x1')](exports,a2_0x28cb('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x28cb('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x28cb('0x4')]='';function setSequelize(_0x56a830){exports[a2_0x28cb('0x4')]=_0x56a830;}exports[a2_0x28cb('0x5')]=setSequelize;exports['getApi']=(_0x9346e4,_0x42347b)=>{_0x42347b['render'](a2_0x28cb('0x6'),{'title':a2_0x28cb('0x7')});};exports['syncFtp']=(_0x55cba3,_0x4ce6cd)=>{console[a2_0x28cb('0x8')]('connecting');const _0x3048e3=[];const _0x2401b2=new ftp_1[(a2_0x28cb('0x9'))]();_0x2401b2['on'](a2_0x28cb('0xa'),function(){console['log'](a2_0x28cb('0xb'));_0x2401b2[a2_0x28cb('0xc')](a2_0x28cb('0xd'),![],function(_0x988da0,_0x1fafb0){if(_0x988da0){}else{for(const _0x15f2bc of _0x1fafb0){console['log'](a2_0x28cb('0xe')+_0x15f2bc[a2_0x28cb('0xf')]);if(_0x15f2bc[a2_0x28cb('0xf')][a2_0x28cb('0x10')](a2_0x28cb('0x11'))){exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x13')]['findOrCreate']({'where':{'fileName':_0x15f2bc['name']}})[a2_0x28cb('0x14')]((_0x24d381,_0x508377)=>{if(_0x508377){console['log'](_0x15f2bc[a2_0x28cb('0xf')]);_0x3048e3[a2_0x28cb('0x15')](_0x24d381);}});}}}_0x4ce6cd[a2_0x28cb('0x11')]({'data':_0x3048e3});});});_0x2401b2['on'](a2_0x28cb('0x16'),function(_0x54efd3){_0x4ce6cd[a2_0x28cb('0x11')]({'message':_0x54efd3});});_0x2401b2[a2_0x28cb('0x17')]({'host':a2_0x28cb('0x18'),'port':0x15,'user':'ipd','password':'ipd'});};exports[a2_0x28cb('0x19')]=(_0xf02b48,_0x40c184)=>{exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x13')]['findOne']({'where':{'status':null}})['then'](_0x441f25=>{if(_0x441f25){const _0xc97063=new ftp_1[(a2_0x28cb('0x9'))]();_0xc97063['on'](a2_0x28cb('0xa'),function(){console[a2_0x28cb('0x8')](a2_0x28cb('0x1a')+_0x441f25[a2_0x28cb('0x1b')]);_0xc97063['get'](a2_0x28cb('0x1c')+_0x441f25['fileName'],function(_0x4d2318,_0xe04a5c){_0xc97063[a2_0x28cb('0x1d')]();if(_0x4d2318){}else{const _0x20f835=a2_0x28cb('0x1e')+_0x441f25['fileName']+a2_0x28cb('0x1f');_0xe04a5c[a2_0x28cb('0x20')](fs_1['default'][a2_0x28cb('0x21')](_0x20f835));_0x441f25[a2_0x28cb('0x22')]=0x1;_0x441f25['save']();console[a2_0x28cb('0x8')](a2_0x28cb('0x23')+_0x441f25['fileName']);}});});_0xc97063['on']('error',function(_0x59582d){_0x40c184[a2_0x28cb('0x11')]({'message':_0x59582d});});_0xc97063[a2_0x28cb('0x17')]({'host':a2_0x28cb('0x18'),'port':0x15,'user':a2_0x28cb('0x24'),'password':a2_0x28cb('0x24')});_0x40c184[a2_0x28cb('0x11')]({'data':_0x441f25['fileName']});}else{_0x40c184[a2_0x28cb('0x11')]({'data':[]});}});};exports[a2_0x28cb('0x25')]=(_0x4b3a09,_0x177201)=>{exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x13')]['findOne']({'where':{'status':0x1}})[a2_0x28cb('0x26')](_0x5b0723=>{if(_0x5b0723){const _0x30fedf=a2_0x28cb('0x1e')+_0x5b0723[a2_0x28cb('0x1b')]+'.txt';fs_1[a2_0x28cb('0x9')][a2_0x28cb('0x27')](_0x30fedf,a2_0x28cb('0x28'),function(_0x8d68c8,_0x1d77d0){if(_0x8d68c8){_0x5b0723[a2_0x28cb('0x22')]=null;}else{try{const _0x2c6fb3=JSON['parse'](_0x1d77d0);for(const _0x290fd2 of _0x2c6fb3[a2_0x28cb('0x29')][0x0]['CountingInfo']){const _0x4d2e97=_0x290fd2['In'];const _0x329b9c=_0x290fd2[a2_0x28cb('0x2a')];const _0x32db93=Date['parse'](_0x290fd2['EndTime']);if(_0x4d2e97>0x0){exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')]['pass_counting'][a2_0x28cb('0x2b')]({'reportFileId':_0x5b0723['id'],'amount':_0x4d2e97,'countingDate':_0x32db93});}if(_0x329b9c>0x0){exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x2c')]['create']({'reportFileId':_0x5b0723['id'],'amount':_0x329b9c*-0x1,'countingDate':_0x32db93});}}_0x5b0723[a2_0x28cb('0x22')]=0x2;}catch(_0x4ec6ad){_0x5b0723[a2_0x28cb('0x22')]=null;}}_0x5b0723[a2_0x28cb('0x2d')]();});_0x177201[a2_0x28cb('0x11')]({'data':_0x5b0723['fileName']});}else{_0x177201[a2_0x28cb('0x11')]({'data':[]});}});};exports[a2_0x28cb('0x2e')]=(_0x548f3c,_0x245b45)=>{exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x2c')]['findAll']({'where':{'amount':{[exports[a2_0x28cb('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x28cb('0x2f'),a2_0x28cb('0x30')]]})[a2_0x28cb('0x26')](_0x5e556c=>{_0x245b45[a2_0x28cb('0x11')]({'data':_0x5e556c});});};exports[a2_0x28cb('0x31')]=(_0x3f01ee,_0x4d3454)=>{const _0x58ec1c=_0x3f01ee['query'][a2_0x28cb('0x32')];const _0x1cf0c4=_0x3f01ee[a2_0x28cb('0x33')][a2_0x28cb('0x34')];const _0x35514b=_0x3f01ee[a2_0x28cb('0x33')][a2_0x28cb('0x35')];exports[a2_0x28cb('0x4')][a2_0x28cb('0x12')][a2_0x28cb('0x2c')]['findAll']({'attributes':[a2_0x28cb('0x2f'),[exports[a2_0x28cb('0x4')]['fn'](a2_0x28cb('0x36'),exports[a2_0x28cb('0x4')]['col'](a2_0x28cb('0x37'))),a2_0x28cb('0x38')]],'where':{'countingDate':{[exports[a2_0x28cb('0x4')]['Op'][a2_0x28cb('0x39')]]:_0x1cf0c4,[exports[a2_0x28cb('0x4')]['Op']['lt']]:_0x35514b},'amount':_0x3f01ee['params']['direction']=='in'?{[exports[a2_0x28cb('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x28cb('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x28cb('0x3a')](a2_0x28cb('0x3b'))],'order':[[a2_0x28cb('0x2f'),a2_0x28cb('0x30')]]})[a2_0x28cb('0x26')](_0x313e7b=>{_0x4d3454[a2_0x28cb('0x11')]({'data':_0x313e7b});});};exports[a2_0x28cb('0x3c')]=(_0x5e9da3,_0x3d26bd)=>{const _0x44e0ca=_0x5e9da3[a2_0x28cb('0x33')][a2_0x28cb('0x32')];const _0x5d0173=_0x5e9da3[a2_0x28cb('0x33')][a2_0x28cb('0x34')];const _0x2e3486=_0x5e9da3[a2_0x28cb('0x33')]['endDate'];exports[a2_0x28cb('0x4')]['models']['pass_counting']['findAll']({'attributes':[a2_0x28cb('0x2f'),[exports[a2_0x28cb('0x4')]['fn']('DATE_FORMAT',exports[a2_0x28cb('0x4')][a2_0x28cb('0x3d')](a2_0x28cb('0x2f')),a2_0x28cb('0x3e')),a2_0x28cb('0x3f')],[exports[a2_0x28cb('0x4')]['fn']('sum',exports[a2_0x28cb('0x4')]['col'](a2_0x28cb('0x37'))),a2_0x28cb('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x28cb('0x39')]]:_0x5d0173,[exports['sequelize']['Op']['lt']]:_0x2e3486},'amount':_0x5e9da3[a2_0x28cb('0x40')][a2_0x28cb('0x41')]=='in'?{[exports[a2_0x28cb('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x28cb('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x28cb('0x4')]['fn'](a2_0x28cb('0x42'),exports[a2_0x28cb('0x4')][a2_0x28cb('0x3d')](a2_0x28cb('0x2f'))),exports[a2_0x28cb('0x4')]['fn'](a2_0x28cb('0x43'),exports['sequelize'][a2_0x28cb('0x3d')](a2_0x28cb('0x2f'))),exports['sequelize']['fn'](a2_0x28cb('0x44'),exports['sequelize'][a2_0x28cb('0x3d')]('countingDate')),exports[a2_0x28cb('0x4')]['fn'](a2_0x28cb('0x45'),exports[a2_0x28cb('0x4')][a2_0x28cb('0x3d')](a2_0x28cb('0x2f')))],'order':[[a2_0x28cb('0x2f'),a2_0x28cb('0x30')]]})['then'](_0x3410f3=>{_0x3d26bd[a2_0x28cb('0x11')]({'data':_0x3410f3});});};exports[a2_0x28cb('0x46')]=(_0x40a85b,_0x3303f5,_0x35ab56)=>{const _0x51746b=_0x40a85b[a2_0x28cb('0x47')][a2_0x28cb('0x48')][a2_0x28cb('0x49')](_0x51746b=>_0x51746b['kind']===a2_0x28cb('0x4a'));fbgraph_1[a2_0x28cb('0x9')][a2_0x28cb('0x4b')](_0x51746b[a2_0x28cb('0x4c')]);fbgraph_1[a2_0x28cb('0x9')][a2_0x28cb('0x4d')](_0x40a85b[a2_0x28cb('0x47')]['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x55083e,_0x2b54ad)=>{if(_0x55083e){return _0x35ab56(_0x55083e);}_0x3303f5[a2_0x28cb('0x4e')](a2_0x28cb('0x4f'),{'title':a2_0x28cb('0x50'),'profile':_0x2b54ad});});};