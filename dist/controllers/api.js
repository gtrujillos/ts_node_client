var a2_0x2a1c=['ipd','downloadFtp','findOne','then','connected:','fileName','get','end','media/','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','.txt','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','pass_counting','create','getPassCounting','countingDate','ASC','query','month','startDate','endDate','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','findAll','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','col','amount','direction','HOUR','DAY','MONTH','getFacebook','user','find','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','syncFtp','log','connecting','default','ready','list','colombia','name','endsWith','json','models','report_files','findOrCreate','spread','error','connect','ftp.vivotek.com'];(function(_0x3370c7,_0x1366db){var _0x53f26b=function(_0xc84241){while(--_0xc84241){_0x3370c7['push'](_0x3370c7['shift']());}};_0x53f26b(++_0x1366db);}(a2_0x2a1c,0x187));var a2_0x4475=function(_0x3b5574,_0x50f94f){_0x3b5574=_0x3b5574-0x0;var _0x432b7c=a2_0x2a1c[_0x3b5574];return _0x432b7c;};'use strict';var __importDefault=this&&this[a2_0x4475('0x0')]||function(_0x1155e4){return _0x1155e4&&_0x1155e4[a2_0x4475('0x1')]?_0x1155e4:{'default':_0x1155e4};};Object['defineProperty'](exports,a2_0x4475('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x4475('0x2')));const ftp_1=__importDefault(require(a2_0x4475('0x3')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x244513){exports[a2_0x4475('0x4')]=_0x244513;}exports[a2_0x4475('0x5')]=setSequelize;exports[a2_0x4475('0x6')]=(_0xe8473,_0x1df990)=>{_0x1df990['render']('api/index',{'title':'API\x20Examples'});};exports[a2_0x4475('0x7')]=(_0x267ea0,_0x5dc716)=>{console[a2_0x4475('0x8')](a2_0x4475('0x9'));const _0xcb02e3=[];const _0x204951=new ftp_1[(a2_0x4475('0xa'))]();_0x204951['on'](a2_0x4475('0xb'),function(){console[a2_0x4475('0x8')]('connected');_0x204951[a2_0x4475('0xc')](a2_0x4475('0xd'),![],function(_0x57e069,_0x291996){if(_0x57e069){}else{for(const _0x290d28 of _0x291996){console['log']('Downloading:\x20'+_0x290d28[a2_0x4475('0xe')]);if(_0x290d28[a2_0x4475('0xe')][a2_0x4475('0xf')](a2_0x4475('0x10'))){exports[a2_0x4475('0x4')][a2_0x4475('0x11')][a2_0x4475('0x12')][a2_0x4475('0x13')]({'where':{'fileName':_0x290d28[a2_0x4475('0xe')]}})[a2_0x4475('0x14')]((_0x5d47ff,_0x59d84a)=>{if(_0x59d84a){console[a2_0x4475('0x8')](_0x290d28['name']);_0xcb02e3['push'](_0x5d47ff);}});}}}_0x5dc716['json']({'data':_0xcb02e3});});});_0x204951['on'](a2_0x4475('0x15'),function(_0x3930e4){_0x5dc716[a2_0x4475('0x10')]({'message':_0x3930e4});});_0x204951[a2_0x4475('0x16')]({'host':a2_0x4475('0x17'),'port':0x15,'user':a2_0x4475('0x18'),'password':'ipd'});};exports[a2_0x4475('0x19')]=(_0x3dcf4f,_0x25934f)=>{exports[a2_0x4475('0x4')][a2_0x4475('0x11')][a2_0x4475('0x12')][a2_0x4475('0x1a')]({'where':{'status':null}})[a2_0x4475('0x1b')](_0x24783b=>{if(_0x24783b){const _0x4cee3c=new ftp_1[(a2_0x4475('0xa'))]();_0x4cee3c['on'](a2_0x4475('0xb'),function(){console[a2_0x4475('0x8')](a2_0x4475('0x1c')+_0x24783b[a2_0x4475('0x1d')]);_0x4cee3c[a2_0x4475('0x1e')]('colombia/'+_0x24783b['fileName'],function(_0xd643cc,_0x3776ac){_0x4cee3c[a2_0x4475('0x1f')]();if(_0xd643cc){}else{const _0x4cfe10=a2_0x4475('0x20')+_0x24783b[a2_0x4475('0x1d')]+'.txt';_0x3776ac[a2_0x4475('0x21')](fs_1[a2_0x4475('0xa')][a2_0x4475('0x22')](_0x4cfe10));_0x24783b[a2_0x4475('0x23')]=0x1;_0x24783b[a2_0x4475('0x24')]();console['log'](a2_0x4475('0x25')+_0x24783b['fileName']);}});});_0x4cee3c['on']('error',function(_0x59d89a){_0x25934f[a2_0x4475('0x10')]({'message':_0x59d89a});});_0x4cee3c['connect']({'host':a2_0x4475('0x17'),'port':0x15,'user':a2_0x4475('0x18'),'password':a2_0x4475('0x18')});_0x25934f[a2_0x4475('0x10')]({'data':_0x24783b[a2_0x4475('0x1d')]});}else{_0x25934f[a2_0x4475('0x10')]({'data':[]});}});};exports[a2_0x4475('0x26')]=(_0x11e7f7,_0x192df2)=>{exports[a2_0x4475('0x4')][a2_0x4475('0x11')]['report_files'][a2_0x4475('0x1a')]({'where':{'status':0x1}})[a2_0x4475('0x1b')](_0x1c9f6b=>{if(_0x1c9f6b){const _0x906caa='media/'+_0x1c9f6b[a2_0x4475('0x1d')]+a2_0x4475('0x27');fs_1[a2_0x4475('0xa')][a2_0x4475('0x28')](_0x906caa,a2_0x4475('0x29'),function(_0x3c3cb5,_0x52d37f){if(_0x3c3cb5){_0x1c9f6b[a2_0x4475('0x23')]=null;}else{try{const _0x490b7d=JSON[a2_0x4475('0x2a')](_0x52d37f);for(const _0x1d730b of _0x490b7d[a2_0x4475('0x2b')][0x0][a2_0x4475('0x2c')]){const _0x4d8416=_0x1d730b['In'];const _0x3d28fb=_0x1d730b[a2_0x4475('0x2d')];const _0x331e58=Date[a2_0x4475('0x2a')](_0x1d730b[a2_0x4475('0x2e')]);if(_0x4d8416>0x0){exports[a2_0x4475('0x4')][a2_0x4475('0x11')][a2_0x4475('0x2f')][a2_0x4475('0x30')]({'reportFileId':_0x1c9f6b['id'],'amount':_0x4d8416,'countingDate':_0x331e58});}if(_0x3d28fb>0x0){exports[a2_0x4475('0x4')][a2_0x4475('0x11')]['pass_counting']['create']({'reportFileId':_0x1c9f6b['id'],'amount':_0x3d28fb*-0x1,'countingDate':_0x331e58});}}_0x1c9f6b[a2_0x4475('0x23')]=0x2;}catch(_0x19733e){_0x1c9f6b['status']=null;}}_0x1c9f6b[a2_0x4475('0x24')]();});_0x192df2[a2_0x4475('0x10')]({'data':_0x1c9f6b[a2_0x4475('0x1d')]});}else{_0x192df2[a2_0x4475('0x10')]({'data':[]});}});};exports[a2_0x4475('0x31')]=(_0x38ff96,_0x3ce1b3)=>{exports[a2_0x4475('0x4')][a2_0x4475('0x11')]['pass_counting']['findAll']({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x4475('0x32'),a2_0x4475('0x33')]]})[a2_0x4475('0x1b')](_0x5802e4=>{_0x3ce1b3[a2_0x4475('0x10')]({'data':_0x5802e4});});};exports['getPassCountingByDay']=(_0x119220,_0x4ad813)=>{const _0x18c6f1=_0x119220[a2_0x4475('0x34')][a2_0x4475('0x35')];const _0x4d3eb5=_0x119220[a2_0x4475('0x34')][a2_0x4475('0x36')];const _0x47e93c=_0x119220[a2_0x4475('0x34')][a2_0x4475('0x37')];exports['sequelize']['models'][a2_0x4475('0x2f')]['findAll']({'attributes':[a2_0x4475('0x32'),[exports[a2_0x4475('0x4')]['fn']('sum',exports['sequelize']['col']('amount')),a2_0x4475('0x38')]],'where':{'countingDate':{[exports[a2_0x4475('0x4')]['Op'][a2_0x4475('0x39')]]:_0x4d3eb5,[exports[a2_0x4475('0x4')]['Op']['lt']]:_0x47e93c},'amount':_0x119220[a2_0x4475('0x3a')]['direction']=='in'?{[exports[a2_0x4475('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x4475('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4475('0x4')][a2_0x4475('0x3b')](a2_0x4475('0x3c'))],'order':[[a2_0x4475('0x32'),'ASC']]})[a2_0x4475('0x1b')](_0x5ee63d=>{_0x4ad813['json']({'data':_0x5ee63d});});};exports[a2_0x4475('0x3d')]=(_0x1f63d8,_0x496920)=>{const _0x2bd98b=_0x1f63d8['query']['month'];const _0x2f8449=_0x1f63d8[a2_0x4475('0x34')][a2_0x4475('0x36')];const _0x540337=_0x1f63d8[a2_0x4475('0x34')][a2_0x4475('0x37')];exports['sequelize'][a2_0x4475('0x11')]['pass_counting'][a2_0x4475('0x3e')]({'attributes':[a2_0x4475('0x32'),[exports['sequelize']['fn'](a2_0x4475('0x3f'),exports[a2_0x4475('0x4')]['col'](a2_0x4475('0x32')),a2_0x4475('0x40')),a2_0x4475('0x41')],[exports['sequelize']['fn'](a2_0x4475('0x42'),exports['sequelize'][a2_0x4475('0x43')](a2_0x4475('0x44'))),a2_0x4475('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x4475('0x39')]]:_0x2f8449,[exports[a2_0x4475('0x4')]['Op']['lt']]:_0x540337},'amount':_0x1f63d8['params'][a2_0x4475('0x45')]=='in'?{[exports[a2_0x4475('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x4475('0x4')]['fn'](a2_0x4475('0x46'),exports['sequelize'][a2_0x4475('0x43')](a2_0x4475('0x32'))),exports[a2_0x4475('0x4')]['fn'](a2_0x4475('0x47'),exports['sequelize'][a2_0x4475('0x43')]('countingDate')),exports[a2_0x4475('0x4')]['fn'](a2_0x4475('0x48'),exports[a2_0x4475('0x4')]['col'](a2_0x4475('0x32'))),exports[a2_0x4475('0x4')]['fn']('YEAR',exports[a2_0x4475('0x4')][a2_0x4475('0x43')](a2_0x4475('0x32')))],'order':[[a2_0x4475('0x32'),a2_0x4475('0x33')]]})[a2_0x4475('0x1b')](_0x1e1293=>{_0x496920[a2_0x4475('0x10')]({'data':_0x1e1293});});};exports[a2_0x4475('0x49')]=(_0x3376a1,_0x4fc0a9,_0x13e1d4)=>{const _0x46e27d=_0x3376a1[a2_0x4475('0x4a')]['tokens'][a2_0x4475('0x4b')](_0x46e27d=>_0x46e27d['kind']===a2_0x4475('0x4c'));fbgraph_1['default'][a2_0x4475('0x4d')](_0x46e27d[a2_0x4475('0x4e')]);fbgraph_1[a2_0x4475('0xa')][a2_0x4475('0x1e')](_0x3376a1[a2_0x4475('0x4a')]['facebook']+a2_0x4475('0x4f'),(_0x4607ca,_0x4b85cc)=>{if(_0x4607ca){return _0x13e1d4(_0x4607ca);}_0x4fc0a9[a2_0x4475('0x50')](a2_0x4475('0x51'),{'title':a2_0x4475('0x52'),'profile':_0x4b85cc});});};