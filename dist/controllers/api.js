var a2_0x7f96=['Facebook\x20API','__importDefault','__esModule','defineProperty','ftp','sequelize','setSequelize','api/index','syncFtp','log','connecting','ready','connected','Downloading:\x20','name','endsWith','json','models','report_files','spread','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','default','connected:','fileName','get','colombia/','media/','.txt','pipe','createWriteStream','status','Downloaded:\x20','error','processFtp','readFile','utf8','parse','Data','Out','EndTime','pass_counting','save','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','amount','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','col','countingDateShort','HOUR','MONTH','YEAR','user','tokens','find','kind','setAccessToken','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook'];(function(_0x9f29de,_0x5b7e44){var _0x247332=function(_0x1565ca){while(--_0x1565ca){_0x9f29de['push'](_0x9f29de['shift']());}};_0x247332(++_0x5b7e44);}(a2_0x7f96,0x9b));var a2_0x2fc5=function(_0x305192,_0x4ae3a8){_0x305192=_0x305192-0x0;var _0x10a10a=a2_0x7f96[_0x305192];return _0x10a10a;};'use strict';var __importDefault=this&&this[a2_0x2fc5('0x0')]||function(_0x4f69e9){return _0x4f69e9&&_0x4f69e9[a2_0x2fc5('0x1')]?_0x4f69e9:{'default':_0x4f69e9};};Object[a2_0x2fc5('0x2')](exports,a2_0x2fc5('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a2_0x2fc5('0x3')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0xc1205){exports[a2_0x2fc5('0x4')]=_0xc1205;}exports[a2_0x2fc5('0x5')]=setSequelize;exports['getApi']=(_0x4c5d5d,_0x555cdf)=>{_0x555cdf['render'](a2_0x2fc5('0x6'),{'title':'API\x20Examples'});};exports[a2_0x2fc5('0x7')]=(_0x36e439,_0x43b96c)=>{console[a2_0x2fc5('0x8')](a2_0x2fc5('0x9'));const _0x27fb1b=[];const _0x1a56cd=new ftp_1['default']();_0x1a56cd['on'](a2_0x2fc5('0xa'),function(){console[a2_0x2fc5('0x8')](a2_0x2fc5('0xb'));_0x1a56cd['list']('colombia',![],function(_0x2fbb08,_0x22ad5d){if(_0x2fbb08){}else{for(const _0x1177f0 of _0x22ad5d){console[a2_0x2fc5('0x8')](a2_0x2fc5('0xc')+_0x1177f0['name']);if(_0x1177f0[a2_0x2fc5('0xd')][a2_0x2fc5('0xe')](a2_0x2fc5('0xf'))){exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x10')][a2_0x2fc5('0x11')]['findOrCreate']({'where':{'fileName':_0x1177f0[a2_0x2fc5('0xd')]}})[a2_0x2fc5('0x12')]((_0x54a3cb,_0x88529f)=>{if(_0x88529f){console[a2_0x2fc5('0x8')](_0x1177f0['name']);_0x27fb1b['push'](_0x54a3cb);}});}}}_0x43b96c[a2_0x2fc5('0xf')]({'data':_0x27fb1b});});});_0x1a56cd['on']('error',function(_0x284484){_0x43b96c[a2_0x2fc5('0xf')]({'message':_0x284484});});_0x1a56cd[a2_0x2fc5('0x13')]({'host':a2_0x2fc5('0x14'),'port':0x15,'user':a2_0x2fc5('0x15'),'password':a2_0x2fc5('0x15')});};exports[a2_0x2fc5('0x16')]=(_0x5aec64,_0x18500c)=>{exports['sequelize'][a2_0x2fc5('0x10')]['report_files'][a2_0x2fc5('0x17')]({'where':{'status':null}})[a2_0x2fc5('0x18')](_0x59ea3c=>{if(_0x59ea3c){const _0x3c0055=new ftp_1[(a2_0x2fc5('0x19'))]();_0x3c0055['on'](a2_0x2fc5('0xa'),function(){console[a2_0x2fc5('0x8')](a2_0x2fc5('0x1a')+_0x59ea3c[a2_0x2fc5('0x1b')]);_0x3c0055[a2_0x2fc5('0x1c')](a2_0x2fc5('0x1d')+_0x59ea3c[a2_0x2fc5('0x1b')],function(_0x24dbde,_0xea662){_0x3c0055['end']();if(_0x24dbde){}else{const _0x2a7c27=a2_0x2fc5('0x1e')+_0x59ea3c[a2_0x2fc5('0x1b')]+a2_0x2fc5('0x1f');_0xea662[a2_0x2fc5('0x20')](fs_1[a2_0x2fc5('0x19')][a2_0x2fc5('0x21')](_0x2a7c27));_0x59ea3c[a2_0x2fc5('0x22')]=0x1;_0x59ea3c['save']();console[a2_0x2fc5('0x8')](a2_0x2fc5('0x23')+_0x59ea3c['fileName']);}});});_0x3c0055['on'](a2_0x2fc5('0x24'),function(_0x6fd6c8){_0x18500c[a2_0x2fc5('0xf')]({'message':_0x6fd6c8});});_0x3c0055['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x2fc5('0x15'),'password':a2_0x2fc5('0x15')});_0x18500c[a2_0x2fc5('0xf')]({'data':_0x59ea3c[a2_0x2fc5('0x1b')]});}else{_0x18500c[a2_0x2fc5('0xf')]({'data':[]});}});};exports[a2_0x2fc5('0x25')]=(_0x339e10,_0x69e038)=>{exports['sequelize'][a2_0x2fc5('0x10')][a2_0x2fc5('0x11')][a2_0x2fc5('0x17')]({'where':{'status':0x1}})[a2_0x2fc5('0x18')](_0x45d347=>{if(_0x45d347){const _0x41fc04=a2_0x2fc5('0x1e')+_0x45d347[a2_0x2fc5('0x1b')]+a2_0x2fc5('0x1f');fs_1[a2_0x2fc5('0x19')][a2_0x2fc5('0x26')](_0x41fc04,a2_0x2fc5('0x27'),function(_0x3e8f86,_0x456e64){if(_0x3e8f86){_0x45d347[a2_0x2fc5('0x22')]=null;}else{try{const _0x2f57f5=JSON[a2_0x2fc5('0x28')](_0x456e64);for(const _0x440888 of _0x2f57f5[a2_0x2fc5('0x29')][0x0]['CountingInfo']){const _0xbe04e5=_0x440888['In'];const _0x1e817f=_0x440888[a2_0x2fc5('0x2a')];const _0x25066b=Date[a2_0x2fc5('0x28')](_0x440888[a2_0x2fc5('0x2b')]);if(_0xbe04e5>0x0){exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x10')][a2_0x2fc5('0x2c')]['create']({'reportFileId':_0x45d347['id'],'amount':_0xbe04e5,'countingDate':_0x25066b});}if(_0x1e817f>0x0){exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x10')][a2_0x2fc5('0x2c')]['create']({'reportFileId':_0x45d347['id'],'amount':_0x1e817f*-0x1,'countingDate':_0x25066b});}}_0x45d347[a2_0x2fc5('0x22')]=0x2;}catch(_0x5eccc6){_0x45d347[a2_0x2fc5('0x22')]=null;}}_0x45d347[a2_0x2fc5('0x2d')]();});_0x69e038[a2_0x2fc5('0xf')]({'data':_0x45d347[a2_0x2fc5('0x1b')]});}else{_0x69e038[a2_0x2fc5('0xf')]({'data':[]});}});};exports['getPassCounting']=(_0x521b94,_0x36a532)=>{exports['sequelize'][a2_0x2fc5('0x10')][a2_0x2fc5('0x2c')][a2_0x2fc5('0x2e')]({'where':{'amount':{[exports[a2_0x2fc5('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x2fc5('0x2f'),a2_0x2fc5('0x30')]]})[a2_0x2fc5('0x18')](_0x3692b1=>{_0x36a532[a2_0x2fc5('0xf')]({'data':_0x3692b1});});};exports[a2_0x2fc5('0x31')]=(_0x183aba,_0x453099)=>{const _0x255131=_0x183aba[a2_0x2fc5('0x32')][a2_0x2fc5('0x33')];const _0x3d347f=_0x183aba['query'][a2_0x2fc5('0x34')];const _0x3b9f02=_0x183aba[a2_0x2fc5('0x32')][a2_0x2fc5('0x35')];exports['sequelize'][a2_0x2fc5('0x10')]['pass_counting'][a2_0x2fc5('0x2e')]({'attributes':[a2_0x2fc5('0x2f'),[exports[a2_0x2fc5('0x4')]['fn'](a2_0x2fc5('0x36'),exports[a2_0x2fc5('0x4')]['col'](a2_0x2fc5('0x37'))),a2_0x2fc5('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x2fc5('0x39')]]:_0x3d347f,[exports[a2_0x2fc5('0x4')]['Op']['lt']]:_0x3b9f02},'amount':_0x183aba[a2_0x2fc5('0x3a')]['direction']=='in'?{[exports[a2_0x2fc5('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x3b')](a2_0x2fc5('0x3c'))],'order':[[a2_0x2fc5('0x2f'),a2_0x2fc5('0x30')]]})[a2_0x2fc5('0x18')](_0xc5b043=>{_0x453099[a2_0x2fc5('0xf')]({'data':_0xc5b043});});};exports[a2_0x2fc5('0x3d')]=(_0x128535,_0x17de81)=>{const _0x3360d9=_0x128535[a2_0x2fc5('0x32')][a2_0x2fc5('0x33')];const _0x3c0cbc=_0x128535['query'][a2_0x2fc5('0x34')];const _0x32b194=_0x128535[a2_0x2fc5('0x32')][a2_0x2fc5('0x35')];exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x10')][a2_0x2fc5('0x2c')][a2_0x2fc5('0x2e')]({'attributes':[a2_0x2fc5('0x2f'),[exports[a2_0x2fc5('0x4')]['fn'](a2_0x2fc5('0x3e'),exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x3f')]('countingDate'),'%Y-%m-%d\x20%H:00'),a2_0x2fc5('0x40')],[exports[a2_0x2fc5('0x4')]['fn']('sum',exports[a2_0x2fc5('0x4')]['col'](a2_0x2fc5('0x37'))),a2_0x2fc5('0x38')]],'where':{'countingDate':{[exports[a2_0x2fc5('0x4')]['Op']['gte']]:_0x3c0cbc,[exports[a2_0x2fc5('0x4')]['Op']['lt']]:_0x32b194},'amount':_0x128535[a2_0x2fc5('0x3a')]['direction']=='in'?{[exports[a2_0x2fc5('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x2fc5('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x2fc5('0x4')]['fn'](a2_0x2fc5('0x41'),exports['sequelize'][a2_0x2fc5('0x3f')](a2_0x2fc5('0x2f'))),exports[a2_0x2fc5('0x4')]['fn']('DAY',exports['sequelize'][a2_0x2fc5('0x3f')](a2_0x2fc5('0x2f'))),exports[a2_0x2fc5('0x4')]['fn'](a2_0x2fc5('0x42'),exports[a2_0x2fc5('0x4')][a2_0x2fc5('0x3f')]('countingDate')),exports['sequelize']['fn'](a2_0x2fc5('0x43'),exports[a2_0x2fc5('0x4')]['col'](a2_0x2fc5('0x2f')))],'order':[['countingDate',a2_0x2fc5('0x30')]]})['then'](_0x26a483=>{_0x17de81['json']({'data':_0x26a483});});};exports['getFacebook']=(_0x438ec0,_0x2f2e90,_0x5b0bbd)=>{const _0x3a1154=_0x438ec0[a2_0x2fc5('0x44')][a2_0x2fc5('0x45')][a2_0x2fc5('0x46')](_0x3a1154=>_0x3a1154[a2_0x2fc5('0x47')]==='facebook');fbgraph_1[a2_0x2fc5('0x19')][a2_0x2fc5('0x48')](_0x3a1154['accessToken']);fbgraph_1[a2_0x2fc5('0x19')][a2_0x2fc5('0x1c')](_0x438ec0[a2_0x2fc5('0x44')][a2_0x2fc5('0x49')]+a2_0x2fc5('0x4a'),(_0x5273ba,_0x4cd8a3)=>{if(_0x5273ba){return _0x5b0bbd(_0x5273ba);}_0x2f2e90['render'](a2_0x2fc5('0x4b'),{'title':a2_0x2fc5('0x4c'),'profile':_0x4cd8a3});});};