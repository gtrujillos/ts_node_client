var a2_0x39a9=['DAY','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','api/facebook','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','API\x20Examples','syncFtp','connecting','default','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','push','connect','downloadFtp','connected:','fileName','get','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','error','ftp.vivotek.com','ipd','processFtp','findOne','then','media/','readFile','Data','CountingInfo','Out','pass_counting','create','getPassCounting','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','sum','direction','HOUR'];(function(_0x5cb96c,_0x222f35){var _0x301f6a=function(_0x101f18){while(--_0x101f18){_0x5cb96c['push'](_0x5cb96c['shift']());}};_0x301f6a(++_0x222f35);}(a2_0x39a9,0x14d));var a2_0x4175=function(_0x23e7f1,_0x1b55bd){_0x23e7f1=_0x23e7f1-0x0;var _0x4af9b4=a2_0x39a9[_0x23e7f1];return _0x4af9b4;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x39a9e8){return _0x39a9e8&&_0x39a9e8['__esModule']?_0x39a9e8:{'default':_0x39a9e8};};Object['defineProperty'](exports,a2_0x4175('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x4175('0x1')));const ftp_1=__importDefault(require(a2_0x4175('0x2')));const fs_1=__importDefault(require('fs'));exports[a2_0x4175('0x3')]='';function setSequelize(_0x1eb9da){exports[a2_0x4175('0x3')]=_0x1eb9da;}exports[a2_0x4175('0x4')]=setSequelize;exports[a2_0x4175('0x5')]=(_0x4fdd90,_0x2bcd3c)=>{_0x2bcd3c['render']('api/index',{'title':a2_0x4175('0x6')});};exports[a2_0x4175('0x7')]=(_0x484615,_0x3df2bd)=>{console['log'](a2_0x4175('0x8'));const _0x3d21ab=[];const _0x1d36b7=new ftp_1[(a2_0x4175('0x9'))]();_0x1d36b7['on']('ready',function(){console[a2_0x4175('0xa')](a2_0x4175('0xb'));_0x1d36b7[a2_0x4175('0xc')](a2_0x4175('0xd'),![],function(_0x547e12,_0x19c71d){if(_0x547e12){}else{for(const _0x20d066 of _0x19c71d){console['log'](a2_0x4175('0xe')+_0x20d066[a2_0x4175('0xf')]);if(_0x20d066[a2_0x4175('0xf')][a2_0x4175('0x10')](a2_0x4175('0x11'))){exports['sequelize'][a2_0x4175('0x12')][a2_0x4175('0x13')][a2_0x4175('0x14')]({'where':{'fileName':_0x20d066[a2_0x4175('0xf')]}})[a2_0x4175('0x15')]((_0x396916,_0x22f057)=>{if(_0x22f057){console[a2_0x4175('0xa')](_0x20d066[a2_0x4175('0xf')]);_0x3d21ab[a2_0x4175('0x16')](_0x396916);}});}}}_0x3df2bd[a2_0x4175('0x11')]({'data':_0x3d21ab});});});_0x1d36b7['on']('error',function(_0x3d979d){_0x3df2bd[a2_0x4175('0x11')]({'message':_0x3d979d});});_0x1d36b7[a2_0x4175('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':'ipd'});};exports[a2_0x4175('0x18')]=(_0x3ca2d4,_0x4f8862)=>{exports[a2_0x4175('0x3')][a2_0x4175('0x12')]['report_files']['findOne']({'where':{'status':null}})['then'](_0x54bbcd=>{if(_0x54bbcd){const _0x135734=new ftp_1[(a2_0x4175('0x9'))]();_0x135734['on']('ready',function(){console[a2_0x4175('0xa')](a2_0x4175('0x19')+_0x54bbcd[a2_0x4175('0x1a')]);_0x135734[a2_0x4175('0x1b')]('colombia/'+_0x54bbcd[a2_0x4175('0x1a')],function(_0xd3933,_0xb37d52){_0x135734['end']();if(_0xd3933){}else{const _0x5c7cda='media/'+_0x54bbcd[a2_0x4175('0x1a')]+a2_0x4175('0x1c');_0xb37d52[a2_0x4175('0x1d')](fs_1[a2_0x4175('0x9')][a2_0x4175('0x1e')](_0x5c7cda));_0x54bbcd[a2_0x4175('0x1f')]=0x1;_0x54bbcd[a2_0x4175('0x20')]();console['log'](a2_0x4175('0x21')+_0x54bbcd['fileName']);}});});_0x135734['on'](a2_0x4175('0x22'),function(_0x47f960){_0x4f8862['json']({'message':_0x47f960});});_0x135734[a2_0x4175('0x17')]({'host':a2_0x4175('0x23'),'port':0x15,'user':a2_0x4175('0x24'),'password':a2_0x4175('0x24')});_0x4f8862[a2_0x4175('0x11')]({'data':_0x54bbcd[a2_0x4175('0x1a')]});}else{_0x4f8862[a2_0x4175('0x11')]({'data':[]});}});};exports[a2_0x4175('0x25')]=(_0x2dcbf2,_0x49d043)=>{exports[a2_0x4175('0x3')][a2_0x4175('0x12')][a2_0x4175('0x13')][a2_0x4175('0x26')]({'where':{'status':0x1}})[a2_0x4175('0x27')](_0x4a8b4d=>{if(_0x4a8b4d){const _0x161540=a2_0x4175('0x28')+_0x4a8b4d[a2_0x4175('0x1a')]+a2_0x4175('0x1c');fs_1[a2_0x4175('0x9')][a2_0x4175('0x29')](_0x161540,'utf8',function(_0x1e54d0,_0x1f476d){if(_0x1e54d0){_0x4a8b4d['status']=null;}else{try{const _0x308439=JSON['parse'](_0x1f476d);for(const _0x53aae7 of _0x308439[a2_0x4175('0x2a')][0x0][a2_0x4175('0x2b')]){const _0x29e123=_0x53aae7['In'];const _0x4d032e=_0x53aae7[a2_0x4175('0x2c')];const _0x23c4f7=Date['parse'](_0x53aae7['EndTime']);if(_0x29e123>0x0){exports[a2_0x4175('0x3')][a2_0x4175('0x12')][a2_0x4175('0x2d')][a2_0x4175('0x2e')]({'reportFileId':_0x4a8b4d['id'],'amount':_0x29e123,'countingDate':_0x23c4f7});}if(_0x4d032e>0x0){exports['sequelize'][a2_0x4175('0x12')][a2_0x4175('0x2d')][a2_0x4175('0x2e')]({'reportFileId':_0x4a8b4d['id'],'amount':_0x4d032e*-0x1,'countingDate':_0x23c4f7});}}_0x4a8b4d[a2_0x4175('0x1f')]=0x2;}catch(_0x5a5717){_0x4a8b4d[a2_0x4175('0x1f')]=null;}}_0x4a8b4d[a2_0x4175('0x20')]();});_0x49d043['json']({'data':_0x4a8b4d[a2_0x4175('0x1a')]});}else{_0x49d043['json']({'data':[]});}});};exports[a2_0x4175('0x2f')]=(_0x645677,_0x2d91fc)=>{exports['sequelize'][a2_0x4175('0x12')][a2_0x4175('0x2d')]['findAll']({'where':{'amount':{[exports[a2_0x4175('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0x4175('0x30'),a2_0x4175('0x31')]]})['then'](_0x291f05=>{_0x2d91fc[a2_0x4175('0x11')]({'data':_0x291f05});});};exports[a2_0x4175('0x32')]=(_0x20682d,_0x176aac)=>{const _0x5bce4d=_0x20682d[a2_0x4175('0x33')]['month'];const _0x3b6f82=_0x20682d[a2_0x4175('0x33')][a2_0x4175('0x34')];const _0x507126=_0x20682d[a2_0x4175('0x33')][a2_0x4175('0x35')];exports['sequelize'][a2_0x4175('0x12')]['pass_counting']['findAll']({'attributes':[a2_0x4175('0x30'),[exports['sequelize']['fn']('sum',exports[a2_0x4175('0x3')]['col']('amount')),a2_0x4175('0x36')]],'where':{'countingDate':{[exports[a2_0x4175('0x3')]['Op'][a2_0x4175('0x37')]]:_0x3b6f82,[exports[a2_0x4175('0x3')]['Op']['lt']]:_0x507126},'amount':_0x20682d[a2_0x4175('0x38')]['direction']=='in'?{[exports[a2_0x4175('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x4175('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4175('0x3')][a2_0x4175('0x39')](a2_0x4175('0x3a'))],'order':[[a2_0x4175('0x30'),a2_0x4175('0x31')]]})[a2_0x4175('0x27')](_0x173b01=>{_0x176aac[a2_0x4175('0x11')]({'data':_0x173b01});});};exports[a2_0x4175('0x3b')]=(_0x5105d2,_0x3c23cd)=>{const _0x33c4b5=_0x5105d2['query']['month'];const _0x3fe872=_0x5105d2[a2_0x4175('0x33')][a2_0x4175('0x34')];const _0x5992f6=_0x5105d2[a2_0x4175('0x33')][a2_0x4175('0x35')];exports[a2_0x4175('0x3')][a2_0x4175('0x12')]['pass_counting']['findAll']({'attributes':[a2_0x4175('0x30'),[exports[a2_0x4175('0x3')]['fn'](a2_0x4175('0x3c'),exports['sequelize'][a2_0x4175('0x3d')](a2_0x4175('0x30')),a2_0x4175('0x3e')),a2_0x4175('0x3f')],[exports[a2_0x4175('0x3')]['fn'](a2_0x4175('0x40'),exports[a2_0x4175('0x3')][a2_0x4175('0x3d')]('amount')),a2_0x4175('0x36')]],'where':{'countingDate':{[exports[a2_0x4175('0x3')]['Op'][a2_0x4175('0x37')]]:_0x3fe872,[exports[a2_0x4175('0x3')]['Op']['lt']]:_0x5992f6},'amount':_0x5105d2[a2_0x4175('0x38')][a2_0x4175('0x41')]=='in'?{[exports[a2_0x4175('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x4175('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x4175('0x3')]['fn'](a2_0x4175('0x42'),exports[a2_0x4175('0x3')]['col'](a2_0x4175('0x30'))),exports[a2_0x4175('0x3')]['fn'](a2_0x4175('0x43'),exports[a2_0x4175('0x3')][a2_0x4175('0x3d')](a2_0x4175('0x30'))),exports['sequelize']['fn'](a2_0x4175('0x44'),exports['sequelize'][a2_0x4175('0x3d')]('countingDate')),exports[a2_0x4175('0x3')]['fn'](a2_0x4175('0x45'),exports[a2_0x4175('0x3')][a2_0x4175('0x3d')](a2_0x4175('0x30')))],'order':[[a2_0x4175('0x30'),a2_0x4175('0x31')]]})[a2_0x4175('0x27')](_0x1f7b2f=>{_0x3c23cd['json']({'data':_0x1f7b2f});});};exports[a2_0x4175('0x46')]=(_0x25beed,_0x3af79f,_0x7144fb)=>{const _0x12d877=_0x25beed[a2_0x4175('0x47')][a2_0x4175('0x48')][a2_0x4175('0x49')](_0x12d877=>_0x12d877[a2_0x4175('0x4a')]===a2_0x4175('0x4b'));fbgraph_1['default']['setAccessToken'](_0x12d877[a2_0x4175('0x4c')]);fbgraph_1[a2_0x4175('0x9')][a2_0x4175('0x1b')](_0x25beed['user']['facebook']+a2_0x4175('0x4d'),(_0x28bffb,_0x18fff9)=>{if(_0x28bffb){return _0x7144fb(_0x28bffb);}_0x3af79f[a2_0x4175('0x4e')](a2_0x4175('0x4f'),{'title':'Facebook\x20API','profile':_0x18fff9});});};