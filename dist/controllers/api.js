var a2_0x3928=['tokens','kind','facebook','setAccessToken','accessToken','Facebook\x20API','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','render','api/index','connecting','default','ready','log','colombia','Downloading:\x20','name','endsWith','report_files','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','models','then','connected:','fileName','get','colombia/','media/','.txt','pipe','createWriteStream','status','json','processFtp','findOne','utf8','parse','Data','Out','EndTime','pass_counting','create','save','getPassCounting','findAll','ASC','getPassCountingByDay','query','month','startDate','countingDate','col','gte','params','direction','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','total','HOUR','DAY','YEAR','getFacebook','user'];(function(_0x26911f,_0x42ef24){var _0x3703e8=function(_0x2fab33){while(--_0x2fab33){_0x26911f['push'](_0x26911f['shift']());}};_0x3703e8(++_0x42ef24);}(a2_0x3928,0xa0));var a2_0x54d5=function(_0x3cc6e0,_0x3cc8f0){_0x3cc6e0=_0x3cc6e0-0x0;var _0x3ad7bd=a2_0x3928[_0x3cc6e0];return _0x3ad7bd;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x28ac65){return _0x28ac65&&_0x28ac65[a2_0x54d5('0x0')]?_0x28ac65:{'default':_0x28ac65};};Object[a2_0x54d5('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x54d5('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x54d5('0x3')]='';function setSequelize(_0x1a4b7a){exports[a2_0x54d5('0x3')]=_0x1a4b7a;}exports[a2_0x54d5('0x4')]=setSequelize;exports[a2_0x54d5('0x5')]=(_0x167030,_0x23acc8)=>{_0x23acc8[a2_0x54d5('0x6')](a2_0x54d5('0x7'),{'title':'API\x20Examples'});};exports['syncFtp']=(_0x4562f2,_0x1ebdea)=>{console['log'](a2_0x54d5('0x8'));const _0x3790d1=[];const _0x5b445a=new ftp_1[(a2_0x54d5('0x9'))]();_0x5b445a['on'](a2_0x54d5('0xa'),function(){console[a2_0x54d5('0xb')]('connected');_0x5b445a['list'](a2_0x54d5('0xc'),![],function(_0x2ab11c,_0x28bc1f){if(_0x2ab11c){}else{for(const _0x11660c of _0x28bc1f){console[a2_0x54d5('0xb')](a2_0x54d5('0xd')+_0x11660c['name']);if(_0x11660c[a2_0x54d5('0xe')][a2_0x54d5('0xf')]('json')){exports[a2_0x54d5('0x3')]['models'][a2_0x54d5('0x10')]['findOrCreate']({'where':{'fileName':_0x11660c[a2_0x54d5('0xe')]}})[a2_0x54d5('0x11')]((_0x371231,_0x40eb62)=>{if(_0x40eb62){console['log'](_0x11660c['name']);_0x3790d1[a2_0x54d5('0x12')](_0x371231);}});}}}_0x1ebdea['json']({'data':_0x3790d1});});});_0x5b445a['on'](a2_0x54d5('0x13'),function(_0x364007){_0x1ebdea['json']({'message':_0x364007});});_0x5b445a[a2_0x54d5('0x14')]({'host':a2_0x54d5('0x15'),'port':0x15,'user':a2_0x54d5('0x16'),'password':a2_0x54d5('0x16')});};exports[a2_0x54d5('0x17')]=(_0x2fe47e,_0x44a5b1)=>{exports[a2_0x54d5('0x3')][a2_0x54d5('0x18')]['report_files']['findOne']({'where':{'status':null}})[a2_0x54d5('0x19')](_0x193c56=>{if(_0x193c56){const _0x102c85=new ftp_1[(a2_0x54d5('0x9'))]();_0x102c85['on'](a2_0x54d5('0xa'),function(){console[a2_0x54d5('0xb')](a2_0x54d5('0x1a')+_0x193c56[a2_0x54d5('0x1b')]);_0x102c85[a2_0x54d5('0x1c')](a2_0x54d5('0x1d')+_0x193c56[a2_0x54d5('0x1b')],function(_0x2b144e,_0x2efa5f){_0x102c85['end']();if(_0x2b144e){}else{const _0xdf630=a2_0x54d5('0x1e')+_0x193c56[a2_0x54d5('0x1b')]+a2_0x54d5('0x1f');_0x2efa5f[a2_0x54d5('0x20')](fs_1['default'][a2_0x54d5('0x21')](_0xdf630));_0x193c56[a2_0x54d5('0x22')]=0x1;_0x193c56['save']();console['log']('Downloaded:\x20'+_0x193c56[a2_0x54d5('0x1b')]);}});});_0x102c85['on'](a2_0x54d5('0x13'),function(_0x4e3b64){_0x44a5b1['json']({'message':_0x4e3b64});});_0x102c85[a2_0x54d5('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a2_0x54d5('0x16')});_0x44a5b1['json']({'data':_0x193c56[a2_0x54d5('0x1b')]});}else{_0x44a5b1[a2_0x54d5('0x23')]({'data':[]});}});};exports[a2_0x54d5('0x24')]=(_0x3a7f68,_0x34c273)=>{exports[a2_0x54d5('0x3')][a2_0x54d5('0x18')][a2_0x54d5('0x10')][a2_0x54d5('0x25')]({'where':{'status':0x1}})['then'](_0x377b07=>{if(_0x377b07){const _0x14a7fe=a2_0x54d5('0x1e')+_0x377b07[a2_0x54d5('0x1b')]+a2_0x54d5('0x1f');fs_1['default']['readFile'](_0x14a7fe,a2_0x54d5('0x26'),function(_0xbf3f0,_0x4a784e){if(_0xbf3f0){_0x377b07[a2_0x54d5('0x22')]=null;}else{try{const _0x53d54e=JSON[a2_0x54d5('0x27')](_0x4a784e);for(const _0x2c85dc of _0x53d54e[a2_0x54d5('0x28')][0x0]['CountingInfo']){const _0x2e6ad1=_0x2c85dc['In'];const _0x128866=_0x2c85dc[a2_0x54d5('0x29')];const _0x30fb2b=Date[a2_0x54d5('0x27')](_0x2c85dc[a2_0x54d5('0x2a')]);if(_0x2e6ad1>0x0){exports['sequelize']['models'][a2_0x54d5('0x2b')]['create']({'reportFileId':_0x377b07['id'],'amount':_0x2e6ad1,'countingDate':_0x30fb2b});}if(_0x128866>0x0){exports['sequelize'][a2_0x54d5('0x18')][a2_0x54d5('0x2b')][a2_0x54d5('0x2c')]({'reportFileId':_0x377b07['id'],'amount':_0x128866*-0x1,'countingDate':_0x30fb2b});}}_0x377b07[a2_0x54d5('0x22')]=0x2;}catch(_0x2f7f2f){_0x377b07[a2_0x54d5('0x22')]=null;}}_0x377b07[a2_0x54d5('0x2d')]();});_0x34c273[a2_0x54d5('0x23')]({'data':_0x377b07[a2_0x54d5('0x1b')]});}else{_0x34c273['json']({'data':[]});}});};exports[a2_0x54d5('0x2e')]=(_0x3c14f9,_0x535f20)=>{exports['sequelize'][a2_0x54d5('0x18')][a2_0x54d5('0x2b')][a2_0x54d5('0x2f')]({'where':{'amount':{[exports[a2_0x54d5('0x3')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x54d5('0x30')]]})['then'](_0x3c540f=>{_0x535f20[a2_0x54d5('0x23')]({'data':_0x3c540f});});};exports[a2_0x54d5('0x31')]=(_0x3de0b3,_0x2b9a01)=>{const _0x3b7d95=_0x3de0b3[a2_0x54d5('0x32')][a2_0x54d5('0x33')];const _0x3ed0e2=_0x3de0b3[a2_0x54d5('0x32')][a2_0x54d5('0x34')];const _0x1c11eb=_0x3de0b3['query']['endDate'];exports[a2_0x54d5('0x3')][a2_0x54d5('0x18')][a2_0x54d5('0x2b')][a2_0x54d5('0x2f')]({'attributes':[a2_0x54d5('0x35'),[exports[a2_0x54d5('0x3')]['fn']('sum',exports[a2_0x54d5('0x3')][a2_0x54d5('0x36')]('amount')),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x54d5('0x37')]]:_0x3ed0e2,[exports[a2_0x54d5('0x3')]['Op']['lt']]:_0x1c11eb},'amount':_0x3de0b3[a2_0x54d5('0x38')][a2_0x54d5('0x39')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x54d5('0x3')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['literal'](a2_0x54d5('0x3a'))],'order':[[a2_0x54d5('0x35'),'ASC']]})[a2_0x54d5('0x19')](_0x2c8bba=>{_0x2b9a01['json']({'data':_0x2c8bba});});};exports[a2_0x54d5('0x3b')]=(_0xba7c84,_0x433634)=>{const _0x1caf84=_0xba7c84[a2_0x54d5('0x32')][a2_0x54d5('0x33')];const _0x16b81d=_0xba7c84[a2_0x54d5('0x32')][a2_0x54d5('0x34')];const _0x2a3564=_0xba7c84[a2_0x54d5('0x32')][a2_0x54d5('0x3c')];exports['sequelize'][a2_0x54d5('0x18')][a2_0x54d5('0x2b')][a2_0x54d5('0x2f')]({'attributes':['countingDate',[exports[a2_0x54d5('0x3')]['fn'](a2_0x54d5('0x3d'),exports[a2_0x54d5('0x3')]['col'](a2_0x54d5('0x35')),a2_0x54d5('0x3e')),a2_0x54d5('0x3f')],[exports[a2_0x54d5('0x3')]['fn'](a2_0x54d5('0x40'),exports[a2_0x54d5('0x3')]['col']('amount')),a2_0x54d5('0x41')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x54d5('0x37')]]:_0x16b81d,[exports['sequelize']['Op']['lt']]:_0x2a3564},'amount':_0xba7c84[a2_0x54d5('0x38')][a2_0x54d5('0x39')]=='in'?{[exports[a2_0x54d5('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x54d5('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x54d5('0x3')]['fn'](a2_0x54d5('0x42'),exports[a2_0x54d5('0x3')][a2_0x54d5('0x36')](a2_0x54d5('0x35'))),exports[a2_0x54d5('0x3')]['fn'](a2_0x54d5('0x43'),exports['sequelize'][a2_0x54d5('0x36')](a2_0x54d5('0x35'))),exports['sequelize']['fn']('MONTH',exports[a2_0x54d5('0x3')][a2_0x54d5('0x36')](a2_0x54d5('0x35'))),exports['sequelize']['fn'](a2_0x54d5('0x44'),exports[a2_0x54d5('0x3')][a2_0x54d5('0x36')](a2_0x54d5('0x35')))],'order':[[a2_0x54d5('0x35'),a2_0x54d5('0x30')]]})['then'](_0x47a7b8=>{_0x433634[a2_0x54d5('0x23')]({'data':_0x47a7b8});});};exports[a2_0x54d5('0x45')]=(_0x4cdc46,_0x81caad,_0x48f356)=>{const _0x347b40=_0x4cdc46[a2_0x54d5('0x46')][a2_0x54d5('0x47')]['find'](_0x347b40=>_0x347b40[a2_0x54d5('0x48')]===a2_0x54d5('0x49'));fbgraph_1['default'][a2_0x54d5('0x4a')](_0x347b40[a2_0x54d5('0x4b')]);fbgraph_1[a2_0x54d5('0x9')][a2_0x54d5('0x1c')](_0x4cdc46[a2_0x54d5('0x46')]['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x37ec9a,_0x555858)=>{if(_0x37ec9a){return _0x48f356(_0x37ec9a);}_0x81caad[a2_0x54d5('0x6')]('api/facebook',{'title':a2_0x54d5('0x4c'),'profile':_0x555858});});};