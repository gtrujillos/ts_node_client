var a2_0x33c6=['MONTH','YEAR','find','facebook','setAccessToken','get','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','api/index','log','connecting','default','ready','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','connected:','fileName','colombia/','end','.txt','createWriteStream','status','save','Downloaded:\x20','processFtp','then','media/','readFile','utf8','parse','Data','CountingInfo','Out','pass_counting','create','getPassCounting','findAll','ASC','month','query','startDate','endDate','countingDate','sum','amount','total','params','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','direction','HOUR','DAY'];(function(_0x9f90be,_0x3f6233){var _0x43cdb1=function(_0x43e933){while(--_0x43e933){_0x9f90be['push'](_0x9f90be['shift']());}};_0x43cdb1(++_0x3f6233);}(a2_0x33c6,0x142));var a2_0x2476=function(_0x5bbb02,_0x3a49c4){_0x5bbb02=_0x5bbb02-0x0;var _0x284d36=a2_0x33c6[_0x5bbb02];return _0x284d36;};'use strict';var __importDefault=this&&this[a2_0x2476('0x0')]||function(_0x50c36a){return _0x50c36a&&_0x50c36a[a2_0x2476('0x1')]?_0x50c36a:{'default':_0x50c36a};};Object[a2_0x2476('0x2')](exports,a2_0x2476('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x2476('0x3')));const ftp_1=__importDefault(require(a2_0x2476('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x2476('0x5')]='';function setSequelize(_0x2555fb){exports[a2_0x2476('0x5')]=_0x2555fb;}exports[a2_0x2476('0x6')]=setSequelize;exports[a2_0x2476('0x7')]=(_0x3dae13,_0x4e737b)=>{_0x4e737b['render'](a2_0x2476('0x8'),{'title':'API\x20Examples'});};exports['syncFtp']=(_0x315589,_0x36335d)=>{console[a2_0x2476('0x9')](a2_0x2476('0xa'));const _0x170504=[];const _0x69a497=new ftp_1[(a2_0x2476('0xb'))]();_0x69a497['on'](a2_0x2476('0xc'),function(){console[a2_0x2476('0x9')]('connected');_0x69a497['list']('colombia',![],function(_0xf4459b,_0x4fef7a){if(_0xf4459b){}else{for(const _0x1532e9 of _0x4fef7a){console['log'](a2_0x2476('0xd')+_0x1532e9['name']);if(_0x1532e9[a2_0x2476('0xe')][a2_0x2476('0xf')](a2_0x2476('0x10'))){exports['sequelize'][a2_0x2476('0x11')][a2_0x2476('0x12')][a2_0x2476('0x13')]({'where':{'fileName':_0x1532e9['name']}})[a2_0x2476('0x14')]((_0x2442b2,_0x4cced9)=>{if(_0x4cced9){console['log'](_0x1532e9['name']);_0x170504['push'](_0x2442b2);}});}}}_0x36335d[a2_0x2476('0x10')]({'data':_0x170504});});});_0x69a497['on'](a2_0x2476('0x15'),function(_0x12c237){_0x36335d[a2_0x2476('0x10')]({'message':_0x12c237});});_0x69a497[a2_0x2476('0x16')]({'host':a2_0x2476('0x17'),'port':0x15,'user':a2_0x2476('0x18'),'password':a2_0x2476('0x18')});};exports[a2_0x2476('0x19')]=(_0x326923,_0x457c73)=>{exports[a2_0x2476('0x5')][a2_0x2476('0x11')][a2_0x2476('0x12')][a2_0x2476('0x1a')]({'where':{'status':null}})['then'](_0x1ed567=>{if(_0x1ed567){const _0x31a155=new ftp_1[(a2_0x2476('0xb'))]();_0x31a155['on'](a2_0x2476('0xc'),function(){console[a2_0x2476('0x9')](a2_0x2476('0x1b')+_0x1ed567[a2_0x2476('0x1c')]);_0x31a155['get'](a2_0x2476('0x1d')+_0x1ed567['fileName'],function(_0x16485c,_0x8a414c){_0x31a155[a2_0x2476('0x1e')]();if(_0x16485c){}else{const _0x3cf0fb='media/'+_0x1ed567['fileName']+a2_0x2476('0x1f');_0x8a414c['pipe'](fs_1[a2_0x2476('0xb')][a2_0x2476('0x20')](_0x3cf0fb));_0x1ed567[a2_0x2476('0x21')]=0x1;_0x1ed567[a2_0x2476('0x22')]();console[a2_0x2476('0x9')](a2_0x2476('0x23')+_0x1ed567[a2_0x2476('0x1c')]);}});});_0x31a155['on'](a2_0x2476('0x15'),function(_0x3e857d){_0x457c73['json']({'message':_0x3e857d});});_0x31a155['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x2476('0x18'),'password':a2_0x2476('0x18')});_0x457c73['json']({'data':_0x1ed567['fileName']});}else{_0x457c73[a2_0x2476('0x10')]({'data':[]});}});};exports[a2_0x2476('0x24')]=(_0x36d810,_0x5527fc)=>{exports[a2_0x2476('0x5')][a2_0x2476('0x11')]['report_files'][a2_0x2476('0x1a')]({'where':{'status':0x1}})[a2_0x2476('0x25')](_0x16ad8b=>{if(_0x16ad8b){const _0x4a24b9=a2_0x2476('0x26')+_0x16ad8b[a2_0x2476('0x1c')]+a2_0x2476('0x1f');fs_1['default'][a2_0x2476('0x27')](_0x4a24b9,a2_0x2476('0x28'),function(_0x4cc16a,_0x1d79b9){if(_0x4cc16a){_0x16ad8b[a2_0x2476('0x21')]=null;}else{try{const _0x4434ff=JSON[a2_0x2476('0x29')](_0x1d79b9);for(const _0x196830 of _0x4434ff[a2_0x2476('0x2a')][0x0][a2_0x2476('0x2b')]){const _0x465153=_0x196830['In'];const _0x250156=_0x196830[a2_0x2476('0x2c')];const _0x358a2b=Date[a2_0x2476('0x29')](_0x196830['EndTime']);if(_0x465153>0x0){exports[a2_0x2476('0x5')]['models'][a2_0x2476('0x2d')]['create']({'reportFileId':_0x16ad8b['id'],'amount':_0x465153,'countingDate':_0x358a2b});}if(_0x250156>0x0){exports['sequelize'][a2_0x2476('0x11')][a2_0x2476('0x2d')][a2_0x2476('0x2e')]({'reportFileId':_0x16ad8b['id'],'amount':_0x250156*-0x1,'countingDate':_0x358a2b});}}_0x16ad8b['status']=0x2;}catch(_0x2a1535){_0x16ad8b[a2_0x2476('0x21')]=null;}}_0x16ad8b[a2_0x2476('0x22')]();});_0x5527fc[a2_0x2476('0x10')]({'data':_0x16ad8b[a2_0x2476('0x1c')]});}else{_0x5527fc[a2_0x2476('0x10')]({'data':[]});}});};exports[a2_0x2476('0x2f')]=(_0x22205e,_0x456cfc)=>{exports['sequelize'][a2_0x2476('0x11')][a2_0x2476('0x2d')][a2_0x2476('0x30')]({'where':{'amount':{[exports[a2_0x2476('0x5')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x2476('0x31')]]})[a2_0x2476('0x25')](_0x3e2d88=>{_0x456cfc['json']({'data':_0x3e2d88});});};exports['getPassCountingByDay']=(_0x2d1ccb,_0x17756b)=>{const _0x507443=_0x2d1ccb['query'][a2_0x2476('0x32')];const _0x157969=_0x2d1ccb[a2_0x2476('0x33')][a2_0x2476('0x34')];const _0x33c8c3=_0x2d1ccb[a2_0x2476('0x33')][a2_0x2476('0x35')];exports[a2_0x2476('0x5')][a2_0x2476('0x11')][a2_0x2476('0x2d')][a2_0x2476('0x30')]({'attributes':[a2_0x2476('0x36'),[exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x37'),exports['sequelize']['col'](a2_0x2476('0x38'))),a2_0x2476('0x39')]],'where':{'countingDate':{[exports[a2_0x2476('0x5')]['Op']['gte']]:_0x157969,[exports[a2_0x2476('0x5')]['Op']['lt']]:_0x33c8c3},'amount':_0x2d1ccb[a2_0x2476('0x3a')]['direction']=='in'?{[exports[a2_0x2476('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x2476('0x5')]['literal'](a2_0x2476('0x3b'))],'order':[[a2_0x2476('0x36'),a2_0x2476('0x31')]]})[a2_0x2476('0x25')](_0x346fd9=>{_0x17756b[a2_0x2476('0x10')]({'data':_0x346fd9});});};exports[a2_0x2476('0x3c')]=(_0x1021ea,_0x2ae047)=>{const _0x5a3e4d=_0x1021ea[a2_0x2476('0x33')][a2_0x2476('0x32')];const _0x1e040d=_0x1021ea[a2_0x2476('0x33')][a2_0x2476('0x34')];const _0x11ac2e=_0x1021ea['query'][a2_0x2476('0x35')];exports[a2_0x2476('0x5')][a2_0x2476('0x11')][a2_0x2476('0x2d')][a2_0x2476('0x30')]({'attributes':['countingDate',[exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x3d'),exports[a2_0x2476('0x5')][a2_0x2476('0x3e')](a2_0x2476('0x36')),a2_0x2476('0x3f')),a2_0x2476('0x40')],[exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x37'),exports['sequelize'][a2_0x2476('0x3e')](a2_0x2476('0x38'))),a2_0x2476('0x39')]],'where':{'countingDate':{[exports[a2_0x2476('0x5')]['Op']['gte']]:_0x1e040d,[exports['sequelize']['Op']['lt']]:_0x11ac2e},'amount':_0x1021ea[a2_0x2476('0x3a')][a2_0x2476('0x41')]=='in'?{[exports[a2_0x2476('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x2476('0x5')]['Op']['lt']]:0x0}},'group':[exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x42'),exports[a2_0x2476('0x5')][a2_0x2476('0x3e')](a2_0x2476('0x36'))),exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x43'),exports[a2_0x2476('0x5')][a2_0x2476('0x3e')](a2_0x2476('0x36'))),exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x44'),exports[a2_0x2476('0x5')][a2_0x2476('0x3e')](a2_0x2476('0x36'))),exports[a2_0x2476('0x5')]['fn'](a2_0x2476('0x45'),exports['sequelize'][a2_0x2476('0x3e')]('countingDate'))],'order':[[a2_0x2476('0x36'),a2_0x2476('0x31')]]})['then'](_0x5343c6=>{_0x2ae047[a2_0x2476('0x10')]({'data':_0x5343c6});});};exports['getFacebook']=(_0x4aaa43,_0xe8c35a,_0x8d2eed)=>{const _0x2e4c4e=_0x4aaa43['user']['tokens'][a2_0x2476('0x46')](_0x2e4c4e=>_0x2e4c4e['kind']===a2_0x2476('0x47'));fbgraph_1['default'][a2_0x2476('0x48')](_0x2e4c4e['accessToken']);fbgraph_1[a2_0x2476('0xb')][a2_0x2476('0x49')](_0x4aaa43[a2_0x2476('0x4a')][a2_0x2476('0x47')]+a2_0x2476('0x4b'),(_0x10af4f,_0x2b21c2)=>{if(_0x10af4f){return _0x8d2eed(_0x10af4f);}_0xe8c35a[a2_0x2476('0x4c')]('api/facebook',{'title':a2_0x2476('0x4d'),'profile':_0x2b21c2});});};