var a2_0x349b=['EndTime','pass_counting','create','save','getPassCounting','findAll','ASC','query','month','startDate','endDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','countingDate','getPassCountingByHour','%Y-%m-%d\x20%H:00','countingDateShort','HOUR','DAY','YEAR','getFacebook','user','tokens','find','facebook','setAccessToken','accessToken','api/facebook','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','default','ready','connected:','get','colombia/','fileName','end','media/','createWriteStream','Downloaded:\x20','processFtp','readFile','status','Data','Out'];(function(_0x3ee8bb,_0x43a90f){var _0x409efd=function(_0x42f86e){while(--_0x42f86e){_0x3ee8bb['push'](_0x3ee8bb['shift']());}};_0x409efd(++_0x43a90f);}(a2_0x349b,0x167));var a2_0x28a6=function(_0xb7dc0d,_0xd4b7a){_0xb7dc0d=_0xb7dc0d-0x0;var _0x1a9150=a2_0x349b[_0xb7dc0d];return _0x1a9150;};'use strict';var __importDefault=this&&this[a2_0x28a6('0x0')]||function(_0x3b5544){return _0x3b5544&&_0x3b5544[a2_0x28a6('0x1')]?_0x3b5544:{'default':_0x3b5544};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x28a6('0x2')));const ftp_1=__importDefault(require(a2_0x28a6('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x28a6('0x4')]='';function setSequelize(_0xf7c82d){exports['sequelize']=_0xf7c82d;}exports[a2_0x28a6('0x5')]=setSequelize;exports[a2_0x28a6('0x6')]=(_0x23db7,_0x4d46b5)=>{_0x4d46b5[a2_0x28a6('0x7')](a2_0x28a6('0x8'),{'title':a2_0x28a6('0x9')});};exports[a2_0x28a6('0xa')]=(_0x1113af,_0x43c4b1)=>{console[a2_0x28a6('0xb')](a2_0x28a6('0xc'));const _0x3a0e3b=[];const _0x4804c8=new ftp_1['default']();_0x4804c8['on']('ready',function(){console['log'](a2_0x28a6('0xd'));_0x4804c8[a2_0x28a6('0xe')](a2_0x28a6('0xf'),![],function(_0x1be121,_0x154f40){if(_0x1be121){}else{for(const _0x2a1f43 of _0x154f40){console[a2_0x28a6('0xb')](a2_0x28a6('0x10')+_0x2a1f43['name']);if(_0x2a1f43[a2_0x28a6('0x11')][a2_0x28a6('0x12')](a2_0x28a6('0x13'))){exports[a2_0x28a6('0x4')][a2_0x28a6('0x14')][a2_0x28a6('0x15')][a2_0x28a6('0x16')]({'where':{'fileName':_0x2a1f43[a2_0x28a6('0x11')]}})[a2_0x28a6('0x17')]((_0x53f59a,_0x8bf2d2)=>{if(_0x8bf2d2){console[a2_0x28a6('0xb')](_0x2a1f43[a2_0x28a6('0x11')]);_0x3a0e3b[a2_0x28a6('0x18')](_0x53f59a);}});}}}_0x43c4b1[a2_0x28a6('0x13')]({'data':_0x3a0e3b});});});_0x4804c8['on'](a2_0x28a6('0x19'),function(_0xf205f5){_0x43c4b1[a2_0x28a6('0x13')]({'message':_0xf205f5});});_0x4804c8[a2_0x28a6('0x1a')]({'host':a2_0x28a6('0x1b'),'port':0x15,'user':a2_0x28a6('0x1c'),'password':a2_0x28a6('0x1c')});};exports['downloadFtp']=(_0x1f29a7,_0x5b05a2)=>{exports[a2_0x28a6('0x4')]['models'][a2_0x28a6('0x15')][a2_0x28a6('0x1d')]({'where':{'status':null}})[a2_0x28a6('0x1e')](_0x93b107=>{if(_0x93b107){const _0x4090e0=new ftp_1[(a2_0x28a6('0x1f'))]();_0x4090e0['on'](a2_0x28a6('0x20'),function(){console[a2_0x28a6('0xb')](a2_0x28a6('0x21')+_0x93b107['fileName']);_0x4090e0[a2_0x28a6('0x22')](a2_0x28a6('0x23')+_0x93b107[a2_0x28a6('0x24')],function(_0x2d72c9,_0x2ac847){_0x4090e0[a2_0x28a6('0x25')]();if(_0x2d72c9){}else{const _0x55fc38=a2_0x28a6('0x26')+_0x93b107[a2_0x28a6('0x24')]+'.txt';_0x2ac847['pipe'](fs_1['default'][a2_0x28a6('0x27')](_0x55fc38));_0x93b107['status']=0x1;_0x93b107['save']();console[a2_0x28a6('0xb')](a2_0x28a6('0x28')+_0x93b107['fileName']);}});});_0x4090e0['on'](a2_0x28a6('0x19'),function(_0x5de700){_0x5b05a2[a2_0x28a6('0x13')]({'message':_0x5de700});});_0x4090e0['connect']({'host':a2_0x28a6('0x1b'),'port':0x15,'user':a2_0x28a6('0x1c'),'password':a2_0x28a6('0x1c')});_0x5b05a2[a2_0x28a6('0x13')]({'data':_0x93b107[a2_0x28a6('0x24')]});}else{_0x5b05a2['json']({'data':[]});}});};exports[a2_0x28a6('0x29')]=(_0x3e43ca,_0x145f2c)=>{exports[a2_0x28a6('0x4')]['models'][a2_0x28a6('0x15')][a2_0x28a6('0x1d')]({'where':{'status':0x1}})[a2_0x28a6('0x1e')](_0x4824e8=>{if(_0x4824e8){const _0x187c29='media/'+_0x4824e8['fileName']+'.txt';fs_1[a2_0x28a6('0x1f')][a2_0x28a6('0x2a')](_0x187c29,'utf8',function(_0x57f97b,_0x258ecc){if(_0x57f97b){_0x4824e8[a2_0x28a6('0x2b')]=null;}else{try{const _0xff4dfb=JSON['parse'](_0x258ecc);for(const _0x2cf005 of _0xff4dfb[a2_0x28a6('0x2c')][0x0]['CountingInfo']){const _0x23bc59=_0x2cf005['In'];const _0x51a032=_0x2cf005[a2_0x28a6('0x2d')];const _0x25d401=Date['parse'](_0x2cf005[a2_0x28a6('0x2e')]);if(_0x23bc59>0x0){exports['sequelize'][a2_0x28a6('0x14')][a2_0x28a6('0x2f')][a2_0x28a6('0x30')]({'reportFileId':_0x4824e8['id'],'amount':_0x23bc59,'countingDate':_0x25d401});}if(_0x51a032>0x0){exports[a2_0x28a6('0x4')][a2_0x28a6('0x14')][a2_0x28a6('0x2f')][a2_0x28a6('0x30')]({'reportFileId':_0x4824e8['id'],'amount':_0x51a032*-0x1,'countingDate':_0x25d401});}}_0x4824e8['status']=0x2;}catch(_0x1c9f7a){_0x4824e8[a2_0x28a6('0x2b')]=null;}}_0x4824e8[a2_0x28a6('0x31')]();});_0x145f2c[a2_0x28a6('0x13')]({'data':_0x4824e8[a2_0x28a6('0x24')]});}else{_0x145f2c[a2_0x28a6('0x13')]({'data':[]});}});};exports[a2_0x28a6('0x32')]=(_0x10b44f,_0x26c6c5)=>{exports['sequelize'][a2_0x28a6('0x14')]['pass_counting'][a2_0x28a6('0x33')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x28a6('0x34')]]})[a2_0x28a6('0x1e')](_0x261116=>{_0x26c6c5[a2_0x28a6('0x13')]({'data':_0x261116});});};exports['getPassCountingByDay']=(_0xa202ee,_0x51a1e9)=>{const _0xdfb954=_0xa202ee[a2_0x28a6('0x35')][a2_0x28a6('0x36')];const _0x5d448c=_0xa202ee['query'][a2_0x28a6('0x37')];const _0x4ad299=_0xa202ee['query'][a2_0x28a6('0x38')];exports[a2_0x28a6('0x4')][a2_0x28a6('0x14')][a2_0x28a6('0x2f')]['findAll']({'attributes':['countingDate',[exports[a2_0x28a6('0x4')]['fn'](a2_0x28a6('0x39'),exports[a2_0x28a6('0x4')][a2_0x28a6('0x3a')](a2_0x28a6('0x3b'))),a2_0x28a6('0x3c')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x28a6('0x3d')]]:_0x5d448c,[exports['sequelize']['Op']['lt']]:_0x4ad299},'amount':_0xa202ee[a2_0x28a6('0x3e')][a2_0x28a6('0x3f')]=='in'?{[exports[a2_0x28a6('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x28a6('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x28a6('0x4')][a2_0x28a6('0x40')](a2_0x28a6('0x41'))],'order':[[a2_0x28a6('0x42'),'ASC']]})[a2_0x28a6('0x1e')](_0x14c36b=>{_0x51a1e9['json']({'data':_0x14c36b});});};exports[a2_0x28a6('0x43')]=(_0x53c9f0,_0x123926)=>{const _0x29043f=_0x53c9f0['query'][a2_0x28a6('0x36')];const _0x1f0f75=_0x53c9f0[a2_0x28a6('0x35')][a2_0x28a6('0x37')];const _0x1ab2f1=_0x53c9f0[a2_0x28a6('0x35')][a2_0x28a6('0x38')];exports[a2_0x28a6('0x4')][a2_0x28a6('0x14')]['pass_counting']['findAll']({'attributes':['countingDate',[exports[a2_0x28a6('0x4')]['fn']('DATE_FORMAT',exports[a2_0x28a6('0x4')][a2_0x28a6('0x3a')](a2_0x28a6('0x42')),a2_0x28a6('0x44')),a2_0x28a6('0x45')],[exports[a2_0x28a6('0x4')]['fn']('sum',exports[a2_0x28a6('0x4')][a2_0x28a6('0x3a')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x28a6('0x4')]['Op'][a2_0x28a6('0x3d')]]:_0x1f0f75,[exports['sequelize']['Op']['lt']]:_0x1ab2f1},'amount':_0x53c9f0[a2_0x28a6('0x3e')]['direction']=='in'?{[exports[a2_0x28a6('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x28a6('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x28a6('0x4')]['fn'](a2_0x28a6('0x46'),exports[a2_0x28a6('0x4')][a2_0x28a6('0x3a')](a2_0x28a6('0x42'))),exports[a2_0x28a6('0x4')]['fn'](a2_0x28a6('0x47'),exports[a2_0x28a6('0x4')]['col']('countingDate')),exports[a2_0x28a6('0x4')]['fn']('MONTH',exports['sequelize']['col'](a2_0x28a6('0x42'))),exports[a2_0x28a6('0x4')]['fn'](a2_0x28a6('0x48'),exports['sequelize']['col'](a2_0x28a6('0x42')))],'order':[[a2_0x28a6('0x42'),'ASC']]})['then'](_0x1648b0=>{_0x123926['json']({'data':_0x1648b0});});};exports[a2_0x28a6('0x49')]=(_0x63f5d9,_0x429c14,_0x434315)=>{const _0x210dc7=_0x63f5d9[a2_0x28a6('0x4a')][a2_0x28a6('0x4b')][a2_0x28a6('0x4c')](_0x210dc7=>_0x210dc7['kind']===a2_0x28a6('0x4d'));fbgraph_1[a2_0x28a6('0x1f')][a2_0x28a6('0x4e')](_0x210dc7[a2_0x28a6('0x4f')]);fbgraph_1[a2_0x28a6('0x1f')]['get'](_0x63f5d9['user'][a2_0x28a6('0x4d')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x514913,_0x28eca4)=>{if(_0x514913){return _0x434315(_0x514913);}_0x429c14['render'](a2_0x28a6('0x50'),{'title':'Facebook\x20API','profile':_0x28eca4});});};