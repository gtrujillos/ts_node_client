var a2_0x1acd=['name','json','models','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','report_files','findOne','connected:','get','colombia/','fileName','end','pipe','createWriteStream','save','processFtp','then','.txt','readFile','utf8','status','parse','Data','CountingInfo','Out','EndTime','pass_counting','getPassCounting','findAll','ASC','query','month','startDate','endDate','countingDate','sum','col','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','%Y-%m-%d\x20%H:00','countingDateShort','amount','direction','HOUR','YEAR','getFacebook','user','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','syncFtp','connecting','default','ready','log','connected','list','colombia'];(function(_0x235213,_0x4e4b5d){var _0x2207cf=function(_0x467f71){while(--_0x467f71){_0x235213['push'](_0x235213['shift']());}};_0x2207cf(++_0x4e4b5d);}(a2_0x1acd,0x8a));var a2_0x1bac=function(_0x334a5b,_0x2a47dc){_0x334a5b=_0x334a5b-0x0;var _0x1f3d27=a2_0x1acd[_0x334a5b];return _0x1f3d27;};'use strict';var __importDefault=this&&this[a2_0x1bac('0x0')]||function(_0x3c82ac){return _0x3c82ac&&_0x3c82ac[a2_0x1bac('0x1')]?_0x3c82ac:{'default':_0x3c82ac};};Object[a2_0x1bac('0x2')](exports,a2_0x1bac('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1bac('0x3')));const ftp_1=__importDefault(require(a2_0x1bac('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x1bac('0x5')]='';function setSequelize(_0x1ae881){exports['sequelize']=_0x1ae881;}exports['setSequelize']=setSequelize;exports[a2_0x1bac('0x6')]=(_0x46740b,_0x44dc90)=>{_0x44dc90[a2_0x1bac('0x7')]('api/index',{'title':'API\x20Examples'});};exports[a2_0x1bac('0x8')]=(_0x4bcc45,_0x1193a1)=>{console['log'](a2_0x1bac('0x9'));const _0x40e2ad=[];const _0x420a9f=new ftp_1[(a2_0x1bac('0xa'))]();_0x420a9f['on'](a2_0x1bac('0xb'),function(){console[a2_0x1bac('0xc')](a2_0x1bac('0xd'));_0x420a9f[a2_0x1bac('0xe')](a2_0x1bac('0xf'),![],function(_0x42c273,_0x2b429d){if(_0x42c273){}else{for(const _0x20f27b of _0x2b429d){console[a2_0x1bac('0xc')]('Downloading:\x20'+_0x20f27b['name']);if(_0x20f27b[a2_0x1bac('0x10')]['endsWith'](a2_0x1bac('0x11'))){exports[a2_0x1bac('0x5')][a2_0x1bac('0x12')]['report_files'][a2_0x1bac('0x13')]({'where':{'fileName':_0x20f27b[a2_0x1bac('0x10')]}})['spread']((_0x44d1d9,_0x1b9b34)=>{if(_0x1b9b34){console[a2_0x1bac('0xc')](_0x20f27b['name']);_0x40e2ad[a2_0x1bac('0x14')](_0x44d1d9);}});}}}_0x1193a1[a2_0x1bac('0x11')]({'data':_0x40e2ad});});});_0x420a9f['on'](a2_0x1bac('0x15'),function(_0x968bac){_0x1193a1[a2_0x1bac('0x11')]({'message':_0x968bac});});_0x420a9f[a2_0x1bac('0x16')]({'host':a2_0x1bac('0x17'),'port':0x15,'user':a2_0x1bac('0x18'),'password':a2_0x1bac('0x18')});};exports['downloadFtp']=(_0x1f64a3,_0xcad413)=>{exports[a2_0x1bac('0x5')]['models'][a2_0x1bac('0x19')][a2_0x1bac('0x1a')]({'where':{'status':null}})['then'](_0x543726=>{if(_0x543726){const _0x35e92f=new ftp_1['default']();_0x35e92f['on'](a2_0x1bac('0xb'),function(){console[a2_0x1bac('0xc')](a2_0x1bac('0x1b')+_0x543726['fileName']);_0x35e92f[a2_0x1bac('0x1c')](a2_0x1bac('0x1d')+_0x543726[a2_0x1bac('0x1e')],function(_0x312183,_0x5227c6){_0x35e92f[a2_0x1bac('0x1f')]();if(_0x312183){}else{const _0x18334d='media/'+_0x543726['fileName']+'.txt';_0x5227c6[a2_0x1bac('0x20')](fs_1[a2_0x1bac('0xa')][a2_0x1bac('0x21')](_0x18334d));_0x543726['status']=0x1;_0x543726[a2_0x1bac('0x22')]();console[a2_0x1bac('0xc')]('Downloaded:\x20'+_0x543726['fileName']);}});});_0x35e92f['on'](a2_0x1bac('0x15'),function(_0x1502a3){_0xcad413['json']({'message':_0x1502a3});});_0x35e92f[a2_0x1bac('0x16')]({'host':a2_0x1bac('0x17'),'port':0x15,'user':a2_0x1bac('0x18'),'password':a2_0x1bac('0x18')});_0xcad413[a2_0x1bac('0x11')]({'data':_0x543726[a2_0x1bac('0x1e')]});}else{_0xcad413[a2_0x1bac('0x11')]({'data':[]});}});};exports[a2_0x1bac('0x23')]=(_0x5a1be3,_0x53a325)=>{exports[a2_0x1bac('0x5')]['models'][a2_0x1bac('0x19')][a2_0x1bac('0x1a')]({'where':{'status':0x1}})[a2_0x1bac('0x24')](_0x5454d8=>{if(_0x5454d8){const _0x525687='media/'+_0x5454d8[a2_0x1bac('0x1e')]+a2_0x1bac('0x25');fs_1[a2_0x1bac('0xa')][a2_0x1bac('0x26')](_0x525687,a2_0x1bac('0x27'),function(_0x2bb926,_0x2f1266){if(_0x2bb926){_0x5454d8[a2_0x1bac('0x28')]=null;}else{try{const _0x2d4376=JSON[a2_0x1bac('0x29')](_0x2f1266);for(const _0x211fb6 of _0x2d4376[a2_0x1bac('0x2a')][0x0][a2_0x1bac('0x2b')]){const _0x47c830=_0x211fb6['In'];const _0x54034e=_0x211fb6[a2_0x1bac('0x2c')];const _0x48f185=Date['parse'](_0x211fb6[a2_0x1bac('0x2d')]);if(_0x47c830>0x0){exports[a2_0x1bac('0x5')]['models'][a2_0x1bac('0x2e')]['create']({'reportFileId':_0x5454d8['id'],'amount':_0x47c830,'countingDate':_0x48f185});}if(_0x54034e>0x0){exports[a2_0x1bac('0x5')][a2_0x1bac('0x12')]['pass_counting']['create']({'reportFileId':_0x5454d8['id'],'amount':_0x54034e*-0x1,'countingDate':_0x48f185});}}_0x5454d8[a2_0x1bac('0x28')]=0x2;}catch(_0x4061a3){_0x5454d8[a2_0x1bac('0x28')]=null;}}_0x5454d8[a2_0x1bac('0x22')]();});_0x53a325[a2_0x1bac('0x11')]({'data':_0x5454d8[a2_0x1bac('0x1e')]});}else{_0x53a325[a2_0x1bac('0x11')]({'data':[]});}});};exports[a2_0x1bac('0x2f')]=(_0x58ada5,_0x3f7fa0)=>{exports[a2_0x1bac('0x5')][a2_0x1bac('0x12')][a2_0x1bac('0x2e')][a2_0x1bac('0x30')]({'where':{'amount':{[exports[a2_0x1bac('0x5')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x1bac('0x31')]]})[a2_0x1bac('0x24')](_0x29321d=>{_0x3f7fa0['json']({'data':_0x29321d});});};exports['getPassCountingByDay']=(_0x21fc3a,_0xff0b15)=>{const _0x319419=_0x21fc3a[a2_0x1bac('0x32')][a2_0x1bac('0x33')];const _0x478cf4=_0x21fc3a['query'][a2_0x1bac('0x34')];const _0x5537f6=_0x21fc3a[a2_0x1bac('0x32')][a2_0x1bac('0x35')];exports['sequelize']['models'][a2_0x1bac('0x2e')][a2_0x1bac('0x30')]({'attributes':[a2_0x1bac('0x36'),[exports[a2_0x1bac('0x5')]['fn'](a2_0x1bac('0x37'),exports[a2_0x1bac('0x5')][a2_0x1bac('0x38')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x1bac('0x5')]['Op'][a2_0x1bac('0x39')]]:_0x478cf4,[exports[a2_0x1bac('0x5')]['Op']['lt']]:_0x5537f6},'amount':_0x21fc3a[a2_0x1bac('0x3a')]['direction']=='in'?{[exports[a2_0x1bac('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x1bac('0x3b')](a2_0x1bac('0x3c'))],'order':[[a2_0x1bac('0x36'),a2_0x1bac('0x31')]]})[a2_0x1bac('0x24')](_0x5e8b39=>{_0xff0b15[a2_0x1bac('0x11')]({'data':_0x5e8b39});});};exports[a2_0x1bac('0x3d')]=(_0x2494c3,_0x45c70d)=>{const _0xc32c6e=_0x2494c3[a2_0x1bac('0x32')]['month'];const _0x1dfa9c=_0x2494c3[a2_0x1bac('0x32')][a2_0x1bac('0x34')];const _0xa07336=_0x2494c3['query'][a2_0x1bac('0x35')];exports['sequelize'][a2_0x1bac('0x12')][a2_0x1bac('0x2e')]['findAll']({'attributes':[a2_0x1bac('0x36'),[exports[a2_0x1bac('0x5')]['fn']('DATE_FORMAT',exports[a2_0x1bac('0x5')][a2_0x1bac('0x38')](a2_0x1bac('0x36')),a2_0x1bac('0x3e')),a2_0x1bac('0x3f')],[exports['sequelize']['fn']('sum',exports['sequelize'][a2_0x1bac('0x38')](a2_0x1bac('0x40'))),'total']],'where':{'countingDate':{[exports[a2_0x1bac('0x5')]['Op'][a2_0x1bac('0x39')]]:_0x1dfa9c,[exports[a2_0x1bac('0x5')]['Op']['lt']]:_0xa07336},'amount':_0x2494c3[a2_0x1bac('0x3a')][a2_0x1bac('0x41')]=='in'?{[exports[a2_0x1bac('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x1bac('0x5')]['fn'](a2_0x1bac('0x42'),exports['sequelize'][a2_0x1bac('0x38')](a2_0x1bac('0x36'))),exports[a2_0x1bac('0x5')]['fn']('DAY',exports['sequelize'][a2_0x1bac('0x38')]('countingDate')),exports[a2_0x1bac('0x5')]['fn']('MONTH',exports[a2_0x1bac('0x5')][a2_0x1bac('0x38')](a2_0x1bac('0x36'))),exports[a2_0x1bac('0x5')]['fn'](a2_0x1bac('0x43'),exports[a2_0x1bac('0x5')]['col']('countingDate'))],'order':[['countingDate',a2_0x1bac('0x31')]]})['then'](_0xce83a3=>{_0x45c70d[a2_0x1bac('0x11')]({'data':_0xce83a3});});};exports[a2_0x1bac('0x44')]=(_0x2204ca,_0x428157,_0x6097d0)=>{const _0x799e3e=_0x2204ca[a2_0x1bac('0x45')]['tokens'][a2_0x1bac('0x46')](_0x799e3e=>_0x799e3e[a2_0x1bac('0x47')]===a2_0x1bac('0x48'));fbgraph_1['default'][a2_0x1bac('0x49')](_0x799e3e[a2_0x1bac('0x4a')]);fbgraph_1[a2_0x1bac('0xa')][a2_0x1bac('0x1c')](_0x2204ca[a2_0x1bac('0x45')][a2_0x1bac('0x48')]+a2_0x1bac('0x4b'),(_0x16295e,_0x517066)=>{if(_0x16295e){return _0x6097d0(_0x16295e);}_0x428157[a2_0x1bac('0x7')](a2_0x1bac('0x4c'),{'title':'Facebook\x20API','profile':_0x517066});});};