var a2_0x48ca=['gte','literal','getPassCountingByHour','month','countingDateShort','direction','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','api/facebook','Facebook\x20API','defineProperty','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','json','models','report_files','findOrCreate','name','spread','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','media/','utf8','parse','Data','Out','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','ASC','query','startDate','endDate','sum','col','amount','total'];(function(_0x975781,_0x278087){var _0x320ab7=function(_0x3a23cf){while(--_0x3a23cf){_0x975781['push'](_0x975781['shift']());}};_0x320ab7(++_0x278087);}(a2_0x48ca,0xb5));var a2_0x6ae5=function(_0xbcd7f9,_0x26e403){_0xbcd7f9=_0xbcd7f9-0x0;var _0x2ed5d4=a2_0x48ca[_0xbcd7f9];return _0x2ed5d4;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4815b7){return _0x4815b7&&_0x4815b7['__esModule']?_0x4815b7:{'default':_0x4815b7};};Object[a2_0x6ae5('0x0')](exports,a2_0x6ae5('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x6ae5('0x2')));const ftp_1=__importDefault(require(a2_0x6ae5('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x6ae5('0x4')]='';function setSequelize(_0x46c354){exports[a2_0x6ae5('0x4')]=_0x46c354;}exports[a2_0x6ae5('0x5')]=setSequelize;exports[a2_0x6ae5('0x6')]=(_0x53805c,_0x4c8430)=>{_0x4c8430[a2_0x6ae5('0x7')]('api/index',{'title':a2_0x6ae5('0x8')});};exports[a2_0x6ae5('0x9')]=(_0x24f912,_0x1bf88c)=>{console[a2_0x6ae5('0xa')](a2_0x6ae5('0xb'));const _0x42a86f=[];const _0x5686b7=new ftp_1[(a2_0x6ae5('0xc'))]();_0x5686b7['on'](a2_0x6ae5('0xd'),function(){console[a2_0x6ae5('0xa')](a2_0x6ae5('0xe'));_0x5686b7[a2_0x6ae5('0xf')](a2_0x6ae5('0x10'),![],function(_0x27d994,_0x5138b9){if(_0x27d994){}else{for(const _0x500e09 of _0x5138b9){console['log'](a2_0x6ae5('0x11')+_0x500e09['name']);if(_0x500e09['name']['endsWith'](a2_0x6ae5('0x12'))){exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')][a2_0x6ae5('0x14')][a2_0x6ae5('0x15')]({'where':{'fileName':_0x500e09[a2_0x6ae5('0x16')]}})[a2_0x6ae5('0x17')]((_0x2828f1,_0x2d6b55)=>{if(_0x2d6b55){console[a2_0x6ae5('0xa')](_0x500e09['name']);_0x42a86f['push'](_0x2828f1);}});}}}_0x1bf88c['json']({'data':_0x42a86f});});});_0x5686b7['on'](a2_0x6ae5('0x18'),function(_0x4ff3c3){_0x1bf88c[a2_0x6ae5('0x12')]({'message':_0x4ff3c3});});_0x5686b7[a2_0x6ae5('0x19')]({'host':a2_0x6ae5('0x1a'),'port':0x15,'user':'ipd','password':a2_0x6ae5('0x1b')});};exports[a2_0x6ae5('0x1c')]=(_0x1096fb,_0x3f1ca7)=>{exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')]['report_files'][a2_0x6ae5('0x1d')]({'where':{'status':null}})[a2_0x6ae5('0x1e')](_0x4ba298=>{if(_0x4ba298){const _0x5a0e22=new ftp_1[(a2_0x6ae5('0xc'))]();_0x5a0e22['on'](a2_0x6ae5('0xd'),function(){console[a2_0x6ae5('0xa')](a2_0x6ae5('0x1f')+_0x4ba298[a2_0x6ae5('0x20')]);_0x5a0e22[a2_0x6ae5('0x21')](a2_0x6ae5('0x22')+_0x4ba298[a2_0x6ae5('0x20')],function(_0x156ebf,_0x2a322d){_0x5a0e22[a2_0x6ae5('0x23')]();if(_0x156ebf){}else{const _0x190171='media/'+_0x4ba298['fileName']+a2_0x6ae5('0x24');_0x2a322d[a2_0x6ae5('0x25')](fs_1['default'][a2_0x6ae5('0x26')](_0x190171));_0x4ba298[a2_0x6ae5('0x27')]=0x1;_0x4ba298[a2_0x6ae5('0x28')]();console[a2_0x6ae5('0xa')](a2_0x6ae5('0x29')+_0x4ba298[a2_0x6ae5('0x20')]);}});});_0x5a0e22['on']('error',function(_0x19ae18){_0x3f1ca7[a2_0x6ae5('0x12')]({'message':_0x19ae18});});_0x5a0e22[a2_0x6ae5('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x6ae5('0x1b'),'password':a2_0x6ae5('0x1b')});_0x3f1ca7[a2_0x6ae5('0x12')]({'data':_0x4ba298[a2_0x6ae5('0x20')]});}else{_0x3f1ca7[a2_0x6ae5('0x12')]({'data':[]});}});};exports[a2_0x6ae5('0x2a')]=(_0x486cdb,_0x37ad71)=>{exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')][a2_0x6ae5('0x14')][a2_0x6ae5('0x1d')]({'where':{'status':0x1}})[a2_0x6ae5('0x1e')](_0x3faee9=>{if(_0x3faee9){const _0x5c5a7b=a2_0x6ae5('0x2b')+_0x3faee9[a2_0x6ae5('0x20')]+a2_0x6ae5('0x24');fs_1[a2_0x6ae5('0xc')]['readFile'](_0x5c5a7b,a2_0x6ae5('0x2c'),function(_0x47abd7,_0x2c582b){if(_0x47abd7){_0x3faee9[a2_0x6ae5('0x27')]=null;}else{try{const _0x12f552=JSON[a2_0x6ae5('0x2d')](_0x2c582b);for(const _0x56f8a4 of _0x12f552[a2_0x6ae5('0x2e')][0x0]['CountingInfo']){const _0x260e63=_0x56f8a4['In'];const _0x5ac5d5=_0x56f8a4[a2_0x6ae5('0x2f')];const _0x1661a3=Date[a2_0x6ae5('0x2d')](_0x56f8a4[a2_0x6ae5('0x30')]);if(_0x260e63>0x0){exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')]['pass_counting']['create']({'reportFileId':_0x3faee9['id'],'amount':_0x260e63,'countingDate':_0x1661a3});}if(_0x5ac5d5>0x0){exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')][a2_0x6ae5('0x31')][a2_0x6ae5('0x32')]({'reportFileId':_0x3faee9['id'],'amount':_0x5ac5d5*-0x1,'countingDate':_0x1661a3});}}_0x3faee9[a2_0x6ae5('0x27')]=0x2;}catch(_0x259137){_0x3faee9[a2_0x6ae5('0x27')]=null;}}_0x3faee9[a2_0x6ae5('0x28')]();});_0x37ad71[a2_0x6ae5('0x12')]({'data':_0x3faee9[a2_0x6ae5('0x20')]});}else{_0x37ad71[a2_0x6ae5('0x12')]({'data':[]});}});};exports[a2_0x6ae5('0x33')]=(_0xc2bd61,_0x49fa1f)=>{exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')]['pass_counting'][a2_0x6ae5('0x34')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x6ae5('0x35'),a2_0x6ae5('0x36')]]})[a2_0x6ae5('0x1e')](_0x108a80=>{_0x49fa1f[a2_0x6ae5('0x12')]({'data':_0x108a80});});};exports['getPassCountingByDay']=(_0x7e3f1e,_0x5e34aa)=>{const _0x1465a8=_0x7e3f1e[a2_0x6ae5('0x37')]['month'];const _0x75bc9f=_0x7e3f1e['query'][a2_0x6ae5('0x38')];const _0x494afd=_0x7e3f1e[a2_0x6ae5('0x37')][a2_0x6ae5('0x39')];exports[a2_0x6ae5('0x4')]['models']['pass_counting'][a2_0x6ae5('0x34')]({'attributes':[a2_0x6ae5('0x35'),[exports['sequelize']['fn'](a2_0x6ae5('0x3a'),exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')](a2_0x6ae5('0x3c'))),a2_0x6ae5('0x3d')]],'where':{'countingDate':{[exports[a2_0x6ae5('0x4')]['Op'][a2_0x6ae5('0x3e')]]:_0x75bc9f,[exports[a2_0x6ae5('0x4')]['Op']['lt']]:_0x494afd},'amount':_0x7e3f1e['params']['direction']=='in'?{[exports[a2_0x6ae5('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x6ae5('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3f')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x6ae5('0x35'),'ASC']]})[a2_0x6ae5('0x1e')](_0x32b764=>{_0x5e34aa[a2_0x6ae5('0x12')]({'data':_0x32b764});});};exports[a2_0x6ae5('0x40')]=(_0x4d319f,_0x4ef5a3)=>{const _0x213c23=_0x4d319f['query'][a2_0x6ae5('0x41')];const _0x5c624b=_0x4d319f['query'][a2_0x6ae5('0x38')];const _0x24feeb=_0x4d319f['query'][a2_0x6ae5('0x39')];exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x13')][a2_0x6ae5('0x31')][a2_0x6ae5('0x34')]({'attributes':['countingDate',[exports[a2_0x6ae5('0x4')]['fn']('DATE_FORMAT',exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')]('countingDate'),'%Y-%m-%d\x20%H:00'),a2_0x6ae5('0x42')],[exports['sequelize']['fn'](a2_0x6ae5('0x3a'),exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')](a2_0x6ae5('0x3c'))),'total']],'where':{'countingDate':{[exports[a2_0x6ae5('0x4')]['Op'][a2_0x6ae5('0x3e')]]:_0x5c624b,[exports['sequelize']['Op']['lt']]:_0x24feeb},'amount':_0x4d319f['params'][a2_0x6ae5('0x43')]=='in'?{[exports[a2_0x6ae5('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x6ae5('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x6ae5('0x44'),exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')](a2_0x6ae5('0x35'))),exports[a2_0x6ae5('0x4')]['fn'](a2_0x6ae5('0x45'),exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')](a2_0x6ae5('0x35'))),exports[a2_0x6ae5('0x4')]['fn'](a2_0x6ae5('0x46'),exports[a2_0x6ae5('0x4')]['col'](a2_0x6ae5('0x35'))),exports[a2_0x6ae5('0x4')]['fn'](a2_0x6ae5('0x47'),exports[a2_0x6ae5('0x4')][a2_0x6ae5('0x3b')](a2_0x6ae5('0x35')))],'order':[[a2_0x6ae5('0x35'),a2_0x6ae5('0x36')]]})[a2_0x6ae5('0x1e')](_0x2033aa=>{_0x4ef5a3['json']({'data':_0x2033aa});});};exports[a2_0x6ae5('0x48')]=(_0x2d5915,_0x42d299,_0x354778)=>{const _0x3cc3d0=_0x2d5915[a2_0x6ae5('0x49')][a2_0x6ae5('0x4a')][a2_0x6ae5('0x4b')](_0x3cc3d0=>_0x3cc3d0[a2_0x6ae5('0x4c')]===a2_0x6ae5('0x4d'));fbgraph_1[a2_0x6ae5('0xc')][a2_0x6ae5('0x4e')](_0x3cc3d0['accessToken']);fbgraph_1[a2_0x6ae5('0xc')][a2_0x6ae5('0x21')](_0x2d5915[a2_0x6ae5('0x49')][a2_0x6ae5('0x4d')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x415dc0,_0x34eb4d)=>{if(_0x415dc0){return _0x354778(_0x415dc0);}_0x42d299[a2_0x6ae5('0x7')](a2_0x6ae5('0x4f'),{'title':a2_0x6ae5('0x50'),'profile':_0x34eb4d});});};