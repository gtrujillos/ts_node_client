var a2_0x4c59=['Downloaded:\x20','readFile','utf8','status','Data','CountingInfo','parse','pass_counting','create','getPassCounting','countingDate','query','month','endDate','findAll','sum','amount','total','direction','ASC','col','%Y-%m-%d\x20%H:00','params','HOUR','DAY','MONTH','YEAR','getFacebook','user','find','kind','setAccessToken','accessToken','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','defineProperty','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','connecting','default','log','connected','colombia','Downloading:\x20','name','endsWith','models','spread','push','json','error','connect','ftp.vivotek.com','ipd','downloadFtp','report_files','findOne','then','connected:','fileName','get','colombia/','end','media/','.txt','pipe','save'];(function(_0x46c289,_0x35fd9c){var _0x378942=function(_0x3d064d){while(--_0x3d064d){_0x46c289['push'](_0x46c289['shift']());}};_0x378942(++_0x35fd9c);}(a2_0x4c59,0x14c));var a2_0x46ec=function(_0x2dcda2,_0x26da7d){_0x2dcda2=_0x2dcda2-0x0;var _0x37bc1b=a2_0x4c59[_0x2dcda2];return _0x37bc1b;};'use strict';var __importDefault=this&&this[a2_0x46ec('0x0')]||function(_0x8d8fbe){return _0x8d8fbe&&_0x8d8fbe['__esModule']?_0x8d8fbe:{'default':_0x8d8fbe};};Object[a2_0x46ec('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x46ec('0x2')]='';function setSequelize(_0x1faa9c){exports[a2_0x46ec('0x2')]=_0x1faa9c;}exports[a2_0x46ec('0x3')]=setSequelize;exports[a2_0x46ec('0x4')]=(_0x25c885,_0x173f4d)=>{_0x173f4d[a2_0x46ec('0x5')](a2_0x46ec('0x6'),{'title':a2_0x46ec('0x7')});};exports[a2_0x46ec('0x8')]=(_0x51c435,_0x266c42)=>{console['log'](a2_0x46ec('0x9'));const _0x38033d=[];const _0x4a9c59=new ftp_1[(a2_0x46ec('0xa'))]();_0x4a9c59['on']('ready',function(){console[a2_0x46ec('0xb')](a2_0x46ec('0xc'));_0x4a9c59['list'](a2_0x46ec('0xd'),![],function(_0x1ac6c0,_0x8b231f){if(_0x1ac6c0){}else{for(const _0x2cb51d of _0x8b231f){console[a2_0x46ec('0xb')](a2_0x46ec('0xe')+_0x2cb51d[a2_0x46ec('0xf')]);if(_0x2cb51d[a2_0x46ec('0xf')][a2_0x46ec('0x10')]('json')){exports['sequelize'][a2_0x46ec('0x11')]['report_files']['findOrCreate']({'where':{'fileName':_0x2cb51d[a2_0x46ec('0xf')]}})[a2_0x46ec('0x12')]((_0x863fa,_0x4203aa)=>{if(_0x4203aa){console['log'](_0x2cb51d['name']);_0x38033d[a2_0x46ec('0x13')](_0x863fa);}});}}}_0x266c42[a2_0x46ec('0x14')]({'data':_0x38033d});});});_0x4a9c59['on'](a2_0x46ec('0x15'),function(_0x3d2e17){_0x266c42[a2_0x46ec('0x14')]({'message':_0x3d2e17});});_0x4a9c59[a2_0x46ec('0x16')]({'host':a2_0x46ec('0x17'),'port':0x15,'user':a2_0x46ec('0x18'),'password':a2_0x46ec('0x18')});};exports[a2_0x46ec('0x19')]=(_0x5b0a88,_0x8a522e)=>{exports[a2_0x46ec('0x2')][a2_0x46ec('0x11')][a2_0x46ec('0x1a')][a2_0x46ec('0x1b')]({'where':{'status':null}})[a2_0x46ec('0x1c')](_0x164016=>{if(_0x164016){const _0x2d4ebb=new ftp_1[(a2_0x46ec('0xa'))]();_0x2d4ebb['on']('ready',function(){console['log'](a2_0x46ec('0x1d')+_0x164016[a2_0x46ec('0x1e')]);_0x2d4ebb[a2_0x46ec('0x1f')](a2_0x46ec('0x20')+_0x164016[a2_0x46ec('0x1e')],function(_0x2cfe2b,_0x15a015){_0x2d4ebb[a2_0x46ec('0x21')]();if(_0x2cfe2b){}else{const _0x364c80=a2_0x46ec('0x22')+_0x164016[a2_0x46ec('0x1e')]+a2_0x46ec('0x23');_0x15a015[a2_0x46ec('0x24')](fs_1['default']['createWriteStream'](_0x364c80));_0x164016['status']=0x1;_0x164016[a2_0x46ec('0x25')]();console[a2_0x46ec('0xb')](a2_0x46ec('0x26')+_0x164016[a2_0x46ec('0x1e')]);}});});_0x2d4ebb['on'](a2_0x46ec('0x15'),function(_0x5009e1){_0x8a522e['json']({'message':_0x5009e1});});_0x2d4ebb[a2_0x46ec('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x46ec('0x18'),'password':a2_0x46ec('0x18')});_0x8a522e[a2_0x46ec('0x14')]({'data':_0x164016[a2_0x46ec('0x1e')]});}else{_0x8a522e[a2_0x46ec('0x14')]({'data':[]});}});};exports['processFtp']=(_0x398e7a,_0x4b9f6a)=>{exports['sequelize']['models'][a2_0x46ec('0x1a')]['findOne']({'where':{'status':0x1}})[a2_0x46ec('0x1c')](_0x4f203d=>{if(_0x4f203d){const _0x24a77e='media/'+_0x4f203d['fileName']+a2_0x46ec('0x23');fs_1[a2_0x46ec('0xa')][a2_0x46ec('0x27')](_0x24a77e,a2_0x46ec('0x28'),function(_0x6415f6,_0xf97d78){if(_0x6415f6){_0x4f203d[a2_0x46ec('0x29')]=null;}else{try{const _0x2a2ca9=JSON['parse'](_0xf97d78);for(const _0x437893 of _0x2a2ca9[a2_0x46ec('0x2a')][0x0][a2_0x46ec('0x2b')]){const _0x56206b=_0x437893['In'];const _0x4057f9=_0x437893['Out'];const _0x4572e=Date[a2_0x46ec('0x2c')](_0x437893['EndTime']);if(_0x56206b>0x0){exports['sequelize'][a2_0x46ec('0x11')][a2_0x46ec('0x2d')][a2_0x46ec('0x2e')]({'reportFileId':_0x4f203d['id'],'amount':_0x56206b,'countingDate':_0x4572e});}if(_0x4057f9>0x0){exports[a2_0x46ec('0x2')][a2_0x46ec('0x11')][a2_0x46ec('0x2d')][a2_0x46ec('0x2e')]({'reportFileId':_0x4f203d['id'],'amount':_0x4057f9*-0x1,'countingDate':_0x4572e});}}_0x4f203d[a2_0x46ec('0x29')]=0x2;}catch(_0x4ffddc){_0x4f203d[a2_0x46ec('0x29')]=null;}}_0x4f203d[a2_0x46ec('0x25')]();});_0x4b9f6a[a2_0x46ec('0x14')]({'data':_0x4f203d[a2_0x46ec('0x1e')]});}else{_0x4b9f6a[a2_0x46ec('0x14')]({'data':[]});}});};exports[a2_0x46ec('0x2f')]=(_0x1920c8,_0x16942c)=>{exports[a2_0x46ec('0x2')]['models'][a2_0x46ec('0x2d')]['findAll']({'where':{'amount':{[exports[a2_0x46ec('0x2')]['Op']['gt']]:0x0}},'order':[[a2_0x46ec('0x30'),'ASC']]})[a2_0x46ec('0x1c')](_0x154f8b=>{_0x16942c[a2_0x46ec('0x14')]({'data':_0x154f8b});});};exports['getPassCountingByDay']=(_0x4b82bb,_0x17ec92)=>{const _0x10a90d=_0x4b82bb[a2_0x46ec('0x31')][a2_0x46ec('0x32')];const _0x143101=_0x4b82bb[a2_0x46ec('0x31')]['startDate'];const _0x2a85d1=_0x4b82bb[a2_0x46ec('0x31')][a2_0x46ec('0x33')];exports['sequelize'][a2_0x46ec('0x11')]['pass_counting'][a2_0x46ec('0x34')]({'attributes':[a2_0x46ec('0x30'),[exports[a2_0x46ec('0x2')]['fn'](a2_0x46ec('0x35'),exports[a2_0x46ec('0x2')]['col'](a2_0x46ec('0x36'))),a2_0x46ec('0x37')]],'where':{'countingDate':{[exports['sequelize']['Op']['gte']]:_0x143101,[exports['sequelize']['Op']['lt']]:_0x2a85d1},'amount':_0x4b82bb['params'][a2_0x46ec('0x38')]=='in'?{[exports[a2_0x46ec('0x2')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x46ec('0x2')]['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate',a2_0x46ec('0x39')]]})['then'](_0x502ece=>{_0x17ec92[a2_0x46ec('0x14')]({'data':_0x502ece});});};exports['getPassCountingByHour']=(_0x422088,_0x360af9)=>{const _0x49f204=_0x422088[a2_0x46ec('0x31')][a2_0x46ec('0x32')];const _0x509a04=_0x422088[a2_0x46ec('0x31')]['startDate'];const _0x547be0=_0x422088['query']['endDate'];exports[a2_0x46ec('0x2')][a2_0x46ec('0x11')][a2_0x46ec('0x2d')]['findAll']({'attributes':[a2_0x46ec('0x30'),[exports[a2_0x46ec('0x2')]['fn']('DATE_FORMAT',exports['sequelize'][a2_0x46ec('0x3a')](a2_0x46ec('0x30')),a2_0x46ec('0x3b')),'countingDateShort'],[exports[a2_0x46ec('0x2')]['fn'](a2_0x46ec('0x35'),exports[a2_0x46ec('0x2')][a2_0x46ec('0x3a')](a2_0x46ec('0x36'))),a2_0x46ec('0x37')]],'where':{'countingDate':{[exports[a2_0x46ec('0x2')]['Op']['gte']]:_0x509a04,[exports[a2_0x46ec('0x2')]['Op']['lt']]:_0x547be0},'amount':_0x422088[a2_0x46ec('0x3c')][a2_0x46ec('0x38')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x46ec('0x2')]['Op']['lt']]:0x0}},'group':[exports[a2_0x46ec('0x2')]['fn'](a2_0x46ec('0x3d'),exports[a2_0x46ec('0x2')][a2_0x46ec('0x3a')](a2_0x46ec('0x30'))),exports['sequelize']['fn'](a2_0x46ec('0x3e'),exports[a2_0x46ec('0x2')][a2_0x46ec('0x3a')]('countingDate')),exports[a2_0x46ec('0x2')]['fn'](a2_0x46ec('0x3f'),exports[a2_0x46ec('0x2')][a2_0x46ec('0x3a')](a2_0x46ec('0x30'))),exports[a2_0x46ec('0x2')]['fn'](a2_0x46ec('0x40'),exports[a2_0x46ec('0x2')][a2_0x46ec('0x3a')](a2_0x46ec('0x30')))],'order':[['countingDate',a2_0x46ec('0x39')]]})[a2_0x46ec('0x1c')](_0x38520c=>{_0x360af9[a2_0x46ec('0x14')]({'data':_0x38520c});});};exports[a2_0x46ec('0x41')]=(_0x52dac7,_0x4dae60,_0x29bd06)=>{const _0x51f034=_0x52dac7[a2_0x46ec('0x42')]['tokens'][a2_0x46ec('0x43')](_0x51f034=>_0x51f034[a2_0x46ec('0x44')]==='facebook');fbgraph_1[a2_0x46ec('0xa')][a2_0x46ec('0x45')](_0x51f034[a2_0x46ec('0x46')]);fbgraph_1['default'][a2_0x46ec('0x1f')](_0x52dac7['user'][a2_0x46ec('0x47')]+a2_0x46ec('0x48'),(_0x5ce90c,_0x15a96a)=>{if(_0x5ce90c){return _0x29bd06(_0x5ce90c);}_0x4dae60[a2_0x46ec('0x5')]('api/facebook',{'title':a2_0x46ec('0x49'),'profile':_0x15a96a});});};