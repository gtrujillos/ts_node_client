var a2_0x41f8=['CountingInfo','Out','pass_counting','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','col','params','direction','getPassCountingByHour','DATE_FORMAT','countingDateShort','HOUR','MONTH','YEAR','getFacebook','user','tokens','kind','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','api/index','syncFtp','log','connecting','default','ready','connected','colombia','Downloading:\x20','name','endsWith','json','models','report_files','spread','push','connect','ftp.vivotek.com','ipd','downloadFtp','then','connected:','fileName','get','end','media/','.txt','pipe','status','save','Downloaded:\x20','error','readFile','utf8','parse','Data'];(function(_0x326b86,_0x5c7ca7){var _0xf07ccc=function(_0x19e8d9){while(--_0x19e8d9){_0x326b86['push'](_0x326b86['shift']());}};_0xf07ccc(++_0x5c7ca7);}(a2_0x41f8,0xfe));var a2_0x108b=function(_0x1369dc,_0x2d53d4){_0x1369dc=_0x1369dc-0x0;var _0x1a59a5=a2_0x41f8[_0x1369dc];return _0x1a59a5;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x39e601){return _0x39e601&&_0x39e601[a2_0x108b('0x0')]?_0x39e601:{'default':_0x39e601};};Object[a2_0x108b('0x1')](exports,a2_0x108b('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x108b('0x2')));const ftp_1=__importDefault(require(a2_0x108b('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x108b('0x4')]='';function setSequelize(_0xc1c7ad){exports[a2_0x108b('0x4')]=_0xc1c7ad;}exports['setSequelize']=setSequelize;exports[a2_0x108b('0x5')]=(_0x46cd3e,_0x49c5dd)=>{_0x49c5dd['render'](a2_0x108b('0x6'),{'title':'API\x20Examples'});};exports[a2_0x108b('0x7')]=(_0x5b2577,_0xfed10f)=>{console[a2_0x108b('0x8')](a2_0x108b('0x9'));const _0x194e54=[];const _0xeb6c4d=new ftp_1[(a2_0x108b('0xa'))]();_0xeb6c4d['on'](a2_0x108b('0xb'),function(){console[a2_0x108b('0x8')](a2_0x108b('0xc'));_0xeb6c4d['list'](a2_0x108b('0xd'),![],function(_0xb0638e,_0xde3f78){if(_0xb0638e){}else{for(const _0x3959b4 of _0xde3f78){console['log'](a2_0x108b('0xe')+_0x3959b4[a2_0x108b('0xf')]);if(_0x3959b4[a2_0x108b('0xf')][a2_0x108b('0x10')](a2_0x108b('0x11'))){exports[a2_0x108b('0x4')][a2_0x108b('0x12')][a2_0x108b('0x13')]['findOrCreate']({'where':{'fileName':_0x3959b4[a2_0x108b('0xf')]}})[a2_0x108b('0x14')]((_0x398720,_0x2f65a1)=>{if(_0x2f65a1){console[a2_0x108b('0x8')](_0x3959b4[a2_0x108b('0xf')]);_0x194e54[a2_0x108b('0x15')](_0x398720);}});}}}_0xfed10f[a2_0x108b('0x11')]({'data':_0x194e54});});});_0xeb6c4d['on']('error',function(_0x555447){_0xfed10f['json']({'message':_0x555447});});_0xeb6c4d[a2_0x108b('0x16')]({'host':a2_0x108b('0x17'),'port':0x15,'user':a2_0x108b('0x18'),'password':a2_0x108b('0x18')});};exports[a2_0x108b('0x19')]=(_0xbe85e6,_0x452323)=>{exports[a2_0x108b('0x4')]['models'][a2_0x108b('0x13')]['findOne']({'where':{'status':null}})[a2_0x108b('0x1a')](_0x5e8ae2=>{if(_0x5e8ae2){const _0x25292d=new ftp_1['default']();_0x25292d['on']('ready',function(){console[a2_0x108b('0x8')](a2_0x108b('0x1b')+_0x5e8ae2[a2_0x108b('0x1c')]);_0x25292d[a2_0x108b('0x1d')]('colombia/'+_0x5e8ae2[a2_0x108b('0x1c')],function(_0x5a799b,_0x16ade3){_0x25292d[a2_0x108b('0x1e')]();if(_0x5a799b){}else{const _0x345113=a2_0x108b('0x1f')+_0x5e8ae2[a2_0x108b('0x1c')]+a2_0x108b('0x20');_0x16ade3[a2_0x108b('0x21')](fs_1[a2_0x108b('0xa')]['createWriteStream'](_0x345113));_0x5e8ae2[a2_0x108b('0x22')]=0x1;_0x5e8ae2[a2_0x108b('0x23')]();console[a2_0x108b('0x8')](a2_0x108b('0x24')+_0x5e8ae2[a2_0x108b('0x1c')]);}});});_0x25292d['on'](a2_0x108b('0x25'),function(_0x59936d){_0x452323[a2_0x108b('0x11')]({'message':_0x59936d});});_0x25292d[a2_0x108b('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x108b('0x18'),'password':a2_0x108b('0x18')});_0x452323[a2_0x108b('0x11')]({'data':_0x5e8ae2[a2_0x108b('0x1c')]});}else{_0x452323[a2_0x108b('0x11')]({'data':[]});}});};exports['processFtp']=(_0x73cc4f,_0x2d944c)=>{exports[a2_0x108b('0x4')][a2_0x108b('0x12')][a2_0x108b('0x13')]['findOne']({'where':{'status':0x1}})[a2_0x108b('0x1a')](_0x141db0=>{if(_0x141db0){const _0x49f9ab='media/'+_0x141db0[a2_0x108b('0x1c')]+a2_0x108b('0x20');fs_1[a2_0x108b('0xa')][a2_0x108b('0x26')](_0x49f9ab,a2_0x108b('0x27'),function(_0x16a5d8,_0xda963b){if(_0x16a5d8){_0x141db0[a2_0x108b('0x22')]=null;}else{try{const _0x51fad6=JSON[a2_0x108b('0x28')](_0xda963b);for(const _0x31c08d of _0x51fad6[a2_0x108b('0x29')][0x0][a2_0x108b('0x2a')]){const _0x13ba31=_0x31c08d['In'];const _0xa06cb6=_0x31c08d[a2_0x108b('0x2b')];const _0x30d592=Date[a2_0x108b('0x28')](_0x31c08d['EndTime']);if(_0x13ba31>0x0){exports['sequelize']['models'][a2_0x108b('0x2c')][a2_0x108b('0x2d')]({'reportFileId':_0x141db0['id'],'amount':_0x13ba31,'countingDate':_0x30d592});}if(_0xa06cb6>0x0){exports[a2_0x108b('0x4')][a2_0x108b('0x12')]['pass_counting']['create']({'reportFileId':_0x141db0['id'],'amount':_0xa06cb6*-0x1,'countingDate':_0x30d592});}}_0x141db0['status']=0x2;}catch(_0x487b08){_0x141db0[a2_0x108b('0x22')]=null;}}_0x141db0[a2_0x108b('0x23')]();});_0x2d944c[a2_0x108b('0x11')]({'data':_0x141db0[a2_0x108b('0x1c')]});}else{_0x2d944c[a2_0x108b('0x11')]({'data':[]});}});};exports[a2_0x108b('0x2e')]=(_0x23a26b,_0x1cee38)=>{exports[a2_0x108b('0x4')][a2_0x108b('0x12')][a2_0x108b('0x2c')][a2_0x108b('0x2f')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x108b('0x30'),a2_0x108b('0x31')]]})[a2_0x108b('0x1a')](_0x5558d4=>{_0x1cee38[a2_0x108b('0x11')]({'data':_0x5558d4});});};exports[a2_0x108b('0x32')]=(_0x2d1876,_0x4598e4)=>{const _0x110a4c=_0x2d1876[a2_0x108b('0x33')][a2_0x108b('0x34')];const _0x3c55b7=_0x2d1876[a2_0x108b('0x33')][a2_0x108b('0x35')];const _0x33221a=_0x2d1876['query'][a2_0x108b('0x36')];exports[a2_0x108b('0x4')][a2_0x108b('0x12')][a2_0x108b('0x2c')][a2_0x108b('0x2f')]({'attributes':[a2_0x108b('0x30'),[exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x37'),exports['sequelize'][a2_0x108b('0x38')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x108b('0x4')]['Op']['gte']]:_0x3c55b7,[exports['sequelize']['Op']['lt']]:_0x33221a},'amount':_0x2d1876[a2_0x108b('0x39')][a2_0x108b('0x3a')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x108b('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x108b('0x30'),a2_0x108b('0x31')]]})[a2_0x108b('0x1a')](_0xf3d24e=>{_0x4598e4['json']({'data':_0xf3d24e});});};exports[a2_0x108b('0x3b')]=(_0x3f2522,_0xe03df3)=>{const _0x14a429=_0x3f2522[a2_0x108b('0x33')][a2_0x108b('0x34')];const _0x1ee5b7=_0x3f2522[a2_0x108b('0x33')][a2_0x108b('0x35')];const _0x5cd686=_0x3f2522[a2_0x108b('0x33')][a2_0x108b('0x36')];exports[a2_0x108b('0x4')][a2_0x108b('0x12')]['pass_counting'][a2_0x108b('0x2f')]({'attributes':[a2_0x108b('0x30'),[exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x3c'),exports[a2_0x108b('0x4')][a2_0x108b('0x38')]('countingDate'),'%Y-%m-%d\x20%H:00'),a2_0x108b('0x3d')],[exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x37'),exports[a2_0x108b('0x4')][a2_0x108b('0x38')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x108b('0x4')]['Op']['gte']]:_0x1ee5b7,[exports[a2_0x108b('0x4')]['Op']['lt']]:_0x5cd686},'amount':_0x3f2522[a2_0x108b('0x39')][a2_0x108b('0x3a')]=='in'?{[exports[a2_0x108b('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x3e'),exports[a2_0x108b('0x4')][a2_0x108b('0x38')]('countingDate')),exports[a2_0x108b('0x4')]['fn']('DAY',exports[a2_0x108b('0x4')][a2_0x108b('0x38')](a2_0x108b('0x30'))),exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x3f'),exports[a2_0x108b('0x4')][a2_0x108b('0x38')]('countingDate')),exports[a2_0x108b('0x4')]['fn'](a2_0x108b('0x40'),exports[a2_0x108b('0x4')][a2_0x108b('0x38')]('countingDate'))],'order':[[a2_0x108b('0x30'),'ASC']]})[a2_0x108b('0x1a')](_0x3825f9=>{_0xe03df3[a2_0x108b('0x11')]({'data':_0x3825f9});});};exports[a2_0x108b('0x41')]=(_0x53543d,_0x385ff3,_0x25736c)=>{const _0x2234bd=_0x53543d[a2_0x108b('0x42')][a2_0x108b('0x43')]['find'](_0x2234bd=>_0x2234bd[a2_0x108b('0x44')]===a2_0x108b('0x45'));fbgraph_1['default']['setAccessToken'](_0x2234bd[a2_0x108b('0x46')]);fbgraph_1[a2_0x108b('0xa')][a2_0x108b('0x1d')](_0x53543d[a2_0x108b('0x42')]['facebook']+a2_0x108b('0x47'),(_0x35d248,_0x1360b5)=>{if(_0x35d248){return _0x25736c(_0x35d248);}_0x385ff3[a2_0x108b('0x48')]('api/facebook',{'title':a2_0x108b('0x49'),'profile':_0x1360b5});});};