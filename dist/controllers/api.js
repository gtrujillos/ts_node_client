var a2_0x43e4=['spread','error','json','connect','ftp.vivotek.com','ipd','downloadFtp','then','ready','get','end','media/','.txt','status','Downloaded:\x20','fileName','processFtp','findOne','readFile','utf8','parse','Data','CountingInfo','EndTime','pass_counting','create','save','getPassCounting','findAll','countingDate','ASC','query','month','startDate','endDate','col','amount','total','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','countingDateShort','direction','HOUR','DAY','MONTH','tokens','find','facebook','setAccessToken','accessToken','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','log','connecting','default','connected','list','Downloading:\x20','name','endsWith','models','report_files'];(function(_0x178e77,_0x2056f0){var _0x32e9d2=function(_0x197262){while(--_0x197262){_0x178e77['push'](_0x178e77['shift']());}};_0x32e9d2(++_0x2056f0);}(a2_0x43e4,0xcb));var a2_0xa41a=function(_0x260db5,_0x32e18d){_0x260db5=_0x260db5-0x0;var _0x1f3287=a2_0x43e4[_0x260db5];return _0x1f3287;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x18a922){return _0x18a922&&_0x18a922[a2_0xa41a('0x0')]?_0x18a922:{'default':_0x18a922};};Object[a2_0xa41a('0x1')](exports,a2_0xa41a('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0xa41a('0x2')));const ftp_1=__importDefault(require(a2_0xa41a('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0xa41a('0x4')]='';function setSequelize(_0x439b7d){exports[a2_0xa41a('0x4')]=_0x439b7d;}exports['setSequelize']=setSequelize;exports[a2_0xa41a('0x5')]=(_0x1980cf,_0x5dd79c)=>{_0x5dd79c[a2_0xa41a('0x6')](a2_0xa41a('0x7'),{'title':a2_0xa41a('0x8')});};exports['syncFtp']=(_0x972e88,_0x59e264)=>{console[a2_0xa41a('0x9')](a2_0xa41a('0xa'));const _0x2fb6d9=[];const _0x49631e=new ftp_1[(a2_0xa41a('0xb'))]();_0x49631e['on']('ready',function(){console['log'](a2_0xa41a('0xc'));_0x49631e[a2_0xa41a('0xd')]('colombia',![],function(_0x42d01c,_0x507deb){if(_0x42d01c){}else{for(const _0x14a78d of _0x507deb){console[a2_0xa41a('0x9')](a2_0xa41a('0xe')+_0x14a78d[a2_0xa41a('0xf')]);if(_0x14a78d[a2_0xa41a('0xf')][a2_0xa41a('0x10')]('json')){exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x12')]['findOrCreate']({'where':{'fileName':_0x14a78d[a2_0xa41a('0xf')]}})[a2_0xa41a('0x13')]((_0x16d6a5,_0x49fb73)=>{if(_0x49fb73){console['log'](_0x14a78d['name']);_0x2fb6d9['push'](_0x16d6a5);}});}}}_0x59e264['json']({'data':_0x2fb6d9});});});_0x49631e['on'](a2_0xa41a('0x14'),function(_0x370a4e){_0x59e264[a2_0xa41a('0x15')]({'message':_0x370a4e});});_0x49631e[a2_0xa41a('0x16')]({'host':a2_0xa41a('0x17'),'port':0x15,'user':'ipd','password':a2_0xa41a('0x18')});};exports[a2_0xa41a('0x19')]=(_0x2f1107,_0x22b765)=>{exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x12')]['findOne']({'where':{'status':null}})[a2_0xa41a('0x1a')](_0x112bb9=>{if(_0x112bb9){const _0x447ed3=new ftp_1[(a2_0xa41a('0xb'))]();_0x447ed3['on'](a2_0xa41a('0x1b'),function(){console[a2_0xa41a('0x9')]('connected:'+_0x112bb9['fileName']);_0x447ed3[a2_0xa41a('0x1c')]('colombia/'+_0x112bb9['fileName'],function(_0x33a4c3,_0x443301){_0x447ed3[a2_0xa41a('0x1d')]();if(_0x33a4c3){}else{const _0x21ff03=a2_0xa41a('0x1e')+_0x112bb9['fileName']+a2_0xa41a('0x1f');_0x443301['pipe'](fs_1['default']['createWriteStream'](_0x21ff03));_0x112bb9[a2_0xa41a('0x20')]=0x1;_0x112bb9['save']();console[a2_0xa41a('0x9')](a2_0xa41a('0x21')+_0x112bb9[a2_0xa41a('0x22')]);}});});_0x447ed3['on'](a2_0xa41a('0x14'),function(_0x94b3cf){_0x22b765[a2_0xa41a('0x15')]({'message':_0x94b3cf});});_0x447ed3[a2_0xa41a('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0xa41a('0x18'),'password':a2_0xa41a('0x18')});_0x22b765[a2_0xa41a('0x15')]({'data':_0x112bb9[a2_0xa41a('0x22')]});}else{_0x22b765['json']({'data':[]});}});};exports[a2_0xa41a('0x23')]=(_0x123d58,_0x4ec9bc)=>{exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x12')][a2_0xa41a('0x24')]({'where':{'status':0x1}})['then'](_0x3438ac=>{if(_0x3438ac){const _0x2b7464=a2_0xa41a('0x1e')+_0x3438ac[a2_0xa41a('0x22')]+a2_0xa41a('0x1f');fs_1[a2_0xa41a('0xb')][a2_0xa41a('0x25')](_0x2b7464,a2_0xa41a('0x26'),function(_0x2afd61,_0x48c97e){if(_0x2afd61){_0x3438ac[a2_0xa41a('0x20')]=null;}else{try{const _0x5ee150=JSON[a2_0xa41a('0x27')](_0x48c97e);for(const _0x1ebc01 of _0x5ee150[a2_0xa41a('0x28')][0x0][a2_0xa41a('0x29')]){const _0x4c6736=_0x1ebc01['In'];const _0x297180=_0x1ebc01['Out'];const _0x4098ec=Date['parse'](_0x1ebc01[a2_0xa41a('0x2a')]);if(_0x4c6736>0x0){exports['sequelize']['models'][a2_0xa41a('0x2b')][a2_0xa41a('0x2c')]({'reportFileId':_0x3438ac['id'],'amount':_0x4c6736,'countingDate':_0x4098ec});}if(_0x297180>0x0){exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x2b')][a2_0xa41a('0x2c')]({'reportFileId':_0x3438ac['id'],'amount':_0x297180*-0x1,'countingDate':_0x4098ec});}}_0x3438ac[a2_0xa41a('0x20')]=0x2;}catch(_0x2a67fb){_0x3438ac['status']=null;}}_0x3438ac[a2_0xa41a('0x2d')]();});_0x4ec9bc[a2_0xa41a('0x15')]({'data':_0x3438ac[a2_0xa41a('0x22')]});}else{_0x4ec9bc[a2_0xa41a('0x15')]({'data':[]});}});};exports[a2_0xa41a('0x2e')]=(_0x77c942,_0x9703eb)=>{exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x2b')][a2_0xa41a('0x2f')]({'where':{'amount':{[exports[a2_0xa41a('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0xa41a('0x30'),a2_0xa41a('0x31')]]})[a2_0xa41a('0x1a')](_0x2e2769=>{_0x9703eb[a2_0xa41a('0x15')]({'data':_0x2e2769});});};exports['getPassCountingByDay']=(_0x559f0a,_0xa99b29)=>{const _0x33df49=_0x559f0a[a2_0xa41a('0x32')][a2_0xa41a('0x33')];const _0x4f746f=_0x559f0a[a2_0xa41a('0x32')][a2_0xa41a('0x34')];const _0x42c851=_0x559f0a['query'][a2_0xa41a('0x35')];exports['sequelize'][a2_0xa41a('0x11')][a2_0xa41a('0x2b')][a2_0xa41a('0x2f')]({'attributes':[a2_0xa41a('0x30'),[exports['sequelize']['fn']('sum',exports[a2_0xa41a('0x4')][a2_0xa41a('0x36')](a2_0xa41a('0x37'))),a2_0xa41a('0x38')]],'where':{'countingDate':{[exports[a2_0xa41a('0x4')]['Op']['gte']]:_0x4f746f,[exports[a2_0xa41a('0x4')]['Op']['lt']]:_0x42c851},'amount':_0x559f0a[a2_0xa41a('0x39')]['direction']=='in'?{[exports[a2_0xa41a('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0xa41a('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0xa41a('0x3a')](a2_0xa41a('0x3b'))],'order':[[a2_0xa41a('0x30'),a2_0xa41a('0x31')]]})[a2_0xa41a('0x1a')](_0x1cd27a=>{_0xa99b29[a2_0xa41a('0x15')]({'data':_0x1cd27a});});};exports['getPassCountingByHour']=(_0x36fc07,_0x22fc91)=>{const _0x206350=_0x36fc07['query'][a2_0xa41a('0x33')];const _0x2701b7=_0x36fc07['query'][a2_0xa41a('0x34')];const _0x1475f3=_0x36fc07['query'][a2_0xa41a('0x35')];exports[a2_0xa41a('0x4')][a2_0xa41a('0x11')][a2_0xa41a('0x2b')][a2_0xa41a('0x2f')]({'attributes':[a2_0xa41a('0x30'),[exports[a2_0xa41a('0x4')]['fn']('DATE_FORMAT',exports[a2_0xa41a('0x4')][a2_0xa41a('0x36')](a2_0xa41a('0x30')),'%Y-%m-%d\x20%H:00'),a2_0xa41a('0x3c')],[exports[a2_0xa41a('0x4')]['fn']('sum',exports['sequelize']['col'](a2_0xa41a('0x37'))),a2_0xa41a('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op']['gte']]:_0x2701b7,[exports[a2_0xa41a('0x4')]['Op']['lt']]:_0x1475f3},'amount':_0x36fc07[a2_0xa41a('0x39')][a2_0xa41a('0x3d')]=='in'?{[exports[a2_0xa41a('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0xa41a('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0xa41a('0x4')]['fn'](a2_0xa41a('0x3e'),exports[a2_0xa41a('0x4')][a2_0xa41a('0x36')](a2_0xa41a('0x30'))),exports[a2_0xa41a('0x4')]['fn'](a2_0xa41a('0x3f'),exports[a2_0xa41a('0x4')][a2_0xa41a('0x36')](a2_0xa41a('0x30'))),exports[a2_0xa41a('0x4')]['fn'](a2_0xa41a('0x40'),exports[a2_0xa41a('0x4')]['col'](a2_0xa41a('0x30'))),exports[a2_0xa41a('0x4')]['fn']('YEAR',exports['sequelize'][a2_0xa41a('0x36')](a2_0xa41a('0x30')))],'order':[[a2_0xa41a('0x30'),a2_0xa41a('0x31')]]})[a2_0xa41a('0x1a')](_0x3d819a=>{_0x22fc91[a2_0xa41a('0x15')]({'data':_0x3d819a});});};exports['getFacebook']=(_0x3e428e,_0x57a2b8,_0x3f7585)=>{const _0x2f3a9d=_0x3e428e['user'][a2_0xa41a('0x41')][a2_0xa41a('0x42')](_0x2f3a9d=>_0x2f3a9d['kind']===a2_0xa41a('0x43'));fbgraph_1['default'][a2_0xa41a('0x44')](_0x2f3a9d[a2_0xa41a('0x45')]);fbgraph_1[a2_0xa41a('0xb')]['get'](_0x3e428e[a2_0xa41a('0x46')][a2_0xa41a('0x43')]+a2_0xa41a('0x47'),(_0x59fe7d,_0x312970)=>{if(_0x59fe7d){return _0x3f7585(_0x59fe7d);}_0x57a2b8[a2_0xa41a('0x6')](a2_0xa41a('0x48'),{'title':a2_0xa41a('0x49'),'profile':_0x312970});});};