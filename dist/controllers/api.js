var a2_0x57ea=['direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','month','%Y-%m-%d\x20%H:00','countingDateShort','HOUR','DAY','MONTH','getFacebook','tokens','find','kind','facebook','setAccessToken','accessToken','user','render','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','list','colombia','Downloading:\x20','endsWith','json','findOrCreate','name','push','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','end','.txt','pipe','status','Downloaded:\x20','error','connect','report_files','media/','parse','models','pass_counting','create','save','getPassCounting','findAll','countingDate','ASC','query','startDate','endDate','sum','col','amount','total','gte','params'];(function(_0xf1ca04,_0x4f2c10){var _0x5f3ad9=function(_0x5220f7){while(--_0x5220f7){_0xf1ca04['push'](_0xf1ca04['shift']());}};_0x5f3ad9(++_0x4f2c10);}(a2_0x57ea,0xb5));var a2_0x200f=function(_0x4bb38f,_0x196aaf){_0x4bb38f=_0x4bb38f-0x0;var _0xdd5516=a2_0x57ea[_0x4bb38f];return _0xdd5516;};'use strict';var __importDefault=this&&this[a2_0x200f('0x0')]||function(_0x1026ea){return _0x1026ea&&_0x1026ea[a2_0x200f('0x1')]?_0x1026ea:{'default':_0x1026ea};};Object[a2_0x200f('0x2')](exports,a2_0x200f('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x200f('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x200f('0x4')]='';function setSequelize(_0x2c5678){exports[a2_0x200f('0x4')]=_0x2c5678;}exports[a2_0x200f('0x5')]=setSequelize;exports[a2_0x200f('0x6')]=(_0x146255,_0x1e929b)=>{_0x1e929b['render'](a2_0x200f('0x7'),{'title':a2_0x200f('0x8')});};exports[a2_0x200f('0x9')]=(_0x4d3300,_0x33e4d8)=>{console['log'](a2_0x200f('0xa'));const _0x45ecf8=[];const _0x3501fc=new ftp_1[(a2_0x200f('0xb'))]();_0x3501fc['on'](a2_0x200f('0xc'),function(){console[a2_0x200f('0xd')](a2_0x200f('0xe'));_0x3501fc[a2_0x200f('0xf')](a2_0x200f('0x10'),![],function(_0x4e2d54,_0x46129b){if(_0x4e2d54){}else{for(const _0x2d4cd8 of _0x46129b){console[a2_0x200f('0xd')](a2_0x200f('0x11')+_0x2d4cd8['name']);if(_0x2d4cd8['name'][a2_0x200f('0x12')](a2_0x200f('0x13'))){exports[a2_0x200f('0x4')]['models']['report_files'][a2_0x200f('0x14')]({'where':{'fileName':_0x2d4cd8[a2_0x200f('0x15')]}})['spread']((_0xa6e1ad,_0xaf12c1)=>{if(_0xaf12c1){console[a2_0x200f('0xd')](_0x2d4cd8['name']);_0x45ecf8[a2_0x200f('0x16')](_0xa6e1ad);}});}}}_0x33e4d8[a2_0x200f('0x13')]({'data':_0x45ecf8});});});_0x3501fc['on']('error',function(_0x3cf549){_0x33e4d8['json']({'message':_0x3cf549});});_0x3501fc['connect']({'host':a2_0x200f('0x17'),'port':0x15,'user':'ipd','password':a2_0x200f('0x18')});};exports[a2_0x200f('0x19')]=(_0x15e710,_0x2e3e51)=>{exports[a2_0x200f('0x4')]['models']['report_files'][a2_0x200f('0x1a')]({'where':{'status':null}})[a2_0x200f('0x1b')](_0x2e9463=>{if(_0x2e9463){const _0x760b5b=new ftp_1[(a2_0x200f('0xb'))]();_0x760b5b['on'](a2_0x200f('0xc'),function(){console[a2_0x200f('0xd')](a2_0x200f('0x1c')+_0x2e9463[a2_0x200f('0x1d')]);_0x760b5b[a2_0x200f('0x1e')](a2_0x200f('0x1f')+_0x2e9463[a2_0x200f('0x1d')],function(_0xd1b482,_0x19c523){_0x760b5b[a2_0x200f('0x20')]();if(_0xd1b482){}else{const _0x2ead48='media/'+_0x2e9463['fileName']+a2_0x200f('0x21');_0x19c523[a2_0x200f('0x22')](fs_1[a2_0x200f('0xb')]['createWriteStream'](_0x2ead48));_0x2e9463[a2_0x200f('0x23')]=0x1;_0x2e9463['save']();console[a2_0x200f('0xd')](a2_0x200f('0x24')+_0x2e9463[a2_0x200f('0x1d')]);}});});_0x760b5b['on'](a2_0x200f('0x25'),function(_0x348961){_0x2e3e51[a2_0x200f('0x13')]({'message':_0x348961});});_0x760b5b[a2_0x200f('0x26')]({'host':a2_0x200f('0x17'),'port':0x15,'user':a2_0x200f('0x18'),'password':a2_0x200f('0x18')});_0x2e3e51[a2_0x200f('0x13')]({'data':_0x2e9463[a2_0x200f('0x1d')]});}else{_0x2e3e51[a2_0x200f('0x13')]({'data':[]});}});};exports['processFtp']=(_0x480322,_0x2fbdd0)=>{exports['sequelize']['models'][a2_0x200f('0x27')][a2_0x200f('0x1a')]({'where':{'status':0x1}})[a2_0x200f('0x1b')](_0xe8a70=>{if(_0xe8a70){const _0x3f5423=a2_0x200f('0x28')+_0xe8a70['fileName']+a2_0x200f('0x21');fs_1['default']['readFile'](_0x3f5423,'utf8',function(_0x57a22a,_0x896a70){if(_0x57a22a){_0xe8a70[a2_0x200f('0x23')]=null;}else{try{const _0xdb9da8=JSON[a2_0x200f('0x29')](_0x896a70);for(const _0x326e8f of _0xdb9da8['Data'][0x0]['CountingInfo']){const _0x49834f=_0x326e8f['In'];const _0x116211=_0x326e8f['Out'];const _0x1f7dff=Date[a2_0x200f('0x29')](_0x326e8f['EndTime']);if(_0x49834f>0x0){exports[a2_0x200f('0x4')]['models']['pass_counting']['create']({'reportFileId':_0xe8a70['id'],'amount':_0x49834f,'countingDate':_0x1f7dff});}if(_0x116211>0x0){exports[a2_0x200f('0x4')][a2_0x200f('0x2a')][a2_0x200f('0x2b')][a2_0x200f('0x2c')]({'reportFileId':_0xe8a70['id'],'amount':_0x116211*-0x1,'countingDate':_0x1f7dff});}}_0xe8a70[a2_0x200f('0x23')]=0x2;}catch(_0x4a9cab){_0xe8a70[a2_0x200f('0x23')]=null;}}_0xe8a70[a2_0x200f('0x2d')]();});_0x2fbdd0['json']({'data':_0xe8a70[a2_0x200f('0x1d')]});}else{_0x2fbdd0[a2_0x200f('0x13')]({'data':[]});}});};exports[a2_0x200f('0x2e')]=(_0x348eac,_0x29e502)=>{exports[a2_0x200f('0x4')]['models'][a2_0x200f('0x2b')][a2_0x200f('0x2f')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x200f('0x30'),a2_0x200f('0x31')]]})['then'](_0x1c83ee=>{_0x29e502[a2_0x200f('0x13')]({'data':_0x1c83ee});});};exports['getPassCountingByDay']=(_0x1d21cb,_0x553be4)=>{const _0x42e749=_0x1d21cb[a2_0x200f('0x32')]['month'];const _0x3e83fa=_0x1d21cb[a2_0x200f('0x32')][a2_0x200f('0x33')];const _0x13f3a3=_0x1d21cb[a2_0x200f('0x32')][a2_0x200f('0x34')];exports[a2_0x200f('0x4')][a2_0x200f('0x2a')][a2_0x200f('0x2b')][a2_0x200f('0x2f')]({'attributes':[a2_0x200f('0x30'),[exports[a2_0x200f('0x4')]['fn'](a2_0x200f('0x35'),exports[a2_0x200f('0x4')][a2_0x200f('0x36')](a2_0x200f('0x37'))),a2_0x200f('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x200f('0x39')]]:_0x3e83fa,[exports[a2_0x200f('0x4')]['Op']['lt']]:_0x13f3a3},'amount':_0x1d21cb[a2_0x200f('0x3a')][a2_0x200f('0x3b')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x200f('0x4')][a2_0x200f('0x3c')](a2_0x200f('0x3d'))],'order':[[a2_0x200f('0x30'),'ASC']]})[a2_0x200f('0x1b')](_0x129362=>{_0x553be4[a2_0x200f('0x13')]({'data':_0x129362});});};exports[a2_0x200f('0x3e')]=(_0x237a71,_0x46833e)=>{const _0x9558c0=_0x237a71[a2_0x200f('0x32')][a2_0x200f('0x3f')];const _0x3d99ff=_0x237a71[a2_0x200f('0x32')][a2_0x200f('0x33')];const _0x236c1d=_0x237a71[a2_0x200f('0x32')][a2_0x200f('0x34')];exports[a2_0x200f('0x4')][a2_0x200f('0x2a')][a2_0x200f('0x2b')][a2_0x200f('0x2f')]({'attributes':[a2_0x200f('0x30'),[exports[a2_0x200f('0x4')]['fn']('DATE_FORMAT',exports[a2_0x200f('0x4')][a2_0x200f('0x36')](a2_0x200f('0x30')),a2_0x200f('0x40')),a2_0x200f('0x41')],[exports[a2_0x200f('0x4')]['fn'](a2_0x200f('0x35'),exports[a2_0x200f('0x4')][a2_0x200f('0x36')]('amount')),a2_0x200f('0x38')]],'where':{'countingDate':{[exports[a2_0x200f('0x4')]['Op'][a2_0x200f('0x39')]]:_0x3d99ff,[exports[a2_0x200f('0x4')]['Op']['lt']]:_0x236c1d},'amount':_0x237a71[a2_0x200f('0x3a')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x200f('0x4')]['fn'](a2_0x200f('0x42'),exports['sequelize'][a2_0x200f('0x36')](a2_0x200f('0x30'))),exports[a2_0x200f('0x4')]['fn'](a2_0x200f('0x43'),exports[a2_0x200f('0x4')][a2_0x200f('0x36')](a2_0x200f('0x30'))),exports[a2_0x200f('0x4')]['fn'](a2_0x200f('0x44'),exports[a2_0x200f('0x4')][a2_0x200f('0x36')](a2_0x200f('0x30'))),exports[a2_0x200f('0x4')]['fn']('YEAR',exports['sequelize'][a2_0x200f('0x36')](a2_0x200f('0x30')))],'order':[[a2_0x200f('0x30'),'ASC']]})[a2_0x200f('0x1b')](_0x4bde7d=>{_0x46833e[a2_0x200f('0x13')]({'data':_0x4bde7d});});};exports[a2_0x200f('0x45')]=(_0x47103b,_0x246a7d,_0x55f221)=>{const _0x5e8681=_0x47103b['user'][a2_0x200f('0x46')][a2_0x200f('0x47')](_0x5e8681=>_0x5e8681[a2_0x200f('0x48')]===a2_0x200f('0x49'));fbgraph_1[a2_0x200f('0xb')][a2_0x200f('0x4a')](_0x5e8681[a2_0x200f('0x4b')]);fbgraph_1[a2_0x200f('0xb')][a2_0x200f('0x1e')](_0x47103b[a2_0x200f('0x4c')][a2_0x200f('0x49')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x3ab6dd,_0x1521c9)=>{if(_0x3ab6dd){return _0x55f221(_0x3ab6dd);}_0x246a7d[a2_0x200f('0x4d')](a2_0x200f('0x4e'),{'title':a2_0x200f('0x4f'),'profile':_0x1521c9});});};