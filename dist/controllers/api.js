var a2_0x59f2=['__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','render','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','colombia','Downloading:\x20','name','json','models','report_files','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','end','media/','.txt','pipe','createWriteStream','save','Downloaded:\x20','processFtp','readFile','status','Data','CountingInfo','Out','parse','pass_counting','create','getPassCounting','findAll','countingDate','getPassCountingByDay','query','month','startDate','endDate','sum','col','amount','total','gte','literal','ASC','getPassCountingByHour','DATE_FORMAT','countingDateShort','params','direction','DAY','getFacebook','tokens','find','setAccessToken','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API'];(function(_0x2ef03e,_0x8d3cf0){var _0x7f5448=function(_0x255b23){while(--_0x255b23){_0x2ef03e['push'](_0x2ef03e['shift']());}};_0x7f5448(++_0x8d3cf0);}(a2_0x59f2,0xed));var a2_0x1a21=function(_0x2634aa,_0x21de9b){_0x2634aa=_0x2634aa-0x0;var _0x484789=a2_0x59f2[_0x2634aa];return _0x484789;};'use strict';var __importDefault=this&&this[a2_0x1a21('0x0')]||function(_0x347d90){return _0x347d90&&_0x347d90[a2_0x1a21('0x1')]?_0x347d90:{'default':_0x347d90};};Object[a2_0x1a21('0x2')](exports,a2_0x1a21('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1a21('0x3')));const ftp_1=__importDefault(require(a2_0x1a21('0x4')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x40fffb){exports[a2_0x1a21('0x5')]=_0x40fffb;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x282f0,_0x1c40c0)=>{_0x1c40c0[a2_0x1a21('0x6')](a2_0x1a21('0x7'),{'title':a2_0x1a21('0x8')});};exports[a2_0x1a21('0x9')]=(_0x268b14,_0x2b0752)=>{console['log'](a2_0x1a21('0xa'));const _0x799727=[];const _0x2e932f=new ftp_1[(a2_0x1a21('0xb'))]();_0x2e932f['on'](a2_0x1a21('0xc'),function(){console[a2_0x1a21('0xd')](a2_0x1a21('0xe'));_0x2e932f['list'](a2_0x1a21('0xf'),![],function(_0x385520,_0x7a279f){if(_0x385520){}else{for(const _0x48000b of _0x7a279f){console[a2_0x1a21('0xd')](a2_0x1a21('0x10')+_0x48000b[a2_0x1a21('0x11')]);if(_0x48000b[a2_0x1a21('0x11')]['endsWith'](a2_0x1a21('0x12'))){exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')][a2_0x1a21('0x14')][a2_0x1a21('0x15')]({'where':{'fileName':_0x48000b[a2_0x1a21('0x11')]}})['spread']((_0x166176,_0x594f47)=>{if(_0x594f47){console['log'](_0x48000b[a2_0x1a21('0x11')]);_0x799727[a2_0x1a21('0x16')](_0x166176);}});}}}_0x2b0752['json']({'data':_0x799727});});});_0x2e932f['on'](a2_0x1a21('0x17'),function(_0x490382){_0x2b0752['json']({'message':_0x490382});});_0x2e932f[a2_0x1a21('0x18')]({'host':a2_0x1a21('0x19'),'port':0x15,'user':a2_0x1a21('0x1a'),'password':a2_0x1a21('0x1a')});};exports[a2_0x1a21('0x1b')]=(_0x496515,_0x47240f)=>{exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')]['report_files'][a2_0x1a21('0x1c')]({'where':{'status':null}})[a2_0x1a21('0x1d')](_0x4fc3a4=>{if(_0x4fc3a4){const _0x4e6ccc=new ftp_1[(a2_0x1a21('0xb'))]();_0x4e6ccc['on']('ready',function(){console[a2_0x1a21('0xd')](a2_0x1a21('0x1e')+_0x4fc3a4[a2_0x1a21('0x1f')]);_0x4e6ccc[a2_0x1a21('0x20')](a2_0x1a21('0x21')+_0x4fc3a4[a2_0x1a21('0x1f')],function(_0x44f825,_0x42e0f9){_0x4e6ccc[a2_0x1a21('0x22')]();if(_0x44f825){}else{const _0x10c353=a2_0x1a21('0x23')+_0x4fc3a4[a2_0x1a21('0x1f')]+a2_0x1a21('0x24');_0x42e0f9[a2_0x1a21('0x25')](fs_1['default'][a2_0x1a21('0x26')](_0x10c353));_0x4fc3a4['status']=0x1;_0x4fc3a4[a2_0x1a21('0x27')]();console['log'](a2_0x1a21('0x28')+_0x4fc3a4[a2_0x1a21('0x1f')]);}});});_0x4e6ccc['on'](a2_0x1a21('0x17'),function(_0x3d250d){_0x47240f[a2_0x1a21('0x12')]({'message':_0x3d250d});});_0x4e6ccc[a2_0x1a21('0x18')]({'host':a2_0x1a21('0x19'),'port':0x15,'user':a2_0x1a21('0x1a'),'password':a2_0x1a21('0x1a')});_0x47240f['json']({'data':_0x4fc3a4[a2_0x1a21('0x1f')]});}else{_0x47240f[a2_0x1a21('0x12')]({'data':[]});}});};exports[a2_0x1a21('0x29')]=(_0x1feb5b,_0x16e828)=>{exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')][a2_0x1a21('0x14')][a2_0x1a21('0x1c')]({'where':{'status':0x1}})[a2_0x1a21('0x1d')](_0x4c5363=>{if(_0x4c5363){const _0x243182=a2_0x1a21('0x23')+_0x4c5363[a2_0x1a21('0x1f')]+a2_0x1a21('0x24');fs_1[a2_0x1a21('0xb')][a2_0x1a21('0x2a')](_0x243182,'utf8',function(_0x549bf2,_0x512562){if(_0x549bf2){_0x4c5363[a2_0x1a21('0x2b')]=null;}else{try{const _0xdb822e=JSON['parse'](_0x512562);for(const _0x4f6cb1 of _0xdb822e[a2_0x1a21('0x2c')][0x0][a2_0x1a21('0x2d')]){const _0x432210=_0x4f6cb1['In'];const _0x243b1c=_0x4f6cb1[a2_0x1a21('0x2e')];const _0xa8b2ac=Date[a2_0x1a21('0x2f')](_0x4f6cb1['EndTime']);if(_0x432210>0x0){exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')][a2_0x1a21('0x30')]['create']({'reportFileId':_0x4c5363['id'],'amount':_0x432210,'countingDate':_0xa8b2ac});}if(_0x243b1c>0x0){exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')]['pass_counting'][a2_0x1a21('0x31')]({'reportFileId':_0x4c5363['id'],'amount':_0x243b1c*-0x1,'countingDate':_0xa8b2ac});}}_0x4c5363[a2_0x1a21('0x2b')]=0x2;}catch(_0x192ed3){_0x4c5363['status']=null;}}_0x4c5363[a2_0x1a21('0x27')]();});_0x16e828[a2_0x1a21('0x12')]({'data':_0x4c5363[a2_0x1a21('0x1f')]});}else{_0x16e828[a2_0x1a21('0x12')]({'data':[]});}});};exports[a2_0x1a21('0x32')]=(_0x162645,_0x3bda9b)=>{exports['sequelize'][a2_0x1a21('0x13')][a2_0x1a21('0x30')][a2_0x1a21('0x33')]({'where':{'amount':{[exports[a2_0x1a21('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x1a21('0x34'),'ASC']]})[a2_0x1a21('0x1d')](_0x21d724=>{_0x3bda9b['json']({'data':_0x21d724});});};exports[a2_0x1a21('0x35')]=(_0x16fb7b,_0x360b94)=>{const _0x9758c3=_0x16fb7b[a2_0x1a21('0x36')][a2_0x1a21('0x37')];const _0x3b09c7=_0x16fb7b[a2_0x1a21('0x36')][a2_0x1a21('0x38')];const _0x436201=_0x16fb7b[a2_0x1a21('0x36')][a2_0x1a21('0x39')];exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')][a2_0x1a21('0x30')][a2_0x1a21('0x33')]({'attributes':[a2_0x1a21('0x34'),[exports[a2_0x1a21('0x5')]['fn'](a2_0x1a21('0x3a'),exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x3c'))),a2_0x1a21('0x3d')]],'where':{'countingDate':{[exports[a2_0x1a21('0x5')]['Op'][a2_0x1a21('0x3e')]]:_0x3b09c7,[exports[a2_0x1a21('0x5')]['Op']['lt']]:_0x436201},'amount':_0x16fb7b['params']['direction']=='in'?{[exports[a2_0x1a21('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x1a21('0x5')][a2_0x1a21('0x3f')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate',a2_0x1a21('0x40')]]})[a2_0x1a21('0x1d')](_0x1c4933=>{_0x360b94[a2_0x1a21('0x12')]({'data':_0x1c4933});});};exports[a2_0x1a21('0x41')]=(_0x184a59,_0x3a3a14)=>{const _0x2417f8=_0x184a59[a2_0x1a21('0x36')]['month'];const _0x5096f2=_0x184a59[a2_0x1a21('0x36')][a2_0x1a21('0x38')];const _0x28977c=_0x184a59[a2_0x1a21('0x36')][a2_0x1a21('0x39')];exports[a2_0x1a21('0x5')][a2_0x1a21('0x13')][a2_0x1a21('0x30')][a2_0x1a21('0x33')]({'attributes':[a2_0x1a21('0x34'),[exports[a2_0x1a21('0x5')]['fn'](a2_0x1a21('0x42'),exports[a2_0x1a21('0x5')]['col'](a2_0x1a21('0x34')),'%Y-%m-%d\x20%H:00'),a2_0x1a21('0x43')],[exports['sequelize']['fn'](a2_0x1a21('0x3a'),exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x3c'))),a2_0x1a21('0x3d')]],'where':{'countingDate':{[exports[a2_0x1a21('0x5')]['Op']['gte']]:_0x5096f2,[exports[a2_0x1a21('0x5')]['Op']['lt']]:_0x28977c},'amount':_0x184a59[a2_0x1a21('0x44')][a2_0x1a21('0x45')]=='in'?{[exports[a2_0x1a21('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x1a21('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn']('HOUR',exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x34'))),exports[a2_0x1a21('0x5')]['fn'](a2_0x1a21('0x46'),exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x34'))),exports[a2_0x1a21('0x5')]['fn']('MONTH',exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x34'))),exports[a2_0x1a21('0x5')]['fn']('YEAR',exports[a2_0x1a21('0x5')][a2_0x1a21('0x3b')](a2_0x1a21('0x34')))],'order':[[a2_0x1a21('0x34'),a2_0x1a21('0x40')]]})['then'](_0x5af1a8=>{_0x3a3a14[a2_0x1a21('0x12')]({'data':_0x5af1a8});});};exports[a2_0x1a21('0x47')]=(_0x5a145e,_0x5334c3,_0x195e88)=>{const _0x824258=_0x5a145e['user'][a2_0x1a21('0x48')][a2_0x1a21('0x49')](_0x824258=>_0x824258['kind']==='facebook');fbgraph_1[a2_0x1a21('0xb')][a2_0x1a21('0x4a')](_0x824258['accessToken']);fbgraph_1[a2_0x1a21('0xb')]['get'](_0x5a145e['user'][a2_0x1a21('0x4b')]+a2_0x1a21('0x4c'),(_0x3d664d,_0x361ed6)=>{if(_0x3d664d){return _0x195e88(_0x3d664d);}_0x5334c3[a2_0x1a21('0x6')](a2_0x1a21('0x4d'),{'title':a2_0x1a21('0x4e'),'profile':_0x361ed6});});};