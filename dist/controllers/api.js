var a2_0x1a16=['col','amount','total','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','query','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','gte','params','HOUR','MONTH','YEAR','getFacebook','user','tokens','find','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','end','media/','createWriteStream','status','processFtp','.txt','readFile','utf8','parse','CountingInfo','Out','EndTime','pass_counting','create','findAll','getPassCountingByDay','month','startDate','endDate','countingDate','sum'];(function(_0xc83625,_0x357b2e){var _0x4b3603=function(_0x1fca51){while(--_0x1fca51){_0xc83625['push'](_0xc83625['shift']());}};_0x4b3603(++_0x357b2e);}(a2_0x1a16,0x1c8));var a2_0x2f2b=function(_0xa6a2d1,_0x2aa3ac){_0xa6a2d1=_0xa6a2d1-0x0;var _0x5332b3=a2_0x1a16[_0xa6a2d1];return _0x5332b3;};'use strict';var __importDefault=this&&this[a2_0x2f2b('0x0')]||function(_0xe0cc4d){return _0xe0cc4d&&_0xe0cc4d['__esModule']?_0xe0cc4d:{'default':_0xe0cc4d};};Object[a2_0x2f2b('0x1')](exports,a2_0x2f2b('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x2f2b('0x3')));const ftp_1=__importDefault(require(a2_0x2f2b('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x2f2b('0x5')]='';function setSequelize(_0x1dbbee){exports['sequelize']=_0x1dbbee;}exports[a2_0x2f2b('0x6')]=setSequelize;exports[a2_0x2f2b('0x7')]=(_0x288a21,_0x5b747f)=>{_0x5b747f[a2_0x2f2b('0x8')](a2_0x2f2b('0x9'),{'title':a2_0x2f2b('0xa')});};exports[a2_0x2f2b('0xb')]=(_0x18498b,_0x201b79)=>{console['log'](a2_0x2f2b('0xc'));const _0x163807=[];const _0x4ebc8d=new ftp_1[(a2_0x2f2b('0xd'))]();_0x4ebc8d['on'](a2_0x2f2b('0xe'),function(){console[a2_0x2f2b('0xf')](a2_0x2f2b('0x10'));_0x4ebc8d[a2_0x2f2b('0x11')](a2_0x2f2b('0x12'),![],function(_0x358c45,_0x461a44){if(_0x358c45){}else{for(const _0x5b480f of _0x461a44){console[a2_0x2f2b('0xf')](a2_0x2f2b('0x13')+_0x5b480f[a2_0x2f2b('0x14')]);if(_0x5b480f[a2_0x2f2b('0x14')][a2_0x2f2b('0x15')](a2_0x2f2b('0x16'))){exports['sequelize'][a2_0x2f2b('0x17')][a2_0x2f2b('0x18')][a2_0x2f2b('0x19')]({'where':{'fileName':_0x5b480f['name']}})[a2_0x2f2b('0x1a')]((_0x4545cf,_0x32ba07)=>{if(_0x32ba07){console['log'](_0x5b480f[a2_0x2f2b('0x14')]);_0x163807[a2_0x2f2b('0x1b')](_0x4545cf);}});}}}_0x201b79[a2_0x2f2b('0x16')]({'data':_0x163807});});});_0x4ebc8d['on'](a2_0x2f2b('0x1c'),function(_0x517b25){_0x201b79[a2_0x2f2b('0x16')]({'message':_0x517b25});});_0x4ebc8d[a2_0x2f2b('0x1d')]({'host':a2_0x2f2b('0x1e'),'port':0x15,'user':a2_0x2f2b('0x1f'),'password':'ipd'});};exports[a2_0x2f2b('0x20')]=(_0x52a208,_0x5cf218)=>{exports[a2_0x2f2b('0x5')]['models']['report_files'][a2_0x2f2b('0x21')]({'where':{'status':null}})[a2_0x2f2b('0x22')](_0x374fe0=>{if(_0x374fe0){const _0x10d9fd=new ftp_1[(a2_0x2f2b('0xd'))]();_0x10d9fd['on'](a2_0x2f2b('0xe'),function(){console[a2_0x2f2b('0xf')](a2_0x2f2b('0x23')+_0x374fe0[a2_0x2f2b('0x24')]);_0x10d9fd[a2_0x2f2b('0x25')](a2_0x2f2b('0x26')+_0x374fe0[a2_0x2f2b('0x24')],function(_0x207978,_0x5204ee){_0x10d9fd[a2_0x2f2b('0x27')]();if(_0x207978){}else{const _0x81b988=a2_0x2f2b('0x28')+_0x374fe0['fileName']+'.txt';_0x5204ee['pipe'](fs_1[a2_0x2f2b('0xd')][a2_0x2f2b('0x29')](_0x81b988));_0x374fe0[a2_0x2f2b('0x2a')]=0x1;_0x374fe0['save']();console[a2_0x2f2b('0xf')]('Downloaded:\x20'+_0x374fe0[a2_0x2f2b('0x24')]);}});});_0x10d9fd['on']('error',function(_0x1047f4){_0x5cf218['json']({'message':_0x1047f4});});_0x10d9fd['connect']({'host':a2_0x2f2b('0x1e'),'port':0x15,'user':'ipd','password':a2_0x2f2b('0x1f')});_0x5cf218[a2_0x2f2b('0x16')]({'data':_0x374fe0['fileName']});}else{_0x5cf218['json']({'data':[]});}});};exports[a2_0x2f2b('0x2b')]=(_0xeff822,_0x43079f)=>{exports[a2_0x2f2b('0x5')]['models'][a2_0x2f2b('0x18')][a2_0x2f2b('0x21')]({'where':{'status':0x1}})['then'](_0x3e9971=>{if(_0x3e9971){const _0x1c87ee=a2_0x2f2b('0x28')+_0x3e9971['fileName']+a2_0x2f2b('0x2c');fs_1['default'][a2_0x2f2b('0x2d')](_0x1c87ee,a2_0x2f2b('0x2e'),function(_0x1e7750,_0x352b66){if(_0x1e7750){_0x3e9971['status']=null;}else{try{const _0x140e54=JSON[a2_0x2f2b('0x2f')](_0x352b66);for(const _0x5bba10 of _0x140e54['Data'][0x0][a2_0x2f2b('0x30')]){const _0x1836cf=_0x5bba10['In'];const _0x13f285=_0x5bba10[a2_0x2f2b('0x31')];const _0x2874b2=Date[a2_0x2f2b('0x2f')](_0x5bba10[a2_0x2f2b('0x32')]);if(_0x1836cf>0x0){exports[a2_0x2f2b('0x5')]['models'][a2_0x2f2b('0x33')][a2_0x2f2b('0x34')]({'reportFileId':_0x3e9971['id'],'amount':_0x1836cf,'countingDate':_0x2874b2});}if(_0x13f285>0x0){exports[a2_0x2f2b('0x5')]['models'][a2_0x2f2b('0x33')]['create']({'reportFileId':_0x3e9971['id'],'amount':_0x13f285*-0x1,'countingDate':_0x2874b2});}}_0x3e9971[a2_0x2f2b('0x2a')]=0x2;}catch(_0x43dc68){_0x3e9971[a2_0x2f2b('0x2a')]=null;}}_0x3e9971['save']();});_0x43079f['json']({'data':_0x3e9971[a2_0x2f2b('0x24')]});}else{_0x43079f[a2_0x2f2b('0x16')]({'data':[]});}});};exports['getPassCounting']=(_0x4591e0,_0xa54b9e)=>{exports[a2_0x2f2b('0x5')]['models']['pass_counting'][a2_0x2f2b('0x35')]({'where':{'amount':{[exports[a2_0x2f2b('0x5')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})['then'](_0x31d7f4=>{_0xa54b9e['json']({'data':_0x31d7f4});});};exports[a2_0x2f2b('0x36')]=(_0x35c381,_0x5728be)=>{const _0x1ec91e=_0x35c381['query'][a2_0x2f2b('0x37')];const _0x2db36e=_0x35c381['query'][a2_0x2f2b('0x38')];const _0x1d6d97=_0x35c381['query'][a2_0x2f2b('0x39')];exports['sequelize']['models'][a2_0x2f2b('0x33')][a2_0x2f2b('0x35')]({'attributes':[a2_0x2f2b('0x3a'),[exports[a2_0x2f2b('0x5')]['fn'](a2_0x2f2b('0x3b'),exports['sequelize'][a2_0x2f2b('0x3c')](a2_0x2f2b('0x3d'))),a2_0x2f2b('0x3e')]],'where':{'countingDate':{[exports['sequelize']['Op']['gte']]:_0x2db36e,[exports['sequelize']['Op']['lt']]:_0x1d6d97},'amount':_0x35c381['params'][a2_0x2f2b('0x3f')]=='in'?{[exports[a2_0x2f2b('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x2f2b('0x5')]['Op']['lt']]:0x0}},'group':[exports[a2_0x2f2b('0x5')][a2_0x2f2b('0x40')](a2_0x2f2b('0x41'))],'order':[[a2_0x2f2b('0x3a'),a2_0x2f2b('0x42')]]})['then'](_0x4757c8=>{_0x5728be[a2_0x2f2b('0x16')]({'data':_0x4757c8});});};exports[a2_0x2f2b('0x43')]=(_0x51c7fc,_0x21cbf6)=>{const _0x48c100=_0x51c7fc[a2_0x2f2b('0x44')][a2_0x2f2b('0x37')];const _0x370b00=_0x51c7fc[a2_0x2f2b('0x44')][a2_0x2f2b('0x38')];const _0x49c26e=_0x51c7fc[a2_0x2f2b('0x44')][a2_0x2f2b('0x39')];exports[a2_0x2f2b('0x5')][a2_0x2f2b('0x17')]['pass_counting'][a2_0x2f2b('0x35')]({'attributes':[a2_0x2f2b('0x3a'),[exports['sequelize']['fn'](a2_0x2f2b('0x45'),exports[a2_0x2f2b('0x5')]['col']('countingDate'),a2_0x2f2b('0x46')),a2_0x2f2b('0x47')],[exports['sequelize']['fn']('sum',exports['sequelize'][a2_0x2f2b('0x3c')](a2_0x2f2b('0x3d'))),a2_0x2f2b('0x3e')]],'where':{'countingDate':{[exports[a2_0x2f2b('0x5')]['Op'][a2_0x2f2b('0x48')]]:_0x370b00,[exports[a2_0x2f2b('0x5')]['Op']['lt']]:_0x49c26e},'amount':_0x51c7fc[a2_0x2f2b('0x49')]['direction']=='in'?{[exports[a2_0x2f2b('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x2f2b('0x5')]['Op']['lt']]:0x0}},'group':[exports[a2_0x2f2b('0x5')]['fn'](a2_0x2f2b('0x4a'),exports[a2_0x2f2b('0x5')][a2_0x2f2b('0x3c')](a2_0x2f2b('0x3a'))),exports[a2_0x2f2b('0x5')]['fn']('DAY',exports[a2_0x2f2b('0x5')][a2_0x2f2b('0x3c')](a2_0x2f2b('0x3a'))),exports[a2_0x2f2b('0x5')]['fn'](a2_0x2f2b('0x4b'),exports['sequelize'][a2_0x2f2b('0x3c')](a2_0x2f2b('0x3a'))),exports['sequelize']['fn'](a2_0x2f2b('0x4c'),exports[a2_0x2f2b('0x5')]['col']('countingDate'))],'order':[['countingDate','ASC']]})[a2_0x2f2b('0x22')](_0x22f432=>{_0x21cbf6[a2_0x2f2b('0x16')]({'data':_0x22f432});});};exports[a2_0x2f2b('0x4d')]=(_0x460202,_0xafc31,_0x1119c1)=>{const _0x5104db=_0x460202[a2_0x2f2b('0x4e')][a2_0x2f2b('0x4f')][a2_0x2f2b('0x50')](_0x5104db=>_0x5104db['kind']===a2_0x2f2b('0x51'));fbgraph_1['default']['setAccessToken'](_0x5104db[a2_0x2f2b('0x52')]);fbgraph_1['default'][a2_0x2f2b('0x25')](_0x460202[a2_0x2f2b('0x4e')][a2_0x2f2b('0x51')]+a2_0x2f2b('0x53'),(_0x62c7e7,_0x2364ed)=>{if(_0x62c7e7){return _0x1119c1(_0x62c7e7);}_0xafc31[a2_0x2f2b('0x8')](a2_0x2f2b('0x54'),{'title':a2_0x2f2b('0x55'),'profile':_0x2364ed});});};