var a2_0x26d0=['sum','HOUR','YEAR','user','setAccessToken','accessToken','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','defineProperty','__esModule','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','downloadFtp','then','fileName','get','colombia/','end','media/','.txt','pipe','default','createWriteStream','status','save','Downloaded:\x20','processFtp','findOne','readFile','utf8','parse','CountingInfo','create','pass_counting','findAll','ASC','getPassCountingByDay','month','query','startDate','endDate','countingDate','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort'];(function(_0x1021b2,_0x2dfa58){var _0x1e638a=function(_0x550b76){while(--_0x550b76){_0x1021b2['push'](_0x1021b2['shift']());}};_0x1e638a(++_0x2dfa58);}(a2_0x26d0,0xf0));var a2_0x262b=function(_0x509503,_0x237e06){_0x509503=_0x509503-0x0;var _0x169578=a2_0x26d0[_0x509503];return _0x169578;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2ad0b8){return _0x2ad0b8&&_0x2ad0b8['__esModule']?_0x2ad0b8:{'default':_0x2ad0b8};};Object[a2_0x262b('0x0')](exports,a2_0x262b('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x262b('0x2')));const ftp_1=__importDefault(require(a2_0x262b('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x262b('0x4')]='';function setSequelize(_0x1bed72){exports[a2_0x262b('0x4')]=_0x1bed72;}exports['setSequelize']=setSequelize;exports[a2_0x262b('0x5')]=(_0x35293c,_0x53f93a)=>{_0x53f93a[a2_0x262b('0x6')](a2_0x262b('0x7'),{'title':a2_0x262b('0x8')});};exports[a2_0x262b('0x9')]=(_0x426242,_0xd8e73a)=>{console[a2_0x262b('0xa')]('connecting');const _0x4978fa=[];const _0x65fa5d=new ftp_1['default']();_0x65fa5d['on']('ready',function(){console[a2_0x262b('0xa')](a2_0x262b('0xb'));_0x65fa5d[a2_0x262b('0xc')](a2_0x262b('0xd'),![],function(_0x5d996b,_0x29da4c){if(_0x5d996b){}else{for(const _0xe93771 of _0x29da4c){console[a2_0x262b('0xa')](a2_0x262b('0xe')+_0xe93771['name']);if(_0xe93771[a2_0x262b('0xf')][a2_0x262b('0x10')](a2_0x262b('0x11'))){exports['sequelize'][a2_0x262b('0x12')][a2_0x262b('0x13')][a2_0x262b('0x14')]({'where':{'fileName':_0xe93771[a2_0x262b('0xf')]}})[a2_0x262b('0x15')]((_0x4d5c32,_0x490112)=>{if(_0x490112){console[a2_0x262b('0xa')](_0xe93771[a2_0x262b('0xf')]);_0x4978fa['push'](_0x4d5c32);}});}}}_0xd8e73a[a2_0x262b('0x11')]({'data':_0x4978fa});});});_0x65fa5d['on'](a2_0x262b('0x16'),function(_0x11e4eb){_0xd8e73a[a2_0x262b('0x11')]({'message':_0x11e4eb});});_0x65fa5d[a2_0x262b('0x17')]({'host':a2_0x262b('0x18'),'port':0x15,'user':a2_0x262b('0x19'),'password':'ipd'});};exports[a2_0x262b('0x1a')]=(_0x326ba8,_0x5605ae)=>{exports['sequelize'][a2_0x262b('0x12')][a2_0x262b('0x13')]['findOne']({'where':{'status':null}})[a2_0x262b('0x1b')](_0x22a876=>{if(_0x22a876){const _0x1cb027=new ftp_1['default']();_0x1cb027['on']('ready',function(){console[a2_0x262b('0xa')]('connected:'+_0x22a876[a2_0x262b('0x1c')]);_0x1cb027[a2_0x262b('0x1d')](a2_0x262b('0x1e')+_0x22a876[a2_0x262b('0x1c')],function(_0x263591,_0x2273f4){_0x1cb027[a2_0x262b('0x1f')]();if(_0x263591){}else{const _0x515b0d=a2_0x262b('0x20')+_0x22a876[a2_0x262b('0x1c')]+a2_0x262b('0x21');_0x2273f4[a2_0x262b('0x22')](fs_1[a2_0x262b('0x23')][a2_0x262b('0x24')](_0x515b0d));_0x22a876[a2_0x262b('0x25')]=0x1;_0x22a876[a2_0x262b('0x26')]();console[a2_0x262b('0xa')](a2_0x262b('0x27')+_0x22a876[a2_0x262b('0x1c')]);}});});_0x1cb027['on'](a2_0x262b('0x16'),function(_0x116f5a){_0x5605ae['json']({'message':_0x116f5a});});_0x1cb027[a2_0x262b('0x17')]({'host':a2_0x262b('0x18'),'port':0x15,'user':'ipd','password':a2_0x262b('0x19')});_0x5605ae[a2_0x262b('0x11')]({'data':_0x22a876['fileName']});}else{_0x5605ae['json']({'data':[]});}});};exports[a2_0x262b('0x28')]=(_0x267899,_0x4d2c96)=>{exports['sequelize']['models']['report_files'][a2_0x262b('0x29')]({'where':{'status':0x1}})['then'](_0x3212d5=>{if(_0x3212d5){const _0x1db300=a2_0x262b('0x20')+_0x3212d5['fileName']+a2_0x262b('0x21');fs_1[a2_0x262b('0x23')][a2_0x262b('0x2a')](_0x1db300,a2_0x262b('0x2b'),function(_0x26e39c,_0x58ddb3){if(_0x26e39c){_0x3212d5[a2_0x262b('0x25')]=null;}else{try{const _0xf69d1c=JSON[a2_0x262b('0x2c')](_0x58ddb3);for(const _0x2993aa of _0xf69d1c['Data'][0x0][a2_0x262b('0x2d')]){const _0x2c5516=_0x2993aa['In'];const _0x5e1b8e=_0x2993aa['Out'];const _0x581071=Date[a2_0x262b('0x2c')](_0x2993aa['EndTime']);if(_0x2c5516>0x0){exports['sequelize'][a2_0x262b('0x12')]['pass_counting'][a2_0x262b('0x2e')]({'reportFileId':_0x3212d5['id'],'amount':_0x2c5516,'countingDate':_0x581071});}if(_0x5e1b8e>0x0){exports[a2_0x262b('0x4')][a2_0x262b('0x12')][a2_0x262b('0x2f')][a2_0x262b('0x2e')]({'reportFileId':_0x3212d5['id'],'amount':_0x5e1b8e*-0x1,'countingDate':_0x581071});}}_0x3212d5[a2_0x262b('0x25')]=0x2;}catch(_0x3d2e32){_0x3212d5[a2_0x262b('0x25')]=null;}}_0x3212d5['save']();});_0x4d2c96[a2_0x262b('0x11')]({'data':_0x3212d5['fileName']});}else{_0x4d2c96[a2_0x262b('0x11')]({'data':[]});}});};exports['getPassCounting']=(_0x5f4152,_0x33f24b)=>{exports['sequelize'][a2_0x262b('0x12')][a2_0x262b('0x2f')][a2_0x262b('0x30')]({'where':{'amount':{[exports[a2_0x262b('0x4')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x262b('0x31')]]})[a2_0x262b('0x1b')](_0x3b06ef=>{_0x33f24b[a2_0x262b('0x11')]({'data':_0x3b06ef});});};exports[a2_0x262b('0x32')]=(_0x31f1e2,_0x41feca)=>{const _0x5e20ea=_0x31f1e2['query'][a2_0x262b('0x33')];const _0x4f5c75=_0x31f1e2[a2_0x262b('0x34')][a2_0x262b('0x35')];const _0x5e1a77=_0x31f1e2[a2_0x262b('0x34')][a2_0x262b('0x36')];exports[a2_0x262b('0x4')][a2_0x262b('0x12')][a2_0x262b('0x2f')]['findAll']({'attributes':[a2_0x262b('0x37'),[exports[a2_0x262b('0x4')]['fn']('sum',exports['sequelize'][a2_0x262b('0x38')](a2_0x262b('0x39'))),a2_0x262b('0x3a')]],'where':{'countingDate':{[exports[a2_0x262b('0x4')]['Op'][a2_0x262b('0x3b')]]:_0x4f5c75,[exports[a2_0x262b('0x4')]['Op']['lt']]:_0x5e1a77},'amount':_0x31f1e2[a2_0x262b('0x3c')][a2_0x262b('0x3d')]=='in'?{[exports[a2_0x262b('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x262b('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x262b('0x4')][a2_0x262b('0x3e')](a2_0x262b('0x3f'))],'order':[[a2_0x262b('0x37'),a2_0x262b('0x31')]]})['then'](_0x5caafc=>{_0x41feca['json']({'data':_0x5caafc});});};exports[a2_0x262b('0x40')]=(_0x288a8a,_0x399eb1)=>{const _0x54fb8c=_0x288a8a[a2_0x262b('0x34')][a2_0x262b('0x33')];const _0x3187b0=_0x288a8a['query'][a2_0x262b('0x35')];const _0x82d652=_0x288a8a[a2_0x262b('0x34')][a2_0x262b('0x36')];exports[a2_0x262b('0x4')][a2_0x262b('0x12')]['pass_counting'][a2_0x262b('0x30')]({'attributes':[a2_0x262b('0x37'),[exports[a2_0x262b('0x4')]['fn'](a2_0x262b('0x41'),exports[a2_0x262b('0x4')][a2_0x262b('0x38')]('countingDate'),a2_0x262b('0x42')),a2_0x262b('0x43')],[exports[a2_0x262b('0x4')]['fn'](a2_0x262b('0x44'),exports[a2_0x262b('0x4')]['col']('amount')),a2_0x262b('0x3a')]],'where':{'countingDate':{[exports[a2_0x262b('0x4')]['Op'][a2_0x262b('0x3b')]]:_0x3187b0,[exports[a2_0x262b('0x4')]['Op']['lt']]:_0x82d652},'amount':_0x288a8a[a2_0x262b('0x3c')]['direction']=='in'?{[exports[a2_0x262b('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x262b('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x262b('0x4')]['fn'](a2_0x262b('0x45'),exports[a2_0x262b('0x4')][a2_0x262b('0x38')]('countingDate')),exports['sequelize']['fn']('DAY',exports[a2_0x262b('0x4')]['col']('countingDate')),exports[a2_0x262b('0x4')]['fn']('MONTH',exports[a2_0x262b('0x4')][a2_0x262b('0x38')]('countingDate')),exports['sequelize']['fn'](a2_0x262b('0x46'),exports[a2_0x262b('0x4')][a2_0x262b('0x38')](a2_0x262b('0x37')))],'order':[[a2_0x262b('0x37'),a2_0x262b('0x31')]]})['then'](_0x5712f2=>{_0x399eb1['json']({'data':_0x5712f2});});};exports['getFacebook']=(_0x2f21d7,_0x43fc4a,_0x220255)=>{const _0x214c66=_0x2f21d7[a2_0x262b('0x47')]['tokens']['find'](_0x214c66=>_0x214c66['kind']==='facebook');fbgraph_1[a2_0x262b('0x23')][a2_0x262b('0x48')](_0x214c66[a2_0x262b('0x49')]);fbgraph_1[a2_0x262b('0x23')][a2_0x262b('0x1d')](_0x2f21d7[a2_0x262b('0x47')][a2_0x262b('0x4a')]+a2_0x262b('0x4b'),(_0x338d23,_0x38ec00)=>{if(_0x338d23){return _0x220255(_0x338d23);}_0x43fc4a['render']('api/facebook',{'title':a2_0x262b('0x4c'),'profile':_0x38ec00});});};