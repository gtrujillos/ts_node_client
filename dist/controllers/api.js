var a2_0x51f9=['error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','readFile','utf8','parse','Data','CountingInfo','EndTime','create','pass_counting','findAll','countingDate','ASC','query','month','startDate','sum','amount','total','gte','direction','literal','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','params','DAY','MONTH','YEAR','user','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','fbgraph','ftp','sequelize','setSequelize','render','api/index','syncFtp','log','connecting','default','ready','list','colombia','Downloading:\x20','name','endsWith','json','models','report_files','findOrCreate','spread','push'];(function(_0x567101,_0x3f1cdf){var _0x56d7a1=function(_0x5b8684){while(--_0x5b8684){_0x567101['push'](_0x567101['shift']());}};_0x56d7a1(++_0x3f1cdf);}(a2_0x51f9,0x125));var a2_0x17f2=function(_0x516d65,_0x59cc06){_0x516d65=_0x516d65-0x0;var _0x5a731e=a2_0x51f9[_0x516d65];return _0x5a731e;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x9f83e7){return _0x9f83e7&&_0x9f83e7[a2_0x17f2('0x0')]?_0x9f83e7:{'default':_0x9f83e7};};Object['defineProperty'](exports,a2_0x17f2('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x17f2('0x1')));const ftp_1=__importDefault(require(a2_0x17f2('0x2')));const fs_1=__importDefault(require('fs'));exports[a2_0x17f2('0x3')]='';function setSequelize(_0x538b9b){exports[a2_0x17f2('0x3')]=_0x538b9b;}exports[a2_0x17f2('0x4')]=setSequelize;exports['getApi']=(_0xda5835,_0x347593)=>{_0x347593[a2_0x17f2('0x5')](a2_0x17f2('0x6'),{'title':'API\x20Examples'});};exports[a2_0x17f2('0x7')]=(_0x28965b,_0x4b20e2)=>{console[a2_0x17f2('0x8')](a2_0x17f2('0x9'));const _0x3280b9=[];const _0x37b5bc=new ftp_1[(a2_0x17f2('0xa'))]();_0x37b5bc['on'](a2_0x17f2('0xb'),function(){console['log']('connected');_0x37b5bc[a2_0x17f2('0xc')](a2_0x17f2('0xd'),![],function(_0x2b0e7c,_0x9f13dc){if(_0x2b0e7c){}else{for(const _0xb25b00 of _0x9f13dc){console[a2_0x17f2('0x8')](a2_0x17f2('0xe')+_0xb25b00[a2_0x17f2('0xf')]);if(_0xb25b00['name'][a2_0x17f2('0x10')](a2_0x17f2('0x11'))){exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')][a2_0x17f2('0x13')][a2_0x17f2('0x14')]({'where':{'fileName':_0xb25b00[a2_0x17f2('0xf')]}})[a2_0x17f2('0x15')]((_0x34e28f,_0x29e3ca)=>{if(_0x29e3ca){console[a2_0x17f2('0x8')](_0xb25b00[a2_0x17f2('0xf')]);_0x3280b9[a2_0x17f2('0x16')](_0x34e28f);}});}}}_0x4b20e2[a2_0x17f2('0x11')]({'data':_0x3280b9});});});_0x37b5bc['on'](a2_0x17f2('0x17'),function(_0x54c58b){_0x4b20e2['json']({'message':_0x54c58b});});_0x37b5bc[a2_0x17f2('0x18')]({'host':a2_0x17f2('0x19'),'port':0x15,'user':a2_0x17f2('0x1a'),'password':'ipd'});};exports[a2_0x17f2('0x1b')]=(_0x31adb3,_0x257390)=>{exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')][a2_0x17f2('0x13')][a2_0x17f2('0x1c')]({'where':{'status':null}})[a2_0x17f2('0x1d')](_0x3cc317=>{if(_0x3cc317){const _0x10c4ab=new ftp_1['default']();_0x10c4ab['on'](a2_0x17f2('0xb'),function(){console[a2_0x17f2('0x8')](a2_0x17f2('0x1e')+_0x3cc317[a2_0x17f2('0x1f')]);_0x10c4ab['get'](a2_0x17f2('0x20')+_0x3cc317['fileName'],function(_0x45d101,_0x4c24a8){_0x10c4ab[a2_0x17f2('0x21')]();if(_0x45d101){}else{const _0x30fcf1=a2_0x17f2('0x22')+_0x3cc317[a2_0x17f2('0x1f')]+a2_0x17f2('0x23');_0x4c24a8[a2_0x17f2('0x24')](fs_1[a2_0x17f2('0xa')][a2_0x17f2('0x25')](_0x30fcf1));_0x3cc317[a2_0x17f2('0x26')]=0x1;_0x3cc317[a2_0x17f2('0x27')]();console[a2_0x17f2('0x8')](a2_0x17f2('0x28')+_0x3cc317[a2_0x17f2('0x1f')]);}});});_0x10c4ab['on']('error',function(_0x42dd4f){_0x257390[a2_0x17f2('0x11')]({'message':_0x42dd4f});});_0x10c4ab[a2_0x17f2('0x18')]({'host':a2_0x17f2('0x19'),'port':0x15,'user':a2_0x17f2('0x1a'),'password':a2_0x17f2('0x1a')});_0x257390[a2_0x17f2('0x11')]({'data':_0x3cc317[a2_0x17f2('0x1f')]});}else{_0x257390[a2_0x17f2('0x11')]({'data':[]});}});};exports[a2_0x17f2('0x29')]=(_0x4eff65,_0x309922)=>{exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')][a2_0x17f2('0x13')]['findOne']({'where':{'status':0x1}})[a2_0x17f2('0x1d')](_0x2c9822=>{if(_0x2c9822){const _0x30c4a8='media/'+_0x2c9822[a2_0x17f2('0x1f')]+'.txt';fs_1[a2_0x17f2('0xa')][a2_0x17f2('0x2a')](_0x30c4a8,a2_0x17f2('0x2b'),function(_0x1e7906,_0x2aca96){if(_0x1e7906){_0x2c9822[a2_0x17f2('0x26')]=null;}else{try{const _0xae9dca=JSON[a2_0x17f2('0x2c')](_0x2aca96);for(const _0x4e7c5b of _0xae9dca[a2_0x17f2('0x2d')][0x0][a2_0x17f2('0x2e')]){const _0x510ce1=_0x4e7c5b['In'];const _0xf25a9e=_0x4e7c5b['Out'];const _0x2e40ad=Date[a2_0x17f2('0x2c')](_0x4e7c5b[a2_0x17f2('0x2f')]);if(_0x510ce1>0x0){exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')]['pass_counting'][a2_0x17f2('0x30')]({'reportFileId':_0x2c9822['id'],'amount':_0x510ce1,'countingDate':_0x2e40ad});}if(_0xf25a9e>0x0){exports[a2_0x17f2('0x3')]['models'][a2_0x17f2('0x31')][a2_0x17f2('0x30')]({'reportFileId':_0x2c9822['id'],'amount':_0xf25a9e*-0x1,'countingDate':_0x2e40ad});}}_0x2c9822[a2_0x17f2('0x26')]=0x2;}catch(_0x319136){_0x2c9822[a2_0x17f2('0x26')]=null;}}_0x2c9822[a2_0x17f2('0x27')]();});_0x309922[a2_0x17f2('0x11')]({'data':_0x2c9822[a2_0x17f2('0x1f')]});}else{_0x309922[a2_0x17f2('0x11')]({'data':[]});}});};exports['getPassCounting']=(_0x50084f,_0x1c7136)=>{exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')][a2_0x17f2('0x31')][a2_0x17f2('0x32')]({'where':{'amount':{[exports[a2_0x17f2('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0x17f2('0x33'),a2_0x17f2('0x34')]]})[a2_0x17f2('0x1d')](_0x4e33e0=>{_0x1c7136[a2_0x17f2('0x11')]({'data':_0x4e33e0});});};exports['getPassCountingByDay']=(_0x4a363c,_0x4c1e37)=>{const _0xb0eba6=_0x4a363c[a2_0x17f2('0x35')][a2_0x17f2('0x36')];const _0x152dab=_0x4a363c[a2_0x17f2('0x35')][a2_0x17f2('0x37')];const _0x1e89b6=_0x4a363c[a2_0x17f2('0x35')]['endDate'];exports[a2_0x17f2('0x3')][a2_0x17f2('0x12')][a2_0x17f2('0x31')][a2_0x17f2('0x32')]({'attributes':[a2_0x17f2('0x33'),[exports[a2_0x17f2('0x3')]['fn'](a2_0x17f2('0x38'),exports[a2_0x17f2('0x3')]['col'](a2_0x17f2('0x39'))),a2_0x17f2('0x3a')]],'where':{'countingDate':{[exports[a2_0x17f2('0x3')]['Op'][a2_0x17f2('0x3b')]]:_0x152dab,[exports['sequelize']['Op']['lt']]:_0x1e89b6},'amount':_0x4a363c['params'][a2_0x17f2('0x3c')]=='in'?{[exports[a2_0x17f2('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x17f2('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x17f2('0x3')][a2_0x17f2('0x3d')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x17f2('0x33'),a2_0x17f2('0x34')]]})[a2_0x17f2('0x1d')](_0x595fd5=>{_0x4c1e37[a2_0x17f2('0x11')]({'data':_0x595fd5});});};exports['getPassCountingByHour']=(_0x46ac22,_0x51ace9)=>{const _0x102770=_0x46ac22[a2_0x17f2('0x35')][a2_0x17f2('0x36')];const _0x37916a=_0x46ac22[a2_0x17f2('0x35')][a2_0x17f2('0x37')];const _0x253bc8=_0x46ac22[a2_0x17f2('0x35')]['endDate'];exports[a2_0x17f2('0x3')]['models'][a2_0x17f2('0x31')]['findAll']({'attributes':[a2_0x17f2('0x33'),[exports[a2_0x17f2('0x3')]['fn'](a2_0x17f2('0x3e'),exports[a2_0x17f2('0x3')][a2_0x17f2('0x3f')](a2_0x17f2('0x33')),a2_0x17f2('0x40')),a2_0x17f2('0x41')],[exports['sequelize']['fn'](a2_0x17f2('0x38'),exports[a2_0x17f2('0x3')][a2_0x17f2('0x3f')](a2_0x17f2('0x39'))),'total']],'where':{'countingDate':{[exports[a2_0x17f2('0x3')]['Op'][a2_0x17f2('0x3b')]]:_0x37916a,[exports[a2_0x17f2('0x3')]['Op']['lt']]:_0x253bc8},'amount':_0x46ac22[a2_0x17f2('0x42')][a2_0x17f2('0x3c')]=='in'?{[exports[a2_0x17f2('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a2_0x17f2('0x3')]['fn']('HOUR',exports[a2_0x17f2('0x3')][a2_0x17f2('0x3f')]('countingDate')),exports[a2_0x17f2('0x3')]['fn'](a2_0x17f2('0x43'),exports[a2_0x17f2('0x3')][a2_0x17f2('0x3f')](a2_0x17f2('0x33'))),exports[a2_0x17f2('0x3')]['fn'](a2_0x17f2('0x44'),exports['sequelize'][a2_0x17f2('0x3f')]('countingDate')),exports[a2_0x17f2('0x3')]['fn'](a2_0x17f2('0x45'),exports[a2_0x17f2('0x3')][a2_0x17f2('0x3f')](a2_0x17f2('0x33')))],'order':[[a2_0x17f2('0x33'),a2_0x17f2('0x34')]]})[a2_0x17f2('0x1d')](_0x3495d1=>{_0x51ace9[a2_0x17f2('0x11')]({'data':_0x3495d1});});};exports['getFacebook']=(_0xd37eb6,_0x1688c6,_0x3dd93a)=>{const _0x38d50a=_0xd37eb6[a2_0x17f2('0x46')]['tokens'][a2_0x17f2('0x47')](_0x38d50a=>_0x38d50a[a2_0x17f2('0x48')]===a2_0x17f2('0x49'));fbgraph_1[a2_0x17f2('0xa')][a2_0x17f2('0x4a')](_0x38d50a[a2_0x17f2('0x4b')]);fbgraph_1['default']['get'](_0xd37eb6[a2_0x17f2('0x46')]['facebook']+a2_0x17f2('0x4c'),(_0x31111d,_0x15e2fb)=>{if(_0x31111d){return _0x3dd93a(_0x31111d);}_0x1688c6[a2_0x17f2('0x5')](a2_0x17f2('0x4d'),{'title':a2_0x17f2('0x4e'),'profile':_0x15e2fb});});};