var a2_0x4a8c=['user','tokens','find','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','getApi','render','api/index','API\x20Examples','log','connecting','default','ready','connected','colombia','name','models','report_files','findOrCreate','spread','json','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','connected:','fileName','get','colombia/','end','media/','pipe','createWriteStream','status','save','Downloaded:\x20','error','processFtp','then','.txt','readFile','utf8','Data','parse','EndTime','sequelize','pass_counting','create','findAll','countingDate','ASC','getPassCountingByDay','query','month','sum','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','%Y-%m-%d\x20%H:00','col','HOUR','MONTH','YEAR'];(function(_0x18d6b7,_0x4928a7){var _0x362ba8=function(_0x91d35a){while(--_0x91d35a){_0x18d6b7['push'](_0x18d6b7['shift']());}};_0x362ba8(++_0x4928a7);}(a2_0x4a8c,0xef));var a2_0x43f9=function(_0x3ab06a,_0xfd0a81){_0x3ab06a=_0x3ab06a-0x0;var _0x1a9f84=a2_0x4a8c[_0x3ab06a];return _0x1a9f84;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x73e972){return _0x73e972&&_0x73e972[a2_0x43f9('0x0')]?_0x73e972:{'default':_0x73e972};};Object[a2_0x43f9('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x43f9('0x2')));const ftp_1=__importDefault(require(a2_0x43f9('0x3')));const fs_1=__importDefault(require('fs'));exports['sequelize']='';function setSequelize(_0x1f901a){exports['sequelize']=_0x1f901a;}exports['setSequelize']=setSequelize;exports[a2_0x43f9('0x4')]=(_0x3cc186,_0x5e3062)=>{_0x5e3062[a2_0x43f9('0x5')](a2_0x43f9('0x6'),{'title':a2_0x43f9('0x7')});};exports['syncFtp']=(_0x5d2d77,_0x370d34)=>{console[a2_0x43f9('0x8')](a2_0x43f9('0x9'));const _0x5e1d7e=[];const _0x1e3b97=new ftp_1[(a2_0x43f9('0xa'))]();_0x1e3b97['on'](a2_0x43f9('0xb'),function(){console[a2_0x43f9('0x8')](a2_0x43f9('0xc'));_0x1e3b97['list'](a2_0x43f9('0xd'),![],function(_0x1ee117,_0x19806f){if(_0x1ee117){}else{for(const _0x4c861f of _0x19806f){console[a2_0x43f9('0x8')]('Downloading:\x20'+_0x4c861f[a2_0x43f9('0xe')]);if(_0x4c861f[a2_0x43f9('0xe')]['endsWith']('json')){exports['sequelize'][a2_0x43f9('0xf')][a2_0x43f9('0x10')][a2_0x43f9('0x11')]({'where':{'fileName':_0x4c861f[a2_0x43f9('0xe')]}})[a2_0x43f9('0x12')]((_0x2e18ec,_0x346ab1)=>{if(_0x346ab1){console[a2_0x43f9('0x8')](_0x4c861f[a2_0x43f9('0xe')]);_0x5e1d7e['push'](_0x2e18ec);}});}}}_0x370d34['json']({'data':_0x5e1d7e});});});_0x1e3b97['on']('error',function(_0x3fda60){_0x370d34[a2_0x43f9('0x13')]({'message':_0x3fda60});});_0x1e3b97[a2_0x43f9('0x14')]({'host':a2_0x43f9('0x15'),'port':0x15,'user':a2_0x43f9('0x16'),'password':a2_0x43f9('0x16')});};exports[a2_0x43f9('0x17')]=(_0x44a63a,_0x5aae13)=>{exports['sequelize'][a2_0x43f9('0xf')]['report_files'][a2_0x43f9('0x18')]({'where':{'status':null}})['then'](_0x917fe4=>{if(_0x917fe4){const _0x318f47=new ftp_1[(a2_0x43f9('0xa'))]();_0x318f47['on']('ready',function(){console[a2_0x43f9('0x8')](a2_0x43f9('0x19')+_0x917fe4[a2_0x43f9('0x1a')]);_0x318f47[a2_0x43f9('0x1b')](a2_0x43f9('0x1c')+_0x917fe4[a2_0x43f9('0x1a')],function(_0x3761db,_0x2f46f1){_0x318f47[a2_0x43f9('0x1d')]();if(_0x3761db){}else{const _0x1eab55=a2_0x43f9('0x1e')+_0x917fe4['fileName']+'.txt';_0x2f46f1[a2_0x43f9('0x1f')](fs_1[a2_0x43f9('0xa')][a2_0x43f9('0x20')](_0x1eab55));_0x917fe4[a2_0x43f9('0x21')]=0x1;_0x917fe4[a2_0x43f9('0x22')]();console[a2_0x43f9('0x8')](a2_0x43f9('0x23')+_0x917fe4['fileName']);}});});_0x318f47['on'](a2_0x43f9('0x24'),function(_0x2d19ac){_0x5aae13[a2_0x43f9('0x13')]({'message':_0x2d19ac});});_0x318f47['connect']({'host':a2_0x43f9('0x15'),'port':0x15,'user':'ipd','password':a2_0x43f9('0x16')});_0x5aae13[a2_0x43f9('0x13')]({'data':_0x917fe4[a2_0x43f9('0x1a')]});}else{_0x5aae13['json']({'data':[]});}});};exports[a2_0x43f9('0x25')]=(_0x1cbf2c,_0x24c541)=>{exports['sequelize'][a2_0x43f9('0xf')]['report_files'][a2_0x43f9('0x18')]({'where':{'status':0x1}})[a2_0x43f9('0x26')](_0x2e9886=>{if(_0x2e9886){const _0x27d2c4=a2_0x43f9('0x1e')+_0x2e9886[a2_0x43f9('0x1a')]+a2_0x43f9('0x27');fs_1[a2_0x43f9('0xa')][a2_0x43f9('0x28')](_0x27d2c4,a2_0x43f9('0x29'),function(_0x38993d,_0x5ca676){if(_0x38993d){_0x2e9886[a2_0x43f9('0x21')]=null;}else{try{const _0x2fe61e=JSON['parse'](_0x5ca676);for(const _0x39e744 of _0x2fe61e[a2_0x43f9('0x2a')][0x0]['CountingInfo']){const _0x42ff00=_0x39e744['In'];const _0x197d15=_0x39e744['Out'];const _0x104fbd=Date[a2_0x43f9('0x2b')](_0x39e744[a2_0x43f9('0x2c')]);if(_0x42ff00>0x0){exports[a2_0x43f9('0x2d')][a2_0x43f9('0xf')][a2_0x43f9('0x2e')]['create']({'reportFileId':_0x2e9886['id'],'amount':_0x42ff00,'countingDate':_0x104fbd});}if(_0x197d15>0x0){exports[a2_0x43f9('0x2d')][a2_0x43f9('0xf')][a2_0x43f9('0x2e')][a2_0x43f9('0x2f')]({'reportFileId':_0x2e9886['id'],'amount':_0x197d15*-0x1,'countingDate':_0x104fbd});}}_0x2e9886['status']=0x2;}catch(_0x1f0fca){_0x2e9886[a2_0x43f9('0x21')]=null;}}_0x2e9886[a2_0x43f9('0x22')]();});_0x24c541[a2_0x43f9('0x13')]({'data':_0x2e9886[a2_0x43f9('0x1a')]});}else{_0x24c541[a2_0x43f9('0x13')]({'data':[]});}});};exports['getPassCounting']=(_0x3b80a6,_0xaae2d0)=>{exports['sequelize'][a2_0x43f9('0xf')][a2_0x43f9('0x2e')][a2_0x43f9('0x30')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a2_0x43f9('0x31'),a2_0x43f9('0x32')]]})[a2_0x43f9('0x26')](_0xbe50e7=>{_0xaae2d0[a2_0x43f9('0x13')]({'data':_0xbe50e7});});};exports[a2_0x43f9('0x33')]=(_0x4d7259,_0x4baac6)=>{const _0x502021=_0x4d7259[a2_0x43f9('0x34')][a2_0x43f9('0x35')];const _0x363102=_0x4d7259['query']['startDate'];const _0x72dd02=_0x4d7259['query']['endDate'];exports['sequelize'][a2_0x43f9('0xf')][a2_0x43f9('0x2e')][a2_0x43f9('0x30')]({'attributes':['countingDate',[exports[a2_0x43f9('0x2d')]['fn'](a2_0x43f9('0x36'),exports[a2_0x43f9('0x2d')]['col'](a2_0x43f9('0x37'))),a2_0x43f9('0x38')]],'where':{'countingDate':{[exports[a2_0x43f9('0x2d')]['Op'][a2_0x43f9('0x39')]]:_0x363102,[exports[a2_0x43f9('0x2d')]['Op']['lt']]:_0x72dd02},'amount':_0x4d7259[a2_0x43f9('0x3a')][a2_0x43f9('0x3b')]=='in'?{[exports[a2_0x43f9('0x2d')]['Op']['gt']]:0x0}:{[exports[a2_0x43f9('0x2d')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x43f9('0x3c')](a2_0x43f9('0x3d'))],'order':[[a2_0x43f9('0x31'),a2_0x43f9('0x32')]]})[a2_0x43f9('0x26')](_0x5f9429=>{_0x4baac6[a2_0x43f9('0x13')]({'data':_0x5f9429});});};exports[a2_0x43f9('0x3e')]=(_0x343ce6,_0x104eef)=>{const _0x2eb6b6=_0x343ce6[a2_0x43f9('0x34')][a2_0x43f9('0x35')];const _0x3d5fa9=_0x343ce6[a2_0x43f9('0x34')]['startDate'];const _0x330bca=_0x343ce6[a2_0x43f9('0x34')][a2_0x43f9('0x3f')];exports[a2_0x43f9('0x2d')][a2_0x43f9('0xf')][a2_0x43f9('0x2e')][a2_0x43f9('0x30')]({'attributes':[a2_0x43f9('0x31'),[exports['sequelize']['fn']('DATE_FORMAT',exports[a2_0x43f9('0x2d')]['col'](a2_0x43f9('0x31')),a2_0x43f9('0x40')),'countingDateShort'],[exports[a2_0x43f9('0x2d')]['fn'](a2_0x43f9('0x36'),exports[a2_0x43f9('0x2d')][a2_0x43f9('0x41')](a2_0x43f9('0x37'))),a2_0x43f9('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x43f9('0x39')]]:_0x3d5fa9,[exports[a2_0x43f9('0x2d')]['Op']['lt']]:_0x330bca},'amount':_0x343ce6[a2_0x43f9('0x3a')][a2_0x43f9('0x3b')]=='in'?{[exports[a2_0x43f9('0x2d')]['Op']['gt']]:0x0}:{[exports[a2_0x43f9('0x2d')]['Op']['lt']]:0x0}},'group':[exports[a2_0x43f9('0x2d')]['fn'](a2_0x43f9('0x42'),exports[a2_0x43f9('0x2d')][a2_0x43f9('0x41')](a2_0x43f9('0x31'))),exports[a2_0x43f9('0x2d')]['fn']('DAY',exports[a2_0x43f9('0x2d')]['col'](a2_0x43f9('0x31'))),exports[a2_0x43f9('0x2d')]['fn'](a2_0x43f9('0x43'),exports['sequelize'][a2_0x43f9('0x41')](a2_0x43f9('0x31'))),exports[a2_0x43f9('0x2d')]['fn'](a2_0x43f9('0x44'),exports['sequelize'][a2_0x43f9('0x41')](a2_0x43f9('0x31')))],'order':[[a2_0x43f9('0x31'),a2_0x43f9('0x32')]]})['then'](_0x56c6be=>{_0x104eef[a2_0x43f9('0x13')]({'data':_0x56c6be});});};exports['getFacebook']=(_0x4c93e9,_0x5da44c,_0x208bad)=>{const _0x246bba=_0x4c93e9[a2_0x43f9('0x45')][a2_0x43f9('0x46')][a2_0x43f9('0x47')](_0x246bba=>_0x246bba['kind']===a2_0x43f9('0x48'));fbgraph_1[a2_0x43f9('0xa')][a2_0x43f9('0x49')](_0x246bba['accessToken']);fbgraph_1[a2_0x43f9('0xa')]['get'](_0x4c93e9[a2_0x43f9('0x45')][a2_0x43f9('0x48')]+a2_0x43f9('0x4a'),(_0x42d4de,_0x332df7)=>{if(_0x42d4de){return _0x208bad(_0x42d4de);}_0x5da44c[a2_0x43f9('0x5')](a2_0x43f9('0x4b'),{'title':a2_0x43f9('0x4c'),'profile':_0x332df7});});};