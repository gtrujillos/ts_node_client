var a2_0x4380=['models','report_files','findOrCreate','spread','push','error','connect','ftp.vivotek.com','downloadFtp','then','fileName','get','colombia/','media/','.txt','status','save','Downloaded:\x20','ipd','processFtp','findOne','readFile','utf8','CountingInfo','parse','EndTime','create','getPassCounting','pass_counting','findAll','countingDate','ASC','getPassCountingByDay','query','startDate','sum','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','month','DATE_FORMAT','col','countingDateShort','params','DAY','YEAR','getFacebook','user','tokens','find','kind','setAccessToken','accessToken','facebook','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','render','api/index','API\x20Examples','log','connecting','default','ready','connected','list','Downloading:\x20','name','endsWith','json'];(function(_0x33191d,_0x2a9b51){var _0x5be9b5=function(_0x3a3d6c){while(--_0x3a3d6c){_0x33191d['push'](_0x33191d['shift']());}};_0x5be9b5(++_0x2a9b51);}(a2_0x4380,0x174));var a2_0x3194=function(_0x384741,_0x2cacc9){_0x384741=_0x384741-0x0;var _0x28b071=a2_0x4380[_0x384741];return _0x28b071;};'use strict';var __importDefault=this&&this[a2_0x3194('0x0')]||function(_0xa17f9c){return _0xa17f9c&&_0xa17f9c[a2_0x3194('0x1')]?_0xa17f9c:{'default':_0xa17f9c};};Object['defineProperty'](exports,a2_0x3194('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x3194('0x2')));const ftp_1=__importDefault(require(a2_0x3194('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x3194('0x4')]='';function setSequelize(_0x564f49){exports[a2_0x3194('0x4')]=_0x564f49;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x3f31f9,_0x47f840)=>{_0x47f840[a2_0x3194('0x5')](a2_0x3194('0x6'),{'title':a2_0x3194('0x7')});};exports['syncFtp']=(_0x18497e,_0x8a54a0)=>{console[a2_0x3194('0x8')](a2_0x3194('0x9'));const _0xe76a30=[];const _0x15a5cd=new ftp_1[(a2_0x3194('0xa'))]();_0x15a5cd['on'](a2_0x3194('0xb'),function(){console[a2_0x3194('0x8')](a2_0x3194('0xc'));_0x15a5cd[a2_0x3194('0xd')]('colombia',![],function(_0x42d89c,_0x3a5727){if(_0x42d89c){}else{for(const _0x2d645c of _0x3a5727){console['log'](a2_0x3194('0xe')+_0x2d645c[a2_0x3194('0xf')]);if(_0x2d645c[a2_0x3194('0xf')][a2_0x3194('0x10')](a2_0x3194('0x11'))){exports[a2_0x3194('0x4')][a2_0x3194('0x12')][a2_0x3194('0x13')][a2_0x3194('0x14')]({'where':{'fileName':_0x2d645c['name']}})[a2_0x3194('0x15')]((_0x11090c,_0xcee4fe)=>{if(_0xcee4fe){console[a2_0x3194('0x8')](_0x2d645c['name']);_0xe76a30[a2_0x3194('0x16')](_0x11090c);}});}}}_0x8a54a0[a2_0x3194('0x11')]({'data':_0xe76a30});});});_0x15a5cd['on'](a2_0x3194('0x17'),function(_0x2fcd8b){_0x8a54a0[a2_0x3194('0x11')]({'message':_0x2fcd8b});});_0x15a5cd[a2_0x3194('0x18')]({'host':a2_0x3194('0x19'),'port':0x15,'user':'ipd','password':'ipd'});};exports[a2_0x3194('0x1a')]=(_0x87aa90,_0x49ce53)=>{exports['sequelize'][a2_0x3194('0x12')][a2_0x3194('0x13')]['findOne']({'where':{'status':null}})[a2_0x3194('0x1b')](_0x5de3e6=>{if(_0x5de3e6){const _0x558dc7=new ftp_1[(a2_0x3194('0xa'))]();_0x558dc7['on'](a2_0x3194('0xb'),function(){console[a2_0x3194('0x8')]('connected:'+_0x5de3e6[a2_0x3194('0x1c')]);_0x558dc7[a2_0x3194('0x1d')](a2_0x3194('0x1e')+_0x5de3e6['fileName'],function(_0x48a768,_0x506424){_0x558dc7['end']();if(_0x48a768){}else{const _0x2173f6=a2_0x3194('0x1f')+_0x5de3e6[a2_0x3194('0x1c')]+a2_0x3194('0x20');_0x506424['pipe'](fs_1[a2_0x3194('0xa')]['createWriteStream'](_0x2173f6));_0x5de3e6[a2_0x3194('0x21')]=0x1;_0x5de3e6[a2_0x3194('0x22')]();console['log'](a2_0x3194('0x23')+_0x5de3e6[a2_0x3194('0x1c')]);}});});_0x558dc7['on'](a2_0x3194('0x17'),function(_0x188ee2){_0x49ce53[a2_0x3194('0x11')]({'message':_0x188ee2});});_0x558dc7['connect']({'host':a2_0x3194('0x19'),'port':0x15,'user':'ipd','password':a2_0x3194('0x24')});_0x49ce53[a2_0x3194('0x11')]({'data':_0x5de3e6[a2_0x3194('0x1c')]});}else{_0x49ce53['json']({'data':[]});}});};exports[a2_0x3194('0x25')]=(_0x31c4d9,_0x14fd5a)=>{exports[a2_0x3194('0x4')][a2_0x3194('0x12')][a2_0x3194('0x13')][a2_0x3194('0x26')]({'where':{'status':0x1}})['then'](_0xa0c48e=>{if(_0xa0c48e){const _0x28675f=a2_0x3194('0x1f')+_0xa0c48e[a2_0x3194('0x1c')]+'.txt';fs_1[a2_0x3194('0xa')][a2_0x3194('0x27')](_0x28675f,a2_0x3194('0x28'),function(_0x59dbeb,_0x15eaaf){if(_0x59dbeb){_0xa0c48e[a2_0x3194('0x21')]=null;}else{try{const _0x253d83=JSON['parse'](_0x15eaaf);for(const _0x245fb2 of _0x253d83['Data'][0x0][a2_0x3194('0x29')]){const _0x3a0c14=_0x245fb2['In'];const _0x1a247b=_0x245fb2['Out'];const _0x1f52f8=Date[a2_0x3194('0x2a')](_0x245fb2[a2_0x3194('0x2b')]);if(_0x3a0c14>0x0){exports['sequelize'][a2_0x3194('0x12')]['pass_counting'][a2_0x3194('0x2c')]({'reportFileId':_0xa0c48e['id'],'amount':_0x3a0c14,'countingDate':_0x1f52f8});}if(_0x1a247b>0x0){exports[a2_0x3194('0x4')]['models']['pass_counting'][a2_0x3194('0x2c')]({'reportFileId':_0xa0c48e['id'],'amount':_0x1a247b*-0x1,'countingDate':_0x1f52f8});}}_0xa0c48e[a2_0x3194('0x21')]=0x2;}catch(_0x182e86){_0xa0c48e[a2_0x3194('0x21')]=null;}}_0xa0c48e[a2_0x3194('0x22')]();});_0x14fd5a[a2_0x3194('0x11')]({'data':_0xa0c48e[a2_0x3194('0x1c')]});}else{_0x14fd5a['json']({'data':[]});}});};exports[a2_0x3194('0x2d')]=(_0x3ea442,_0x12825d)=>{exports[a2_0x3194('0x4')][a2_0x3194('0x12')][a2_0x3194('0x2e')][a2_0x3194('0x2f')]({'where':{'amount':{[exports[a2_0x3194('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x3194('0x30'),a2_0x3194('0x31')]]})['then'](_0x70a957=>{_0x12825d[a2_0x3194('0x11')]({'data':_0x70a957});});};exports[a2_0x3194('0x32')]=(_0x1b0757,_0x578b72)=>{const _0x56a485=_0x1b0757[a2_0x3194('0x33')]['month'];const _0xb690b5=_0x1b0757[a2_0x3194('0x33')][a2_0x3194('0x34')];const _0xa10c1=_0x1b0757[a2_0x3194('0x33')]['endDate'];exports['sequelize'][a2_0x3194('0x12')][a2_0x3194('0x2e')][a2_0x3194('0x2f')]({'attributes':[a2_0x3194('0x30'),[exports[a2_0x3194('0x4')]['fn'](a2_0x3194('0x35'),exports['sequelize']['col'](a2_0x3194('0x36'))),a2_0x3194('0x37')]],'where':{'countingDate':{[exports[a2_0x3194('0x4')]['Op'][a2_0x3194('0x38')]]:_0xb690b5,[exports[a2_0x3194('0x4')]['Op']['lt']]:_0xa10c1},'amount':_0x1b0757['params'][a2_0x3194('0x39')]=='in'?{[exports[a2_0x3194('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x3194('0x3a')](a2_0x3194('0x3b'))],'order':[[a2_0x3194('0x30'),'ASC']]})['then'](_0x21e204=>{_0x578b72[a2_0x3194('0x11')]({'data':_0x21e204});});};exports[a2_0x3194('0x3c')]=(_0x3ccc37,_0x3f640e)=>{const _0x1b7faf=_0x3ccc37[a2_0x3194('0x33')][a2_0x3194('0x3d')];const _0x4f2970=_0x3ccc37['query'][a2_0x3194('0x34')];const _0x44f7d4=_0x3ccc37[a2_0x3194('0x33')]['endDate'];exports[a2_0x3194('0x4')][a2_0x3194('0x12')][a2_0x3194('0x2e')][a2_0x3194('0x2f')]({'attributes':[a2_0x3194('0x30'),[exports[a2_0x3194('0x4')]['fn'](a2_0x3194('0x3e'),exports[a2_0x3194('0x4')][a2_0x3194('0x3f')](a2_0x3194('0x30')),'%Y-%m-%d\x20%H:00'),a2_0x3194('0x40')],[exports[a2_0x3194('0x4')]['fn'](a2_0x3194('0x35'),exports['sequelize'][a2_0x3194('0x3f')](a2_0x3194('0x36'))),a2_0x3194('0x37')]],'where':{'countingDate':{[exports[a2_0x3194('0x4')]['Op'][a2_0x3194('0x38')]]:_0x4f2970,[exports[a2_0x3194('0x4')]['Op']['lt']]:_0x44f7d4},'amount':_0x3ccc37[a2_0x3194('0x41')][a2_0x3194('0x39')]=='in'?{[exports[a2_0x3194('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x3194('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x3194('0x4')]['fn']('HOUR',exports[a2_0x3194('0x4')][a2_0x3194('0x3f')](a2_0x3194('0x30'))),exports[a2_0x3194('0x4')]['fn'](a2_0x3194('0x42'),exports[a2_0x3194('0x4')][a2_0x3194('0x3f')](a2_0x3194('0x30'))),exports[a2_0x3194('0x4')]['fn']('MONTH',exports['sequelize'][a2_0x3194('0x3f')]('countingDate')),exports[a2_0x3194('0x4')]['fn'](a2_0x3194('0x43'),exports['sequelize'][a2_0x3194('0x3f')](a2_0x3194('0x30')))],'order':[[a2_0x3194('0x30'),'ASC']]})['then'](_0x87347c=>{_0x3f640e['json']({'data':_0x87347c});});};exports[a2_0x3194('0x44')]=(_0x2a3665,_0x3c3c8b,_0x37f7ea)=>{const _0x228401=_0x2a3665[a2_0x3194('0x45')][a2_0x3194('0x46')][a2_0x3194('0x47')](_0x228401=>_0x228401[a2_0x3194('0x48')]==='facebook');fbgraph_1[a2_0x3194('0xa')][a2_0x3194('0x49')](_0x228401[a2_0x3194('0x4a')]);fbgraph_1['default']['get'](_0x2a3665['user'][a2_0x3194('0x4b')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x4757ff,_0x21d0fc)=>{if(_0x4757ff){return _0x37f7ea(_0x4757ff);}_0x3c3c8b['render'](a2_0x3194('0x4c'),{'title':a2_0x3194('0x4d'),'profile':_0x21d0fc});});};