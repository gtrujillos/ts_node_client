var a2_0x4a14=['then','connected:','fileName','get','colombia/','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','error','media/','readFile','utf8','parse','Data','Out','create','pass_counting','findAll','countingDate','getPassCountingByDay','query','endDate','sum','col','amount','gte','params','direction','ASC','getPassCountingByHour','startDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','HOUR','DAY','MONTH','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','name','endsWith','json','report_files','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','downloadFtp','models','findOne'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a2_0x4a14,0x126));var a2_0x96e9=function(_0x5ea02c,_0x3ecee4){_0x5ea02c=_0x5ea02c-0x0;var _0xdcf98a=a2_0x4a14[_0x5ea02c];return _0xdcf98a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5976e9){return _0x5976e9&&_0x5976e9['__esModule']?_0x5976e9:{'default':_0x5976e9};};Object['defineProperty'](exports,a2_0x96e9('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x96e9('0x1')));const ftp_1=__importDefault(require(a2_0x96e9('0x2')));const fs_1=__importDefault(require('fs'));exports[a2_0x96e9('0x3')]='';function setSequelize(_0x3539a5){exports['sequelize']=_0x3539a5;}exports[a2_0x96e9('0x4')]=setSequelize;exports[a2_0x96e9('0x5')]=(_0x126ff4,_0x24f060)=>{_0x24f060[a2_0x96e9('0x6')](a2_0x96e9('0x7'),{'title':a2_0x96e9('0x8')});};exports[a2_0x96e9('0x9')]=(_0x20c65c,_0x5369d4)=>{console[a2_0x96e9('0xa')](a2_0x96e9('0xb'));const _0x3af81a=[];const _0x5ae5b2=new ftp_1[(a2_0x96e9('0xc'))]();_0x5ae5b2['on'](a2_0x96e9('0xd'),function(){console['log'](a2_0x96e9('0xe'));_0x5ae5b2[a2_0x96e9('0xf')](a2_0x96e9('0x10'),![],function(_0x498832,_0x8570b0){if(_0x498832){}else{for(const _0x1aed6f of _0x8570b0){console['log']('Downloading:\x20'+_0x1aed6f[a2_0x96e9('0x11')]);if(_0x1aed6f[a2_0x96e9('0x11')][a2_0x96e9('0x12')](a2_0x96e9('0x13'))){exports[a2_0x96e9('0x3')]['models'][a2_0x96e9('0x14')][a2_0x96e9('0x15')]({'where':{'fileName':_0x1aed6f[a2_0x96e9('0x11')]}})[a2_0x96e9('0x16')]((_0xb227e0,_0x1893b1)=>{if(_0x1893b1){console['log'](_0x1aed6f['name']);_0x3af81a[a2_0x96e9('0x17')](_0xb227e0);}});}}}_0x5369d4[a2_0x96e9('0x13')]({'data':_0x3af81a});});});_0x5ae5b2['on']('error',function(_0x51a935){_0x5369d4['json']({'message':_0x51a935});});_0x5ae5b2[a2_0x96e9('0x18')]({'host':a2_0x96e9('0x19'),'port':0x15,'user':a2_0x96e9('0x1a'),'password':a2_0x96e9('0x1a')});};exports[a2_0x96e9('0x1b')]=(_0x542357,_0x1c6c99)=>{exports[a2_0x96e9('0x3')][a2_0x96e9('0x1c')][a2_0x96e9('0x14')][a2_0x96e9('0x1d')]({'where':{'status':null}})[a2_0x96e9('0x1e')](_0x10fbde=>{if(_0x10fbde){const _0x441ddc=new ftp_1['default']();_0x441ddc['on']('ready',function(){console[a2_0x96e9('0xa')](a2_0x96e9('0x1f')+_0x10fbde[a2_0x96e9('0x20')]);_0x441ddc[a2_0x96e9('0x21')](a2_0x96e9('0x22')+_0x10fbde[a2_0x96e9('0x20')],function(_0x559442,_0x1e8a48){_0x441ddc[a2_0x96e9('0x23')]();if(_0x559442){}else{const _0x1595d8='media/'+_0x10fbde['fileName']+a2_0x96e9('0x24');_0x1e8a48[a2_0x96e9('0x25')](fs_1['default'][a2_0x96e9('0x26')](_0x1595d8));_0x10fbde[a2_0x96e9('0x27')]=0x1;_0x10fbde[a2_0x96e9('0x28')]();console[a2_0x96e9('0xa')](a2_0x96e9('0x29')+_0x10fbde['fileName']);}});});_0x441ddc['on'](a2_0x96e9('0x2a'),function(_0x73614){_0x1c6c99['json']({'message':_0x73614});});_0x441ddc[a2_0x96e9('0x18')]({'host':'ftp.vivotek.com','port':0x15,'user':a2_0x96e9('0x1a'),'password':a2_0x96e9('0x1a')});_0x1c6c99['json']({'data':_0x10fbde[a2_0x96e9('0x20')]});}else{_0x1c6c99[a2_0x96e9('0x13')]({'data':[]});}});};exports['processFtp']=(_0x134c5e,_0x14a739)=>{exports[a2_0x96e9('0x3')][a2_0x96e9('0x1c')][a2_0x96e9('0x14')]['findOne']({'where':{'status':0x1}})[a2_0x96e9('0x1e')](_0x1b09e2=>{if(_0x1b09e2){const _0x3475d8=a2_0x96e9('0x2b')+_0x1b09e2[a2_0x96e9('0x20')]+a2_0x96e9('0x24');fs_1['default'][a2_0x96e9('0x2c')](_0x3475d8,a2_0x96e9('0x2d'),function(_0x109f0e,_0x9d2377){if(_0x109f0e){_0x1b09e2[a2_0x96e9('0x27')]=null;}else{try{const _0x29946e=JSON[a2_0x96e9('0x2e')](_0x9d2377);for(const _0x44bce2 of _0x29946e[a2_0x96e9('0x2f')][0x0]['CountingInfo']){const _0x14cc2e=_0x44bce2['In'];const _0x193965=_0x44bce2[a2_0x96e9('0x30')];const _0x2878a6=Date['parse'](_0x44bce2['EndTime']);if(_0x14cc2e>0x0){exports[a2_0x96e9('0x3')]['models']['pass_counting'][a2_0x96e9('0x31')]({'reportFileId':_0x1b09e2['id'],'amount':_0x14cc2e,'countingDate':_0x2878a6});}if(_0x193965>0x0){exports['sequelize'][a2_0x96e9('0x1c')][a2_0x96e9('0x32')][a2_0x96e9('0x31')]({'reportFileId':_0x1b09e2['id'],'amount':_0x193965*-0x1,'countingDate':_0x2878a6});}}_0x1b09e2[a2_0x96e9('0x27')]=0x2;}catch(_0x11657e){_0x1b09e2[a2_0x96e9('0x27')]=null;}}_0x1b09e2[a2_0x96e9('0x28')]();});_0x14a739[a2_0x96e9('0x13')]({'data':_0x1b09e2[a2_0x96e9('0x20')]});}else{_0x14a739[a2_0x96e9('0x13')]({'data':[]});}});};exports['getPassCounting']=(_0xa07850,_0x31f5bd)=>{exports[a2_0x96e9('0x3')][a2_0x96e9('0x1c')][a2_0x96e9('0x32')][a2_0x96e9('0x33')]({'where':{'amount':{[exports[a2_0x96e9('0x3')]['Op']['gt']]:0x0}},'order':[[a2_0x96e9('0x34'),'ASC']]})[a2_0x96e9('0x1e')](_0x5089c6=>{_0x31f5bd[a2_0x96e9('0x13')]({'data':_0x5089c6});});};exports[a2_0x96e9('0x35')]=(_0x2a8f6b,_0x5e63f6)=>{const _0x2bf1b0=_0x2a8f6b[a2_0x96e9('0x36')]['month'];const _0x499ccf=_0x2a8f6b[a2_0x96e9('0x36')]['startDate'];const _0x3ed902=_0x2a8f6b['query'][a2_0x96e9('0x37')];exports[a2_0x96e9('0x3')][a2_0x96e9('0x1c')][a2_0x96e9('0x32')][a2_0x96e9('0x33')]({'attributes':['countingDate',[exports['sequelize']['fn'](a2_0x96e9('0x38'),exports['sequelize'][a2_0x96e9('0x39')](a2_0x96e9('0x3a'))),'total']],'where':{'countingDate':{[exports[a2_0x96e9('0x3')]['Op'][a2_0x96e9('0x3b')]]:_0x499ccf,[exports[a2_0x96e9('0x3')]['Op']['lt']]:_0x3ed902},'amount':_0x2a8f6b[a2_0x96e9('0x3c')][a2_0x96e9('0x3d')]=='in'?{[exports[a2_0x96e9('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x96e9('0x3')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x96e9('0x34'),a2_0x96e9('0x3e')]]})[a2_0x96e9('0x1e')](_0x3968bf=>{_0x5e63f6[a2_0x96e9('0x13')]({'data':_0x3968bf});});};exports[a2_0x96e9('0x3f')]=(_0x492f7d,_0x4342db)=>{const _0x50e535=_0x492f7d[a2_0x96e9('0x36')]['month'];const _0xbe5e8b=_0x492f7d[a2_0x96e9('0x36')][a2_0x96e9('0x40')];const _0x28a9d1=_0x492f7d[a2_0x96e9('0x36')][a2_0x96e9('0x37')];exports[a2_0x96e9('0x3')]['models']['pass_counting']['findAll']({'attributes':[a2_0x96e9('0x34'),[exports[a2_0x96e9('0x3')]['fn'](a2_0x96e9('0x41'),exports[a2_0x96e9('0x3')]['col']('countingDate'),a2_0x96e9('0x42')),'countingDateShort'],[exports[a2_0x96e9('0x3')]['fn'](a2_0x96e9('0x38'),exports[a2_0x96e9('0x3')][a2_0x96e9('0x39')](a2_0x96e9('0x3a'))),'total']],'where':{'countingDate':{[exports[a2_0x96e9('0x3')]['Op'][a2_0x96e9('0x3b')]]:_0xbe5e8b,[exports[a2_0x96e9('0x3')]['Op']['lt']]:_0x28a9d1},'amount':_0x492f7d[a2_0x96e9('0x3c')][a2_0x96e9('0x3d')]=='in'?{[exports[a2_0x96e9('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x96e9('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x96e9('0x3')]['fn'](a2_0x96e9('0x43'),exports['sequelize'][a2_0x96e9('0x39')]('countingDate')),exports[a2_0x96e9('0x3')]['fn'](a2_0x96e9('0x44'),exports[a2_0x96e9('0x3')]['col'](a2_0x96e9('0x34'))),exports[a2_0x96e9('0x3')]['fn'](a2_0x96e9('0x45'),exports[a2_0x96e9('0x3')][a2_0x96e9('0x39')](a2_0x96e9('0x34'))),exports[a2_0x96e9('0x3')]['fn']('YEAR',exports[a2_0x96e9('0x3')]['col'](a2_0x96e9('0x34')))],'order':[[a2_0x96e9('0x34'),a2_0x96e9('0x3e')]]})[a2_0x96e9('0x1e')](_0x2be640=>{_0x4342db[a2_0x96e9('0x13')]({'data':_0x2be640});});};exports[a2_0x96e9('0x46')]=(_0x142d68,_0x3de913,_0xce98f7)=>{const _0x14d456=_0x142d68[a2_0x96e9('0x47')][a2_0x96e9('0x48')][a2_0x96e9('0x49')](_0x14d456=>_0x14d456[a2_0x96e9('0x4a')]===a2_0x96e9('0x4b'));fbgraph_1['default'][a2_0x96e9('0x4c')](_0x14d456[a2_0x96e9('0x4d')]);fbgraph_1['default'][a2_0x96e9('0x21')](_0x142d68[a2_0x96e9('0x47')][a2_0x96e9('0x4b')]+a2_0x96e9('0x4e'),(_0x25cb45,_0x12549b)=>{if(_0x25cb45){return _0xce98f7(_0x25cb45);}_0x3de913[a2_0x96e9('0x6')](a2_0x96e9('0x4f'),{'title':a2_0x96e9('0x50'),'profile':_0x12549b});});};