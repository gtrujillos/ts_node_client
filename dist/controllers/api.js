var a2_0x3406=['connect','.txt','readFile','utf8','Data','CountingInfo','Out','parse','EndTime','pass_counting','create','getPassCounting','countingDate','ASC','query','endDate','findAll','sum','col','amount','total','gte','params','literal','month','startDate','%Y-%m-%d\x20%H:00','countingDateShort','direction','HOUR','MONTH','YEAR','getFacebook','user','tokens','find','facebook','setAccessToken','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','name','endsWith','json','models','report_files','spread','push','error','ftp.vivotek.com','ipd','findOne','then','connected:','get','colombia/','fileName','media/','createWriteStream','status','save','Downloaded:\x20'];(function(_0x5af751,_0xeecce1){var _0x2dc854=function(_0x4d75b7){while(--_0x4d75b7){_0x5af751['push'](_0x5af751['shift']());}};_0x2dc854(++_0xeecce1);}(a2_0x3406,0x115));var a2_0x1b74=function(_0x2394d6,_0x5c0917){_0x2394d6=_0x2394d6-0x0;var _0x3f93ce=a2_0x3406[_0x2394d6];return _0x3f93ce;};'use strict';var __importDefault=this&&this[a2_0x1b74('0x0')]||function(_0x393120){return _0x393120&&_0x393120['__esModule']?_0x393120:{'default':_0x393120};};Object['defineProperty'](exports,a2_0x1b74('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1b74('0x2')));const ftp_1=__importDefault(require(a2_0x1b74('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x1b74('0x4')]='';function setSequelize(_0x26a206){exports[a2_0x1b74('0x4')]=_0x26a206;}exports[a2_0x1b74('0x5')]=setSequelize;exports[a2_0x1b74('0x6')]=(_0x1a911b,_0x4d2369)=>{_0x4d2369[a2_0x1b74('0x7')](a2_0x1b74('0x8'),{'title':a2_0x1b74('0x9')});};exports[a2_0x1b74('0xa')]=(_0x2a5250,_0x4b87a6)=>{console[a2_0x1b74('0xb')](a2_0x1b74('0xc'));const _0x550c20=[];const _0x49e04e=new ftp_1[(a2_0x1b74('0xd'))]();_0x49e04e['on'](a2_0x1b74('0xe'),function(){console[a2_0x1b74('0xb')](a2_0x1b74('0xf'));_0x49e04e[a2_0x1b74('0x10')](a2_0x1b74('0x11'),![],function(_0x370a85,_0x6de674){if(_0x370a85){}else{for(const _0xd031e9 of _0x6de674){console[a2_0x1b74('0xb')]('Downloading:\x20'+_0xd031e9[a2_0x1b74('0x12')]);if(_0xd031e9[a2_0x1b74('0x12')][a2_0x1b74('0x13')](a2_0x1b74('0x14'))){exports[a2_0x1b74('0x4')][a2_0x1b74('0x15')][a2_0x1b74('0x16')]['findOrCreate']({'where':{'fileName':_0xd031e9[a2_0x1b74('0x12')]}})[a2_0x1b74('0x17')]((_0x320303,_0x299dd3)=>{if(_0x299dd3){console[a2_0x1b74('0xb')](_0xd031e9[a2_0x1b74('0x12')]);_0x550c20[a2_0x1b74('0x18')](_0x320303);}});}}}_0x4b87a6['json']({'data':_0x550c20});});});_0x49e04e['on'](a2_0x1b74('0x19'),function(_0xea6c20){_0x4b87a6[a2_0x1b74('0x14')]({'message':_0xea6c20});});_0x49e04e['connect']({'host':a2_0x1b74('0x1a'),'port':0x15,'user':a2_0x1b74('0x1b'),'password':a2_0x1b74('0x1b')});};exports['downloadFtp']=(_0xd25628,_0x358a0d)=>{exports[a2_0x1b74('0x4')]['models']['report_files'][a2_0x1b74('0x1c')]({'where':{'status':null}})[a2_0x1b74('0x1d')](_0x336a10=>{if(_0x336a10){const _0x3cdefc=new ftp_1[(a2_0x1b74('0xd'))]();_0x3cdefc['on'](a2_0x1b74('0xe'),function(){console[a2_0x1b74('0xb')](a2_0x1b74('0x1e')+_0x336a10['fileName']);_0x3cdefc[a2_0x1b74('0x1f')](a2_0x1b74('0x20')+_0x336a10[a2_0x1b74('0x21')],function(_0x173a27,_0x479013){_0x3cdefc['end']();if(_0x173a27){}else{const _0x2859bf=a2_0x1b74('0x22')+_0x336a10['fileName']+'.txt';_0x479013['pipe'](fs_1[a2_0x1b74('0xd')][a2_0x1b74('0x23')](_0x2859bf));_0x336a10[a2_0x1b74('0x24')]=0x1;_0x336a10[a2_0x1b74('0x25')]();console[a2_0x1b74('0xb')](a2_0x1b74('0x26')+_0x336a10['fileName']);}});});_0x3cdefc['on'](a2_0x1b74('0x19'),function(_0xa30c6e){_0x358a0d[a2_0x1b74('0x14')]({'message':_0xa30c6e});});_0x3cdefc[a2_0x1b74('0x27')]({'host':a2_0x1b74('0x1a'),'port':0x15,'user':a2_0x1b74('0x1b'),'password':'ipd'});_0x358a0d[a2_0x1b74('0x14')]({'data':_0x336a10[a2_0x1b74('0x21')]});}else{_0x358a0d['json']({'data':[]});}});};exports['processFtp']=(_0x15c555,_0x468102)=>{exports[a2_0x1b74('0x4')]['models'][a2_0x1b74('0x16')][a2_0x1b74('0x1c')]({'where':{'status':0x1}})[a2_0x1b74('0x1d')](_0x255765=>{if(_0x255765){const _0x2c6e04=a2_0x1b74('0x22')+_0x255765[a2_0x1b74('0x21')]+a2_0x1b74('0x28');fs_1[a2_0x1b74('0xd')][a2_0x1b74('0x29')](_0x2c6e04,a2_0x1b74('0x2a'),function(_0xef5802,_0xcba2da){if(_0xef5802){_0x255765[a2_0x1b74('0x24')]=null;}else{try{const _0x32da06=JSON['parse'](_0xcba2da);for(const _0xef9536 of _0x32da06[a2_0x1b74('0x2b')][0x0][a2_0x1b74('0x2c')]){const _0x52652f=_0xef9536['In'];const _0x5a7d9c=_0xef9536[a2_0x1b74('0x2d')];const _0x196999=Date[a2_0x1b74('0x2e')](_0xef9536[a2_0x1b74('0x2f')]);if(_0x52652f>0x0){exports[a2_0x1b74('0x4')][a2_0x1b74('0x15')]['pass_counting']['create']({'reportFileId':_0x255765['id'],'amount':_0x52652f,'countingDate':_0x196999});}if(_0x5a7d9c>0x0){exports[a2_0x1b74('0x4')][a2_0x1b74('0x15')][a2_0x1b74('0x30')][a2_0x1b74('0x31')]({'reportFileId':_0x255765['id'],'amount':_0x5a7d9c*-0x1,'countingDate':_0x196999});}}_0x255765[a2_0x1b74('0x24')]=0x2;}catch(_0x2cc523){_0x255765[a2_0x1b74('0x24')]=null;}}_0x255765[a2_0x1b74('0x25')]();});_0x468102['json']({'data':_0x255765[a2_0x1b74('0x21')]});}else{_0x468102[a2_0x1b74('0x14')]({'data':[]});}});};exports[a2_0x1b74('0x32')]=(_0x209f56,_0xda59c6)=>{exports['sequelize'][a2_0x1b74('0x15')][a2_0x1b74('0x30')]['findAll']({'where':{'amount':{[exports[a2_0x1b74('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x1b74('0x33'),a2_0x1b74('0x34')]]})['then'](_0x398c4d=>{_0xda59c6[a2_0x1b74('0x14')]({'data':_0x398c4d});});};exports['getPassCountingByDay']=(_0x376833,_0x147a04)=>{const _0x5daf6a=_0x376833[a2_0x1b74('0x35')]['month'];const _0x195778=_0x376833[a2_0x1b74('0x35')]['startDate'];const _0x352954=_0x376833[a2_0x1b74('0x35')][a2_0x1b74('0x36')];exports[a2_0x1b74('0x4')][a2_0x1b74('0x15')][a2_0x1b74('0x30')][a2_0x1b74('0x37')]({'attributes':[a2_0x1b74('0x33'),[exports[a2_0x1b74('0x4')]['fn'](a2_0x1b74('0x38'),exports['sequelize'][a2_0x1b74('0x39')](a2_0x1b74('0x3a'))),a2_0x1b74('0x3b')]],'where':{'countingDate':{[exports[a2_0x1b74('0x4')]['Op'][a2_0x1b74('0x3c')]]:_0x195778,[exports['sequelize']['Op']['lt']]:_0x352954},'amount':_0x376833[a2_0x1b74('0x3d')]['direction']=='in'?{[exports[a2_0x1b74('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x1b74('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x1b74('0x3e')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x1b74('0x33'),a2_0x1b74('0x34')]]})[a2_0x1b74('0x1d')](_0x230f94=>{_0x147a04[a2_0x1b74('0x14')]({'data':_0x230f94});});};exports['getPassCountingByHour']=(_0x425c97,_0x499a56)=>{const _0x10a1ab=_0x425c97[a2_0x1b74('0x35')][a2_0x1b74('0x3f')];const _0x296be9=_0x425c97[a2_0x1b74('0x35')][a2_0x1b74('0x40')];const _0x58eeea=_0x425c97['query'][a2_0x1b74('0x36')];exports[a2_0x1b74('0x4')]['models'][a2_0x1b74('0x30')][a2_0x1b74('0x37')]({'attributes':[a2_0x1b74('0x33'),[exports['sequelize']['fn']('DATE_FORMAT',exports[a2_0x1b74('0x4')]['col']('countingDate'),a2_0x1b74('0x41')),a2_0x1b74('0x42')],[exports[a2_0x1b74('0x4')]['fn']('sum',exports[a2_0x1b74('0x4')][a2_0x1b74('0x39')](a2_0x1b74('0x3a'))),a2_0x1b74('0x3b')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x1b74('0x3c')]]:_0x296be9,[exports['sequelize']['Op']['lt']]:_0x58eeea},'amount':_0x425c97[a2_0x1b74('0x3d')][a2_0x1b74('0x43')]=='in'?{[exports[a2_0x1b74('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x1b74('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x1b74('0x4')]['fn'](a2_0x1b74('0x44'),exports[a2_0x1b74('0x4')][a2_0x1b74('0x39')](a2_0x1b74('0x33'))),exports[a2_0x1b74('0x4')]['fn']('DAY',exports[a2_0x1b74('0x4')][a2_0x1b74('0x39')](a2_0x1b74('0x33'))),exports[a2_0x1b74('0x4')]['fn'](a2_0x1b74('0x45'),exports[a2_0x1b74('0x4')][a2_0x1b74('0x39')](a2_0x1b74('0x33'))),exports[a2_0x1b74('0x4')]['fn'](a2_0x1b74('0x46'),exports[a2_0x1b74('0x4')][a2_0x1b74('0x39')]('countingDate'))],'order':[[a2_0x1b74('0x33'),a2_0x1b74('0x34')]]})[a2_0x1b74('0x1d')](_0xf40f35=>{_0x499a56[a2_0x1b74('0x14')]({'data':_0xf40f35});});};exports[a2_0x1b74('0x47')]=(_0x5bda1c,_0x15e9aa,_0x1682ad)=>{const _0xb63ed4=_0x5bda1c[a2_0x1b74('0x48')][a2_0x1b74('0x49')][a2_0x1b74('0x4a')](_0xb63ed4=>_0xb63ed4['kind']===a2_0x1b74('0x4b'));fbgraph_1[a2_0x1b74('0xd')][a2_0x1b74('0x4c')](_0xb63ed4['accessToken']);fbgraph_1[a2_0x1b74('0xd')][a2_0x1b74('0x1f')](_0x5bda1c['user'][a2_0x1b74('0x4b')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x4f5c90,_0xf4050a)=>{if(_0x4f5c90){return _0x1682ad(_0x4f5c90);}_0x15e9aa[a2_0x1b74('0x7')](a2_0x1b74('0x4d'),{'title':a2_0x1b74('0x4e'),'profile':_0xf4050a});});};