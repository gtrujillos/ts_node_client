var a2_0x3bd0=['ftp.vivotek.com','ipd','findOne','then','ready','connected:','fileName','get','colombia/','.txt','pipe','createWriteStream','save','Downloaded:\x20','processFtp','media/','readFile','status','Out','parse','EndTime','pass_counting','create','getPassCounting','findAll','countingDate','getPassCountingByDay','query','month','endDate','sum','col','gte','params','literal','getPassCountingByHour','startDate','DATE_FORMAT','countingDateShort','total','direction','HOUR','DAY','MONTH','YEAR','ASC','getFacebook','tokens','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','default','connected','list','colombia','Downloading:\x20','name','json','models','report_files','findOrCreate','spread','push','error','connect'];(function(_0x27c17f,_0x2f230f){var _0x2843bd=function(_0x3f7e0d){while(--_0x3f7e0d){_0x27c17f['push'](_0x27c17f['shift']());}};_0x2843bd(++_0x2f230f);}(a2_0x3bd0,0xd6));var a2_0x1585=function(_0x465ce8,_0xc0dd2a){_0x465ce8=_0x465ce8-0x0;var _0x3e6c30=a2_0x3bd0[_0x465ce8];return _0x3e6c30;};'use strict';var __importDefault=this&&this[a2_0x1585('0x0')]||function(_0x34f9a5){return _0x34f9a5&&_0x34f9a5[a2_0x1585('0x1')]?_0x34f9a5:{'default':_0x34f9a5};};Object[a2_0x1585('0x2')](exports,a2_0x1585('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x1585('0x3')));const ftp_1=__importDefault(require(a2_0x1585('0x4')));const fs_1=__importDefault(require('fs'));exports[a2_0x1585('0x5')]='';function setSequelize(_0x492a06){exports[a2_0x1585('0x5')]=_0x492a06;}exports['setSequelize']=setSequelize;exports[a2_0x1585('0x6')]=(_0x4140c3,_0x27f55a)=>{_0x27f55a[a2_0x1585('0x7')](a2_0x1585('0x8'),{'title':a2_0x1585('0x9')});};exports[a2_0x1585('0xa')]=(_0x5d77e7,_0x3c4b91)=>{console[a2_0x1585('0xb')]('connecting');const _0x529726=[];const _0xe0bed=new ftp_1[(a2_0x1585('0xc'))]();_0xe0bed['on']('ready',function(){console['log'](a2_0x1585('0xd'));_0xe0bed[a2_0x1585('0xe')](a2_0x1585('0xf'),![],function(_0x248e39,_0x34f7a4){if(_0x248e39){}else{for(const _0x202cdc of _0x34f7a4){console['log'](a2_0x1585('0x10')+_0x202cdc[a2_0x1585('0x11')]);if(_0x202cdc[a2_0x1585('0x11')]['endsWith'](a2_0x1585('0x12'))){exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x14')][a2_0x1585('0x15')]({'where':{'fileName':_0x202cdc['name']}})[a2_0x1585('0x16')]((_0x3baa31,_0xb8e256)=>{if(_0xb8e256){console['log'](_0x202cdc[a2_0x1585('0x11')]);_0x529726[a2_0x1585('0x17')](_0x3baa31);}});}}}_0x3c4b91[a2_0x1585('0x12')]({'data':_0x529726});});});_0xe0bed['on'](a2_0x1585('0x18'),function(_0x58b0c1){_0x3c4b91[a2_0x1585('0x12')]({'message':_0x58b0c1});});_0xe0bed[a2_0x1585('0x19')]({'host':a2_0x1585('0x1a'),'port':0x15,'user':'ipd','password':a2_0x1585('0x1b')});};exports['downloadFtp']=(_0x4cbb5c,_0x30b3b8)=>{exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x14')][a2_0x1585('0x1c')]({'where':{'status':null}})[a2_0x1585('0x1d')](_0x324202=>{if(_0x324202){const _0x5aacb4=new ftp_1[(a2_0x1585('0xc'))]();_0x5aacb4['on'](a2_0x1585('0x1e'),function(){console[a2_0x1585('0xb')](a2_0x1585('0x1f')+_0x324202[a2_0x1585('0x20')]);_0x5aacb4[a2_0x1585('0x21')](a2_0x1585('0x22')+_0x324202[a2_0x1585('0x20')],function(_0x1b935f,_0x15c923){_0x5aacb4['end']();if(_0x1b935f){}else{const _0x3db97d='media/'+_0x324202[a2_0x1585('0x20')]+a2_0x1585('0x23');_0x15c923[a2_0x1585('0x24')](fs_1['default'][a2_0x1585('0x25')](_0x3db97d));_0x324202['status']=0x1;_0x324202[a2_0x1585('0x26')]();console[a2_0x1585('0xb')](a2_0x1585('0x27')+_0x324202['fileName']);}});});_0x5aacb4['on'](a2_0x1585('0x18'),function(_0x2789e0){_0x30b3b8[a2_0x1585('0x12')]({'message':_0x2789e0});});_0x5aacb4[a2_0x1585('0x19')]({'host':a2_0x1585('0x1a'),'port':0x15,'user':a2_0x1585('0x1b'),'password':a2_0x1585('0x1b')});_0x30b3b8['json']({'data':_0x324202[a2_0x1585('0x20')]});}else{_0x30b3b8[a2_0x1585('0x12')]({'data':[]});}});};exports[a2_0x1585('0x28')]=(_0x327215,_0x3e131a)=>{exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x14')][a2_0x1585('0x1c')]({'where':{'status':0x1}})['then'](_0x2065b4=>{if(_0x2065b4){const _0x2a5592=a2_0x1585('0x29')+_0x2065b4[a2_0x1585('0x20')]+a2_0x1585('0x23');fs_1['default'][a2_0x1585('0x2a')](_0x2a5592,'utf8',function(_0x9ea4e1,_0x2bfc77){if(_0x9ea4e1){_0x2065b4[a2_0x1585('0x2b')]=null;}else{try{const _0x1b5607=JSON['parse'](_0x2bfc77);for(const _0x5593e8 of _0x1b5607['Data'][0x0]['CountingInfo']){const _0x597827=_0x5593e8['In'];const _0x46d57a=_0x5593e8[a2_0x1585('0x2c')];const _0x4a5274=Date[a2_0x1585('0x2d')](_0x5593e8[a2_0x1585('0x2e')]);if(_0x597827>0x0){exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x2f')][a2_0x1585('0x30')]({'reportFileId':_0x2065b4['id'],'amount':_0x597827,'countingDate':_0x4a5274});}if(_0x46d57a>0x0){exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x2f')][a2_0x1585('0x30')]({'reportFileId':_0x2065b4['id'],'amount':_0x46d57a*-0x1,'countingDate':_0x4a5274});}}_0x2065b4[a2_0x1585('0x2b')]=0x2;}catch(_0x50788a){_0x2065b4[a2_0x1585('0x2b')]=null;}}_0x2065b4[a2_0x1585('0x26')]();});_0x3e131a[a2_0x1585('0x12')]({'data':_0x2065b4[a2_0x1585('0x20')]});}else{_0x3e131a[a2_0x1585('0x12')]({'data':[]});}});};exports[a2_0x1585('0x31')]=(_0x3e8c04,_0x47285b)=>{exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x2f')][a2_0x1585('0x32')]({'where':{'amount':{[exports[a2_0x1585('0x5')]['Op']['gt']]:0x0}},'order':[[a2_0x1585('0x33'),'ASC']]})[a2_0x1585('0x1d')](_0x11a83d=>{_0x47285b[a2_0x1585('0x12')]({'data':_0x11a83d});});};exports[a2_0x1585('0x34')]=(_0x5c8d21,_0x26f1f2)=>{const _0xa35fc3=_0x5c8d21[a2_0x1585('0x35')][a2_0x1585('0x36')];const _0x4999d9=_0x5c8d21[a2_0x1585('0x35')]['startDate'];const _0x3535a6=_0x5c8d21[a2_0x1585('0x35')][a2_0x1585('0x37')];exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x2f')][a2_0x1585('0x32')]({'attributes':[a2_0x1585('0x33'),[exports[a2_0x1585('0x5')]['fn'](a2_0x1585('0x38'),exports[a2_0x1585('0x5')][a2_0x1585('0x39')]('amount')),'total']],'where':{'countingDate':{[exports[a2_0x1585('0x5')]['Op'][a2_0x1585('0x3a')]]:_0x4999d9,[exports[a2_0x1585('0x5')]['Op']['lt']]:_0x3535a6},'amount':_0x5c8d21[a2_0x1585('0x3b')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a2_0x1585('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a2_0x1585('0x3c')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a2_0x1585('0x33'),'ASC']]})[a2_0x1585('0x1d')](_0xdc519f=>{_0x26f1f2[a2_0x1585('0x12')]({'data':_0xdc519f});});};exports[a2_0x1585('0x3d')]=(_0x5a8cd9,_0x4cb97b)=>{const _0x4049ed=_0x5a8cd9['query']['month'];const _0x11d801=_0x5a8cd9['query'][a2_0x1585('0x3e')];const _0x3260bc=_0x5a8cd9[a2_0x1585('0x35')][a2_0x1585('0x37')];exports[a2_0x1585('0x5')][a2_0x1585('0x13')][a2_0x1585('0x2f')][a2_0x1585('0x32')]({'attributes':[a2_0x1585('0x33'),[exports[a2_0x1585('0x5')]['fn'](a2_0x1585('0x3f'),exports[a2_0x1585('0x5')]['col']('countingDate'),'%Y-%m-%d\x20%H:00'),a2_0x1585('0x40')],[exports[a2_0x1585('0x5')]['fn']('sum',exports['sequelize'][a2_0x1585('0x39')]('amount')),a2_0x1585('0x41')]],'where':{'countingDate':{[exports[a2_0x1585('0x5')]['Op']['gte']]:_0x11d801,[exports[a2_0x1585('0x5')]['Op']['lt']]:_0x3260bc},'amount':_0x5a8cd9[a2_0x1585('0x3b')][a2_0x1585('0x42')]=='in'?{[exports[a2_0x1585('0x5')]['Op']['gt']]:0x0}:{[exports[a2_0x1585('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a2_0x1585('0x43'),exports[a2_0x1585('0x5')][a2_0x1585('0x39')](a2_0x1585('0x33'))),exports[a2_0x1585('0x5')]['fn'](a2_0x1585('0x44'),exports[a2_0x1585('0x5')][a2_0x1585('0x39')](a2_0x1585('0x33'))),exports[a2_0x1585('0x5')]['fn'](a2_0x1585('0x45'),exports[a2_0x1585('0x5')][a2_0x1585('0x39')](a2_0x1585('0x33'))),exports[a2_0x1585('0x5')]['fn'](a2_0x1585('0x46'),exports[a2_0x1585('0x5')]['col']('countingDate'))],'order':[[a2_0x1585('0x33'),a2_0x1585('0x47')]]})['then'](_0x1d0dee=>{_0x4cb97b[a2_0x1585('0x12')]({'data':_0x1d0dee});});};exports[a2_0x1585('0x48')]=(_0x2bb682,_0x151468,_0x2bea26)=>{const _0x40c5e5=_0x2bb682['user'][a2_0x1585('0x49')]['find'](_0x40c5e5=>_0x40c5e5[a2_0x1585('0x4a')]===a2_0x1585('0x4b'));fbgraph_1[a2_0x1585('0xc')][a2_0x1585('0x4c')](_0x40c5e5[a2_0x1585('0x4d')]);fbgraph_1[a2_0x1585('0xc')][a2_0x1585('0x21')](_0x2bb682['user']['facebook']+a2_0x1585('0x4e'),(_0x198054,_0x61bc5d)=>{if(_0x198054){return _0x2bea26(_0x198054);}_0x151468[a2_0x1585('0x7')]('api/facebook',{'title':a2_0x1585('0x4f'),'profile':_0x61bc5d});});};