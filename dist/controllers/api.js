var a2_0x189b=['API\x20Examples','syncFtp','log','default','connected','list','colombia','name','endsWith','json','report_files','findOrCreate','connect','ftp.vivotek.com','ipd','downloadFtp','models','findOne','connected:','fileName','get','colombia/','end','media/','.txt','pipe','status','save','Downloaded:\x20','then','utf8','parse','Out','EndTime','pass_counting','create','getPassCounting','findAll','ASC','getPassCountingByDay','query','startDate','endDate','sum','col','amount','total','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','countingDate','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','params','HOUR','YEAR','getFacebook','user','tokens','find','kind','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','__esModule','defineProperty','fbgraph','sequelize','getApi','render','api/index'];(function(_0x4d0cfc,_0x31524e){var _0x9f5434=function(_0x15c0a1){while(--_0x15c0a1){_0x4d0cfc['push'](_0x4d0cfc['shift']());}};_0x9f5434(++_0x31524e);}(a2_0x189b,0x170));var a2_0x380c=function(_0x22c8ac,_0x17034c){_0x22c8ac=_0x22c8ac-0x0;var _0x11e53c=a2_0x189b[_0x22c8ac];return _0x11e53c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x197aca){return _0x197aca&&_0x197aca[a2_0x380c('0x0')]?_0x197aca:{'default':_0x197aca};};Object[a2_0x380c('0x1')](exports,a2_0x380c('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x380c('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x380c('0x3')]='';function setSequelize(_0x35602f){exports[a2_0x380c('0x3')]=_0x35602f;}exports['setSequelize']=setSequelize;exports[a2_0x380c('0x4')]=(_0xac473,_0x330088)=>{_0x330088[a2_0x380c('0x5')](a2_0x380c('0x6'),{'title':a2_0x380c('0x7')});};exports[a2_0x380c('0x8')]=(_0x597aa9,_0x3f1d67)=>{console[a2_0x380c('0x9')]('connecting');const _0x4ca9ba=[];const _0x1f0046=new ftp_1[(a2_0x380c('0xa'))]();_0x1f0046['on']('ready',function(){console['log'](a2_0x380c('0xb'));_0x1f0046[a2_0x380c('0xc')](a2_0x380c('0xd'),![],function(_0x245034,_0x41673f){if(_0x245034){}else{for(const _0x5e1147 of _0x41673f){console[a2_0x380c('0x9')]('Downloading:\x20'+_0x5e1147[a2_0x380c('0xe')]);if(_0x5e1147[a2_0x380c('0xe')][a2_0x380c('0xf')](a2_0x380c('0x10'))){exports[a2_0x380c('0x3')]['models'][a2_0x380c('0x11')][a2_0x380c('0x12')]({'where':{'fileName':_0x5e1147[a2_0x380c('0xe')]}})['spread']((_0x2ddeb7,_0x5f473f)=>{if(_0x5f473f){console[a2_0x380c('0x9')](_0x5e1147[a2_0x380c('0xe')]);_0x4ca9ba['push'](_0x2ddeb7);}});}}}_0x3f1d67[a2_0x380c('0x10')]({'data':_0x4ca9ba});});});_0x1f0046['on']('error',function(_0x13066f){_0x3f1d67[a2_0x380c('0x10')]({'message':_0x13066f});});_0x1f0046[a2_0x380c('0x13')]({'host':a2_0x380c('0x14'),'port':0x15,'user':'ipd','password':a2_0x380c('0x15')});};exports[a2_0x380c('0x16')]=(_0x1df724,_0x3f27fb)=>{exports[a2_0x380c('0x3')][a2_0x380c('0x17')][a2_0x380c('0x11')][a2_0x380c('0x18')]({'where':{'status':null}})['then'](_0x432992=>{if(_0x432992){const _0xec1ba0=new ftp_1[(a2_0x380c('0xa'))]();_0xec1ba0['on']('ready',function(){console[a2_0x380c('0x9')](a2_0x380c('0x19')+_0x432992[a2_0x380c('0x1a')]);_0xec1ba0[a2_0x380c('0x1b')](a2_0x380c('0x1c')+_0x432992[a2_0x380c('0x1a')],function(_0x132505,_0x40ba38){_0xec1ba0[a2_0x380c('0x1d')]();if(_0x132505){}else{const _0x4796ae=a2_0x380c('0x1e')+_0x432992[a2_0x380c('0x1a')]+a2_0x380c('0x1f');_0x40ba38[a2_0x380c('0x20')](fs_1[a2_0x380c('0xa')]['createWriteStream'](_0x4796ae));_0x432992[a2_0x380c('0x21')]=0x1;_0x432992[a2_0x380c('0x22')]();console[a2_0x380c('0x9')](a2_0x380c('0x23')+_0x432992[a2_0x380c('0x1a')]);}});});_0xec1ba0['on']('error',function(_0x3822f1){_0x3f27fb[a2_0x380c('0x10')]({'message':_0x3822f1});});_0xec1ba0['connect']({'host':a2_0x380c('0x14'),'port':0x15,'user':a2_0x380c('0x15'),'password':a2_0x380c('0x15')});_0x3f27fb['json']({'data':_0x432992['fileName']});}else{_0x3f27fb[a2_0x380c('0x10')]({'data':[]});}});};exports['processFtp']=(_0x14d05a,_0x5e4b38)=>{exports[a2_0x380c('0x3')]['models']['report_files'][a2_0x380c('0x18')]({'where':{'status':0x1}})[a2_0x380c('0x24')](_0x551bf4=>{if(_0x551bf4){const _0x5d597e=a2_0x380c('0x1e')+_0x551bf4['fileName']+a2_0x380c('0x1f');fs_1['default']['readFile'](_0x5d597e,a2_0x380c('0x25'),function(_0x5b44d7,_0x4bbc98){if(_0x5b44d7){_0x551bf4[a2_0x380c('0x21')]=null;}else{try{const _0x250788=JSON[a2_0x380c('0x26')](_0x4bbc98);for(const _0x249059 of _0x250788['Data'][0x0]['CountingInfo']){const _0x1f8ee9=_0x249059['In'];const _0x32ecf2=_0x249059[a2_0x380c('0x27')];const _0x1278a1=Date[a2_0x380c('0x26')](_0x249059[a2_0x380c('0x28')]);if(_0x1f8ee9>0x0){exports[a2_0x380c('0x3')][a2_0x380c('0x17')][a2_0x380c('0x29')][a2_0x380c('0x2a')]({'reportFileId':_0x551bf4['id'],'amount':_0x1f8ee9,'countingDate':_0x1278a1});}if(_0x32ecf2>0x0){exports[a2_0x380c('0x3')][a2_0x380c('0x17')]['pass_counting']['create']({'reportFileId':_0x551bf4['id'],'amount':_0x32ecf2*-0x1,'countingDate':_0x1278a1});}}_0x551bf4[a2_0x380c('0x21')]=0x2;}catch(_0x80b33a){_0x551bf4['status']=null;}}_0x551bf4[a2_0x380c('0x22')]();});_0x5e4b38['json']({'data':_0x551bf4[a2_0x380c('0x1a')]});}else{_0x5e4b38[a2_0x380c('0x10')]({'data':[]});}});};exports[a2_0x380c('0x2b')]=(_0xcb89df,_0x5da4fa)=>{exports['sequelize'][a2_0x380c('0x17')]['pass_counting'][a2_0x380c('0x2c')]({'where':{'amount':{[exports[a2_0x380c('0x3')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x380c('0x2d')]]})['then'](_0x487250=>{_0x5da4fa[a2_0x380c('0x10')]({'data':_0x487250});});};exports[a2_0x380c('0x2e')]=(_0x2d8da8,_0xdd19b3)=>{const _0x4a63ec=_0x2d8da8['query']['month'];const _0x4f8f41=_0x2d8da8[a2_0x380c('0x2f')][a2_0x380c('0x30')];const _0xbd6cfc=_0x2d8da8[a2_0x380c('0x2f')][a2_0x380c('0x31')];exports[a2_0x380c('0x3')][a2_0x380c('0x17')]['pass_counting'][a2_0x380c('0x2c')]({'attributes':['countingDate',[exports[a2_0x380c('0x3')]['fn'](a2_0x380c('0x32'),exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x34'))),a2_0x380c('0x35')]],'where':{'countingDate':{[exports[a2_0x380c('0x3')]['Op']['gte']]:_0x4f8f41,[exports[a2_0x380c('0x3')]['Op']['lt']]:_0xbd6cfc},'amount':_0x2d8da8['params'][a2_0x380c('0x36')]=='in'?{[exports[a2_0x380c('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x380c('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x380c('0x3')][a2_0x380c('0x37')](a2_0x380c('0x38'))],'order':[[a2_0x380c('0x39'),'ASC']]})[a2_0x380c('0x24')](_0x3d9066=>{_0xdd19b3['json']({'data':_0x3d9066});});};exports[a2_0x380c('0x3a')]=(_0x16c880,_0x4c576d)=>{const _0x53c3c7=_0x16c880[a2_0x380c('0x2f')][a2_0x380c('0x3b')];const _0x153237=_0x16c880['query'][a2_0x380c('0x30')];const _0xadfbda=_0x16c880[a2_0x380c('0x2f')][a2_0x380c('0x31')];exports[a2_0x380c('0x3')][a2_0x380c('0x17')][a2_0x380c('0x29')]['findAll']({'attributes':[a2_0x380c('0x39'),[exports[a2_0x380c('0x3')]['fn'](a2_0x380c('0x3c'),exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x39')),a2_0x380c('0x3d')),a2_0x380c('0x3e')],[exports[a2_0x380c('0x3')]['fn'](a2_0x380c('0x32'),exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x34'))),a2_0x380c('0x35')]],'where':{'countingDate':{[exports[a2_0x380c('0x3')]['Op']['gte']]:_0x153237,[exports[a2_0x380c('0x3')]['Op']['lt']]:_0xadfbda},'amount':_0x16c880[a2_0x380c('0x3f')]['direction']=='in'?{[exports[a2_0x380c('0x3')]['Op']['gt']]:0x0}:{[exports[a2_0x380c('0x3')]['Op']['lt']]:0x0}},'group':[exports[a2_0x380c('0x3')]['fn'](a2_0x380c('0x40'),exports[a2_0x380c('0x3')]['col'](a2_0x380c('0x39'))),exports['sequelize']['fn']('DAY',exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x39'))),exports[a2_0x380c('0x3')]['fn']('MONTH',exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x39'))),exports[a2_0x380c('0x3')]['fn'](a2_0x380c('0x41'),exports[a2_0x380c('0x3')][a2_0x380c('0x33')](a2_0x380c('0x39')))],'order':[[a2_0x380c('0x39'),a2_0x380c('0x2d')]]})['then'](_0x1cbf7c=>{_0x4c576d[a2_0x380c('0x10')]({'data':_0x1cbf7c});});};exports[a2_0x380c('0x42')]=(_0xdd461d,_0x429f2c,_0x1e1d24)=>{const _0x363d7f=_0xdd461d[a2_0x380c('0x43')][a2_0x380c('0x44')][a2_0x380c('0x45')](_0x363d7f=>_0x363d7f[a2_0x380c('0x46')]==='facebook');fbgraph_1['default'][a2_0x380c('0x47')](_0x363d7f[a2_0x380c('0x48')]);fbgraph_1[a2_0x380c('0xa')][a2_0x380c('0x1b')](_0xdd461d[a2_0x380c('0x43')]['facebook']+a2_0x380c('0x49'),(_0x4a4d36,_0x391031)=>{if(_0x4a4d36){return _0x1e1d24(_0x4a4d36);}_0x429f2c['render'](a2_0x380c('0x4a'),{'title':'Facebook\x20API','profile':_0x391031});});};