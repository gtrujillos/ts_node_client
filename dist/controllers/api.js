var a2_0x13ba=['sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','connected','colombia','name','endsWith','models','spread','json','error','ftp.vivotek.com','ipd','report_files','then','ready','connected:','fileName','get','colombia/','end','pipe','createWriteStream','status','save','Downloaded:\x20','connect','processFtp','findOne','.txt','readFile','utf8','parse','Data','CountingInfo','pass_counting','create','findAll','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','sum','amount','total','gte','params','direction','literal','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','HOUR','DAY','MONTH','getFacebook','find','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','__importDefault','__esModule','defineProperty','ftp'];(function(_0x3e0dec,_0xfdb9ab){var _0x2514cb=function(_0x18be9d){while(--_0x18be9d){_0x3e0dec['push'](_0x3e0dec['shift']());}};_0x2514cb(++_0xfdb9ab);}(a2_0x13ba,0xe0));var a2_0x377e=function(_0x2c9877,_0x3b2cc2){_0x2c9877=_0x2c9877-0x0;var _0x1bc80d=a2_0x13ba[_0x2c9877];return _0x1bc80d;};'use strict';var __importDefault=this&&this[a2_0x377e('0x0')]||function(_0x59f823){return _0x59f823&&_0x59f823[a2_0x377e('0x1')]?_0x59f823:{'default':_0x59f823};};Object[a2_0x377e('0x2')](exports,a2_0x377e('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a2_0x377e('0x3')));const fs_1=__importDefault(require('fs'));exports[a2_0x377e('0x4')]='';function setSequelize(_0x125769){exports['sequelize']=_0x125769;}exports[a2_0x377e('0x5')]=setSequelize;exports[a2_0x377e('0x6')]=(_0x1ce67a,_0x5a65f4)=>{_0x5a65f4[a2_0x377e('0x7')](a2_0x377e('0x8'),{'title':a2_0x377e('0x9')});};exports[a2_0x377e('0xa')]=(_0x46acfa,_0x269141)=>{console[a2_0x377e('0xb')](a2_0x377e('0xc'));const _0x23c42d=[];const _0x1d91df=new ftp_1[(a2_0x377e('0xd'))]();_0x1d91df['on']('ready',function(){console['log'](a2_0x377e('0xe'));_0x1d91df['list'](a2_0x377e('0xf'),![],function(_0x56f37b,_0x1eeb5b){if(_0x56f37b){}else{for(const _0x5c4df0 of _0x1eeb5b){console[a2_0x377e('0xb')]('Downloading:\x20'+_0x5c4df0[a2_0x377e('0x10')]);if(_0x5c4df0[a2_0x377e('0x10')][a2_0x377e('0x11')]('json')){exports[a2_0x377e('0x4')][a2_0x377e('0x12')]['report_files']['findOrCreate']({'where':{'fileName':_0x5c4df0[a2_0x377e('0x10')]}})[a2_0x377e('0x13')]((_0x403518,_0x4363d1)=>{if(_0x4363d1){console['log'](_0x5c4df0[a2_0x377e('0x10')]);_0x23c42d['push'](_0x403518);}});}}}_0x269141[a2_0x377e('0x14')]({'data':_0x23c42d});});});_0x1d91df['on'](a2_0x377e('0x15'),function(_0x2c34cf){_0x269141[a2_0x377e('0x14')]({'message':_0x2c34cf});});_0x1d91df['connect']({'host':a2_0x377e('0x16'),'port':0x15,'user':a2_0x377e('0x17'),'password':'ipd'});};exports['downloadFtp']=(_0x4b2c66,_0x40decb)=>{exports[a2_0x377e('0x4')][a2_0x377e('0x12')][a2_0x377e('0x18')]['findOne']({'where':{'status':null}})[a2_0x377e('0x19')](_0x40ffdb=>{if(_0x40ffdb){const _0x339758=new ftp_1[(a2_0x377e('0xd'))]();_0x339758['on'](a2_0x377e('0x1a'),function(){console['log'](a2_0x377e('0x1b')+_0x40ffdb[a2_0x377e('0x1c')]);_0x339758[a2_0x377e('0x1d')](a2_0x377e('0x1e')+_0x40ffdb[a2_0x377e('0x1c')],function(_0x3195a7,_0x4f8c56){_0x339758[a2_0x377e('0x1f')]();if(_0x3195a7){}else{const _0x446971='media/'+_0x40ffdb[a2_0x377e('0x1c')]+'.txt';_0x4f8c56[a2_0x377e('0x20')](fs_1[a2_0x377e('0xd')][a2_0x377e('0x21')](_0x446971));_0x40ffdb[a2_0x377e('0x22')]=0x1;_0x40ffdb[a2_0x377e('0x23')]();console[a2_0x377e('0xb')](a2_0x377e('0x24')+_0x40ffdb[a2_0x377e('0x1c')]);}});});_0x339758['on'](a2_0x377e('0x15'),function(_0x3aa81d){_0x40decb['json']({'message':_0x3aa81d});});_0x339758[a2_0x377e('0x25')]({'host':a2_0x377e('0x16'),'port':0x15,'user':a2_0x377e('0x17'),'password':a2_0x377e('0x17')});_0x40decb[a2_0x377e('0x14')]({'data':_0x40ffdb['fileName']});}else{_0x40decb[a2_0x377e('0x14')]({'data':[]});}});};exports[a2_0x377e('0x26')]=(_0x146493,_0xd9a7f8)=>{exports[a2_0x377e('0x4')][a2_0x377e('0x12')][a2_0x377e('0x18')][a2_0x377e('0x27')]({'where':{'status':0x1}})[a2_0x377e('0x19')](_0x298cb4=>{if(_0x298cb4){const _0x59c6f9='media/'+_0x298cb4['fileName']+a2_0x377e('0x28');fs_1['default'][a2_0x377e('0x29')](_0x59c6f9,a2_0x377e('0x2a'),function(_0x265f4c,_0x353272){if(_0x265f4c){_0x298cb4[a2_0x377e('0x22')]=null;}else{try{const _0x14547d=JSON[a2_0x377e('0x2b')](_0x353272);for(const _0x1dd03b of _0x14547d[a2_0x377e('0x2c')][0x0][a2_0x377e('0x2d')]){const _0x4b717a=_0x1dd03b['In'];const _0x190ff7=_0x1dd03b['Out'];const _0x439d7a=Date[a2_0x377e('0x2b')](_0x1dd03b['EndTime']);if(_0x4b717a>0x0){exports[a2_0x377e('0x4')]['models'][a2_0x377e('0x2e')]['create']({'reportFileId':_0x298cb4['id'],'amount':_0x4b717a,'countingDate':_0x439d7a});}if(_0x190ff7>0x0){exports[a2_0x377e('0x4')][a2_0x377e('0x12')][a2_0x377e('0x2e')][a2_0x377e('0x2f')]({'reportFileId':_0x298cb4['id'],'amount':_0x190ff7*-0x1,'countingDate':_0x439d7a});}}_0x298cb4[a2_0x377e('0x22')]=0x2;}catch(_0x55c453){_0x298cb4[a2_0x377e('0x22')]=null;}}_0x298cb4[a2_0x377e('0x23')]();});_0xd9a7f8[a2_0x377e('0x14')]({'data':_0x298cb4['fileName']});}else{_0xd9a7f8[a2_0x377e('0x14')]({'data':[]});}});};exports['getPassCounting']=(_0x10caa5,_0x49a1ee)=>{exports[a2_0x377e('0x4')]['models'][a2_0x377e('0x2e')][a2_0x377e('0x30')]({'where':{'amount':{[exports[a2_0x377e('0x4')]['Op']['gt']]:0x0}},'order':[[a2_0x377e('0x31'),a2_0x377e('0x32')]]})[a2_0x377e('0x19')](_0xcc8e71=>{_0x49a1ee[a2_0x377e('0x14')]({'data':_0xcc8e71});});};exports[a2_0x377e('0x33')]=(_0x218317,_0x2fcfd6)=>{const _0xf065d8=_0x218317[a2_0x377e('0x34')]['month'];const _0x30e290=_0x218317[a2_0x377e('0x34')][a2_0x377e('0x35')];const _0x1b24fe=_0x218317['query'][a2_0x377e('0x36')];exports[a2_0x377e('0x4')][a2_0x377e('0x12')]['pass_counting'][a2_0x377e('0x30')]({'attributes':[a2_0x377e('0x31'),[exports['sequelize']['fn'](a2_0x377e('0x37'),exports[a2_0x377e('0x4')]['col'](a2_0x377e('0x38'))),a2_0x377e('0x39')]],'where':{'countingDate':{[exports[a2_0x377e('0x4')]['Op'][a2_0x377e('0x3a')]]:_0x30e290,[exports[a2_0x377e('0x4')]['Op']['lt']]:_0x1b24fe},'amount':_0x218317[a2_0x377e('0x3b')][a2_0x377e('0x3c')]=='in'?{[exports[a2_0x377e('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x377e('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x377e('0x4')][a2_0x377e('0x3d')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate','ASC']]})[a2_0x377e('0x19')](_0xef4335=>{_0x2fcfd6['json']({'data':_0xef4335});});};exports[a2_0x377e('0x3e')]=(_0x425f69,_0x279834)=>{const _0x55f47f=_0x425f69[a2_0x377e('0x34')]['month'];const _0xab028b=_0x425f69[a2_0x377e('0x34')][a2_0x377e('0x35')];const _0x26fd0b=_0x425f69[a2_0x377e('0x34')][a2_0x377e('0x36')];exports[a2_0x377e('0x4')][a2_0x377e('0x12')][a2_0x377e('0x2e')][a2_0x377e('0x30')]({'attributes':[a2_0x377e('0x31'),[exports[a2_0x377e('0x4')]['fn'](a2_0x377e('0x3f'),exports[a2_0x377e('0x4')][a2_0x377e('0x40')](a2_0x377e('0x31')),a2_0x377e('0x41')),a2_0x377e('0x42')],[exports['sequelize']['fn'](a2_0x377e('0x37'),exports[a2_0x377e('0x4')][a2_0x377e('0x40')](a2_0x377e('0x38'))),'total']],'where':{'countingDate':{[exports[a2_0x377e('0x4')]['Op']['gte']]:_0xab028b,[exports[a2_0x377e('0x4')]['Op']['lt']]:_0x26fd0b},'amount':_0x425f69[a2_0x377e('0x3b')][a2_0x377e('0x3c')]=='in'?{[exports[a2_0x377e('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x377e('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x377e('0x4')]['fn'](a2_0x377e('0x43'),exports[a2_0x377e('0x4')][a2_0x377e('0x40')](a2_0x377e('0x31'))),exports['sequelize']['fn'](a2_0x377e('0x44'),exports['sequelize']['col'](a2_0x377e('0x31'))),exports[a2_0x377e('0x4')]['fn'](a2_0x377e('0x45'),exports[a2_0x377e('0x4')][a2_0x377e('0x40')](a2_0x377e('0x31'))),exports[a2_0x377e('0x4')]['fn']('YEAR',exports[a2_0x377e('0x4')][a2_0x377e('0x40')]('countingDate'))],'order':[[a2_0x377e('0x31'),a2_0x377e('0x32')]]})[a2_0x377e('0x19')](_0x5ec981=>{_0x279834['json']({'data':_0x5ec981});});};exports[a2_0x377e('0x46')]=(_0x345b5b,_0x1ba1e1,_0x25fe6a)=>{const _0x147d24=_0x345b5b['user']['tokens'][a2_0x377e('0x47')](_0x147d24=>_0x147d24['kind']===a2_0x377e('0x48'));fbgraph_1[a2_0x377e('0xd')][a2_0x377e('0x49')](_0x147d24['accessToken']);fbgraph_1['default'][a2_0x377e('0x1d')](_0x345b5b['user'][a2_0x377e('0x48')]+a2_0x377e('0x4a'),(_0x5b8e79,_0x4232e0)=>{if(_0x5b8e79){return _0x25fe6a(_0x5b8e79);}_0x1ba1e1[a2_0x377e('0x7')](a2_0x377e('0x4b'),{'title':'Facebook\x20API','profile':_0x4232e0});});};