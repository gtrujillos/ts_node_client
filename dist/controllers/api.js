var a2_0xb9e2=['connect','ipd','downloadFtp','report_files','then','default','ready','connected:','fileName','get','colombia/','media/','status','ftp.vivotek.com','processFtp','.txt','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','pass_counting','create','save','ASC','query','month','startDate','findAll','sum','amount','total','gte','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','countingDate','endDate','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','params','direction','DAY','MONTH','YEAR','user','find','kind','setAccessToken','accessToken','facebook','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','sequelize','render','API\x20Examples','syncFtp','connecting','log','list','colombia','Downloading:\x20','name','endsWith','json','models','findOrCreate','spread','error'];(function(_0x3dc5b6,_0x550b5e){var _0x105003=function(_0x3f2ba){while(--_0x3f2ba){_0x3dc5b6['push'](_0x3dc5b6['shift']());}};_0x105003(++_0x550b5e);}(a2_0xb9e2,0x11c));var a2_0x395d=function(_0x5b1cac,_0x4e44fa){_0x5b1cac=_0x5b1cac-0x0;var _0x1b3d40=a2_0xb9e2[_0x5b1cac];return _0x1b3d40;};'use strict';var __importDefault=this&&this[a2_0x395d('0x0')]||function(_0x28d05c){return _0x28d05c&&_0x28d05c['__esModule']?_0x28d05c:{'default':_0x28d05c};};Object[a2_0x395d('0x1')](exports,a2_0x395d('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a2_0x395d('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));exports[a2_0x395d('0x4')]='';function setSequelize(_0x4863dc){exports['sequelize']=_0x4863dc;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x4057bf,_0x50477d)=>{_0x50477d[a2_0x395d('0x5')]('api/index',{'title':a2_0x395d('0x6')});};exports[a2_0x395d('0x7')]=(_0x2b04d4,_0xf20620)=>{console['log'](a2_0x395d('0x8'));const _0x1a63ba=[];const _0x4f6059=new ftp_1['default']();_0x4f6059['on']('ready',function(){console[a2_0x395d('0x9')]('connected');_0x4f6059[a2_0x395d('0xa')](a2_0x395d('0xb'),![],function(_0x2569b6,_0x3e41ed){if(_0x2569b6){}else{for(const _0x4d47c5 of _0x3e41ed){console[a2_0x395d('0x9')](a2_0x395d('0xc')+_0x4d47c5[a2_0x395d('0xd')]);if(_0x4d47c5[a2_0x395d('0xd')][a2_0x395d('0xe')](a2_0x395d('0xf'))){exports[a2_0x395d('0x4')][a2_0x395d('0x10')]['report_files'][a2_0x395d('0x11')]({'where':{'fileName':_0x4d47c5[a2_0x395d('0xd')]}})[a2_0x395d('0x12')]((_0x351052,_0x3819bb)=>{if(_0x3819bb){console[a2_0x395d('0x9')](_0x4d47c5[a2_0x395d('0xd')]);_0x1a63ba['push'](_0x351052);}});}}}_0xf20620[a2_0x395d('0xf')]({'data':_0x1a63ba});});});_0x4f6059['on'](a2_0x395d('0x13'),function(_0x17a699){_0xf20620[a2_0x395d('0xf')]({'message':_0x17a699});});_0x4f6059[a2_0x395d('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a2_0x395d('0x15')});};exports[a2_0x395d('0x16')]=(_0xe4fc1d,_0x286177)=>{exports['sequelize'][a2_0x395d('0x10')][a2_0x395d('0x17')]['findOne']({'where':{'status':null}})[a2_0x395d('0x18')](_0x535e70=>{if(_0x535e70){const _0x421f75=new ftp_1[(a2_0x395d('0x19'))]();_0x421f75['on'](a2_0x395d('0x1a'),function(){console[a2_0x395d('0x9')](a2_0x395d('0x1b')+_0x535e70[a2_0x395d('0x1c')]);_0x421f75[a2_0x395d('0x1d')](a2_0x395d('0x1e')+_0x535e70[a2_0x395d('0x1c')],function(_0x345bde,_0x29dd6e){_0x421f75['end']();if(_0x345bde){}else{const _0xf72793=a2_0x395d('0x1f')+_0x535e70[a2_0x395d('0x1c')]+'.txt';_0x29dd6e['pipe'](fs_1[a2_0x395d('0x19')]['createWriteStream'](_0xf72793));_0x535e70[a2_0x395d('0x20')]=0x1;_0x535e70['save']();console['log']('Downloaded:\x20'+_0x535e70[a2_0x395d('0x1c')]);}});});_0x421f75['on'](a2_0x395d('0x13'),function(_0x2920cd){_0x286177[a2_0x395d('0xf')]({'message':_0x2920cd});});_0x421f75['connect']({'host':a2_0x395d('0x21'),'port':0x15,'user':'ipd','password':a2_0x395d('0x15')});_0x286177[a2_0x395d('0xf')]({'data':_0x535e70[a2_0x395d('0x1c')]});}else{_0x286177['json']({'data':[]});}});};exports[a2_0x395d('0x22')]=(_0x3b2a51,_0x54b44e)=>{exports[a2_0x395d('0x4')][a2_0x395d('0x10')][a2_0x395d('0x17')]['findOne']({'where':{'status':0x1}})[a2_0x395d('0x18')](_0x114e34=>{if(_0x114e34){const _0xb6ed6c=a2_0x395d('0x1f')+_0x114e34[a2_0x395d('0x1c')]+a2_0x395d('0x23');fs_1['default'][a2_0x395d('0x24')](_0xb6ed6c,a2_0x395d('0x25'),function(_0x34f249,_0x2ea861){if(_0x34f249){_0x114e34[a2_0x395d('0x20')]=null;}else{try{const _0x2d24f0=JSON[a2_0x395d('0x26')](_0x2ea861);for(const _0x87dc07 of _0x2d24f0[a2_0x395d('0x27')][0x0][a2_0x395d('0x28')]){const _0x2cf3a8=_0x87dc07['In'];const _0x5ec564=_0x87dc07[a2_0x395d('0x29')];const _0xe5f11c=Date[a2_0x395d('0x26')](_0x87dc07[a2_0x395d('0x2a')]);if(_0x2cf3a8>0x0){exports[a2_0x395d('0x4')][a2_0x395d('0x10')][a2_0x395d('0x2b')][a2_0x395d('0x2c')]({'reportFileId':_0x114e34['id'],'amount':_0x2cf3a8,'countingDate':_0xe5f11c});}if(_0x5ec564>0x0){exports[a2_0x395d('0x4')][a2_0x395d('0x10')][a2_0x395d('0x2b')][a2_0x395d('0x2c')]({'reportFileId':_0x114e34['id'],'amount':_0x5ec564*-0x1,'countingDate':_0xe5f11c});}}_0x114e34[a2_0x395d('0x20')]=0x2;}catch(_0x564f3b){_0x114e34[a2_0x395d('0x20')]=null;}}_0x114e34[a2_0x395d('0x2d')]();});_0x54b44e['json']({'data':_0x114e34[a2_0x395d('0x1c')]});}else{_0x54b44e[a2_0x395d('0xf')]({'data':[]});}});};exports['getPassCounting']=(_0x17b93c,_0x22e486)=>{exports[a2_0x395d('0x4')][a2_0x395d('0x10')]['pass_counting']['findAll']({'where':{'amount':{[exports[a2_0x395d('0x4')]['Op']['gt']]:0x0}},'order':[['countingDate',a2_0x395d('0x2e')]]})[a2_0x395d('0x18')](_0x43ef89=>{_0x22e486['json']({'data':_0x43ef89});});};exports['getPassCountingByDay']=(_0x3c1e48,_0x5ed480)=>{const _0x57b9c8=_0x3c1e48[a2_0x395d('0x2f')][a2_0x395d('0x30')];const _0x2c6e13=_0x3c1e48[a2_0x395d('0x2f')][a2_0x395d('0x31')];const _0x46b4f3=_0x3c1e48[a2_0x395d('0x2f')]['endDate'];exports[a2_0x395d('0x4')][a2_0x395d('0x10')][a2_0x395d('0x2b')][a2_0x395d('0x32')]({'attributes':['countingDate',[exports[a2_0x395d('0x4')]['fn'](a2_0x395d('0x33'),exports[a2_0x395d('0x4')]['col'](a2_0x395d('0x34'))),a2_0x395d('0x35')]],'where':{'countingDate':{[exports['sequelize']['Op'][a2_0x395d('0x36')]]:_0x2c6e13,[exports[a2_0x395d('0x4')]['Op']['lt']]:_0x46b4f3},'amount':_0x3c1e48['params']['direction']=='in'?{[exports[a2_0x395d('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x395d('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x395d('0x4')][a2_0x395d('0x37')](a2_0x395d('0x38'))],'order':[[a2_0x395d('0x39'),a2_0x395d('0x2e')]]})['then'](_0x10eb0a=>{_0x5ed480[a2_0x395d('0xf')]({'data':_0x10eb0a});});};exports['getPassCountingByHour']=(_0x12279a,_0x505e93)=>{const _0x456a98=_0x12279a[a2_0x395d('0x2f')]['month'];const _0x1b9b2e=_0x12279a[a2_0x395d('0x2f')][a2_0x395d('0x31')];const _0x50f5d4=_0x12279a[a2_0x395d('0x2f')][a2_0x395d('0x3a')];exports[a2_0x395d('0x4')][a2_0x395d('0x10')][a2_0x395d('0x2b')][a2_0x395d('0x32')]({'attributes':[a2_0x395d('0x39'),[exports[a2_0x395d('0x4')]['fn'](a2_0x395d('0x3b'),exports['sequelize'][a2_0x395d('0x3c')](a2_0x395d('0x39')),a2_0x395d('0x3d')),a2_0x395d('0x3e')],[exports[a2_0x395d('0x4')]['fn'](a2_0x395d('0x33'),exports[a2_0x395d('0x4')][a2_0x395d('0x3c')](a2_0x395d('0x34'))),'total']],'where':{'countingDate':{[exports[a2_0x395d('0x4')]['Op']['gte']]:_0x1b9b2e,[exports['sequelize']['Op']['lt']]:_0x50f5d4},'amount':_0x12279a[a2_0x395d('0x3f')][a2_0x395d('0x40')]=='in'?{[exports[a2_0x395d('0x4')]['Op']['gt']]:0x0}:{[exports[a2_0x395d('0x4')]['Op']['lt']]:0x0}},'group':[exports[a2_0x395d('0x4')]['fn']('HOUR',exports[a2_0x395d('0x4')][a2_0x395d('0x3c')](a2_0x395d('0x39'))),exports['sequelize']['fn'](a2_0x395d('0x41'),exports[a2_0x395d('0x4')][a2_0x395d('0x3c')](a2_0x395d('0x39'))),exports[a2_0x395d('0x4')]['fn'](a2_0x395d('0x42'),exports['sequelize']['col'](a2_0x395d('0x39'))),exports['sequelize']['fn'](a2_0x395d('0x43'),exports[a2_0x395d('0x4')]['col'](a2_0x395d('0x39')))],'order':[['countingDate','ASC']]})[a2_0x395d('0x18')](_0x48ca85=>{_0x505e93[a2_0x395d('0xf')]({'data':_0x48ca85});});};exports['getFacebook']=(_0x11bf43,_0x2137c3,_0x5da62e)=>{const _0x3a9fea=_0x11bf43[a2_0x395d('0x44')]['tokens'][a2_0x395d('0x45')](_0x3a9fea=>_0x3a9fea[a2_0x395d('0x46')]==='facebook');fbgraph_1[a2_0x395d('0x19')][a2_0x395d('0x47')](_0x3a9fea[a2_0x395d('0x48')]);fbgraph_1[a2_0x395d('0x19')][a2_0x395d('0x1d')](_0x11bf43['user'][a2_0x395d('0x49')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x186957,_0x414350)=>{if(_0x186957){return _0x5da62e(_0x186957);}_0x2137c3['render'](a2_0x395d('0x4a'),{'title':a2_0x395d('0x4b'),'profile':_0x414350});});};